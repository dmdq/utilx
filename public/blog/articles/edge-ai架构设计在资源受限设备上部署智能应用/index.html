<!doctype html><html lang=zh-cn dir=auto data-theme=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Edge AIæ¶æ„è®¾è®¡ï¼šåœ¨èµ„æºå—é™è®¾å¤‡ä¸Šéƒ¨ç½²æ™ºèƒ½åº”ç”¨ | æŠ€æœ¯åšå®¢ - æœ‰æ¡å·¥å…·</title><meta name=keywords content="Edge AI,è¾¹ç¼˜AIæ¶æ„,æ¨¡å‹é‡åŒ–,ç«¯äº‘ååŒ,TensorFlow Lite,è¾¹ç¼˜æ¨ç†"><meta name=description content="æ·±å…¥æ¢è®¨è¾¹ç¼˜AIæ¶æ„è®¾è®¡ï¼Œæ¶µç›–æ¨¡å‹å‹ç¼©ã€ç«¯äº‘ååŒæ¨ç†ã€è¾¹ç¼˜AIèŠ¯ç‰‡é€‰å‹ã€å®æ—¶æ€§ä¼˜åŒ–ç­‰æ ¸å¿ƒä¸»é¢˜ã€‚"><meta name=author content="æœ‰æ¡å·¥å…·å›¢é˜Ÿ"><link rel=canonical href=/blog/articles/edge-ai%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E5%9C%A8%E8%B5%84%E6%BA%90%E5%8F%97%E9%99%90%E8%AE%BE%E5%A4%87%E4%B8%8A%E9%83%A8%E7%BD%B2%E6%99%BA%E8%83%BD%E5%BA%94%E7%94%A8/><link crossorigin=anonymous href=/blog/assets/css/stylesheet.7e8505b7cdf8bb22ab2305e53c2700bb06c7e64faeb72cd3468823a9a3bd3d6e.css integrity="sha256-foUFt834uyKrIwXlPCcAuwbH5k+utyzTRogjqaO9PW4=" rel="preload stylesheet" as=style><link rel=icon href=/favicon.ico><link rel=icon type=image/png sizes=16x16 href=/blog/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=/blog/favicon-32x32.png><link rel=apple-touch-icon href=/blog/apple-touch-icon.png><link rel=mask-icon href=/blog/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate type=application/rss+xml href=/blog/articles/edge-ai%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E5%9C%A8%E8%B5%84%E6%BA%90%E5%8F%97%E9%99%90%E8%AE%BE%E5%A4%87%E4%B8%8A%E9%83%A8%E7%BD%B2%E6%99%BA%E8%83%BD%E5%BA%94%E7%94%A8/feed.xml title=rss><link rel=alternate hreflang=zh-cn href=/blog/articles/edge-ai%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E5%9C%A8%E8%B5%84%E6%BA%90%E5%8F%97%E9%99%90%E8%AE%BE%E5%A4%87%E4%B8%8A%E9%83%A8%E7%BD%B2%E6%99%BA%E8%83%BD%E5%BA%94%E7%94%A8/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51);color-scheme:dark}.list{background:var(--theme)}.toc{background:var(--entry)}}@media(prefers-color-scheme:light){.list::-webkit-scrollbar-thumb{border-color:var(--code-bg)}}</style></noscript><script>localStorage.getItem("pref-theme")==="dark"?document.querySelector("html").dataset.theme="dark":localStorage.getItem("pref-theme")==="light"?document.querySelector("html").dataset.theme="light":window.matchMedia("(prefers-color-scheme: dark)").matches?document.querySelector("html").dataset.theme="dark":document.querySelector("html").dataset.theme="light"</script><script src=/js/external-link-config.js></script><script src=/js/external-link-interceptor.js></script><link rel=stylesheet href=/blog/css/custom.css media=screen><script type=application/ld+json>{"@context":"https://schema.org","@type":"WebSite","name":"æŠ€æœ¯åšå®¢ - æœ‰æ¡å·¥å…· | å¼€å‘è€…å·¥å…·ä½¿ç”¨æ•™ç¨‹ & ç¼–ç¨‹æŠ€å·§åˆ†äº«","url":"https://www.util.cn/blog/","description":"æœ‰æ¡å·¥å…·æŠ€æœ¯åšå®¢ - åˆ†äº«å¼€å‘è€…å·¥å…·ä½¿ç”¨æ•™ç¨‹ã€ç¼–ç¨‹æŠ€å·§å’Œå®æˆ˜å¼€å‘ç»éªŒã€‚æä¾›JSONæ ¼å¼åŒ–ã€SQLä¼˜åŒ–ã€Markdownç¼–è¾‘å™¨ç­‰åœ¨çº¿å·¥å…·çš„è¯¦ç»†ä½¿ç”¨æŒ‡å—ï¼Œå¸®åŠ©å¼€å‘è€…æå‡å·¥ä½œæ•ˆç‡ã€‚","publisher":{"@type":"Organization","name":"æœ‰æ¡å·¥å…·","url":"https://www.util.cn","logo":{"@type":"ImageObject","url":"https://www.util.cn/blog/logo/logo-256.png","width":256,"height":256}},"potentialAction":[{"@type":"SearchAction","target":"https://www.util.cn/blog/search?q={search_term_string}","query-input":"required name=search_term_string"}]}</script><meta property="og:type" content="website"><meta property="og:title" content="æŠ€æœ¯åšå®¢ - æœ‰æ¡å·¥å…· | å¼€å‘è€…å·¥å…·ä½¿ç”¨æ•™ç¨‹ & ç¼–ç¨‹æŠ€å·§åˆ†äº«"><meta property="og:description" content="æœ‰æ¡å·¥å…·æŠ€æœ¯åšå®¢ - åˆ†äº«å¼€å‘è€…å·¥å…·ä½¿ç”¨æ•™ç¨‹ã€ç¼–ç¨‹æŠ€å·§å’Œå®æˆ˜å¼€å‘ç»éªŒã€‚æä¾›JSONæ ¼å¼åŒ–ã€SQLä¼˜åŒ–ã€Markdownç¼–è¾‘å™¨ç­‰åœ¨çº¿å·¥å…·çš„è¯¦ç»†ä½¿ç”¨æŒ‡å—ï¼Œå¸®åŠ©å¼€å‘è€…æå‡å·¥ä½œæ•ˆç‡ã€‚"><meta property="og:url" content="https://www.util.cn/blog/"><meta property="og:site_name" content="æœ‰æ¡å·¥å…·æŠ€æœ¯åšå®¢"><meta property="og:image" content="https://www.util.cn/blog/logo/logo-256.png"><meta property="og:image:width" content="1200"><meta property="og:image:height" content="630"><meta name=twitter:card content="summary_large_image"><meta name=twitter:title content="æŠ€æœ¯åšå®¢ - æœ‰æ¡å·¥å…· | å¼€å‘è€…å·¥å…·ä½¿ç”¨æ•™ç¨‹ & ç¼–ç¨‹æŠ€å·§åˆ†äº«"><meta name=twitter:description content="æœ‰æ¡å·¥å…·æŠ€æœ¯åšå®¢ - åˆ†äº«å¼€å‘è€…å·¥å…·ä½¿ç”¨æ•™ç¨‹ã€ç¼–ç¨‹æŠ€å·§å’Œå®æˆ˜å¼€å‘ç»éªŒã€‚"><meta name=twitter:image content="https://www.util.cn/blog/logo/logo-256.png"><meta name=baidu-site-verification content><meta name=category content="æŠ€æœ¯åšå®¢,å¼€å‘è€…å·¥å…·,ç¼–ç¨‹æ•™ç¨‹"><meta name=coverage content="Worldwide"><meta name=distribution content="Global"><meta name=rating content="General"><script id=51la_code async crossorigin=anonymous src="https://sdk.51.la/js-sdk-pro.min.js?id=3OM52V0xJAPv6ozF&hash=pro"></script><script>window.addEventListener("load",function(){setTimeout(function(){typeof la!="undefined"?console.log("51laç»Ÿè®¡å·²åŠ è½½"):(console.warn("51laç»Ÿè®¡åŠ è½½å¤±è´¥ï¼Œä½¿ç”¨å¤‡ç”¨æ–¹æ¡ˆ"),function(){var e=document.createElement("script");e.src="https://sdk.51.la/js-sdk-pro.min.js?id=3OM52V0xJAPv6ozF&hash=backup",e.async=!0,document.head.appendChild(e)}())},3e3)})</script><meta property="og:url" content="/blog/articles/edge-ai%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E5%9C%A8%E8%B5%84%E6%BA%90%E5%8F%97%E9%99%90%E8%AE%BE%E5%A4%87%E4%B8%8A%E9%83%A8%E7%BD%B2%E6%99%BA%E8%83%BD%E5%BA%94%E7%94%A8/"><meta property="og:site_name" content="æŠ€æœ¯åšå®¢ - æœ‰æ¡å·¥å…·"><meta property="og:title" content="Edge AIæ¶æ„è®¾è®¡ï¼šåœ¨èµ„æºå—é™è®¾å¤‡ä¸Šéƒ¨ç½²æ™ºèƒ½åº”ç”¨"><meta property="og:description" content="æ·±å…¥æ¢è®¨è¾¹ç¼˜AIæ¶æ„è®¾è®¡ï¼Œæ¶µç›–æ¨¡å‹å‹ç¼©ã€ç«¯äº‘ååŒæ¨ç†ã€è¾¹ç¼˜AIèŠ¯ç‰‡é€‰å‹ã€å®æ—¶æ€§ä¼˜åŒ–ç­‰æ ¸å¿ƒä¸»é¢˜ã€‚"><meta property="og:locale" content="zh-cn"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2025-12-31T11:00:00+08:00"><meta property="article:modified_time" content="2025-12-31T11:00:00+08:00"><meta property="article:tag" content="Edge AI"><meta property="article:tag" content="æ¨¡å‹å‹ç¼©"><meta property="article:tag" content="è¾¹ç¼˜è®¡ç®—"><meta property="article:tag" content="AIéƒ¨ç½²"><meta name=twitter:card content="summary"><meta name=twitter:title content="Edge AIæ¶æ„è®¾è®¡ï¼šåœ¨èµ„æºå—é™è®¾å¤‡ä¸Šéƒ¨ç½²æ™ºèƒ½åº”ç”¨"><meta name=twitter:description content="æ·±å…¥æ¢è®¨è¾¹ç¼˜AIæ¶æ„è®¾è®¡ï¼Œæ¶µç›–æ¨¡å‹å‹ç¼©ã€ç«¯äº‘ååŒæ¨ç†ã€è¾¹ç¼˜AIèŠ¯ç‰‡é€‰å‹ã€å®æ—¶æ€§ä¼˜åŒ–ç­‰æ ¸å¿ƒä¸»é¢˜ã€‚"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"æ‰€æœ‰æ–‡ç« ","item":"/blog/posts/"},{"@type":"ListItem","position":2,"name":"Edge AIæ¶æ„è®¾è®¡ï¼šåœ¨èµ„æºå—é™è®¾å¤‡ä¸Šéƒ¨ç½²æ™ºèƒ½åº”ç”¨","item":"/blog/articles/edge-ai%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E5%9C%A8%E8%B5%84%E6%BA%90%E5%8F%97%E9%99%90%E8%AE%BE%E5%A4%87%E4%B8%8A%E9%83%A8%E7%BD%B2%E6%99%BA%E8%83%BD%E5%BA%94%E7%94%A8/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Edge AIæ¶æ„è®¾è®¡ï¼šåœ¨èµ„æºå—é™è®¾å¤‡ä¸Šéƒ¨ç½²æ™ºèƒ½åº”ç”¨","name":"Edge AIæ¶æ„è®¾è®¡ï¼šåœ¨èµ„æºå—é™è®¾å¤‡ä¸Šéƒ¨ç½²æ™ºèƒ½åº”ç”¨","description":"æ·±å…¥æ¢è®¨è¾¹ç¼˜AIæ¶æ„è®¾è®¡ï¼Œæ¶µç›–æ¨¡å‹å‹ç¼©ã€ç«¯äº‘ååŒæ¨ç†ã€è¾¹ç¼˜AIèŠ¯ç‰‡é€‰å‹ã€å®æ—¶æ€§ä¼˜åŒ–ç­‰æ ¸å¿ƒä¸»é¢˜ã€‚","keywords":["Edge AI","è¾¹ç¼˜AIæ¶æ„","æ¨¡å‹é‡åŒ–","ç«¯äº‘ååŒ","TensorFlow Lite","è¾¹ç¼˜æ¨ç†"],"articleBody":"å¼•è¨€ éšç€AIèŠ¯ç‰‡çš„æ™®åŠå’Œæ¨¡å‹ä¼˜åŒ–æŠ€æœ¯çš„è¿›æ­¥ï¼Œ2025å¹´Edge AIè¿æ¥äº†çˆ†å‘å¼å¢é•¿ã€‚ä»æ™ºèƒ½æ‰‹æœºåˆ°å·¥ä¸šè®¾å¤‡ï¼Œæ™ºèƒ½æ­£åœ¨ä»äº‘ç«¯ä¸‹æ²‰åˆ°è¾¹ç¼˜ã€‚æœ¬æ–‡å°†æ·±å…¥æ¢è®¨Edge AIçš„æ¶æ„è®¾è®¡ï¼Œå¸®åŠ©å¼€å‘è€…åœ¨èµ„æºå—é™çš„è®¾å¤‡ä¸Šéƒ¨ç½²é«˜æ€§èƒ½AIåº”ç”¨ã€‚\nä¸€ã€Edge AIæŠ€æœ¯æ ˆ 1.1 æ¨¡å‹ä¼˜åŒ–æŠ€æœ¯ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 # æ¨¡å‹å‹ç¼©ä¸ä¼˜åŒ– import tensorflow as tf import tensorflow_model_optimization as tfmot from tensorflow.lite.python import converter import numpy as np class ModelOptimizer: \"\"\"è¾¹ç¼˜AIæ¨¡å‹ä¼˜åŒ–å™¨\"\"\" def __init__(self, model): self.original_model = model self.optimized_model = None def quantize_model(self, model, representative_data=None): \"\"\" æ¨¡å‹é‡åŒ–ï¼šå°†32ä½æµ®ç‚¹æ•°è½¬æ¢ä¸º8ä½æ•´æ•° - æ¨¡å‹å¤§å°å‡å°‘75% - æ¨ç†é€Ÿåº¦æå‡2-4å€ - ç²¾åº¦æŸå¤±é€šå¸¸\u003c1% \"\"\" if representative_data is None: # è®­ç»ƒåé‡åŒ–ï¼ˆæ— éœ€æ ¡å‡†æ•°æ®ï¼‰ converter = tf.lite.TFLiteConverter.from_keras_model(model) converter.optimizations = [tf.lite.Optimize.DEFAULT] else: # é‡åŒ–æ„ŸçŸ¥è®­ç»ƒï¼ˆéœ€è¦æ ¡å‡†æ•°æ®ï¼‰ def representative_dataset(): for data in representative_data: yield [data] converter = tf.lite.TFLiteConverter.from_keras_model(model) converter.optimizations = [tf.lite.Optimize.DEFAULT] converter.representative_dataset = representative_dataset converter.target_spec.supported_types = [tf.float16] # å¯é€‰ï¼šfloat16 tflite_model = converter.convert() return tflite_model def prune_model(self, model, pruning_params=None): \"\"\" æ¨¡å‹å‰ªæï¼šç§»é™¤ä¸é‡è¦çš„è¿æ¥ - å‡å°‘æ¨¡å‹å¤æ‚åº¦ - åŠ é€Ÿæ¨ç† - é˜²æ­¢è¿‡æ‹Ÿåˆ \"\"\" if pruning_params is None: pruning_params = { 'pruning_schedule': tfmot.sparsity.keras.PolynomialDecay( initial_sparsity=0.0, final_sparsity=0.5, # å‰ªæ50% begin_step=0, end_step=1000 ), 'block_size': (1, 1), # ç»“æ„åŒ–å‰ªæ } # åº”ç”¨å‰ªæ pruning_model = tfmot.sparsity.keras.prune_low_magnitude( model, **pruning_params ) # å¾®è°ƒå‰ªæåçš„æ¨¡å‹ pruning_model.compile( optimizer='adam', loss='sparse_categorical_crossentropy', metrics=['accuracy'] ) # pruning_model.fit(x_train, y_train, epochs=3) return pruning_model def distill_model(self, teacher_model, student_model, data): \"\"\" çŸ¥è¯†è’¸é¦ï¼šç”¨å¤§æ¨¡å‹è®­ç»ƒå°æ¨¡å‹ - ä¿ç•™å¤§æ¨¡å‹çš„çŸ¥è¯† - å¤§å¹…å‡å°æ¨¡å‹å¤§å° \"\"\" # æ¸©åº¦å‚æ•°ï¼šæ§åˆ¶è¾“å‡ºåˆ†å¸ƒçš„å¹³æ»‘åº¦ temperature = 3 # æ•™å¸ˆæ¨¡å‹çš„è½¯æ ‡ç­¾ teacher_logits = teacher_model.predict(data, verbose=0) # å­¦ç”Ÿæ¨¡å‹å­¦ä¹ è½¯æ ‡ç­¾å’Œç¡¬æ ‡ç­¾ def distillation_loss(y_true, y_pred): # è½¯æ ‡ç­¾æŸå¤± soft_loss = tf.keras.losses.KLDivergence()( tf.nn.softmax(teacher_logits / temperature), tf.nn.softmax(y_pred / temperature) ) # ç¡¬æ ‡ç­¾æŸå¤± hard_loss = tf.keras.losses.sparse_categorical_crossentropy( y_true, y_pred ) # åŠ æƒç»„åˆ return 0.7 * soft_loss * temperature ** 2 + 0.3 * hard_loss student_model.compile( optimizer='adam', loss=distillation_loss, metrics=['accuracy'] ) return student_model def optimize_for_hardware(self, tflite_model, target_hardware): \"\"\" é’ˆå¯¹ç‰¹å®šç¡¬ä»¶ä¼˜åŒ– \"\"\" # Edge TPUä¼˜åŒ– if target_hardware == 'edge_tpu': # Edge TPUåªæ”¯æŒ8ä½æ•´æ•°é‡åŒ– converter = tf.lite.TFLiteConverter.from_keras_model(self.original_model) converter.optimizations = [tf.lite.Optimize.DEFAULT] converter.target_spec.supported_ops = [tf.lite.OpsSet.TFLITE_BUILTINS_INT8] converter.inference_input_type = tf.uint8 converter.inference_output_type = tf.uint8 # GPUä¼˜åŒ– elif target_hardware == 'gpu': converter = tf.lite.TFLiteConverter.from_keras_model(self.original_model) converter.optimizations = [tf.lite.Optimize.DEFAULT] converter.target_spec.supported_types = [tf.float16] # é€šç”¨CPUä¼˜åŒ– else: converter = tf.lite.TFLiteConverter.from_keras_model(self.original_model) converter.optimizations = [tf.lite.Optimize.DEFAULT] return converter.convert() # å®é™…ä½¿ç”¨ç¤ºä¾‹ optimizer = ModelOptimizer(original_model) # 1. é‡åŒ–æ¨¡å‹ quantized_model = optimizer.quantize_model( original_model, representative_data=calibration_data ) # 2. ä¿å­˜æ¨¡å‹ with open('model_quant.tflite', 'wb') as f: f.write(quantized_model) # 3. æŸ¥çœ‹æ¨¡å‹å¤§å° import os original_size = os.path.getsize('model.h5') / (1024 * 1024) # MB quantized_size = os.path.getsize('model_quant.tflite') / (1024 * 1024) print(f\"åŸå§‹æ¨¡å‹: {original_size:.2f} MB\") print(f\"é‡åŒ–æ¨¡å‹: {quantized_size:.2f} MB\") print(f\"å‹ç¼©ç‡: {(1 - quantized_size / original_size) * 100:.1f}%\") 1.2 è¾¹ç¼˜æ¨ç†æ¡†æ¶ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 # TensorFlow Liteéƒ¨ç½² class TFLiteInferenceEngine: \"\"\"TensorFlow Liteæ¨ç†å¼•æ“\"\"\" def __init__(self, model_path, num_threads=4, use_gpu=False): import tflite_runtime.interpreter as tflite # åŠ è½½æ¨¡å‹ self.interpreter = tflite.Interpreter( model_path=model_model_path, num_threads=num_threads ) # åˆ†é…å¼ é‡ self.interpreter.allocate_tensors() # è·å–è¾“å…¥è¾“å‡ºè¯¦æƒ… self.input_details = self.interpreter.get_input_details() self.output_details = self.interpreter.get_output_details() # æ£€æŸ¥ç¡¬ä»¶åŠ é€Ÿ if use_gpu: self._enable_gpu_delegation() def _enable_gpu_delegation(self): \"\"\"å¯ç”¨GPUåŠ é€Ÿ\"\"\" import tflite_runtime.interpreter as tflite # GPUå§”æ‰˜ options = tflite.InterpreterOptions() options.add_delegate(\"TfLiteGpuDelegateV2\") self.interpreter = tflite.Interpreter( model_path=self.model_path, interpreter_options=options ) def predict(self, input_data): \"\"\"æ‰§è¡Œæ¨ç†\"\"\" # è®¾ç½®è¾“å…¥ input_index = self.input_details[0]['index'] self.interpreter.set_tensor(input_index, input_data) # æ‰§è¡Œæ¨ç† self.interpreter.invoke() # è·å–è¾“å‡º output_index = self.output_details[0]['index'] output_data = self.interpreter.get_tensor(output_index) return output_data def predict_batch(self, input_batch): \"\"\"æ‰¹é‡æ¨ç†\"\"\" results = [] for input_data in input_batch: result = self.predict(input_data) results.append(result) return np.array(results) # ONNX Runtimeéƒ¨ç½² class ONNXInferenceEngine: \"\"\"ONNX Runtimeæ¨ç†å¼•æ“\"\"\" def __init__(self, model_path, providers=None): import onnxruntime as ort if providers is None: # è‡ªåŠ¨é€‰æ‹©æœ€ä½³æ‰§è¡Œæä¾›è€… providers = ort.get_available_providers() self.session = ort.InferenceSession( model_path, providers=providers ) # è·å–è¾“å…¥è¾“å‡ºä¿¡æ¯ self.input_name = self.session.get_inputs()[0].name self.output_name = self.session.get_outputs()[0].name def predict(self, input_data): \"\"\"æ‰§è¡Œæ¨ç†\"\"\" result = self.session.run( [self.output_name], {self.input_name: input_data} ) return result[0] def get_model_info(self): \"\"\"è·å–æ¨¡å‹ä¿¡æ¯\"\"\" return { 'inputs': [{ 'name': input.name, 'shape': input.shape, 'type': input.type } for input in self.session.get_inputs() ], 'outputs': [{ 'name': output.name, 'shape': output.shape, 'type': output.type } for output in self.session.get_outputs() ], 'providers': self.session.get_providers() } # PyTorch Mobileéƒ¨ç½² class PyTorchMobileEngine: \"\"\"PyTorch Mobileæ¨ç†å¼•æ“\"\"\" def __init__(self, model_path): import torch import torch.jit as jit # åŠ è½½TorchScriptæ¨¡å‹ self.model = jit.load(model_path) self.model.eval() # ç§»åŠ¨åˆ°GPUï¼ˆå¦‚æœå¯ç”¨ï¼‰ if torch.cuda.is_available(): self.model = self.model.cuda() def predict(self, input_data): import torch # è½¬æ¢ä¸ºtensor if not isinstance(input_data, torch.Tensor): input_tensor = torch.tensor(input_data) else: input_tensor = input_data # ç§»åŠ¨åˆ°GPUï¼ˆå¦‚æœæ¨¡å‹åœ¨GPUï¼‰ if torch.cuda.is_available() and next(self.model.parameters()).is_cuda: input_tensor = input_tensor.cuda() # æ¨ç† with torch.no_grad(): output = self.model(input_tensor) # ç§»å›CPUå¹¶è½¬æ¢ä¸ºnumpy return output.cpu().numpy() äºŒã€ç«¯äº‘ååŒæ¶æ„ 2.1 ååŒæ¨ç†æ¨¡å¼ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 # ç«¯äº‘ååŒæ¨ç† class EdgeCloudCollaborativeInference: \"\"\"ç«¯äº‘ååŒæ¨ç†\"\"\" def __init__(self, edge_model, cloud_api): self.edge_model = edge_model # è½»é‡çº§è¾¹ç¼˜æ¨¡å‹ self.cloud_api = cloud_api # äº‘ç«¯API # é˜ˆå€¼é…ç½® self.confidence_threshold = 0.8 self.latency_threshold = 100 # ms self.bandwidth_threshold = 100 # KB/s async def predict(self, input_data): \"\"\"æ™ºèƒ½æ¨ç†å†³ç­–\"\"\" # å°è¯•è¾¹ç¼˜æ¨ç† edge_result = await self._edge_inference(input_data) # è¯„ä¼°è¾¹ç¼˜ç»“æœ if self._should_use_edge_result(edge_result): return edge_result else: # å›é€€åˆ°äº‘ç«¯ return await self._cloud_inference(input_data) async def _edge_inference(self, input_data): \"\"\"è¾¹ç¼˜æ¨ç†\"\"\" start_time = time.time() # æœ¬åœ°æ¨ç† result = self.edge_model.predict(input_data) latency = (time.time() - start_time) * 1000 # ms return { 'result': result, 'confidence': result.get('confidence', 0.5), 'latency': latency, 'source': 'edge' } async def _cloud_inference(self, input_data): \"\"\"äº‘ç«¯æ¨ç†\"\"\" start_time = time.time() # è°ƒç”¨äº‘ç«¯API cloud_result = await self.cloud_api.predict(input_data) latency = (time.time() - start_time) * 1000 # ms return { 'result': cloud_result, 'confidence': cloud_result.get('confidence', 0.9), 'latency': latency, 'source': 'cloud' } def _should_use_edge_result(self, edge_result): \"\"\"åˆ¤æ–­æ˜¯å¦ä½¿ç”¨è¾¹ç¼˜ç»“æœ\"\"\" # é«˜ç½®ä¿¡åº¦ï¼šä½¿ç”¨è¾¹ç¼˜ç»“æœ if edge_result['confidence'] \u003e= self.confidence_threshold: return True # ä½å»¶è¿Ÿè¦æ±‚ï¼šä½¿ç”¨è¾¹ç¼˜ç»“æœ if edge_result['latency'] \u003c= self.latency_threshold: return True # ä½å¸¦å®½ç¯å¢ƒï¼šä½¿ç”¨è¾¹ç¼˜ç»“æœ if self._get_bandwidth() \u003c self.bandwidth_threshold: return True return False def _get_bandwidth(self): \"\"\"è·å–å½“å‰å¸¦å®½\"\"\" # ç®€åŒ–å®ç° return 1000 # KB/s # 2. åˆ†å±‚æ¨ç†æ¨¡å‹ class HierarchicalInference: \"\"\"åˆ†å±‚æ¨ç†ï¼šè¾¹ç¼˜é¢„ç­›é€‰+äº‘ç«¯ç²¾ç»†å¤„ç†\"\"\" def __init__(self, edge_filter, cloud_processor): self.edge_filter = edge_filter # è½»é‡çº§è¿‡æ»¤å™¨ self.cloud_processor = cloud_processor # é‡é‡çº§å¤„ç†å™¨ async def process(self, input_data): \"\"\"åˆ†å±‚å¤„ç†\"\"\" # ç¬¬ä¸€å±‚ï¼šè¾¹ç¼˜å¿«é€Ÿè¿‡æ»¤ filter_result = await self._filter_on_edge(input_data) if filter_result['is_simple']: # ç®€å•æ¡ˆä¾‹ï¼šç›´æ¥è¿”å› return filter_result['result'] else: # å¤æ‚æ¡ˆä¾‹ï¼šäº‘ç«¯æ·±åº¦å¤„ç† return await self._process_on_cloud(input_data, filter_result) async def _filter_on_edge(self, input_data): \"\"\"è¾¹ç¼˜è¿‡æ»¤\"\"\" # å¿«é€Ÿåˆ†ç±» category = self.edge_filter.predict(input_data) return { 'is_simple': category == 'simple', 'result': category, 'confidence': 0.9 } async def _process_on_cloud(self, input_data, filter_result): \"\"\"äº‘ç«¯æ·±åº¦å¤„ç†\"\"\" # å°†è¾¹ç¼˜è¿‡æ»¤ç»“æœä¼ é€’ç»™äº‘ç«¯ cloud_result = await self.cloud_processor.process( input_data, context=filter_result ) return cloud_result # 3. å¢é‡å­¦ä¹ æ¶æ„ class IncrementalLearningEdge: \"\"\"è¾¹ç¼˜å¢é‡å­¦ä¹ \"\"\" def __init__(self, base_model): self.base_model = base_model self.local_adaptations = {} async def predict_with_adaptation(self, input_data, user_id): \"\"\"å¸¦æœ¬åœ°é€‚é…çš„é¢„æµ‹\"\"\" # æ£€æŸ¥æ˜¯å¦æœ‰ç”¨æˆ·ç‰¹å®šé€‚é… if user_id in self.local_adaptations: adapted_model = self.local_adaptations[user_id] result = adapted_model.predict(input_data) else: result = self.base_model.predict(input_data) return result async def update_local_model(self, user_id, new_data): \"\"\"æ›´æ–°æœ¬åœ°æ¨¡å‹\"\"\" # åŸºäºæ–°æ•°æ®å¾®è°ƒæ¨¡å‹ adapted_model = self._fine_tune_model( self.base_model, new_data ) self.local_adaptations[user_id] = adapted_model # å®šæœŸåŒæ­¥åˆ°äº‘ç«¯ await self._sync_to_cloud(user_id, adapted_model) def _fine_tune_model(self, base_model, data): \"\"\"å¾®è°ƒæ¨¡å‹\"\"\" # ç®€åŒ–å®ç°ï¼šè¿ç§»å­¦ä¹  # å®é™…åº”ä½¿ç”¨æ›´å¤æ‚çš„å¾®è°ƒç­–ç•¥ return base_model # è¿”å›é€‚é…åçš„æ¨¡å‹ 2.2 ç¦»çº¿æ¨ç†æ¶æ„ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 # ç¦»çº¿AIæ¨ç† class OfflineInferenceEngine: \"\"\"ç¦»çº¿æ¨ç†å¼•æ“\"\"\" def __init__(self, model_path, cache_size=100): self.model = self._load_model(model_path) self.cache = LRUCache(cache_size) self.offline_models = {} def _load_model(self, model_path): \"\"\"åŠ è½½æ¨¡å‹\"\"\" # TFLiteåŠ è½½ import tflite_runtime.interpreter as tflite return tflite.Interpreter(model_path=model_path) async def predict(self, input_data, model_version='default'): \"\"\"ç¦»çº¿é¢„æµ‹\"\"\" # æ£€æŸ¥ç¼“å­˜ cache_key = self._generate_cache_key(input_data) cached_result = self.cache.get(cache_key) if cached_result: return cached_result # æ‰§è¡Œæ¨ç† result = self._do_inference(input_data, model_version) # ç¼“å­˜ç»“æœ self.cache.put(cache_key, result) return result def _do_inference(self, input_data, model_version): \"\"\"æ‰§è¡Œæ¨ç†\"\"\" # ä½¿ç”¨æŒ‡å®šç‰ˆæœ¬æ¨¡å‹ if model_version != 'default': model = self.offline_models.get(model_version) if model: return model.predict(input_data) # ä½¿ç”¨é»˜è®¤æ¨¡å‹ return self._predict_with_model(self.model, input_data) def download_model(self, model_url, version): \"\"\"ä¸‹è½½æ¨¡å‹åˆ°æœ¬åœ°\"\"\" # ä¸‹è½½æ¨¡å‹æ–‡ä»¶ model_data = self._download_from_url(model_url) # ä¿å­˜åˆ°æœ¬åœ° model_path = f\"/models/{version}.tflite\" with open(model_path, 'wb') as f: f.write(model_data) # åŠ è½½æ¨¡å‹ import tflite_runtime.interpreter as tflite model = tflite.Interpreter(model_path=model_path) self.offline_models[version] = model return model def update_model(self, new_version): \"\"\"æ›´æ–°æ¨¡å‹\"\"\" # æ£€æŸ¥ç½‘ç»œè¿æ¥ if not self._is_online(): raise Exception(\"Offline: Cannot update model\") # ä¸‹è½½æ–°ç‰ˆæœ¬ model_url = f\"https://api.example.com/models/{new_version}.tflite\" self.download_model(model_url, new_version) # è®¾ç½®ä¸ºé»˜è®¤ç‰ˆæœ¬ self.model = self.offline_models[new_version] def _is_online(self): \"\"\"æ£€æŸ¥ç½‘ç»œè¿æ¥\"\"\" import socket try: socket.create_connection((\"8.8.8.8\", 53), timeout=3) return True except OSError: return False class LRUCache: \"\"\"LRUç¼“å­˜\"\"\" def __init__(self, size): self.size = size self.cache = {} self.order = [] def get(self, key): if key in self.cache: # æ›´æ–°è®¿é—®é¡ºåº self.order.remove(key) self.order.append(key) return self.cache[key] return None def put(self, key, value): if key in self.cache: self.order.remove(key) elif len(self.cache) \u003e= self.size: # ç§»é™¤æœ€æ—§çš„é¡¹ oldest = self.order.pop(0) del self.cache[oldest] self.cache[key] = value self.order.append(key) ä¸‰ã€å®æ—¶æ€§ä¸èƒ½æ•ˆä¼˜åŒ– 3.1 å®æ—¶æ€§ä¼˜åŒ– 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 # å®æ—¶AIæ¨ç†ä¼˜åŒ– class RealtimeInferenceOptimizer: \"\"\"å®æ—¶æ¨ç†ä¼˜åŒ–å™¨\"\"\" def __init__(self, model): self.model = model self.input_queue = queue.Queue(maxsize=10) self.output_queue = queue.Queue(maxsize=10) async def start_inference_thread(self): \"\"\"å¯åŠ¨æ¨ç†çº¿ç¨‹\"\"\" import threading thread = threading.Thread(target=self._inference_loop) thread.daemon = True thread.start() def _inference_loop(self): \"\"\"æ¨ç†å¾ªç¯\"\"\" while True: try: # ä»é˜Ÿåˆ—è·å–è¾“å…¥ input_data = self.input_queue.get(timeout=1.0) # æ‰§è¡Œæ¨ç† result = self.model.predict(input_data) # æ”¾å…¥è¾“å‡ºé˜Ÿåˆ— self.output_queue.put(result) except queue.Empty: continue async def predict_async(self, input_data): \"\"\"å¼‚æ­¥æ¨ç†\"\"\" # éé˜»å¡æäº¤ try: self.input_queue.put_nowait(input_data) except queue.Full: raise Exception(\"Inference queue full\") # ç­‰å¾…ç»“æœï¼ˆå¸¦è¶…æ—¶ï¼‰ try: result = self.output_queue.get(timeout=0.1) return result except queue.Empty: raise Exception(\"Inference timeout\") # 2. æ¨¡å‹åˆ†ç‰‡ class ModelSharding: \"\"\"æ¨¡å‹åˆ†ç‰‡ï¼šå°†å¤§æ¨¡å‹æ‹†åˆ†ä¸ºå°æ¨¡å—\"\"\" def __init__(self, model_config): self.shards = {} self._create_shards(model_config) def _create_shards(self, config): \"\"\"åˆ›å»ºæ¨¡å‹åˆ†ç‰‡\"\"\" for shard_name, shard_config in config['shards'].items(): self.shards[shard_name] = self._load_shard(shard_config) def _load_shard(self, config): \"\"\"åŠ è½½æ¨¡å‹åˆ†ç‰‡\"\"\" # åŠ è½½è½»é‡çº§åˆ†ç‰‡æ¨¡å‹ return load_model(config['path']) def predict_sharded(self, input_data, shard_order): \"\"\"åˆ†ç‰‡æ¨ç†\"\"\" current_data = input_data for shard_name in shard_order: shard = self.shards[shard_name] current_data = shard.predict(current_data) return current_data # 3. æ—©æœŸé€€å‡º class EarlyExitInference: \"\"\"æ—©æœŸé€€å‡ºæ¨ç†\"\"\" def __init__(self, model): self.model = model self.exit_thresholds = [0.95, 0.8, 0.6] def predict_with_early_exit(self, input_data): \"\"\"å¸¦æ—©æœŸé€€å‡ºçš„é¢„æµ‹\"\"\" # ç¬¬ä¸€å±‚ï¼šå¿«é€Ÿåˆ†ç±» result = self.model.predict_layer1(input_data) confidence = result['confidence'] if confidence \u003e self.exit_thresholds[0]: return result # ç¬¬äºŒå±‚ï¼šç²¾ç»†åˆ†ç±» result = self.model.predict_layer2(input_data) confidence = result['confidence'] if confidence \u003e self.exit_thresholds[1]: return result # ç¬¬ä¸‰å±‚ï¼šå®Œæ•´æ¨ç† result = self.model.predict_full(input_data) return result 3.2 èƒ½æ•ˆä¼˜åŒ– 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 # èƒ½æ•ˆä¼˜åŒ–ç­–ç•¥ class PowerOptimizedInference: \"\"\"åŠŸè€—ä¼˜åŒ–æ¨ç†\"\"\" def __init__(self, model): self.model = model self.power_modes = ['high_performance', 'balanced', 'power_saver'] self.current_mode = 'balanced' def set_power_mode(self, mode): \"\"\"è®¾ç½®åŠŸè€—æ¨¡å¼\"\"\" if mode not in self.power_modes: raise ValueError(f\"Invalid power mode: {mode}\") self.current_mode = mode # è°ƒæ•´æ¨ç†å‚æ•° if mode == 'high_performance': self.threads = 4 self.precision = 'float32' elif mode == 'balanced': self.threads = 2 self.precision = 'float16' else: # power_saver self.threads = 1 self.precision = 'int8' def predict(self, input_data): \"\"\"æ ¹æ®åŠŸè€—æ¨¡å¼æ¨ç†\"\"\" if self.current_mode == 'power_saver': # é™ä½é¢‘ç‡ self._throttle_inference() result = self._do_inference(input_data) self._restore_inference() else: result = self._do_inference(input_data) return result def _throttle_inference(self): \"\"\"é™åˆ¶æ¨ç†æ€§èƒ½\"\"\" # é™ä½CPUé¢‘ç‡ç­‰ pass def _restore_inference(self): \"\"\"æ¢å¤æ¨ç†æ€§èƒ½\"\"\" pass # 2. æ‰¹å¤„ç†ä¼˜åŒ– class BatchOptimizer: \"\"\"æ‰¹å¤„ç†ä¼˜åŒ–\"\"\" def __init__(self, model, max_batch_size=8, max_wait_time=50): self.model = model self.max_batch_size = max_batch_size self.max_wait_time = max_wait_time # ms self.pending_requests = [] self.last_batch_time = time.time() async def predict(self, input_data): \"\"\"æ‰¹å¤„ç†æ¨ç†\"\"\" # æ·»åŠ åˆ°å¾…å¤„ç†é˜Ÿåˆ— future = asyncio.Future() self.pending_requests.append({ 'input': input_data, 'future': future }) # æ£€æŸ¥æ˜¯å¦åº”è¯¥æ‰§è¡Œæ‰¹å¤„ç† if self._should_process_batch(): await self._process_batch() return await future def _should_process_batch(self): \"\"\"åˆ¤æ–­æ˜¯å¦åº”è¯¥å¤„ç†æ‰¹æ¬¡\"\"\" # è¾¾åˆ°æœ€å¤§æ‰¹å¤§å° if len(self.pending_requests) \u003e= self.max_batch_size: return True # è¶…è¿‡æœ€å¤§ç­‰å¾…æ—¶é—´ elapsed = (time.time() - self.last_batch_time) * 1000 if elapsed \u003e= self.max_wait_time: return True return False async def _process_batch(self): \"\"\"å¤„ç†æ‰¹æ¬¡\"\"\" if not self.pending_requests: return # å‡†å¤‡æ‰¹æ¬¡æ•°æ® batch_inputs = [req['input'] for req in self.pending_requests] # æ‰¹é‡æ¨ç† batch_results = await self._batch_predict(batch_inputs) # è¿”å›ç»“æœ for i, req in enumerate(self.pending_requests): req['future'].set_result(batch_results[i]) # æ¸…ç©ºé˜Ÿåˆ— self.pending_requests = [] self.last_batch_time = time.time() async def _batch_predict(self, batch_inputs): \"\"\"æ‰¹é‡é¢„æµ‹\"\"\" # å †å ä¸ºæ‰¹æ¬¡tensor batch_tensor = np.stack(batch_inputs) # æ¨ç† batch_results = self.model.predict(batch_tensor) return batch_results å››ã€å®é™…åº”ç”¨æ¡ˆä¾‹ 4.1 æ™ºèƒ½ç›¸æœºåº”ç”¨ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 # æ™ºèƒ½ç›¸æœºï¼šè¾¹ç¼˜AIå®æ—¶å›¾åƒå¤„ç† class SmartCameraApp: \"\"\"æ™ºèƒ½ç›¸æœºåº”ç”¨\"\"\" def __init__(self): # åŠ è½½å¤šä¸ªæ¨¡å‹ self.face_detector = self._load_model('face_detector.tflite') self.face_recognizer = self._load_model('face_recognizer.tflite') self.scene_classifier = self._load_model('scene_classifier.tflite') self.image_enhancer = self._load_model('image_enhancer.tflite') async def process_camera_frame(self, frame): \"\"\"å¤„ç†ç›¸æœºå¸§\"\"\" # 1. åœºæ™¯æ£€æµ‹ï¼ˆå¿«é€Ÿï¼‰ scene = self.scene_classifier.predict(frame) # 2. æ ¹æ®åœºæ™¯é€‰æ‹©å¤„ç†æµç¨‹ if scene['class'] == 'portrait': return await self._process_portrait(frame) elif scene['class'] == 'landscape': return await self._process_landscape(frame) elif scene['class'] == 'night': return await self._process_night_scene(frame) else: return await self._process_default(frame) async def _process_portrait(self, frame): \"\"\"å¤„ç†äººåƒåœºæ™¯\"\"\" # æ£€æµ‹äººè„¸ faces = self.face_detector.predict(frame) if faces: # è¯†åˆ«äººè„¸ identities = self.face_recognizer.predict(frame, faces) # ç¾é¢œå¤„ç† enhanced_frame = self.image_enhancer.enance_portrait(frame, faces) return { 'frame': enhanced_frame, 'faces': faces, 'identities': identities, 'effects': ['beautify', 'smooth'] } return {'frame': frame, 'faces': []} async def _process_night_scene(self, frame): \"\"\"å¤„ç†å¤œæ™¯\"\"\" # å¤œæ™¯å¢å¼º enhanced_frame = self.image_enhancer.enforce_night(frame) return { 'frame': enhanced_frame, 'effects': ['night_mode', 'denoise'] } # å®æ—¶æ€§èƒ½ç›‘æ§ class PerformanceMonitor: \"\"\"æ€§èƒ½ç›‘æ§\"\"\" def __init__(self): self.fps_history = [] self.latency_history = [] def measure_inference(self, inference_fn): \"\"\"æµ‹é‡æ¨ç†æ€§èƒ½\"\"\" start_time = time.time() result = inference_fn() end_time = time.time() latency = (end_time - start_time) * 1000 # ms self.latency_history.append(latency) # ä¿æŒæœ€è¿‘100ä¸ªæ ·æœ¬ if len(self.latency_history) \u003e 100: self.latency_history.pop(0) return result def get_stats(self): \"\"\"è·å–ç»Ÿè®¡ä¿¡æ¯\"\"\" if not self.latency_history: return {} import numpy as np return { 'avg_latency': np.mean(self.latency_history), 'p50_latency': np.percentile(self.latency_history, 50), 'p95_latency': np.percentile(self.latency_history, 95), 'p99_latency': np.percentile(self.latency_history, 99), 'max_latency': np.max(self.latency_history), 'fps': 1000 / np.mean(self.latency_history) } æ€»ç»“ Edge AIåœ¨2025å¹´å®ç°äº†ä»æ¦‚å¿µåˆ°å•†ç”¨çš„è·¨è¶Šã€‚2026å¹´ï¼Œéšç€ç¡¬ä»¶èƒ½åŠ›çš„æå‡å’Œä¼˜åŒ–æŠ€æœ¯çš„æˆç†Ÿï¼ŒEdge AIå°†åœ¨æ›´å¤šåœºæ™¯ä¸­æ›¿ä»£äº‘ç«¯AIã€‚\nå¼€å‘å»ºè®®ï¼š\nä¼˜å…ˆè€ƒè™‘æ¨¡å‹ä¼˜åŒ–ï¼ˆé‡åŒ–ã€å‰ªæï¼‰ åˆç†è®¾è®¡ç«¯äº‘ååŒæ¶æ„ å…³æ³¨å®æ—¶æ€§å’ŒåŠŸè€—å¹³è¡¡ æŒç»­ç›‘æ§å’Œä¼˜åŒ–æ€§èƒ½ å­¦ä¹ è·¯å¾„ï¼š\næŒæ¡æ¨¡å‹å‹ç¼©æŠ€æœ¯ å­¦ä¹ è¾¹ç¼˜æ¨ç†æ¡†æ¶ ç†è§£ç«¯äº‘ååŒæ¨¡å¼ å®é™…é¡¹ç›®æ¼”ç»ƒ ç›¸å…³å·¥å…·æ¨è\nBase64ç¼–ç å·¥å…· - ç¼–ç è½¬æ¢ å›¾ç‰‡å¤„ç†å·¥å…· - å›¾åƒå¤„ç† ","wordCount":"2716","inLanguage":"zh-cn","datePublished":"2025-12-31T11:00:00+08:00","dateModified":"2025-12-31T11:00:00+08:00","author":{"@type":"Person","name":"æœ‰æ¡å·¥å…·å›¢é˜Ÿ"},"mainEntityOfPage":{"@type":"WebPage","@id":"/blog/articles/edge-ai%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E5%9C%A8%E8%B5%84%E6%BA%90%E5%8F%97%E9%99%90%E8%AE%BE%E5%A4%87%E4%B8%8A%E9%83%A8%E7%BD%B2%E6%99%BA%E8%83%BD%E5%BA%94%E7%94%A8/"},"publisher":{"@type":"Organization","name":"æŠ€æœ¯åšå®¢ - æœ‰æ¡å·¥å…·","logo":{"@type":"ImageObject","url":"/favicon.ico"}}}</script></head><body id=top><header class=header><nav class=nav><div class=logo><a href=/blog/ accesskey=h title="æŠ€æœ¯åšå®¢ - æœ‰æ¡å·¥å…· (Alt + H)">æŠ€æœ¯åšå®¢ - æœ‰æ¡å·¥å…·</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=/blog/posts/ title="æ‰€æœ‰æ–‡ç« åˆ—è¡¨ - æœ‰æ¡å·¥å…·æŠ€æœ¯åšå®¢ï¼šæŸ¥çœ‹æ‰€æœ‰æŠ€æœ¯æ–‡ç« å’Œæ•™ç¨‹å†…å®¹"><span>æ–‡ç« </span></a></li><li><a href=https://www.util.cn title="æœ‰æ¡å·¥å…· - å¼€å‘è€…çš„å¸¸ç”¨å·¥å…·é›†åˆï¼šæ— å¹¿å‘Š Â· æœ¬åœ°è®¡ç®— Â· å³å¼€å³ç”¨çš„åœ¨çº¿å·¥å…·å¹³å°ï¼Œæä¾›JSONæ ¼å¼åŒ–ã€SQLæ ¼å¼åŒ–ã€Markdownç¼–è¾‘å™¨ç­‰å®ç”¨å·¥å…·"><span>æœ‰æ¡å·¥å…·</span>&nbsp;
<svg fill="none" shape-rendering="geometricPrecision" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" height="12" width="12"><path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"/><path d="M15 3h6v6"/><path d="M10 14 21 3"/></svg></a></li><li><a href=/blog/categories/ title="æ–‡ç« åˆ†ç±» - æœ‰æ¡å·¥å…·æŠ€æœ¯åšå®¢ï¼šæŒ‰æŠ€æœ¯é¢†åŸŸåˆ†ç±»çš„ä¼˜è´¨æ–‡ç« ï¼ŒåŒ…æ‹¬å‰ç«¯å¼€å‘ã€å·¥å…·ä½¿ç”¨ã€ç¼–ç¨‹æŠ€å·§ç­‰"><span>åˆ†ç±»</span></a></li><li><a href=/blog/tags/ title="æ ‡ç­¾äº‘ - æœ‰æ¡å·¥å…·æŠ€æœ¯åšå®¢ï¼šé€šè¿‡æ ‡ç­¾å¿«é€Ÿæ‰¾åˆ°æ„Ÿå…´è¶£çš„æŠ€æœ¯æ–‡ç« å’Œæ•™ç¨‹å†…å®¹"><span>æ ‡ç­¾</span></a></li><li><a href=/blog/archives/ title="æ–‡ç« å½’æ¡£ - æœ‰æ¡å·¥å…·æŠ€æœ¯åšå®¢ï¼šæŒ‰æ—¶é—´æŸ¥çœ‹å†å²æ–‡ç« "><span>å½’æ¡£</span></a></li><li><a href=/blog/search/ title="æœç´¢æ–‡ç«  - æœ‰æ¡å·¥å…·æŠ€æœ¯åšå®¢ï¼šé€šè¿‡å…³é”®è¯æœç´¢æ‰¾åˆ°æ„Ÿå…´è¶£çš„æŠ€æœ¯æ–‡ç« å’Œæ•™ç¨‹å†…å®¹ï¼Œæ”¯æŒæ ‡é¢˜ã€å†…å®¹ã€åˆ†ç±»å’Œæ ‡ç­¾æœç´¢"><span>æœç´¢</span></a></li></ul></nav></header><main class=main><article class=post-single><div class=post-content-wrapper><main class=post-content-main><header class=post-header-main><h1 class="post-title entry-hint-parent">Edge AIæ¶æ„è®¾è®¡ï¼šåœ¨èµ„æºå—é™è®¾å¤‡ä¸Šéƒ¨ç½²æ™ºèƒ½åº”ç”¨</h1><div class=post-description>æ·±å…¥æ¢è®¨è¾¹ç¼˜AIæ¶æ„è®¾è®¡ï¼Œæ¶µç›–æ¨¡å‹å‹ç¼©ã€ç«¯äº‘ååŒæ¨ç†ã€è¾¹ç¼˜AIèŠ¯ç‰‡é€‰å‹ã€å®æ—¶æ€§ä¼˜åŒ–ç­‰æ ¸å¿ƒä¸»é¢˜ã€‚</div><div class=post-meta><div class=post-meta-content><div class=post-categories-inline><a href=/blog/categories/ai/ class=category-link>AI</a><a href=/blog/categories/%E8%BE%B9%E7%BC%98%E8%AE%A1%E7%AE%97/ class=category-link>è¾¹ç¼˜è®¡ç®—</a></div><span class=post-date>2025-12-31</span><span class=post-author>æœ‰æ¡å·¥å…·å›¢é˜Ÿ</span></div><style>.post-meta-content{display:flex;align-items:center;flex-wrap:wrap;gap:.75rem;font-family:sf mono,monaco,courier new,monospace;font-size:.875rem;color:#9ca3af !important}.post-categories-inline{display:inline-flex;align-items:center;gap:.5rem}.category-link{display:inline-flex;align-items:center;gap:.25rem;padding:.25rem .75rem;background:rgba(255,255,255,.1);color:#e5e7eb !important;text-decoration:none;font-size:.75rem;font-weight:600;text-transform:uppercase;letter-spacing:.05em;border:1px solid rgba(255,255,255,.2);border-radius:0;transition:all .3s ease;white-space:nowrap}.category-link:hover{background:rgba(255,255,255,.2);color:#fff !important;border-color:rgba(255,255,255,.3);transform:translateY(-1px)}.category-link::before{content:'ğŸ“';font-size:.7rem;opacity:.8}.post-date,.post-reading-time,.post-word-count,.post-author{color:#9ca3af !important}[data-theme=dark] .post-meta-content{color:#9ca3af !important}[data-theme=dark] .category-link{background:rgba(255,255,255,.1);color:#e5e7eb !important;border-color:rgba(255,255,255,.2)}[data-theme=dark] .category-link:hover{background:rgba(255,255,255,.2);color:#fff !important;border-color:rgba(255,255,255,.3)}[data-theme=dark] .post-date,[data-theme=dark] .post-reading-time,[data-theme=dark] .post-word-count,[data-theme=dark] .post-author{color:#9ca3af !important}[data-theme=light] .post-meta-content{color:#6c757d !important}[data-theme=light] .category-link{background:rgba(0,0,0,5%);color:#495057 !important;border-color:rgba(0,0,0,.15)}[data-theme=light] .category-link:hover{background:rgba(0,102,204,.1);color:#212529 !important;border-color:rgba(0,102,204,.3)}[data-theme=light] .post-date,[data-theme=light] .post-reading-time,[data-theme=light] .post-word-count,[data-theme=light] .post-author{color:#6c757d !important}@media(max-width:768px){.post-meta-content{gap:.5rem;font-size:.8rem}.category-link{padding:.2rem .6rem;font-size:.7rem}}</style></div></header><div class=post-content><h2 id=å¼•è¨€>å¼•è¨€<a hidden class=anchor aria-hidden=true href=#å¼•è¨€>#</a></h2><p>éšç€AIèŠ¯ç‰‡çš„æ™®åŠå’Œæ¨¡å‹ä¼˜åŒ–æŠ€æœ¯çš„è¿›æ­¥ï¼Œ2025å¹´Edge AIè¿æ¥äº†çˆ†å‘å¼å¢é•¿ã€‚ä»æ™ºèƒ½æ‰‹æœºåˆ°å·¥ä¸šè®¾å¤‡ï¼Œæ™ºèƒ½æ­£åœ¨ä»äº‘ç«¯ä¸‹æ²‰åˆ°è¾¹ç¼˜ã€‚æœ¬æ–‡å°†æ·±å…¥æ¢è®¨Edge AIçš„æ¶æ„è®¾è®¡ï¼Œå¸®åŠ©å¼€å‘è€…åœ¨èµ„æºå—é™çš„è®¾å¤‡ä¸Šéƒ¨ç½²é«˜æ€§èƒ½AIåº”ç”¨ã€‚</p><h2 id=ä¸€edge-aiæŠ€æœ¯æ ˆ>ä¸€ã€Edge AIæŠ€æœ¯æ ˆ<a hidden class=anchor aria-hidden=true href=#ä¸€edge-aiæŠ€æœ¯æ ˆ>#</a></h2><h3 id=11-æ¨¡å‹ä¼˜åŒ–æŠ€æœ¯>1.1 æ¨¡å‹ä¼˜åŒ–æŠ€æœ¯<a hidden class=anchor aria-hidden=true href=#11-æ¨¡å‹ä¼˜åŒ–æŠ€æœ¯>#</a></h3><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 56
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 57
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 58
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 59
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 60
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 61
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 62
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 63
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 64
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 65
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 66
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 67
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 68
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 69
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 70
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 71
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 72
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 73
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 74
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 75
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 76
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 77
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 78
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 79
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 80
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 81
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 82
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 83
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 84
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 85
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 86
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 87
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 88
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 89
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 90
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 91
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 92
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 93
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 94
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 95
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 96
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 97
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 98
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 99
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">100
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">101
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">102
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">103
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">104
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">105
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">106
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">107
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">108
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">109
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">110
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">111
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">112
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">113
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">114
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">115
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">116
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">117
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">118
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">119
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">120
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">121
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">122
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">123
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">124
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">125
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">126
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">127
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">128
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">129
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">130
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">131
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">132
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">133
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">134
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">135
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">136
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">137
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">138
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">139
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">140
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">141
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">142
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">143
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">144
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">145
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">146
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">147
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">148
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">149
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">150
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">151
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">152
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">153
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">154
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">155
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">156
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">157
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">158
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">159
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">160
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">161
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">162
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">163
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#8b949e;font-style:italic># æ¨¡å‹å‹ç¼©ä¸ä¼˜åŒ–</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>import</span> <span style=color:#ff7b72>tensorflow</span> <span style=color:#ff7b72>as</span> <span style=color:#ff7b72>tf</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>import</span> <span style=color:#ff7b72>tensorflow_model_optimization</span> <span style=color:#ff7b72>as</span> <span style=color:#ff7b72>tfmot</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>from</span> <span style=color:#ff7b72>tensorflow.lite.python</span> <span style=color:#ff7b72>import</span> converter
</span></span><span style=display:flex><span><span style=color:#ff7b72>import</span> <span style=color:#ff7b72>numpy</span> <span style=color:#ff7b72>as</span> <span style=color:#ff7b72>np</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>class</span> <span style=color:#f0883e;font-weight:700>ModelOptimizer</span>:
</span></span><span style=display:flex><span>    <span style=color:#a5d6ff>&#34;&#34;&#34;è¾¹ç¼˜AIæ¨¡å‹ä¼˜åŒ–å™¨&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>__init__</span>(self, model):
</span></span><span style=display:flex><span>        self<span style=color:#ff7b72;font-weight:700>.</span>original_model <span style=color:#ff7b72;font-weight:700>=</span> model
</span></span><span style=display:flex><span>        self<span style=color:#ff7b72;font-weight:700>.</span>optimized_model <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#79c0ff>None</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>quantize_model</span>(self, model, representative_data<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#79c0ff>None</span>):
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;&#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>        æ¨¡å‹é‡åŒ–ï¼šå°†32ä½æµ®ç‚¹æ•°è½¬æ¢ä¸º8ä½æ•´æ•°
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>        - æ¨¡å‹å¤§å°å‡å°‘75%
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>        - æ¨ç†é€Ÿåº¦æå‡2-4å€
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>        - ç²¾åº¦æŸå¤±é€šå¸¸&lt;1%
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>        &#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>if</span> representative_data <span style=color:#ff7b72;font-weight:700>is</span> <span style=color:#79c0ff>None</span>:
</span></span><span style=display:flex><span>            <span style=color:#8b949e;font-style:italic># è®­ç»ƒåé‡åŒ–ï¼ˆæ— éœ€æ ¡å‡†æ•°æ®ï¼‰</span>
</span></span><span style=display:flex><span>            converter <span style=color:#ff7b72;font-weight:700>=</span> tf<span style=color:#ff7b72;font-weight:700>.</span>lite<span style=color:#ff7b72;font-weight:700>.</span>TFLiteConverter<span style=color:#ff7b72;font-weight:700>.</span>from_keras_model(model)
</span></span><span style=display:flex><span>            converter<span style=color:#ff7b72;font-weight:700>.</span>optimizations <span style=color:#ff7b72;font-weight:700>=</span> [tf<span style=color:#ff7b72;font-weight:700>.</span>lite<span style=color:#ff7b72;font-weight:700>.</span>Optimize<span style=color:#ff7b72;font-weight:700>.</span>DEFAULT]
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>else</span>:
</span></span><span style=display:flex><span>            <span style=color:#8b949e;font-style:italic># é‡åŒ–æ„ŸçŸ¥è®­ç»ƒï¼ˆéœ€è¦æ ¡å‡†æ•°æ®ï¼‰</span>
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>representative_dataset</span>():
</span></span><span style=display:flex><span>                <span style=color:#ff7b72>for</span> data <span style=color:#ff7b72;font-weight:700>in</span> representative_data:
</span></span><span style=display:flex><span>                    <span style=color:#ff7b72>yield</span> [data]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            converter <span style=color:#ff7b72;font-weight:700>=</span> tf<span style=color:#ff7b72;font-weight:700>.</span>lite<span style=color:#ff7b72;font-weight:700>.</span>TFLiteConverter<span style=color:#ff7b72;font-weight:700>.</span>from_keras_model(model)
</span></span><span style=display:flex><span>            converter<span style=color:#ff7b72;font-weight:700>.</span>optimizations <span style=color:#ff7b72;font-weight:700>=</span> [tf<span style=color:#ff7b72;font-weight:700>.</span>lite<span style=color:#ff7b72;font-weight:700>.</span>Optimize<span style=color:#ff7b72;font-weight:700>.</span>DEFAULT]
</span></span><span style=display:flex><span>            converter<span style=color:#ff7b72;font-weight:700>.</span>representative_dataset <span style=color:#ff7b72;font-weight:700>=</span> representative_dataset
</span></span><span style=display:flex><span>            converter<span style=color:#ff7b72;font-weight:700>.</span>target_spec<span style=color:#ff7b72;font-weight:700>.</span>supported_types <span style=color:#ff7b72;font-weight:700>=</span> [tf<span style=color:#ff7b72;font-weight:700>.</span>float16]  <span style=color:#8b949e;font-style:italic># å¯é€‰ï¼šfloat16</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        tflite_model <span style=color:#ff7b72;font-weight:700>=</span> converter<span style=color:#ff7b72;font-weight:700>.</span>convert()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>return</span> tflite_model
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>prune_model</span>(self, model, pruning_params<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#79c0ff>None</span>):
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;&#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>        æ¨¡å‹å‰ªæï¼šç§»é™¤ä¸é‡è¦çš„è¿æ¥
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>        - å‡å°‘æ¨¡å‹å¤æ‚åº¦
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>        - åŠ é€Ÿæ¨ç†
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>        - é˜²æ­¢è¿‡æ‹Ÿåˆ
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>        &#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>if</span> pruning_params <span style=color:#ff7b72;font-weight:700>is</span> <span style=color:#79c0ff>None</span>:
</span></span><span style=display:flex><span>            pruning_params <span style=color:#ff7b72;font-weight:700>=</span> {
</span></span><span style=display:flex><span>                <span style=color:#a5d6ff>&#39;pruning_schedule&#39;</span>: tfmot<span style=color:#ff7b72;font-weight:700>.</span>sparsity<span style=color:#ff7b72;font-weight:700>.</span>keras<span style=color:#ff7b72;font-weight:700>.</span>PolynomialDecay(
</span></span><span style=display:flex><span>                    initial_sparsity<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>0.0</span>,
</span></span><span style=display:flex><span>                    final_sparsity<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>0.5</span>,  <span style=color:#8b949e;font-style:italic># å‰ªæ50%</span>
</span></span><span style=display:flex><span>                    begin_step<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>0</span>,
</span></span><span style=display:flex><span>                    end_step<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>1000</span>
</span></span><span style=display:flex><span>                ),
</span></span><span style=display:flex><span>                <span style=color:#a5d6ff>&#39;block_size&#39;</span>: (<span style=color:#a5d6ff>1</span>, <span style=color:#a5d6ff>1</span>),  <span style=color:#8b949e;font-style:italic># ç»“æ„åŒ–å‰ªæ</span>
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># åº”ç”¨å‰ªæ</span>
</span></span><span style=display:flex><span>        pruning_model <span style=color:#ff7b72;font-weight:700>=</span> tfmot<span style=color:#ff7b72;font-weight:700>.</span>sparsity<span style=color:#ff7b72;font-weight:700>.</span>keras<span style=color:#ff7b72;font-weight:700>.</span>prune_low_magnitude(
</span></span><span style=display:flex><span>            model,
</span></span><span style=display:flex><span>            <span style=color:#ff7b72;font-weight:700>**</span>pruning_params
</span></span><span style=display:flex><span>        )
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># å¾®è°ƒå‰ªæåçš„æ¨¡å‹</span>
</span></span><span style=display:flex><span>        pruning_model<span style=color:#ff7b72;font-weight:700>.</span>compile(
</span></span><span style=display:flex><span>            optimizer<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>&#39;adam&#39;</span>,
</span></span><span style=display:flex><span>            loss<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>&#39;sparse_categorical_crossentropy&#39;</span>,
</span></span><span style=display:flex><span>            metrics<span style=color:#ff7b72;font-weight:700>=</span>[<span style=color:#a5d6ff>&#39;accuracy&#39;</span>]
</span></span><span style=display:flex><span>        )
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># pruning_model.fit(x_train, y_train, epochs=3)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>return</span> pruning_model
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>distill_model</span>(self, teacher_model, student_model, data):
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;&#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>        çŸ¥è¯†è’¸é¦ï¼šç”¨å¤§æ¨¡å‹è®­ç»ƒå°æ¨¡å‹
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>        - ä¿ç•™å¤§æ¨¡å‹çš„çŸ¥è¯†
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>        - å¤§å¹…å‡å°æ¨¡å‹å¤§å°
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>        &#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># æ¸©åº¦å‚æ•°ï¼šæ§åˆ¶è¾“å‡ºåˆ†å¸ƒçš„å¹³æ»‘åº¦</span>
</span></span><span style=display:flex><span>        temperature <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>3</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># æ•™å¸ˆæ¨¡å‹çš„è½¯æ ‡ç­¾</span>
</span></span><span style=display:flex><span>        teacher_logits <span style=color:#ff7b72;font-weight:700>=</span> teacher_model<span style=color:#ff7b72;font-weight:700>.</span>predict(data, verbose<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>0</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># å­¦ç”Ÿæ¨¡å‹å­¦ä¹ è½¯æ ‡ç­¾å’Œç¡¬æ ‡ç­¾</span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>distillation_loss</span>(y_true, y_pred):
</span></span><span style=display:flex><span>            <span style=color:#8b949e;font-style:italic># è½¯æ ‡ç­¾æŸå¤±</span>
</span></span><span style=display:flex><span>            soft_loss <span style=color:#ff7b72;font-weight:700>=</span> tf<span style=color:#ff7b72;font-weight:700>.</span>keras<span style=color:#ff7b72;font-weight:700>.</span>losses<span style=color:#ff7b72;font-weight:700>.</span>KLDivergence()(
</span></span><span style=display:flex><span>                tf<span style=color:#ff7b72;font-weight:700>.</span>nn<span style=color:#ff7b72;font-weight:700>.</span>softmax(teacher_logits <span style=color:#ff7b72;font-weight:700>/</span> temperature),
</span></span><span style=display:flex><span>                tf<span style=color:#ff7b72;font-weight:700>.</span>nn<span style=color:#ff7b72;font-weight:700>.</span>softmax(y_pred <span style=color:#ff7b72;font-weight:700>/</span> temperature)
</span></span><span style=display:flex><span>            )
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#8b949e;font-style:italic># ç¡¬æ ‡ç­¾æŸå¤±</span>
</span></span><span style=display:flex><span>            hard_loss <span style=color:#ff7b72;font-weight:700>=</span> tf<span style=color:#ff7b72;font-weight:700>.</span>keras<span style=color:#ff7b72;font-weight:700>.</span>losses<span style=color:#ff7b72;font-weight:700>.</span>sparse_categorical_crossentropy(
</span></span><span style=display:flex><span>                y_true,
</span></span><span style=display:flex><span>                y_pred
</span></span><span style=display:flex><span>            )
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#8b949e;font-style:italic># åŠ æƒç»„åˆ</span>
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>return</span> <span style=color:#a5d6ff>0.7</span> <span style=color:#ff7b72;font-weight:700>*</span> soft_loss <span style=color:#ff7b72;font-weight:700>*</span> temperature <span style=color:#ff7b72;font-weight:700>**</span> <span style=color:#a5d6ff>2</span> <span style=color:#ff7b72;font-weight:700>+</span> <span style=color:#a5d6ff>0.3</span> <span style=color:#ff7b72;font-weight:700>*</span> hard_loss
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        student_model<span style=color:#ff7b72;font-weight:700>.</span>compile(
</span></span><span style=display:flex><span>            optimizer<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>&#39;adam&#39;</span>,
</span></span><span style=display:flex><span>            loss<span style=color:#ff7b72;font-weight:700>=</span>distillation_loss,
</span></span><span style=display:flex><span>            metrics<span style=color:#ff7b72;font-weight:700>=</span>[<span style=color:#a5d6ff>&#39;accuracy&#39;</span>]
</span></span><span style=display:flex><span>        )
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>return</span> student_model
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>optimize_for_hardware</span>(self, tflite_model, target_hardware):
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;&#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>        é’ˆå¯¹ç‰¹å®šç¡¬ä»¶ä¼˜åŒ–
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>        &#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># Edge TPUä¼˜åŒ–</span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>if</span> target_hardware <span style=color:#ff7b72;font-weight:700>==</span> <span style=color:#a5d6ff>&#39;edge_tpu&#39;</span>:
</span></span><span style=display:flex><span>            <span style=color:#8b949e;font-style:italic># Edge TPUåªæ”¯æŒ8ä½æ•´æ•°é‡åŒ–</span>
</span></span><span style=display:flex><span>            converter <span style=color:#ff7b72;font-weight:700>=</span> tf<span style=color:#ff7b72;font-weight:700>.</span>lite<span style=color:#ff7b72;font-weight:700>.</span>TFLiteConverter<span style=color:#ff7b72;font-weight:700>.</span>from_keras_model(self<span style=color:#ff7b72;font-weight:700>.</span>original_model)
</span></span><span style=display:flex><span>            converter<span style=color:#ff7b72;font-weight:700>.</span>optimizations <span style=color:#ff7b72;font-weight:700>=</span> [tf<span style=color:#ff7b72;font-weight:700>.</span>lite<span style=color:#ff7b72;font-weight:700>.</span>Optimize<span style=color:#ff7b72;font-weight:700>.</span>DEFAULT]
</span></span><span style=display:flex><span>            converter<span style=color:#ff7b72;font-weight:700>.</span>target_spec<span style=color:#ff7b72;font-weight:700>.</span>supported_ops <span style=color:#ff7b72;font-weight:700>=</span> [tf<span style=color:#ff7b72;font-weight:700>.</span>lite<span style=color:#ff7b72;font-weight:700>.</span>OpsSet<span style=color:#ff7b72;font-weight:700>.</span>TFLITE_BUILTINS_INT8]
</span></span><span style=display:flex><span>            converter<span style=color:#ff7b72;font-weight:700>.</span>inference_input_type <span style=color:#ff7b72;font-weight:700>=</span> tf<span style=color:#ff7b72;font-weight:700>.</span>uint8
</span></span><span style=display:flex><span>            converter<span style=color:#ff7b72;font-weight:700>.</span>inference_output_type <span style=color:#ff7b72;font-weight:700>=</span> tf<span style=color:#ff7b72;font-weight:700>.</span>uint8
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># GPUä¼˜åŒ–</span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>elif</span> target_hardware <span style=color:#ff7b72;font-weight:700>==</span> <span style=color:#a5d6ff>&#39;gpu&#39;</span>:
</span></span><span style=display:flex><span>            converter <span style=color:#ff7b72;font-weight:700>=</span> tf<span style=color:#ff7b72;font-weight:700>.</span>lite<span style=color:#ff7b72;font-weight:700>.</span>TFLiteConverter<span style=color:#ff7b72;font-weight:700>.</span>from_keras_model(self<span style=color:#ff7b72;font-weight:700>.</span>original_model)
</span></span><span style=display:flex><span>            converter<span style=color:#ff7b72;font-weight:700>.</span>optimizations <span style=color:#ff7b72;font-weight:700>=</span> [tf<span style=color:#ff7b72;font-weight:700>.</span>lite<span style=color:#ff7b72;font-weight:700>.</span>Optimize<span style=color:#ff7b72;font-weight:700>.</span>DEFAULT]
</span></span><span style=display:flex><span>            converter<span style=color:#ff7b72;font-weight:700>.</span>target_spec<span style=color:#ff7b72;font-weight:700>.</span>supported_types <span style=color:#ff7b72;font-weight:700>=</span> [tf<span style=color:#ff7b72;font-weight:700>.</span>float16]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># é€šç”¨CPUä¼˜åŒ–</span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>else</span>:
</span></span><span style=display:flex><span>            converter <span style=color:#ff7b72;font-weight:700>=</span> tf<span style=color:#ff7b72;font-weight:700>.</span>lite<span style=color:#ff7b72;font-weight:700>.</span>TFLiteConverter<span style=color:#ff7b72;font-weight:700>.</span>from_keras_model(self<span style=color:#ff7b72;font-weight:700>.</span>original_model)
</span></span><span style=display:flex><span>            converter<span style=color:#ff7b72;font-weight:700>.</span>optimizations <span style=color:#ff7b72;font-weight:700>=</span> [tf<span style=color:#ff7b72;font-weight:700>.</span>lite<span style=color:#ff7b72;font-weight:700>.</span>Optimize<span style=color:#ff7b72;font-weight:700>.</span>DEFAULT]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>return</span> converter<span style=color:#ff7b72;font-weight:700>.</span>convert()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic># å®é™…ä½¿ç”¨ç¤ºä¾‹</span>
</span></span><span style=display:flex><span>optimizer <span style=color:#ff7b72;font-weight:700>=</span> ModelOptimizer(original_model)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic># 1. é‡åŒ–æ¨¡å‹</span>
</span></span><span style=display:flex><span>quantized_model <span style=color:#ff7b72;font-weight:700>=</span> optimizer<span style=color:#ff7b72;font-weight:700>.</span>quantize_model(
</span></span><span style=display:flex><span>    original_model,
</span></span><span style=display:flex><span>    representative_data<span style=color:#ff7b72;font-weight:700>=</span>calibration_data
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic># 2. ä¿å­˜æ¨¡å‹</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>with</span> open(<span style=color:#a5d6ff>&#39;model_quant.tflite&#39;</span>, <span style=color:#a5d6ff>&#39;wb&#39;</span>) <span style=color:#ff7b72>as</span> f:
</span></span><span style=display:flex><span>    f<span style=color:#ff7b72;font-weight:700>.</span>write(quantized_model)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic># 3. æŸ¥çœ‹æ¨¡å‹å¤§å°</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>import</span> <span style=color:#ff7b72>os</span>
</span></span><span style=display:flex><span>original_size <span style=color:#ff7b72;font-weight:700>=</span> os<span style=color:#ff7b72;font-weight:700>.</span>path<span style=color:#ff7b72;font-weight:700>.</span>getsize(<span style=color:#a5d6ff>&#39;model.h5&#39;</span>) <span style=color:#ff7b72;font-weight:700>/</span> (<span style=color:#a5d6ff>1024</span> <span style=color:#ff7b72;font-weight:700>*</span> <span style=color:#a5d6ff>1024</span>)  <span style=color:#8b949e;font-style:italic># MB</span>
</span></span><span style=display:flex><span>quantized_size <span style=color:#ff7b72;font-weight:700>=</span> os<span style=color:#ff7b72;font-weight:700>.</span>path<span style=color:#ff7b72;font-weight:700>.</span>getsize(<span style=color:#a5d6ff>&#39;model_quant.tflite&#39;</span>) <span style=color:#ff7b72;font-weight:700>/</span> (<span style=color:#a5d6ff>1024</span> <span style=color:#ff7b72;font-weight:700>*</span> <span style=color:#a5d6ff>1024</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>print(<span style=color:#79c0ff>f</span><span style=color:#a5d6ff>&#34;åŸå§‹æ¨¡å‹: </span><span style=color:#a5d6ff>{</span>original_size<span style=color:#a5d6ff>:</span><span style=color:#a5d6ff>.2f</span><span style=color:#a5d6ff>}</span><span style=color:#a5d6ff> MB&#34;</span>)
</span></span><span style=display:flex><span>print(<span style=color:#79c0ff>f</span><span style=color:#a5d6ff>&#34;é‡åŒ–æ¨¡å‹: </span><span style=color:#a5d6ff>{</span>quantized_size<span style=color:#a5d6ff>:</span><span style=color:#a5d6ff>.2f</span><span style=color:#a5d6ff>}</span><span style=color:#a5d6ff> MB&#34;</span>)
</span></span><span style=display:flex><span>print(<span style=color:#79c0ff>f</span><span style=color:#a5d6ff>&#34;å‹ç¼©ç‡: </span><span style=color:#a5d6ff>{</span>(<span style=color:#a5d6ff>1</span> <span style=color:#ff7b72;font-weight:700>-</span> quantized_size <span style=color:#ff7b72;font-weight:700>/</span> original_size) <span style=color:#ff7b72;font-weight:700>*</span> <span style=color:#a5d6ff>100</span><span style=color:#a5d6ff>:</span><span style=color:#a5d6ff>.1f</span><span style=color:#a5d6ff>}</span><span style=color:#a5d6ff>%&#34;</span>)
</span></span></code></pre></td></tr></table></div></div><h3 id=12-è¾¹ç¼˜æ¨ç†æ¡†æ¶>1.2 è¾¹ç¼˜æ¨ç†æ¡†æ¶<a hidden class=anchor aria-hidden=true href=#12-è¾¹ç¼˜æ¨ç†æ¡†æ¶>#</a></h3><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 56
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 57
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 58
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 59
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 60
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 61
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 62
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 63
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 64
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 65
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 66
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 67
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 68
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 69
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 70
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 71
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 72
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 73
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 74
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 75
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 76
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 77
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 78
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 79
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 80
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 81
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 82
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 83
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 84
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 85
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 86
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 87
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 88
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 89
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 90
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 91
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 92
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 93
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 94
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 95
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 96
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 97
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 98
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 99
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">100
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">101
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">102
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">103
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">104
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">105
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">106
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">107
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">108
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">109
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">110
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">111
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">112
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">113
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">114
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">115
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">116
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">117
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">118
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">119
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">120
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">121
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">122
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">123
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">124
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">125
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">126
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">127
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">128
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">129
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">130
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">131
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">132
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">133
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">134
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">135
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">136
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">137
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">138
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">139
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">140
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">141
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">142
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">143
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">144
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">145
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">146
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">147
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">148
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">149
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">150
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#8b949e;font-style:italic># TensorFlow Liteéƒ¨ç½²</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>class</span> <span style=color:#f0883e;font-weight:700>TFLiteInferenceEngine</span>:
</span></span><span style=display:flex><span>    <span style=color:#a5d6ff>&#34;&#34;&#34;TensorFlow Liteæ¨ç†å¼•æ“&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>__init__</span>(self, model_path, num_threads<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>4</span>, use_gpu<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#79c0ff>False</span>):
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>import</span> <span style=color:#ff7b72>tflite_runtime.interpreter</span> <span style=color:#ff7b72>as</span> <span style=color:#ff7b72>tflite</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># åŠ è½½æ¨¡å‹</span>
</span></span><span style=display:flex><span>        self<span style=color:#ff7b72;font-weight:700>.</span>interpreter <span style=color:#ff7b72;font-weight:700>=</span> tflite<span style=color:#ff7b72;font-weight:700>.</span>Interpreter(
</span></span><span style=display:flex><span>            model_path<span style=color:#ff7b72;font-weight:700>=</span>model_model_path,
</span></span><span style=display:flex><span>            num_threads<span style=color:#ff7b72;font-weight:700>=</span>num_threads
</span></span><span style=display:flex><span>        )
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># åˆ†é…å¼ é‡</span>
</span></span><span style=display:flex><span>        self<span style=color:#ff7b72;font-weight:700>.</span>interpreter<span style=color:#ff7b72;font-weight:700>.</span>allocate_tensors()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># è·å–è¾“å…¥è¾“å‡ºè¯¦æƒ…</span>
</span></span><span style=display:flex><span>        self<span style=color:#ff7b72;font-weight:700>.</span>input_details <span style=color:#ff7b72;font-weight:700>=</span> self<span style=color:#ff7b72;font-weight:700>.</span>interpreter<span style=color:#ff7b72;font-weight:700>.</span>get_input_details()
</span></span><span style=display:flex><span>        self<span style=color:#ff7b72;font-weight:700>.</span>output_details <span style=color:#ff7b72;font-weight:700>=</span> self<span style=color:#ff7b72;font-weight:700>.</span>interpreter<span style=color:#ff7b72;font-weight:700>.</span>get_output_details()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># æ£€æŸ¥ç¡¬ä»¶åŠ é€Ÿ</span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>if</span> use_gpu:
</span></span><span style=display:flex><span>            self<span style=color:#ff7b72;font-weight:700>.</span>_enable_gpu_delegation()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>_enable_gpu_delegation</span>(self):
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;&#34;&#34;å¯ç”¨GPUåŠ é€Ÿ&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>import</span> <span style=color:#ff7b72>tflite_runtime.interpreter</span> <span style=color:#ff7b72>as</span> <span style=color:#ff7b72>tflite</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># GPUå§”æ‰˜</span>
</span></span><span style=display:flex><span>        options <span style=color:#ff7b72;font-weight:700>=</span> tflite<span style=color:#ff7b72;font-weight:700>.</span>InterpreterOptions()
</span></span><span style=display:flex><span>        options<span style=color:#ff7b72;font-weight:700>.</span>add_delegate(<span style=color:#a5d6ff>&#34;TfLiteGpuDelegateV2&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        self<span style=color:#ff7b72;font-weight:700>.</span>interpreter <span style=color:#ff7b72;font-weight:700>=</span> tflite<span style=color:#ff7b72;font-weight:700>.</span>Interpreter(
</span></span><span style=display:flex><span>            model_path<span style=color:#ff7b72;font-weight:700>=</span>self<span style=color:#ff7b72;font-weight:700>.</span>model_path,
</span></span><span style=display:flex><span>            interpreter_options<span style=color:#ff7b72;font-weight:700>=</span>options
</span></span><span style=display:flex><span>        )
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>predict</span>(self, input_data):
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;&#34;&#34;æ‰§è¡Œæ¨ç†&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># è®¾ç½®è¾“å…¥</span>
</span></span><span style=display:flex><span>        input_index <span style=color:#ff7b72;font-weight:700>=</span> self<span style=color:#ff7b72;font-weight:700>.</span>input_details[<span style=color:#a5d6ff>0</span>][<span style=color:#a5d6ff>&#39;index&#39;</span>]
</span></span><span style=display:flex><span>        self<span style=color:#ff7b72;font-weight:700>.</span>interpreter<span style=color:#ff7b72;font-weight:700>.</span>set_tensor(input_index, input_data)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># æ‰§è¡Œæ¨ç†</span>
</span></span><span style=display:flex><span>        self<span style=color:#ff7b72;font-weight:700>.</span>interpreter<span style=color:#ff7b72;font-weight:700>.</span>invoke()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># è·å–è¾“å‡º</span>
</span></span><span style=display:flex><span>        output_index <span style=color:#ff7b72;font-weight:700>=</span> self<span style=color:#ff7b72;font-weight:700>.</span>output_details[<span style=color:#a5d6ff>0</span>][<span style=color:#a5d6ff>&#39;index&#39;</span>]
</span></span><span style=display:flex><span>        output_data <span style=color:#ff7b72;font-weight:700>=</span> self<span style=color:#ff7b72;font-weight:700>.</span>interpreter<span style=color:#ff7b72;font-weight:700>.</span>get_tensor(output_index)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>return</span> output_data
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>predict_batch</span>(self, input_batch):
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;&#34;&#34;æ‰¹é‡æ¨ç†&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        results <span style=color:#ff7b72;font-weight:700>=</span> []
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>for</span> input_data <span style=color:#ff7b72;font-weight:700>in</span> input_batch:
</span></span><span style=display:flex><span>            result <span style=color:#ff7b72;font-weight:700>=</span> self<span style=color:#ff7b72;font-weight:700>.</span>predict(input_data)
</span></span><span style=display:flex><span>            results<span style=color:#ff7b72;font-weight:700>.</span>append(result)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>return</span> np<span style=color:#ff7b72;font-weight:700>.</span>array(results)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic># ONNX Runtimeéƒ¨ç½²</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>class</span> <span style=color:#f0883e;font-weight:700>ONNXInferenceEngine</span>:
</span></span><span style=display:flex><span>    <span style=color:#a5d6ff>&#34;&#34;&#34;ONNX Runtimeæ¨ç†å¼•æ“&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>__init__</span>(self, model_path, providers<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#79c0ff>None</span>):
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>import</span> <span style=color:#ff7b72>onnxruntime</span> <span style=color:#ff7b72>as</span> <span style=color:#ff7b72>ort</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>if</span> providers <span style=color:#ff7b72;font-weight:700>is</span> <span style=color:#79c0ff>None</span>:
</span></span><span style=display:flex><span>            <span style=color:#8b949e;font-style:italic># è‡ªåŠ¨é€‰æ‹©æœ€ä½³æ‰§è¡Œæä¾›è€…</span>
</span></span><span style=display:flex><span>            providers <span style=color:#ff7b72;font-weight:700>=</span> ort<span style=color:#ff7b72;font-weight:700>.</span>get_available_providers()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        self<span style=color:#ff7b72;font-weight:700>.</span>session <span style=color:#ff7b72;font-weight:700>=</span> ort<span style=color:#ff7b72;font-weight:700>.</span>InferenceSession(
</span></span><span style=display:flex><span>            model_path,
</span></span><span style=display:flex><span>            providers<span style=color:#ff7b72;font-weight:700>=</span>providers
</span></span><span style=display:flex><span>        )
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># è·å–è¾“å…¥è¾“å‡ºä¿¡æ¯</span>
</span></span><span style=display:flex><span>        self<span style=color:#ff7b72;font-weight:700>.</span>input_name <span style=color:#ff7b72;font-weight:700>=</span> self<span style=color:#ff7b72;font-weight:700>.</span>session<span style=color:#ff7b72;font-weight:700>.</span>get_inputs()[<span style=color:#a5d6ff>0</span>]<span style=color:#ff7b72;font-weight:700>.</span>name
</span></span><span style=display:flex><span>        self<span style=color:#ff7b72;font-weight:700>.</span>output_name <span style=color:#ff7b72;font-weight:700>=</span> self<span style=color:#ff7b72;font-weight:700>.</span>session<span style=color:#ff7b72;font-weight:700>.</span>get_outputs()[<span style=color:#a5d6ff>0</span>]<span style=color:#ff7b72;font-weight:700>.</span>name
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>predict</span>(self, input_data):
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;&#34;&#34;æ‰§è¡Œæ¨ç†&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        result <span style=color:#ff7b72;font-weight:700>=</span> self<span style=color:#ff7b72;font-weight:700>.</span>session<span style=color:#ff7b72;font-weight:700>.</span>run(
</span></span><span style=display:flex><span>            [self<span style=color:#ff7b72;font-weight:700>.</span>output_name],
</span></span><span style=display:flex><span>            {self<span style=color:#ff7b72;font-weight:700>.</span>input_name: input_data}
</span></span><span style=display:flex><span>        )
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>return</span> result[<span style=color:#a5d6ff>0</span>]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>get_model_info</span>(self):
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;&#34;&#34;è·å–æ¨¡å‹ä¿¡æ¯&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>return</span> {
</span></span><span style=display:flex><span>            <span style=color:#a5d6ff>&#39;inputs&#39;</span>: [{
</span></span><span style=display:flex><span>                <span style=color:#a5d6ff>&#39;name&#39;</span>: input<span style=color:#ff7b72;font-weight:700>.</span>name,
</span></span><span style=display:flex><span>                <span style=color:#a5d6ff>&#39;shape&#39;</span>: input<span style=color:#ff7b72;font-weight:700>.</span>shape,
</span></span><span style=display:flex><span>                <span style=color:#a5d6ff>&#39;type&#39;</span>: input<span style=color:#ff7b72;font-weight:700>.</span>type
</span></span><span style=display:flex><span>            } <span style=color:#ff7b72>for</span> input <span style=color:#ff7b72;font-weight:700>in</span> self<span style=color:#ff7b72;font-weight:700>.</span>session<span style=color:#ff7b72;font-weight:700>.</span>get_inputs()
</span></span><span style=display:flex><span>            ],
</span></span><span style=display:flex><span>            <span style=color:#a5d6ff>&#39;outputs&#39;</span>: [{
</span></span><span style=display:flex><span>                <span style=color:#a5d6ff>&#39;name&#39;</span>: output<span style=color:#ff7b72;font-weight:700>.</span>name,
</span></span><span style=display:flex><span>                <span style=color:#a5d6ff>&#39;shape&#39;</span>: output<span style=color:#ff7b72;font-weight:700>.</span>shape,
</span></span><span style=display:flex><span>                <span style=color:#a5d6ff>&#39;type&#39;</span>: output<span style=color:#ff7b72;font-weight:700>.</span>type
</span></span><span style=display:flex><span>            } <span style=color:#ff7b72>for</span> output <span style=color:#ff7b72;font-weight:700>in</span> self<span style=color:#ff7b72;font-weight:700>.</span>session<span style=color:#ff7b72;font-weight:700>.</span>get_outputs()
</span></span><span style=display:flex><span>            ],
</span></span><span style=display:flex><span>            <span style=color:#a5d6ff>&#39;providers&#39;</span>: self<span style=color:#ff7b72;font-weight:700>.</span>session<span style=color:#ff7b72;font-weight:700>.</span>get_providers()
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic># PyTorch Mobileéƒ¨ç½²</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>class</span> <span style=color:#f0883e;font-weight:700>PyTorchMobileEngine</span>:
</span></span><span style=display:flex><span>    <span style=color:#a5d6ff>&#34;&#34;&#34;PyTorch Mobileæ¨ç†å¼•æ“&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>__init__</span>(self, model_path):
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>import</span> <span style=color:#ff7b72>torch</span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>import</span> <span style=color:#ff7b72>torch.jit</span> <span style=color:#ff7b72>as</span> <span style=color:#ff7b72>jit</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># åŠ è½½TorchScriptæ¨¡å‹</span>
</span></span><span style=display:flex><span>        self<span style=color:#ff7b72;font-weight:700>.</span>model <span style=color:#ff7b72;font-weight:700>=</span> jit<span style=color:#ff7b72;font-weight:700>.</span>load(model_path)
</span></span><span style=display:flex><span>        self<span style=color:#ff7b72;font-weight:700>.</span>model<span style=color:#ff7b72;font-weight:700>.</span>eval()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># ç§»åŠ¨åˆ°GPUï¼ˆå¦‚æœå¯ç”¨ï¼‰</span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>if</span> torch<span style=color:#ff7b72;font-weight:700>.</span>cuda<span style=color:#ff7b72;font-weight:700>.</span>is_available():
</span></span><span style=display:flex><span>            self<span style=color:#ff7b72;font-weight:700>.</span>model <span style=color:#ff7b72;font-weight:700>=</span> self<span style=color:#ff7b72;font-weight:700>.</span>model<span style=color:#ff7b72;font-weight:700>.</span>cuda()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>predict</span>(self, input_data):
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>import</span> <span style=color:#ff7b72>torch</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># è½¬æ¢ä¸ºtensor</span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>if</span> <span style=color:#ff7b72;font-weight:700>not</span> isinstance(input_data, torch<span style=color:#ff7b72;font-weight:700>.</span>Tensor):
</span></span><span style=display:flex><span>            input_tensor <span style=color:#ff7b72;font-weight:700>=</span> torch<span style=color:#ff7b72;font-weight:700>.</span>tensor(input_data)
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>else</span>:
</span></span><span style=display:flex><span>            input_tensor <span style=color:#ff7b72;font-weight:700>=</span> input_data
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># ç§»åŠ¨åˆ°GPUï¼ˆå¦‚æœæ¨¡å‹åœ¨GPUï¼‰</span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>if</span> torch<span style=color:#ff7b72;font-weight:700>.</span>cuda<span style=color:#ff7b72;font-weight:700>.</span>is_available() <span style=color:#ff7b72;font-weight:700>and</span> next(self<span style=color:#ff7b72;font-weight:700>.</span>model<span style=color:#ff7b72;font-weight:700>.</span>parameters())<span style=color:#ff7b72;font-weight:700>.</span>is_cuda:
</span></span><span style=display:flex><span>            input_tensor <span style=color:#ff7b72;font-weight:700>=</span> input_tensor<span style=color:#ff7b72;font-weight:700>.</span>cuda()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># æ¨ç†</span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>with</span> torch<span style=color:#ff7b72;font-weight:700>.</span>no_grad():
</span></span><span style=display:flex><span>            output <span style=color:#ff7b72;font-weight:700>=</span> self<span style=color:#ff7b72;font-weight:700>.</span>model(input_tensor)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># ç§»å›CPUå¹¶è½¬æ¢ä¸ºnumpy</span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>return</span> output<span style=color:#ff7b72;font-weight:700>.</span>cpu()<span style=color:#ff7b72;font-weight:700>.</span>numpy()
</span></span></code></pre></td></tr></table></div></div><h2 id=äºŒç«¯äº‘ååŒæ¶æ„>äºŒã€ç«¯äº‘ååŒæ¶æ„<a hidden class=anchor aria-hidden=true href=#äºŒç«¯äº‘ååŒæ¶æ„>#</a></h2><h3 id=21-ååŒæ¨ç†æ¨¡å¼>2.1 ååŒæ¨ç†æ¨¡å¼<a hidden class=anchor aria-hidden=true href=#21-ååŒæ¨ç†æ¨¡å¼>#</a></h3><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 56
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 57
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 58
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 59
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 60
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 61
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 62
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 63
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 64
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 65
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 66
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 67
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 68
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 69
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 70
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 71
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 72
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 73
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 74
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 75
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 76
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 77
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 78
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 79
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 80
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 81
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 82
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 83
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 84
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 85
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 86
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 87
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 88
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 89
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 90
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 91
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 92
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 93
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 94
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 95
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 96
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 97
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 98
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 99
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">100
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">101
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">102
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">103
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">104
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">105
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">106
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">107
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">108
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">109
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">110
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">111
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">112
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">113
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">114
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">115
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">116
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">117
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">118
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">119
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">120
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">121
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">122
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">123
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">124
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">125
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">126
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">127
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">128
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">129
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">130
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">131
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">132
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">133
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">134
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">135
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">136
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">137
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">138
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">139
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">140
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">141
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">142
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">143
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">144
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">145
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">146
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">147
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">148
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">149
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">150
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">151
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">152
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">153
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">154
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">155
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">156
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">157
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">158
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">159
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">160
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">161
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">162
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">163
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">164
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">165
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">166
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">167
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">168
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#8b949e;font-style:italic># ç«¯äº‘ååŒæ¨ç†</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>class</span> <span style=color:#f0883e;font-weight:700>EdgeCloudCollaborativeInference</span>:
</span></span><span style=display:flex><span>    <span style=color:#a5d6ff>&#34;&#34;&#34;ç«¯äº‘ååŒæ¨ç†&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>__init__</span>(self, edge_model, cloud_api):
</span></span><span style=display:flex><span>        self<span style=color:#ff7b72;font-weight:700>.</span>edge_model <span style=color:#ff7b72;font-weight:700>=</span> edge_model  <span style=color:#8b949e;font-style:italic># è½»é‡çº§è¾¹ç¼˜æ¨¡å‹</span>
</span></span><span style=display:flex><span>        self<span style=color:#ff7b72;font-weight:700>.</span>cloud_api <span style=color:#ff7b72;font-weight:700>=</span> cloud_api      <span style=color:#8b949e;font-style:italic># äº‘ç«¯API</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># é˜ˆå€¼é…ç½®</span>
</span></span><span style=display:flex><span>        self<span style=color:#ff7b72;font-weight:700>.</span>confidence_threshold <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>0.8</span>
</span></span><span style=display:flex><span>        self<span style=color:#ff7b72;font-weight:700>.</span>latency_threshold <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>100</span>     <span style=color:#8b949e;font-style:italic># ms</span>
</span></span><span style=display:flex><span>        self<span style=color:#ff7b72;font-weight:700>.</span>bandwidth_threshold <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>100</span>   <span style=color:#8b949e;font-style:italic># KB/s</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>async</span> <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>predict</span>(self, input_data):
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;&#34;&#34;æ™ºèƒ½æ¨ç†å†³ç­–&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># å°è¯•è¾¹ç¼˜æ¨ç†</span>
</span></span><span style=display:flex><span>        edge_result <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#ff7b72>await</span> self<span style=color:#ff7b72;font-weight:700>.</span>_edge_inference(input_data)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># è¯„ä¼°è¾¹ç¼˜ç»“æœ</span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>if</span> self<span style=color:#ff7b72;font-weight:700>.</span>_should_use_edge_result(edge_result):
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>return</span> edge_result
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>else</span>:
</span></span><span style=display:flex><span>            <span style=color:#8b949e;font-style:italic># å›é€€åˆ°äº‘ç«¯</span>
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>return</span> <span style=color:#ff7b72>await</span> self<span style=color:#ff7b72;font-weight:700>.</span>_cloud_inference(input_data)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>async</span> <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>_edge_inference</span>(self, input_data):
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;&#34;&#34;è¾¹ç¼˜æ¨ç†&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        start_time <span style=color:#ff7b72;font-weight:700>=</span> time<span style=color:#ff7b72;font-weight:700>.</span>time()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># æœ¬åœ°æ¨ç†</span>
</span></span><span style=display:flex><span>        result <span style=color:#ff7b72;font-weight:700>=</span> self<span style=color:#ff7b72;font-weight:700>.</span>edge_model<span style=color:#ff7b72;font-weight:700>.</span>predict(input_data)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        latency <span style=color:#ff7b72;font-weight:700>=</span> (time<span style=color:#ff7b72;font-weight:700>.</span>time() <span style=color:#ff7b72;font-weight:700>-</span> start_time) <span style=color:#ff7b72;font-weight:700>*</span> <span style=color:#a5d6ff>1000</span>  <span style=color:#8b949e;font-style:italic># ms</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>return</span> {
</span></span><span style=display:flex><span>            <span style=color:#a5d6ff>&#39;result&#39;</span>: result,
</span></span><span style=display:flex><span>            <span style=color:#a5d6ff>&#39;confidence&#39;</span>: result<span style=color:#ff7b72;font-weight:700>.</span>get(<span style=color:#a5d6ff>&#39;confidence&#39;</span>, <span style=color:#a5d6ff>0.5</span>),
</span></span><span style=display:flex><span>            <span style=color:#a5d6ff>&#39;latency&#39;</span>: latency,
</span></span><span style=display:flex><span>            <span style=color:#a5d6ff>&#39;source&#39;</span>: <span style=color:#a5d6ff>&#39;edge&#39;</span>
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>async</span> <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>_cloud_inference</span>(self, input_data):
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;&#34;&#34;äº‘ç«¯æ¨ç†&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        start_time <span style=color:#ff7b72;font-weight:700>=</span> time<span style=color:#ff7b72;font-weight:700>.</span>time()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># è°ƒç”¨äº‘ç«¯API</span>
</span></span><span style=display:flex><span>        cloud_result <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#ff7b72>await</span> self<span style=color:#ff7b72;font-weight:700>.</span>cloud_api<span style=color:#ff7b72;font-weight:700>.</span>predict(input_data)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        latency <span style=color:#ff7b72;font-weight:700>=</span> (time<span style=color:#ff7b72;font-weight:700>.</span>time() <span style=color:#ff7b72;font-weight:700>-</span> start_time) <span style=color:#ff7b72;font-weight:700>*</span> <span style=color:#a5d6ff>1000</span>  <span style=color:#8b949e;font-style:italic># ms</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>return</span> {
</span></span><span style=display:flex><span>            <span style=color:#a5d6ff>&#39;result&#39;</span>: cloud_result,
</span></span><span style=display:flex><span>            <span style=color:#a5d6ff>&#39;confidence&#39;</span>: cloud_result<span style=color:#ff7b72;font-weight:700>.</span>get(<span style=color:#a5d6ff>&#39;confidence&#39;</span>, <span style=color:#a5d6ff>0.9</span>),
</span></span><span style=display:flex><span>            <span style=color:#a5d6ff>&#39;latency&#39;</span>: latency,
</span></span><span style=display:flex><span>            <span style=color:#a5d6ff>&#39;source&#39;</span>: <span style=color:#a5d6ff>&#39;cloud&#39;</span>
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>_should_use_edge_result</span>(self, edge_result):
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;&#34;&#34;åˆ¤æ–­æ˜¯å¦ä½¿ç”¨è¾¹ç¼˜ç»“æœ&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># é«˜ç½®ä¿¡åº¦ï¼šä½¿ç”¨è¾¹ç¼˜ç»“æœ</span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>if</span> edge_result[<span style=color:#a5d6ff>&#39;confidence&#39;</span>] <span style=color:#ff7b72;font-weight:700>&gt;=</span> self<span style=color:#ff7b72;font-weight:700>.</span>confidence_threshold:
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>return</span> <span style=color:#79c0ff>True</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># ä½å»¶è¿Ÿè¦æ±‚ï¼šä½¿ç”¨è¾¹ç¼˜ç»“æœ</span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>if</span> edge_result[<span style=color:#a5d6ff>&#39;latency&#39;</span>] <span style=color:#ff7b72;font-weight:700>&lt;=</span> self<span style=color:#ff7b72;font-weight:700>.</span>latency_threshold:
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>return</span> <span style=color:#79c0ff>True</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># ä½å¸¦å®½ç¯å¢ƒï¼šä½¿ç”¨è¾¹ç¼˜ç»“æœ</span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>if</span> self<span style=color:#ff7b72;font-weight:700>.</span>_get_bandwidth() <span style=color:#ff7b72;font-weight:700>&lt;</span> self<span style=color:#ff7b72;font-weight:700>.</span>bandwidth_threshold:
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>return</span> <span style=color:#79c0ff>True</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>return</span> <span style=color:#79c0ff>False</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>_get_bandwidth</span>(self):
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;&#34;&#34;è·å–å½“å‰å¸¦å®½&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># ç®€åŒ–å®ç°</span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>return</span> <span style=color:#a5d6ff>1000</span>  <span style=color:#8b949e;font-style:italic># KB/s</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic># 2. åˆ†å±‚æ¨ç†æ¨¡å‹</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>class</span> <span style=color:#f0883e;font-weight:700>HierarchicalInference</span>:
</span></span><span style=display:flex><span>    <span style=color:#a5d6ff>&#34;&#34;&#34;åˆ†å±‚æ¨ç†ï¼šè¾¹ç¼˜é¢„ç­›é€‰+äº‘ç«¯ç²¾ç»†å¤„ç†&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>__init__</span>(self, edge_filter, cloud_processor):
</span></span><span style=display:flex><span>        self<span style=color:#ff7b72;font-weight:700>.</span>edge_filter <span style=color:#ff7b72;font-weight:700>=</span> edge_filter      <span style=color:#8b949e;font-style:italic># è½»é‡çº§è¿‡æ»¤å™¨</span>
</span></span><span style=display:flex><span>        self<span style=color:#ff7b72;font-weight:700>.</span>cloud_processor <span style=color:#ff7b72;font-weight:700>=</span> cloud_processor  <span style=color:#8b949e;font-style:italic># é‡é‡çº§å¤„ç†å™¨</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>async</span> <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>process</span>(self, input_data):
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;&#34;&#34;åˆ†å±‚å¤„ç†&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># ç¬¬ä¸€å±‚ï¼šè¾¹ç¼˜å¿«é€Ÿè¿‡æ»¤</span>
</span></span><span style=display:flex><span>        filter_result <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#ff7b72>await</span> self<span style=color:#ff7b72;font-weight:700>.</span>_filter_on_edge(input_data)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>if</span> filter_result[<span style=color:#a5d6ff>&#39;is_simple&#39;</span>]:
</span></span><span style=display:flex><span>            <span style=color:#8b949e;font-style:italic># ç®€å•æ¡ˆä¾‹ï¼šç›´æ¥è¿”å›</span>
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>return</span> filter_result[<span style=color:#a5d6ff>&#39;result&#39;</span>]
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>else</span>:
</span></span><span style=display:flex><span>            <span style=color:#8b949e;font-style:italic># å¤æ‚æ¡ˆä¾‹ï¼šäº‘ç«¯æ·±åº¦å¤„ç†</span>
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>return</span> <span style=color:#ff7b72>await</span> self<span style=color:#ff7b72;font-weight:700>.</span>_process_on_cloud(input_data, filter_result)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>async</span> <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>_filter_on_edge</span>(self, input_data):
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;&#34;&#34;è¾¹ç¼˜è¿‡æ»¤&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># å¿«é€Ÿåˆ†ç±»</span>
</span></span><span style=display:flex><span>        category <span style=color:#ff7b72;font-weight:700>=</span> self<span style=color:#ff7b72;font-weight:700>.</span>edge_filter<span style=color:#ff7b72;font-weight:700>.</span>predict(input_data)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>return</span> {
</span></span><span style=display:flex><span>            <span style=color:#a5d6ff>&#39;is_simple&#39;</span>: category <span style=color:#ff7b72;font-weight:700>==</span> <span style=color:#a5d6ff>&#39;simple&#39;</span>,
</span></span><span style=display:flex><span>            <span style=color:#a5d6ff>&#39;result&#39;</span>: category,
</span></span><span style=display:flex><span>            <span style=color:#a5d6ff>&#39;confidence&#39;</span>: <span style=color:#a5d6ff>0.9</span>
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>async</span> <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>_process_on_cloud</span>(self, input_data, filter_result):
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;&#34;&#34;äº‘ç«¯æ·±åº¦å¤„ç†&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># å°†è¾¹ç¼˜è¿‡æ»¤ç»“æœä¼ é€’ç»™äº‘ç«¯</span>
</span></span><span style=display:flex><span>        cloud_result <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#ff7b72>await</span> self<span style=color:#ff7b72;font-weight:700>.</span>cloud_processor<span style=color:#ff7b72;font-weight:700>.</span>process(
</span></span><span style=display:flex><span>            input_data,
</span></span><span style=display:flex><span>            context<span style=color:#ff7b72;font-weight:700>=</span>filter_result
</span></span><span style=display:flex><span>        )
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>return</span> cloud_result
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic># 3. å¢é‡å­¦ä¹ æ¶æ„</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>class</span> <span style=color:#f0883e;font-weight:700>IncrementalLearningEdge</span>:
</span></span><span style=display:flex><span>    <span style=color:#a5d6ff>&#34;&#34;&#34;è¾¹ç¼˜å¢é‡å­¦ä¹ &#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>__init__</span>(self, base_model):
</span></span><span style=display:flex><span>        self<span style=color:#ff7b72;font-weight:700>.</span>base_model <span style=color:#ff7b72;font-weight:700>=</span> base_model
</span></span><span style=display:flex><span>        self<span style=color:#ff7b72;font-weight:700>.</span>local_adaptations <span style=color:#ff7b72;font-weight:700>=</span> {}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>async</span> <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>predict_with_adaptation</span>(self, input_data, user_id):
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;&#34;&#34;å¸¦æœ¬åœ°é€‚é…çš„é¢„æµ‹&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># æ£€æŸ¥æ˜¯å¦æœ‰ç”¨æˆ·ç‰¹å®šé€‚é…</span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>if</span> user_id <span style=color:#ff7b72;font-weight:700>in</span> self<span style=color:#ff7b72;font-weight:700>.</span>local_adaptations:
</span></span><span style=display:flex><span>            adapted_model <span style=color:#ff7b72;font-weight:700>=</span> self<span style=color:#ff7b72;font-weight:700>.</span>local_adaptations[user_id]
</span></span><span style=display:flex><span>            result <span style=color:#ff7b72;font-weight:700>=</span> adapted_model<span style=color:#ff7b72;font-weight:700>.</span>predict(input_data)
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>else</span>:
</span></span><span style=display:flex><span>            result <span style=color:#ff7b72;font-weight:700>=</span> self<span style=color:#ff7b72;font-weight:700>.</span>base_model<span style=color:#ff7b72;font-weight:700>.</span>predict(input_data)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>return</span> result
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>async</span> <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>update_local_model</span>(self, user_id, new_data):
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;&#34;&#34;æ›´æ–°æœ¬åœ°æ¨¡å‹&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># åŸºäºæ–°æ•°æ®å¾®è°ƒæ¨¡å‹</span>
</span></span><span style=display:flex><span>        adapted_model <span style=color:#ff7b72;font-weight:700>=</span> self<span style=color:#ff7b72;font-weight:700>.</span>_fine_tune_model(
</span></span><span style=display:flex><span>            self<span style=color:#ff7b72;font-weight:700>.</span>base_model,
</span></span><span style=display:flex><span>            new_data
</span></span><span style=display:flex><span>        )
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        self<span style=color:#ff7b72;font-weight:700>.</span>local_adaptations[user_id] <span style=color:#ff7b72;font-weight:700>=</span> adapted_model
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># å®šæœŸåŒæ­¥åˆ°äº‘ç«¯</span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>await</span> self<span style=color:#ff7b72;font-weight:700>.</span>_sync_to_cloud(user_id, adapted_model)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>_fine_tune_model</span>(self, base_model, data):
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;&#34;&#34;å¾®è°ƒæ¨¡å‹&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># ç®€åŒ–å®ç°ï¼šè¿ç§»å­¦ä¹ </span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># å®é™…åº”ä½¿ç”¨æ›´å¤æ‚çš„å¾®è°ƒç­–ç•¥</span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>return</span> base_model  <span style=color:#8b949e;font-style:italic># è¿”å›é€‚é…åçš„æ¨¡å‹</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=22-ç¦»çº¿æ¨ç†æ¶æ„>2.2 ç¦»çº¿æ¨ç†æ¶æ„<a hidden class=anchor aria-hidden=true href=#22-ç¦»çº¿æ¨ç†æ¶æ„>#</a></h3><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 56
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 57
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 58
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 59
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 60
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 61
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 62
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 63
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 64
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 65
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 66
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 67
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 68
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 69
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 70
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 71
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 72
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 73
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 74
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 75
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 76
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 77
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 78
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 79
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 80
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 81
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 82
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 83
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 84
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 85
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 86
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 87
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 88
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 89
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 90
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 91
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 92
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 93
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 94
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 95
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 96
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 97
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 98
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 99
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">100
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">101
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">102
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">103
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">104
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">105
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">106
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">107
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">108
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">109
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">110
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">111
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">112
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">113
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">114
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">115
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">116
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#8b949e;font-style:italic># ç¦»çº¿AIæ¨ç†</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>class</span> <span style=color:#f0883e;font-weight:700>OfflineInferenceEngine</span>:
</span></span><span style=display:flex><span>    <span style=color:#a5d6ff>&#34;&#34;&#34;ç¦»çº¿æ¨ç†å¼•æ“&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>__init__</span>(self, model_path, cache_size<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>100</span>):
</span></span><span style=display:flex><span>        self<span style=color:#ff7b72;font-weight:700>.</span>model <span style=color:#ff7b72;font-weight:700>=</span> self<span style=color:#ff7b72;font-weight:700>.</span>_load_model(model_path)
</span></span><span style=display:flex><span>        self<span style=color:#ff7b72;font-weight:700>.</span>cache <span style=color:#ff7b72;font-weight:700>=</span> LRUCache(cache_size)
</span></span><span style=display:flex><span>        self<span style=color:#ff7b72;font-weight:700>.</span>offline_models <span style=color:#ff7b72;font-weight:700>=</span> {}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>_load_model</span>(self, model_path):
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;&#34;&#34;åŠ è½½æ¨¡å‹&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># TFLiteåŠ è½½</span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>import</span> <span style=color:#ff7b72>tflite_runtime.interpreter</span> <span style=color:#ff7b72>as</span> <span style=color:#ff7b72>tflite</span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>return</span> tflite<span style=color:#ff7b72;font-weight:700>.</span>Interpreter(model_path<span style=color:#ff7b72;font-weight:700>=</span>model_path)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>async</span> <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>predict</span>(self, input_data, model_version<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>&#39;default&#39;</span>):
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;&#34;&#34;ç¦»çº¿é¢„æµ‹&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># æ£€æŸ¥ç¼“å­˜</span>
</span></span><span style=display:flex><span>        cache_key <span style=color:#ff7b72;font-weight:700>=</span> self<span style=color:#ff7b72;font-weight:700>.</span>_generate_cache_key(input_data)
</span></span><span style=display:flex><span>        cached_result <span style=color:#ff7b72;font-weight:700>=</span> self<span style=color:#ff7b72;font-weight:700>.</span>cache<span style=color:#ff7b72;font-weight:700>.</span>get(cache_key)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>if</span> cached_result:
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>return</span> cached_result
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># æ‰§è¡Œæ¨ç†</span>
</span></span><span style=display:flex><span>        result <span style=color:#ff7b72;font-weight:700>=</span> self<span style=color:#ff7b72;font-weight:700>.</span>_do_inference(input_data, model_version)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># ç¼“å­˜ç»“æœ</span>
</span></span><span style=display:flex><span>        self<span style=color:#ff7b72;font-weight:700>.</span>cache<span style=color:#ff7b72;font-weight:700>.</span>put(cache_key, result)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>return</span> result
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>_do_inference</span>(self, input_data, model_version):
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;&#34;&#34;æ‰§è¡Œæ¨ç†&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># ä½¿ç”¨æŒ‡å®šç‰ˆæœ¬æ¨¡å‹</span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>if</span> model_version <span style=color:#ff7b72;font-weight:700>!=</span> <span style=color:#a5d6ff>&#39;default&#39;</span>:
</span></span><span style=display:flex><span>            model <span style=color:#ff7b72;font-weight:700>=</span> self<span style=color:#ff7b72;font-weight:700>.</span>offline_models<span style=color:#ff7b72;font-weight:700>.</span>get(model_version)
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>if</span> model:
</span></span><span style=display:flex><span>                <span style=color:#ff7b72>return</span> model<span style=color:#ff7b72;font-weight:700>.</span>predict(input_data)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># ä½¿ç”¨é»˜è®¤æ¨¡å‹</span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>return</span> self<span style=color:#ff7b72;font-weight:700>.</span>_predict_with_model(self<span style=color:#ff7b72;font-weight:700>.</span>model, input_data)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>download_model</span>(self, model_url, version):
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;&#34;&#34;ä¸‹è½½æ¨¡å‹åˆ°æœ¬åœ°&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># ä¸‹è½½æ¨¡å‹æ–‡ä»¶</span>
</span></span><span style=display:flex><span>        model_data <span style=color:#ff7b72;font-weight:700>=</span> self<span style=color:#ff7b72;font-weight:700>.</span>_download_from_url(model_url)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># ä¿å­˜åˆ°æœ¬åœ°</span>
</span></span><span style=display:flex><span>        model_path <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#79c0ff>f</span><span style=color:#a5d6ff>&#34;/models/</span><span style=color:#a5d6ff>{</span>version<span style=color:#a5d6ff>}</span><span style=color:#a5d6ff>.tflite&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>with</span> open(model_path, <span style=color:#a5d6ff>&#39;wb&#39;</span>) <span style=color:#ff7b72>as</span> f:
</span></span><span style=display:flex><span>            f<span style=color:#ff7b72;font-weight:700>.</span>write(model_data)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># åŠ è½½æ¨¡å‹</span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>import</span> <span style=color:#ff7b72>tflite_runtime.interpreter</span> <span style=color:#ff7b72>as</span> <span style=color:#ff7b72>tflite</span>
</span></span><span style=display:flex><span>        model <span style=color:#ff7b72;font-weight:700>=</span> tflite<span style=color:#ff7b72;font-weight:700>.</span>Interpreter(model_path<span style=color:#ff7b72;font-weight:700>=</span>model_path)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        self<span style=color:#ff7b72;font-weight:700>.</span>offline_models[version] <span style=color:#ff7b72;font-weight:700>=</span> model
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>return</span> model
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>update_model</span>(self, new_version):
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;&#34;&#34;æ›´æ–°æ¨¡å‹&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># æ£€æŸ¥ç½‘ç»œè¿æ¥</span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>if</span> <span style=color:#ff7b72;font-weight:700>not</span> self<span style=color:#ff7b72;font-weight:700>.</span>_is_online():
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>raise</span> <span style=color:#f0883e;font-weight:700>Exception</span>(<span style=color:#a5d6ff>&#34;Offline: Cannot update model&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># ä¸‹è½½æ–°ç‰ˆæœ¬</span>
</span></span><span style=display:flex><span>        model_url <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#79c0ff>f</span><span style=color:#a5d6ff>&#34;https://api.example.com/models/</span><span style=color:#a5d6ff>{</span>new_version<span style=color:#a5d6ff>}</span><span style=color:#a5d6ff>.tflite&#34;</span>
</span></span><span style=display:flex><span>        self<span style=color:#ff7b72;font-weight:700>.</span>download_model(model_url, new_version)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># è®¾ç½®ä¸ºé»˜è®¤ç‰ˆæœ¬</span>
</span></span><span style=display:flex><span>        self<span style=color:#ff7b72;font-weight:700>.</span>model <span style=color:#ff7b72;font-weight:700>=</span> self<span style=color:#ff7b72;font-weight:700>.</span>offline_models[new_version]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>_is_online</span>(self):
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;&#34;&#34;æ£€æŸ¥ç½‘ç»œè¿æ¥&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>import</span> <span style=color:#ff7b72>socket</span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>try</span>:
</span></span><span style=display:flex><span>            socket<span style=color:#ff7b72;font-weight:700>.</span>create_connection((<span style=color:#a5d6ff>&#34;8.8.8.8&#34;</span>, <span style=color:#a5d6ff>53</span>), timeout<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>3</span>)
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>return</span> <span style=color:#79c0ff>True</span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>except</span> <span style=color:#f0883e;font-weight:700>OSError</span>:
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>return</span> <span style=color:#79c0ff>False</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>class</span> <span style=color:#f0883e;font-weight:700>LRUCache</span>:
</span></span><span style=display:flex><span>    <span style=color:#a5d6ff>&#34;&#34;&#34;LRUç¼“å­˜&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>__init__</span>(self, size):
</span></span><span style=display:flex><span>        self<span style=color:#ff7b72;font-weight:700>.</span>size <span style=color:#ff7b72;font-weight:700>=</span> size
</span></span><span style=display:flex><span>        self<span style=color:#ff7b72;font-weight:700>.</span>cache <span style=color:#ff7b72;font-weight:700>=</span> {}
</span></span><span style=display:flex><span>        self<span style=color:#ff7b72;font-weight:700>.</span>order <span style=color:#ff7b72;font-weight:700>=</span> []
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>get</span>(self, key):
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>if</span> key <span style=color:#ff7b72;font-weight:700>in</span> self<span style=color:#ff7b72;font-weight:700>.</span>cache:
</span></span><span style=display:flex><span>            <span style=color:#8b949e;font-style:italic># æ›´æ–°è®¿é—®é¡ºåº</span>
</span></span><span style=display:flex><span>            self<span style=color:#ff7b72;font-weight:700>.</span>order<span style=color:#ff7b72;font-weight:700>.</span>remove(key)
</span></span><span style=display:flex><span>            self<span style=color:#ff7b72;font-weight:700>.</span>order<span style=color:#ff7b72;font-weight:700>.</span>append(key)
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>return</span> self<span style=color:#ff7b72;font-weight:700>.</span>cache[key]
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>return</span> <span style=color:#79c0ff>None</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>put</span>(self, key, value):
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>if</span> key <span style=color:#ff7b72;font-weight:700>in</span> self<span style=color:#ff7b72;font-weight:700>.</span>cache:
</span></span><span style=display:flex><span>            self<span style=color:#ff7b72;font-weight:700>.</span>order<span style=color:#ff7b72;font-weight:700>.</span>remove(key)
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>elif</span> len(self<span style=color:#ff7b72;font-weight:700>.</span>cache) <span style=color:#ff7b72;font-weight:700>&gt;=</span> self<span style=color:#ff7b72;font-weight:700>.</span>size:
</span></span><span style=display:flex><span>            <span style=color:#8b949e;font-style:italic># ç§»é™¤æœ€æ—§çš„é¡¹</span>
</span></span><span style=display:flex><span>            oldest <span style=color:#ff7b72;font-weight:700>=</span> self<span style=color:#ff7b72;font-weight:700>.</span>order<span style=color:#ff7b72;font-weight:700>.</span>pop(<span style=color:#a5d6ff>0</span>)
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>del</span> self<span style=color:#ff7b72;font-weight:700>.</span>cache[oldest]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        self<span style=color:#ff7b72;font-weight:700>.</span>cache[key] <span style=color:#ff7b72;font-weight:700>=</span> value
</span></span><span style=display:flex><span>        self<span style=color:#ff7b72;font-weight:700>.</span>order<span style=color:#ff7b72;font-weight:700>.</span>append(key)
</span></span></code></pre></td></tr></table></div></div><h2 id=ä¸‰å®æ—¶æ€§ä¸èƒ½æ•ˆä¼˜åŒ–>ä¸‰ã€å®æ—¶æ€§ä¸èƒ½æ•ˆä¼˜åŒ–<a hidden class=anchor aria-hidden=true href=#ä¸‰å®æ—¶æ€§ä¸èƒ½æ•ˆä¼˜åŒ–>#</a></h2><h3 id=31-å®æ—¶æ€§ä¼˜åŒ–>3.1 å®æ—¶æ€§ä¼˜åŒ–<a hidden class=anchor aria-hidden=true href=#31-å®æ—¶æ€§ä¼˜åŒ–>#</a></h3><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 56
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 57
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 58
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 59
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 60
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 61
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 62
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 63
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 64
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 65
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 66
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 67
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 68
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 69
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 70
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 71
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 72
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 73
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 74
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 75
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 76
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 77
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 78
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 79
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 80
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 81
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 82
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 83
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 84
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 85
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 86
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 87
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 88
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 89
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 90
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 91
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 92
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 93
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 94
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 95
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 96
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 97
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 98
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 99
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">100
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">101
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">102
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">103
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">104
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">105
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">106
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">107
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">108
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">109
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">110
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">111
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">112
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#8b949e;font-style:italic># å®æ—¶AIæ¨ç†ä¼˜åŒ–</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>class</span> <span style=color:#f0883e;font-weight:700>RealtimeInferenceOptimizer</span>:
</span></span><span style=display:flex><span>    <span style=color:#a5d6ff>&#34;&#34;&#34;å®æ—¶æ¨ç†ä¼˜åŒ–å™¨&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>__init__</span>(self, model):
</span></span><span style=display:flex><span>        self<span style=color:#ff7b72;font-weight:700>.</span>model <span style=color:#ff7b72;font-weight:700>=</span> model
</span></span><span style=display:flex><span>        self<span style=color:#ff7b72;font-weight:700>.</span>input_queue <span style=color:#ff7b72;font-weight:700>=</span> queue<span style=color:#ff7b72;font-weight:700>.</span>Queue(maxsize<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>10</span>)
</span></span><span style=display:flex><span>        self<span style=color:#ff7b72;font-weight:700>.</span>output_queue <span style=color:#ff7b72;font-weight:700>=</span> queue<span style=color:#ff7b72;font-weight:700>.</span>Queue(maxsize<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>10</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>async</span> <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>start_inference_thread</span>(self):
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;&#34;&#34;å¯åŠ¨æ¨ç†çº¿ç¨‹&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>import</span> <span style=color:#ff7b72>threading</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        thread <span style=color:#ff7b72;font-weight:700>=</span> threading<span style=color:#ff7b72;font-weight:700>.</span>Thread(target<span style=color:#ff7b72;font-weight:700>=</span>self<span style=color:#ff7b72;font-weight:700>.</span>_inference_loop)
</span></span><span style=display:flex><span>        thread<span style=color:#ff7b72;font-weight:700>.</span>daemon <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#79c0ff>True</span>
</span></span><span style=display:flex><span>        thread<span style=color:#ff7b72;font-weight:700>.</span>start()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>_inference_loop</span>(self):
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;&#34;&#34;æ¨ç†å¾ªç¯&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>while</span> <span style=color:#79c0ff>True</span>:
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>try</span>:
</span></span><span style=display:flex><span>                <span style=color:#8b949e;font-style:italic># ä»é˜Ÿåˆ—è·å–è¾“å…¥</span>
</span></span><span style=display:flex><span>                input_data <span style=color:#ff7b72;font-weight:700>=</span> self<span style=color:#ff7b72;font-weight:700>.</span>input_queue<span style=color:#ff7b72;font-weight:700>.</span>get(timeout<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>1.0</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>                <span style=color:#8b949e;font-style:italic># æ‰§è¡Œæ¨ç†</span>
</span></span><span style=display:flex><span>                result <span style=color:#ff7b72;font-weight:700>=</span> self<span style=color:#ff7b72;font-weight:700>.</span>model<span style=color:#ff7b72;font-weight:700>.</span>predict(input_data)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>                <span style=color:#8b949e;font-style:italic># æ”¾å…¥è¾“å‡ºé˜Ÿåˆ—</span>
</span></span><span style=display:flex><span>                self<span style=color:#ff7b72;font-weight:700>.</span>output_queue<span style=color:#ff7b72;font-weight:700>.</span>put(result)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>except</span> queue<span style=color:#ff7b72;font-weight:700>.</span>Empty:
</span></span><span style=display:flex><span>                <span style=color:#ff7b72>continue</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>async</span> <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>predict_async</span>(self, input_data):
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;&#34;&#34;å¼‚æ­¥æ¨ç†&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># éé˜»å¡æäº¤</span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>try</span>:
</span></span><span style=display:flex><span>            self<span style=color:#ff7b72;font-weight:700>.</span>input_queue<span style=color:#ff7b72;font-weight:700>.</span>put_nowait(input_data)
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>except</span> queue<span style=color:#ff7b72;font-weight:700>.</span>Full:
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>raise</span> <span style=color:#f0883e;font-weight:700>Exception</span>(<span style=color:#a5d6ff>&#34;Inference queue full&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># ç­‰å¾…ç»“æœï¼ˆå¸¦è¶…æ—¶ï¼‰</span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>try</span>:
</span></span><span style=display:flex><span>            result <span style=color:#ff7b72;font-weight:700>=</span> self<span style=color:#ff7b72;font-weight:700>.</span>output_queue<span style=color:#ff7b72;font-weight:700>.</span>get(timeout<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>0.1</span>)
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>return</span> result
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>except</span> queue<span style=color:#ff7b72;font-weight:700>.</span>Empty:
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>raise</span> <span style=color:#f0883e;font-weight:700>Exception</span>(<span style=color:#a5d6ff>&#34;Inference timeout&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic># 2. æ¨¡å‹åˆ†ç‰‡</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>class</span> <span style=color:#f0883e;font-weight:700>ModelSharding</span>:
</span></span><span style=display:flex><span>    <span style=color:#a5d6ff>&#34;&#34;&#34;æ¨¡å‹åˆ†ç‰‡ï¼šå°†å¤§æ¨¡å‹æ‹†åˆ†ä¸ºå°æ¨¡å—&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>__init__</span>(self, model_config):
</span></span><span style=display:flex><span>        self<span style=color:#ff7b72;font-weight:700>.</span>shards <span style=color:#ff7b72;font-weight:700>=</span> {}
</span></span><span style=display:flex><span>        self<span style=color:#ff7b72;font-weight:700>.</span>_create_shards(model_config)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>_create_shards</span>(self, config):
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;&#34;&#34;åˆ›å»ºæ¨¡å‹åˆ†ç‰‡&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>for</span> shard_name, shard_config <span style=color:#ff7b72;font-weight:700>in</span> config[<span style=color:#a5d6ff>&#39;shards&#39;</span>]<span style=color:#ff7b72;font-weight:700>.</span>items():
</span></span><span style=display:flex><span>            self<span style=color:#ff7b72;font-weight:700>.</span>shards[shard_name] <span style=color:#ff7b72;font-weight:700>=</span> self<span style=color:#ff7b72;font-weight:700>.</span>_load_shard(shard_config)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>_load_shard</span>(self, config):
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;&#34;&#34;åŠ è½½æ¨¡å‹åˆ†ç‰‡&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># åŠ è½½è½»é‡çº§åˆ†ç‰‡æ¨¡å‹</span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>return</span> load_model(config[<span style=color:#a5d6ff>&#39;path&#39;</span>])
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>predict_sharded</span>(self, input_data, shard_order):
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;&#34;&#34;åˆ†ç‰‡æ¨ç†&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        current_data <span style=color:#ff7b72;font-weight:700>=</span> input_data
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>for</span> shard_name <span style=color:#ff7b72;font-weight:700>in</span> shard_order:
</span></span><span style=display:flex><span>            shard <span style=color:#ff7b72;font-weight:700>=</span> self<span style=color:#ff7b72;font-weight:700>.</span>shards[shard_name]
</span></span><span style=display:flex><span>            current_data <span style=color:#ff7b72;font-weight:700>=</span> shard<span style=color:#ff7b72;font-weight:700>.</span>predict(current_data)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>return</span> current_data
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic># 3. æ—©æœŸé€€å‡º</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>class</span> <span style=color:#f0883e;font-weight:700>EarlyExitInference</span>:
</span></span><span style=display:flex><span>    <span style=color:#a5d6ff>&#34;&#34;&#34;æ—©æœŸé€€å‡ºæ¨ç†&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>__init__</span>(self, model):
</span></span><span style=display:flex><span>        self<span style=color:#ff7b72;font-weight:700>.</span>model <span style=color:#ff7b72;font-weight:700>=</span> model
</span></span><span style=display:flex><span>        self<span style=color:#ff7b72;font-weight:700>.</span>exit_thresholds <span style=color:#ff7b72;font-weight:700>=</span> [<span style=color:#a5d6ff>0.95</span>, <span style=color:#a5d6ff>0.8</span>, <span style=color:#a5d6ff>0.6</span>]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>predict_with_early_exit</span>(self, input_data):
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;&#34;&#34;å¸¦æ—©æœŸé€€å‡ºçš„é¢„æµ‹&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># ç¬¬ä¸€å±‚ï¼šå¿«é€Ÿåˆ†ç±»</span>
</span></span><span style=display:flex><span>        result <span style=color:#ff7b72;font-weight:700>=</span> self<span style=color:#ff7b72;font-weight:700>.</span>model<span style=color:#ff7b72;font-weight:700>.</span>predict_layer1(input_data)
</span></span><span style=display:flex><span>        confidence <span style=color:#ff7b72;font-weight:700>=</span> result[<span style=color:#a5d6ff>&#39;confidence&#39;</span>]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>if</span> confidence <span style=color:#ff7b72;font-weight:700>&gt;</span> self<span style=color:#ff7b72;font-weight:700>.</span>exit_thresholds[<span style=color:#a5d6ff>0</span>]:
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>return</span> result
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># ç¬¬äºŒå±‚ï¼šç²¾ç»†åˆ†ç±»</span>
</span></span><span style=display:flex><span>        result <span style=color:#ff7b72;font-weight:700>=</span> self<span style=color:#ff7b72;font-weight:700>.</span>model<span style=color:#ff7b72;font-weight:700>.</span>predict_layer2(input_data)
</span></span><span style=display:flex><span>        confidence <span style=color:#ff7b72;font-weight:700>=</span> result[<span style=color:#a5d6ff>&#39;confidence&#39;</span>]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>if</span> confidence <span style=color:#ff7b72;font-weight:700>&gt;</span> self<span style=color:#ff7b72;font-weight:700>.</span>exit_thresholds[<span style=color:#a5d6ff>1</span>]:
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>return</span> result
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># ç¬¬ä¸‰å±‚ï¼šå®Œæ•´æ¨ç†</span>
</span></span><span style=display:flex><span>        result <span style=color:#ff7b72;font-weight:700>=</span> self<span style=color:#ff7b72;font-weight:700>.</span>model<span style=color:#ff7b72;font-weight:700>.</span>predict_full(input_data)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>return</span> result
</span></span></code></pre></td></tr></table></div></div><h3 id=32-èƒ½æ•ˆä¼˜åŒ–>3.2 èƒ½æ•ˆä¼˜åŒ–<a hidden class=anchor aria-hidden=true href=#32-èƒ½æ•ˆä¼˜åŒ–>#</a></h3><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 56
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 57
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 58
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 59
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 60
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 61
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 62
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 63
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 64
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 65
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 66
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 67
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 68
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 69
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 70
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 71
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 72
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 73
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 74
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 75
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 76
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 77
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 78
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 79
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 80
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 81
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 82
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 83
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 84
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 85
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 86
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 87
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 88
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 89
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 90
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 91
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 92
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 93
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 94
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 95
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 96
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 97
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 98
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 99
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">100
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">101
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">102
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">103
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">104
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">105
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">106
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">107
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">108
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">109
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">110
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">111
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">112
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">113
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">114
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">115
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">116
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">117
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">118
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">119
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">120
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">121
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">122
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">123
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">124
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">125
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#8b949e;font-style:italic># èƒ½æ•ˆä¼˜åŒ–ç­–ç•¥</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>class</span> <span style=color:#f0883e;font-weight:700>PowerOptimizedInference</span>:
</span></span><span style=display:flex><span>    <span style=color:#a5d6ff>&#34;&#34;&#34;åŠŸè€—ä¼˜åŒ–æ¨ç†&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>__init__</span>(self, model):
</span></span><span style=display:flex><span>        self<span style=color:#ff7b72;font-weight:700>.</span>model <span style=color:#ff7b72;font-weight:700>=</span> model
</span></span><span style=display:flex><span>        self<span style=color:#ff7b72;font-weight:700>.</span>power_modes <span style=color:#ff7b72;font-weight:700>=</span> [<span style=color:#a5d6ff>&#39;high_performance&#39;</span>, <span style=color:#a5d6ff>&#39;balanced&#39;</span>, <span style=color:#a5d6ff>&#39;power_saver&#39;</span>]
</span></span><span style=display:flex><span>        self<span style=color:#ff7b72;font-weight:700>.</span>current_mode <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>&#39;balanced&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>set_power_mode</span>(self, mode):
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;&#34;&#34;è®¾ç½®åŠŸè€—æ¨¡å¼&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>if</span> mode <span style=color:#ff7b72;font-weight:700>not</span> <span style=color:#ff7b72;font-weight:700>in</span> self<span style=color:#ff7b72;font-weight:700>.</span>power_modes:
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>raise</span> <span style=color:#f0883e;font-weight:700>ValueError</span>(<span style=color:#79c0ff>f</span><span style=color:#a5d6ff>&#34;Invalid power mode: </span><span style=color:#a5d6ff>{</span>mode<span style=color:#a5d6ff>}</span><span style=color:#a5d6ff>&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        self<span style=color:#ff7b72;font-weight:700>.</span>current_mode <span style=color:#ff7b72;font-weight:700>=</span> mode
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># è°ƒæ•´æ¨ç†å‚æ•°</span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>if</span> mode <span style=color:#ff7b72;font-weight:700>==</span> <span style=color:#a5d6ff>&#39;high_performance&#39;</span>:
</span></span><span style=display:flex><span>            self<span style=color:#ff7b72;font-weight:700>.</span>threads <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>4</span>
</span></span><span style=display:flex><span>            self<span style=color:#ff7b72;font-weight:700>.</span>precision <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>&#39;float32&#39;</span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>elif</span> mode <span style=color:#ff7b72;font-weight:700>==</span> <span style=color:#a5d6ff>&#39;balanced&#39;</span>:
</span></span><span style=display:flex><span>            self<span style=color:#ff7b72;font-weight:700>.</span>threads <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>2</span>
</span></span><span style=display:flex><span>            self<span style=color:#ff7b72;font-weight:700>.</span>precision <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>&#39;float16&#39;</span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>else</span>:  <span style=color:#8b949e;font-style:italic># power_saver</span>
</span></span><span style=display:flex><span>            self<span style=color:#ff7b72;font-weight:700>.</span>threads <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>1</span>
</span></span><span style=display:flex><span>            self<span style=color:#ff7b72;font-weight:700>.</span>precision <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>&#39;int8&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>predict</span>(self, input_data):
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;&#34;&#34;æ ¹æ®åŠŸè€—æ¨¡å¼æ¨ç†&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>if</span> self<span style=color:#ff7b72;font-weight:700>.</span>current_mode <span style=color:#ff7b72;font-weight:700>==</span> <span style=color:#a5d6ff>&#39;power_saver&#39;</span>:
</span></span><span style=display:flex><span>            <span style=color:#8b949e;font-style:italic># é™ä½é¢‘ç‡</span>
</span></span><span style=display:flex><span>            self<span style=color:#ff7b72;font-weight:700>.</span>_throttle_inference()
</span></span><span style=display:flex><span>            result <span style=color:#ff7b72;font-weight:700>=</span> self<span style=color:#ff7b72;font-weight:700>.</span>_do_inference(input_data)
</span></span><span style=display:flex><span>            self<span style=color:#ff7b72;font-weight:700>.</span>_restore_inference()
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>else</span>:
</span></span><span style=display:flex><span>            result <span style=color:#ff7b72;font-weight:700>=</span> self<span style=color:#ff7b72;font-weight:700>.</span>_do_inference(input_data)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>return</span> result
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>_throttle_inference</span>(self):
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;&#34;&#34;é™åˆ¶æ¨ç†æ€§èƒ½&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># é™ä½CPUé¢‘ç‡ç­‰</span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>pass</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>_restore_inference</span>(self):
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;&#34;&#34;æ¢å¤æ¨ç†æ€§èƒ½&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>pass</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic># 2. æ‰¹å¤„ç†ä¼˜åŒ–</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>class</span> <span style=color:#f0883e;font-weight:700>BatchOptimizer</span>:
</span></span><span style=display:flex><span>    <span style=color:#a5d6ff>&#34;&#34;&#34;æ‰¹å¤„ç†ä¼˜åŒ–&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>__init__</span>(self, model, max_batch_size<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>8</span>, max_wait_time<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>50</span>):
</span></span><span style=display:flex><span>        self<span style=color:#ff7b72;font-weight:700>.</span>model <span style=color:#ff7b72;font-weight:700>=</span> model
</span></span><span style=display:flex><span>        self<span style=color:#ff7b72;font-weight:700>.</span>max_batch_size <span style=color:#ff7b72;font-weight:700>=</span> max_batch_size
</span></span><span style=display:flex><span>        self<span style=color:#ff7b72;font-weight:700>.</span>max_wait_time <span style=color:#ff7b72;font-weight:700>=</span> max_wait_time  <span style=color:#8b949e;font-style:italic># ms</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        self<span style=color:#ff7b72;font-weight:700>.</span>pending_requests <span style=color:#ff7b72;font-weight:700>=</span> []
</span></span><span style=display:flex><span>        self<span style=color:#ff7b72;font-weight:700>.</span>last_batch_time <span style=color:#ff7b72;font-weight:700>=</span> time<span style=color:#ff7b72;font-weight:700>.</span>time()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>async</span> <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>predict</span>(self, input_data):
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;&#34;&#34;æ‰¹å¤„ç†æ¨ç†&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># æ·»åŠ åˆ°å¾…å¤„ç†é˜Ÿåˆ—</span>
</span></span><span style=display:flex><span>        future <span style=color:#ff7b72;font-weight:700>=</span> asyncio<span style=color:#ff7b72;font-weight:700>.</span>Future()
</span></span><span style=display:flex><span>        self<span style=color:#ff7b72;font-weight:700>.</span>pending_requests<span style=color:#ff7b72;font-weight:700>.</span>append({
</span></span><span style=display:flex><span>            <span style=color:#a5d6ff>&#39;input&#39;</span>: input_data,
</span></span><span style=display:flex><span>            <span style=color:#a5d6ff>&#39;future&#39;</span>: future
</span></span><span style=display:flex><span>        })
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># æ£€æŸ¥æ˜¯å¦åº”è¯¥æ‰§è¡Œæ‰¹å¤„ç†</span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>if</span> self<span style=color:#ff7b72;font-weight:700>.</span>_should_process_batch():
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>await</span> self<span style=color:#ff7b72;font-weight:700>.</span>_process_batch()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>return</span> <span style=color:#ff7b72>await</span> future
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>_should_process_batch</span>(self):
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;&#34;&#34;åˆ¤æ–­æ˜¯å¦åº”è¯¥å¤„ç†æ‰¹æ¬¡&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># è¾¾åˆ°æœ€å¤§æ‰¹å¤§å°</span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>if</span> len(self<span style=color:#ff7b72;font-weight:700>.</span>pending_requests) <span style=color:#ff7b72;font-weight:700>&gt;=</span> self<span style=color:#ff7b72;font-weight:700>.</span>max_batch_size:
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>return</span> <span style=color:#79c0ff>True</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># è¶…è¿‡æœ€å¤§ç­‰å¾…æ—¶é—´</span>
</span></span><span style=display:flex><span>        elapsed <span style=color:#ff7b72;font-weight:700>=</span> (time<span style=color:#ff7b72;font-weight:700>.</span>time() <span style=color:#ff7b72;font-weight:700>-</span> self<span style=color:#ff7b72;font-weight:700>.</span>last_batch_time) <span style=color:#ff7b72;font-weight:700>*</span> <span style=color:#a5d6ff>1000</span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>if</span> elapsed <span style=color:#ff7b72;font-weight:700>&gt;=</span> self<span style=color:#ff7b72;font-weight:700>.</span>max_wait_time:
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>return</span> <span style=color:#79c0ff>True</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>return</span> <span style=color:#79c0ff>False</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>async</span> <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>_process_batch</span>(self):
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;&#34;&#34;å¤„ç†æ‰¹æ¬¡&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>if</span> <span style=color:#ff7b72;font-weight:700>not</span> self<span style=color:#ff7b72;font-weight:700>.</span>pending_requests:
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>return</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># å‡†å¤‡æ‰¹æ¬¡æ•°æ®</span>
</span></span><span style=display:flex><span>        batch_inputs <span style=color:#ff7b72;font-weight:700>=</span> [req[<span style=color:#a5d6ff>&#39;input&#39;</span>] <span style=color:#ff7b72>for</span> req <span style=color:#ff7b72;font-weight:700>in</span> self<span style=color:#ff7b72;font-weight:700>.</span>pending_requests]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># æ‰¹é‡æ¨ç†</span>
</span></span><span style=display:flex><span>        batch_results <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#ff7b72>await</span> self<span style=color:#ff7b72;font-weight:700>.</span>_batch_predict(batch_inputs)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># è¿”å›ç»“æœ</span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>for</span> i, req <span style=color:#ff7b72;font-weight:700>in</span> enumerate(self<span style=color:#ff7b72;font-weight:700>.</span>pending_requests):
</span></span><span style=display:flex><span>            req[<span style=color:#a5d6ff>&#39;future&#39;</span>]<span style=color:#ff7b72;font-weight:700>.</span>set_result(batch_results[i])
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># æ¸…ç©ºé˜Ÿåˆ—</span>
</span></span><span style=display:flex><span>        self<span style=color:#ff7b72;font-weight:700>.</span>pending_requests <span style=color:#ff7b72;font-weight:700>=</span> []
</span></span><span style=display:flex><span>        self<span style=color:#ff7b72;font-weight:700>.</span>last_batch_time <span style=color:#ff7b72;font-weight:700>=</span> time<span style=color:#ff7b72;font-weight:700>.</span>time()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>async</span> <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>_batch_predict</span>(self, batch_inputs):
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;&#34;&#34;æ‰¹é‡é¢„æµ‹&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># å †å ä¸ºæ‰¹æ¬¡tensor</span>
</span></span><span style=display:flex><span>        batch_tensor <span style=color:#ff7b72;font-weight:700>=</span> np<span style=color:#ff7b72;font-weight:700>.</span>stack(batch_inputs)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># æ¨ç†</span>
</span></span><span style=display:flex><span>        batch_results <span style=color:#ff7b72;font-weight:700>=</span> self<span style=color:#ff7b72;font-weight:700>.</span>model<span style=color:#ff7b72;font-weight:700>.</span>predict(batch_tensor)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>return</span> batch_results
</span></span></code></pre></td></tr></table></div></div><h2 id=å››å®é™…åº”ç”¨æ¡ˆä¾‹>å››ã€å®é™…åº”ç”¨æ¡ˆä¾‹<a hidden class=anchor aria-hidden=true href=#å››å®é™…åº”ç”¨æ¡ˆä¾‹>#</a></h2><h3 id=41-æ™ºèƒ½ç›¸æœºåº”ç”¨>4.1 æ™ºèƒ½ç›¸æœºåº”ç”¨<a hidden class=anchor aria-hidden=true href=#41-æ™ºèƒ½ç›¸æœºåº”ç”¨>#</a></h3><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 56
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 57
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 58
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 59
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 60
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 61
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 62
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 63
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 64
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 65
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 66
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 67
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 68
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 69
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 70
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 71
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 72
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 73
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 74
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 75
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 76
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 77
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 78
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 79
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 80
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 81
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 82
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 83
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 84
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 85
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 86
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 87
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 88
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 89
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 90
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 91
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 92
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 93
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 94
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 95
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 96
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 97
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 98
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 99
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">100
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">101
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">102
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">103
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">104
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#8b949e;font-style:italic># æ™ºèƒ½ç›¸æœºï¼šè¾¹ç¼˜AIå®æ—¶å›¾åƒå¤„ç†</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>class</span> <span style=color:#f0883e;font-weight:700>SmartCameraApp</span>:
</span></span><span style=display:flex><span>    <span style=color:#a5d6ff>&#34;&#34;&#34;æ™ºèƒ½ç›¸æœºåº”ç”¨&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>__init__</span>(self):
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># åŠ è½½å¤šä¸ªæ¨¡å‹</span>
</span></span><span style=display:flex><span>        self<span style=color:#ff7b72;font-weight:700>.</span>face_detector <span style=color:#ff7b72;font-weight:700>=</span> self<span style=color:#ff7b72;font-weight:700>.</span>_load_model(<span style=color:#a5d6ff>&#39;face_detector.tflite&#39;</span>)
</span></span><span style=display:flex><span>        self<span style=color:#ff7b72;font-weight:700>.</span>face_recognizer <span style=color:#ff7b72;font-weight:700>=</span> self<span style=color:#ff7b72;font-weight:700>.</span>_load_model(<span style=color:#a5d6ff>&#39;face_recognizer.tflite&#39;</span>)
</span></span><span style=display:flex><span>        self<span style=color:#ff7b72;font-weight:700>.</span>scene_classifier <span style=color:#ff7b72;font-weight:700>=</span> self<span style=color:#ff7b72;font-weight:700>.</span>_load_model(<span style=color:#a5d6ff>&#39;scene_classifier.tflite&#39;</span>)
</span></span><span style=display:flex><span>        self<span style=color:#ff7b72;font-weight:700>.</span>image_enhancer <span style=color:#ff7b72;font-weight:700>=</span> self<span style=color:#ff7b72;font-weight:700>.</span>_load_model(<span style=color:#a5d6ff>&#39;image_enhancer.tflite&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>async</span> <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>process_camera_frame</span>(self, frame):
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;&#34;&#34;å¤„ç†ç›¸æœºå¸§&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># 1. åœºæ™¯æ£€æµ‹ï¼ˆå¿«é€Ÿï¼‰</span>
</span></span><span style=display:flex><span>        scene <span style=color:#ff7b72;font-weight:700>=</span> self<span style=color:#ff7b72;font-weight:700>.</span>scene_classifier<span style=color:#ff7b72;font-weight:700>.</span>predict(frame)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># 2. æ ¹æ®åœºæ™¯é€‰æ‹©å¤„ç†æµç¨‹</span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>if</span> scene[<span style=color:#a5d6ff>&#39;class&#39;</span>] <span style=color:#ff7b72;font-weight:700>==</span> <span style=color:#a5d6ff>&#39;portrait&#39;</span>:
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>return</span> <span style=color:#ff7b72>await</span> self<span style=color:#ff7b72;font-weight:700>.</span>_process_portrait(frame)
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>elif</span> scene[<span style=color:#a5d6ff>&#39;class&#39;</span>] <span style=color:#ff7b72;font-weight:700>==</span> <span style=color:#a5d6ff>&#39;landscape&#39;</span>:
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>return</span> <span style=color:#ff7b72>await</span> self<span style=color:#ff7b72;font-weight:700>.</span>_process_landscape(frame)
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>elif</span> scene[<span style=color:#a5d6ff>&#39;class&#39;</span>] <span style=color:#ff7b72;font-weight:700>==</span> <span style=color:#a5d6ff>&#39;night&#39;</span>:
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>return</span> <span style=color:#ff7b72>await</span> self<span style=color:#ff7b72;font-weight:700>.</span>_process_night_scene(frame)
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>else</span>:
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>return</span> <span style=color:#ff7b72>await</span> self<span style=color:#ff7b72;font-weight:700>.</span>_process_default(frame)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>async</span> <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>_process_portrait</span>(self, frame):
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;&#34;&#34;å¤„ç†äººåƒåœºæ™¯&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># æ£€æµ‹äººè„¸</span>
</span></span><span style=display:flex><span>        faces <span style=color:#ff7b72;font-weight:700>=</span> self<span style=color:#ff7b72;font-weight:700>.</span>face_detector<span style=color:#ff7b72;font-weight:700>.</span>predict(frame)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>if</span> faces:
</span></span><span style=display:flex><span>            <span style=color:#8b949e;font-style:italic># è¯†åˆ«äººè„¸</span>
</span></span><span style=display:flex><span>            identities <span style=color:#ff7b72;font-weight:700>=</span> self<span style=color:#ff7b72;font-weight:700>.</span>face_recognizer<span style=color:#ff7b72;font-weight:700>.</span>predict(frame, faces)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#8b949e;font-style:italic># ç¾é¢œå¤„ç†</span>
</span></span><span style=display:flex><span>            enhanced_frame <span style=color:#ff7b72;font-weight:700>=</span> self<span style=color:#ff7b72;font-weight:700>.</span>image_enhancer<span style=color:#ff7b72;font-weight:700>.</span>enance_portrait(frame, faces)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>return</span> {
</span></span><span style=display:flex><span>                <span style=color:#a5d6ff>&#39;frame&#39;</span>: enhanced_frame,
</span></span><span style=display:flex><span>                <span style=color:#a5d6ff>&#39;faces&#39;</span>: faces,
</span></span><span style=display:flex><span>                <span style=color:#a5d6ff>&#39;identities&#39;</span>: identities,
</span></span><span style=display:flex><span>                <span style=color:#a5d6ff>&#39;effects&#39;</span>: [<span style=color:#a5d6ff>&#39;beautify&#39;</span>, <span style=color:#a5d6ff>&#39;smooth&#39;</span>]
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>return</span> {<span style=color:#a5d6ff>&#39;frame&#39;</span>: frame, <span style=color:#a5d6ff>&#39;faces&#39;</span>: []}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>async</span> <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>_process_night_scene</span>(self, frame):
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;&#34;&#34;å¤„ç†å¤œæ™¯&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># å¤œæ™¯å¢å¼º</span>
</span></span><span style=display:flex><span>        enhanced_frame <span style=color:#ff7b72;font-weight:700>=</span> self<span style=color:#ff7b72;font-weight:700>.</span>image_enhancer<span style=color:#ff7b72;font-weight:700>.</span>enforce_night(frame)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>return</span> {
</span></span><span style=display:flex><span>            <span style=color:#a5d6ff>&#39;frame&#39;</span>: enhanced_frame,
</span></span><span style=display:flex><span>            <span style=color:#a5d6ff>&#39;effects&#39;</span>: [<span style=color:#a5d6ff>&#39;night_mode&#39;</span>, <span style=color:#a5d6ff>&#39;denoise&#39;</span>]
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic># å®æ—¶æ€§èƒ½ç›‘æ§</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>class</span> <span style=color:#f0883e;font-weight:700>PerformanceMonitor</span>:
</span></span><span style=display:flex><span>    <span style=color:#a5d6ff>&#34;&#34;&#34;æ€§èƒ½ç›‘æ§&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>__init__</span>(self):
</span></span><span style=display:flex><span>        self<span style=color:#ff7b72;font-weight:700>.</span>fps_history <span style=color:#ff7b72;font-weight:700>=</span> []
</span></span><span style=display:flex><span>        self<span style=color:#ff7b72;font-weight:700>.</span>latency_history <span style=color:#ff7b72;font-weight:700>=</span> []
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>measure_inference</span>(self, inference_fn):
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;&#34;&#34;æµ‹é‡æ¨ç†æ€§èƒ½&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        start_time <span style=color:#ff7b72;font-weight:700>=</span> time<span style=color:#ff7b72;font-weight:700>.</span>time()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        result <span style=color:#ff7b72;font-weight:700>=</span> inference_fn()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        end_time <span style=color:#ff7b72;font-weight:700>=</span> time<span style=color:#ff7b72;font-weight:700>.</span>time()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        latency <span style=color:#ff7b72;font-weight:700>=</span> (end_time <span style=color:#ff7b72;font-weight:700>-</span> start_time) <span style=color:#ff7b72;font-weight:700>*</span> <span style=color:#a5d6ff>1000</span>  <span style=color:#8b949e;font-style:italic># ms</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        self<span style=color:#ff7b72;font-weight:700>.</span>latency_history<span style=color:#ff7b72;font-weight:700>.</span>append(latency)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># ä¿æŒæœ€è¿‘100ä¸ªæ ·æœ¬</span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>if</span> len(self<span style=color:#ff7b72;font-weight:700>.</span>latency_history) <span style=color:#ff7b72;font-weight:700>&gt;</span> <span style=color:#a5d6ff>100</span>:
</span></span><span style=display:flex><span>            self<span style=color:#ff7b72;font-weight:700>.</span>latency_history<span style=color:#ff7b72;font-weight:700>.</span>pop(<span style=color:#a5d6ff>0</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>return</span> result
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>get_stats</span>(self):
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;&#34;&#34;è·å–ç»Ÿè®¡ä¿¡æ¯&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>if</span> <span style=color:#ff7b72;font-weight:700>not</span> self<span style=color:#ff7b72;font-weight:700>.</span>latency_history:
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>return</span> {}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>import</span> <span style=color:#ff7b72>numpy</span> <span style=color:#ff7b72>as</span> <span style=color:#ff7b72>np</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>return</span> {
</span></span><span style=display:flex><span>            <span style=color:#a5d6ff>&#39;avg_latency&#39;</span>: np<span style=color:#ff7b72;font-weight:700>.</span>mean(self<span style=color:#ff7b72;font-weight:700>.</span>latency_history),
</span></span><span style=display:flex><span>            <span style=color:#a5d6ff>&#39;p50_latency&#39;</span>: np<span style=color:#ff7b72;font-weight:700>.</span>percentile(self<span style=color:#ff7b72;font-weight:700>.</span>latency_history, <span style=color:#a5d6ff>50</span>),
</span></span><span style=display:flex><span>            <span style=color:#a5d6ff>&#39;p95_latency&#39;</span>: np<span style=color:#ff7b72;font-weight:700>.</span>percentile(self<span style=color:#ff7b72;font-weight:700>.</span>latency_history, <span style=color:#a5d6ff>95</span>),
</span></span><span style=display:flex><span>            <span style=color:#a5d6ff>&#39;p99_latency&#39;</span>: np<span style=color:#ff7b72;font-weight:700>.</span>percentile(self<span style=color:#ff7b72;font-weight:700>.</span>latency_history, <span style=color:#a5d6ff>99</span>),
</span></span><span style=display:flex><span>            <span style=color:#a5d6ff>&#39;max_latency&#39;</span>: np<span style=color:#ff7b72;font-weight:700>.</span>max(self<span style=color:#ff7b72;font-weight:700>.</span>latency_history),
</span></span><span style=display:flex><span>            <span style=color:#a5d6ff>&#39;fps&#39;</span>: <span style=color:#a5d6ff>1000</span> <span style=color:#ff7b72;font-weight:700>/</span> np<span style=color:#ff7b72;font-weight:700>.</span>mean(self<span style=color:#ff7b72;font-weight:700>.</span>latency_history)
</span></span><span style=display:flex><span>        }
</span></span></code></pre></td></tr></table></div></div><h2 id=æ€»ç»“>æ€»ç»“<a hidden class=anchor aria-hidden=true href=#æ€»ç»“>#</a></h2><p>Edge AIåœ¨2025å¹´å®ç°äº†ä»æ¦‚å¿µåˆ°å•†ç”¨çš„è·¨è¶Šã€‚2026å¹´ï¼Œéšç€ç¡¬ä»¶èƒ½åŠ›çš„æå‡å’Œä¼˜åŒ–æŠ€æœ¯çš„æˆç†Ÿï¼ŒEdge AIå°†åœ¨æ›´å¤šåœºæ™¯ä¸­æ›¿ä»£äº‘ç«¯AIã€‚</p><p><strong>å¼€å‘å»ºè®®</strong>ï¼š</p><ul><li>ä¼˜å…ˆè€ƒè™‘æ¨¡å‹ä¼˜åŒ–ï¼ˆé‡åŒ–ã€å‰ªæï¼‰</li><li>åˆç†è®¾è®¡ç«¯äº‘ååŒæ¶æ„</li><li>å…³æ³¨å®æ—¶æ€§å’ŒåŠŸè€—å¹³è¡¡</li><li>æŒç»­ç›‘æ§å’Œä¼˜åŒ–æ€§èƒ½</li></ul><p><strong>å­¦ä¹ è·¯å¾„</strong>ï¼š</p><ol><li>æŒæ¡æ¨¡å‹å‹ç¼©æŠ€æœ¯</li><li>å­¦ä¹ è¾¹ç¼˜æ¨ç†æ¡†æ¶</li><li>ç†è§£ç«¯äº‘ååŒæ¨¡å¼</li><li>å®é™…é¡¹ç›®æ¼”ç»ƒ</li></ol><blockquote><p><strong>ç›¸å…³å·¥å…·æ¨è</strong></p><ul><li><a href=https://www.util.cn/tools/base64-encode/>Base64ç¼–ç å·¥å…·</a> - ç¼–ç è½¬æ¢</li><li><a href=https://www.util.cn/tools/image/>å›¾ç‰‡å¤„ç†å·¥å…·</a> - å›¾åƒå¤„ç†</li></ul></blockquote></div><footer class=post-footer-modern><div class=post-tags-modern><span class=tags-label>ğŸ·ï¸ æ ‡ç­¾</span><div class=tags-list><a href=/blog/tags/edge-ai/ class=tag-pill>Edge AI
</a><a href=/blog/tags/%E6%A8%A1%E5%9E%8B%E5%8E%8B%E7%BC%A9/ class=tag-pill>æ¨¡å‹å‹ç¼©
</a><a href=/blog/tags/%E8%BE%B9%E7%BC%98%E8%AE%A1%E7%AE%97/ class=tag-pill>è¾¹ç¼˜è®¡ç®—
</a><a href=/blog/tags/ai%E9%83%A8%E7%BD%B2/ class=tag-pill>AIéƒ¨ç½²</a></div></div><style>.post-footer-modern{margin-top:3rem;padding-top:2rem;border-top:1px solid var(--border,#333333)}.post-tags-modern{display:flex;align-items:center;gap:1rem;margin-bottom:2rem;flex-wrap:wrap}.tags-label{font-size:.875rem;font-weight:600;color:var(--secondary,#999999) !important;white-space:nowrap}.tags-list{display:flex;flex-wrap:wrap;gap:.5rem;flex:1}.tag-pill{display:inline-block;padding:.25rem .75rem;background:rgba(255,255,255,5%);border:1px solid var(--border,#333333);border-radius:0;color:var(--secondary,#cccccc) !important;text-decoration:none;font-size:.8rem;font-weight:500;transition:all .2s ease}.tag-pill:hover{background:var(--primary,#ffffff);color:var(--background,#000000) !important;border-color:var(--primary,#ffffff);transform:translateY(-1px)}.post-nav-modern{margin-top:2rem}.nav-grid{display:grid;grid-template-columns:1fr 1fr;gap:1rem}.nav-card{display:flex;align-items:center;gap:1rem;padding:1.25rem;background:rgba(255,255,255,2%);border:1px solid var(--border,#333333);border-radius:12px;text-decoration:none;transition:all .2s ease;min-height:80px}.nav-card:hover{background:rgba(255,255,255,5%);border-color:var(--primary,#ffffff);transform:translateY(-2px)}.nav-card.nav-prev{justify-content:flex-start}.nav-card.nav-next{justify-content:flex-end;text-align:right}.nav-card.nav-next .nav-content{text-align:right}.nav-empty{display:flex;align-items:center;justify-content:center;background:rgba(255,255,255,1%);border:1px dashed var(--border,#333333);color:var(--secondary,#666666)}.nav-arrow{font-size:1.5rem;color:var(--primary,#ffffff);font-weight:300}.nav-content{flex:1}.nav-title{font-size:.95rem;font-weight:600;color:var(--primary,#ffffff) !important;line-height:1.4;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden}[data-theme=light] .post-footer-modern{border-color:var(--border-light,#dee2e6)}[data-theme=light] .tags-label{color:var(--secondary-light,#6c757d) !important}[data-theme=light] .tag-pill{background:rgba(0,0,0,5%);border-color:var(--border-light,#dee2e6);color:var(--secondary-light,#495057) !important}[data-theme=light] .tag-pill:hover{background:var(--primary-light,#0066cc);color:var(--background-light,#ffffff) !important;border-color:var(--primary-light,#0066cc)}[data-theme=light] .nav-card{background:rgba(0,0,0,2%);border-color:var(--border-light,#dee2e6)}[data-theme=light] .nav-card:hover{background:rgba(0,102,204,5%);border-color:var(--primary-light,#0066cc)}[data-theme=light] .nav-empty{background:rgba(0,0,0,1%);border-color:var(--border-light,#dee2e6);color:var(--secondary-light,#6c757d)}[data-theme=light] .nav-arrow{color:var(--primary-light,#0066cc)}[data-theme=light] .nav-title{color:var(--primary-light,#212529) !important}@media(max-width:768px){.nav-grid{grid-template-columns:1fr;gap:.75rem}.nav-card{padding:1rem;min-height:70px}.nav-card.nav-next{text-align:left}.nav-card.nav-next .nav-content{text-align:left}.nav-title{font-size:.875rem}.post-tags-modern{flex-direction:column;gap:.75rem}}@media(max-width:480px){.nav-arrow{font-size:1.25rem}.nav-card{padding:.875rem}.nav-title{font-size:.8rem;-webkit-line-clamp:1}}</style><nav class=post-nav-modern><div class=nav-grid><a href=/blog/articles/webassembly-2025%E4%BB%8E%E8%BE%B9%E7%BC%98%E6%8A%80%E6%9C%AF%E5%88%B0%E4%B8%BB%E6%B5%81%E5%B9%B3%E5%8F%B0%E7%9A%84%E8%B7%A8%E8%B6%8A/ class="nav-card nav-prev"><div class=nav-arrow>â†</div><div class=nav-content><div class=nav-title>WebAssembly 2025ï¼šä»è¾¹ç¼˜æŠ€æœ¯åˆ°ä¸»æµå¹³å°çš„è·¨è¶Š</div></div></a><a href=/blog/articles/%E9%9B%B6%E4%BF%A1%E4%BB%BB%E6%9E%B6%E6%9E%84%E4%BB%8E%E7%90%86%E8%AE%BA%E5%88%B0%E5%AE%9E%E8%B7%B5%E6%9E%84%E5%BB%BA%E6%B0%B8%E4%B8%8D%E4%BF%A1%E4%BB%BB%E5%A7%8B%E7%BB%88%E9%AA%8C%E8%AF%81%E7%9A%84%E5%AE%89%E5%85%A8%E4%BD%93%E7%B3%BB/ class="nav-card nav-next"><div class=nav-content><div class=nav-title>é›¶ä¿¡ä»»æ¶æ„ä»ç†è®ºåˆ°å®è·µï¼šæ„å»ºæ°¸ä¸ä¿¡ä»»ã€å§‹ç»ˆéªŒè¯çš„å®‰å…¨ä½“ç³»</div></div><div class=nav-arrow>â†’</div></a></div></nav></footer></main><aside class=post-sidebar><div class=sidebar-toc id=sidebar-toc><div class=toc-header><div class=toc-title>ç›®å½•</div><button class=toc-toggle id=toc-toggle aria-label="Toggle TOC">
<svg class="toc-toggle-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 6 6 18M6 6l12 12"/></svg></button></div><div class=toc-content id=toc-content><ul class=toc-list><li class="toc-item toc-h2"><a href=#h2-0 class=toc-item-link><span class=toc-item-text>å¼•è¨€</span></a></li><li class="toc-item toc-h2"><a href=#h2-1 class=toc-item-link><span class=toc-item-text>ä¸€ã€Edge AIæŠ€æœ¯æ ˆ</span></a></li><li class="toc-item toc-h2"><a href=#h2-2 class=toc-item-link><span class=toc-item-text>äºŒã€ç«¯äº‘ååŒæ¶æ„</span></a></li><li class="toc-item toc-h2"><a href=#h2-3 class=toc-item-link><span class=toc-item-text>ä¸‰ã€å®æ—¶æ€§ä¸èƒ½æ•ˆä¼˜åŒ–</span></a></li><li class="toc-item toc-h2"><a href=#h2-4 class=toc-item-link><span class=toc-item-text>å››ã€å®é™…åº”ç”¨æ¡ˆä¾‹</span></a></li><li class="toc-item toc-h2"><a href=#h2-5 class=toc-item-link><span class=toc-item-text>æ€»ç»“</span></a></li></ul></div></div><script>document.addEventListener("DOMContentLoaded",function(){const e=document.getElementById("sidebar-toc"),t=document.getElementById("toc-toggle"),o=document.getElementById("toc-content"),i=t?.querySelector(".toc-toggle-icon");if(!e)return;let n=!1;t&&t.addEventListener("click",function(){n=!n,n?(o.style.display="none",e.style.width="auto",i.innerHTML='<path d="M9 18l6-6-6-6"/>'):(o.style.display="block",e.style.width="200px",i.innerHTML='<path d="M18 6L6 18M6 6l12 12"/>')});const s=document.querySelector(".post-content");if(s){const e=s.querySelectorAll("h1");e.forEach((e,t)=>{e.id=`h1-${t}`});const t=s.querySelectorAll("h2");t.forEach((e,t)=>{e.id=`h2-${t}`})}const a=document.querySelectorAll(".toc-item-link");a.forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();const n=this.getAttribute("href").substring(1),t=document.getElementById(n);if(t){const e=document.querySelector(".post-header-main")?.offsetHeight||0,n=t.offsetTop-e-20;window.scrollTo({top:n,behavior:"smooth"})}})})})</script><style>.sidebar-toc{position:sticky;top:2rem;width:200px;background:#fff;border:1px solid #e5e7eb;border-radius:4px;overflow:hidden;box-shadow:0 1px 3px rgba(0,0,0,.1);z-index:100}.sidebar-toc.hidden{display:none}.toc-header{padding:12px 16px;border-bottom:1px solid #e5e7eb;background:#fafbfc;display:flex;align-items:center;justify-content:space-between}.toc-title{margin:0;font-size:13px;font-weight:500;color:#374151 !important;font-family:-apple-system,BlinkMacSystemFont,segoe ui,Roboto,sans-serif;text-transform:uppercase;letter-spacing:1px}.toc-toggle{background:0 0;border:none;cursor:pointer;padding:4px;border-radius:4px;display:flex;align-items:center;justify-content:center;transition:all .2s ease;color:#6b7280}.toc-toggle:hover{background:#e5e7eb;color:#374151}.toc-toggle-icon{transition:transform .2s ease}.toc-content{padding:12px 0}.toc-list{list-style:none;margin:0;padding:0}.toc-item{margin-bottom:4px;display:block !important;visibility:visible !important}.toc-h1,.toc-h2{display:block !important}.toc-h2{margin-left:0}.toc-item-link{display:flex;align-items:center;gap:8px;padding:8px 12px;color:#374151 !important;text-decoration:none;font-size:13px;line-height:1.4;border-radius:3px;transition:all .2s ease;font-weight:400}.toc-item-link:hover{background:#f8fafc;color:#1f2937 !important}.toc-item-link.active{background:#e0f2fe;color:#01579b !important;font-weight:500}.toc-dot{width:8px;height:8px;border-radius:50%;flex-shrink:0}.dot-red{background:#ef4444}.dot-blue{background:#2196f3}.toc-item-text{color:#1f2937 !important;font-weight:400;flex:1;display:inline !important;visibility:visible !important;opacity:1 !important;font-size:13px !important;line-height:1.4 !important}.toc-item-link .toc-item-text{color:#1f2937 !important;display:inline !important;visibility:visible !important;opacity:1 !important}.toc-item.active .dot-red{background:#d32f2f}.toc-item.active .dot-blue{background:#1976d2}[data-theme=dark] .sidebar-toc{background:#1f2937;border-color:#374151;box-shadow:0 1px 3px rgba(0,0,0,.3)}[data-theme=dark] .toc-header{background:#111827;border-color:#374151}[data-theme=dark] .toc-title{color:#f3f4f6 !important}[data-theme=dark] .toc-toggle{color:#9ca3af}[data-theme=dark] .toc-toggle:hover{background:#374151;color:#f3f4f6}[data-theme=dark] .toc-item-link{color:#e5e7eb !important}[data-theme=dark] .toc-item-link:hover{background:#374151;color:#f9fafb !important}[data-theme=dark] .toc-item-link.active{background:#0d47a1;color:#fff !important}[data-theme=dark] .toc-item-text{color:#f9fafb !important;display:inline !important;visibility:visible !important;opacity:1 !important}[data-theme=dark] .toc-item-link .toc-item-text{color:#f9fafb !important;display:inline !important;visibility:visible !important;opacity:1 !important}@media(max-width:1024px){.sidebar-toc{display:none}.post-content-wrapper{grid-template-columns:1fr !important;padding:0 1rem !important}}</style><style>.post-content-wrapper{display:grid;grid-template-columns:1fr 200px;gap:2rem;padding:0 2rem;max-width:100%}.post-content-main{min-width:0}.post-sidebar{position:sticky;top:2rem;height:fit-content;min-width:0}.post-header-main{margin-bottom:2rem;padding-bottom:1rem;border-bottom:1px solid var(--border,#333333)}.post-header-main .post-title{color:var(--primary,#ffffff) !important;font-size:2.5rem;font-weight:700;line-height:1.2;margin-bottom:1rem}.post-header-main .post-description{color:var(--secondary,#cccccc) !important;font-size:1.1rem;line-height:1.6;margin-bottom:1rem}.post-header-main .post-meta{margin-bottom:0}@media(max-width:1024px){.post-content-wrapper{grid-template-columns:1fr !important;gap:1rem;padding:0 1rem !important}.post-sidebar{display:none}}@media(max-width:768px){.post-header-main .post-title{font-size:2rem}.post-header-main .post-description{font-size:1rem}}</style></aside></div></article></main><footer class=footer><span>Â© 2024-2025 æœ‰æ¡å·¥å…·æŠ€æœ¯åšå®¢</span> Â·</footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");if(menu){const e=localStorage.getItem("menu-scroll-position");e&&(menu.scrollLeft=parseInt(e,10)),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}}document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{const e=document.querySelector("html");e.dataset.theme==="dark"?(e.dataset.theme="light",localStorage.setItem("pref-theme","light")):(e.dataset.theme="dark",localStorage.setItem("pref-theme","dark"))})</script></body></html>