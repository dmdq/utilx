<!doctype html><html lang=zh-cn dir=auto data-theme=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>LLMåº”ç”¨å¼€å‘å®æˆ˜ï¼šä»åŸå‹åˆ°ç”Ÿäº§éƒ¨ç½²çš„å®Œæ•´æŒ‡å— | æŠ€æœ¯åšå®¢ - æœ‰æ¡å·¥å…·</title><meta name=keywords content="LLM,AIåº”ç”¨,Claude API,åº”ç”¨å¼€å‘,GPT"><meta name=description content="æ·±å…¥æ¢è®¨å¤§è¯­è¨€æ¨¡å‹åº”ç”¨å¼€å‘çš„å…¨æµç¨‹ï¼ŒåŒ…æ‹¬æ¨¡å‹é€‰æ‹©ã€æç¤ºå·¥ç¨‹ã€APIè®¾è®¡ã€æ€§èƒ½ä¼˜åŒ–å’Œç”Ÿäº§éƒ¨ç½²ç­‰å®æˆ˜æŠ€å·§ã€‚"><meta name=author content="æœ‰æ¡å·¥å…·å›¢é˜Ÿ"><link rel=canonical href=/blog/articles/llm%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91%E5%AE%9E%E6%88%98%E4%BB%8E%E5%8E%9F%E5%9E%8B%E5%88%B0%E7%94%9F%E4%BA%A7%E9%83%A8%E7%BD%B2%E7%9A%84%E5%AE%8C%E6%95%B4%E6%8C%87%E5%8D%97/><link crossorigin=anonymous href=/blog/assets/css/stylesheet.7e8505b7cdf8bb22ab2305e53c2700bb06c7e64faeb72cd3468823a9a3bd3d6e.css integrity="sha256-foUFt834uyKrIwXlPCcAuwbH5k+utyzTRogjqaO9PW4=" rel="preload stylesheet" as=style><link rel=icon href=/favicon.ico><link rel=icon type=image/png sizes=16x16 href=/blog/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=/blog/favicon-32x32.png><link rel=apple-touch-icon href=/blog/apple-touch-icon.png><link rel=mask-icon href=/blog/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate type=application/rss+xml href=/blog/articles/llm%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91%E5%AE%9E%E6%88%98%E4%BB%8E%E5%8E%9F%E5%9E%8B%E5%88%B0%E7%94%9F%E4%BA%A7%E9%83%A8%E7%BD%B2%E7%9A%84%E5%AE%8C%E6%95%B4%E6%8C%87%E5%8D%97/feed.xml title=rss><link rel=alternate hreflang=zh-cn href=/blog/articles/llm%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91%E5%AE%9E%E6%88%98%E4%BB%8E%E5%8E%9F%E5%9E%8B%E5%88%B0%E7%94%9F%E4%BA%A7%E9%83%A8%E7%BD%B2%E7%9A%84%E5%AE%8C%E6%95%B4%E6%8C%87%E5%8D%97/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51);color-scheme:dark}.list{background:var(--theme)}.toc{background:var(--entry)}}@media(prefers-color-scheme:light){.list::-webkit-scrollbar-thumb{border-color:var(--code-bg)}}</style></noscript><script>localStorage.getItem("pref-theme")==="dark"?document.querySelector("html").dataset.theme="dark":localStorage.getItem("pref-theme")==="light"?document.querySelector("html").dataset.theme="light":window.matchMedia("(prefers-color-scheme: dark)").matches?document.querySelector("html").dataset.theme="dark":document.querySelector("html").dataset.theme="light"</script><script src=/js/external-link-config.js></script><script src=/js/external-link-interceptor.js></script><link rel=stylesheet href=/blog/css/custom.css media=screen><script type=application/ld+json>{"@context":"https://schema.org","@type":"WebSite","name":"æŠ€æœ¯åšå®¢ - æœ‰æ¡å·¥å…· | å¼€å‘è€…å·¥å…·ä½¿ç”¨æ•™ç¨‹ & ç¼–ç¨‹æŠ€å·§åˆ†äº«","url":"https://www.util.cn/blog/","description":"æœ‰æ¡å·¥å…·æŠ€æœ¯åšå®¢ - åˆ†äº«å¼€å‘è€…å·¥å…·ä½¿ç”¨æ•™ç¨‹ã€ç¼–ç¨‹æŠ€å·§å’Œå®æˆ˜å¼€å‘ç»éªŒã€‚æä¾›JSONæ ¼å¼åŒ–ã€SQLä¼˜åŒ–ã€Markdownç¼–è¾‘å™¨ç­‰åœ¨çº¿å·¥å…·çš„è¯¦ç»†ä½¿ç”¨æŒ‡å—ï¼Œå¸®åŠ©å¼€å‘è€…æå‡å·¥ä½œæ•ˆç‡ã€‚","publisher":{"@type":"Organization","name":"æœ‰æ¡å·¥å…·","url":"https://www.util.cn","logo":{"@type":"ImageObject","url":"https://www.util.cn/blog/logo/logo-256.png","width":256,"height":256}},"potentialAction":[{"@type":"SearchAction","target":"https://www.util.cn/blog/search?q={search_term_string}","query-input":"required name=search_term_string"}]}</script><meta property="og:type" content="website"><meta property="og:title" content="æŠ€æœ¯åšå®¢ - æœ‰æ¡å·¥å…· | å¼€å‘è€…å·¥å…·ä½¿ç”¨æ•™ç¨‹ & ç¼–ç¨‹æŠ€å·§åˆ†äº«"><meta property="og:description" content="æœ‰æ¡å·¥å…·æŠ€æœ¯åšå®¢ - åˆ†äº«å¼€å‘è€…å·¥å…·ä½¿ç”¨æ•™ç¨‹ã€ç¼–ç¨‹æŠ€å·§å’Œå®æˆ˜å¼€å‘ç»éªŒã€‚æä¾›JSONæ ¼å¼åŒ–ã€SQLä¼˜åŒ–ã€Markdownç¼–è¾‘å™¨ç­‰åœ¨çº¿å·¥å…·çš„è¯¦ç»†ä½¿ç”¨æŒ‡å—ï¼Œå¸®åŠ©å¼€å‘è€…æå‡å·¥ä½œæ•ˆç‡ã€‚"><meta property="og:url" content="https://www.util.cn/blog/"><meta property="og:site_name" content="æœ‰æ¡å·¥å…·æŠ€æœ¯åšå®¢"><meta property="og:image" content="https://www.util.cn/blog/logo/logo-256.png"><meta property="og:image:width" content="1200"><meta property="og:image:height" content="630"><meta name=twitter:card content="summary_large_image"><meta name=twitter:title content="æŠ€æœ¯åšå®¢ - æœ‰æ¡å·¥å…· | å¼€å‘è€…å·¥å…·ä½¿ç”¨æ•™ç¨‹ & ç¼–ç¨‹æŠ€å·§åˆ†äº«"><meta name=twitter:description content="æœ‰æ¡å·¥å…·æŠ€æœ¯åšå®¢ - åˆ†äº«å¼€å‘è€…å·¥å…·ä½¿ç”¨æ•™ç¨‹ã€ç¼–ç¨‹æŠ€å·§å’Œå®æˆ˜å¼€å‘ç»éªŒã€‚"><meta name=twitter:image content="https://www.util.cn/blog/logo/logo-256.png"><meta name=baidu-site-verification content><meta name=category content="æŠ€æœ¯åšå®¢,å¼€å‘è€…å·¥å…·,ç¼–ç¨‹æ•™ç¨‹"><meta name=coverage content="Worldwide"><meta name=distribution content="Global"><meta name=rating content="General"><script id=51la_code async crossorigin=anonymous src="https://sdk.51.la/js-sdk-pro.min.js?id=3OM52V0xJAPv6ozF&hash=pro"></script><script>window.addEventListener("load",function(){setTimeout(function(){typeof la!="undefined"?console.log("51laç»Ÿè®¡å·²åŠ è½½"):(console.warn("51laç»Ÿè®¡åŠ è½½å¤±è´¥ï¼Œä½¿ç”¨å¤‡ç”¨æ–¹æ¡ˆ"),function(){var e=document.createElement("script");e.src="https://sdk.51.la/js-sdk-pro.min.js?id=3OM52V0xJAPv6ozF&hash=backup",e.async=!0,document.head.appendChild(e)}())},3e3)})</script><meta property="og:url" content="/blog/articles/llm%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91%E5%AE%9E%E6%88%98%E4%BB%8E%E5%8E%9F%E5%9E%8B%E5%88%B0%E7%94%9F%E4%BA%A7%E9%83%A8%E7%BD%B2%E7%9A%84%E5%AE%8C%E6%95%B4%E6%8C%87%E5%8D%97/"><meta property="og:site_name" content="æŠ€æœ¯åšå®¢ - æœ‰æ¡å·¥å…·"><meta property="og:title" content="LLMåº”ç”¨å¼€å‘å®æˆ˜ï¼šä»åŸå‹åˆ°ç”Ÿäº§éƒ¨ç½²çš„å®Œæ•´æŒ‡å—"><meta property="og:description" content="æ·±å…¥æ¢è®¨å¤§è¯­è¨€æ¨¡å‹åº”ç”¨å¼€å‘çš„å…¨æµç¨‹ï¼ŒåŒ…æ‹¬æ¨¡å‹é€‰æ‹©ã€æç¤ºå·¥ç¨‹ã€APIè®¾è®¡ã€æ€§èƒ½ä¼˜åŒ–å’Œç”Ÿäº§éƒ¨ç½²ç­‰å®æˆ˜æŠ€å·§ã€‚"><meta property="og:locale" content="zh-cn"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2025-12-25T22:00:00+08:00"><meta property="article:modified_time" content="2025-12-25T22:00:00+08:00"><meta property="article:tag" content="LLM"><meta property="article:tag" content="AIåº”ç”¨"><meta property="article:tag" content="Claude API"><meta property="article:tag" content="åº”ç”¨å¼€å‘"><meta property="article:tag" content="GPT"><meta name=twitter:card content="summary"><meta name=twitter:title content="LLMåº”ç”¨å¼€å‘å®æˆ˜ï¼šä»åŸå‹åˆ°ç”Ÿäº§éƒ¨ç½²çš„å®Œæ•´æŒ‡å—"><meta name=twitter:description content="æ·±å…¥æ¢è®¨å¤§è¯­è¨€æ¨¡å‹åº”ç”¨å¼€å‘çš„å…¨æµç¨‹ï¼ŒåŒ…æ‹¬æ¨¡å‹é€‰æ‹©ã€æç¤ºå·¥ç¨‹ã€APIè®¾è®¡ã€æ€§èƒ½ä¼˜åŒ–å’Œç”Ÿäº§éƒ¨ç½²ç­‰å®æˆ˜æŠ€å·§ã€‚"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"æ‰€æœ‰æ–‡ç« ","item":"/blog/posts/"},{"@type":"ListItem","position":2,"name":"LLMåº”ç”¨å¼€å‘å®æˆ˜ï¼šä»åŸå‹åˆ°ç”Ÿäº§éƒ¨ç½²çš„å®Œæ•´æŒ‡å—","item":"/blog/articles/llm%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91%E5%AE%9E%E6%88%98%E4%BB%8E%E5%8E%9F%E5%9E%8B%E5%88%B0%E7%94%9F%E4%BA%A7%E9%83%A8%E7%BD%B2%E7%9A%84%E5%AE%8C%E6%95%B4%E6%8C%87%E5%8D%97/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"LLMåº”ç”¨å¼€å‘å®æˆ˜ï¼šä»åŸå‹åˆ°ç”Ÿäº§éƒ¨ç½²çš„å®Œæ•´æŒ‡å—","name":"LLMåº”ç”¨å¼€å‘å®æˆ˜ï¼šä»åŸå‹åˆ°ç”Ÿäº§éƒ¨ç½²çš„å®Œæ•´æŒ‡å—","description":"æ·±å…¥æ¢è®¨å¤§è¯­è¨€æ¨¡å‹åº”ç”¨å¼€å‘çš„å…¨æµç¨‹ï¼ŒåŒ…æ‹¬æ¨¡å‹é€‰æ‹©ã€æç¤ºå·¥ç¨‹ã€APIè®¾è®¡ã€æ€§èƒ½ä¼˜åŒ–å’Œç”Ÿäº§éƒ¨ç½²ç­‰å®æˆ˜æŠ€å·§ã€‚","keywords":["LLM","AIåº”ç”¨","Claude API","åº”ç”¨å¼€å‘","GPT"],"articleBody":"å¤§è¯­è¨€æ¨¡å‹ï¼ˆLLMï¼‰æ­£åœ¨é‡å¡‘åº”ç”¨å¼€å‘æ–¹å¼ã€‚ä»æ™ºèƒ½å®¢æœåˆ°ä»£ç åŠ©æ‰‹ï¼Œä»å†…å®¹åˆ›ä½œåˆ°æ•°æ®åˆ†æï¼ŒLLMåº”ç”¨æ— å¤„ä¸åœ¨ã€‚æœ¬æ–‡å°†ç³»ç»Ÿæ€§åœ°ä»‹ç»LLMåº”ç”¨å¼€å‘çš„å®Œæ•´æµç¨‹ã€‚\næ¨¡å‹é€‰æ‹©ç­–ç•¥ å¼€æº vs å•†ä¸šæ¨¡å‹ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 \"\"\" æ¨¡å‹é€‰æ‹©å†³ç­–çŸ©é˜µï¼š â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ ç»´åº¦ â”‚ å•†ä¸šAPI â”‚ å¼€æºæ¨¡å‹ â”‚ è‡ªéƒ¨ç½² â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚ æˆæœ¬ â”‚ æŒ‰token â”‚ åŸºç¡€è®¾æ–½ â”‚ åŸºç¡€è®¾æ–½ â”‚ â”‚ æ€§èƒ½ â”‚ æœ€ä¼˜ â”‚ ä¸­ç­‰ â”‚ å¯å®šåˆ¶ â”‚ â”‚ æ•°æ®éšç§ â”‚ äº‘ç«¯ â”‚ æœ¬åœ° â”‚ å®Œå…¨æ§åˆ¶ â”‚ â”‚ å®šåˆ¶åŒ– â”‚ æœ‰é™ â”‚ å¾®è°ƒ â”‚ å…¨é‡è®­ç»ƒ â”‚ â”‚ å»¶è¿Ÿ â”‚ ç½‘ç»œ â”‚ æœ¬åœ°æ¨ç† â”‚ æœ¬åœ°æ¨ç† â”‚ â”‚ ç»´æŠ¤æˆæœ¬ â”‚ ä½ â”‚ ä¸­ â”‚ é«˜ â”‚ â”‚ é€‚ç”¨åœºæ™¯ â”‚ å¿«é€ŸåŸå‹ â”‚ æ•æ„Ÿæ•°æ® â”‚ æ ¸å¿ƒä¸šåŠ¡ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ \"\"\" class ModelSelector: \"\"\"æ¨¡å‹é€‰æ‹©å™¨\"\"\" def recommend_model(self, requirements: dict): \"\"\"æ ¹æ®éœ€æ±‚æ¨èæ¨¡å‹\"\"\" # æˆæœ¬æ•æ„Ÿå‹ if requirements.get(\"cost_sensitive\"): return { \"model\": \"gpt-4o-mini\", \"reason\": \"ä½æˆæœ¬ï¼Œæ€§ä»·æ¯”é«˜\", \"input_price\": 0.15, \"output_price\": 0.60 } # æ€§èƒ½ä¼˜å…ˆå‹ if requirements.get(\"performance_first\"): return { \"model\": \"claude-3-5-sonnet\", \"reason\": \"æœ€å¼ºæ€§èƒ½ï¼Œå¤æ‚æ¨ç†\", \"input_price\": 3.0, \"output_price\": 15.0 } # æ•°æ®éšç§è¦æ±‚ if requirements.get(\"data_privacy\"): return { \"model\": \"llama-3-70b\", \"reason\": \"æœ¬åœ°éƒ¨ç½²ï¼Œæ•°æ®ä¸å‡ºåŸŸ\", \"deployment\": \"on-premise\" } # å¹³è¡¡å‹ return { \"model\": \"gpt-4o\", \"reason\": \"æ€§èƒ½ä¸æˆæœ¬å¹³è¡¡\", \"input_price\": 2.5, \"output_price\": 10.0 } def estimate_cost(self, model: str, tokens_per_day: int): \"\"\"ä¼°ç®—æˆæœ¬\"\"\" pricing = { \"gpt-4o\": {\"input\": 2.5, \"output\": 10.0}, \"gpt-4o-mini\": {\"input\": 0.15, \"output\": 0.60}, \"claude-3-5-sonnet\": {\"input\": 3.0, \"output\": 15.0}, \"claude-3-haiku\": {\"input\": 0.25, \"output\": 1.25} } # å‡è®¾è¾“å…¥:è¾“å‡º = 1:2 input_tokens = tokens_per_day // 3 output_tokens = tokens_per_day * 2 // 3 daily_cost = ( (input_tokens / 1_000_000) * pricing[model][\"input\"] + (output_tokens / 1_000_000) * pricing[model][\"output\"] ) return { \"daily\": daily_cost, \"monthly\": daily_cost * 30, \"yearly\": daily_cost * 365 } API è®¾è®¡æ¨¡å¼ åŸºç¡€å°è£… 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 from anthropic import Anthropic from openai import OpenAI import tenacity class LLMClient: \"\"\"ç»Ÿä¸€çš„LLMå®¢æˆ·ç«¯\"\"\" def __init__(self, provider: str = \"anthropic\"): self.provider = provider if provider == \"anthropic\": self.client = Anthropic(api_key=os.getenv(\"ANTHROPIC_API_KEY\")) elif provider == \"openai\": self.client = OpenAI(api_key=os.getenv(\"OPENAI_API_KEY\")) else: raise ValueError(f\"Unsupported provider: {provider}\") @tenacity.retry( stop=tenacity.stop_after_attempt(3), wait=tenacity.wait_exponential(multiplier=1, min=4, max=10) ) def chat(self, messages: list, **kwargs) -\u003e str: \"\"\"èŠå¤©æ¥å£\"\"\" if self.provider == \"anthropic\": response = self.client.messages.create( model=kwargs.get(\"model\", \"claude-3-5-sonnet-20241022\"), max_tokens=kwargs.get(\"max_tokens\", 4096), temperature=kwargs.get(\"temperature\", 0.7), messages=messages ) return response.content[0].text elif self.provider == \"openai\": response = self.client.chat.completions.create( model=kwargs.get(\"model\", \"gpt-4o\"), messages=messages, temperature=kwargs.get(\"temperature\", 0.7) ) return response.choices[0].message.content def stream_chat(self, messages: list, **kwargs): \"\"\"æµå¼èŠå¤©\"\"\" if self.provider == \"anthropic\": with self.client.messages.stream( model=kwargs.get(\"model\", \"claude-3-5-sonnet-20241022\"), max_tokens=kwargs.get(\"max_tokens\", 4096), messages=messages ) as stream: for text in stream.text_stream: yield text async def achat(self, messages: list, **kwargs) -\u003e str: \"\"\"å¼‚æ­¥èŠå¤©\"\"\" # å®ç°å¼‚æ­¥ç‰ˆæœ¬... pass ç»“æ„åŒ–è¾“å‡º 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 from pydantic import BaseModel, Field from typing import List, Optional class Product(BaseModel): \"\"\"äº§å“ä¿¡æ¯æ¨¡å‹\"\"\" name: str = Field(description=\"äº§å“åç§°\") price: float = Field(description=\"äº§å“ä»·æ ¼\") category: str = Field(description=\"äº§å“ç±»åˆ«\") description: str = Field(description=\"äº§å“æè¿°\") tags: List[str] = Field(description=\"äº§å“æ ‡ç­¾\") class ExtractionApp: \"\"\"ä¿¡æ¯æå–åº”ç”¨\"\"\" def __init__(self): self.client = LLMClient(\"anthropic\") def extract_product(self, text: str) -\u003e Product: \"\"\"ä»æ–‡æœ¬ä¸­æå–äº§å“ä¿¡æ¯\"\"\" prompt = f\"\"\" ä»ä»¥ä¸‹æ–‡æœ¬ä¸­æå–äº§å“ä¿¡æ¯ï¼Œä»¥JSONæ ¼å¼è¾“å‡ºï¼š {text} è¯·æå–ï¼š - name: äº§å“åç§° - price: ä»·æ ¼ï¼ˆæ•°å­—ï¼‰ - category: ç±»åˆ« - description: æè¿° - tags: æ ‡ç­¾åˆ—è¡¨ \"\"\" response = self.client.chat([ {\"role\": \"user\", \"content\": prompt} ], temperature=0.3) # è§£æJSONå“åº” import json data = json.loads(response) return Product(**data) def batch_extract(self, texts: List[str]) -\u003e List[Product]: \"\"\"æ‰¹é‡æå–\"\"\" results = [] for text in texts: try: product = self.extract_product(text) results.append(product) except Exception as e: print(f\"Error extracting from text: {e}\") continue return results æç¤ºå·¥ç¨‹æ¨¡å¼ Chain-of-Thought 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 class ChainOfThoughtApp: \"\"\"æ€ç»´é“¾åº”ç”¨\"\"\" def __init__(self): self.client = LLMClient() def solve_math_problem(self, problem: str) -\u003e str: \"\"\"è§£å†³æ•°å­¦é—®é¢˜\"\"\" prompt = f\"\"\" è§£å†³ä»¥ä¸‹æ•°å­¦é—®é¢˜ï¼Œè¯·ä¸€æ­¥æ­¥æ€è€ƒï¼š {problem} è¯·æŒ‰ä»¥ä¸‹æ ¼å¼å›ç­”ï¼š 1. ç†è§£é—®é¢˜ 2. åˆ¶å®šè®¡åˆ’ 3. åˆ†æ­¥è®¡ç®— 4. å¾—å‡ºç­”æ¡ˆ 5. éªŒè¯ç»“æœ \"\"\" response = self.client.chat([ {\"role\": \"user\", \"content\": prompt} ], temperature=0.5) return response def complex_reasoning(self, question: str) -\u003e str: \"\"\"å¤æ‚æ¨ç†\"\"\" prompt = f\"\"\" è¯·ä»”ç»†æ€è€ƒä»¥ä¸‹é—®é¢˜ï¼Œç»™å‡ºè¯¦ç»†çš„åˆ†æå’Œç»“è®ºï¼š {question} è¦æ±‚ï¼š 1. è¯†åˆ«é—®é¢˜çš„æ ¸å¿ƒè¦ç´  2. åˆ†æå„ç§å¯èƒ½çš„æƒ…å†µ 3. é€æ­¥æ¨ç†å¾—å‡ºç»“è®º 4. æ£€æŸ¥ç»“è®ºçš„åˆç†æ€§ \"\"\" return self.client.chat([ {\"role\": \"user\", \"content\": prompt} ]) Few-Shot Learning 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 class FewShotApp: \"\"\"å°‘æ ·æœ¬å­¦ä¹ åº”ç”¨\"\"\" def __init__(self): self.client = LLMClient() def sentiment_analysis(self, text: str) -\u003e str: \"\"\"æƒ…æ„Ÿåˆ†æï¼ˆå°‘æ ·æœ¬ï¼‰\"\"\" examples = [ { \"text\": \"è¿™ä¸ªäº§å“å¤ªæ£’äº†ï¼éå¸¸æ¨èï¼\", \"sentiment\": \"positive\" }, { \"text\": \"è´¨é‡ä¸€èˆ¬ï¼Œä»·æ ¼åé«˜\", \"sentiment\": \"neutral\" }, { \"text\": \"å®Œå…¨æµªè´¹é’±ï¼Œå¼ºçƒˆä¸æ¨è\", \"sentiment\": \"negative\" } ] prompt = \"ä»¥ä¸‹æ˜¯æ–‡æœ¬çš„æƒ…æ„Ÿåˆ†ç±»ç¤ºä¾‹ï¼š\\n\\n\" for ex in examples: prompt += f\"æ–‡æœ¬: {ex['text']}\\n\" prompt += f\"æƒ…æ„Ÿ: {ex['sentiment']}\\n\\n\" prompt += f\"ç°åœ¨åˆ†æä»¥ä¸‹æ–‡æœ¬çš„æƒ…æ„Ÿï¼š\\n{text}\\n\" prompt += \"æƒ…æ„Ÿï¼š\" response = self.client.chat([ {\"role\": \"user\", \"content\": prompt} ], temperature=0.3) return response.strip() RAG åŸºç¡€å®ç° 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 from sentence_transformers import SentenceTransformer import faiss import numpy as np class SimpleRAG: \"\"\"ç®€å•çš„RAGç³»ç»Ÿ\"\"\" def __init__(self): self.client = LLMClient() self.embedder = SentenceTransformer('all-MiniLM-L6-v2') self.index = None self.documents = [] def add_documents(self, docs: List[str]): \"\"\"æ·»åŠ æ–‡æ¡£\"\"\" # ç”ŸæˆåµŒå…¥ embeddings = self.embedder.encode(docs) # å½’ä¸€åŒ– faiss.normalize_L2(embeddings) # åˆ›å»ºç´¢å¼• if self.index is None: dimension = embeddings.shape[1] self.index = faiss.IndexFlatIP(dimension) # æ·»åŠ åˆ°ç´¢å¼• self.index.add(embeddings.astype('float32')) # å­˜å‚¨æ–‡æ¡£ self.documents.extend(docs) def retrieve(self, query: str, k: int = 5) -\u003e List[str]: \"\"\"æ£€ç´¢ç›¸å…³æ–‡æ¡£\"\"\" # ç”ŸæˆæŸ¥è¯¢åµŒå…¥ query_embedding = self.embedder.encode([query]) faiss.normalize_L2(query_embedding) # æœç´¢ scores, indices = self.index.search( query_embedding.astype('float32'), k ) # è¿”å›æ–‡æ¡£ results = [] for score, idx in zip(scores[0], indices[0]): results.append({ \"document\": self.documents[idx], \"score\": float(score) }) return results def ask(self, question: str) -\u003e str: \"\"\"é—®ç­”\"\"\" # æ£€ç´¢ç›¸å…³æ–‡æ¡£ context_docs = self.retrieve(question, k=3) # æ„å»ºæç¤º context = \"\\n\\n\".join([ doc[\"document\"] for doc in context_docs ]) prompt = f\"\"\" åŸºäºä»¥ä¸‹ä¿¡æ¯å›ç­”é—®é¢˜ï¼š {context} é—®é¢˜ï¼š{question} å¦‚æœä¿¡æ¯ä¸è¶³ä»¥å›ç­”ï¼Œè¯·æ˜ç¡®è¯´æ˜ã€‚ \"\"\" response = self.client.chat([ {\"role\": \"user\", \"content\": prompt} ]) return response ç”Ÿäº§éƒ¨ç½² 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 from fastapi import FastAPI, HTTPException from pydantic import BaseModel from typing import List import redis import json app = FastAPI(title=\"LLM API Service\") # å…¨å±€é…ç½® llm_client = LLMClient(\"anthropic\") cache = redis.Redis(host='localhost', port=6379, db=0) class ChatRequest(BaseModel): messages: List[dict] temperature: float = 0.7 max_tokens: int = 4096 stream: bool = False class ChatResponse(BaseModel): content: str model: str tokens_used: int @app.post(\"/api/chat\", response_model=ChatResponse) async def chat(request: ChatRequest): \"\"\"èŠå¤©æ¥å£\"\"\" # ç”Ÿæˆç¼“å­˜key cache_key = f\"chat:{hash(str(request.messages))}\" # å°è¯•ä»ç¼“å­˜è·å– cached = cache.get(cache_key) if cached: return ChatResponse(**json.loads(cached)) try: # è°ƒç”¨LLM response = llm_client.chat( request.messages, temperature=request.temperature, max_tokens=request.max_tokens ) result = ChatResponse( content=response, model=\"claude-3-5-sonnet\", tokens_used=0 # éœ€è¦ä»å“åº”ä¸­è·å– ) # ç¼“å­˜ç»“æœï¼ˆ1å°æ—¶ï¼‰ cache.setex( cache_key, 3600, json.dumps(result.dict()) ) return result except Exception as e: raise HTTPException(status_code=500, detail=str(e)) @app.post(\"/api/chat/stream\") async def chat_stream(request: ChatRequest): \"\"\"æµå¼èŠå¤©\"\"\" async def generate(): try: for chunk in llm_client.stream_chat( request.messages, temperature=request.temperature, max_tokens=request.max_tokens ): yield f\"data: {json.dumps({'content': chunk})}\\n\\n\" except Exception as e: yield f\"data: {json.dumps({'error': str(e)})}\\n\\n\" yield \"data: [DONE]\\n\\n\" from fastapi.responses import StreamingResponse return StreamingResponse( generate(), media_type=\"text/event-stream\" ) # å¯åŠ¨å‘½ä»¤ # uvicorn api:app --host 0.0.0.0 --port 8000 --workers 4 æ€§èƒ½ä¼˜åŒ– 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 class PerformanceOptimizer: \"\"\"æ€§èƒ½ä¼˜åŒ–å™¨\"\"\" def implement_caching(self): \"\"\"å®ç°å¤šå±‚ç¼“å­˜\"\"\" cache_strategy = { \"l1_memory\": { \"ttl\": 300, # 5åˆ†é’Ÿ \"max_size\": 1000 }, \"l2_redis\": { \"ttl\": 3600, # 1å°æ—¶ \"max_size\": 10000 }, \"l3_database\": { \"ttl\": 86400 # 1å¤© } } return cache_strategy def batch_processing(self, prompts: List[str]) -\u003e List[str]: \"\"\"æ‰¹é‡å¤„ç†\"\"\" # ä½¿ç”¨å¤šçº¿ç¨‹å¹¶å‘è¯·æ±‚ from concurrent.futures import ThreadPoolExecutor with ThreadPoolExecutor(max_workers=5) as executor: results = list(executor.map( self.client.chat, [{\"role\": \"user\", \"content\": p} for p in prompts] )) return results def token_optimization(self, prompt: str) -\u003e str: \"\"\"Tokenä¼˜åŒ–\"\"\" # ç§»é™¤å†—ä½™ä¿¡æ¯ optimized = ( prompt .replace(\"è¯·\", \"\") .replace(\"æ‚¨\", \"\") .replace(\"å¥½çš„ï¼Œ\", \"\") ) return optimized.strip() æ€»ç»“ LLMåº”ç”¨å¼€å‘çš„å…³é”®è¦ç‚¹ï¼š\næ¨¡å‹é€‰æ‹©ï¼šæ ¹æ®åœºæ™¯é€‰æ‹©åˆé€‚çš„æ¨¡å‹ APIè®¾è®¡ï¼šç»Ÿä¸€çš„æ¥å£å’Œé”™è¯¯å¤„ç† æç¤ºå·¥ç¨‹ï¼šç²¾å¿ƒè®¾è®¡æç¤ºè¯ RAGæŠ€æœ¯ï¼šç»“åˆé¢†åŸŸçŸ¥è¯† æ€§èƒ½ä¼˜åŒ–ï¼šç¼“å­˜ã€æ‰¹å¤„ç†ã€æµå¼è¾“å‡º ç›‘æ§å‘Šè­¦ï¼šè·Ÿè¸ªä½¿ç”¨æƒ…å†µå’Œæˆæœ¬ å®‰å…¨é˜²æŠ¤ï¼šè¾“å…¥éªŒè¯ã€å†…å®¹è¿‡æ»¤ LLMåº”ç”¨å¼€å‘æ˜¯ä¸€ä¸ªæŒç»­ä¼˜åŒ–çš„è¿‡ç¨‹ï¼Œéœ€è¦æ ¹æ®å®é™…ä½¿ç”¨æƒ…å†µä¸æ–­è°ƒæ•´ã€‚\n","wordCount":"1522","inLanguage":"zh-cn","datePublished":"2025-12-25T22:00:00+08:00","dateModified":"2025-12-25T22:00:00+08:00","author":{"@type":"Person","name":"æœ‰æ¡å·¥å…·å›¢é˜Ÿ"},"mainEntityOfPage":{"@type":"WebPage","@id":"/blog/articles/llm%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91%E5%AE%9E%E6%88%98%E4%BB%8E%E5%8E%9F%E5%9E%8B%E5%88%B0%E7%94%9F%E4%BA%A7%E9%83%A8%E7%BD%B2%E7%9A%84%E5%AE%8C%E6%95%B4%E6%8C%87%E5%8D%97/"},"publisher":{"@type":"Organization","name":"æŠ€æœ¯åšå®¢ - æœ‰æ¡å·¥å…·","logo":{"@type":"ImageObject","url":"/favicon.ico"}}}</script></head><body id=top><header class=header><nav class=nav><div class=logo><a href=/blog/ accesskey=h title="æŠ€æœ¯åšå®¢ - æœ‰æ¡å·¥å…· (Alt + H)">æŠ€æœ¯åšå®¢ - æœ‰æ¡å·¥å…·</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=/blog/posts/ title="æ‰€æœ‰æ–‡ç« åˆ—è¡¨ - æœ‰æ¡å·¥å…·æŠ€æœ¯åšå®¢ï¼šæŸ¥çœ‹æ‰€æœ‰æŠ€æœ¯æ–‡ç« å’Œæ•™ç¨‹å†…å®¹"><span>æ–‡ç« </span></a></li><li><a href=https://www.util.cn title="æœ‰æ¡å·¥å…· - å¼€å‘è€…çš„å¸¸ç”¨å·¥å…·é›†åˆï¼šæ— å¹¿å‘Š Â· æœ¬åœ°è®¡ç®— Â· å³å¼€å³ç”¨çš„åœ¨çº¿å·¥å…·å¹³å°ï¼Œæä¾›JSONæ ¼å¼åŒ–ã€SQLæ ¼å¼åŒ–ã€Markdownç¼–è¾‘å™¨ç­‰å®ç”¨å·¥å…·"><span>æœ‰æ¡å·¥å…·</span>&nbsp;
<svg fill="none" shape-rendering="geometricPrecision" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" height="12" width="12"><path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"/><path d="M15 3h6v6"/><path d="M10 14 21 3"/></svg></a></li><li><a href=/blog/categories/ title="æ–‡ç« åˆ†ç±» - æœ‰æ¡å·¥å…·æŠ€æœ¯åšå®¢ï¼šæŒ‰æŠ€æœ¯é¢†åŸŸåˆ†ç±»çš„ä¼˜è´¨æ–‡ç« ï¼ŒåŒ…æ‹¬å‰ç«¯å¼€å‘ã€å·¥å…·ä½¿ç”¨ã€ç¼–ç¨‹æŠ€å·§ç­‰"><span>åˆ†ç±»</span></a></li><li><a href=/blog/tags/ title="æ ‡ç­¾äº‘ - æœ‰æ¡å·¥å…·æŠ€æœ¯åšå®¢ï¼šé€šè¿‡æ ‡ç­¾å¿«é€Ÿæ‰¾åˆ°æ„Ÿå…´è¶£çš„æŠ€æœ¯æ–‡ç« å’Œæ•™ç¨‹å†…å®¹"><span>æ ‡ç­¾</span></a></li><li><a href=/blog/archives/ title="æ–‡ç« å½’æ¡£ - æœ‰æ¡å·¥å…·æŠ€æœ¯åšå®¢ï¼šæŒ‰æ—¶é—´æŸ¥çœ‹å†å²æ–‡ç« "><span>å½’æ¡£</span></a></li><li><a href=/blog/search/ title="æœç´¢æ–‡ç«  - æœ‰æ¡å·¥å…·æŠ€æœ¯åšå®¢ï¼šé€šè¿‡å…³é”®è¯æœç´¢æ‰¾åˆ°æ„Ÿå…´è¶£çš„æŠ€æœ¯æ–‡ç« å’Œæ•™ç¨‹å†…å®¹ï¼Œæ”¯æŒæ ‡é¢˜ã€å†…å®¹ã€åˆ†ç±»å’Œæ ‡ç­¾æœç´¢"><span>æœç´¢</span></a></li></ul></nav></header><main class=main><article class=post-single><div class=post-content-wrapper><main class=post-content-main><header class=post-header-main><h1 class="post-title entry-hint-parent">LLMåº”ç”¨å¼€å‘å®æˆ˜ï¼šä»åŸå‹åˆ°ç”Ÿäº§éƒ¨ç½²çš„å®Œæ•´æŒ‡å—</h1><div class=post-meta><div class=post-meta-content><div class=post-categories-inline><a href=/blog/categories/ai%E5%BC%80%E5%8F%91/ class=category-link>AIå¼€å‘</a></div><span class=post-date>2025-12-25</span><span class=post-author>æœ‰æ¡å·¥å…·å›¢é˜Ÿ</span></div><style>.post-meta-content{display:flex;align-items:center;flex-wrap:wrap;gap:.75rem;font-family:sf mono,monaco,courier new,monospace;font-size:.875rem;color:#9ca3af !important}.post-categories-inline{display:inline-flex;align-items:center;gap:.5rem}.category-link{display:inline-flex;align-items:center;gap:.25rem;padding:.25rem .75rem;background:rgba(255,255,255,.1);color:#e5e7eb !important;text-decoration:none;font-size:.75rem;font-weight:600;text-transform:uppercase;letter-spacing:.05em;border:1px solid rgba(255,255,255,.2);border-radius:0;transition:all .3s ease;white-space:nowrap}.category-link:hover{background:rgba(255,255,255,.2);color:#fff !important;border-color:rgba(255,255,255,.3);transform:translateY(-1px)}.category-link::before{content:'ğŸ“';font-size:.7rem;opacity:.8}.post-date,.post-reading-time,.post-word-count,.post-author{color:#9ca3af !important}[data-theme=dark] .post-meta-content{color:#9ca3af !important}[data-theme=dark] .category-link{background:rgba(255,255,255,.1);color:#e5e7eb !important;border-color:rgba(255,255,255,.2)}[data-theme=dark] .category-link:hover{background:rgba(255,255,255,.2);color:#fff !important;border-color:rgba(255,255,255,.3)}[data-theme=dark] .post-date,[data-theme=dark] .post-reading-time,[data-theme=dark] .post-word-count,[data-theme=dark] .post-author{color:#9ca3af !important}[data-theme=light] .post-meta-content{color:#6c757d !important}[data-theme=light] .category-link{background:rgba(0,0,0,5%);color:#495057 !important;border-color:rgba(0,0,0,.15)}[data-theme=light] .category-link:hover{background:rgba(0,102,204,.1);color:#212529 !important;border-color:rgba(0,102,204,.3)}[data-theme=light] .post-date,[data-theme=light] .post-reading-time,[data-theme=light] .post-word-count,[data-theme=light] .post-author{color:#6c757d !important}@media(max-width:768px){.post-meta-content{gap:.5rem;font-size:.8rem}.category-link{padding:.2rem .6rem;font-size:.7rem}}</style></div></header><div class=post-content><p>å¤§è¯­è¨€æ¨¡å‹ï¼ˆLLMï¼‰æ­£åœ¨é‡å¡‘åº”ç”¨å¼€å‘æ–¹å¼ã€‚ä»æ™ºèƒ½å®¢æœåˆ°ä»£ç åŠ©æ‰‹ï¼Œä»å†…å®¹åˆ›ä½œåˆ°æ•°æ®åˆ†æï¼ŒLLMåº”ç”¨æ— å¤„ä¸åœ¨ã€‚æœ¬æ–‡å°†ç³»ç»Ÿæ€§åœ°ä»‹ç»LLMåº”ç”¨å¼€å‘çš„å®Œæ•´æµç¨‹ã€‚</p><h2 id=æ¨¡å‹é€‰æ‹©ç­–ç•¥>æ¨¡å‹é€‰æ‹©ç­–ç•¥<a hidden class=anchor aria-hidden=true href=#æ¨¡å‹é€‰æ‹©ç­–ç•¥>#</a></h2><h3 id=å¼€æº-vs-å•†ä¸šæ¨¡å‹>å¼€æº vs å•†ä¸šæ¨¡å‹<a hidden class=anchor aria-hidden=true href=#å¼€æº-vs-å•†ä¸šæ¨¡å‹>#</a></h3><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">56
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">57
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">58
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">59
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">60
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">61
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">62
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">63
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">64
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">65
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">66
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">67
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">68
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">69
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">70
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">71
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">72
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">73
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">74
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">75
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">76
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">77
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">78
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">79
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">80
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#a5d6ff>&#34;&#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>æ¨¡å‹é€‰æ‹©å†³ç­–çŸ©é˜µï¼š
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>â”‚    ç»´åº¦     â”‚  å•†ä¸šAPI  â”‚  å¼€æºæ¨¡å‹ â”‚  è‡ªéƒ¨ç½²   â”‚
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>â”‚ æˆæœ¬        â”‚ æŒ‰token   â”‚ åŸºç¡€è®¾æ–½  â”‚ åŸºç¡€è®¾æ–½  â”‚
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>â”‚ æ€§èƒ½        â”‚ æœ€ä¼˜      â”‚ ä¸­ç­‰      â”‚ å¯å®šåˆ¶    â”‚
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>â”‚ æ•°æ®éšç§    â”‚ äº‘ç«¯      â”‚ æœ¬åœ°      â”‚ å®Œå…¨æ§åˆ¶  â”‚
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>â”‚ å®šåˆ¶åŒ–      â”‚ æœ‰é™      â”‚ å¾®è°ƒ      â”‚ å…¨é‡è®­ç»ƒ  â”‚
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>â”‚ å»¶è¿Ÿ        â”‚ ç½‘ç»œ      â”‚ æœ¬åœ°æ¨ç†  â”‚ æœ¬åœ°æ¨ç†  â”‚
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>â”‚ ç»´æŠ¤æˆæœ¬    â”‚ ä½        â”‚ ä¸­        â”‚ é«˜        â”‚
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>â”‚ é€‚ç”¨åœºæ™¯    â”‚ å¿«é€ŸåŸå‹  â”‚ æ•æ„Ÿæ•°æ®  â”‚ æ ¸å¿ƒä¸šåŠ¡  â”‚
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>class</span> <span style=color:#f0883e;font-weight:700>ModelSelector</span>:
</span></span><span style=display:flex><span>    <span style=color:#a5d6ff>&#34;&#34;&#34;æ¨¡å‹é€‰æ‹©å™¨&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>recommend_model</span>(self, requirements: dict):
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;&#34;&#34;æ ¹æ®éœ€æ±‚æ¨èæ¨¡å‹&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># æˆæœ¬æ•æ„Ÿå‹</span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>if</span> requirements<span style=color:#ff7b72;font-weight:700>.</span>get(<span style=color:#a5d6ff>&#34;cost_sensitive&#34;</span>):
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>return</span> {
</span></span><span style=display:flex><span>                <span style=color:#a5d6ff>&#34;model&#34;</span>: <span style=color:#a5d6ff>&#34;gpt-4o-mini&#34;</span>,
</span></span><span style=display:flex><span>                <span style=color:#a5d6ff>&#34;reason&#34;</span>: <span style=color:#a5d6ff>&#34;ä½æˆæœ¬ï¼Œæ€§ä»·æ¯”é«˜&#34;</span>,
</span></span><span style=display:flex><span>                <span style=color:#a5d6ff>&#34;input_price&#34;</span>: <span style=color:#a5d6ff>0.15</span>,
</span></span><span style=display:flex><span>                <span style=color:#a5d6ff>&#34;output_price&#34;</span>: <span style=color:#a5d6ff>0.60</span>
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># æ€§èƒ½ä¼˜å…ˆå‹</span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>if</span> requirements<span style=color:#ff7b72;font-weight:700>.</span>get(<span style=color:#a5d6ff>&#34;performance_first&#34;</span>):
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>return</span> {
</span></span><span style=display:flex><span>                <span style=color:#a5d6ff>&#34;model&#34;</span>: <span style=color:#a5d6ff>&#34;claude-3-5-sonnet&#34;</span>,
</span></span><span style=display:flex><span>                <span style=color:#a5d6ff>&#34;reason&#34;</span>: <span style=color:#a5d6ff>&#34;æœ€å¼ºæ€§èƒ½ï¼Œå¤æ‚æ¨ç†&#34;</span>,
</span></span><span style=display:flex><span>                <span style=color:#a5d6ff>&#34;input_price&#34;</span>: <span style=color:#a5d6ff>3.0</span>,
</span></span><span style=display:flex><span>                <span style=color:#a5d6ff>&#34;output_price&#34;</span>: <span style=color:#a5d6ff>15.0</span>
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># æ•°æ®éšç§è¦æ±‚</span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>if</span> requirements<span style=color:#ff7b72;font-weight:700>.</span>get(<span style=color:#a5d6ff>&#34;data_privacy&#34;</span>):
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>return</span> {
</span></span><span style=display:flex><span>                <span style=color:#a5d6ff>&#34;model&#34;</span>: <span style=color:#a5d6ff>&#34;llama-3-70b&#34;</span>,
</span></span><span style=display:flex><span>                <span style=color:#a5d6ff>&#34;reason&#34;</span>: <span style=color:#a5d6ff>&#34;æœ¬åœ°éƒ¨ç½²ï¼Œæ•°æ®ä¸å‡ºåŸŸ&#34;</span>,
</span></span><span style=display:flex><span>                <span style=color:#a5d6ff>&#34;deployment&#34;</span>: <span style=color:#a5d6ff>&#34;on-premise&#34;</span>
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># å¹³è¡¡å‹</span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>return</span> {
</span></span><span style=display:flex><span>            <span style=color:#a5d6ff>&#34;model&#34;</span>: <span style=color:#a5d6ff>&#34;gpt-4o&#34;</span>,
</span></span><span style=display:flex><span>            <span style=color:#a5d6ff>&#34;reason&#34;</span>: <span style=color:#a5d6ff>&#34;æ€§èƒ½ä¸æˆæœ¬å¹³è¡¡&#34;</span>,
</span></span><span style=display:flex><span>            <span style=color:#a5d6ff>&#34;input_price&#34;</span>: <span style=color:#a5d6ff>2.5</span>,
</span></span><span style=display:flex><span>            <span style=color:#a5d6ff>&#34;output_price&#34;</span>: <span style=color:#a5d6ff>10.0</span>
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>estimate_cost</span>(self, model: str, tokens_per_day: int):
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;&#34;&#34;ä¼°ç®—æˆæœ¬&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        pricing <span style=color:#ff7b72;font-weight:700>=</span> {
</span></span><span style=display:flex><span>            <span style=color:#a5d6ff>&#34;gpt-4o&#34;</span>: {<span style=color:#a5d6ff>&#34;input&#34;</span>: <span style=color:#a5d6ff>2.5</span>, <span style=color:#a5d6ff>&#34;output&#34;</span>: <span style=color:#a5d6ff>10.0</span>},
</span></span><span style=display:flex><span>            <span style=color:#a5d6ff>&#34;gpt-4o-mini&#34;</span>: {<span style=color:#a5d6ff>&#34;input&#34;</span>: <span style=color:#a5d6ff>0.15</span>, <span style=color:#a5d6ff>&#34;output&#34;</span>: <span style=color:#a5d6ff>0.60</span>},
</span></span><span style=display:flex><span>            <span style=color:#a5d6ff>&#34;claude-3-5-sonnet&#34;</span>: {<span style=color:#a5d6ff>&#34;input&#34;</span>: <span style=color:#a5d6ff>3.0</span>, <span style=color:#a5d6ff>&#34;output&#34;</span>: <span style=color:#a5d6ff>15.0</span>},
</span></span><span style=display:flex><span>            <span style=color:#a5d6ff>&#34;claude-3-haiku&#34;</span>: {<span style=color:#a5d6ff>&#34;input&#34;</span>: <span style=color:#a5d6ff>0.25</span>, <span style=color:#a5d6ff>&#34;output&#34;</span>: <span style=color:#a5d6ff>1.25</span>}
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># å‡è®¾è¾“å…¥:è¾“å‡º = 1:2</span>
</span></span><span style=display:flex><span>        input_tokens <span style=color:#ff7b72;font-weight:700>=</span> tokens_per_day <span style=color:#ff7b72;font-weight:700>//</span> <span style=color:#a5d6ff>3</span>
</span></span><span style=display:flex><span>        output_tokens <span style=color:#ff7b72;font-weight:700>=</span> tokens_per_day <span style=color:#ff7b72;font-weight:700>*</span> <span style=color:#a5d6ff>2</span> <span style=color:#ff7b72;font-weight:700>//</span> <span style=color:#a5d6ff>3</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        daily_cost <span style=color:#ff7b72;font-weight:700>=</span> (
</span></span><span style=display:flex><span>            (input_tokens <span style=color:#ff7b72;font-weight:700>/</span> <span style=color:#a5d6ff>1_000_000</span>) <span style=color:#ff7b72;font-weight:700>*</span> pricing[model][<span style=color:#a5d6ff>&#34;input&#34;</span>] <span style=color:#ff7b72;font-weight:700>+</span>
</span></span><span style=display:flex><span>            (output_tokens <span style=color:#ff7b72;font-weight:700>/</span> <span style=color:#a5d6ff>1_000_000</span>) <span style=color:#ff7b72;font-weight:700>*</span> pricing[model][<span style=color:#a5d6ff>&#34;output&#34;</span>]
</span></span><span style=display:flex><span>        )
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>return</span> {
</span></span><span style=display:flex><span>            <span style=color:#a5d6ff>&#34;daily&#34;</span>: daily_cost,
</span></span><span style=display:flex><span>            <span style=color:#a5d6ff>&#34;monthly&#34;</span>: daily_cost <span style=color:#ff7b72;font-weight:700>*</span> <span style=color:#a5d6ff>30</span>,
</span></span><span style=display:flex><span>            <span style=color:#a5d6ff>&#34;yearly&#34;</span>: daily_cost <span style=color:#ff7b72;font-weight:700>*</span> <span style=color:#a5d6ff>365</span>
</span></span><span style=display:flex><span>        }
</span></span></code></pre></td></tr></table></div></div><h2 id=api-è®¾è®¡æ¨¡å¼>API è®¾è®¡æ¨¡å¼<a hidden class=anchor aria-hidden=true href=#api-è®¾è®¡æ¨¡å¼>#</a></h2><h3 id=åŸºç¡€å°è£…>åŸºç¡€å°è£…<a hidden class=anchor aria-hidden=true href=#åŸºç¡€å°è£…>#</a></h3><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">56
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">57
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#ff7b72>from</span> <span style=color:#ff7b72>anthropic</span> <span style=color:#ff7b72>import</span> Anthropic
</span></span><span style=display:flex><span><span style=color:#ff7b72>from</span> <span style=color:#ff7b72>openai</span> <span style=color:#ff7b72>import</span> OpenAI
</span></span><span style=display:flex><span><span style=color:#ff7b72>import</span> <span style=color:#ff7b72>tenacity</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>class</span> <span style=color:#f0883e;font-weight:700>LLMClient</span>:
</span></span><span style=display:flex><span>    <span style=color:#a5d6ff>&#34;&#34;&#34;ç»Ÿä¸€çš„LLMå®¢æˆ·ç«¯&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>__init__</span>(self, provider: str <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>&#34;anthropic&#34;</span>):
</span></span><span style=display:flex><span>        self<span style=color:#ff7b72;font-weight:700>.</span>provider <span style=color:#ff7b72;font-weight:700>=</span> provider
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>if</span> provider <span style=color:#ff7b72;font-weight:700>==</span> <span style=color:#a5d6ff>&#34;anthropic&#34;</span>:
</span></span><span style=display:flex><span>            self<span style=color:#ff7b72;font-weight:700>.</span>client <span style=color:#ff7b72;font-weight:700>=</span> Anthropic(api_key<span style=color:#ff7b72;font-weight:700>=</span>os<span style=color:#ff7b72;font-weight:700>.</span>getenv(<span style=color:#a5d6ff>&#34;ANTHROPIC_API_KEY&#34;</span>))
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>elif</span> provider <span style=color:#ff7b72;font-weight:700>==</span> <span style=color:#a5d6ff>&#34;openai&#34;</span>:
</span></span><span style=display:flex><span>            self<span style=color:#ff7b72;font-weight:700>.</span>client <span style=color:#ff7b72;font-weight:700>=</span> OpenAI(api_key<span style=color:#ff7b72;font-weight:700>=</span>os<span style=color:#ff7b72;font-weight:700>.</span>getenv(<span style=color:#a5d6ff>&#34;OPENAI_API_KEY&#34;</span>))
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>else</span>:
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>raise</span> <span style=color:#f0883e;font-weight:700>ValueError</span>(<span style=color:#79c0ff>f</span><span style=color:#a5d6ff>&#34;Unsupported provider: </span><span style=color:#a5d6ff>{</span>provider<span style=color:#a5d6ff>}</span><span style=color:#a5d6ff>&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#d2a8ff;font-weight:700>@tenacity.retry</span>(
</span></span><span style=display:flex><span>        stop<span style=color:#ff7b72;font-weight:700>=</span>tenacity<span style=color:#ff7b72;font-weight:700>.</span>stop_after_attempt(<span style=color:#a5d6ff>3</span>),
</span></span><span style=display:flex><span>        wait<span style=color:#ff7b72;font-weight:700>=</span>tenacity<span style=color:#ff7b72;font-weight:700>.</span>wait_exponential(multiplier<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>1</span>, min<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>4</span>, max<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>10</span>)
</span></span><span style=display:flex><span>    )
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>chat</span>(self, messages: list, <span style=color:#ff7b72;font-weight:700>**</span>kwargs) <span style=color:#ff7b72;font-weight:700>-&gt;</span> str:
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;&#34;&#34;èŠå¤©æ¥å£&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>if</span> self<span style=color:#ff7b72;font-weight:700>.</span>provider <span style=color:#ff7b72;font-weight:700>==</span> <span style=color:#a5d6ff>&#34;anthropic&#34;</span>:
</span></span><span style=display:flex><span>            response <span style=color:#ff7b72;font-weight:700>=</span> self<span style=color:#ff7b72;font-weight:700>.</span>client<span style=color:#ff7b72;font-weight:700>.</span>messages<span style=color:#ff7b72;font-weight:700>.</span>create(
</span></span><span style=display:flex><span>                model<span style=color:#ff7b72;font-weight:700>=</span>kwargs<span style=color:#ff7b72;font-weight:700>.</span>get(<span style=color:#a5d6ff>&#34;model&#34;</span>, <span style=color:#a5d6ff>&#34;claude-3-5-sonnet-20241022&#34;</span>),
</span></span><span style=display:flex><span>                max_tokens<span style=color:#ff7b72;font-weight:700>=</span>kwargs<span style=color:#ff7b72;font-weight:700>.</span>get(<span style=color:#a5d6ff>&#34;max_tokens&#34;</span>, <span style=color:#a5d6ff>4096</span>),
</span></span><span style=display:flex><span>                temperature<span style=color:#ff7b72;font-weight:700>=</span>kwargs<span style=color:#ff7b72;font-weight:700>.</span>get(<span style=color:#a5d6ff>&#34;temperature&#34;</span>, <span style=color:#a5d6ff>0.7</span>),
</span></span><span style=display:flex><span>                messages<span style=color:#ff7b72;font-weight:700>=</span>messages
</span></span><span style=display:flex><span>            )
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>return</span> response<span style=color:#ff7b72;font-weight:700>.</span>content[<span style=color:#a5d6ff>0</span>]<span style=color:#ff7b72;font-weight:700>.</span>text
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>elif</span> self<span style=color:#ff7b72;font-weight:700>.</span>provider <span style=color:#ff7b72;font-weight:700>==</span> <span style=color:#a5d6ff>&#34;openai&#34;</span>:
</span></span><span style=display:flex><span>            response <span style=color:#ff7b72;font-weight:700>=</span> self<span style=color:#ff7b72;font-weight:700>.</span>client<span style=color:#ff7b72;font-weight:700>.</span>chat<span style=color:#ff7b72;font-weight:700>.</span>completions<span style=color:#ff7b72;font-weight:700>.</span>create(
</span></span><span style=display:flex><span>                model<span style=color:#ff7b72;font-weight:700>=</span>kwargs<span style=color:#ff7b72;font-weight:700>.</span>get(<span style=color:#a5d6ff>&#34;model&#34;</span>, <span style=color:#a5d6ff>&#34;gpt-4o&#34;</span>),
</span></span><span style=display:flex><span>                messages<span style=color:#ff7b72;font-weight:700>=</span>messages,
</span></span><span style=display:flex><span>                temperature<span style=color:#ff7b72;font-weight:700>=</span>kwargs<span style=color:#ff7b72;font-weight:700>.</span>get(<span style=color:#a5d6ff>&#34;temperature&#34;</span>, <span style=color:#a5d6ff>0.7</span>)
</span></span><span style=display:flex><span>            )
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>return</span> response<span style=color:#ff7b72;font-weight:700>.</span>choices[<span style=color:#a5d6ff>0</span>]<span style=color:#ff7b72;font-weight:700>.</span>message<span style=color:#ff7b72;font-weight:700>.</span>content
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>stream_chat</span>(self, messages: list, <span style=color:#ff7b72;font-weight:700>**</span>kwargs):
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;&#34;&#34;æµå¼èŠå¤©&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>if</span> self<span style=color:#ff7b72;font-weight:700>.</span>provider <span style=color:#ff7b72;font-weight:700>==</span> <span style=color:#a5d6ff>&#34;anthropic&#34;</span>:
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>with</span> self<span style=color:#ff7b72;font-weight:700>.</span>client<span style=color:#ff7b72;font-weight:700>.</span>messages<span style=color:#ff7b72;font-weight:700>.</span>stream(
</span></span><span style=display:flex><span>                model<span style=color:#ff7b72;font-weight:700>=</span>kwargs<span style=color:#ff7b72;font-weight:700>.</span>get(<span style=color:#a5d6ff>&#34;model&#34;</span>, <span style=color:#a5d6ff>&#34;claude-3-5-sonnet-20241022&#34;</span>),
</span></span><span style=display:flex><span>                max_tokens<span style=color:#ff7b72;font-weight:700>=</span>kwargs<span style=color:#ff7b72;font-weight:700>.</span>get(<span style=color:#a5d6ff>&#34;max_tokens&#34;</span>, <span style=color:#a5d6ff>4096</span>),
</span></span><span style=display:flex><span>                messages<span style=color:#ff7b72;font-weight:700>=</span>messages
</span></span><span style=display:flex><span>            ) <span style=color:#ff7b72>as</span> stream:
</span></span><span style=display:flex><span>                <span style=color:#ff7b72>for</span> text <span style=color:#ff7b72;font-weight:700>in</span> stream<span style=color:#ff7b72;font-weight:700>.</span>text_stream:
</span></span><span style=display:flex><span>                    <span style=color:#ff7b72>yield</span> text
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>async</span> <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>achat</span>(self, messages: list, <span style=color:#ff7b72;font-weight:700>**</span>kwargs) <span style=color:#ff7b72;font-weight:700>-&gt;</span> str:
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;&#34;&#34;å¼‚æ­¥èŠå¤©&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># å®ç°å¼‚æ­¥ç‰ˆæœ¬...</span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>pass</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=ç»“æ„åŒ–è¾“å‡º>ç»“æ„åŒ–è¾“å‡º<a hidden class=anchor aria-hidden=true href=#ç»“æ„åŒ–è¾“å‡º>#</a></h3><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">55
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#ff7b72>from</span> <span style=color:#ff7b72>pydantic</span> <span style=color:#ff7b72>import</span> BaseModel, Field
</span></span><span style=display:flex><span><span style=color:#ff7b72>from</span> <span style=color:#ff7b72>typing</span> <span style=color:#ff7b72>import</span> List, Optional
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>class</span> <span style=color:#f0883e;font-weight:700>Product</span>(BaseModel):
</span></span><span style=display:flex><span>    <span style=color:#a5d6ff>&#34;&#34;&#34;äº§å“ä¿¡æ¯æ¨¡å‹&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>    name: str <span style=color:#ff7b72;font-weight:700>=</span> Field(description<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>&#34;äº§å“åç§°&#34;</span>)
</span></span><span style=display:flex><span>    price: float <span style=color:#ff7b72;font-weight:700>=</span> Field(description<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>&#34;äº§å“ä»·æ ¼&#34;</span>)
</span></span><span style=display:flex><span>    category: str <span style=color:#ff7b72;font-weight:700>=</span> Field(description<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>&#34;äº§å“ç±»åˆ«&#34;</span>)
</span></span><span style=display:flex><span>    description: str <span style=color:#ff7b72;font-weight:700>=</span> Field(description<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>&#34;äº§å“æè¿°&#34;</span>)
</span></span><span style=display:flex><span>    tags: List[str] <span style=color:#ff7b72;font-weight:700>=</span> Field(description<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>&#34;äº§å“æ ‡ç­¾&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>class</span> <span style=color:#f0883e;font-weight:700>ExtractionApp</span>:
</span></span><span style=display:flex><span>    <span style=color:#a5d6ff>&#34;&#34;&#34;ä¿¡æ¯æå–åº”ç”¨&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>__init__</span>(self):
</span></span><span style=display:flex><span>        self<span style=color:#ff7b72;font-weight:700>.</span>client <span style=color:#ff7b72;font-weight:700>=</span> LLMClient(<span style=color:#a5d6ff>&#34;anthropic&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>extract_product</span>(self, text: str) <span style=color:#ff7b72;font-weight:700>-&gt;</span> Product:
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;&#34;&#34;ä»æ–‡æœ¬ä¸­æå–äº§å“ä¿¡æ¯&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        prompt <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#79c0ff>f</span><span style=color:#a5d6ff>&#34;&#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>ä»ä»¥ä¸‹æ–‡æœ¬ä¸­æå–äº§å“ä¿¡æ¯ï¼Œä»¥JSONæ ¼å¼è¾“å‡ºï¼š
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff></span><span style=color:#a5d6ff>{</span>text<span style=color:#a5d6ff>}</span><span style=color:#a5d6ff>
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>è¯·æå–ï¼š
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>- name: äº§å“åç§°
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>- price: ä»·æ ¼ï¼ˆæ•°å­—ï¼‰
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>- category: ç±»åˆ«
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>- description: æè¿°
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>- tags: æ ‡ç­¾åˆ—è¡¨
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        response <span style=color:#ff7b72;font-weight:700>=</span> self<span style=color:#ff7b72;font-weight:700>.</span>client<span style=color:#ff7b72;font-weight:700>.</span>chat([
</span></span><span style=display:flex><span>            {<span style=color:#a5d6ff>&#34;role&#34;</span>: <span style=color:#a5d6ff>&#34;user&#34;</span>, <span style=color:#a5d6ff>&#34;content&#34;</span>: prompt}
</span></span><span style=display:flex><span>        ], temperature<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>0.3</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># è§£æJSONå“åº”</span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>import</span> <span style=color:#ff7b72>json</span>
</span></span><span style=display:flex><span>        data <span style=color:#ff7b72;font-weight:700>=</span> json<span style=color:#ff7b72;font-weight:700>.</span>loads(response)
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>return</span> Product(<span style=color:#ff7b72;font-weight:700>**</span>data)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>batch_extract</span>(self, texts: List[str]) <span style=color:#ff7b72;font-weight:700>-&gt;</span> List[Product]:
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;&#34;&#34;æ‰¹é‡æå–&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        results <span style=color:#ff7b72;font-weight:700>=</span> []
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>for</span> text <span style=color:#ff7b72;font-weight:700>in</span> texts:
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>try</span>:
</span></span><span style=display:flex><span>                product <span style=color:#ff7b72;font-weight:700>=</span> self<span style=color:#ff7b72;font-weight:700>.</span>extract_product(text)
</span></span><span style=display:flex><span>                results<span style=color:#ff7b72;font-weight:700>.</span>append(product)
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>except</span> <span style=color:#f0883e;font-weight:700>Exception</span> <span style=color:#ff7b72>as</span> e:
</span></span><span style=display:flex><span>                print(<span style=color:#79c0ff>f</span><span style=color:#a5d6ff>&#34;Error extracting from text: </span><span style=color:#a5d6ff>{</span>e<span style=color:#a5d6ff>}</span><span style=color:#a5d6ff>&#34;</span>)
</span></span><span style=display:flex><span>                <span style=color:#ff7b72>continue</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>return</span> results
</span></span></code></pre></td></tr></table></div></div><h2 id=æç¤ºå·¥ç¨‹æ¨¡å¼>æç¤ºå·¥ç¨‹æ¨¡å¼<a hidden class=anchor aria-hidden=true href=#æç¤ºå·¥ç¨‹æ¨¡å¼>#</a></h2><h3 id=chain-of-thought>Chain-of-Thought<a hidden class=anchor aria-hidden=true href=#chain-of-thought>#</a></h3><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">46
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#ff7b72>class</span> <span style=color:#f0883e;font-weight:700>ChainOfThoughtApp</span>:
</span></span><span style=display:flex><span>    <span style=color:#a5d6ff>&#34;&#34;&#34;æ€ç»´é“¾åº”ç”¨&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>__init__</span>(self):
</span></span><span style=display:flex><span>        self<span style=color:#ff7b72;font-weight:700>.</span>client <span style=color:#ff7b72;font-weight:700>=</span> LLMClient()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>solve_math_problem</span>(self, problem: str) <span style=color:#ff7b72;font-weight:700>-&gt;</span> str:
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;&#34;&#34;è§£å†³æ•°å­¦é—®é¢˜&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        prompt <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#79c0ff>f</span><span style=color:#a5d6ff>&#34;&#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>è§£å†³ä»¥ä¸‹æ•°å­¦é—®é¢˜ï¼Œè¯·ä¸€æ­¥æ­¥æ€è€ƒï¼š
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff></span><span style=color:#a5d6ff>{</span>problem<span style=color:#a5d6ff>}</span><span style=color:#a5d6ff>
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>è¯·æŒ‰ä»¥ä¸‹æ ¼å¼å›ç­”ï¼š
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>1. ç†è§£é—®é¢˜
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>2. åˆ¶å®šè®¡åˆ’
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>3. åˆ†æ­¥è®¡ç®—
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>4. å¾—å‡ºç­”æ¡ˆ
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>5. éªŒè¯ç»“æœ
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        response <span style=color:#ff7b72;font-weight:700>=</span> self<span style=color:#ff7b72;font-weight:700>.</span>client<span style=color:#ff7b72;font-weight:700>.</span>chat([
</span></span><span style=display:flex><span>            {<span style=color:#a5d6ff>&#34;role&#34;</span>: <span style=color:#a5d6ff>&#34;user&#34;</span>, <span style=color:#a5d6ff>&#34;content&#34;</span>: prompt}
</span></span><span style=display:flex><span>        ], temperature<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>0.5</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>return</span> response
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>complex_reasoning</span>(self, question: str) <span style=color:#ff7b72;font-weight:700>-&gt;</span> str:
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;&#34;&#34;å¤æ‚æ¨ç†&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        prompt <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#79c0ff>f</span><span style=color:#a5d6ff>&#34;&#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>è¯·ä»”ç»†æ€è€ƒä»¥ä¸‹é—®é¢˜ï¼Œç»™å‡ºè¯¦ç»†çš„åˆ†æå’Œç»“è®ºï¼š
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff></span><span style=color:#a5d6ff>{</span>question<span style=color:#a5d6ff>}</span><span style=color:#a5d6ff>
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>è¦æ±‚ï¼š
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>1. è¯†åˆ«é—®é¢˜çš„æ ¸å¿ƒè¦ç´ 
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>2. åˆ†æå„ç§å¯èƒ½çš„æƒ…å†µ
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>3. é€æ­¥æ¨ç†å¾—å‡ºç»“è®º
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>4. æ£€æŸ¥ç»“è®ºçš„åˆç†æ€§
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>return</span> self<span style=color:#ff7b72;font-weight:700>.</span>client<span style=color:#ff7b72;font-weight:700>.</span>chat([
</span></span><span style=display:flex><span>            {<span style=color:#a5d6ff>&#34;role&#34;</span>: <span style=color:#a5d6ff>&#34;user&#34;</span>, <span style=color:#a5d6ff>&#34;content&#34;</span>: prompt}
</span></span><span style=display:flex><span>        ])
</span></span></code></pre></td></tr></table></div></div><h3 id=few-shot-learning>Few-Shot Learning<a hidden class=anchor aria-hidden=true href=#few-shot-learning>#</a></h3><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">38
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#ff7b72>class</span> <span style=color:#f0883e;font-weight:700>FewShotApp</span>:
</span></span><span style=display:flex><span>    <span style=color:#a5d6ff>&#34;&#34;&#34;å°‘æ ·æœ¬å­¦ä¹ åº”ç”¨&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>__init__</span>(self):
</span></span><span style=display:flex><span>        self<span style=color:#ff7b72;font-weight:700>.</span>client <span style=color:#ff7b72;font-weight:700>=</span> LLMClient()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>sentiment_analysis</span>(self, text: str) <span style=color:#ff7b72;font-weight:700>-&gt;</span> str:
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;&#34;&#34;æƒ…æ„Ÿåˆ†æï¼ˆå°‘æ ·æœ¬ï¼‰&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        examples <span style=color:#ff7b72;font-weight:700>=</span> [
</span></span><span style=display:flex><span>            {
</span></span><span style=display:flex><span>                <span style=color:#a5d6ff>&#34;text&#34;</span>: <span style=color:#a5d6ff>&#34;è¿™ä¸ªäº§å“å¤ªæ£’äº†ï¼éå¸¸æ¨èï¼&#34;</span>,
</span></span><span style=display:flex><span>                <span style=color:#a5d6ff>&#34;sentiment&#34;</span>: <span style=color:#a5d6ff>&#34;positive&#34;</span>
</span></span><span style=display:flex><span>            },
</span></span><span style=display:flex><span>            {
</span></span><span style=display:flex><span>                <span style=color:#a5d6ff>&#34;text&#34;</span>: <span style=color:#a5d6ff>&#34;è´¨é‡ä¸€èˆ¬ï¼Œä»·æ ¼åé«˜&#34;</span>,
</span></span><span style=display:flex><span>                <span style=color:#a5d6ff>&#34;sentiment&#34;</span>: <span style=color:#a5d6ff>&#34;neutral&#34;</span>
</span></span><span style=display:flex><span>            },
</span></span><span style=display:flex><span>            {
</span></span><span style=display:flex><span>                <span style=color:#a5d6ff>&#34;text&#34;</span>: <span style=color:#a5d6ff>&#34;å®Œå…¨æµªè´¹é’±ï¼Œå¼ºçƒˆä¸æ¨è&#34;</span>,
</span></span><span style=display:flex><span>                <span style=color:#a5d6ff>&#34;sentiment&#34;</span>: <span style=color:#a5d6ff>&#34;negative&#34;</span>
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        ]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        prompt <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>&#34;ä»¥ä¸‹æ˜¯æ–‡æœ¬çš„æƒ…æ„Ÿåˆ†ç±»ç¤ºä¾‹ï¼š</span><span style=color:#79c0ff>\n\n</span><span style=color:#a5d6ff>&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>for</span> ex <span style=color:#ff7b72;font-weight:700>in</span> examples:
</span></span><span style=display:flex><span>            prompt <span style=color:#ff7b72;font-weight:700>+=</span> <span style=color:#79c0ff>f</span><span style=color:#a5d6ff>&#34;æ–‡æœ¬: </span><span style=color:#a5d6ff>{</span>ex[<span style=color:#a5d6ff>&#39;text&#39;</span>]<span style=color:#a5d6ff>}</span><span style=color:#79c0ff>\n</span><span style=color:#a5d6ff>&#34;</span>
</span></span><span style=display:flex><span>            prompt <span style=color:#ff7b72;font-weight:700>+=</span> <span style=color:#79c0ff>f</span><span style=color:#a5d6ff>&#34;æƒ…æ„Ÿ: </span><span style=color:#a5d6ff>{</span>ex[<span style=color:#a5d6ff>&#39;sentiment&#39;</span>]<span style=color:#a5d6ff>}</span><span style=color:#79c0ff>\n\n</span><span style=color:#a5d6ff>&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        prompt <span style=color:#ff7b72;font-weight:700>+=</span> <span style=color:#79c0ff>f</span><span style=color:#a5d6ff>&#34;ç°åœ¨åˆ†æä»¥ä¸‹æ–‡æœ¬çš„æƒ…æ„Ÿï¼š</span><span style=color:#79c0ff>\n</span><span style=color:#a5d6ff>{</span>text<span style=color:#a5d6ff>}</span><span style=color:#79c0ff>\n</span><span style=color:#a5d6ff>&#34;</span>
</span></span><span style=display:flex><span>        prompt <span style=color:#ff7b72;font-weight:700>+=</span> <span style=color:#a5d6ff>&#34;æƒ…æ„Ÿï¼š&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        response <span style=color:#ff7b72;font-weight:700>=</span> self<span style=color:#ff7b72;font-weight:700>.</span>client<span style=color:#ff7b72;font-weight:700>.</span>chat([
</span></span><span style=display:flex><span>            {<span style=color:#a5d6ff>&#34;role&#34;</span>: <span style=color:#a5d6ff>&#34;user&#34;</span>, <span style=color:#a5d6ff>&#34;content&#34;</span>: prompt}
</span></span><span style=display:flex><span>        ], temperature<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>0.3</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>return</span> response<span style=color:#ff7b72;font-weight:700>.</span>strip()
</span></span></code></pre></td></tr></table></div></div><h2 id=rag-åŸºç¡€å®ç°>RAG åŸºç¡€å®ç°<a hidden class=anchor aria-hidden=true href=#rag-åŸºç¡€å®ç°>#</a></h2><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">56
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">57
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">58
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">59
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">60
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">61
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">62
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">63
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">64
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">65
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">66
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">67
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">68
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">69
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">70
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">71
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">72
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">73
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">74
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">75
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">76
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">77
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">78
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">79
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">80
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">81
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">82
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#ff7b72>from</span> <span style=color:#ff7b72>sentence_transformers</span> <span style=color:#ff7b72>import</span> SentenceTransformer
</span></span><span style=display:flex><span><span style=color:#ff7b72>import</span> <span style=color:#ff7b72>faiss</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>import</span> <span style=color:#ff7b72>numpy</span> <span style=color:#ff7b72>as</span> <span style=color:#ff7b72>np</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>class</span> <span style=color:#f0883e;font-weight:700>SimpleRAG</span>:
</span></span><span style=display:flex><span>    <span style=color:#a5d6ff>&#34;&#34;&#34;ç®€å•çš„RAGç³»ç»Ÿ&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>__init__</span>(self):
</span></span><span style=display:flex><span>        self<span style=color:#ff7b72;font-weight:700>.</span>client <span style=color:#ff7b72;font-weight:700>=</span> LLMClient()
</span></span><span style=display:flex><span>        self<span style=color:#ff7b72;font-weight:700>.</span>embedder <span style=color:#ff7b72;font-weight:700>=</span> SentenceTransformer(<span style=color:#a5d6ff>&#39;all-MiniLM-L6-v2&#39;</span>)
</span></span><span style=display:flex><span>        self<span style=color:#ff7b72;font-weight:700>.</span>index <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#79c0ff>None</span>
</span></span><span style=display:flex><span>        self<span style=color:#ff7b72;font-weight:700>.</span>documents <span style=color:#ff7b72;font-weight:700>=</span> []
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>add_documents</span>(self, docs: List[str]):
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;&#34;&#34;æ·»åŠ æ–‡æ¡£&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># ç”ŸæˆåµŒå…¥</span>
</span></span><span style=display:flex><span>        embeddings <span style=color:#ff7b72;font-weight:700>=</span> self<span style=color:#ff7b72;font-weight:700>.</span>embedder<span style=color:#ff7b72;font-weight:700>.</span>encode(docs)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># å½’ä¸€åŒ–</span>
</span></span><span style=display:flex><span>        faiss<span style=color:#ff7b72;font-weight:700>.</span>normalize_L2(embeddings)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># åˆ›å»ºç´¢å¼•</span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>if</span> self<span style=color:#ff7b72;font-weight:700>.</span>index <span style=color:#ff7b72;font-weight:700>is</span> <span style=color:#79c0ff>None</span>:
</span></span><span style=display:flex><span>            dimension <span style=color:#ff7b72;font-weight:700>=</span> embeddings<span style=color:#ff7b72;font-weight:700>.</span>shape[<span style=color:#a5d6ff>1</span>]
</span></span><span style=display:flex><span>            self<span style=color:#ff7b72;font-weight:700>.</span>index <span style=color:#ff7b72;font-weight:700>=</span> faiss<span style=color:#ff7b72;font-weight:700>.</span>IndexFlatIP(dimension)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># æ·»åŠ åˆ°ç´¢å¼•</span>
</span></span><span style=display:flex><span>        self<span style=color:#ff7b72;font-weight:700>.</span>index<span style=color:#ff7b72;font-weight:700>.</span>add(embeddings<span style=color:#ff7b72;font-weight:700>.</span>astype(<span style=color:#a5d6ff>&#39;float32&#39;</span>))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># å­˜å‚¨æ–‡æ¡£</span>
</span></span><span style=display:flex><span>        self<span style=color:#ff7b72;font-weight:700>.</span>documents<span style=color:#ff7b72;font-weight:700>.</span>extend(docs)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>retrieve</span>(self, query: str, k: int <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>5</span>) <span style=color:#ff7b72;font-weight:700>-&gt;</span> List[str]:
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;&#34;&#34;æ£€ç´¢ç›¸å…³æ–‡æ¡£&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># ç”ŸæˆæŸ¥è¯¢åµŒå…¥</span>
</span></span><span style=display:flex><span>        query_embedding <span style=color:#ff7b72;font-weight:700>=</span> self<span style=color:#ff7b72;font-weight:700>.</span>embedder<span style=color:#ff7b72;font-weight:700>.</span>encode([query])
</span></span><span style=display:flex><span>        faiss<span style=color:#ff7b72;font-weight:700>.</span>normalize_L2(query_embedding)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># æœç´¢</span>
</span></span><span style=display:flex><span>        scores, indices <span style=color:#ff7b72;font-weight:700>=</span> self<span style=color:#ff7b72;font-weight:700>.</span>index<span style=color:#ff7b72;font-weight:700>.</span>search(
</span></span><span style=display:flex><span>            query_embedding<span style=color:#ff7b72;font-weight:700>.</span>astype(<span style=color:#a5d6ff>&#39;float32&#39;</span>),
</span></span><span style=display:flex><span>            k
</span></span><span style=display:flex><span>        )
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># è¿”å›æ–‡æ¡£</span>
</span></span><span style=display:flex><span>        results <span style=color:#ff7b72;font-weight:700>=</span> []
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>for</span> score, idx <span style=color:#ff7b72;font-weight:700>in</span> zip(scores[<span style=color:#a5d6ff>0</span>], indices[<span style=color:#a5d6ff>0</span>]):
</span></span><span style=display:flex><span>            results<span style=color:#ff7b72;font-weight:700>.</span>append({
</span></span><span style=display:flex><span>                <span style=color:#a5d6ff>&#34;document&#34;</span>: self<span style=color:#ff7b72;font-weight:700>.</span>documents[idx],
</span></span><span style=display:flex><span>                <span style=color:#a5d6ff>&#34;score&#34;</span>: float(score)
</span></span><span style=display:flex><span>            })
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>return</span> results
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>ask</span>(self, question: str) <span style=color:#ff7b72;font-weight:700>-&gt;</span> str:
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;&#34;&#34;é—®ç­”&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># æ£€ç´¢ç›¸å…³æ–‡æ¡£</span>
</span></span><span style=display:flex><span>        context_docs <span style=color:#ff7b72;font-weight:700>=</span> self<span style=color:#ff7b72;font-weight:700>.</span>retrieve(question, k<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>3</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># æ„å»ºæç¤º</span>
</span></span><span style=display:flex><span>        context <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>&#34;</span><span style=color:#79c0ff>\n\n</span><span style=color:#a5d6ff>&#34;</span><span style=color:#ff7b72;font-weight:700>.</span>join([
</span></span><span style=display:flex><span>            doc[<span style=color:#a5d6ff>&#34;document&#34;</span>] <span style=color:#ff7b72>for</span> doc <span style=color:#ff7b72;font-weight:700>in</span> context_docs
</span></span><span style=display:flex><span>        ])
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        prompt <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#79c0ff>f</span><span style=color:#a5d6ff>&#34;&#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>åŸºäºä»¥ä¸‹ä¿¡æ¯å›ç­”é—®é¢˜ï¼š
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff></span><span style=color:#a5d6ff>{</span>context<span style=color:#a5d6ff>}</span><span style=color:#a5d6ff>
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>é—®é¢˜ï¼š</span><span style=color:#a5d6ff>{</span>question<span style=color:#a5d6ff>}</span><span style=color:#a5d6ff>
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>å¦‚æœä¿¡æ¯ä¸è¶³ä»¥å›ç­”ï¼Œè¯·æ˜ç¡®è¯´æ˜ã€‚
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        response <span style=color:#ff7b72;font-weight:700>=</span> self<span style=color:#ff7b72;font-weight:700>.</span>client<span style=color:#ff7b72;font-weight:700>.</span>chat([
</span></span><span style=display:flex><span>            {<span style=color:#a5d6ff>&#34;role&#34;</span>: <span style=color:#a5d6ff>&#34;user&#34;</span>, <span style=color:#a5d6ff>&#34;content&#34;</span>: prompt}
</span></span><span style=display:flex><span>        ])
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>return</span> response
</span></span></code></pre></td></tr></table></div></div><h2 id=ç”Ÿäº§éƒ¨ç½²>ç”Ÿäº§éƒ¨ç½²<a hidden class=anchor aria-hidden=true href=#ç”Ÿäº§éƒ¨ç½²>#</a></h2><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">56
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">57
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">58
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">59
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">60
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">61
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">62
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">63
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">64
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">65
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">66
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">67
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">68
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">69
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">70
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">71
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">72
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">73
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">74
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">75
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">76
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">77
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">78
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">79
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">80
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">81
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">82
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">83
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">84
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">85
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">86
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#ff7b72>from</span> <span style=color:#ff7b72>fastapi</span> <span style=color:#ff7b72>import</span> FastAPI, HTTPException
</span></span><span style=display:flex><span><span style=color:#ff7b72>from</span> <span style=color:#ff7b72>pydantic</span> <span style=color:#ff7b72>import</span> BaseModel
</span></span><span style=display:flex><span><span style=color:#ff7b72>from</span> <span style=color:#ff7b72>typing</span> <span style=color:#ff7b72>import</span> List
</span></span><span style=display:flex><span><span style=color:#ff7b72>import</span> <span style=color:#ff7b72>redis</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>import</span> <span style=color:#ff7b72>json</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>app <span style=color:#ff7b72;font-weight:700>=</span> FastAPI(title<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>&#34;LLM API Service&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic># å…¨å±€é…ç½®</span>
</span></span><span style=display:flex><span>llm_client <span style=color:#ff7b72;font-weight:700>=</span> LLMClient(<span style=color:#a5d6ff>&#34;anthropic&#34;</span>)
</span></span><span style=display:flex><span>cache <span style=color:#ff7b72;font-weight:700>=</span> redis<span style=color:#ff7b72;font-weight:700>.</span>Redis(host<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>&#39;localhost&#39;</span>, port<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>6379</span>, db<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>0</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>class</span> <span style=color:#f0883e;font-weight:700>ChatRequest</span>(BaseModel):
</span></span><span style=display:flex><span>    messages: List[dict]
</span></span><span style=display:flex><span>    temperature: float <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>0.7</span>
</span></span><span style=display:flex><span>    max_tokens: int <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>4096</span>
</span></span><span style=display:flex><span>    stream: bool <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#79c0ff>False</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>class</span> <span style=color:#f0883e;font-weight:700>ChatResponse</span>(BaseModel):
</span></span><span style=display:flex><span>    content: str
</span></span><span style=display:flex><span>    model: str
</span></span><span style=display:flex><span>    tokens_used: int
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#d2a8ff;font-weight:700>@app.post</span>(<span style=color:#a5d6ff>&#34;/api/chat&#34;</span>, response_model<span style=color:#ff7b72;font-weight:700>=</span>ChatResponse)
</span></span><span style=display:flex><span><span style=color:#ff7b72>async</span> <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>chat</span>(request: ChatRequest):
</span></span><span style=display:flex><span>    <span style=color:#a5d6ff>&#34;&#34;&#34;èŠå¤©æ¥å£&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8b949e;font-style:italic># ç”Ÿæˆç¼“å­˜key</span>
</span></span><span style=display:flex><span>    cache_key <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#79c0ff>f</span><span style=color:#a5d6ff>&#34;chat:</span><span style=color:#a5d6ff>{</span>hash(str(request<span style=color:#ff7b72;font-weight:700>.</span>messages))<span style=color:#a5d6ff>}</span><span style=color:#a5d6ff>&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8b949e;font-style:italic># å°è¯•ä»ç¼“å­˜è·å–</span>
</span></span><span style=display:flex><span>    cached <span style=color:#ff7b72;font-weight:700>=</span> cache<span style=color:#ff7b72;font-weight:700>.</span>get(cache_key)
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>if</span> cached:
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>return</span> ChatResponse(<span style=color:#ff7b72;font-weight:700>**</span>json<span style=color:#ff7b72;font-weight:700>.</span>loads(cached))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>try</span>:
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># è°ƒç”¨LLM</span>
</span></span><span style=display:flex><span>        response <span style=color:#ff7b72;font-weight:700>=</span> llm_client<span style=color:#ff7b72;font-weight:700>.</span>chat(
</span></span><span style=display:flex><span>            request<span style=color:#ff7b72;font-weight:700>.</span>messages,
</span></span><span style=display:flex><span>            temperature<span style=color:#ff7b72;font-weight:700>=</span>request<span style=color:#ff7b72;font-weight:700>.</span>temperature,
</span></span><span style=display:flex><span>            max_tokens<span style=color:#ff7b72;font-weight:700>=</span>request<span style=color:#ff7b72;font-weight:700>.</span>max_tokens
</span></span><span style=display:flex><span>        )
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        result <span style=color:#ff7b72;font-weight:700>=</span> ChatResponse(
</span></span><span style=display:flex><span>            content<span style=color:#ff7b72;font-weight:700>=</span>response,
</span></span><span style=display:flex><span>            model<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>&#34;claude-3-5-sonnet&#34;</span>,
</span></span><span style=display:flex><span>            tokens_used<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>0</span>  <span style=color:#8b949e;font-style:italic># éœ€è¦ä»å“åº”ä¸­è·å–</span>
</span></span><span style=display:flex><span>        )
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># ç¼“å­˜ç»“æœï¼ˆ1å°æ—¶ï¼‰</span>
</span></span><span style=display:flex><span>        cache<span style=color:#ff7b72;font-weight:700>.</span>setex(
</span></span><span style=display:flex><span>            cache_key,
</span></span><span style=display:flex><span>            <span style=color:#a5d6ff>3600</span>,
</span></span><span style=display:flex><span>            json<span style=color:#ff7b72;font-weight:700>.</span>dumps(result<span style=color:#ff7b72;font-weight:700>.</span>dict())
</span></span><span style=display:flex><span>        )
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>return</span> result
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>except</span> <span style=color:#f0883e;font-weight:700>Exception</span> <span style=color:#ff7b72>as</span> e:
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>raise</span> HTTPException(status_code<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>500</span>, detail<span style=color:#ff7b72;font-weight:700>=</span>str(e))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#d2a8ff;font-weight:700>@app.post</span>(<span style=color:#a5d6ff>&#34;/api/chat/stream&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#ff7b72>async</span> <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>chat_stream</span>(request: ChatRequest):
</span></span><span style=display:flex><span>    <span style=color:#a5d6ff>&#34;&#34;&#34;æµå¼èŠå¤©&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>async</span> <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>generate</span>():
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>try</span>:
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>for</span> chunk <span style=color:#ff7b72;font-weight:700>in</span> llm_client<span style=color:#ff7b72;font-weight:700>.</span>stream_chat(
</span></span><span style=display:flex><span>                request<span style=color:#ff7b72;font-weight:700>.</span>messages,
</span></span><span style=display:flex><span>                temperature<span style=color:#ff7b72;font-weight:700>=</span>request<span style=color:#ff7b72;font-weight:700>.</span>temperature,
</span></span><span style=display:flex><span>                max_tokens<span style=color:#ff7b72;font-weight:700>=</span>request<span style=color:#ff7b72;font-weight:700>.</span>max_tokens
</span></span><span style=display:flex><span>            ):
</span></span><span style=display:flex><span>                <span style=color:#ff7b72>yield</span> <span style=color:#79c0ff>f</span><span style=color:#a5d6ff>&#34;data: </span><span style=color:#a5d6ff>{</span>json<span style=color:#ff7b72;font-weight:700>.</span>dumps({<span style=color:#a5d6ff>&#39;content&#39;</span>: chunk})<span style=color:#a5d6ff>}</span><span style=color:#79c0ff>\n\n</span><span style=color:#a5d6ff>&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>except</span> <span style=color:#f0883e;font-weight:700>Exception</span> <span style=color:#ff7b72>as</span> e:
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>yield</span> <span style=color:#79c0ff>f</span><span style=color:#a5d6ff>&#34;data: </span><span style=color:#a5d6ff>{</span>json<span style=color:#ff7b72;font-weight:700>.</span>dumps({<span style=color:#a5d6ff>&#39;error&#39;</span>: str(e)})<span style=color:#a5d6ff>}</span><span style=color:#79c0ff>\n\n</span><span style=color:#a5d6ff>&#34;</span>
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>yield</span> <span style=color:#a5d6ff>&#34;data: [DONE]</span><span style=color:#79c0ff>\n\n</span><span style=color:#a5d6ff>&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>from</span> <span style=color:#ff7b72>fastapi.responses</span> <span style=color:#ff7b72>import</span> StreamingResponse
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>return</span> StreamingResponse(
</span></span><span style=display:flex><span>        generate(),
</span></span><span style=display:flex><span>        media_type<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>&#34;text/event-stream&#34;</span>
</span></span><span style=display:flex><span>    )
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic># å¯åŠ¨å‘½ä»¤</span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic># uvicorn api:app --host 0.0.0.0 --port 8000 --workers 4</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=æ€§èƒ½ä¼˜åŒ–>æ€§èƒ½ä¼˜åŒ–<a hidden class=anchor aria-hidden=true href=#æ€§èƒ½ä¼˜åŒ–>#</a></h2><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">48
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#ff7b72>class</span> <span style=color:#f0883e;font-weight:700>PerformanceOptimizer</span>:
</span></span><span style=display:flex><span>    <span style=color:#a5d6ff>&#34;&#34;&#34;æ€§èƒ½ä¼˜åŒ–å™¨&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>implement_caching</span>(self):
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;&#34;&#34;å®ç°å¤šå±‚ç¼“å­˜&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        cache_strategy <span style=color:#ff7b72;font-weight:700>=</span> {
</span></span><span style=display:flex><span>            <span style=color:#a5d6ff>&#34;l1_memory&#34;</span>: {
</span></span><span style=display:flex><span>                <span style=color:#a5d6ff>&#34;ttl&#34;</span>: <span style=color:#a5d6ff>300</span>,  <span style=color:#8b949e;font-style:italic># 5åˆ†é’Ÿ</span>
</span></span><span style=display:flex><span>                <span style=color:#a5d6ff>&#34;max_size&#34;</span>: <span style=color:#a5d6ff>1000</span>
</span></span><span style=display:flex><span>            },
</span></span><span style=display:flex><span>            <span style=color:#a5d6ff>&#34;l2_redis&#34;</span>: {
</span></span><span style=display:flex><span>                <span style=color:#a5d6ff>&#34;ttl&#34;</span>: <span style=color:#a5d6ff>3600</span>,  <span style=color:#8b949e;font-style:italic># 1å°æ—¶</span>
</span></span><span style=display:flex><span>                <span style=color:#a5d6ff>&#34;max_size&#34;</span>: <span style=color:#a5d6ff>10000</span>
</span></span><span style=display:flex><span>            },
</span></span><span style=display:flex><span>            <span style=color:#a5d6ff>&#34;l3_database&#34;</span>: {
</span></span><span style=display:flex><span>                <span style=color:#a5d6ff>&#34;ttl&#34;</span>: <span style=color:#a5d6ff>86400</span>  <span style=color:#8b949e;font-style:italic># 1å¤©</span>
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>return</span> cache_strategy
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>batch_processing</span>(self, prompts: List[str]) <span style=color:#ff7b72;font-weight:700>-&gt;</span> List[str]:
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;&#34;&#34;æ‰¹é‡å¤„ç†&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># ä½¿ç”¨å¤šçº¿ç¨‹å¹¶å‘è¯·æ±‚</span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>from</span> <span style=color:#ff7b72>concurrent.futures</span> <span style=color:#ff7b72>import</span> ThreadPoolExecutor
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>with</span> ThreadPoolExecutor(max_workers<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>5</span>) <span style=color:#ff7b72>as</span> executor:
</span></span><span style=display:flex><span>            results <span style=color:#ff7b72;font-weight:700>=</span> list(executor<span style=color:#ff7b72;font-weight:700>.</span>map(
</span></span><span style=display:flex><span>                self<span style=color:#ff7b72;font-weight:700>.</span>client<span style=color:#ff7b72;font-weight:700>.</span>chat,
</span></span><span style=display:flex><span>                [{<span style=color:#a5d6ff>&#34;role&#34;</span>: <span style=color:#a5d6ff>&#34;user&#34;</span>, <span style=color:#a5d6ff>&#34;content&#34;</span>: p} <span style=color:#ff7b72>for</span> p <span style=color:#ff7b72;font-weight:700>in</span> prompts]
</span></span><span style=display:flex><span>            ))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>return</span> results
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>token_optimization</span>(self, prompt: str) <span style=color:#ff7b72;font-weight:700>-&gt;</span> str:
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;&#34;&#34;Tokenä¼˜åŒ–&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># ç§»é™¤å†—ä½™ä¿¡æ¯</span>
</span></span><span style=display:flex><span>        optimized <span style=color:#ff7b72;font-weight:700>=</span> (
</span></span><span style=display:flex><span>            prompt
</span></span><span style=display:flex><span>            <span style=color:#ff7b72;font-weight:700>.</span>replace(<span style=color:#a5d6ff>&#34;è¯·&#34;</span>, <span style=color:#a5d6ff>&#34;&#34;</span>)
</span></span><span style=display:flex><span>            <span style=color:#ff7b72;font-weight:700>.</span>replace(<span style=color:#a5d6ff>&#34;æ‚¨&#34;</span>, <span style=color:#a5d6ff>&#34;&#34;</span>)
</span></span><span style=display:flex><span>            <span style=color:#ff7b72;font-weight:700>.</span>replace(<span style=color:#a5d6ff>&#34;å¥½çš„ï¼Œ&#34;</span>, <span style=color:#a5d6ff>&#34;&#34;</span>)
</span></span><span style=display:flex><span>        )
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>return</span> optimized<span style=color:#ff7b72;font-weight:700>.</span>strip()
</span></span></code></pre></td></tr></table></div></div><h2 id=æ€»ç»“>æ€»ç»“<a hidden class=anchor aria-hidden=true href=#æ€»ç»“>#</a></h2><p>LLMåº”ç”¨å¼€å‘çš„å…³é”®è¦ç‚¹ï¼š</p><ol><li><strong>æ¨¡å‹é€‰æ‹©</strong>ï¼šæ ¹æ®åœºæ™¯é€‰æ‹©åˆé€‚çš„æ¨¡å‹</li><li><strong>APIè®¾è®¡</strong>ï¼šç»Ÿä¸€çš„æ¥å£å’Œé”™è¯¯å¤„ç†</li><li><strong>æç¤ºå·¥ç¨‹</strong>ï¼šç²¾å¿ƒè®¾è®¡æç¤ºè¯</li><li><strong>RAGæŠ€æœ¯</strong>ï¼šç»“åˆé¢†åŸŸçŸ¥è¯†</li><li><strong>æ€§èƒ½ä¼˜åŒ–</strong>ï¼šç¼“å­˜ã€æ‰¹å¤„ç†ã€æµå¼è¾“å‡º</li><li><strong>ç›‘æ§å‘Šè­¦</strong>ï¼šè·Ÿè¸ªä½¿ç”¨æƒ…å†µå’Œæˆæœ¬</li><li><strong>å®‰å…¨é˜²æŠ¤</strong>ï¼šè¾“å…¥éªŒè¯ã€å†…å®¹è¿‡æ»¤</li></ol><p>LLMåº”ç”¨å¼€å‘æ˜¯ä¸€ä¸ªæŒç»­ä¼˜åŒ–çš„è¿‡ç¨‹ï¼Œéœ€è¦æ ¹æ®å®é™…ä½¿ç”¨æƒ…å†µä¸æ–­è°ƒæ•´ã€‚</p></div><footer class=post-footer-modern><div class=post-tags-modern><span class=tags-label>ğŸ·ï¸ æ ‡ç­¾</span><div class=tags-list><a href=/blog/tags/llm/ class=tag-pill>LLM
</a><a href=/blog/tags/ai%E5%BA%94%E7%94%A8/ class=tag-pill>AIåº”ç”¨
</a><a href=/blog/tags/claude-api/ class=tag-pill>Claude API
</a><a href=/blog/tags/%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91/ class=tag-pill>åº”ç”¨å¼€å‘
</a><a href=/blog/tags/gpt/ class=tag-pill>GPT</a></div></div><style>.post-footer-modern{margin-top:3rem;padding-top:2rem;border-top:1px solid var(--border,#333333)}.post-tags-modern{display:flex;align-items:center;gap:1rem;margin-bottom:2rem;flex-wrap:wrap}.tags-label{font-size:.875rem;font-weight:600;color:var(--secondary,#999999) !important;white-space:nowrap}.tags-list{display:flex;flex-wrap:wrap;gap:.5rem;flex:1}.tag-pill{display:inline-block;padding:.25rem .75rem;background:rgba(255,255,255,5%);border:1px solid var(--border,#333333);border-radius:0;color:var(--secondary,#cccccc) !important;text-decoration:none;font-size:.8rem;font-weight:500;transition:all .2s ease}.tag-pill:hover{background:var(--primary,#ffffff);color:var(--background,#000000) !important;border-color:var(--primary,#ffffff);transform:translateY(-1px)}.post-nav-modern{margin-top:2rem}.nav-grid{display:grid;grid-template-columns:1fr 1fr;gap:1rem}.nav-card{display:flex;align-items:center;gap:1rem;padding:1.25rem;background:rgba(255,255,255,2%);border:1px solid var(--border,#333333);border-radius:12px;text-decoration:none;transition:all .2s ease;min-height:80px}.nav-card:hover{background:rgba(255,255,255,5%);border-color:var(--primary,#ffffff);transform:translateY(-2px)}.nav-card.nav-prev{justify-content:flex-start}.nav-card.nav-next{justify-content:flex-end;text-align:right}.nav-card.nav-next .nav-content{text-align:right}.nav-empty{display:flex;align-items:center;justify-content:center;background:rgba(255,255,255,1%);border:1px dashed var(--border,#333333);color:var(--secondary,#666666)}.nav-arrow{font-size:1.5rem;color:var(--primary,#ffffff);font-weight:300}.nav-content{flex:1}.nav-title{font-size:.95rem;font-weight:600;color:var(--primary,#ffffff) !important;line-height:1.4;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden}[data-theme=light] .post-footer-modern{border-color:var(--border-light,#dee2e6)}[data-theme=light] .tags-label{color:var(--secondary-light,#6c757d) !important}[data-theme=light] .tag-pill{background:rgba(0,0,0,5%);border-color:var(--border-light,#dee2e6);color:var(--secondary-light,#495057) !important}[data-theme=light] .tag-pill:hover{background:var(--primary-light,#0066cc);color:var(--background-light,#ffffff) !important;border-color:var(--primary-light,#0066cc)}[data-theme=light] .nav-card{background:rgba(0,0,0,2%);border-color:var(--border-light,#dee2e6)}[data-theme=light] .nav-card:hover{background:rgba(0,102,204,5%);border-color:var(--primary-light,#0066cc)}[data-theme=light] .nav-empty{background:rgba(0,0,0,1%);border-color:var(--border-light,#dee2e6);color:var(--secondary-light,#6c757d)}[data-theme=light] .nav-arrow{color:var(--primary-light,#0066cc)}[data-theme=light] .nav-title{color:var(--primary-light,#212529) !important}@media(max-width:768px){.nav-grid{grid-template-columns:1fr;gap:.75rem}.nav-card{padding:1rem;min-height:70px}.nav-card.nav-next{text-align:left}.nav-card.nav-next .nav-content{text-align:left}.nav-title{font-size:.875rem}.post-tags-modern{flex-direction:column;gap:.75rem}}@media(max-width:480px){.nav-arrow{font-size:1.25rem}.nav-card{padding:.875rem}.nav-title{font-size:.8rem;-webkit-line-clamp:1}}</style><nav class=post-nav-modern><div class=nav-grid><a href=/blog/articles/%E7%8E%B0%E4%BB%A3%E6%95%B0%E6%8D%AE%E6%B9%96%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E4%BB%8E%E5%AD%98%E5%82%A8%E5%88%B0%E5%88%86%E6%9E%90%E7%9A%84%E5%AE%8C%E6%95%B4%E6%96%B9%E6%A1%88/ class="nav-card nav-prev"><div class=nav-arrow>â†</div><div class=nav-content><div class=nav-title>ç°ä»£æ•°æ®æ¹–æ¶æ„è®¾è®¡ï¼šä»å­˜å‚¨åˆ°åˆ†æçš„å®Œæ•´æ–¹æ¡ˆ</div></div></a><a href=/blog/articles/rag%E7%B3%BB%E7%BB%9F%E6%9E%84%E5%BB%BA%E5%AE%8C%E5%85%A8%E6%8C%87%E5%8D%97%E6%89%93%E9%80%A0%E4%BC%81%E4%B8%9A%E7%BA%A7%E7%9F%A5%E8%AF%86%E9%97%AE%E7%AD%94%E7%B3%BB%E7%BB%9F/ class="nav-card nav-next"><div class=nav-content><div class=nav-title>RAGç³»ç»Ÿæ„å»ºå®Œå…¨æŒ‡å—ï¼šæ‰“é€ ä¼ä¸šçº§çŸ¥è¯†é—®ç­”ç³»ç»Ÿ</div></div><div class=nav-arrow>â†’</div></a></div></nav></footer></main><aside class=post-sidebar><div class=sidebar-toc id=sidebar-toc><div class=toc-header><div class=toc-title>ç›®å½•</div><button class=toc-toggle id=toc-toggle aria-label="Toggle TOC">
<svg class="toc-toggle-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 6 6 18M6 6l12 12"/></svg></button></div><div class=toc-content id=toc-content><ul class=toc-list><li class="toc-item toc-h2"><a href=#h2-0 class=toc-item-link><span class=toc-item-text>æ¨¡å‹é€‰æ‹©ç­–ç•¥</span></a></li><li class="toc-item toc-h2"><a href=#h2-1 class=toc-item-link><span class=toc-item-text>API è®¾è®¡æ¨¡å¼</span></a></li><li class="toc-item toc-h2"><a href=#h2-2 class=toc-item-link><span class=toc-item-text>æç¤ºå·¥ç¨‹æ¨¡å¼</span></a></li><li class="toc-item toc-h2"><a href=#h2-3 class=toc-item-link><span class=toc-item-text>RAG åŸºç¡€å®ç°</span></a></li><li class="toc-item toc-h2"><a href=#h2-4 class=toc-item-link><span class=toc-item-text>ç”Ÿäº§éƒ¨ç½²</span></a></li><li class="toc-item toc-h2"><a href=#h2-5 class=toc-item-link><span class=toc-item-text>æ€§èƒ½ä¼˜åŒ–</span></a></li><li class="toc-item toc-h2"><a href=#h2-6 class=toc-item-link><span class=toc-item-text>æ€»ç»“</span></a></li></ul></div></div><script>document.addEventListener("DOMContentLoaded",function(){const e=document.getElementById("sidebar-toc"),t=document.getElementById("toc-toggle"),o=document.getElementById("toc-content"),i=t?.querySelector(".toc-toggle-icon");if(!e)return;let n=!1;t&&t.addEventListener("click",function(){n=!n,n?(o.style.display="none",e.style.width="auto",i.innerHTML='<path d="M9 18l6-6-6-6"/>'):(o.style.display="block",e.style.width="200px",i.innerHTML='<path d="M18 6L6 18M6 6l12 12"/>')});const s=document.querySelector(".post-content");if(s){const e=s.querySelectorAll("h1");e.forEach((e,t)=>{e.id=`h1-${t}`});const t=s.querySelectorAll("h2");t.forEach((e,t)=>{e.id=`h2-${t}`})}const a=document.querySelectorAll(".toc-item-link");a.forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();const n=this.getAttribute("href").substring(1),t=document.getElementById(n);if(t){const e=document.querySelector(".post-header-main")?.offsetHeight||0,n=t.offsetTop-e-20;window.scrollTo({top:n,behavior:"smooth"})}})})})</script><style>.sidebar-toc{position:sticky;top:2rem;width:200px;background:#fff;border:1px solid #e5e7eb;border-radius:4px;overflow:hidden;box-shadow:0 1px 3px rgba(0,0,0,.1);z-index:100}.sidebar-toc.hidden{display:none}.toc-header{padding:12px 16px;border-bottom:1px solid #e5e7eb;background:#fafbfc;display:flex;align-items:center;justify-content:space-between}.toc-title{margin:0;font-size:13px;font-weight:500;color:#374151 !important;font-family:-apple-system,BlinkMacSystemFont,segoe ui,Roboto,sans-serif;text-transform:uppercase;letter-spacing:1px}.toc-toggle{background:0 0;border:none;cursor:pointer;padding:4px;border-radius:4px;display:flex;align-items:center;justify-content:center;transition:all .2s ease;color:#6b7280}.toc-toggle:hover{background:#e5e7eb;color:#374151}.toc-toggle-icon{transition:transform .2s ease}.toc-content{padding:12px 0}.toc-list{list-style:none;margin:0;padding:0}.toc-item{margin-bottom:4px;display:block !important;visibility:visible !important}.toc-h1,.toc-h2{display:block !important}.toc-h2{margin-left:0}.toc-item-link{display:flex;align-items:center;gap:8px;padding:8px 12px;color:#374151 !important;text-decoration:none;font-size:13px;line-height:1.4;border-radius:3px;transition:all .2s ease;font-weight:400}.toc-item-link:hover{background:#f8fafc;color:#1f2937 !important}.toc-item-link.active{background:#e0f2fe;color:#01579b !important;font-weight:500}.toc-dot{width:8px;height:8px;border-radius:50%;flex-shrink:0}.dot-red{background:#ef4444}.dot-blue{background:#2196f3}.toc-item-text{color:#1f2937 !important;font-weight:400;flex:1;display:inline !important;visibility:visible !important;opacity:1 !important;font-size:13px !important;line-height:1.4 !important}.toc-item-link .toc-item-text{color:#1f2937 !important;display:inline !important;visibility:visible !important;opacity:1 !important}.toc-item.active .dot-red{background:#d32f2f}.toc-item.active .dot-blue{background:#1976d2}[data-theme=dark] .sidebar-toc{background:#1f2937;border-color:#374151;box-shadow:0 1px 3px rgba(0,0,0,.3)}[data-theme=dark] .toc-header{background:#111827;border-color:#374151}[data-theme=dark] .toc-title{color:#f3f4f6 !important}[data-theme=dark] .toc-toggle{color:#9ca3af}[data-theme=dark] .toc-toggle:hover{background:#374151;color:#f3f4f6}[data-theme=dark] .toc-item-link{color:#e5e7eb !important}[data-theme=dark] .toc-item-link:hover{background:#374151;color:#f9fafb !important}[data-theme=dark] .toc-item-link.active{background:#0d47a1;color:#fff !important}[data-theme=dark] .toc-item-text{color:#f9fafb !important;display:inline !important;visibility:visible !important;opacity:1 !important}[data-theme=dark] .toc-item-link .toc-item-text{color:#f9fafb !important;display:inline !important;visibility:visible !important;opacity:1 !important}@media(max-width:1024px){.sidebar-toc{display:none}.post-content-wrapper{grid-template-columns:1fr !important;padding:0 1rem !important}}</style><style>.post-content-wrapper{display:grid;grid-template-columns:1fr 200px;gap:2rem;padding:0 2rem;max-width:100%}.post-content-main{min-width:0}.post-sidebar{position:sticky;top:2rem;height:fit-content;min-width:0}.post-header-main{margin-bottom:2rem;padding-bottom:1rem;border-bottom:1px solid var(--border,#333333)}.post-header-main .post-title{color:var(--primary,#ffffff) !important;font-size:2.5rem;font-weight:700;line-height:1.2;margin-bottom:1rem}.post-header-main .post-description{color:var(--secondary,#cccccc) !important;font-size:1.1rem;line-height:1.6;margin-bottom:1rem}.post-header-main .post-meta{margin-bottom:0}@media(max-width:1024px){.post-content-wrapper{grid-template-columns:1fr !important;gap:1rem;padding:0 1rem !important}.post-sidebar{display:none}}@media(max-width:768px){.post-header-main .post-title{font-size:2rem}.post-header-main .post-description{font-size:1rem}}</style></aside></div></article></main><footer class=footer><span>Â© 2024-2025 æœ‰æ¡å·¥å…·æŠ€æœ¯åšå®¢</span> Â·</footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");if(menu){const e=localStorage.getItem("menu-scroll-position");e&&(menu.scrollLeft=parseInt(e,10)),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}}document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{const e=document.querySelector("html");e.dataset.theme==="dark"?(e.dataset.theme="light",localStorage.setItem("pref-theme","light")):(e.dataset.theme="dark",localStorage.setItem("pref-theme","dark"))})</script></body></html>