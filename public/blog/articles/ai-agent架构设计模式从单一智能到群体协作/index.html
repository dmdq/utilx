<!doctype html><html lang=zh-cn dir=auto data-theme=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>AI Agentæ¶æ„è®¾è®¡æ¨¡å¼ï¼šä»å•ä¸€æ™ºèƒ½åˆ°ç¾¤ä½“åä½œ | æŠ€æœ¯åšå®¢ - æœ‰æ¡å·¥å…·</title><meta name=keywords content="AI Agent,LLM,æ¶æ„è®¾è®¡,å¤šæ™ºèƒ½ä½“,ReAct"><meta name=description content="æ·±å…¥æ¢è®¨AI Agentçš„æ¶æ„è®¾è®¡æ¨¡å¼ï¼Œæ¶µç›–ReActã€CoTã€å¤šæ™ºèƒ½ä½“åä½œç­‰æ ¸å¿ƒæ¨¡å¼ï¼Œå¸®åŠ©å¼€å‘è€…æ„å»ºæ›´å¼ºå¤§çš„AIåº”ç”¨ç³»ç»Ÿã€‚"><meta name=author content="æœ‰æ¡å·¥å…·å›¢é˜Ÿ"><link rel=canonical href=/blog/articles/ai-agent%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%BB%8E%E5%8D%95%E4%B8%80%E6%99%BA%E8%83%BD%E5%88%B0%E7%BE%A4%E4%BD%93%E5%8D%8F%E4%BD%9C/><link crossorigin=anonymous href=/blog/assets/css/stylesheet.7e8505b7cdf8bb22ab2305e53c2700bb06c7e64faeb72cd3468823a9a3bd3d6e.css integrity="sha256-foUFt834uyKrIwXlPCcAuwbH5k+utyzTRogjqaO9PW4=" rel="preload stylesheet" as=style><link rel=icon href=/favicon.ico><link rel=icon type=image/png sizes=16x16 href=/blog/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=/blog/favicon-32x32.png><link rel=apple-touch-icon href=/blog/apple-touch-icon.png><link rel=mask-icon href=/blog/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate type=application/rss+xml href=/blog/articles/ai-agent%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%BB%8E%E5%8D%95%E4%B8%80%E6%99%BA%E8%83%BD%E5%88%B0%E7%BE%A4%E4%BD%93%E5%8D%8F%E4%BD%9C/feed.xml title=rss><link rel=alternate hreflang=zh-cn href=/blog/articles/ai-agent%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%BB%8E%E5%8D%95%E4%B8%80%E6%99%BA%E8%83%BD%E5%88%B0%E7%BE%A4%E4%BD%93%E5%8D%8F%E4%BD%9C/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51);color-scheme:dark}.list{background:var(--theme)}.toc{background:var(--entry)}}@media(prefers-color-scheme:light){.list::-webkit-scrollbar-thumb{border-color:var(--code-bg)}}</style></noscript><script>localStorage.getItem("pref-theme")==="dark"?document.querySelector("html").dataset.theme="dark":localStorage.getItem("pref-theme")==="light"?document.querySelector("html").dataset.theme="light":window.matchMedia("(prefers-color-scheme: dark)").matches?document.querySelector("html").dataset.theme="dark":document.querySelector("html").dataset.theme="light"</script><script src=/js/external-link-config.js></script><script src=/js/external-link-interceptor.js></script><link rel=stylesheet href=/blog/css/custom.css media=screen><script type=application/ld+json>{"@context":"https://schema.org","@type":"WebSite","name":"æŠ€æœ¯åšå®¢ - æœ‰æ¡å·¥å…· | å¼€å‘è€…å·¥å…·ä½¿ç”¨æ•™ç¨‹ & ç¼–ç¨‹æŠ€å·§åˆ†äº«","url":"https://www.util.cn/blog/","description":"æœ‰æ¡å·¥å…·æŠ€æœ¯åšå®¢ - åˆ†äº«å¼€å‘è€…å·¥å…·ä½¿ç”¨æ•™ç¨‹ã€ç¼–ç¨‹æŠ€å·§å’Œå®æˆ˜å¼€å‘ç»éªŒã€‚æä¾›JSONæ ¼å¼åŒ–ã€SQLä¼˜åŒ–ã€Markdownç¼–è¾‘å™¨ç­‰åœ¨çº¿å·¥å…·çš„è¯¦ç»†ä½¿ç”¨æŒ‡å—ï¼Œå¸®åŠ©å¼€å‘è€…æå‡å·¥ä½œæ•ˆç‡ã€‚","publisher":{"@type":"Organization","name":"æœ‰æ¡å·¥å…·","url":"https://www.util.cn","logo":{"@type":"ImageObject","url":"https://www.util.cn/blog/logo/logo-256.png","width":256,"height":256}},"potentialAction":[{"@type":"SearchAction","target":"https://www.util.cn/blog/search?q={search_term_string}","query-input":"required name=search_term_string"}]}</script><meta property="og:type" content="website"><meta property="og:title" content="æŠ€æœ¯åšå®¢ - æœ‰æ¡å·¥å…· | å¼€å‘è€…å·¥å…·ä½¿ç”¨æ•™ç¨‹ & ç¼–ç¨‹æŠ€å·§åˆ†äº«"><meta property="og:description" content="æœ‰æ¡å·¥å…·æŠ€æœ¯åšå®¢ - åˆ†äº«å¼€å‘è€…å·¥å…·ä½¿ç”¨æ•™ç¨‹ã€ç¼–ç¨‹æŠ€å·§å’Œå®æˆ˜å¼€å‘ç»éªŒã€‚æä¾›JSONæ ¼å¼åŒ–ã€SQLä¼˜åŒ–ã€Markdownç¼–è¾‘å™¨ç­‰åœ¨çº¿å·¥å…·çš„è¯¦ç»†ä½¿ç”¨æŒ‡å—ï¼Œå¸®åŠ©å¼€å‘è€…æå‡å·¥ä½œæ•ˆç‡ã€‚"><meta property="og:url" content="https://www.util.cn/blog/"><meta property="og:site_name" content="æœ‰æ¡å·¥å…·æŠ€æœ¯åšå®¢"><meta property="og:image" content="https://www.util.cn/blog/logo/logo-256.png"><meta property="og:image:width" content="1200"><meta property="og:image:height" content="630"><meta name=twitter:card content="summary_large_image"><meta name=twitter:title content="æŠ€æœ¯åšå®¢ - æœ‰æ¡å·¥å…· | å¼€å‘è€…å·¥å…·ä½¿ç”¨æ•™ç¨‹ & ç¼–ç¨‹æŠ€å·§åˆ†äº«"><meta name=twitter:description content="æœ‰æ¡å·¥å…·æŠ€æœ¯åšå®¢ - åˆ†äº«å¼€å‘è€…å·¥å…·ä½¿ç”¨æ•™ç¨‹ã€ç¼–ç¨‹æŠ€å·§å’Œå®æˆ˜å¼€å‘ç»éªŒã€‚"><meta name=twitter:image content="https://www.util.cn/blog/logo/logo-256.png"><meta name=baidu-site-verification content><meta name=category content="æŠ€æœ¯åšå®¢,å¼€å‘è€…å·¥å…·,ç¼–ç¨‹æ•™ç¨‹"><meta name=coverage content="Worldwide"><meta name=distribution content="Global"><meta name=rating content="General"><script id=51la_code async crossorigin=anonymous src="https://sdk.51.la/js-sdk-pro.min.js?id=3OM52V0xJAPv6ozF&hash=pro"></script><script>window.addEventListener("load",function(){setTimeout(function(){typeof la!="undefined"?console.log("51laç»Ÿè®¡å·²åŠ è½½"):(console.warn("51laç»Ÿè®¡åŠ è½½å¤±è´¥ï¼Œä½¿ç”¨å¤‡ç”¨æ–¹æ¡ˆ"),function(){var e=document.createElement("script");e.src="https://sdk.51.la/js-sdk-pro.min.js?id=3OM52V0xJAPv6ozF&hash=backup",e.async=!0,document.head.appendChild(e)}())},3e3)})</script><meta property="og:url" content="/blog/articles/ai-agent%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%BB%8E%E5%8D%95%E4%B8%80%E6%99%BA%E8%83%BD%E5%88%B0%E7%BE%A4%E4%BD%93%E5%8D%8F%E4%BD%9C/"><meta property="og:site_name" content="æŠ€æœ¯åšå®¢ - æœ‰æ¡å·¥å…·"><meta property="og:title" content="AI Agentæ¶æ„è®¾è®¡æ¨¡å¼ï¼šä»å•ä¸€æ™ºèƒ½åˆ°ç¾¤ä½“åä½œ"><meta property="og:description" content="æ·±å…¥æ¢è®¨AI Agentçš„æ¶æ„è®¾è®¡æ¨¡å¼ï¼Œæ¶µç›–ReActã€CoTã€å¤šæ™ºèƒ½ä½“åä½œç­‰æ ¸å¿ƒæ¨¡å¼ï¼Œå¸®åŠ©å¼€å‘è€…æ„å»ºæ›´å¼ºå¤§çš„AIåº”ç”¨ç³»ç»Ÿã€‚"><meta property="og:locale" content="zh-cn"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2025-12-30T08:00:00+08:00"><meta property="article:modified_time" content="2025-12-30T08:00:00+08:00"><meta property="article:tag" content="AI Agent"><meta property="article:tag" content="LLM"><meta property="article:tag" content="æ¶æ„è®¾è®¡"><meta property="article:tag" content="å¤šæ™ºèƒ½ä½“"><meta property="article:tag" content="ReAct"><meta name=twitter:card content="summary"><meta name=twitter:title content="AI Agentæ¶æ„è®¾è®¡æ¨¡å¼ï¼šä»å•ä¸€æ™ºèƒ½åˆ°ç¾¤ä½“åä½œ"><meta name=twitter:description content="æ·±å…¥æ¢è®¨AI Agentçš„æ¶æ„è®¾è®¡æ¨¡å¼ï¼Œæ¶µç›–ReActã€CoTã€å¤šæ™ºèƒ½ä½“åä½œç­‰æ ¸å¿ƒæ¨¡å¼ï¼Œå¸®åŠ©å¼€å‘è€…æ„å»ºæ›´å¼ºå¤§çš„AIåº”ç”¨ç³»ç»Ÿã€‚"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"æ‰€æœ‰æ–‡ç« ","item":"/blog/posts/"},{"@type":"ListItem","position":2,"name":"AI Agentæ¶æ„è®¾è®¡æ¨¡å¼ï¼šä»å•ä¸€æ™ºèƒ½åˆ°ç¾¤ä½“åä½œ","item":"/blog/articles/ai-agent%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%BB%8E%E5%8D%95%E4%B8%80%E6%99%BA%E8%83%BD%E5%88%B0%E7%BE%A4%E4%BD%93%E5%8D%8F%E4%BD%9C/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"AI Agentæ¶æ„è®¾è®¡æ¨¡å¼ï¼šä»å•ä¸€æ™ºèƒ½åˆ°ç¾¤ä½“åä½œ","name":"AI Agentæ¶æ„è®¾è®¡æ¨¡å¼ï¼šä»å•ä¸€æ™ºèƒ½åˆ°ç¾¤ä½“åä½œ","description":"æ·±å…¥æ¢è®¨AI Agentçš„æ¶æ„è®¾è®¡æ¨¡å¼ï¼Œæ¶µç›–ReActã€CoTã€å¤šæ™ºèƒ½ä½“åä½œç­‰æ ¸å¿ƒæ¨¡å¼ï¼Œå¸®åŠ©å¼€å‘è€…æ„å»ºæ›´å¼ºå¤§çš„AIåº”ç”¨ç³»ç»Ÿã€‚","keywords":["AI Agent","LLM","æ¶æ„è®¾è®¡","å¤šæ™ºèƒ½ä½“","ReAct"],"articleBody":"éšç€å¤§è¯­è¨€æ¨¡å‹ï¼ˆLLMï¼‰çš„å¿«é€Ÿå‘å±•ï¼ŒAI Agentå·²æˆä¸ºæ„å»ºæ™ºèƒ½åº”ç”¨çš„æ ¸å¿ƒèŒƒå¼ã€‚ä»å•ä¸€çš„å·¥å…·è°ƒç”¨åˆ°å¤æ‚çš„å¤šæ™ºèƒ½ä½“åä½œï¼ŒAgentæ¶æ„æ­£åœ¨ç»å†å¿«é€Ÿæ¼”è¿›ã€‚\nAgentåŸºç¡€æ¶æ„ æ ¸å¿ƒç»„ä»¶ ä¸€ä¸ªå®Œæ•´çš„AI Agentç³»ç»ŸåŒ…å«ä»¥ä¸‹æ ¸å¿ƒç»„ä»¶ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 from typing import TypedDict, List, Callable, Any from abc import ABC, abstractmethod from dataclasses import dataclass class Message(TypedDict): role: str # 'system' | 'user' | 'assistant' | 'tool' content: str tool_calls: List[dict] = [] class Tool(ABC): \"\"\"å·¥å…·æŠ½è±¡åŸºç±»\"\"\" @property @abstractmethod def name(self) -\u003e str: pass @property @abstractmethod def description(self) -\u003e str: pass @abstractmethod async def execute(self, **kwargs) -\u003e Any: pass @dataclass class AgentConfig: \"\"\"Agenté…ç½®\"\"\" name: str model: str temperature: float = 0.7 max_tokens: int = 2000 tools: List[Tool] = None system_prompt: str = \"\" class BaseAgent(ABC): \"\"\"AgentåŸºç±»\"\"\" def __init__(self, config: AgentConfig): self.config = config self.memory: List[Message] = [] self.tools = {tool.name: tool for tool in (config.tools or [])} @abstractmethod async def think(self, input: str) -\u003e str: \"\"\"æ€è€ƒå¹¶ç”Ÿæˆå“åº”\"\"\" pass @abstractmethod async def act(self, action: str) -\u003e Any: \"\"\"æ‰§è¡ŒåŠ¨ä½œ\"\"\" pass async def run(self, input: str) -\u003e str: \"\"\"è¿è¡ŒAgent\"\"\" response = await self.think(input) return response ReActæ¨¡å¼ æ¨ç†-è¡ŒåŠ¨ï¼ˆReasoning + Actingï¼‰æ¨¡å¼æ˜¯æœ€åŸºç¡€çš„Agentæ¶æ„ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 import re import json class ReActAgent(BaseAgent): \"\"\"ReActæ¨¡å¼Agent\"\"\" def __init__(self, config: AgentConfig): super().__init__(config) self.max_iterations = 10 async def think(self, input: str) -\u003e str: \"\"\"ReActæ€è€ƒå¾ªç¯\"\"\" # æ„å»ºç³»ç»Ÿæç¤º system_prompt = f\"\"\"ä½ æ˜¯ä¸€ä¸ªæœ‰å¸®åŠ©çš„AIåŠ©æ‰‹ã€‚ä½ å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å·¥å…·ï¼š {self._get_tools_description()} è¯·æŒ‰ç…§ä»¥ä¸‹æ ¼å¼æ€è€ƒï¼š Thought: æˆ‘åº”è¯¥... Action: å·¥å…·åç§°[å‚æ•°] Observation: å·¥å…·è¿”å›ç»“æœ ... (å¯ä»¥é‡å¤Thought/Action/Observationå¤šæ¬¡) Thought: æˆ‘ç°åœ¨çŸ¥é“æœ€ç»ˆç­”æ¡ˆäº† Answer: æœ€ç»ˆç­”æ¡ˆ å¼€å§‹å§ï¼\"\"\" # åˆå§‹åŒ–å¯¹è¯ messages = [ Message(role=\"system\", content=system_prompt), Message(role=\"user\", content=input) ] iteration = 0 while iteration \u003c self.max_iterations: # è°ƒç”¨LLM response = await self._call_llm(messages) messages.append(Message(role=\"assistant\", content=response)) # è§£æå“åº” thought_match = re.search(r'Thought:\\s*(.*?)(?=\\n(?:Action|Answer)|$)', response, re.DOTALL) action_match = re.search(r'Action:\\s*(.*?)\\[(.*?)\\]', response) answer_match = re.search(r'Answer:\\s*(.*)', response, re.DOTALL) if thought_match: thought = thought_match.group(1).strip() print(f\"Thought: {thought}\") if action_match: tool_name = action_match.group(1).strip() tool_args_str = action_match.group(2).strip() # è§£æå‚æ•° try: tool_args = json.loads(tool_args_str) except: tool_args = {\"input\": tool_args_str} # æ‰§è¡Œå·¥å…· if tool_name in self.tools: observation = await self.tools[tool_name].execute(**tool_args) messages.append(Message( role=\"user\", content=f\"Observation: {observation}\" )) print(f\"Action: {tool_name}{tool_args}\") print(f\"Observation: {observation}\") if answer_match: answer = answer_match.group(1).strip() print(f\"Answer: {answer}\") return answer iteration += 1 return \"æœªèƒ½æ‰¾åˆ°ç­”æ¡ˆ\" def _get_tools_description(self) -\u003e str: \"\"\"è·å–å·¥å…·æè¿°\"\"\" descriptions = [] for name, tool in self.tools.items(): descriptions.append(f\"- {name}: {tool.description}\") return \"\\n\".join(descriptions) async def _call_llm(self, messages: List[Message]) -\u003e str: \"\"\"è°ƒç”¨LLMï¼ˆç¤ºä¾‹å®ç°ï¼‰\"\"\" # è¿™é‡Œé›†æˆå®é™…çš„LLM API # è¿”å›æ¨¡æ‹Ÿå“åº” return \"Thought: æˆ‘éœ€è¦ä½¿ç”¨å·¥å…·\\nAction: search[query]\" async def act(self, action: str) -\u003e Any: \"\"\"æ‰§è¡ŒåŠ¨ä½œ\"\"\" pass é“¾å¼æ€ç»´ï¼ˆChain of Thoughtï¼‰ CoTé€šè¿‡å¼•å¯¼æ¨¡å‹å±•ç¤ºæ¨ç†è¿‡ç¨‹æ¥æå‡æ€§èƒ½ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 class CoTAgent(BaseAgent): \"\"\"é“¾å¼æ€ç»´Agent\"\"\" async def think(self, input: str) -\u003e str: \"\"\"ä½¿ç”¨é“¾å¼æ€ç»´æ€è€ƒ\"\"\" cot_prompt = f\"\"\"è¯·ä¸€æ­¥æ­¥æ€è€ƒè¿™ä¸ªé—®é¢˜ï¼š é—®é¢˜ï¼š{input} è®©æˆ‘ä»¬ä¸€æ­¥æ­¥åˆ†æï¼š 1. é¦–å…ˆï¼Œè®©æˆ‘ç†è§£é—®é¢˜çš„æ ¸å¿ƒ... 2. ç„¶åï¼Œæˆ‘éœ€è¦è€ƒè™‘... 3. æ¥ä¸‹æ¥... 4. æœ€åï¼Œå¾—å‡ºç»“è®º... è¯·å®Œæˆä¸Šè¿°æ€è€ƒè¿‡ç¨‹ã€‚\"\"\" # é›¶æ ·æœ¬CoT response = await self._call_llm([ Message(role=\"user\", content=cot_prompt) ]) return response async def think_with_examples(self, input: str) -\u003e str: \"\"\"å°‘æ ·æœ¬CoTï¼ˆæä¾›ç¤ºä¾‹ï¼‰\"\"\" examples = \"\"\" ç¤ºä¾‹1ï¼š é—®é¢˜ï¼šå°æ˜æœ‰3ä¸ªè‹¹æœï¼Œå°çº¢æœ‰5ä¸ªè‹¹æœï¼Œä»–ä»¬ä¸€å…±æœ‰å¤šå°‘ä¸ªè‹¹æœï¼Ÿ æ€è€ƒï¼š - å°æ˜æœ‰3ä¸ªè‹¹æœ - å°çº¢æœ‰5ä¸ªè‹¹æœ - æ€»æ•° = 3 + 5 = 8ä¸ªè‹¹æœ ç­”æ¡ˆï¼š8ä¸ªè‹¹æœ ç¤ºä¾‹2ï¼š é—®é¢˜ï¼šä¸€ä¸ªæ•°ä¹˜ä»¥3ç­‰äº15ï¼Œè¿™ä¸ªæ•°æ˜¯å¤šå°‘ï¼Ÿ æ€è€ƒï¼š - è®¾è¿™ä¸ªæ•°ä¸ºx - x Ã— 3 = 15 - x = 15 Ã· 3 = 5 ç­”æ¡ˆï¼š5 \"\"\" cot_prompt = f\"\"\"{examples} é—®é¢˜ï¼š{input} æ€è€ƒï¼š\"\"\" return await self._call_llm([ Message(role=\"user\", content=cot_prompt) ]) async def _call_llm(self, messages: List[Message]) -\u003e str: \"\"\"è°ƒç”¨LLM\"\"\" pass å¤šæ™ºèƒ½ä½“åä½œ å¤æ‚ä»»åŠ¡éœ€è¦å¤šä¸ªAgentåä½œå®Œæˆï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 from enum import Enum import asyncio class AgentRole(Enum): \"\"\"Agentè§’è‰²\"\"\" PLANNER = \"planner\" # è§„åˆ’è€… RESEARCHER = \"researcher\" # ç ”ç©¶è€… CODER = \"coder\" # ç¼–ç è€… REVIEWER = \"reviewer\" # å®¡æŸ¥è€… SUMMARIZER = \"summarizer\" # æ€»ç»“è€… @dataclass class Task: \"\"\"ä»»åŠ¡å®šä¹‰\"\"\" id: str description: str requirements: List[str] status: str = \"pending\" result: Any = None class MultiAgentSystem: \"\"\"å¤šæ™ºèƒ½ä½“åä½œç³»ç»Ÿ\"\"\" def __init__(self): self.agents: Dict[AgentRole, BaseAgent] = {} self.task_queue: asyncio.Queue = asyncio.Queue() self.completed_tasks: List[Task] = [] def register_agent(self, role: AgentRole, agent: BaseAgent): \"\"\"æ³¨å†ŒAgent\"\"\" self.agents[role] = agent async def execute_task(self, task: Task) -\u003e Task: \"\"\"æ‰§è¡Œä»»åŠ¡ï¼ˆå¤šAgentåä½œï¼‰\"\"\" print(f\"\\n{'='*50}\") print(f\"å¼€å§‹æ‰§è¡Œä»»åŠ¡: {task.description}\") print(f\"{'='*50}\\n\") # 1. è§„åˆ’é˜¶æ®µ if AgentRole.PLANNER in self.agents: print(\"[é˜¶æ®µ1] è§„åˆ’\") planner = self.agents[AgentRole.PLANNER] plan = await planner.run(f\"\"\" ä¸ºä»¥ä¸‹ä»»åŠ¡åˆ¶å®šè¯¦ç»†æ‰§è¡Œè®¡åˆ’ï¼š ä»»åŠ¡æè¿°ï¼š{task.description} è¦æ±‚ï¼š{', '.join(task.requirements)} è¯·è¾“å‡ºï¼š 1. ä»»åŠ¡åˆ†è§£ 2. æ‰§è¡Œæ­¥éª¤ 3. æ‰€éœ€èµ„æº 4. é£é™©è¯„ä¼° \"\"\") print(f\"è§„åˆ’ç»“æœï¼š\\n{plan}\\n\") # 2. ç ”ç©¶é˜¶æ®µ if AgentRole.RESEARCHER in self.agents: print(\"[é˜¶æ®µ2] ç ”ç©¶\") researcher = self.agents[AgentRole.RESEARCHER] research = await researcher.run(f\"\"\" ç ”ç©¶ä»»åŠ¡ç›¸å…³èƒŒæ™¯ä¿¡æ¯ï¼š {task.description} è¯·æä¾›ï¼š 1. æŠ€æœ¯èƒŒæ™¯ 2. æœ€ä½³å®è·µ 3. å‚è€ƒèµ„æº \"\"\") print(f\"ç ”ç©¶ç»“æœï¼š\\n{research}\\n\") # 3. æ‰§è¡Œé˜¶æ®µ if AgentRole.CODER in self.agents: print(\"[é˜¶æ®µ3] æ‰§è¡Œ\") coder = self.agents[AgentRole.CODER] result = await coder.run(f\"\"\" æ ¹æ®ä»¥ä¸‹ä¿¡æ¯å®ç°ä»»åŠ¡ï¼š ä»»åŠ¡ï¼š{task.description} è®¡åˆ’ï¼š{plan if AgentRole.PLANNER in self.agents else 'N/A'} ç ”ç©¶ï¼š{research if AgentRole.RESEARCHER in self.agents else 'N/A'} è¯·æä¾›å®Œæ•´çš„å®ç°ã€‚ \"\"\") task.result = result print(f\"æ‰§è¡Œç»“æœï¼š\\n{result}\\n\") # 4. å®¡æŸ¥é˜¶æ®µ if AgentRole.REVIEWER in self.agents: print(\"[é˜¶æ®µ4] å®¡æŸ¥\") reviewer = self.agents[AgentRole.REVIEWER] review = await reviewer.run(f\"\"\" å®¡æŸ¥ä»¥ä¸‹å®ç°ï¼š ä»»åŠ¡ï¼š{task.description} å®ç°ï¼š{result} è¯·è¯„ä¼°ï¼š 1. æ­£ç¡®æ€§ 2. æ€§èƒ½ 3. å®‰å…¨æ€§ 4. å¯ç»´æŠ¤æ€§ \"\"\") print(f\"å®¡æŸ¥ç»“æœï¼š\\n{review}\\n\") # 5. æ€»ç»“é˜¶æ®µ if AgentRole.SUMMARIZER in self.agents: print(\"[é˜¶æ®µ5] æ€»ç»“\") summarizer = self.agents[AgentRole.SUMMARIZER] summary = await summarizer.run(f\"\"\" æ€»ç»“æ•´ä¸ªä»»åŠ¡æ‰§è¡Œè¿‡ç¨‹ï¼š ä»»åŠ¡ï¼š{task.description} ç»“æœï¼š{result} å®¡æŸ¥ï¼š{review} è¯·æä¾›ï¼š 1. æ‰§è¡Œæ€»ç»“ 2. å…³é”®æ”¶è· 3. æ”¹è¿›å»ºè®® \"\"\") print(f\"æ€»ç»“ï¼š\\n{summary}\\n\") task.status = \"completed\" self.completed_tasks.append(task) print(f\"{'='*50}\") print(f\"ä»»åŠ¡å®Œæˆï¼\") print(f\"{'='*50}\\n\") return task async def run_workflow(self, tasks: List[Task]): \"\"\"è¿è¡Œå·¥ä½œæµ\"\"\" # å¹¶è¡Œæ‰§è¡Œç‹¬ç«‹ä»»åŠ¡ await asyncio.gather(*[ self.execute_task(task) for task in tasks ]) return self.completed_tasks å·¥å…·è°ƒç”¨æ¨¡å¼ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 from typing import get_type_hints import inspect class ToolRegistry: \"\"\"å·¥å…·æ³¨å†Œè¡¨\"\"\" def __init__(self): self.tools: Dict[str, Tool] = {} def register(self, tool: Tool): \"\"\"æ³¨å†Œå·¥å…·\"\"\" self.tools[tool.name] = tool def get_tool_schema(self) -\u003e List[dict]: \"\"\"è·å–å·¥å…·Schemaï¼ˆç”¨äºOpenAI Function Callingï¼‰\"\"\" schemas = [] for tool in self.tools.values(): schema = { \"type\": \"function\", \"function\": { \"name\": tool.name, \"description\": tool.description, \"parameters\": self._extract_parameters(tool) } } schemas.append(schema) return schemas def _extract_parameters(self, tool: Tool) -\u003e dict: \"\"\"ä»å·¥å…·ä¸­æå–å‚æ•°Schema\"\"\" # è·å–executeæ–¹æ³•çš„ç­¾å sig = inspect.signature(tool.execute) parameters = {} required = [] properties = {} for name, param in sig.parameters.items(): if name == 'self': continue param_type = param.annotation # ç±»å‹æ˜ å°„ type_map = { str: \"string\", int: \"integer\", float: \"number\", bool: \"boolean\", list: \"array\", dict: \"object\" } json_type = type_map.get(param_type, \"string\") property_def = {\"type\": json_type} if param.default == inspect.Parameter.empty: required.append(name) properties[name] = property_def return { \"type\": \"object\", \"properties\": properties, \"required\": required } class FunctionCallingAgent(BaseAgent): \"\"\"å‡½æ•°è°ƒç”¨Agent\"\"\" def __init__(self, config: AgentConfig, registry: ToolRegistry): super().__init__(config) self.registry = registry async def think(self, input: str) -\u003e str: \"\"\"ä½¿ç”¨å‡½æ•°è°ƒç”¨æ€è€ƒ\"\"\" messages = [ Message(role=\"system\", content=self.config.system_prompt), Message(role=\"user\", content=input) ] while True: # è°ƒç”¨LLMï¼ˆå¸¦å‡½æ•°è°ƒç”¨ï¼‰ response = await self._call_llm_with_tools( messages, tools=self.registry.get_tool_schema() ) # å¤„ç†å“åº” if response.get(\"tool_calls\"): messages.append(Message( role=\"assistant\", content=\"\", tool_calls=response[\"tool_calls\"] )) # æ‰§è¡Œå·¥å…·è°ƒç”¨ for tool_call in response[\"tool_calls\"]: tool_name = tool_call[\"function\"][\"name\"] tool_args = json.loads(tool_call[\"function\"][\"arguments\"]) if tool_name in self.registry.tools: result = await self.registry.tools[tool_name].execute(**tool_args) messages.append(Message( role=\"tool\", content=str(result), tool_call_id=tool_call[\"id\"] )) else: # æœ€ç»ˆå“åº” return response.get(\"content\", \"\") async def _call_llm_with_tools(self, messages: List[Message], tools: List[dict]) -\u003e dict: \"\"\"è°ƒç”¨LLMï¼ˆå¸¦å·¥å…·ï¼‰\"\"\" # é›†æˆå®é™…çš„LLM API pass è®°å¿†ç³»ç»Ÿ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 from datetime import datetime from typing import Optional class Memory: \"\"\"è®°å¿†æŠ½è±¡\"\"\" def __init__(self, content: str, importance: float = 0.5): self.content = content self.importance = importance # 0-1 self.timestamp = datetime.now() self.access_count = 0 class MemorySystem: \"\"\"Agentè®°å¿†ç³»ç»Ÿ\"\"\" def __init__(self, max_short_term: int = 100, max_long_term: int = 1000): self.short_term: List[Memory] = [] # çŸ­æœŸè®°å¿† self.long_term: List[Memory] = [] # é•¿æœŸè®°å¿† self.max_short_term = max_short_term self.max_long_term = max_long_term async def add(self, memory: Memory, importance: Optional[float] = None): \"\"\"æ·»åŠ è®°å¿†\"\"\" if importance is not None: memory.importance = importance # æ ¹æ®é‡è¦æ€§å†³å®šå­˜å‚¨ä½ç½® if memory.importance \u003e 0.7: self.long_term.append(memory) # é•¿æœŸè®°å¿†æ’åºï¼ˆæŒ‰é‡è¦æ€§ï¼‰ self.long_term.sort(key=lambda m: m.importance, reverse=True) # ä¿æŒå¤§å°é™åˆ¶ if len(self.long_term) \u003e self.max_long_term: self.long_term = self.long_term[:self.max_long_term] else: self.short_term.append(memory) if len(self.short_term) \u003e self.max_short_term: self.short_term.pop(0) async def retrieve(self, query: str, top_k: int = 5) -\u003e List[Memory]: \"\"\"æ£€ç´¢ç›¸å…³è®°å¿†\"\"\" # åˆå¹¶æ‰€æœ‰è®°å¿† all_memories = self.short_term + self.long_term # ç®€å•çš„å…³é”®è¯åŒ¹é…ï¼ˆå®é™…åº”ä½¿ç”¨å‘é‡ç›¸ä¼¼åº¦ï¼‰ relevant = [ memory for memory in all_memories if any(word in memory.content.lower() for word in query.lower().split()) ] # æŒ‰é‡è¦æ€§å’Œæœ€è¿‘è®¿é—®æ’åº relevant.sort( key=lambda m: (m.importance, m.access_count), reverse=True ) return relevant[:top_k] def summarize(self) -\u003e str: \"\"\"æ€»ç»“è®°å¿†\"\"\" summary_parts = [] if self.short_term: summary_parts.append(f\"çŸ­æœŸè®°å¿†: {len(self.short_term)}æ¡\") if self.long_term: important = [m for m in self.long_term if m.importance \u003e 0.8] summary_parts.append(f\"é‡è¦è®°å¿†: {len(important)}æ¡\") return \"; \".join(summary_parts) class MemoryAgent(BaseAgent): \"\"\"å¸¦è®°å¿†çš„Agent\"\"\" def __init__(self, config: AgentConfig, memory: MemorySystem): super().__init__(config) self.memory = memory async def think(self, input: str) -\u003e str: \"\"\"å¸¦è®°å¿†çš„æ€è€ƒ\"\"\" # æ£€ç´¢ç›¸å…³è®°å¿† relevant_memories = await self.memory.retrieve(input) # æ„å»ºä¸Šä¸‹æ–‡ context = f\"\"\"ç›¸å…³è®°å¿†ï¼š {chr(10).join(f\"- {m.content}\" for m in relevant_memories)} å½“å‰é—®é¢˜ï¼š{input} \"\"\" # ç”Ÿæˆå“åº” response = await self._call_llm([ Message(role=\"user\", content=context) ]) # å­˜å‚¨æ–°è®°å¿† await self.memory.add(Memory( content=f\"Q: {input}\\nA: {response}\", importance=0.5 )) return response async def _call_llm(self, messages: List[Message]) -\u003e str: \"\"\"è°ƒç”¨LLM\"\"\" pass Agentè¯„ä¼° 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 class AgentEvaluator: \"\"\"Agentè¯„ä¼°å™¨\"\"\" async def evaluate( self, agent: BaseAgent, test_cases: List[dict] ) -\u003e dict: \"\"\" test_cases: [ { \"input\": \"é—®é¢˜\", \"expected_output\": \"é¢„æœŸè¾“å‡º\", \"criteria\": [\"å‡†ç¡®æ€§\", \"å®Œæ•´æ€§\", \"ç›¸å…³æ€§\"] } ] \"\"\" results = { \"total\": len(test_cases), \"success\": 0, \"failed\": 0, \"avg_score\": 0, \"details\": [] } total_score = 0 for case in test_cases: # æ‰§è¡Œ try: output = await agent.run(case[\"input\"]) # è¯„ä¼° score = await self._score_output( output, case[\"expected_output\"], case.get(\"criteria\", []) ) detail = { \"input\": case[\"input\"], \"output\": output, \"expected\": case[\"expected_output\"], \"score\": score, \"success\": score \u003e 0.6 } results[\"details\"].append(detail) total_score += score if score \u003e 0.6: results[\"success\"] += 1 else: results[\"failed\"] += 1 except Exception as e: results[\"failed\"] += 1 results[\"details\"].append({ \"input\": case[\"input\"], \"error\": str(e) }) results[\"avg_score\"] = total_score / len(test_cases) return results async def _score_output( self, output: str, expected: str, criteria: List[str] ) -\u003e float: \"\"\"è¯„åˆ†\"\"\" # ç®€å•å®ç°ï¼šæ£€æŸ¥å…³é”®è¯åŒ¹é… expected_keywords = set(expected.lower().split()) output_keywords = set(output.lower().split()) overlap = len(expected_keywords \u0026 output_keywords) coverage = overlap / len(expected_keywords) if expected_keywords else 0 return coverage æœ€ä½³å®è·µ æ˜ç¡®è§’è‰²å®šä½ï¼šæ¯ä¸ªAgentåº”æœ‰æ¸…æ™°çš„èŒè´£ åˆç†æ‹†åˆ†ä»»åŠ¡ï¼šå¤æ‚ä»»åŠ¡åˆ†è§£ä¸ºå¯ç®¡ç†çš„å­ä»»åŠ¡ å·¥å…·é€‰æ‹©ï¼šæä¾›é«˜è´¨é‡çš„å·¥å…·é›† è®°å¿†ç®¡ç†ï¼šåŒºåˆ†çŸ­æœŸå’Œé•¿æœŸè®°å¿† è¿­ä»£ä¼˜åŒ–ï¼šæŒç»­è¯„ä¼°å’Œæ”¹è¿› AI Agentæ¶æ„æ­£åœ¨å¿«é€Ÿå‘å±•ï¼ŒæŒæ¡è¿™äº›æ ¸å¿ƒæ¨¡å¼å°†å¸®åŠ©å¼€å‘è€…æ„å»ºæ›´å¼ºå¤§çš„AIåº”ç”¨ã€‚\n","wordCount":"2041","inLanguage":"zh-cn","datePublished":"2025-12-30T08:00:00+08:00","dateModified":"2025-12-30T08:00:00+08:00","author":{"@type":"Person","name":"æœ‰æ¡å·¥å…·å›¢é˜Ÿ"},"mainEntityOfPage":{"@type":"WebPage","@id":"/blog/articles/ai-agent%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%BB%8E%E5%8D%95%E4%B8%80%E6%99%BA%E8%83%BD%E5%88%B0%E7%BE%A4%E4%BD%93%E5%8D%8F%E4%BD%9C/"},"publisher":{"@type":"Organization","name":"æŠ€æœ¯åšå®¢ - æœ‰æ¡å·¥å…·","logo":{"@type":"ImageObject","url":"/favicon.ico"}}}</script></head><body id=top><header class=header><nav class=nav><div class=logo><a href=/blog/ accesskey=h title="æŠ€æœ¯åšå®¢ - æœ‰æ¡å·¥å…· (Alt + H)">æŠ€æœ¯åšå®¢ - æœ‰æ¡å·¥å…·</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=/blog/posts/ title="æ‰€æœ‰æ–‡ç« åˆ—è¡¨ - æœ‰æ¡å·¥å…·æŠ€æœ¯åšå®¢ï¼šæŸ¥çœ‹æ‰€æœ‰æŠ€æœ¯æ–‡ç« å’Œæ•™ç¨‹å†…å®¹"><span>æ–‡ç« </span></a></li><li><a href=https://www.util.cn title="æœ‰æ¡å·¥å…· - å¼€å‘è€…çš„å¸¸ç”¨å·¥å…·é›†åˆï¼šæ— å¹¿å‘Š Â· æœ¬åœ°è®¡ç®— Â· å³å¼€å³ç”¨çš„åœ¨çº¿å·¥å…·å¹³å°ï¼Œæä¾›JSONæ ¼å¼åŒ–ã€SQLæ ¼å¼åŒ–ã€Markdownç¼–è¾‘å™¨ç­‰å®ç”¨å·¥å…·"><span>æœ‰æ¡å·¥å…·</span>&nbsp;
<svg fill="none" shape-rendering="geometricPrecision" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" height="12" width="12"><path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"/><path d="M15 3h6v6"/><path d="M10 14 21 3"/></svg></a></li><li><a href=/blog/categories/ title="æ–‡ç« åˆ†ç±» - æœ‰æ¡å·¥å…·æŠ€æœ¯åšå®¢ï¼šæŒ‰æŠ€æœ¯é¢†åŸŸåˆ†ç±»çš„ä¼˜è´¨æ–‡ç« ï¼ŒåŒ…æ‹¬å‰ç«¯å¼€å‘ã€å·¥å…·ä½¿ç”¨ã€ç¼–ç¨‹æŠ€å·§ç­‰"><span>åˆ†ç±»</span></a></li><li><a href=/blog/tags/ title="æ ‡ç­¾äº‘ - æœ‰æ¡å·¥å…·æŠ€æœ¯åšå®¢ï¼šé€šè¿‡æ ‡ç­¾å¿«é€Ÿæ‰¾åˆ°æ„Ÿå…´è¶£çš„æŠ€æœ¯æ–‡ç« å’Œæ•™ç¨‹å†…å®¹"><span>æ ‡ç­¾</span></a></li><li><a href=/blog/archives/ title="æ–‡ç« å½’æ¡£ - æœ‰æ¡å·¥å…·æŠ€æœ¯åšå®¢ï¼šæŒ‰æ—¶é—´æŸ¥çœ‹å†å²æ–‡ç« "><span>å½’æ¡£</span></a></li><li><a href=/blog/search/ title="æœç´¢æ–‡ç«  - æœ‰æ¡å·¥å…·æŠ€æœ¯åšå®¢ï¼šé€šè¿‡å…³é”®è¯æœç´¢æ‰¾åˆ°æ„Ÿå…´è¶£çš„æŠ€æœ¯æ–‡ç« å’Œæ•™ç¨‹å†…å®¹ï¼Œæ”¯æŒæ ‡é¢˜ã€å†…å®¹ã€åˆ†ç±»å’Œæ ‡ç­¾æœç´¢"><span>æœç´¢</span></a></li></ul></nav></header><main class=main><article class=post-single><div class=post-content-wrapper><main class=post-content-main><header class=post-header-main><h1 class="post-title entry-hint-parent">AI Agentæ¶æ„è®¾è®¡æ¨¡å¼ï¼šä»å•ä¸€æ™ºèƒ½åˆ°ç¾¤ä½“åä½œ</h1><div class=post-meta><div class=post-meta-content><div class=post-categories-inline><a href=/blog/categories/ai%E5%BC%80%E5%8F%91/ class=category-link>AIå¼€å‘</a></div><span class=post-date>2025-12-30</span><span class=post-author>æœ‰æ¡å·¥å…·å›¢é˜Ÿ</span></div><style>.post-meta-content{display:flex;align-items:center;flex-wrap:wrap;gap:.75rem;font-family:sf mono,monaco,courier new,monospace;font-size:.875rem;color:#9ca3af !important}.post-categories-inline{display:inline-flex;align-items:center;gap:.5rem}.category-link{display:inline-flex;align-items:center;gap:.25rem;padding:.25rem .75rem;background:rgba(255,255,255,.1);color:#e5e7eb !important;text-decoration:none;font-size:.75rem;font-weight:600;text-transform:uppercase;letter-spacing:.05em;border:1px solid rgba(255,255,255,.2);border-radius:0;transition:all .3s ease;white-space:nowrap}.category-link:hover{background:rgba(255,255,255,.2);color:#fff !important;border-color:rgba(255,255,255,.3);transform:translateY(-1px)}.category-link::before{content:'ğŸ“';font-size:.7rem;opacity:.8}.post-date,.post-reading-time,.post-word-count,.post-author{color:#9ca3af !important}[data-theme=dark] .post-meta-content{color:#9ca3af !important}[data-theme=dark] .category-link{background:rgba(255,255,255,.1);color:#e5e7eb !important;border-color:rgba(255,255,255,.2)}[data-theme=dark] .category-link:hover{background:rgba(255,255,255,.2);color:#fff !important;border-color:rgba(255,255,255,.3)}[data-theme=dark] .post-date,[data-theme=dark] .post-reading-time,[data-theme=dark] .post-word-count,[data-theme=dark] .post-author{color:#9ca3af !important}[data-theme=light] .post-meta-content{color:#6c757d !important}[data-theme=light] .category-link{background:rgba(0,0,0,5%);color:#495057 !important;border-color:rgba(0,0,0,.15)}[data-theme=light] .category-link:hover{background:rgba(0,102,204,.1);color:#212529 !important;border-color:rgba(0,102,204,.3)}[data-theme=light] .post-date,[data-theme=light] .post-reading-time,[data-theme=light] .post-word-count,[data-theme=light] .post-author{color:#6c757d !important}@media(max-width:768px){.post-meta-content{gap:.5rem;font-size:.8rem}.category-link{padding:.2rem .6rem;font-size:.7rem}}</style></div></header><div class=post-content><p>éšç€å¤§è¯­è¨€æ¨¡å‹ï¼ˆLLMï¼‰çš„å¿«é€Ÿå‘å±•ï¼ŒAI Agentå·²æˆä¸ºæ„å»ºæ™ºèƒ½åº”ç”¨çš„æ ¸å¿ƒèŒƒå¼ã€‚ä»å•ä¸€çš„å·¥å…·è°ƒç”¨åˆ°å¤æ‚çš„å¤šæ™ºèƒ½ä½“åä½œï¼ŒAgentæ¶æ„æ­£åœ¨ç»å†å¿«é€Ÿæ¼”è¿›ã€‚</p><h2 id=agentåŸºç¡€æ¶æ„>AgentåŸºç¡€æ¶æ„<a hidden class=anchor aria-hidden=true href=#agentåŸºç¡€æ¶æ„>#</a></h2><h3 id=æ ¸å¿ƒç»„ä»¶>æ ¸å¿ƒç»„ä»¶<a hidden class=anchor aria-hidden=true href=#æ ¸å¿ƒç»„ä»¶>#</a></h3><p>ä¸€ä¸ªå®Œæ•´çš„AI Agentç³»ç»ŸåŒ…å«ä»¥ä¸‹æ ¸å¿ƒç»„ä»¶ï¼š</p><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">56
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">57
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">58
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#ff7b72>from</span> <span style=color:#ff7b72>typing</span> <span style=color:#ff7b72>import</span> TypedDict, List, Callable, Any
</span></span><span style=display:flex><span><span style=color:#ff7b72>from</span> <span style=color:#ff7b72>abc</span> <span style=color:#ff7b72>import</span> ABC, abstractmethod
</span></span><span style=display:flex><span><span style=color:#ff7b72>from</span> <span style=color:#ff7b72>dataclasses</span> <span style=color:#ff7b72>import</span> dataclass
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>class</span> <span style=color:#f0883e;font-weight:700>Message</span>(TypedDict):
</span></span><span style=display:flex><span>    role: str  <span style=color:#8b949e;font-style:italic># &#39;system&#39; | &#39;user&#39; | &#39;assistant&#39; | &#39;tool&#39;</span>
</span></span><span style=display:flex><span>    content: str
</span></span><span style=display:flex><span>    tool_calls: List[dict] <span style=color:#ff7b72;font-weight:700>=</span> []
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>class</span> <span style=color:#f0883e;font-weight:700>Tool</span>(ABC):
</span></span><span style=display:flex><span>    <span style=color:#a5d6ff>&#34;&#34;&#34;å·¥å…·æŠ½è±¡åŸºç±»&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#d2a8ff;font-weight:700>@property</span>
</span></span><span style=display:flex><span>    <span style=color:#d2a8ff;font-weight:700>@abstractmethod</span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>name</span>(self) <span style=color:#ff7b72;font-weight:700>-&gt;</span> str:
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>pass</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#d2a8ff;font-weight:700>@property</span>
</span></span><span style=display:flex><span>    <span style=color:#d2a8ff;font-weight:700>@abstractmethod</span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>description</span>(self) <span style=color:#ff7b72;font-weight:700>-&gt;</span> str:
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>pass</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#d2a8ff;font-weight:700>@abstractmethod</span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>async</span> <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>execute</span>(self, <span style=color:#ff7b72;font-weight:700>**</span>kwargs) <span style=color:#ff7b72;font-weight:700>-&gt;</span> Any:
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>pass</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#d2a8ff;font-weight:700>@dataclass</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>class</span> <span style=color:#f0883e;font-weight:700>AgentConfig</span>:
</span></span><span style=display:flex><span>    <span style=color:#a5d6ff>&#34;&#34;&#34;Agenté…ç½®&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>    name: str
</span></span><span style=display:flex><span>    model: str
</span></span><span style=display:flex><span>    temperature: float <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>0.7</span>
</span></span><span style=display:flex><span>    max_tokens: int <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>2000</span>
</span></span><span style=display:flex><span>    tools: List[Tool] <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#79c0ff>None</span>
</span></span><span style=display:flex><span>    system_prompt: str <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>class</span> <span style=color:#f0883e;font-weight:700>BaseAgent</span>(ABC):
</span></span><span style=display:flex><span>    <span style=color:#a5d6ff>&#34;&#34;&#34;AgentåŸºç±»&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>__init__</span>(self, config: AgentConfig):
</span></span><span style=display:flex><span>        self<span style=color:#ff7b72;font-weight:700>.</span>config <span style=color:#ff7b72;font-weight:700>=</span> config
</span></span><span style=display:flex><span>        self<span style=color:#ff7b72;font-weight:700>.</span>memory: List[Message] <span style=color:#ff7b72;font-weight:700>=</span> []
</span></span><span style=display:flex><span>        self<span style=color:#ff7b72;font-weight:700>.</span>tools <span style=color:#ff7b72;font-weight:700>=</span> {tool<span style=color:#ff7b72;font-weight:700>.</span>name: tool <span style=color:#ff7b72>for</span> tool <span style=color:#ff7b72;font-weight:700>in</span> (config<span style=color:#ff7b72;font-weight:700>.</span>tools <span style=color:#ff7b72;font-weight:700>or</span> [])}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#d2a8ff;font-weight:700>@abstractmethod</span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>async</span> <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>think</span>(self, input: str) <span style=color:#ff7b72;font-weight:700>-&gt;</span> str:
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;&#34;&#34;æ€è€ƒå¹¶ç”Ÿæˆå“åº”&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>pass</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#d2a8ff;font-weight:700>@abstractmethod</span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>async</span> <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>act</span>(self, action: str) <span style=color:#ff7b72;font-weight:700>-&gt;</span> Any:
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;&#34;&#34;æ‰§è¡ŒåŠ¨ä½œ&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>pass</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>async</span> <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>run</span>(self, input: str) <span style=color:#ff7b72;font-weight:700>-&gt;</span> str:
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;&#34;&#34;è¿è¡ŒAgent&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>        response <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#ff7b72>await</span> self<span style=color:#ff7b72;font-weight:700>.</span>think(input)
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>return</span> response
</span></span></code></pre></td></tr></table></div></div><h2 id=reactæ¨¡å¼>ReActæ¨¡å¼<a hidden class=anchor aria-hidden=true href=#reactæ¨¡å¼>#</a></h2><p>æ¨ç†-è¡ŒåŠ¨ï¼ˆReasoning + Actingï¼‰æ¨¡å¼æ˜¯æœ€åŸºç¡€çš„Agentæ¶æ„ï¼š</p><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">56
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">57
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">58
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">59
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">60
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">61
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">62
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">63
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">64
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">65
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">66
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">67
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">68
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">69
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">70
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">71
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">72
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">73
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">74
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">75
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">76
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">77
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">78
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">79
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">80
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">81
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">82
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">83
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">84
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">85
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">86
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">87
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">88
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">89
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">90
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">91
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">92
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">93
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">94
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#ff7b72>import</span> <span style=color:#ff7b72>re</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>import</span> <span style=color:#ff7b72>json</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>class</span> <span style=color:#f0883e;font-weight:700>ReActAgent</span>(BaseAgent):
</span></span><span style=display:flex><span>    <span style=color:#a5d6ff>&#34;&#34;&#34;ReActæ¨¡å¼Agent&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>__init__</span>(self, config: AgentConfig):
</span></span><span style=display:flex><span>        super()<span style=color:#ff7b72;font-weight:700>.</span><span style=color:#d2a8ff;font-weight:700>__init__</span>(config)
</span></span><span style=display:flex><span>        self<span style=color:#ff7b72;font-weight:700>.</span>max_iterations <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>10</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>async</span> <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>think</span>(self, input: str) <span style=color:#ff7b72;font-weight:700>-&gt;</span> str:
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;&#34;&#34;ReActæ€è€ƒå¾ªç¯&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># æ„å»ºç³»ç»Ÿæç¤º</span>
</span></span><span style=display:flex><span>        system_prompt <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#79c0ff>f</span><span style=color:#a5d6ff>&#34;&#34;&#34;ä½ æ˜¯ä¸€ä¸ªæœ‰å¸®åŠ©çš„AIåŠ©æ‰‹ã€‚ä½ å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å·¥å…·ï¼š
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff></span><span style=color:#a5d6ff>{</span>self<span style=color:#ff7b72;font-weight:700>.</span>_get_tools_description()<span style=color:#a5d6ff>}</span><span style=color:#a5d6ff>
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>è¯·æŒ‰ç…§ä»¥ä¸‹æ ¼å¼æ€è€ƒï¼š
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>Thought: æˆ‘åº”è¯¥...
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>Action: å·¥å…·åç§°[å‚æ•°]
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>Observation: å·¥å…·è¿”å›ç»“æœ
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>... (å¯ä»¥é‡å¤Thought/Action/Observationå¤šæ¬¡)
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>Thought: æˆ‘ç°åœ¨çŸ¥é“æœ€ç»ˆç­”æ¡ˆäº†
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>Answer: æœ€ç»ˆç­”æ¡ˆ
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>å¼€å§‹å§ï¼&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># åˆå§‹åŒ–å¯¹è¯</span>
</span></span><span style=display:flex><span>        messages <span style=color:#ff7b72;font-weight:700>=</span> [
</span></span><span style=display:flex><span>            Message(role<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>&#34;system&#34;</span>, content<span style=color:#ff7b72;font-weight:700>=</span>system_prompt),
</span></span><span style=display:flex><span>            Message(role<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>&#34;user&#34;</span>, content<span style=color:#ff7b72;font-weight:700>=</span>input)
</span></span><span style=display:flex><span>        ]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        iteration <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>0</span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>while</span> iteration <span style=color:#ff7b72;font-weight:700>&lt;</span> self<span style=color:#ff7b72;font-weight:700>.</span>max_iterations:
</span></span><span style=display:flex><span>            <span style=color:#8b949e;font-style:italic># è°ƒç”¨LLM</span>
</span></span><span style=display:flex><span>            response <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#ff7b72>await</span> self<span style=color:#ff7b72;font-weight:700>.</span>_call_llm(messages)
</span></span><span style=display:flex><span>            messages<span style=color:#ff7b72;font-weight:700>.</span>append(Message(role<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>&#34;assistant&#34;</span>, content<span style=color:#ff7b72;font-weight:700>=</span>response))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#8b949e;font-style:italic># è§£æå“åº”</span>
</span></span><span style=display:flex><span>            thought_match <span style=color:#ff7b72;font-weight:700>=</span> re<span style=color:#ff7b72;font-weight:700>.</span>search(<span style=color:#79c0ff>r</span><span style=color:#a5d6ff>&#39;Thought:\s*(.*?)(?=\n(?:Action|Answer)|$)&#39;</span>, response, re<span style=color:#ff7b72;font-weight:700>.</span>DOTALL)
</span></span><span style=display:flex><span>            action_match <span style=color:#ff7b72;font-weight:700>=</span> re<span style=color:#ff7b72;font-weight:700>.</span>search(<span style=color:#79c0ff>r</span><span style=color:#a5d6ff>&#39;Action:\s*(.*?)\[(.*?)\]&#39;</span>, response)
</span></span><span style=display:flex><span>            answer_match <span style=color:#ff7b72;font-weight:700>=</span> re<span style=color:#ff7b72;font-weight:700>.</span>search(<span style=color:#79c0ff>r</span><span style=color:#a5d6ff>&#39;Answer:\s*(.*)&#39;</span>, response, re<span style=color:#ff7b72;font-weight:700>.</span>DOTALL)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>if</span> thought_match:
</span></span><span style=display:flex><span>                thought <span style=color:#ff7b72;font-weight:700>=</span> thought_match<span style=color:#ff7b72;font-weight:700>.</span>group(<span style=color:#a5d6ff>1</span>)<span style=color:#ff7b72;font-weight:700>.</span>strip()
</span></span><span style=display:flex><span>                print(<span style=color:#79c0ff>f</span><span style=color:#a5d6ff>&#34;Thought: </span><span style=color:#a5d6ff>{</span>thought<span style=color:#a5d6ff>}</span><span style=color:#a5d6ff>&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>if</span> action_match:
</span></span><span style=display:flex><span>                tool_name <span style=color:#ff7b72;font-weight:700>=</span> action_match<span style=color:#ff7b72;font-weight:700>.</span>group(<span style=color:#a5d6ff>1</span>)<span style=color:#ff7b72;font-weight:700>.</span>strip()
</span></span><span style=display:flex><span>                tool_args_str <span style=color:#ff7b72;font-weight:700>=</span> action_match<span style=color:#ff7b72;font-weight:700>.</span>group(<span style=color:#a5d6ff>2</span>)<span style=color:#ff7b72;font-weight:700>.</span>strip()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>                <span style=color:#8b949e;font-style:italic># è§£æå‚æ•°</span>
</span></span><span style=display:flex><span>                <span style=color:#ff7b72>try</span>:
</span></span><span style=display:flex><span>                    tool_args <span style=color:#ff7b72;font-weight:700>=</span> json<span style=color:#ff7b72;font-weight:700>.</span>loads(tool_args_str)
</span></span><span style=display:flex><span>                <span style=color:#ff7b72>except</span>:
</span></span><span style=display:flex><span>                    tool_args <span style=color:#ff7b72;font-weight:700>=</span> {<span style=color:#a5d6ff>&#34;input&#34;</span>: tool_args_str}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>                <span style=color:#8b949e;font-style:italic># æ‰§è¡Œå·¥å…·</span>
</span></span><span style=display:flex><span>                <span style=color:#ff7b72>if</span> tool_name <span style=color:#ff7b72;font-weight:700>in</span> self<span style=color:#ff7b72;font-weight:700>.</span>tools:
</span></span><span style=display:flex><span>                    observation <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#ff7b72>await</span> self<span style=color:#ff7b72;font-weight:700>.</span>tools[tool_name]<span style=color:#ff7b72;font-weight:700>.</span>execute(<span style=color:#ff7b72;font-weight:700>**</span>tool_args)
</span></span><span style=display:flex><span>                    messages<span style=color:#ff7b72;font-weight:700>.</span>append(Message(
</span></span><span style=display:flex><span>                        role<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>&#34;user&#34;</span>,
</span></span><span style=display:flex><span>                        content<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#79c0ff>f</span><span style=color:#a5d6ff>&#34;Observation: </span><span style=color:#a5d6ff>{</span>observation<span style=color:#a5d6ff>}</span><span style=color:#a5d6ff>&#34;</span>
</span></span><span style=display:flex><span>                    ))
</span></span><span style=display:flex><span>                    print(<span style=color:#79c0ff>f</span><span style=color:#a5d6ff>&#34;Action: </span><span style=color:#a5d6ff>{</span>tool_name<span style=color:#a5d6ff>}{</span>tool_args<span style=color:#a5d6ff>}</span><span style=color:#a5d6ff>&#34;</span>)
</span></span><span style=display:flex><span>                    print(<span style=color:#79c0ff>f</span><span style=color:#a5d6ff>&#34;Observation: </span><span style=color:#a5d6ff>{</span>observation<span style=color:#a5d6ff>}</span><span style=color:#a5d6ff>&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>if</span> answer_match:
</span></span><span style=display:flex><span>                answer <span style=color:#ff7b72;font-weight:700>=</span> answer_match<span style=color:#ff7b72;font-weight:700>.</span>group(<span style=color:#a5d6ff>1</span>)<span style=color:#ff7b72;font-weight:700>.</span>strip()
</span></span><span style=display:flex><span>                print(<span style=color:#79c0ff>f</span><span style=color:#a5d6ff>&#34;Answer: </span><span style=color:#a5d6ff>{</span>answer<span style=color:#a5d6ff>}</span><span style=color:#a5d6ff>&#34;</span>)
</span></span><span style=display:flex><span>                <span style=color:#ff7b72>return</span> answer
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            iteration <span style=color:#ff7b72;font-weight:700>+=</span> <span style=color:#a5d6ff>1</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>return</span> <span style=color:#a5d6ff>&#34;æœªèƒ½æ‰¾åˆ°ç­”æ¡ˆ&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>_get_tools_description</span>(self) <span style=color:#ff7b72;font-weight:700>-&gt;</span> str:
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;&#34;&#34;è·å–å·¥å…·æè¿°&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>        descriptions <span style=color:#ff7b72;font-weight:700>=</span> []
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>for</span> name, tool <span style=color:#ff7b72;font-weight:700>in</span> self<span style=color:#ff7b72;font-weight:700>.</span>tools<span style=color:#ff7b72;font-weight:700>.</span>items():
</span></span><span style=display:flex><span>            descriptions<span style=color:#ff7b72;font-weight:700>.</span>append(<span style=color:#79c0ff>f</span><span style=color:#a5d6ff>&#34;- </span><span style=color:#a5d6ff>{</span>name<span style=color:#a5d6ff>}</span><span style=color:#a5d6ff>: </span><span style=color:#a5d6ff>{</span>tool<span style=color:#ff7b72;font-weight:700>.</span>description<span style=color:#a5d6ff>}</span><span style=color:#a5d6ff>&#34;</span>)
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>return</span> <span style=color:#a5d6ff>&#34;</span><span style=color:#79c0ff>\n</span><span style=color:#a5d6ff>&#34;</span><span style=color:#ff7b72;font-weight:700>.</span>join(descriptions)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>async</span> <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>_call_llm</span>(self, messages: List[Message]) <span style=color:#ff7b72;font-weight:700>-&gt;</span> str:
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;&#34;&#34;è°ƒç”¨LLMï¼ˆç¤ºä¾‹å®ç°ï¼‰&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># è¿™é‡Œé›†æˆå®é™…çš„LLM API</span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># è¿”å›æ¨¡æ‹Ÿå“åº”</span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>return</span> <span style=color:#a5d6ff>&#34;Thought: æˆ‘éœ€è¦ä½¿ç”¨å·¥å…·</span><span style=color:#79c0ff>\n</span><span style=color:#a5d6ff>Action: search[query]&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>async</span> <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>act</span>(self, action: str) <span style=color:#ff7b72;font-weight:700>-&gt;</span> Any:
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;&#34;&#34;æ‰§è¡ŒåŠ¨ä½œ&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>pass</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=é“¾å¼æ€ç»´chain-of-thought>é“¾å¼æ€ç»´ï¼ˆChain of Thoughtï¼‰<a hidden class=anchor aria-hidden=true href=#é“¾å¼æ€ç»´chain-of-thought>#</a></h2><p>CoTé€šè¿‡å¼•å¯¼æ¨¡å‹å±•ç¤ºæ¨ç†è¿‡ç¨‹æ¥æå‡æ€§èƒ½ï¼š</p><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">56
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">57
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">58
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">59
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#ff7b72>class</span> <span style=color:#f0883e;font-weight:700>CoTAgent</span>(BaseAgent):
</span></span><span style=display:flex><span>    <span style=color:#a5d6ff>&#34;&#34;&#34;é“¾å¼æ€ç»´Agent&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>async</span> <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>think</span>(self, input: str) <span style=color:#ff7b72;font-weight:700>-&gt;</span> str:
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;&#34;&#34;ä½¿ç”¨é“¾å¼æ€ç»´æ€è€ƒ&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        cot_prompt <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#79c0ff>f</span><span style=color:#a5d6ff>&#34;&#34;&#34;è¯·ä¸€æ­¥æ­¥æ€è€ƒè¿™ä¸ªé—®é¢˜ï¼š
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>é—®é¢˜ï¼š</span><span style=color:#a5d6ff>{</span>input<span style=color:#a5d6ff>}</span><span style=color:#a5d6ff>
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>è®©æˆ‘ä»¬ä¸€æ­¥æ­¥åˆ†æï¼š
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>1. é¦–å…ˆï¼Œè®©æˆ‘ç†è§£é—®é¢˜çš„æ ¸å¿ƒ...
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>2. ç„¶åï¼Œæˆ‘éœ€è¦è€ƒè™‘...
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>3. æ¥ä¸‹æ¥...
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>4. æœ€åï¼Œå¾—å‡ºç»“è®º...
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>è¯·å®Œæˆä¸Šè¿°æ€è€ƒè¿‡ç¨‹ã€‚&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># é›¶æ ·æœ¬CoT</span>
</span></span><span style=display:flex><span>        response <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#ff7b72>await</span> self<span style=color:#ff7b72;font-weight:700>.</span>_call_llm([
</span></span><span style=display:flex><span>            Message(role<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>&#34;user&#34;</span>, content<span style=color:#ff7b72;font-weight:700>=</span>cot_prompt)
</span></span><span style=display:flex><span>        ])
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>return</span> response
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>async</span> <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>think_with_examples</span>(self, input: str) <span style=color:#ff7b72;font-weight:700>-&gt;</span> str:
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;&#34;&#34;å°‘æ ·æœ¬CoTï¼ˆæä¾›ç¤ºä¾‹ï¼‰&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        examples <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>&#34;&#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>ç¤ºä¾‹1ï¼š
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>é—®é¢˜ï¼šå°æ˜æœ‰3ä¸ªè‹¹æœï¼Œå°çº¢æœ‰5ä¸ªè‹¹æœï¼Œä»–ä»¬ä¸€å…±æœ‰å¤šå°‘ä¸ªè‹¹æœï¼Ÿ
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>æ€è€ƒï¼š
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>- å°æ˜æœ‰3ä¸ªè‹¹æœ
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>- å°çº¢æœ‰5ä¸ªè‹¹æœ
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>- æ€»æ•° = 3 + 5 = 8ä¸ªè‹¹æœ
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>ç­”æ¡ˆï¼š8ä¸ªè‹¹æœ
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>ç¤ºä¾‹2ï¼š
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>é—®é¢˜ï¼šä¸€ä¸ªæ•°ä¹˜ä»¥3ç­‰äº15ï¼Œè¿™ä¸ªæ•°æ˜¯å¤šå°‘ï¼Ÿ
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>æ€è€ƒï¼š
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>- è®¾è¿™ä¸ªæ•°ä¸ºx
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>- x Ã— 3 = 15
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>- x = 15 Ã· 3 = 5
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>ç­”æ¡ˆï¼š5
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        cot_prompt <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#79c0ff>f</span><span style=color:#a5d6ff>&#34;&#34;&#34;</span><span style=color:#a5d6ff>{</span>examples<span style=color:#a5d6ff>}</span><span style=color:#a5d6ff>
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>é—®é¢˜ï¼š</span><span style=color:#a5d6ff>{</span>input<span style=color:#a5d6ff>}</span><span style=color:#a5d6ff>
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>æ€è€ƒï¼š&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>return</span> <span style=color:#ff7b72>await</span> self<span style=color:#ff7b72;font-weight:700>.</span>_call_llm([
</span></span><span style=display:flex><span>            Message(role<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>&#34;user&#34;</span>, content<span style=color:#ff7b72;font-weight:700>=</span>cot_prompt)
</span></span><span style=display:flex><span>        ])
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>async</span> <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>_call_llm</span>(self, messages: List[Message]) <span style=color:#ff7b72;font-weight:700>-&gt;</span> str:
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;&#34;&#34;è°ƒç”¨LLM&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>pass</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=å¤šæ™ºèƒ½ä½“åä½œ>å¤šæ™ºèƒ½ä½“åä½œ<a hidden class=anchor aria-hidden=true href=#å¤šæ™ºèƒ½ä½“åä½œ>#</a></h2><p>å¤æ‚ä»»åŠ¡éœ€è¦å¤šä¸ªAgentåä½œå®Œæˆï¼š</p><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 56
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 57
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 58
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 59
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 60
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 61
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 62
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 63
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 64
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 65
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 66
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 67
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 68
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 69
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 70
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 71
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 72
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 73
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 74
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 75
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 76
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 77
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 78
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 79
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 80
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 81
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 82
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 83
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 84
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 85
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 86
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 87
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 88
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 89
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 90
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 91
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 92
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 93
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 94
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 95
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 96
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 97
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 98
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 99
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">100
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">101
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">102
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">103
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">104
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">105
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">106
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">107
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">108
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">109
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">110
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">111
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">112
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">113
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">114
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">115
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">116
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">117
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">118
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">119
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">120
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">121
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">122
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">123
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">124
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">125
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">126
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">127
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">128
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">129
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">130
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">131
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">132
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">133
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">134
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">135
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">136
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">137
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">138
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">139
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#ff7b72>from</span> <span style=color:#ff7b72>enum</span> <span style=color:#ff7b72>import</span> Enum
</span></span><span style=display:flex><span><span style=color:#ff7b72>import</span> <span style=color:#ff7b72>asyncio</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>class</span> <span style=color:#f0883e;font-weight:700>AgentRole</span>(Enum):
</span></span><span style=display:flex><span>    <span style=color:#a5d6ff>&#34;&#34;&#34;Agentè§’è‰²&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>    PLANNER <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>&#34;planner&#34;</span>      <span style=color:#8b949e;font-style:italic># è§„åˆ’è€…</span>
</span></span><span style=display:flex><span>    RESEARCHER <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>&#34;researcher&#34;</span> <span style=color:#8b949e;font-style:italic># ç ”ç©¶è€…</span>
</span></span><span style=display:flex><span>    CODER <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>&#34;coder&#34;</span>          <span style=color:#8b949e;font-style:italic># ç¼–ç è€…</span>
</span></span><span style=display:flex><span>    REVIEWER <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>&#34;reviewer&#34;</span>     <span style=color:#8b949e;font-style:italic># å®¡æŸ¥è€…</span>
</span></span><span style=display:flex><span>    SUMMARIZER <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>&#34;summarizer&#34;</span> <span style=color:#8b949e;font-style:italic># æ€»ç»“è€…</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#d2a8ff;font-weight:700>@dataclass</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>class</span> <span style=color:#f0883e;font-weight:700>Task</span>:
</span></span><span style=display:flex><span>    <span style=color:#a5d6ff>&#34;&#34;&#34;ä»»åŠ¡å®šä¹‰&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>    id: str
</span></span><span style=display:flex><span>    description: str
</span></span><span style=display:flex><span>    requirements: List[str]
</span></span><span style=display:flex><span>    status: str <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>&#34;pending&#34;</span>
</span></span><span style=display:flex><span>    result: Any <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#79c0ff>None</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>class</span> <span style=color:#f0883e;font-weight:700>MultiAgentSystem</span>:
</span></span><span style=display:flex><span>    <span style=color:#a5d6ff>&#34;&#34;&#34;å¤šæ™ºèƒ½ä½“åä½œç³»ç»Ÿ&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>__init__</span>(self):
</span></span><span style=display:flex><span>        self<span style=color:#ff7b72;font-weight:700>.</span>agents: Dict[AgentRole, BaseAgent] <span style=color:#ff7b72;font-weight:700>=</span> {}
</span></span><span style=display:flex><span>        self<span style=color:#ff7b72;font-weight:700>.</span>task_queue: asyncio<span style=color:#ff7b72;font-weight:700>.</span>Queue <span style=color:#ff7b72;font-weight:700>=</span> asyncio<span style=color:#ff7b72;font-weight:700>.</span>Queue()
</span></span><span style=display:flex><span>        self<span style=color:#ff7b72;font-weight:700>.</span>completed_tasks: List[Task] <span style=color:#ff7b72;font-weight:700>=</span> []
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>register_agent</span>(self, role: AgentRole, agent: BaseAgent):
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;&#34;&#34;æ³¨å†ŒAgent&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>        self<span style=color:#ff7b72;font-weight:700>.</span>agents[role] <span style=color:#ff7b72;font-weight:700>=</span> agent
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>async</span> <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>execute_task</span>(self, task: Task) <span style=color:#ff7b72;font-weight:700>-&gt;</span> Task:
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;&#34;&#34;æ‰§è¡Œä»»åŠ¡ï¼ˆå¤šAgentåä½œï¼‰&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        print(<span style=color:#79c0ff>f</span><span style=color:#a5d6ff>&#34;</span><span style=color:#79c0ff>\n</span><span style=color:#a5d6ff>{</span><span style=color:#a5d6ff>&#39;=&#39;</span><span style=color:#ff7b72;font-weight:700>*</span><span style=color:#a5d6ff>50</span><span style=color:#a5d6ff>}</span><span style=color:#a5d6ff>&#34;</span>)
</span></span><span style=display:flex><span>        print(<span style=color:#79c0ff>f</span><span style=color:#a5d6ff>&#34;å¼€å§‹æ‰§è¡Œä»»åŠ¡: </span><span style=color:#a5d6ff>{</span>task<span style=color:#ff7b72;font-weight:700>.</span>description<span style=color:#a5d6ff>}</span><span style=color:#a5d6ff>&#34;</span>)
</span></span><span style=display:flex><span>        print(<span style=color:#79c0ff>f</span><span style=color:#a5d6ff>&#34;</span><span style=color:#a5d6ff>{</span><span style=color:#a5d6ff>&#39;=&#39;</span><span style=color:#ff7b72;font-weight:700>*</span><span style=color:#a5d6ff>50</span><span style=color:#a5d6ff>}</span><span style=color:#79c0ff>\n</span><span style=color:#a5d6ff>&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># 1. è§„åˆ’é˜¶æ®µ</span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>if</span> AgentRole<span style=color:#ff7b72;font-weight:700>.</span>PLANNER <span style=color:#ff7b72;font-weight:700>in</span> self<span style=color:#ff7b72;font-weight:700>.</span>agents:
</span></span><span style=display:flex><span>            print(<span style=color:#a5d6ff>&#34;[é˜¶æ®µ1] è§„åˆ’&#34;</span>)
</span></span><span style=display:flex><span>            planner <span style=color:#ff7b72;font-weight:700>=</span> self<span style=color:#ff7b72;font-weight:700>.</span>agents[AgentRole<span style=color:#ff7b72;font-weight:700>.</span>PLANNER]
</span></span><span style=display:flex><span>            plan <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#ff7b72>await</span> planner<span style=color:#ff7b72;font-weight:700>.</span>run(<span style=color:#79c0ff>f</span><span style=color:#a5d6ff>&#34;&#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>            ä¸ºä»¥ä¸‹ä»»åŠ¡åˆ¶å®šè¯¦ç»†æ‰§è¡Œè®¡åˆ’ï¼š
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>            ä»»åŠ¡æè¿°ï¼š</span><span style=color:#a5d6ff>{</span>task<span style=color:#ff7b72;font-weight:700>.</span>description<span style=color:#a5d6ff>}</span><span style=color:#a5d6ff>
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>            è¦æ±‚ï¼š</span><span style=color:#a5d6ff>{</span><span style=color:#a5d6ff>&#39;, &#39;</span><span style=color:#ff7b72;font-weight:700>.</span>join(task<span style=color:#ff7b72;font-weight:700>.</span>requirements)<span style=color:#a5d6ff>}</span><span style=color:#a5d6ff>
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>            è¯·è¾“å‡ºï¼š
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>            1. ä»»åŠ¡åˆ†è§£
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>            2. æ‰§è¡Œæ­¥éª¤
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>            3. æ‰€éœ€èµ„æº
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>            4. é£é™©è¯„ä¼°
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>            &#34;&#34;&#34;</span>)
</span></span><span style=display:flex><span>            print(<span style=color:#79c0ff>f</span><span style=color:#a5d6ff>&#34;è§„åˆ’ç»“æœï¼š</span><span style=color:#79c0ff>\n</span><span style=color:#a5d6ff>{</span>plan<span style=color:#a5d6ff>}</span><span style=color:#79c0ff>\n</span><span style=color:#a5d6ff>&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># 2. ç ”ç©¶é˜¶æ®µ</span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>if</span> AgentRole<span style=color:#ff7b72;font-weight:700>.</span>RESEARCHER <span style=color:#ff7b72;font-weight:700>in</span> self<span style=color:#ff7b72;font-weight:700>.</span>agents:
</span></span><span style=display:flex><span>            print(<span style=color:#a5d6ff>&#34;[é˜¶æ®µ2] ç ”ç©¶&#34;</span>)
</span></span><span style=display:flex><span>            researcher <span style=color:#ff7b72;font-weight:700>=</span> self<span style=color:#ff7b72;font-weight:700>.</span>agents[AgentRole<span style=color:#ff7b72;font-weight:700>.</span>RESEARCHER]
</span></span><span style=display:flex><span>            research <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#ff7b72>await</span> researcher<span style=color:#ff7b72;font-weight:700>.</span>run(<span style=color:#79c0ff>f</span><span style=color:#a5d6ff>&#34;&#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>            ç ”ç©¶ä»»åŠ¡ç›¸å…³èƒŒæ™¯ä¿¡æ¯ï¼š
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>            </span><span style=color:#a5d6ff>{</span>task<span style=color:#ff7b72;font-weight:700>.</span>description<span style=color:#a5d6ff>}</span><span style=color:#a5d6ff>
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>            è¯·æä¾›ï¼š
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>            1. æŠ€æœ¯èƒŒæ™¯
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>            2. æœ€ä½³å®è·µ
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>            3. å‚è€ƒèµ„æº
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>            &#34;&#34;&#34;</span>)
</span></span><span style=display:flex><span>            print(<span style=color:#79c0ff>f</span><span style=color:#a5d6ff>&#34;ç ”ç©¶ç»“æœï¼š</span><span style=color:#79c0ff>\n</span><span style=color:#a5d6ff>{</span>research<span style=color:#a5d6ff>}</span><span style=color:#79c0ff>\n</span><span style=color:#a5d6ff>&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># 3. æ‰§è¡Œé˜¶æ®µ</span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>if</span> AgentRole<span style=color:#ff7b72;font-weight:700>.</span>CODER <span style=color:#ff7b72;font-weight:700>in</span> self<span style=color:#ff7b72;font-weight:700>.</span>agents:
</span></span><span style=display:flex><span>            print(<span style=color:#a5d6ff>&#34;[é˜¶æ®µ3] æ‰§è¡Œ&#34;</span>)
</span></span><span style=display:flex><span>            coder <span style=color:#ff7b72;font-weight:700>=</span> self<span style=color:#ff7b72;font-weight:700>.</span>agents[AgentRole<span style=color:#ff7b72;font-weight:700>.</span>CODER]
</span></span><span style=display:flex><span>            result <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#ff7b72>await</span> coder<span style=color:#ff7b72;font-weight:700>.</span>run(<span style=color:#79c0ff>f</span><span style=color:#a5d6ff>&#34;&#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>            æ ¹æ®ä»¥ä¸‹ä¿¡æ¯å®ç°ä»»åŠ¡ï¼š
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>            ä»»åŠ¡ï¼š</span><span style=color:#a5d6ff>{</span>task<span style=color:#ff7b72;font-weight:700>.</span>description<span style=color:#a5d6ff>}</span><span style=color:#a5d6ff>
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>            è®¡åˆ’ï¼š</span><span style=color:#a5d6ff>{</span>plan <span style=color:#ff7b72>if</span> AgentRole<span style=color:#ff7b72;font-weight:700>.</span>PLANNER <span style=color:#ff7b72;font-weight:700>in</span> self<span style=color:#ff7b72;font-weight:700>.</span>agents <span style=color:#ff7b72>else</span> <span style=color:#a5d6ff>&#39;N/A&#39;</span><span style=color:#a5d6ff>}</span><span style=color:#a5d6ff>
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>            ç ”ç©¶ï¼š</span><span style=color:#a5d6ff>{</span>research <span style=color:#ff7b72>if</span> AgentRole<span style=color:#ff7b72;font-weight:700>.</span>RESEARCHER <span style=color:#ff7b72;font-weight:700>in</span> self<span style=color:#ff7b72;font-weight:700>.</span>agents <span style=color:#ff7b72>else</span> <span style=color:#a5d6ff>&#39;N/A&#39;</span><span style=color:#a5d6ff>}</span><span style=color:#a5d6ff>
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>            è¯·æä¾›å®Œæ•´çš„å®ç°ã€‚
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>            &#34;&#34;&#34;</span>)
</span></span><span style=display:flex><span>            task<span style=color:#ff7b72;font-weight:700>.</span>result <span style=color:#ff7b72;font-weight:700>=</span> result
</span></span><span style=display:flex><span>            print(<span style=color:#79c0ff>f</span><span style=color:#a5d6ff>&#34;æ‰§è¡Œç»“æœï¼š</span><span style=color:#79c0ff>\n</span><span style=color:#a5d6ff>{</span>result<span style=color:#a5d6ff>}</span><span style=color:#79c0ff>\n</span><span style=color:#a5d6ff>&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># 4. å®¡æŸ¥é˜¶æ®µ</span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>if</span> AgentRole<span style=color:#ff7b72;font-weight:700>.</span>REVIEWER <span style=color:#ff7b72;font-weight:700>in</span> self<span style=color:#ff7b72;font-weight:700>.</span>agents:
</span></span><span style=display:flex><span>            print(<span style=color:#a5d6ff>&#34;[é˜¶æ®µ4] å®¡æŸ¥&#34;</span>)
</span></span><span style=display:flex><span>            reviewer <span style=color:#ff7b72;font-weight:700>=</span> self<span style=color:#ff7b72;font-weight:700>.</span>agents[AgentRole<span style=color:#ff7b72;font-weight:700>.</span>REVIEWER]
</span></span><span style=display:flex><span>            review <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#ff7b72>await</span> reviewer<span style=color:#ff7b72;font-weight:700>.</span>run(<span style=color:#79c0ff>f</span><span style=color:#a5d6ff>&#34;&#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>            å®¡æŸ¥ä»¥ä¸‹å®ç°ï¼š
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>            ä»»åŠ¡ï¼š</span><span style=color:#a5d6ff>{</span>task<span style=color:#ff7b72;font-weight:700>.</span>description<span style=color:#a5d6ff>}</span><span style=color:#a5d6ff>
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>            å®ç°ï¼š</span><span style=color:#a5d6ff>{</span>result<span style=color:#a5d6ff>}</span><span style=color:#a5d6ff>
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>            è¯·è¯„ä¼°ï¼š
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>            1. æ­£ç¡®æ€§
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>            2. æ€§èƒ½
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>            3. å®‰å…¨æ€§
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>            4. å¯ç»´æŠ¤æ€§
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>            &#34;&#34;&#34;</span>)
</span></span><span style=display:flex><span>            print(<span style=color:#79c0ff>f</span><span style=color:#a5d6ff>&#34;å®¡æŸ¥ç»“æœï¼š</span><span style=color:#79c0ff>\n</span><span style=color:#a5d6ff>{</span>review<span style=color:#a5d6ff>}</span><span style=color:#79c0ff>\n</span><span style=color:#a5d6ff>&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># 5. æ€»ç»“é˜¶æ®µ</span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>if</span> AgentRole<span style=color:#ff7b72;font-weight:700>.</span>SUMMARIZER <span style=color:#ff7b72;font-weight:700>in</span> self<span style=color:#ff7b72;font-weight:700>.</span>agents:
</span></span><span style=display:flex><span>            print(<span style=color:#a5d6ff>&#34;[é˜¶æ®µ5] æ€»ç»“&#34;</span>)
</span></span><span style=display:flex><span>            summarizer <span style=color:#ff7b72;font-weight:700>=</span> self<span style=color:#ff7b72;font-weight:700>.</span>agents[AgentRole<span style=color:#ff7b72;font-weight:700>.</span>SUMMARIZER]
</span></span><span style=display:flex><span>            summary <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#ff7b72>await</span> summarizer<span style=color:#ff7b72;font-weight:700>.</span>run(<span style=color:#79c0ff>f</span><span style=color:#a5d6ff>&#34;&#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>            æ€»ç»“æ•´ä¸ªä»»åŠ¡æ‰§è¡Œè¿‡ç¨‹ï¼š
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>            ä»»åŠ¡ï¼š</span><span style=color:#a5d6ff>{</span>task<span style=color:#ff7b72;font-weight:700>.</span>description<span style=color:#a5d6ff>}</span><span style=color:#a5d6ff>
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>            ç»“æœï¼š</span><span style=color:#a5d6ff>{</span>result<span style=color:#a5d6ff>}</span><span style=color:#a5d6ff>
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>            å®¡æŸ¥ï¼š</span><span style=color:#a5d6ff>{</span>review<span style=color:#a5d6ff>}</span><span style=color:#a5d6ff>
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>            è¯·æä¾›ï¼š
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>            1. æ‰§è¡Œæ€»ç»“
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>            2. å…³é”®æ”¶è·
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>            3. æ”¹è¿›å»ºè®®
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>            &#34;&#34;&#34;</span>)
</span></span><span style=display:flex><span>            print(<span style=color:#79c0ff>f</span><span style=color:#a5d6ff>&#34;æ€»ç»“ï¼š</span><span style=color:#79c0ff>\n</span><span style=color:#a5d6ff>{</span>summary<span style=color:#a5d6ff>}</span><span style=color:#79c0ff>\n</span><span style=color:#a5d6ff>&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        task<span style=color:#ff7b72;font-weight:700>.</span>status <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>&#34;completed&#34;</span>
</span></span><span style=display:flex><span>        self<span style=color:#ff7b72;font-weight:700>.</span>completed_tasks<span style=color:#ff7b72;font-weight:700>.</span>append(task)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        print(<span style=color:#79c0ff>f</span><span style=color:#a5d6ff>&#34;</span><span style=color:#a5d6ff>{</span><span style=color:#a5d6ff>&#39;=&#39;</span><span style=color:#ff7b72;font-weight:700>*</span><span style=color:#a5d6ff>50</span><span style=color:#a5d6ff>}</span><span style=color:#a5d6ff>&#34;</span>)
</span></span><span style=display:flex><span>        print(<span style=color:#79c0ff>f</span><span style=color:#a5d6ff>&#34;ä»»åŠ¡å®Œæˆï¼&#34;</span>)
</span></span><span style=display:flex><span>        print(<span style=color:#79c0ff>f</span><span style=color:#a5d6ff>&#34;</span><span style=color:#a5d6ff>{</span><span style=color:#a5d6ff>&#39;=&#39;</span><span style=color:#ff7b72;font-weight:700>*</span><span style=color:#a5d6ff>50</span><span style=color:#a5d6ff>}</span><span style=color:#79c0ff>\n</span><span style=color:#a5d6ff>&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>return</span> task
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>async</span> <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>run_workflow</span>(self, tasks: List[Task]):
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;&#34;&#34;è¿è¡Œå·¥ä½œæµ&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># å¹¶è¡Œæ‰§è¡Œç‹¬ç«‹ä»»åŠ¡</span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>await</span> asyncio<span style=color:#ff7b72;font-weight:700>.</span>gather(<span style=color:#ff7b72;font-weight:700>*</span>[
</span></span><span style=display:flex><span>            self<span style=color:#ff7b72;font-weight:700>.</span>execute_task(task)
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>for</span> task <span style=color:#ff7b72;font-weight:700>in</span> tasks
</span></span><span style=display:flex><span>        ])
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>return</span> self<span style=color:#ff7b72;font-weight:700>.</span>completed_tasks
</span></span></code></pre></td></tr></table></div></div><h2 id=å·¥å…·è°ƒç”¨æ¨¡å¼>å·¥å…·è°ƒç”¨æ¨¡å¼<a hidden class=anchor aria-hidden=true href=#å·¥å…·è°ƒç”¨æ¨¡å¼>#</a></h2><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 56
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 57
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 58
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 59
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 60
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 61
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 62
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 63
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 64
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 65
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 66
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 67
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 68
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 69
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 70
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 71
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 72
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 73
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 74
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 75
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 76
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 77
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 78
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 79
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 80
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 81
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 82
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 83
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 84
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 85
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 86
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 87
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 88
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 89
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 90
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 91
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 92
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 93
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 94
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 95
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 96
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 97
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 98
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 99
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">100
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">101
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">102
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">103
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">104
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">105
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">106
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">107
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">108
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">109
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">110
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">111
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">112
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">113
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">114
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">115
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">116
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">117
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">118
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">119
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">120
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">121
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">122
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#ff7b72>from</span> <span style=color:#ff7b72>typing</span> <span style=color:#ff7b72>import</span> get_type_hints
</span></span><span style=display:flex><span><span style=color:#ff7b72>import</span> <span style=color:#ff7b72>inspect</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>class</span> <span style=color:#f0883e;font-weight:700>ToolRegistry</span>:
</span></span><span style=display:flex><span>    <span style=color:#a5d6ff>&#34;&#34;&#34;å·¥å…·æ³¨å†Œè¡¨&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>__init__</span>(self):
</span></span><span style=display:flex><span>        self<span style=color:#ff7b72;font-weight:700>.</span>tools: Dict[str, Tool] <span style=color:#ff7b72;font-weight:700>=</span> {}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>register</span>(self, tool: Tool):
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;&#34;&#34;æ³¨å†Œå·¥å…·&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>        self<span style=color:#ff7b72;font-weight:700>.</span>tools[tool<span style=color:#ff7b72;font-weight:700>.</span>name] <span style=color:#ff7b72;font-weight:700>=</span> tool
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>get_tool_schema</span>(self) <span style=color:#ff7b72;font-weight:700>-&gt;</span> List[dict]:
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;&#34;&#34;è·å–å·¥å…·Schemaï¼ˆç”¨äºOpenAI Function Callingï¼‰&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        schemas <span style=color:#ff7b72;font-weight:700>=</span> []
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>for</span> tool <span style=color:#ff7b72;font-weight:700>in</span> self<span style=color:#ff7b72;font-weight:700>.</span>tools<span style=color:#ff7b72;font-weight:700>.</span>values():
</span></span><span style=display:flex><span>            schema <span style=color:#ff7b72;font-weight:700>=</span> {
</span></span><span style=display:flex><span>                <span style=color:#a5d6ff>&#34;type&#34;</span>: <span style=color:#a5d6ff>&#34;function&#34;</span>,
</span></span><span style=display:flex><span>                <span style=color:#a5d6ff>&#34;function&#34;</span>: {
</span></span><span style=display:flex><span>                    <span style=color:#a5d6ff>&#34;name&#34;</span>: tool<span style=color:#ff7b72;font-weight:700>.</span>name,
</span></span><span style=display:flex><span>                    <span style=color:#a5d6ff>&#34;description&#34;</span>: tool<span style=color:#ff7b72;font-weight:700>.</span>description,
</span></span><span style=display:flex><span>                    <span style=color:#a5d6ff>&#34;parameters&#34;</span>: self<span style=color:#ff7b72;font-weight:700>.</span>_extract_parameters(tool)
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>            schemas<span style=color:#ff7b72;font-weight:700>.</span>append(schema)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>return</span> schemas
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>_extract_parameters</span>(self, tool: Tool) <span style=color:#ff7b72;font-weight:700>-&gt;</span> dict:
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;&#34;&#34;ä»å·¥å…·ä¸­æå–å‚æ•°Schema&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># è·å–executeæ–¹æ³•çš„ç­¾å</span>
</span></span><span style=display:flex><span>        sig <span style=color:#ff7b72;font-weight:700>=</span> inspect<span style=color:#ff7b72;font-weight:700>.</span>signature(tool<span style=color:#ff7b72;font-weight:700>.</span>execute)
</span></span><span style=display:flex><span>        parameters <span style=color:#ff7b72;font-weight:700>=</span> {}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        required <span style=color:#ff7b72;font-weight:700>=</span> []
</span></span><span style=display:flex><span>        properties <span style=color:#ff7b72;font-weight:700>=</span> {}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>for</span> name, param <span style=color:#ff7b72;font-weight:700>in</span> sig<span style=color:#ff7b72;font-weight:700>.</span>parameters<span style=color:#ff7b72;font-weight:700>.</span>items():
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>if</span> name <span style=color:#ff7b72;font-weight:700>==</span> <span style=color:#a5d6ff>&#39;self&#39;</span>:
</span></span><span style=display:flex><span>                <span style=color:#ff7b72>continue</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            param_type <span style=color:#ff7b72;font-weight:700>=</span> param<span style=color:#ff7b72;font-weight:700>.</span>annotation
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#8b949e;font-style:italic># ç±»å‹æ˜ å°„</span>
</span></span><span style=display:flex><span>            type_map <span style=color:#ff7b72;font-weight:700>=</span> {
</span></span><span style=display:flex><span>                str: <span style=color:#a5d6ff>&#34;string&#34;</span>,
</span></span><span style=display:flex><span>                int: <span style=color:#a5d6ff>&#34;integer&#34;</span>,
</span></span><span style=display:flex><span>                float: <span style=color:#a5d6ff>&#34;number&#34;</span>,
</span></span><span style=display:flex><span>                bool: <span style=color:#a5d6ff>&#34;boolean&#34;</span>,
</span></span><span style=display:flex><span>                list: <span style=color:#a5d6ff>&#34;array&#34;</span>,
</span></span><span style=display:flex><span>                dict: <span style=color:#a5d6ff>&#34;object&#34;</span>
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            json_type <span style=color:#ff7b72;font-weight:700>=</span> type_map<span style=color:#ff7b72;font-weight:700>.</span>get(param_type, <span style=color:#a5d6ff>&#34;string&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            property_def <span style=color:#ff7b72;font-weight:700>=</span> {<span style=color:#a5d6ff>&#34;type&#34;</span>: json_type}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>if</span> param<span style=color:#ff7b72;font-weight:700>.</span>default <span style=color:#ff7b72;font-weight:700>==</span> inspect<span style=color:#ff7b72;font-weight:700>.</span>Parameter<span style=color:#ff7b72;font-weight:700>.</span>empty:
</span></span><span style=display:flex><span>                required<span style=color:#ff7b72;font-weight:700>.</span>append(name)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            properties[name] <span style=color:#ff7b72;font-weight:700>=</span> property_def
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>return</span> {
</span></span><span style=display:flex><span>            <span style=color:#a5d6ff>&#34;type&#34;</span>: <span style=color:#a5d6ff>&#34;object&#34;</span>,
</span></span><span style=display:flex><span>            <span style=color:#a5d6ff>&#34;properties&#34;</span>: properties,
</span></span><span style=display:flex><span>            <span style=color:#a5d6ff>&#34;required&#34;</span>: required
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>class</span> <span style=color:#f0883e;font-weight:700>FunctionCallingAgent</span>(BaseAgent):
</span></span><span style=display:flex><span>    <span style=color:#a5d6ff>&#34;&#34;&#34;å‡½æ•°è°ƒç”¨Agent&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>__init__</span>(self, config: AgentConfig, registry: ToolRegistry):
</span></span><span style=display:flex><span>        super()<span style=color:#ff7b72;font-weight:700>.</span><span style=color:#d2a8ff;font-weight:700>__init__</span>(config)
</span></span><span style=display:flex><span>        self<span style=color:#ff7b72;font-weight:700>.</span>registry <span style=color:#ff7b72;font-weight:700>=</span> registry
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>async</span> <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>think</span>(self, input: str) <span style=color:#ff7b72;font-weight:700>-&gt;</span> str:
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;&#34;&#34;ä½¿ç”¨å‡½æ•°è°ƒç”¨æ€è€ƒ&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        messages <span style=color:#ff7b72;font-weight:700>=</span> [
</span></span><span style=display:flex><span>            Message(role<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>&#34;system&#34;</span>, content<span style=color:#ff7b72;font-weight:700>=</span>self<span style=color:#ff7b72;font-weight:700>.</span>config<span style=color:#ff7b72;font-weight:700>.</span>system_prompt),
</span></span><span style=display:flex><span>            Message(role<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>&#34;user&#34;</span>, content<span style=color:#ff7b72;font-weight:700>=</span>input)
</span></span><span style=display:flex><span>        ]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>while</span> <span style=color:#79c0ff>True</span>:
</span></span><span style=display:flex><span>            <span style=color:#8b949e;font-style:italic># è°ƒç”¨LLMï¼ˆå¸¦å‡½æ•°è°ƒç”¨ï¼‰</span>
</span></span><span style=display:flex><span>            response <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#ff7b72>await</span> self<span style=color:#ff7b72;font-weight:700>.</span>_call_llm_with_tools(
</span></span><span style=display:flex><span>                messages,
</span></span><span style=display:flex><span>                tools<span style=color:#ff7b72;font-weight:700>=</span>self<span style=color:#ff7b72;font-weight:700>.</span>registry<span style=color:#ff7b72;font-weight:700>.</span>get_tool_schema()
</span></span><span style=display:flex><span>            )
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#8b949e;font-style:italic># å¤„ç†å“åº”</span>
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>if</span> response<span style=color:#ff7b72;font-weight:700>.</span>get(<span style=color:#a5d6ff>&#34;tool_calls&#34;</span>):
</span></span><span style=display:flex><span>                messages<span style=color:#ff7b72;font-weight:700>.</span>append(Message(
</span></span><span style=display:flex><span>                    role<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>&#34;assistant&#34;</span>,
</span></span><span style=display:flex><span>                    content<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>&#34;&#34;</span>,
</span></span><span style=display:flex><span>                    tool_calls<span style=color:#ff7b72;font-weight:700>=</span>response[<span style=color:#a5d6ff>&#34;tool_calls&#34;</span>]
</span></span><span style=display:flex><span>                ))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>                <span style=color:#8b949e;font-style:italic># æ‰§è¡Œå·¥å…·è°ƒç”¨</span>
</span></span><span style=display:flex><span>                <span style=color:#ff7b72>for</span> tool_call <span style=color:#ff7b72;font-weight:700>in</span> response[<span style=color:#a5d6ff>&#34;tool_calls&#34;</span>]:
</span></span><span style=display:flex><span>                    tool_name <span style=color:#ff7b72;font-weight:700>=</span> tool_call[<span style=color:#a5d6ff>&#34;function&#34;</span>][<span style=color:#a5d6ff>&#34;name&#34;</span>]
</span></span><span style=display:flex><span>                    tool_args <span style=color:#ff7b72;font-weight:700>=</span> json<span style=color:#ff7b72;font-weight:700>.</span>loads(tool_call[<span style=color:#a5d6ff>&#34;function&#34;</span>][<span style=color:#a5d6ff>&#34;arguments&#34;</span>])
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>                    <span style=color:#ff7b72>if</span> tool_name <span style=color:#ff7b72;font-weight:700>in</span> self<span style=color:#ff7b72;font-weight:700>.</span>registry<span style=color:#ff7b72;font-weight:700>.</span>tools:
</span></span><span style=display:flex><span>                        result <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#ff7b72>await</span> self<span style=color:#ff7b72;font-weight:700>.</span>registry<span style=color:#ff7b72;font-weight:700>.</span>tools[tool_name]<span style=color:#ff7b72;font-weight:700>.</span>execute(<span style=color:#ff7b72;font-weight:700>**</span>tool_args)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>                        messages<span style=color:#ff7b72;font-weight:700>.</span>append(Message(
</span></span><span style=display:flex><span>                            role<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>&#34;tool&#34;</span>,
</span></span><span style=display:flex><span>                            content<span style=color:#ff7b72;font-weight:700>=</span>str(result),
</span></span><span style=display:flex><span>                            tool_call_id<span style=color:#ff7b72;font-weight:700>=</span>tool_call[<span style=color:#a5d6ff>&#34;id&#34;</span>]
</span></span><span style=display:flex><span>                        ))
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>else</span>:
</span></span><span style=display:flex><span>                <span style=color:#8b949e;font-style:italic># æœ€ç»ˆå“åº”</span>
</span></span><span style=display:flex><span>                <span style=color:#ff7b72>return</span> response<span style=color:#ff7b72;font-weight:700>.</span>get(<span style=color:#a5d6ff>&#34;content&#34;</span>, <span style=color:#a5d6ff>&#34;&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>async</span> <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>_call_llm_with_tools</span>(self, messages: List[Message], tools: List[dict]) <span style=color:#ff7b72;font-weight:700>-&gt;</span> dict:
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;&#34;&#34;è°ƒç”¨LLMï¼ˆå¸¦å·¥å…·ï¼‰&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># é›†æˆå®é™…çš„LLM API</span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>pass</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=è®°å¿†ç³»ç»Ÿ>è®°å¿†ç³»ç»Ÿ<a hidden class=anchor aria-hidden=true href=#è®°å¿†ç³»ç»Ÿ>#</a></h2><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 56
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 57
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 58
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 59
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 60
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 61
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 62
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 63
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 64
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 65
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 66
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 67
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 68
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 69
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 70
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 71
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 72
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 73
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 74
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 75
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 76
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 77
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 78
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 79
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 80
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 81
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 82
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 83
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 84
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 85
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 86
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 87
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 88
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 89
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 90
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 91
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 92
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 93
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 94
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 95
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 96
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 97
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 98
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 99
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">100
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">101
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">102
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">103
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">104
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">105
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">106
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">107
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">108
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">109
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">110
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#ff7b72>from</span> <span style=color:#ff7b72>datetime</span> <span style=color:#ff7b72>import</span> datetime
</span></span><span style=display:flex><span><span style=color:#ff7b72>from</span> <span style=color:#ff7b72>typing</span> <span style=color:#ff7b72>import</span> Optional
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>class</span> <span style=color:#f0883e;font-weight:700>Memory</span>:
</span></span><span style=display:flex><span>    <span style=color:#a5d6ff>&#34;&#34;&#34;è®°å¿†æŠ½è±¡&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>__init__</span>(self, content: str, importance: float <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>0.5</span>):
</span></span><span style=display:flex><span>        self<span style=color:#ff7b72;font-weight:700>.</span>content <span style=color:#ff7b72;font-weight:700>=</span> content
</span></span><span style=display:flex><span>        self<span style=color:#ff7b72;font-weight:700>.</span>importance <span style=color:#ff7b72;font-weight:700>=</span> importance  <span style=color:#8b949e;font-style:italic># 0-1</span>
</span></span><span style=display:flex><span>        self<span style=color:#ff7b72;font-weight:700>.</span>timestamp <span style=color:#ff7b72;font-weight:700>=</span> datetime<span style=color:#ff7b72;font-weight:700>.</span>now()
</span></span><span style=display:flex><span>        self<span style=color:#ff7b72;font-weight:700>.</span>access_count <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>0</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>class</span> <span style=color:#f0883e;font-weight:700>MemorySystem</span>:
</span></span><span style=display:flex><span>    <span style=color:#a5d6ff>&#34;&#34;&#34;Agentè®°å¿†ç³»ç»Ÿ&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>__init__</span>(self, max_short_term: int <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>100</span>, max_long_term: int <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>1000</span>):
</span></span><span style=display:flex><span>        self<span style=color:#ff7b72;font-weight:700>.</span>short_term: List[Memory] <span style=color:#ff7b72;font-weight:700>=</span> []  <span style=color:#8b949e;font-style:italic># çŸ­æœŸè®°å¿†</span>
</span></span><span style=display:flex><span>        self<span style=color:#ff7b72;font-weight:700>.</span>long_term: List[Memory] <span style=color:#ff7b72;font-weight:700>=</span> []   <span style=color:#8b949e;font-style:italic># é•¿æœŸè®°å¿†</span>
</span></span><span style=display:flex><span>        self<span style=color:#ff7b72;font-weight:700>.</span>max_short_term <span style=color:#ff7b72;font-weight:700>=</span> max_short_term
</span></span><span style=display:flex><span>        self<span style=color:#ff7b72;font-weight:700>.</span>max_long_term <span style=color:#ff7b72;font-weight:700>=</span> max_long_term
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>async</span> <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>add</span>(self, memory: Memory, importance: Optional[float] <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#79c0ff>None</span>):
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;&#34;&#34;æ·»åŠ è®°å¿†&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>if</span> importance <span style=color:#ff7b72;font-weight:700>is</span> <span style=color:#ff7b72;font-weight:700>not</span> <span style=color:#79c0ff>None</span>:
</span></span><span style=display:flex><span>            memory<span style=color:#ff7b72;font-weight:700>.</span>importance <span style=color:#ff7b72;font-weight:700>=</span> importance
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># æ ¹æ®é‡è¦æ€§å†³å®šå­˜å‚¨ä½ç½®</span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>if</span> memory<span style=color:#ff7b72;font-weight:700>.</span>importance <span style=color:#ff7b72;font-weight:700>&gt;</span> <span style=color:#a5d6ff>0.7</span>:
</span></span><span style=display:flex><span>            self<span style=color:#ff7b72;font-weight:700>.</span>long_term<span style=color:#ff7b72;font-weight:700>.</span>append(memory)
</span></span><span style=display:flex><span>            <span style=color:#8b949e;font-style:italic># é•¿æœŸè®°å¿†æ’åºï¼ˆæŒ‰é‡è¦æ€§ï¼‰</span>
</span></span><span style=display:flex><span>            self<span style=color:#ff7b72;font-weight:700>.</span>long_term<span style=color:#ff7b72;font-weight:700>.</span>sort(key<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#ff7b72>lambda</span> m: m<span style=color:#ff7b72;font-weight:700>.</span>importance, reverse<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#79c0ff>True</span>)
</span></span><span style=display:flex><span>            <span style=color:#8b949e;font-style:italic># ä¿æŒå¤§å°é™åˆ¶</span>
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>if</span> len(self<span style=color:#ff7b72;font-weight:700>.</span>long_term) <span style=color:#ff7b72;font-weight:700>&gt;</span> self<span style=color:#ff7b72;font-weight:700>.</span>max_long_term:
</span></span><span style=display:flex><span>                self<span style=color:#ff7b72;font-weight:700>.</span>long_term <span style=color:#ff7b72;font-weight:700>=</span> self<span style=color:#ff7b72;font-weight:700>.</span>long_term[:self<span style=color:#ff7b72;font-weight:700>.</span>max_long_term]
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>else</span>:
</span></span><span style=display:flex><span>            self<span style=color:#ff7b72;font-weight:700>.</span>short_term<span style=color:#ff7b72;font-weight:700>.</span>append(memory)
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>if</span> len(self<span style=color:#ff7b72;font-weight:700>.</span>short_term) <span style=color:#ff7b72;font-weight:700>&gt;</span> self<span style=color:#ff7b72;font-weight:700>.</span>max_short_term:
</span></span><span style=display:flex><span>                self<span style=color:#ff7b72;font-weight:700>.</span>short_term<span style=color:#ff7b72;font-weight:700>.</span>pop(<span style=color:#a5d6ff>0</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>async</span> <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>retrieve</span>(self, query: str, top_k: int <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>5</span>) <span style=color:#ff7b72;font-weight:700>-&gt;</span> List[Memory]:
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;&#34;&#34;æ£€ç´¢ç›¸å…³è®°å¿†&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># åˆå¹¶æ‰€æœ‰è®°å¿†</span>
</span></span><span style=display:flex><span>        all_memories <span style=color:#ff7b72;font-weight:700>=</span> self<span style=color:#ff7b72;font-weight:700>.</span>short_term <span style=color:#ff7b72;font-weight:700>+</span> self<span style=color:#ff7b72;font-weight:700>.</span>long_term
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># ç®€å•çš„å…³é”®è¯åŒ¹é…ï¼ˆå®é™…åº”ä½¿ç”¨å‘é‡ç›¸ä¼¼åº¦ï¼‰</span>
</span></span><span style=display:flex><span>        relevant <span style=color:#ff7b72;font-weight:700>=</span> [
</span></span><span style=display:flex><span>            memory <span style=color:#ff7b72>for</span> memory <span style=color:#ff7b72;font-weight:700>in</span> all_memories
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>if</span> any(word <span style=color:#ff7b72;font-weight:700>in</span> memory<span style=color:#ff7b72;font-weight:700>.</span>content<span style=color:#ff7b72;font-weight:700>.</span>lower() <span style=color:#ff7b72>for</span> word <span style=color:#ff7b72;font-weight:700>in</span> query<span style=color:#ff7b72;font-weight:700>.</span>lower()<span style=color:#ff7b72;font-weight:700>.</span>split())
</span></span><span style=display:flex><span>        ]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># æŒ‰é‡è¦æ€§å’Œæœ€è¿‘è®¿é—®æ’åº</span>
</span></span><span style=display:flex><span>        relevant<span style=color:#ff7b72;font-weight:700>.</span>sort(
</span></span><span style=display:flex><span>            key<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#ff7b72>lambda</span> m: (m<span style=color:#ff7b72;font-weight:700>.</span>importance, m<span style=color:#ff7b72;font-weight:700>.</span>access_count),
</span></span><span style=display:flex><span>            reverse<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#79c0ff>True</span>
</span></span><span style=display:flex><span>        )
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>return</span> relevant[:top_k]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>summarize</span>(self) <span style=color:#ff7b72;font-weight:700>-&gt;</span> str:
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;&#34;&#34;æ€»ç»“è®°å¿†&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        summary_parts <span style=color:#ff7b72;font-weight:700>=</span> []
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>if</span> self<span style=color:#ff7b72;font-weight:700>.</span>short_term:
</span></span><span style=display:flex><span>            summary_parts<span style=color:#ff7b72;font-weight:700>.</span>append(<span style=color:#79c0ff>f</span><span style=color:#a5d6ff>&#34;çŸ­æœŸè®°å¿†: </span><span style=color:#a5d6ff>{</span>len(self<span style=color:#ff7b72;font-weight:700>.</span>short_term)<span style=color:#a5d6ff>}</span><span style=color:#a5d6ff>æ¡&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>if</span> self<span style=color:#ff7b72;font-weight:700>.</span>long_term:
</span></span><span style=display:flex><span>            important <span style=color:#ff7b72;font-weight:700>=</span> [m <span style=color:#ff7b72>for</span> m <span style=color:#ff7b72;font-weight:700>in</span> self<span style=color:#ff7b72;font-weight:700>.</span>long_term <span style=color:#ff7b72>if</span> m<span style=color:#ff7b72;font-weight:700>.</span>importance <span style=color:#ff7b72;font-weight:700>&gt;</span> <span style=color:#a5d6ff>0.8</span>]
</span></span><span style=display:flex><span>            summary_parts<span style=color:#ff7b72;font-weight:700>.</span>append(<span style=color:#79c0ff>f</span><span style=color:#a5d6ff>&#34;é‡è¦è®°å¿†: </span><span style=color:#a5d6ff>{</span>len(important)<span style=color:#a5d6ff>}</span><span style=color:#a5d6ff>æ¡&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>return</span> <span style=color:#a5d6ff>&#34;; &#34;</span><span style=color:#ff7b72;font-weight:700>.</span>join(summary_parts)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>class</span> <span style=color:#f0883e;font-weight:700>MemoryAgent</span>(BaseAgent):
</span></span><span style=display:flex><span>    <span style=color:#a5d6ff>&#34;&#34;&#34;å¸¦è®°å¿†çš„Agent&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>__init__</span>(self, config: AgentConfig, memory: MemorySystem):
</span></span><span style=display:flex><span>        super()<span style=color:#ff7b72;font-weight:700>.</span><span style=color:#d2a8ff;font-weight:700>__init__</span>(config)
</span></span><span style=display:flex><span>        self<span style=color:#ff7b72;font-weight:700>.</span>memory <span style=color:#ff7b72;font-weight:700>=</span> memory
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>async</span> <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>think</span>(self, input: str) <span style=color:#ff7b72;font-weight:700>-&gt;</span> str:
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;&#34;&#34;å¸¦è®°å¿†çš„æ€è€ƒ&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># æ£€ç´¢ç›¸å…³è®°å¿†</span>
</span></span><span style=display:flex><span>        relevant_memories <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#ff7b72>await</span> self<span style=color:#ff7b72;font-weight:700>.</span>memory<span style=color:#ff7b72;font-weight:700>.</span>retrieve(input)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># æ„å»ºä¸Šä¸‹æ–‡</span>
</span></span><span style=display:flex><span>        context <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#79c0ff>f</span><span style=color:#a5d6ff>&#34;&#34;&#34;ç›¸å…³è®°å¿†ï¼š
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff></span><span style=color:#a5d6ff>{</span>chr(<span style=color:#a5d6ff>10</span>)<span style=color:#ff7b72;font-weight:700>.</span>join(<span style=color:#79c0ff>f</span><span style=color:#a5d6ff>&#34;- </span><span style=color:#a5d6ff>{</span>m<span style=color:#ff7b72;font-weight:700>.</span>content<span style=color:#a5d6ff>}</span><span style=color:#a5d6ff>&#34;</span> <span style=color:#ff7b72>for</span> m <span style=color:#ff7b72;font-weight:700>in</span> relevant_memories)<span style=color:#a5d6ff>}</span><span style=color:#a5d6ff>
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>å½“å‰é—®é¢˜ï¼š</span><span style=color:#a5d6ff>{</span>input<span style=color:#a5d6ff>}</span><span style=color:#a5d6ff>
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># ç”Ÿæˆå“åº”</span>
</span></span><span style=display:flex><span>        response <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#ff7b72>await</span> self<span style=color:#ff7b72;font-weight:700>.</span>_call_llm([
</span></span><span style=display:flex><span>            Message(role<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>&#34;user&#34;</span>, content<span style=color:#ff7b72;font-weight:700>=</span>context)
</span></span><span style=display:flex><span>        ])
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># å­˜å‚¨æ–°è®°å¿†</span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>await</span> self<span style=color:#ff7b72;font-weight:700>.</span>memory<span style=color:#ff7b72;font-weight:700>.</span>add(Memory(
</span></span><span style=display:flex><span>            content<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#79c0ff>f</span><span style=color:#a5d6ff>&#34;Q: </span><span style=color:#a5d6ff>{</span>input<span style=color:#a5d6ff>}</span><span style=color:#79c0ff>\n</span><span style=color:#a5d6ff>A: </span><span style=color:#a5d6ff>{</span>response<span style=color:#a5d6ff>}</span><span style=color:#a5d6ff>&#34;</span>,
</span></span><span style=display:flex><span>            importance<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>0.5</span>
</span></span><span style=display:flex><span>        ))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>return</span> response
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>async</span> <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>_call_llm</span>(self, messages: List[Message]) <span style=color:#ff7b72;font-weight:700>-&gt;</span> str:
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;&#34;&#34;è°ƒç”¨LLM&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>pass</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=agentè¯„ä¼°>Agentè¯„ä¼°<a hidden class=anchor aria-hidden=true href=#agentè¯„ä¼°>#</a></h2><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">56
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">57
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">58
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">59
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">60
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">61
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">62
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">63
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">64
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">65
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">66
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">67
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">68
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">69
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">70
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">71
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">72
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">73
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">74
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">75
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">76
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">77
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">78
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">79
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">80
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">81
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">82
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">83
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#ff7b72>class</span> <span style=color:#f0883e;font-weight:700>AgentEvaluator</span>:
</span></span><span style=display:flex><span>    <span style=color:#a5d6ff>&#34;&#34;&#34;Agentè¯„ä¼°å™¨&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>async</span> <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>evaluate</span>(
</span></span><span style=display:flex><span>        self,
</span></span><span style=display:flex><span>        agent: BaseAgent,
</span></span><span style=display:flex><span>        test_cases: List[dict]
</span></span><span style=display:flex><span>    ) <span style=color:#ff7b72;font-weight:700>-&gt;</span> dict:
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;&#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>        test_cases: [
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>            {
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>                &#34;input&#34;: &#34;é—®é¢˜&#34;,
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>                &#34;expected_output&#34;: &#34;é¢„æœŸè¾“å‡º&#34;,
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>                &#34;criteria&#34;: [&#34;å‡†ç¡®æ€§&#34;, &#34;å®Œæ•´æ€§&#34;, &#34;ç›¸å…³æ€§&#34;]
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>            }
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>        ]
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>        &#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        results <span style=color:#ff7b72;font-weight:700>=</span> {
</span></span><span style=display:flex><span>            <span style=color:#a5d6ff>&#34;total&#34;</span>: len(test_cases),
</span></span><span style=display:flex><span>            <span style=color:#a5d6ff>&#34;success&#34;</span>: <span style=color:#a5d6ff>0</span>,
</span></span><span style=display:flex><span>            <span style=color:#a5d6ff>&#34;failed&#34;</span>: <span style=color:#a5d6ff>0</span>,
</span></span><span style=display:flex><span>            <span style=color:#a5d6ff>&#34;avg_score&#34;</span>: <span style=color:#a5d6ff>0</span>,
</span></span><span style=display:flex><span>            <span style=color:#a5d6ff>&#34;details&#34;</span>: []
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        total_score <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>0</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>for</span> <span style=color:#ff7b72>case</span> <span style=color:#ff7b72;font-weight:700>in</span> test_cases:
</span></span><span style=display:flex><span>            <span style=color:#8b949e;font-style:italic># æ‰§è¡Œ</span>
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>try</span>:
</span></span><span style=display:flex><span>                output <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#ff7b72>await</span> agent<span style=color:#ff7b72;font-weight:700>.</span>run(<span style=color:#ff7b72>case</span>[<span style=color:#a5d6ff>&#34;input&#34;</span>])
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>                <span style=color:#8b949e;font-style:italic># è¯„ä¼°</span>
</span></span><span style=display:flex><span>                score <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#ff7b72>await</span> self<span style=color:#ff7b72;font-weight:700>.</span>_score_output(
</span></span><span style=display:flex><span>                    output,
</span></span><span style=display:flex><span>                    <span style=color:#ff7b72>case</span>[<span style=color:#a5d6ff>&#34;expected_output&#34;</span>],
</span></span><span style=display:flex><span>                    <span style=color:#ff7b72>case</span><span style=color:#ff7b72;font-weight:700>.</span>get(<span style=color:#a5d6ff>&#34;criteria&#34;</span>, [])
</span></span><span style=display:flex><span>                )
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>                detail <span style=color:#ff7b72;font-weight:700>=</span> {
</span></span><span style=display:flex><span>                    <span style=color:#a5d6ff>&#34;input&#34;</span>: <span style=color:#ff7b72>case</span>[<span style=color:#a5d6ff>&#34;input&#34;</span>],
</span></span><span style=display:flex><span>                    <span style=color:#a5d6ff>&#34;output&#34;</span>: output,
</span></span><span style=display:flex><span>                    <span style=color:#a5d6ff>&#34;expected&#34;</span>: <span style=color:#ff7b72>case</span>[<span style=color:#a5d6ff>&#34;expected_output&#34;</span>],
</span></span><span style=display:flex><span>                    <span style=color:#a5d6ff>&#34;score&#34;</span>: score,
</span></span><span style=display:flex><span>                    <span style=color:#a5d6ff>&#34;success&#34;</span>: score <span style=color:#ff7b72;font-weight:700>&gt;</span> <span style=color:#a5d6ff>0.6</span>
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>                results[<span style=color:#a5d6ff>&#34;details&#34;</span>]<span style=color:#ff7b72;font-weight:700>.</span>append(detail)
</span></span><span style=display:flex><span>                total_score <span style=color:#ff7b72;font-weight:700>+=</span> score
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>                <span style=color:#ff7b72>if</span> score <span style=color:#ff7b72;font-weight:700>&gt;</span> <span style=color:#a5d6ff>0.6</span>:
</span></span><span style=display:flex><span>                    results[<span style=color:#a5d6ff>&#34;success&#34;</span>] <span style=color:#ff7b72;font-weight:700>+=</span> <span style=color:#a5d6ff>1</span>
</span></span><span style=display:flex><span>                <span style=color:#ff7b72>else</span>:
</span></span><span style=display:flex><span>                    results[<span style=color:#a5d6ff>&#34;failed&#34;</span>] <span style=color:#ff7b72;font-weight:700>+=</span> <span style=color:#a5d6ff>1</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>except</span> <span style=color:#f0883e;font-weight:700>Exception</span> <span style=color:#ff7b72>as</span> e:
</span></span><span style=display:flex><span>                results[<span style=color:#a5d6ff>&#34;failed&#34;</span>] <span style=color:#ff7b72;font-weight:700>+=</span> <span style=color:#a5d6ff>1</span>
</span></span><span style=display:flex><span>                results[<span style=color:#a5d6ff>&#34;details&#34;</span>]<span style=color:#ff7b72;font-weight:700>.</span>append({
</span></span><span style=display:flex><span>                    <span style=color:#a5d6ff>&#34;input&#34;</span>: <span style=color:#ff7b72>case</span>[<span style=color:#a5d6ff>&#34;input&#34;</span>],
</span></span><span style=display:flex><span>                    <span style=color:#a5d6ff>&#34;error&#34;</span>: str(e)
</span></span><span style=display:flex><span>                })
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        results[<span style=color:#a5d6ff>&#34;avg_score&#34;</span>] <span style=color:#ff7b72;font-weight:700>=</span> total_score <span style=color:#ff7b72;font-weight:700>/</span> len(test_cases)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>return</span> results
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>async</span> <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>_score_output</span>(
</span></span><span style=display:flex><span>        self,
</span></span><span style=display:flex><span>        output: str,
</span></span><span style=display:flex><span>        expected: str,
</span></span><span style=display:flex><span>        criteria: List[str]
</span></span><span style=display:flex><span>    ) <span style=color:#ff7b72;font-weight:700>-&gt;</span> float:
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;&#34;&#34;è¯„åˆ†&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># ç®€å•å®ç°ï¼šæ£€æŸ¥å…³é”®è¯åŒ¹é…</span>
</span></span><span style=display:flex><span>        expected_keywords <span style=color:#ff7b72;font-weight:700>=</span> set(expected<span style=color:#ff7b72;font-weight:700>.</span>lower()<span style=color:#ff7b72;font-weight:700>.</span>split())
</span></span><span style=display:flex><span>        output_keywords <span style=color:#ff7b72;font-weight:700>=</span> set(output<span style=color:#ff7b72;font-weight:700>.</span>lower()<span style=color:#ff7b72;font-weight:700>.</span>split())
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        overlap <span style=color:#ff7b72;font-weight:700>=</span> len(expected_keywords <span style=color:#ff7b72;font-weight:700>&amp;</span> output_keywords)
</span></span><span style=display:flex><span>        coverage <span style=color:#ff7b72;font-weight:700>=</span> overlap <span style=color:#ff7b72;font-weight:700>/</span> len(expected_keywords) <span style=color:#ff7b72>if</span> expected_keywords <span style=color:#ff7b72>else</span> <span style=color:#a5d6ff>0</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>return</span> coverage
</span></span></code></pre></td></tr></table></div></div><h2 id=æœ€ä½³å®è·µ>æœ€ä½³å®è·µ<a hidden class=anchor aria-hidden=true href=#æœ€ä½³å®è·µ>#</a></h2><ol><li><strong>æ˜ç¡®è§’è‰²å®šä½</strong>ï¼šæ¯ä¸ªAgentåº”æœ‰æ¸…æ™°çš„èŒè´£</li><li><strong>åˆç†æ‹†åˆ†ä»»åŠ¡</strong>ï¼šå¤æ‚ä»»åŠ¡åˆ†è§£ä¸ºå¯ç®¡ç†çš„å­ä»»åŠ¡</li><li><strong>å·¥å…·é€‰æ‹©</strong>ï¼šæä¾›é«˜è´¨é‡çš„å·¥å…·é›†</li><li><strong>è®°å¿†ç®¡ç†</strong>ï¼šåŒºåˆ†çŸ­æœŸå’Œé•¿æœŸè®°å¿†</li><li><strong>è¿­ä»£ä¼˜åŒ–</strong>ï¼šæŒç»­è¯„ä¼°å’Œæ”¹è¿›</li></ol><p>AI Agentæ¶æ„æ­£åœ¨å¿«é€Ÿå‘å±•ï¼ŒæŒæ¡è¿™äº›æ ¸å¿ƒæ¨¡å¼å°†å¸®åŠ©å¼€å‘è€…æ„å»ºæ›´å¼ºå¤§çš„AIåº”ç”¨ã€‚</p></div><footer class=post-footer-modern><div class=post-tags-modern><span class=tags-label>ğŸ·ï¸ æ ‡ç­¾</span><div class=tags-list><a href=/blog/tags/ai-agent/ class=tag-pill>AI Agent
</a><a href=/blog/tags/llm/ class=tag-pill>LLM
</a><a href=/blog/tags/%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1/ class=tag-pill>æ¶æ„è®¾è®¡
</a><a href=/blog/tags/%E5%A4%9A%E6%99%BA%E8%83%BD%E4%BD%93/ class=tag-pill>å¤šæ™ºèƒ½ä½“
</a><a href=/blog/tags/react/ class=tag-pill>ReAct</a></div></div><style>.post-footer-modern{margin-top:3rem;padding-top:2rem;border-top:1px solid var(--border,#333333)}.post-tags-modern{display:flex;align-items:center;gap:1rem;margin-bottom:2rem;flex-wrap:wrap}.tags-label{font-size:.875rem;font-weight:600;color:var(--secondary,#999999) !important;white-space:nowrap}.tags-list{display:flex;flex-wrap:wrap;gap:.5rem;flex:1}.tag-pill{display:inline-block;padding:.25rem .75rem;background:rgba(255,255,255,5%);border:1px solid var(--border,#333333);border-radius:0;color:var(--secondary,#cccccc) !important;text-decoration:none;font-size:.8rem;font-weight:500;transition:all .2s ease}.tag-pill:hover{background:var(--primary,#ffffff);color:var(--background,#000000) !important;border-color:var(--primary,#ffffff);transform:translateY(-1px)}.post-nav-modern{margin-top:2rem}.nav-grid{display:grid;grid-template-columns:1fr 1fr;gap:1rem}.nav-card{display:flex;align-items:center;gap:1rem;padding:1.25rem;background:rgba(255,255,255,2%);border:1px solid var(--border,#333333);border-radius:12px;text-decoration:none;transition:all .2s ease;min-height:80px}.nav-card:hover{background:rgba(255,255,255,5%);border-color:var(--primary,#ffffff);transform:translateY(-2px)}.nav-card.nav-prev{justify-content:flex-start}.nav-card.nav-next{justify-content:flex-end;text-align:right}.nav-card.nav-next .nav-content{text-align:right}.nav-empty{display:flex;align-items:center;justify-content:center;background:rgba(255,255,255,1%);border:1px dashed var(--border,#333333);color:var(--secondary,#666666)}.nav-arrow{font-size:1.5rem;color:var(--primary,#ffffff);font-weight:300}.nav-content{flex:1}.nav-title{font-size:.95rem;font-weight:600;color:var(--primary,#ffffff) !important;line-height:1.4;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden}[data-theme=light] .post-footer-modern{border-color:var(--border-light,#dee2e6)}[data-theme=light] .tags-label{color:var(--secondary-light,#6c757d) !important}[data-theme=light] .tag-pill{background:rgba(0,0,0,5%);border-color:var(--border-light,#dee2e6);color:var(--secondary-light,#495057) !important}[data-theme=light] .tag-pill:hover{background:var(--primary-light,#0066cc);color:var(--background-light,#ffffff) !important;border-color:var(--primary-light,#0066cc)}[data-theme=light] .nav-card{background:rgba(0,0,0,2%);border-color:var(--border-light,#dee2e6)}[data-theme=light] .nav-card:hover{background:rgba(0,102,204,5%);border-color:var(--primary-light,#0066cc)}[data-theme=light] .nav-empty{background:rgba(0,0,0,1%);border-color:var(--border-light,#dee2e6);color:var(--secondary-light,#6c757d)}[data-theme=light] .nav-arrow{color:var(--primary-light,#0066cc)}[data-theme=light] .nav-title{color:var(--primary-light,#212529) !important}@media(max-width:768px){.nav-grid{grid-template-columns:1fr;gap:.75rem}.nav-card{padding:1rem;min-height:70px}.nav-card.nav-next{text-align:left}.nav-card.nav-next .nav-content{text-align:left}.nav-title{font-size:.875rem}.post-tags-modern{flex-direction:column;gap:.75rem}}@media(max-width:480px){.nav-arrow{font-size:1.25rem}.nav-card{padding:.875rem}.nav-title{font-size:.8rem;-webkit-line-clamp:1}}</style><nav class=post-nav-modern><div class=nav-grid><a href=/blog/articles/prompt%E5%B7%A5%E7%A8%8B%E5%AE%8C%E5%85%A8%E6%8C%87%E5%8D%97%E6%8E%8C%E6%8F%A1%E4%B8%8E%E5%A4%A7%E8%AF%AD%E8%A8%80%E6%A8%A1%E5%9E%8B%E6%B2%9F%E9%80%9A%E7%9A%84%E8%89%BA%E6%9C%AF/ class="nav-card nav-prev"><div class=nav-arrow>â†</div><div class=nav-content><div class=nav-title>Promptå·¥ç¨‹å®Œå…¨æŒ‡å—ï¼šæŒæ¡ä¸å¤§è¯­è¨€æ¨¡å‹æ²Ÿé€šçš„è‰ºæœ¯</div></div></a><a href=/blog/articles/webassembly%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E5%AE%9E%E8%B7%B5%E7%AA%81%E7%A0%B4web%E5%BA%94%E7%94%A8%E6%80%A7%E8%83%BD%E7%93%B6%E9%A2%88/ class="nav-card nav-next"><div class=nav-content><div class=nav-title>WebAssemblyæ€§èƒ½ä¼˜åŒ–å®è·µï¼šçªç ´Webåº”ç”¨æ€§èƒ½ç“¶é¢ˆ</div></div><div class=nav-arrow>â†’</div></a></div></nav></footer></main><aside class=post-sidebar><div class=sidebar-toc id=sidebar-toc><div class=toc-header><div class=toc-title>ç›®å½•</div><button class=toc-toggle id=toc-toggle aria-label="Toggle TOC">
<svg class="toc-toggle-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 6 6 18M6 6l12 12"/></svg></button></div><div class=toc-content id=toc-content><ul class=toc-list><li class="toc-item toc-h2"><a href=#h2-0 class=toc-item-link><span class=toc-item-text>AgentåŸºç¡€æ¶æ„</span></a></li><li class="toc-item toc-h2"><a href=#h2-1 class=toc-item-link><span class=toc-item-text>ReActæ¨¡å¼</span></a></li><li class="toc-item toc-h2"><a href=#h2-2 class=toc-item-link><span class=toc-item-text>é“¾å¼æ€ç»´ï¼ˆChain of Thoughtï¼‰</span></a></li><li class="toc-item toc-h2"><a href=#h2-3 class=toc-item-link><span class=toc-item-text>å¤šæ™ºèƒ½ä½“åä½œ</span></a></li><li class="toc-item toc-h2"><a href=#h2-4 class=toc-item-link><span class=toc-item-text>å·¥å…·è°ƒç”¨æ¨¡å¼</span></a></li><li class="toc-item toc-h2"><a href=#h2-5 class=toc-item-link><span class=toc-item-text>è®°å¿†ç³»ç»Ÿ</span></a></li><li class="toc-item toc-h2"><a href=#h2-6 class=toc-item-link><span class=toc-item-text>Agentè¯„ä¼°</span></a></li><li class="toc-item toc-h2"><a href=#h2-7 class=toc-item-link><span class=toc-item-text>æœ€ä½³å®è·µ</span></a></li></ul></div></div><script>document.addEventListener("DOMContentLoaded",function(){const e=document.getElementById("sidebar-toc"),t=document.getElementById("toc-toggle"),o=document.getElementById("toc-content"),i=t?.querySelector(".toc-toggle-icon");if(!e)return;let n=!1;t&&t.addEventListener("click",function(){n=!n,n?(o.style.display="none",e.style.width="auto",i.innerHTML='<path d="M9 18l6-6-6-6"/>'):(o.style.display="block",e.style.width="200px",i.innerHTML='<path d="M18 6L6 18M6 6l12 12"/>')});const s=document.querySelector(".post-content");if(s){const e=s.querySelectorAll("h1");e.forEach((e,t)=>{e.id=`h1-${t}`});const t=s.querySelectorAll("h2");t.forEach((e,t)=>{e.id=`h2-${t}`})}const a=document.querySelectorAll(".toc-item-link");a.forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();const n=this.getAttribute("href").substring(1),t=document.getElementById(n);if(t){const e=document.querySelector(".post-header-main")?.offsetHeight||0,n=t.offsetTop-e-20;window.scrollTo({top:n,behavior:"smooth"})}})})})</script><style>.sidebar-toc{position:sticky;top:2rem;width:200px;background:#fff;border:1px solid #e5e7eb;border-radius:4px;overflow:hidden;box-shadow:0 1px 3px rgba(0,0,0,.1);z-index:100}.sidebar-toc.hidden{display:none}.toc-header{padding:12px 16px;border-bottom:1px solid #e5e7eb;background:#fafbfc;display:flex;align-items:center;justify-content:space-between}.toc-title{margin:0;font-size:13px;font-weight:500;color:#374151 !important;font-family:-apple-system,BlinkMacSystemFont,segoe ui,Roboto,sans-serif;text-transform:uppercase;letter-spacing:1px}.toc-toggle{background:0 0;border:none;cursor:pointer;padding:4px;border-radius:4px;display:flex;align-items:center;justify-content:center;transition:all .2s ease;color:#6b7280}.toc-toggle:hover{background:#e5e7eb;color:#374151}.toc-toggle-icon{transition:transform .2s ease}.toc-content{padding:12px 0}.toc-list{list-style:none;margin:0;padding:0}.toc-item{margin-bottom:4px;display:block !important;visibility:visible !important}.toc-h1,.toc-h2{display:block !important}.toc-h2{margin-left:0}.toc-item-link{display:flex;align-items:center;gap:8px;padding:8px 12px;color:#374151 !important;text-decoration:none;font-size:13px;line-height:1.4;border-radius:3px;transition:all .2s ease;font-weight:400}.toc-item-link:hover{background:#f8fafc;color:#1f2937 !important}.toc-item-link.active{background:#e0f2fe;color:#01579b !important;font-weight:500}.toc-dot{width:8px;height:8px;border-radius:50%;flex-shrink:0}.dot-red{background:#ef4444}.dot-blue{background:#2196f3}.toc-item-text{color:#1f2937 !important;font-weight:400;flex:1;display:inline !important;visibility:visible !important;opacity:1 !important;font-size:13px !important;line-height:1.4 !important}.toc-item-link .toc-item-text{color:#1f2937 !important;display:inline !important;visibility:visible !important;opacity:1 !important}.toc-item.active .dot-red{background:#d32f2f}.toc-item.active .dot-blue{background:#1976d2}[data-theme=dark] .sidebar-toc{background:#1f2937;border-color:#374151;box-shadow:0 1px 3px rgba(0,0,0,.3)}[data-theme=dark] .toc-header{background:#111827;border-color:#374151}[data-theme=dark] .toc-title{color:#f3f4f6 !important}[data-theme=dark] .toc-toggle{color:#9ca3af}[data-theme=dark] .toc-toggle:hover{background:#374151;color:#f3f4f6}[data-theme=dark] .toc-item-link{color:#e5e7eb !important}[data-theme=dark] .toc-item-link:hover{background:#374151;color:#f9fafb !important}[data-theme=dark] .toc-item-link.active{background:#0d47a1;color:#fff !important}[data-theme=dark] .toc-item-text{color:#f9fafb !important;display:inline !important;visibility:visible !important;opacity:1 !important}[data-theme=dark] .toc-item-link .toc-item-text{color:#f9fafb !important;display:inline !important;visibility:visible !important;opacity:1 !important}@media(max-width:1024px){.sidebar-toc{display:none}.post-content-wrapper{grid-template-columns:1fr !important;padding:0 1rem !important}}</style><style>.post-content-wrapper{display:grid;grid-template-columns:1fr 200px;gap:2rem;padding:0 2rem;max-width:100%}.post-content-main{min-width:0}.post-sidebar{position:sticky;top:2rem;height:fit-content;min-width:0}.post-header-main{margin-bottom:2rem;padding-bottom:1rem;border-bottom:1px solid var(--border,#333333)}.post-header-main .post-title{color:var(--primary,#ffffff) !important;font-size:2.5rem;font-weight:700;line-height:1.2;margin-bottom:1rem}.post-header-main .post-description{color:var(--secondary,#cccccc) !important;font-size:1.1rem;line-height:1.6;margin-bottom:1rem}.post-header-main .post-meta{margin-bottom:0}@media(max-width:1024px){.post-content-wrapper{grid-template-columns:1fr !important;gap:1rem;padding:0 1rem !important}.post-sidebar{display:none}}@media(max-width:768px){.post-header-main .post-title{font-size:2rem}.post-header-main .post-description{font-size:1rem}}</style></aside></div></article></main><footer class=footer><span>Â© 2024-2025 æœ‰æ¡å·¥å…·æŠ€æœ¯åšå®¢</span> Â·</footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");if(menu){const e=localStorage.getItem("menu-scroll-position");e&&(menu.scrollLeft=parseInt(e,10)),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}}document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{const e=document.querySelector("html");e.dataset.theme==="dark"?(e.dataset.theme="light",localStorage.setItem("pref-theme","light")):(e.dataset.theme="dark",localStorage.setItem("pref-theme","dark"))})</script></body></html>