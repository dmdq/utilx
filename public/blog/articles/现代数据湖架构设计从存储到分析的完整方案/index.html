<!doctype html><html lang=zh-cn dir=auto data-theme=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>ç°ä»£æ•°æ®æ¹–æ¶æ„è®¾è®¡ï¼šä»å­˜å‚¨åˆ°åˆ†æçš„å®Œæ•´æ–¹æ¡ˆ | æŠ€æœ¯åšå®¢ - æœ‰æ¡å·¥å…·</title><meta name=keywords content="æ•°æ®æ¹–,å¤§æ•°æ®,Delta Lake,Iceberg,æ•°æ®ä»“åº“"><meta name=description content="æ·±å…¥è§£ææ•°æ®æ¹–çš„æ ¸å¿ƒæ¦‚å¿µã€æ¶æ„è®¾è®¡ã€åˆ†åŒºç­–ç•¥å’Œæœ€ä½³å®è·µï¼Œå¸®åŠ©ä¼ä¸šæ„å»ºé«˜æ€§èƒ½ã€ä½æˆæœ¬çš„æ•°æ®åˆ†æå¹³å°ã€‚"><meta name=author content="æœ‰æ¡å·¥å…·å›¢é˜Ÿ"><link rel=canonical href=/blog/articles/%E7%8E%B0%E4%BB%A3%E6%95%B0%E6%8D%AE%E6%B9%96%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E4%BB%8E%E5%AD%98%E5%82%A8%E5%88%B0%E5%88%86%E6%9E%90%E7%9A%84%E5%AE%8C%E6%95%B4%E6%96%B9%E6%A1%88/><link crossorigin=anonymous href=/blog/assets/css/stylesheet.7e8505b7cdf8bb22ab2305e53c2700bb06c7e64faeb72cd3468823a9a3bd3d6e.css integrity="sha256-foUFt834uyKrIwXlPCcAuwbH5k+utyzTRogjqaO9PW4=" rel="preload stylesheet" as=style><link rel=icon href=/favicon.ico><link rel=icon type=image/png sizes=16x16 href=/blog/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=/blog/favicon-32x32.png><link rel=apple-touch-icon href=/blog/apple-touch-icon.png><link rel=mask-icon href=/blog/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate type=application/rss+xml href=/blog/articles/%E7%8E%B0%E4%BB%A3%E6%95%B0%E6%8D%AE%E6%B9%96%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E4%BB%8E%E5%AD%98%E5%82%A8%E5%88%B0%E5%88%86%E6%9E%90%E7%9A%84%E5%AE%8C%E6%95%B4%E6%96%B9%E6%A1%88/feed.xml title=rss><link rel=alternate hreflang=zh-cn href=/blog/articles/%E7%8E%B0%E4%BB%A3%E6%95%B0%E6%8D%AE%E6%B9%96%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E4%BB%8E%E5%AD%98%E5%82%A8%E5%88%B0%E5%88%86%E6%9E%90%E7%9A%84%E5%AE%8C%E6%95%B4%E6%96%B9%E6%A1%88/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51);color-scheme:dark}.list{background:var(--theme)}.toc{background:var(--entry)}}@media(prefers-color-scheme:light){.list::-webkit-scrollbar-thumb{border-color:var(--code-bg)}}</style></noscript><script>localStorage.getItem("pref-theme")==="dark"?document.querySelector("html").dataset.theme="dark":localStorage.getItem("pref-theme")==="light"?document.querySelector("html").dataset.theme="light":window.matchMedia("(prefers-color-scheme: dark)").matches?document.querySelector("html").dataset.theme="dark":document.querySelector("html").dataset.theme="light"</script><script src=/js/external-link-config.js></script><script src=/js/external-link-interceptor.js></script><link rel=stylesheet href=/blog/css/custom.css media=screen><script type=application/ld+json>{"@context":"https://schema.org","@type":"WebSite","name":"æŠ€æœ¯åšå®¢ - æœ‰æ¡å·¥å…· | å¼€å‘è€…å·¥å…·ä½¿ç”¨æ•™ç¨‹ & ç¼–ç¨‹æŠ€å·§åˆ†äº«","url":"https://www.util.cn/blog/","description":"æœ‰æ¡å·¥å…·æŠ€æœ¯åšå®¢ - åˆ†äº«å¼€å‘è€…å·¥å…·ä½¿ç”¨æ•™ç¨‹ã€ç¼–ç¨‹æŠ€å·§å’Œå®æˆ˜å¼€å‘ç»éªŒã€‚æä¾›JSONæ ¼å¼åŒ–ã€SQLä¼˜åŒ–ã€Markdownç¼–è¾‘å™¨ç­‰åœ¨çº¿å·¥å…·çš„è¯¦ç»†ä½¿ç”¨æŒ‡å—ï¼Œå¸®åŠ©å¼€å‘è€…æå‡å·¥ä½œæ•ˆç‡ã€‚","publisher":{"@type":"Organization","name":"æœ‰æ¡å·¥å…·","url":"https://www.util.cn","logo":{"@type":"ImageObject","url":"https://www.util.cn/blog/logo/logo-256.png","width":256,"height":256}},"potentialAction":[{"@type":"SearchAction","target":"https://www.util.cn/blog/search?q={search_term_string}","query-input":"required name=search_term_string"}]}</script><meta property="og:type" content="website"><meta property="og:title" content="æŠ€æœ¯åšå®¢ - æœ‰æ¡å·¥å…· | å¼€å‘è€…å·¥å…·ä½¿ç”¨æ•™ç¨‹ & ç¼–ç¨‹æŠ€å·§åˆ†äº«"><meta property="og:description" content="æœ‰æ¡å·¥å…·æŠ€æœ¯åšå®¢ - åˆ†äº«å¼€å‘è€…å·¥å…·ä½¿ç”¨æ•™ç¨‹ã€ç¼–ç¨‹æŠ€å·§å’Œå®æˆ˜å¼€å‘ç»éªŒã€‚æä¾›JSONæ ¼å¼åŒ–ã€SQLä¼˜åŒ–ã€Markdownç¼–è¾‘å™¨ç­‰åœ¨çº¿å·¥å…·çš„è¯¦ç»†ä½¿ç”¨æŒ‡å—ï¼Œå¸®åŠ©å¼€å‘è€…æå‡å·¥ä½œæ•ˆç‡ã€‚"><meta property="og:url" content="https://www.util.cn/blog/"><meta property="og:site_name" content="æœ‰æ¡å·¥å…·æŠ€æœ¯åšå®¢"><meta property="og:image" content="https://www.util.cn/blog/logo/logo-256.png"><meta property="og:image:width" content="1200"><meta property="og:image:height" content="630"><meta name=twitter:card content="summary_large_image"><meta name=twitter:title content="æŠ€æœ¯åšå®¢ - æœ‰æ¡å·¥å…· | å¼€å‘è€…å·¥å…·ä½¿ç”¨æ•™ç¨‹ & ç¼–ç¨‹æŠ€å·§åˆ†äº«"><meta name=twitter:description content="æœ‰æ¡å·¥å…·æŠ€æœ¯åšå®¢ - åˆ†äº«å¼€å‘è€…å·¥å…·ä½¿ç”¨æ•™ç¨‹ã€ç¼–ç¨‹æŠ€å·§å’Œå®æˆ˜å¼€å‘ç»éªŒã€‚"><meta name=twitter:image content="https://www.util.cn/blog/logo/logo-256.png"><meta name=baidu-site-verification content><meta name=category content="æŠ€æœ¯åšå®¢,å¼€å‘è€…å·¥å…·,ç¼–ç¨‹æ•™ç¨‹"><meta name=coverage content="Worldwide"><meta name=distribution content="Global"><meta name=rating content="General"><script id=51la_code async crossorigin=anonymous src="https://sdk.51.la/js-sdk-pro.min.js?id=3OM52V0xJAPv6ozF&hash=pro"></script><script>window.addEventListener("load",function(){setTimeout(function(){typeof la!="undefined"?console.log("51laç»Ÿè®¡å·²åŠ è½½"):(console.warn("51laç»Ÿè®¡åŠ è½½å¤±è´¥ï¼Œä½¿ç”¨å¤‡ç”¨æ–¹æ¡ˆ"),function(){var e=document.createElement("script");e.src="https://sdk.51.la/js-sdk-pro.min.js?id=3OM52V0xJAPv6ozF&hash=backup",e.async=!0,document.head.appendChild(e)}())},3e3)})</script><meta property="og:url" content="/blog/articles/%E7%8E%B0%E4%BB%A3%E6%95%B0%E6%8D%AE%E6%B9%96%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E4%BB%8E%E5%AD%98%E5%82%A8%E5%88%B0%E5%88%86%E6%9E%90%E7%9A%84%E5%AE%8C%E6%95%B4%E6%96%B9%E6%A1%88/"><meta property="og:site_name" content="æŠ€æœ¯åšå®¢ - æœ‰æ¡å·¥å…·"><meta property="og:title" content="ç°ä»£æ•°æ®æ¹–æ¶æ„è®¾è®¡ï¼šä»å­˜å‚¨åˆ°åˆ†æçš„å®Œæ•´æ–¹æ¡ˆ"><meta property="og:description" content="æ·±å…¥è§£ææ•°æ®æ¹–çš„æ ¸å¿ƒæ¦‚å¿µã€æ¶æ„è®¾è®¡ã€åˆ†åŒºç­–ç•¥å’Œæœ€ä½³å®è·µï¼Œå¸®åŠ©ä¼ä¸šæ„å»ºé«˜æ€§èƒ½ã€ä½æˆæœ¬çš„æ•°æ®åˆ†æå¹³å°ã€‚"><meta property="og:locale" content="zh-cn"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2025-12-25T21:00:00+08:00"><meta property="article:modified_time" content="2025-12-25T21:00:00+08:00"><meta property="article:tag" content="æ•°æ®æ¹–"><meta property="article:tag" content="å¤§æ•°æ®"><meta property="article:tag" content="Delta Lake"><meta property="article:tag" content="Iceberg"><meta property="article:tag" content="æ•°æ®ä»“åº“"><meta name=twitter:card content="summary"><meta name=twitter:title content="ç°ä»£æ•°æ®æ¹–æ¶æ„è®¾è®¡ï¼šä»å­˜å‚¨åˆ°åˆ†æçš„å®Œæ•´æ–¹æ¡ˆ"><meta name=twitter:description content="æ·±å…¥è§£ææ•°æ®æ¹–çš„æ ¸å¿ƒæ¦‚å¿µã€æ¶æ„è®¾è®¡ã€åˆ†åŒºç­–ç•¥å’Œæœ€ä½³å®è·µï¼Œå¸®åŠ©ä¼ä¸šæ„å»ºé«˜æ€§èƒ½ã€ä½æˆæœ¬çš„æ•°æ®åˆ†æå¹³å°ã€‚"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"æ‰€æœ‰æ–‡ç« ","item":"/blog/posts/"},{"@type":"ListItem","position":2,"name":"ç°ä»£æ•°æ®æ¹–æ¶æ„è®¾è®¡ï¼šä»å­˜å‚¨åˆ°åˆ†æçš„å®Œæ•´æ–¹æ¡ˆ","item":"/blog/articles/%E7%8E%B0%E4%BB%A3%E6%95%B0%E6%8D%AE%E6%B9%96%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E4%BB%8E%E5%AD%98%E5%82%A8%E5%88%B0%E5%88%86%E6%9E%90%E7%9A%84%E5%AE%8C%E6%95%B4%E6%96%B9%E6%A1%88/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"ç°ä»£æ•°æ®æ¹–æ¶æ„è®¾è®¡ï¼šä»å­˜å‚¨åˆ°åˆ†æçš„å®Œæ•´æ–¹æ¡ˆ","name":"ç°ä»£æ•°æ®æ¹–æ¶æ„è®¾è®¡ï¼šä»å­˜å‚¨åˆ°åˆ†æçš„å®Œæ•´æ–¹æ¡ˆ","description":"æ·±å…¥è§£ææ•°æ®æ¹–çš„æ ¸å¿ƒæ¦‚å¿µã€æ¶æ„è®¾è®¡ã€åˆ†åŒºç­–ç•¥å’Œæœ€ä½³å®è·µï¼Œå¸®åŠ©ä¼ä¸šæ„å»ºé«˜æ€§èƒ½ã€ä½æˆæœ¬çš„æ•°æ®åˆ†æå¹³å°ã€‚","keywords":["æ•°æ®æ¹–","å¤§æ•°æ®","Delta Lake","Iceberg","æ•°æ®ä»“åº“"],"articleBody":"æ•°æ®æ¹–å·²æˆä¸ºç°ä»£æ•°æ®æ¶æ„çš„æ ¸å¿ƒç»„ä»¶ã€‚ä¸ä¼ ç»Ÿçš„æ•°æ®ä»“åº“ä¸åŒï¼Œæ•°æ®æ¹–å¯ä»¥å­˜å‚¨ä»»ä½•æ ¼å¼ã€ä»»ä½•è§„æ¨¡çš„æ•°æ®ï¼Œä¸ºæ•°æ®åˆ†æå’Œæœºå™¨å­¦ä¹ æä¾›å¼ºå¤§æ”¯æŒã€‚\næ•°æ®æ¹– vs æ•°æ®ä»“åº“ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ ç‰¹æ€§ â”‚ æ•°æ®ä»“åº“ â”‚ æ•°æ®æ¹– â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚ æ•°æ®ç»“æ„ â”‚ ç»“æ„åŒ–(é¢„å®šä¹‰) â”‚ ä»»æ„æ ¼å¼ â”‚ â”‚ Schema â”‚ Schema on Writeâ”‚ Schema on Read â”‚ â”‚ å­˜å‚¨æˆæœ¬ â”‚ é«˜ â”‚ ä½ â”‚ â”‚ çµæ´»æ€§ â”‚ ä½ â”‚ é«˜ â”‚ â”‚ é€‚ç”¨åœºæ™¯ â”‚ æŠ¥è¡¨ã€BI â”‚ MLã€æ¢ç´¢åˆ†æ â”‚ â”‚ æ•°æ®è´¨é‡ â”‚ é«˜ â”‚ å¯å˜ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ æ•°æ®æ¹–åˆ†å±‚æ¶æ„ Bronze/Silver/Gold åˆ†å±‚ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 174 175 176 177 178 179 180 # Delta Lakeæ•°æ®æ¹–å®ç° from delta import DeltaTable from pyspark.sql import SparkSession from pyspark.sql.functions import * class DataLakeBuilder: def __init__(self, spark: SparkSession, base_path: str): self.spark = spark self.base_path = base_path def build_bronze_layer(self, source_system: str): \"\"\" Bronzeå±‚ï¼šåŸå§‹æ•°æ®å±‚ - ä¿æŒåŸå§‹æ ¼å¼ - ä¸åšä»»ä½•è½¬æ¢ - ç”¨äºå®¡è®¡å’Œé‡æ”¾ \"\"\" bronze_path = f\"{self.base_path}/bronze/{source_system}\" # è¯»å–åŸå§‹æ•°æ® df = (self.spark.read .format(\"kafka\") .option(\"kafka.bootstrap.servers\", \"localhost:9092\") .option(\"subscribe\", source_system) .option(\"startingOffsets\", \"latest\") .load()) # å†™å…¥Bronzeå±‚ (df.write .format(\"delta\") .mode(\"append\") .option(\"mergeSchema\", \"true\") .partitionBy(\"year\", \"month\", \"day\") .save(bronze_path)) return bronze_path def build_silver_layer(self, source_system: str): \"\"\" Silverå±‚ï¼šæ¸…æ´—å’Œæ ‡å‡†åŒ–å±‚ - æ•°æ®æ¸…æ´— - Schemaæ ‡å‡†åŒ– - æ•°æ®è´¨é‡æ£€æŸ¥ - å»é‡å’Œå…³è” \"\"\" bronze_path = f\"{self.base_path}/bronze/{source_system}\" silver_path = f\"{self.base_path}/silver/{source_system}\" # è¯»å–Bronzeå±‚æ•°æ® bronze_df = (self.spark.read .format(\"delta\") .load(bronze_path)) # æ•°æ®æ¸…æ´—å’Œè½¬æ¢ silver_df = (bronze_df .filter(col(\"value\").isNotNull()) .withColumn(\"data\", from_json(col(\"value\"), schema_string)) .select( col(\"timestamp\").cast(\"timestamp\"), col(\"data.*\") ) .withWatermark(\"timestamp\", \"10 minutes\") .dropDuplicates([\"id\", \"timestamp\"])) # æ•°æ®è´¨é‡æ£€æŸ¥ quality_checks = self.run_data_quality_checks(silver_df) if quality_checks[\"passed_rate\"] \u003c 0.95: raise Exception(\"Data quality check failed\") # å†™å…¥Silverå±‚ï¼ˆæ”¯æŒUPSERTï¼‰ from delta.tables import DeltaTable if DeltaTable.isDeltaTable(self.spark, silver_path): # MERGEæ“ä½œï¼ˆCDCæ”¯æŒï¼‰ (DeltaTable.forPath(self.spark, silver_path) .alias(\"target\") .merge( silver_df.alias(\"source\"), \"target.id = source.id AND target.timestamp \u003c source.timestamp\" ) .whenMatchedUpdateAll() .whenNotMatchedInsertAll() .execute()) else: # é¦–æ¬¡å†™å…¥ (silver_df.write .format(\"delta\") .mode(\"overwrite\") .partitionBy(\"year\", \"month\", \"day\") .save(silver_path)) return silver_path def build_gold_layer(self, business_domain: str): \"\"\" Goldå±‚ï¼šä¸šåŠ¡èšåˆå±‚ - æ˜Ÿå‹æ¨¡å‹ - èšåˆæŒ‡æ ‡ - ä¼˜åŒ–æŸ¥è¯¢æ€§èƒ½ - ç›´æ¥æœåŠ¡äºBIå’ŒML \"\"\" silver_path = f\"{self.base_path}/silver/{business_domain}\" gold_path = f\"{self.base_path}/gold/{business_domain}\" # è¯»å–Silverå±‚æ•°æ® silver_dfs = {} for entity in [\"users\", \"orders\", \"products\"]: path = f\"{silver_path}/{entity}\" silver_dfs[entity] = (self.spark.read .format(\"delta\") .load(path)) # æ„å»ºæ˜Ÿå‹æ¨¡å‹ # äº‹å®è¡¨ fact_orders = (silver_dfs[\"orders\"] .groupBy(\"date\", \"product_id\", \"user_id\") .agg( sum(\"amount\").alias(\"total_amount\"), count(\"*\").alias(\"order_count\"), avg(\"amount\").alias(\"avg_order_value\") )) # ç»´åº¦è¡¨ dim_products = silver_dfs[\"products\"].select( \"product_id\", \"name\", \"category\", \"brand\" ).distinct() dim_users = silver_dfs[\"users\"].select( \"user_id\", \"name\", \"email\", \"segment\" ).distinct() # å†™å…¥Goldå±‚ (fact_orders.write .format(\"delta\") .mode(\"overwrite\") .partitionBy(\"date\") .save(f\"{gold_path}/fact_orders\")) (dim_products.write .format(\"delta\") .mode(\"overwrite\") .save(f\"{gold_path}/dim_products\")) (dim_users.write .format(\"delta\") .mode(\"overwrite\") .save(f\"{gold_path}/dim_users\")) # åˆ›å»ºä¼˜åŒ–è§†å›¾ self.create_optimized_views(gold_path) return gold_path def run_data_quality_checks(self, df): \"\"\"æ•°æ®è´¨é‡æ£€æŸ¥\"\"\" total = df.count() not_null = df.filter(col(\"id\").isNotNull()).count() return { \"total_records\": total, \"not_null_records\": not_null, \"null_rate\": 1 - (not_null / total), \"passed_rate\": not_null / total } def create_optimized_views(self, gold_path: str): \"\"\"åˆ›å»ºä¼˜åŒ–è§†å›¾ï¼ŒåŠ é€ŸæŸ¥è¯¢\"\"\" # åˆ›å»ºZ-ORDERç´¢å¼• for table in [\"fact_orders\", \"dim_products\", \"dim_users\"]: table_path = f\"{gold_path}/{table}\" (DeltaTable.forPath(self.spark, table_path) .optimize() .executeZOrderBy(\"date\")) # ä¼˜åŒ–æ•°æ®æ–‡ä»¶ (DeltaTable.forPath(self.spark, table_path) .optimize() .executeCompaction()) è¡¨æ ¼å¼å¯¹æ¯” Delta Lake vs Iceberg vs Hudi 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 # è¡¨æ ¼å¼å¯¹æ¯” class TableFormatComparison: \"\"\" åŠŸèƒ½å¯¹æ¯”è¡¨ï¼š â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ ç‰¹æ€§ â”‚ Delta Lake â”‚ Iceberg â”‚ Hudi â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚ ACIDäº‹åŠ¡ â”‚ âœ“ â”‚ âœ“ â”‚ âœ“ â”‚ â”‚ Schemaæ¼”å˜ â”‚ âœ“ â”‚ âœ“ â”‚ âœ“ â”‚ â”‚ Time Travel â”‚ âœ“ â”‚ âœ“ â”‚ âœ“ â”‚ â”‚ DELETEæ”¯æŒ â”‚ âœ“ â”‚ âœ“ â”‚ âœ“ â”‚ â”‚ UPDATEæ”¯æŒ â”‚ âœ“ â”‚ âœ“ â”‚ âœ“ â”‚ â”‚ Sparké›†æˆ â”‚ ä¼˜ç§€ â”‚ è‰¯å¥½ â”‚ è‰¯å¥½ â”‚ â”‚ ç¤¾åŒºæ´»è·ƒåº¦ â”‚ éå¸¸é«˜ â”‚ é«˜ â”‚ ä¸­ â”‚ â”‚ å­¦ä¹ æ›²çº¿ â”‚ å¹³ç¼“ â”‚ é™¡å³­ â”‚ é™¡å³­ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ \"\"\" def delta_lake_example(self): \"\"\"Delta Lakeç¤ºä¾‹\"\"\" from delta import * # åˆ›å»ºè¡¨ data = spark.range(0, 1000) data.write.format(\"delta\").save(\"/tmp/delta-table\") # æ—¶é—´æ—…è¡ŒæŸ¥è¯¢ df_old = (spark.read .format(\"delta\") .option(\"timestampAsOf\", \"2024-01-01\") .load(\"/tmp/delta-table\")) # æ›´æ–°æ“ä½œ from delta.tables import DeltaTable deltaTable = DeltaTable.forPath(spark, \"/tmp/delta-table\") (deltaTable .update(\"id % 2 == 0\") .set(\"id\", col(\"id\") + 1000)) # åˆ é™¤æ“ä½œ (deltaTable .delete(\"id \u003e 500\")) # åˆå¹¶æ“ä½œï¼ˆCDCï¼‰ new_data = spark.range(1000, 1500) (deltaTable .alias(\"old\") .merge( new_data.alias(\"new\"), \"old.id = new.id\" ) .whenMatchedUpdateAll() .whenNotMatchedInsertAll() .execute()) def iceberg_example(self): \"\"\"Apache Icebergç¤ºä¾‹\"\"\" # åˆ›å»ºIcebergè¡¨ spark.sql(\"\"\" CREATE TABLE hive_prod.db.orders ( order_id BIGINT, user_id BIGINT, product_id INT, amount DECIMAL(10, 2), order_date TIMESTAMP ) USING iceberg PARTITIONED BY (days(order_date)) LOCATION 's3://my-bucket/warehouse/orders' \"\"\") # Schemaæ¼”å˜ spark.sql(\"\"\" ALTER TABLE hive_prod.db.orders ADD COLUMN discount DECIMAL(5, 2) \"\"\") # æ—¶é—´æ—…è¡Œ spark.sql(\"\"\" SELECT * FROM hive_prod.db.orders VERSION AS OF 5 \"\"\") # åˆ†åŒºæ¼”å˜ spark.sql(\"\"\" ALTER TABLE hive_prod.db.orders SET PARTITION SPECIES (days(order_date)) \"\"\") def hudi_example(self): \"\"\"Apache Hudiç¤ºä¾‹\"\"\" # åˆ›å»ºHudiè¡¨ hudi_options = { 'hoodie.table.name': 'orders', 'hoodie.datasource.write.recordkey.field': 'order_id', 'hoodie.datasource.write.partitionpath.field': 'order_date', 'hoodie.datasource.write.precombine.field': 'updated_at', 'hoodie.upsert.shuffle.parallelism': 200, 'hoodie.cleaner.policy': 'KEEP_LATEST_COMMITS', 'hoodie.cleaner.commits.retained': 10 } # å†™å…¥æ•°æ® (df.write .format(\"hudi\") .options(**hudi_options) .mode(\"overwrite\") .save(\"s3://my-bucket/hudi/orders\")) # å¢é‡æŸ¥è¯¢ (spark.read .format(\"hudi\") .load(\"s3://my-bucket/hudi/orders\") .createTempView(\"orders\")) spark.sql(\"\"\" SELECT * FROM orders WHERE `_hoodie_commit_time` \u003e '2024-01-01' \"\"\") æ•°æ®æ¹–ä¼˜åŒ–ç­–ç•¥ æ–‡ä»¶ç»„ç»‡ä¸åˆ†åŒº 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 class DataLakeOptimizer: \"\"\"æ•°æ®æ¹–ä¼˜åŒ–å™¨\"\"\" def optimize_partitioning(self): \"\"\" åˆ†åŒºç­–ç•¥è®¾è®¡åŸåˆ™ï¼š 1. åˆ†åŒºåŸºæ•° \u003c 1000 2. åˆ†åŒºå¤§å° \u003e 1GB 3. æŒ‰æŸ¥è¯¢é¢‘ç‡é«˜çš„å­—æ®µåˆ†åŒº 4. é¿å…è¿‡ç»†åˆ†åŒº å¥½çš„åˆ†åŒºï¼š - date (å¤©çº§åˆ«) - region (åœ°åŒº) - product_category (ç±»åˆ«) å·®çš„åˆ†åŒºï¼š - user_id (åŸºæ•°å¤ªå¤§) - timestamp (è¿‡ç»†åˆ†åŒº) \"\"\" # æ¨èçš„åˆ†åŒºç­–ç•¥ partition_strategy = { \"orders\": [\"year\", \"month\", \"day\"], \"user_events\": [\"date\", \"event_type\"], \"logs\": [\"date\", \"level\", \"service\"] } return partition_strategy def optimize_file_size(self, table_path: str): \"\"\" æ–‡ä»¶å¤§å°ä¼˜åŒ– - ç›®æ ‡å¤§å°ï¼š128MB - 1GB - å¤ªå°ï¼šå¤§é‡å°æ–‡ä»¶ï¼ŒNameNodeå‹åŠ›å¤§ - å¤ªå¤§ï¼šæŸ¥è¯¢æ—¶éœ€è¦è¯»å–æ•´ä¸ªæ–‡ä»¶ \"\"\" from delta.tables import DeltaTable delta_table = DeltaTable.forPath(self.spark, table_path) # æ–‡ä»¶å‹ç¼© (delta_table .optimize() .executeCompaction()) # æ•°æ®å€¾æ–œå¤„ç† (delta_table .optimize() .executeZOrderBy(\"date\")) # Z-ORDERä¼˜åŒ– def implement_vacuum(self, table_path: str, retention_days: int = 7): \"\"\" æ¸…ç†æ—§ç‰ˆæœ¬æ•°æ® - å®šæœŸæ‰§è¡Œä»¥èŠ‚çœå­˜å‚¨ - ä¿ç•™è¶³å¤Ÿæ—¶é—´ç‚¹ç”¨äºå›æ»š \"\"\" from delta.tables import DeltaTable delta_table = DeltaTable.forPath(self.spark, table_path) # ä¿ç•™æœ€è¿‘7å¤©çš„æ•°æ® delta_table.vacuum(retention_hours * retention_days * 24) æ•°æ®ç®¡é“å®ç° 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 # å®Œæ•´çš„ETLç®¡é“ from airflow import DAG from airflow.operators.python import PythonOperator from airflow.providers.spark.operators.spark_submit import SparkSubmitOperator from datetime import datetime, timedelta def build_data_pipeline(): \"\"\"æ„å»ºæ•°æ®ç®¡é“\"\"\" default_args = { 'owner': 'data-team', 'depends_on_past': False, 'start_date': datetime(2024, 1, 1), 'email_on_failure': True, 'email_on_retry': False, 'retries': 2, 'retry_delay': timedelta(minutes=5) } dag = DAG( 'data_lake_pipeline', default_args=default_args, description='æ•°æ®æ¹–ETLç®¡é“', schedule_interval='0 2 * * *', # æ¯å¤©å‡Œæ™¨2ç‚¹ catchup=False, tags=['datalake', 'etl'] ) # ä»»åŠ¡1ï¼šä»Kafkaæ‘„å–æ•°æ®åˆ°Bronzeå±‚ kafka_to_bronze = SparkSubmitOperator( task_id='kafka_to_bronze', application='jobs/ingest_kafka_to_bronze.py', name='ingest-kafka-to-bronze', conn_id='spark_default', conf={ 'spark.dynamicAllocation.enabled': 'true', 'spark.dynamicAllocation.maxExecutors': '10', 'spark.executor.memory': '4g', 'spark.executor.cores': '2' }, dag=dag ) # ä»»åŠ¡2ï¼šæ¸…æ´—æ•°æ®åˆ°Silverå±‚ bronze_to_silver = SparkSubmitOperator( task_id='bronze_to_silver', application='jobs/bronze_to_silver.py', name='bronze-to-silver', conf={ 'spark.sql.adaptive.enabled': 'true', 'spark.sql.adaptive.coalescePartitions.enabled': 'true' }, dag=dag ) # ä»»åŠ¡3ï¼šæ„å»ºèšåˆè¡¨åˆ°Goldå±‚ silver_to_gold = SparkSubmitOperator( task_id='silver_to_gold', application='jobs/silver_to_gold.py', name='silver-to-gold', dag=dag ) # ä»»åŠ¡4ï¼šæ•°æ®è´¨é‡æ£€æŸ¥ data_quality_check = PythonOperator( task_id='data_quality_check', python_callable=run_quality_checks, dag=dag ) # ä»»åŠ¡5ï¼šæ•°æ®è¡€ç¼˜æ›´æ–° update_lineage = PythonOperator( task_id='update_lineage', python_callable=update_data_lineage, dag=dag ) # ä»»åŠ¡6ï¼šå‘é€æŠ¥å‘Š send_report = PythonOperator( task_id='send_report', python_callable=send_pipeline_report, dag=dag ) # è®¾ç½®ä»»åŠ¡ä¾èµ– kafka_to_bronze \u003e\u003e bronze_to_silver \u003e\u003e silver_to_gold silver_to_gold \u003e\u003e data_quality_check \u003e\u003e update_lineage \u003e\u003e send_report return dag # ä¸»å‡½æ•° def run_quality_checks(**context): \"\"\"è¿è¡Œæ•°æ®è´¨é‡æ£€æŸ¥\"\"\" from quality_checker import DataQualityChecker checker = DataQualityChecker() # æ£€æŸ¥ç©ºå€¼ç‡ null_checks = checker.check_nullity(\"gold.fact_orders\") # æ£€æŸ¥æ•°æ®èŒƒå›´ range_checks = checker.check_ranges(\"gold.fact_orders\", { \"total_amount\": (0, 1000000), \"order_count\": (0, 10000) }) # æ£€æŸ¥æ•°æ®å®Œæ•´æ€§ integrity_checks = checker.check_referential_integrity( \"gold.fact_orders\", {\"dim_products\": [\"product_id\"], \"dim_users\": [\"user_id\"]} ) # ç”Ÿæˆè´¨é‡æŠ¥å‘Š report = { \"null_checks\": null_checks, \"range_checks\": range_checks, \"integrity_checks\": integrity_checks, \"overall_score\": calculate_overall_score([ null_checks, range_checks, integrity_checks ]) } if report[\"overall_score\"] \u003c 0.9: raise Exception(f\"Data quality score too low: {report['overall_score']}\") return report def calculate_overall_score(checks): \"\"\"è®¡ç®—æ€»ä½“è´¨é‡åˆ†æ•°\"\"\" scores = [] for check in checks: if isinstance(check, dict): scores.append(check.get(\"score\", 1.0)) return sum(scores) / len(scores) if scores else 1.0 å®æˆ˜å»ºè®® å­˜å‚¨æˆæœ¬ä¼˜åŒ– 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 class StorageOptimizer: \"\"\"å­˜å‚¨ä¼˜åŒ–ç­–ç•¥\"\"\" def implement_tiered_storage(self): \"\"\" åˆ†å±‚å­˜å‚¨ç­–ç•¥ï¼š - çƒ­æ•°æ®ï¼šSSDï¼ˆæœ€è¿‘7å¤©ï¼‰ - æ¸©æ•°æ®ï¼šHDDï¼ˆ30å¤©ï¼‰ - å†·æ•°æ®ï¼šS3 Glacierï¼ˆå½’æ¡£ï¼‰ \"\"\" # ç”Ÿå‘½å‘¨æœŸç­–ç•¥ lifecycle_policy = { \"rules\": [ { \"id\": \"hot-to-warm\", \"transition\": { \"days\": 7, \"storage_class\": \"STANDARD_IA\" } }, { \"id\": \"warm-to-cold\", \"transition\": { \"days\": 30, \"storage_class\": \"GLACIER\" } }, { \"id\": \"expiration\", \"expiration\": { \"days\": 365 } } ] } return lifecycle_policy def implement_columnar_format(self): \"\"\" åˆ—å¼å­˜å‚¨ä¼˜åŒ– - Parquetï¼šå‹ç¼©ç‡é«˜ï¼ŒæŸ¥è¯¢å¿« - ORCï¼šé€‚åˆå¤æ‚ç±»å‹ - Avroï¼šé€‚åˆå†™å¯†é›† \"\"\" format_recommendations = { \"åˆ†ææŸ¥è¯¢\": \"parquet\", \"æµå¼å†™å…¥\": \"avro\", \"å¤æ‚åµŒå¥—\": \"orc\", \"è¯»å–å¯†é›†\": \"parquet\", \"å†™å…¥å¯†é›†\": \"avro\" } return format_recommendations æ€»ç»“ æ„å»ºç°ä»£æ•°æ®æ¹–çš„å…³é”®è¦ç´ ï¼š\nåˆ†å±‚æ¶æ„ï¼šBronze-Silver-Goldä¸‰å±‚è®¾è®¡ è¡¨æ ¼å¼é€‰æ‹©ï¼šDelta Lakeï¼ˆæ¨èï¼‰ã€Icebergã€Hudi åˆ†åŒºç­–ç•¥ï¼šåˆç†é€‰æ‹©åˆ†åŒºå­—æ®µå’Œç²’åº¦ æ–‡ä»¶ä¼˜åŒ–ï¼šæ§åˆ¶æ–‡ä»¶å¤§å°å’Œæ•°é‡ ACIDäº‹åŠ¡ï¼šæ”¯æŒæ›´æ–°å’Œåˆ é™¤æ“ä½œ Schemaæ¼”å˜ï¼šçµæ´»åº”å¯¹ä¸šåŠ¡å˜åŒ– æˆæœ¬ä¼˜åŒ–ï¼šåˆ†å±‚å­˜å‚¨å’Œç”Ÿå‘½å‘¨æœŸç®¡ç† æ•°æ®æ¹–ä¸æ˜¯æŠ€æœ¯å †ç Œï¼Œè€Œæ˜¯æœåŠ¡äºä¸šåŠ¡çš„æ™ºèƒ½åŒ–æ•°æ®å¹³å°ã€‚\n","wordCount":"1678","inLanguage":"zh-cn","datePublished":"2025-12-25T21:00:00+08:00","dateModified":"2025-12-25T21:00:00+08:00","author":{"@type":"Person","name":"æœ‰æ¡å·¥å…·å›¢é˜Ÿ"},"mainEntityOfPage":{"@type":"WebPage","@id":"/blog/articles/%E7%8E%B0%E4%BB%A3%E6%95%B0%E6%8D%AE%E6%B9%96%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E4%BB%8E%E5%AD%98%E5%82%A8%E5%88%B0%E5%88%86%E6%9E%90%E7%9A%84%E5%AE%8C%E6%95%B4%E6%96%B9%E6%A1%88/"},"publisher":{"@type":"Organization","name":"æŠ€æœ¯åšå®¢ - æœ‰æ¡å·¥å…·","logo":{"@type":"ImageObject","url":"/favicon.ico"}}}</script></head><body id=top><header class=header><nav class=nav><div class=logo><a href=/blog/ accesskey=h title="æŠ€æœ¯åšå®¢ - æœ‰æ¡å·¥å…· (Alt + H)">æŠ€æœ¯åšå®¢ - æœ‰æ¡å·¥å…·</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=/blog/posts/ title="æ‰€æœ‰æ–‡ç« åˆ—è¡¨ - æœ‰æ¡å·¥å…·æŠ€æœ¯åšå®¢ï¼šæŸ¥çœ‹æ‰€æœ‰æŠ€æœ¯æ–‡ç« å’Œæ•™ç¨‹å†…å®¹"><span>æ–‡ç« </span></a></li><li><a href=https://www.util.cn title="æœ‰æ¡å·¥å…· - å¼€å‘è€…çš„å¸¸ç”¨å·¥å…·é›†åˆï¼šæ— å¹¿å‘Š Â· æœ¬åœ°è®¡ç®— Â· å³å¼€å³ç”¨çš„åœ¨çº¿å·¥å…·å¹³å°ï¼Œæä¾›JSONæ ¼å¼åŒ–ã€SQLæ ¼å¼åŒ–ã€Markdownç¼–è¾‘å™¨ç­‰å®ç”¨å·¥å…·"><span>æœ‰æ¡å·¥å…·</span>&nbsp;
<svg fill="none" shape-rendering="geometricPrecision" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" height="12" width="12"><path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"/><path d="M15 3h6v6"/><path d="M10 14 21 3"/></svg></a></li><li><a href=/blog/categories/ title="æ–‡ç« åˆ†ç±» - æœ‰æ¡å·¥å…·æŠ€æœ¯åšå®¢ï¼šæŒ‰æŠ€æœ¯é¢†åŸŸåˆ†ç±»çš„ä¼˜è´¨æ–‡ç« ï¼ŒåŒ…æ‹¬å‰ç«¯å¼€å‘ã€å·¥å…·ä½¿ç”¨ã€ç¼–ç¨‹æŠ€å·§ç­‰"><span>åˆ†ç±»</span></a></li><li><a href=/blog/tags/ title="æ ‡ç­¾äº‘ - æœ‰æ¡å·¥å…·æŠ€æœ¯åšå®¢ï¼šé€šè¿‡æ ‡ç­¾å¿«é€Ÿæ‰¾åˆ°æ„Ÿå…´è¶£çš„æŠ€æœ¯æ–‡ç« å’Œæ•™ç¨‹å†…å®¹"><span>æ ‡ç­¾</span></a></li><li><a href=/blog/archives/ title="æ–‡ç« å½’æ¡£ - æœ‰æ¡å·¥å…·æŠ€æœ¯åšå®¢ï¼šæŒ‰æ—¶é—´æŸ¥çœ‹å†å²æ–‡ç« "><span>å½’æ¡£</span></a></li><li><a href=/blog/search/ title="æœç´¢æ–‡ç«  - æœ‰æ¡å·¥å…·æŠ€æœ¯åšå®¢ï¼šé€šè¿‡å…³é”®è¯æœç´¢æ‰¾åˆ°æ„Ÿå…´è¶£çš„æŠ€æœ¯æ–‡ç« å’Œæ•™ç¨‹å†…å®¹ï¼Œæ”¯æŒæ ‡é¢˜ã€å†…å®¹ã€åˆ†ç±»å’Œæ ‡ç­¾æœç´¢"><span>æœç´¢</span></a></li></ul></nav></header><main class=main><article class=post-single><div class=post-content-wrapper><main class=post-content-main><header class=post-header-main><h1 class="post-title entry-hint-parent">ç°ä»£æ•°æ®æ¹–æ¶æ„è®¾è®¡ï¼šä»å­˜å‚¨åˆ°åˆ†æçš„å®Œæ•´æ–¹æ¡ˆ</h1><div class=post-meta><div class=post-meta-content><div class=post-categories-inline><a href=/blog/categories/%E5%90%8E%E7%AB%AF%E5%BC%80%E5%8F%91/ class=category-link>åç«¯å¼€å‘</a></div><span class=post-date>2025-12-25</span><span class=post-author>æœ‰æ¡å·¥å…·å›¢é˜Ÿ</span></div><style>.post-meta-content{display:flex;align-items:center;flex-wrap:wrap;gap:.75rem;font-family:sf mono,monaco,courier new,monospace;font-size:.875rem;color:#9ca3af !important}.post-categories-inline{display:inline-flex;align-items:center;gap:.5rem}.category-link{display:inline-flex;align-items:center;gap:.25rem;padding:.25rem .75rem;background:rgba(255,255,255,.1);color:#e5e7eb !important;text-decoration:none;font-size:.75rem;font-weight:600;text-transform:uppercase;letter-spacing:.05em;border:1px solid rgba(255,255,255,.2);border-radius:0;transition:all .3s ease;white-space:nowrap}.category-link:hover{background:rgba(255,255,255,.2);color:#fff !important;border-color:rgba(255,255,255,.3);transform:translateY(-1px)}.category-link::before{content:'ğŸ“';font-size:.7rem;opacity:.8}.post-date,.post-reading-time,.post-word-count,.post-author{color:#9ca3af !important}[data-theme=dark] .post-meta-content{color:#9ca3af !important}[data-theme=dark] .category-link{background:rgba(255,255,255,.1);color:#e5e7eb !important;border-color:rgba(255,255,255,.2)}[data-theme=dark] .category-link:hover{background:rgba(255,255,255,.2);color:#fff !important;border-color:rgba(255,255,255,.3)}[data-theme=dark] .post-date,[data-theme=dark] .post-reading-time,[data-theme=dark] .post-word-count,[data-theme=dark] .post-author{color:#9ca3af !important}[data-theme=light] .post-meta-content{color:#6c757d !important}[data-theme=light] .category-link{background:rgba(0,0,0,5%);color:#495057 !important;border-color:rgba(0,0,0,.15)}[data-theme=light] .category-link:hover{background:rgba(0,102,204,.1);color:#212529 !important;border-color:rgba(0,102,204,.3)}[data-theme=light] .post-date,[data-theme=light] .post-reading-time,[data-theme=light] .post-word-count,[data-theme=light] .post-author{color:#6c757d !important}@media(max-width:768px){.post-meta-content{gap:.5rem;font-size:.8rem}.category-link{padding:.2rem .6rem;font-size:.7rem}}</style></div></header><div class=post-content><p>æ•°æ®æ¹–å·²æˆä¸ºç°ä»£æ•°æ®æ¶æ„çš„æ ¸å¿ƒç»„ä»¶ã€‚ä¸ä¼ ç»Ÿçš„æ•°æ®ä»“åº“ä¸åŒï¼Œæ•°æ®æ¹–å¯ä»¥å­˜å‚¨ä»»ä½•æ ¼å¼ã€ä»»ä½•è§„æ¨¡çš„æ•°æ®ï¼Œä¸ºæ•°æ®åˆ†æå’Œæœºå™¨å­¦ä¹ æä¾›å¼ºå¤§æ”¯æŒã€‚</p><h2 id=æ•°æ®æ¹–-vs-æ•°æ®ä»“åº“>æ•°æ®æ¹– vs æ•°æ®ä»“åº“<a hidden class=anchor aria-hidden=true href=#æ•°æ®æ¹–-vs-æ•°æ®ä»“åº“>#</a></h2><pre tabindex=0><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     ç‰¹æ€§       â”‚    æ•°æ®ä»“åº“    â”‚    æ•°æ®æ¹–      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ æ•°æ®ç»“æ„       â”‚ ç»“æ„åŒ–(é¢„å®šä¹‰) â”‚ ä»»æ„æ ¼å¼       â”‚
â”‚ Schema         â”‚ Schema on Writeâ”‚ Schema on Read â”‚
â”‚ å­˜å‚¨æˆæœ¬       â”‚ é«˜            â”‚ ä½            â”‚
â”‚ çµæ´»æ€§         â”‚ ä½            â”‚ é«˜            â”‚
â”‚ é€‚ç”¨åœºæ™¯       â”‚ æŠ¥è¡¨ã€BI      â”‚ MLã€æ¢ç´¢åˆ†æ   â”‚
â”‚ æ•°æ®è´¨é‡       â”‚ é«˜            â”‚ å¯å˜          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre><h2 id=æ•°æ®æ¹–åˆ†å±‚æ¶æ„>æ•°æ®æ¹–åˆ†å±‚æ¶æ„<a hidden class=anchor aria-hidden=true href=#æ•°æ®æ¹–åˆ†å±‚æ¶æ„>#</a></h2><h3 id=bronzesilvergold-åˆ†å±‚>Bronze/Silver/Gold åˆ†å±‚<a hidden class=anchor aria-hidden=true href=#bronzesilvergold-åˆ†å±‚>#</a></h3><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 56
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 57
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 58
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 59
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 60
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 61
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 62
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 63
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 64
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 65
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 66
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 67
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 68
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 69
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 70
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 71
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 72
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 73
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 74
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 75
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 76
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 77
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 78
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 79
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 80
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 81
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 82
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 83
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 84
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 85
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 86
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 87
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 88
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 89
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 90
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 91
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 92
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 93
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 94
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 95
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 96
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 97
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 98
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 99
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">100
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">101
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">102
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">103
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">104
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">105
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">106
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">107
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">108
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">109
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">110
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">111
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">112
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">113
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">114
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">115
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">116
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">117
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">118
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">119
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">120
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">121
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">122
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">123
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">124
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">125
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">126
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">127
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">128
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">129
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">130
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">131
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">132
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">133
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">134
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">135
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">136
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">137
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">138
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">139
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">140
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">141
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">142
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">143
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">144
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">145
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">146
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">147
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">148
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">149
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">150
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">151
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">152
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">153
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">154
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">155
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">156
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">157
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">158
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">159
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">160
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">161
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">162
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">163
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">164
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">165
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">166
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">167
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">168
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">169
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">170
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">171
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">172
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">173
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">174
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">175
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">176
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">177
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">178
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">179
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">180
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#8b949e;font-style:italic># Delta Lakeæ•°æ®æ¹–å®ç°</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>from</span> <span style=color:#ff7b72>delta</span> <span style=color:#ff7b72>import</span> DeltaTable
</span></span><span style=display:flex><span><span style=color:#ff7b72>from</span> <span style=color:#ff7b72>pyspark.sql</span> <span style=color:#ff7b72>import</span> SparkSession
</span></span><span style=display:flex><span><span style=color:#ff7b72>from</span> <span style=color:#ff7b72>pyspark.sql.functions</span> <span style=color:#ff7b72>import</span> <span style=color:#ff7b72;font-weight:700>*</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>class</span> <span style=color:#f0883e;font-weight:700>DataLakeBuilder</span>:
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>__init__</span>(self, spark: SparkSession, base_path: str):
</span></span><span style=display:flex><span>        self<span style=color:#ff7b72;font-weight:700>.</span>spark <span style=color:#ff7b72;font-weight:700>=</span> spark
</span></span><span style=display:flex><span>        self<span style=color:#ff7b72;font-weight:700>.</span>base_path <span style=color:#ff7b72;font-weight:700>=</span> base_path
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>build_bronze_layer</span>(self, source_system: str):
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;&#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>        Bronzeå±‚ï¼šåŸå§‹æ•°æ®å±‚
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>        - ä¿æŒåŸå§‹æ ¼å¼
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>        - ä¸åšä»»ä½•è½¬æ¢
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>        - ç”¨äºå®¡è®¡å’Œé‡æ”¾
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>        &#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>        bronze_path <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#79c0ff>f</span><span style=color:#a5d6ff>&#34;</span><span style=color:#a5d6ff>{</span>self<span style=color:#ff7b72;font-weight:700>.</span>base_path<span style=color:#a5d6ff>}</span><span style=color:#a5d6ff>/bronze/</span><span style=color:#a5d6ff>{</span>source_system<span style=color:#a5d6ff>}</span><span style=color:#a5d6ff>&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># è¯»å–åŸå§‹æ•°æ®</span>
</span></span><span style=display:flex><span>        df <span style=color:#ff7b72;font-weight:700>=</span> (self<span style=color:#ff7b72;font-weight:700>.</span>spark<span style=color:#ff7b72;font-weight:700>.</span>read
</span></span><span style=display:flex><span>            <span style=color:#ff7b72;font-weight:700>.</span>format(<span style=color:#a5d6ff>&#34;kafka&#34;</span>)
</span></span><span style=display:flex><span>            <span style=color:#ff7b72;font-weight:700>.</span>option(<span style=color:#a5d6ff>&#34;kafka.bootstrap.servers&#34;</span>, <span style=color:#a5d6ff>&#34;localhost:9092&#34;</span>)
</span></span><span style=display:flex><span>            <span style=color:#ff7b72;font-weight:700>.</span>option(<span style=color:#a5d6ff>&#34;subscribe&#34;</span>, source_system)
</span></span><span style=display:flex><span>            <span style=color:#ff7b72;font-weight:700>.</span>option(<span style=color:#a5d6ff>&#34;startingOffsets&#34;</span>, <span style=color:#a5d6ff>&#34;latest&#34;</span>)
</span></span><span style=display:flex><span>            <span style=color:#ff7b72;font-weight:700>.</span>load())
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># å†™å…¥Bronzeå±‚</span>
</span></span><span style=display:flex><span>        (df<span style=color:#ff7b72;font-weight:700>.</span>write
</span></span><span style=display:flex><span>            <span style=color:#ff7b72;font-weight:700>.</span>format(<span style=color:#a5d6ff>&#34;delta&#34;</span>)
</span></span><span style=display:flex><span>            <span style=color:#ff7b72;font-weight:700>.</span>mode(<span style=color:#a5d6ff>&#34;append&#34;</span>)
</span></span><span style=display:flex><span>            <span style=color:#ff7b72;font-weight:700>.</span>option(<span style=color:#a5d6ff>&#34;mergeSchema&#34;</span>, <span style=color:#a5d6ff>&#34;true&#34;</span>)
</span></span><span style=display:flex><span>            <span style=color:#ff7b72;font-weight:700>.</span>partitionBy(<span style=color:#a5d6ff>&#34;year&#34;</span>, <span style=color:#a5d6ff>&#34;month&#34;</span>, <span style=color:#a5d6ff>&#34;day&#34;</span>)
</span></span><span style=display:flex><span>            <span style=color:#ff7b72;font-weight:700>.</span>save(bronze_path))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>return</span> bronze_path
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>build_silver_layer</span>(self, source_system: str):
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;&#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>        Silverå±‚ï¼šæ¸…æ´—å’Œæ ‡å‡†åŒ–å±‚
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>        - æ•°æ®æ¸…æ´—
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>        - Schemaæ ‡å‡†åŒ–
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>        - æ•°æ®è´¨é‡æ£€æŸ¥
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>        - å»é‡å’Œå…³è”
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>        &#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>        bronze_path <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#79c0ff>f</span><span style=color:#a5d6ff>&#34;</span><span style=color:#a5d6ff>{</span>self<span style=color:#ff7b72;font-weight:700>.</span>base_path<span style=color:#a5d6ff>}</span><span style=color:#a5d6ff>/bronze/</span><span style=color:#a5d6ff>{</span>source_system<span style=color:#a5d6ff>}</span><span style=color:#a5d6ff>&#34;</span>
</span></span><span style=display:flex><span>        silver_path <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#79c0ff>f</span><span style=color:#a5d6ff>&#34;</span><span style=color:#a5d6ff>{</span>self<span style=color:#ff7b72;font-weight:700>.</span>base_path<span style=color:#a5d6ff>}</span><span style=color:#a5d6ff>/silver/</span><span style=color:#a5d6ff>{</span>source_system<span style=color:#a5d6ff>}</span><span style=color:#a5d6ff>&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># è¯»å–Bronzeå±‚æ•°æ®</span>
</span></span><span style=display:flex><span>        bronze_df <span style=color:#ff7b72;font-weight:700>=</span> (self<span style=color:#ff7b72;font-weight:700>.</span>spark<span style=color:#ff7b72;font-weight:700>.</span>read
</span></span><span style=display:flex><span>            <span style=color:#ff7b72;font-weight:700>.</span>format(<span style=color:#a5d6ff>&#34;delta&#34;</span>)
</span></span><span style=display:flex><span>            <span style=color:#ff7b72;font-weight:700>.</span>load(bronze_path))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># æ•°æ®æ¸…æ´—å’Œè½¬æ¢</span>
</span></span><span style=display:flex><span>        silver_df <span style=color:#ff7b72;font-weight:700>=</span> (bronze_df
</span></span><span style=display:flex><span>            <span style=color:#ff7b72;font-weight:700>.</span>filter(col(<span style=color:#a5d6ff>&#34;value&#34;</span>)<span style=color:#ff7b72;font-weight:700>.</span>isNotNull())
</span></span><span style=display:flex><span>            <span style=color:#ff7b72;font-weight:700>.</span>withColumn(<span style=color:#a5d6ff>&#34;data&#34;</span>, from_json(col(<span style=color:#a5d6ff>&#34;value&#34;</span>), schema_string))
</span></span><span style=display:flex><span>            <span style=color:#ff7b72;font-weight:700>.</span>select(
</span></span><span style=display:flex><span>                col(<span style=color:#a5d6ff>&#34;timestamp&#34;</span>)<span style=color:#ff7b72;font-weight:700>.</span>cast(<span style=color:#a5d6ff>&#34;timestamp&#34;</span>),
</span></span><span style=display:flex><span>                col(<span style=color:#a5d6ff>&#34;data.*&#34;</span>)
</span></span><span style=display:flex><span>            )
</span></span><span style=display:flex><span>            <span style=color:#ff7b72;font-weight:700>.</span>withWatermark(<span style=color:#a5d6ff>&#34;timestamp&#34;</span>, <span style=color:#a5d6ff>&#34;10 minutes&#34;</span>)
</span></span><span style=display:flex><span>            <span style=color:#ff7b72;font-weight:700>.</span>dropDuplicates([<span style=color:#a5d6ff>&#34;id&#34;</span>, <span style=color:#a5d6ff>&#34;timestamp&#34;</span>]))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># æ•°æ®è´¨é‡æ£€æŸ¥</span>
</span></span><span style=display:flex><span>        quality_checks <span style=color:#ff7b72;font-weight:700>=</span> self<span style=color:#ff7b72;font-weight:700>.</span>run_data_quality_checks(silver_df)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>if</span> quality_checks[<span style=color:#a5d6ff>&#34;passed_rate&#34;</span>] <span style=color:#ff7b72;font-weight:700>&lt;</span> <span style=color:#a5d6ff>0.95</span>:
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>raise</span> <span style=color:#f0883e;font-weight:700>Exception</span>(<span style=color:#a5d6ff>&#34;Data quality check failed&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># å†™å…¥Silverå±‚ï¼ˆæ”¯æŒUPSERTï¼‰</span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>from</span> <span style=color:#ff7b72>delta.tables</span> <span style=color:#ff7b72>import</span> DeltaTable
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>if</span> DeltaTable<span style=color:#ff7b72;font-weight:700>.</span>isDeltaTable(self<span style=color:#ff7b72;font-weight:700>.</span>spark, silver_path):
</span></span><span style=display:flex><span>            <span style=color:#8b949e;font-style:italic># MERGEæ“ä½œï¼ˆCDCæ”¯æŒï¼‰</span>
</span></span><span style=display:flex><span>            (DeltaTable<span style=color:#ff7b72;font-weight:700>.</span>forPath(self<span style=color:#ff7b72;font-weight:700>.</span>spark, silver_path)
</span></span><span style=display:flex><span>                <span style=color:#ff7b72;font-weight:700>.</span>alias(<span style=color:#a5d6ff>&#34;target&#34;</span>)
</span></span><span style=display:flex><span>                <span style=color:#ff7b72;font-weight:700>.</span>merge(
</span></span><span style=display:flex><span>                    silver_df<span style=color:#ff7b72;font-weight:700>.</span>alias(<span style=color:#a5d6ff>&#34;source&#34;</span>),
</span></span><span style=display:flex><span>                    <span style=color:#a5d6ff>&#34;target.id = source.id AND target.timestamp &lt; source.timestamp&#34;</span>
</span></span><span style=display:flex><span>                )
</span></span><span style=display:flex><span>                <span style=color:#ff7b72;font-weight:700>.</span>whenMatchedUpdateAll()
</span></span><span style=display:flex><span>                <span style=color:#ff7b72;font-weight:700>.</span>whenNotMatchedInsertAll()
</span></span><span style=display:flex><span>                <span style=color:#ff7b72;font-weight:700>.</span>execute())
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>else</span>:
</span></span><span style=display:flex><span>            <span style=color:#8b949e;font-style:italic># é¦–æ¬¡å†™å…¥</span>
</span></span><span style=display:flex><span>            (silver_df<span style=color:#ff7b72;font-weight:700>.</span>write
</span></span><span style=display:flex><span>                <span style=color:#ff7b72;font-weight:700>.</span>format(<span style=color:#a5d6ff>&#34;delta&#34;</span>)
</span></span><span style=display:flex><span>                <span style=color:#ff7b72;font-weight:700>.</span>mode(<span style=color:#a5d6ff>&#34;overwrite&#34;</span>)
</span></span><span style=display:flex><span>                <span style=color:#ff7b72;font-weight:700>.</span>partitionBy(<span style=color:#a5d6ff>&#34;year&#34;</span>, <span style=color:#a5d6ff>&#34;month&#34;</span>, <span style=color:#a5d6ff>&#34;day&#34;</span>)
</span></span><span style=display:flex><span>                <span style=color:#ff7b72;font-weight:700>.</span>save(silver_path))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>return</span> silver_path
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>build_gold_layer</span>(self, business_domain: str):
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;&#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>        Goldå±‚ï¼šä¸šåŠ¡èšåˆå±‚
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>        - æ˜Ÿå‹æ¨¡å‹
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>        - èšåˆæŒ‡æ ‡
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>        - ä¼˜åŒ–æŸ¥è¯¢æ€§èƒ½
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>        - ç›´æ¥æœåŠ¡äºBIå’ŒML
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>        &#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>        silver_path <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#79c0ff>f</span><span style=color:#a5d6ff>&#34;</span><span style=color:#a5d6ff>{</span>self<span style=color:#ff7b72;font-weight:700>.</span>base_path<span style=color:#a5d6ff>}</span><span style=color:#a5d6ff>/silver/</span><span style=color:#a5d6ff>{</span>business_domain<span style=color:#a5d6ff>}</span><span style=color:#a5d6ff>&#34;</span>
</span></span><span style=display:flex><span>        gold_path <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#79c0ff>f</span><span style=color:#a5d6ff>&#34;</span><span style=color:#a5d6ff>{</span>self<span style=color:#ff7b72;font-weight:700>.</span>base_path<span style=color:#a5d6ff>}</span><span style=color:#a5d6ff>/gold/</span><span style=color:#a5d6ff>{</span>business_domain<span style=color:#a5d6ff>}</span><span style=color:#a5d6ff>&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># è¯»å–Silverå±‚æ•°æ®</span>
</span></span><span style=display:flex><span>        silver_dfs <span style=color:#ff7b72;font-weight:700>=</span> {}
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>for</span> entity <span style=color:#ff7b72;font-weight:700>in</span> [<span style=color:#a5d6ff>&#34;users&#34;</span>, <span style=color:#a5d6ff>&#34;orders&#34;</span>, <span style=color:#a5d6ff>&#34;products&#34;</span>]:
</span></span><span style=display:flex><span>            path <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#79c0ff>f</span><span style=color:#a5d6ff>&#34;</span><span style=color:#a5d6ff>{</span>silver_path<span style=color:#a5d6ff>}</span><span style=color:#a5d6ff>/</span><span style=color:#a5d6ff>{</span>entity<span style=color:#a5d6ff>}</span><span style=color:#a5d6ff>&#34;</span>
</span></span><span style=display:flex><span>            silver_dfs[entity] <span style=color:#ff7b72;font-weight:700>=</span> (self<span style=color:#ff7b72;font-weight:700>.</span>spark<span style=color:#ff7b72;font-weight:700>.</span>read
</span></span><span style=display:flex><span>                <span style=color:#ff7b72;font-weight:700>.</span>format(<span style=color:#a5d6ff>&#34;delta&#34;</span>)
</span></span><span style=display:flex><span>                <span style=color:#ff7b72;font-weight:700>.</span>load(path))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># æ„å»ºæ˜Ÿå‹æ¨¡å‹</span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># äº‹å®è¡¨</span>
</span></span><span style=display:flex><span>        fact_orders <span style=color:#ff7b72;font-weight:700>=</span> (silver_dfs[<span style=color:#a5d6ff>&#34;orders&#34;</span>]
</span></span><span style=display:flex><span>            <span style=color:#ff7b72;font-weight:700>.</span>groupBy(<span style=color:#a5d6ff>&#34;date&#34;</span>, <span style=color:#a5d6ff>&#34;product_id&#34;</span>, <span style=color:#a5d6ff>&#34;user_id&#34;</span>)
</span></span><span style=display:flex><span>            <span style=color:#ff7b72;font-weight:700>.</span>agg(
</span></span><span style=display:flex><span>                sum(<span style=color:#a5d6ff>&#34;amount&#34;</span>)<span style=color:#ff7b72;font-weight:700>.</span>alias(<span style=color:#a5d6ff>&#34;total_amount&#34;</span>),
</span></span><span style=display:flex><span>                count(<span style=color:#a5d6ff>&#34;*&#34;</span>)<span style=color:#ff7b72;font-weight:700>.</span>alias(<span style=color:#a5d6ff>&#34;order_count&#34;</span>),
</span></span><span style=display:flex><span>                avg(<span style=color:#a5d6ff>&#34;amount&#34;</span>)<span style=color:#ff7b72;font-weight:700>.</span>alias(<span style=color:#a5d6ff>&#34;avg_order_value&#34;</span>)
</span></span><span style=display:flex><span>            ))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># ç»´åº¦è¡¨</span>
</span></span><span style=display:flex><span>        dim_products <span style=color:#ff7b72;font-weight:700>=</span> silver_dfs[<span style=color:#a5d6ff>&#34;products&#34;</span>]<span style=color:#ff7b72;font-weight:700>.</span>select(
</span></span><span style=display:flex><span>            <span style=color:#a5d6ff>&#34;product_id&#34;</span>, <span style=color:#a5d6ff>&#34;name&#34;</span>, <span style=color:#a5d6ff>&#34;category&#34;</span>, <span style=color:#a5d6ff>&#34;brand&#34;</span>
</span></span><span style=display:flex><span>        )<span style=color:#ff7b72;font-weight:700>.</span>distinct()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        dim_users <span style=color:#ff7b72;font-weight:700>=</span> silver_dfs[<span style=color:#a5d6ff>&#34;users&#34;</span>]<span style=color:#ff7b72;font-weight:700>.</span>select(
</span></span><span style=display:flex><span>            <span style=color:#a5d6ff>&#34;user_id&#34;</span>, <span style=color:#a5d6ff>&#34;name&#34;</span>, <span style=color:#a5d6ff>&#34;email&#34;</span>, <span style=color:#a5d6ff>&#34;segment&#34;</span>
</span></span><span style=display:flex><span>        )<span style=color:#ff7b72;font-weight:700>.</span>distinct()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># å†™å…¥Goldå±‚</span>
</span></span><span style=display:flex><span>        (fact_orders<span style=color:#ff7b72;font-weight:700>.</span>write
</span></span><span style=display:flex><span>            <span style=color:#ff7b72;font-weight:700>.</span>format(<span style=color:#a5d6ff>&#34;delta&#34;</span>)
</span></span><span style=display:flex><span>            <span style=color:#ff7b72;font-weight:700>.</span>mode(<span style=color:#a5d6ff>&#34;overwrite&#34;</span>)
</span></span><span style=display:flex><span>            <span style=color:#ff7b72;font-weight:700>.</span>partitionBy(<span style=color:#a5d6ff>&#34;date&#34;</span>)
</span></span><span style=display:flex><span>            <span style=color:#ff7b72;font-weight:700>.</span>save(<span style=color:#79c0ff>f</span><span style=color:#a5d6ff>&#34;</span><span style=color:#a5d6ff>{</span>gold_path<span style=color:#a5d6ff>}</span><span style=color:#a5d6ff>/fact_orders&#34;</span>))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        (dim_products<span style=color:#ff7b72;font-weight:700>.</span>write
</span></span><span style=display:flex><span>            <span style=color:#ff7b72;font-weight:700>.</span>format(<span style=color:#a5d6ff>&#34;delta&#34;</span>)
</span></span><span style=display:flex><span>            <span style=color:#ff7b72;font-weight:700>.</span>mode(<span style=color:#a5d6ff>&#34;overwrite&#34;</span>)
</span></span><span style=display:flex><span>            <span style=color:#ff7b72;font-weight:700>.</span>save(<span style=color:#79c0ff>f</span><span style=color:#a5d6ff>&#34;</span><span style=color:#a5d6ff>{</span>gold_path<span style=color:#a5d6ff>}</span><span style=color:#a5d6ff>/dim_products&#34;</span>))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        (dim_users<span style=color:#ff7b72;font-weight:700>.</span>write
</span></span><span style=display:flex><span>            <span style=color:#ff7b72;font-weight:700>.</span>format(<span style=color:#a5d6ff>&#34;delta&#34;</span>)
</span></span><span style=display:flex><span>            <span style=color:#ff7b72;font-weight:700>.</span>mode(<span style=color:#a5d6ff>&#34;overwrite&#34;</span>)
</span></span><span style=display:flex><span>            <span style=color:#ff7b72;font-weight:700>.</span>save(<span style=color:#79c0ff>f</span><span style=color:#a5d6ff>&#34;</span><span style=color:#a5d6ff>{</span>gold_path<span style=color:#a5d6ff>}</span><span style=color:#a5d6ff>/dim_users&#34;</span>))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># åˆ›å»ºä¼˜åŒ–è§†å›¾</span>
</span></span><span style=display:flex><span>        self<span style=color:#ff7b72;font-weight:700>.</span>create_optimized_views(gold_path)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>return</span> gold_path
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>run_data_quality_checks</span>(self, df):
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;&#34;&#34;æ•°æ®è´¨é‡æ£€æŸ¥&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>        total <span style=color:#ff7b72;font-weight:700>=</span> df<span style=color:#ff7b72;font-weight:700>.</span>count()
</span></span><span style=display:flex><span>        not_null <span style=color:#ff7b72;font-weight:700>=</span> df<span style=color:#ff7b72;font-weight:700>.</span>filter(col(<span style=color:#a5d6ff>&#34;id&#34;</span>)<span style=color:#ff7b72;font-weight:700>.</span>isNotNull())<span style=color:#ff7b72;font-weight:700>.</span>count()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>return</span> {
</span></span><span style=display:flex><span>            <span style=color:#a5d6ff>&#34;total_records&#34;</span>: total,
</span></span><span style=display:flex><span>            <span style=color:#a5d6ff>&#34;not_null_records&#34;</span>: not_null,
</span></span><span style=display:flex><span>            <span style=color:#a5d6ff>&#34;null_rate&#34;</span>: <span style=color:#a5d6ff>1</span> <span style=color:#ff7b72;font-weight:700>-</span> (not_null <span style=color:#ff7b72;font-weight:700>/</span> total),
</span></span><span style=display:flex><span>            <span style=color:#a5d6ff>&#34;passed_rate&#34;</span>: not_null <span style=color:#ff7b72;font-weight:700>/</span> total
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>create_optimized_views</span>(self, gold_path: str):
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;&#34;&#34;åˆ›å»ºä¼˜åŒ–è§†å›¾ï¼ŒåŠ é€ŸæŸ¥è¯¢&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># åˆ›å»ºZ-ORDERç´¢å¼•</span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>for</span> table <span style=color:#ff7b72;font-weight:700>in</span> [<span style=color:#a5d6ff>&#34;fact_orders&#34;</span>, <span style=color:#a5d6ff>&#34;dim_products&#34;</span>, <span style=color:#a5d6ff>&#34;dim_users&#34;</span>]:
</span></span><span style=display:flex><span>            table_path <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#79c0ff>f</span><span style=color:#a5d6ff>&#34;</span><span style=color:#a5d6ff>{</span>gold_path<span style=color:#a5d6ff>}</span><span style=color:#a5d6ff>/</span><span style=color:#a5d6ff>{</span>table<span style=color:#a5d6ff>}</span><span style=color:#a5d6ff>&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            (DeltaTable<span style=color:#ff7b72;font-weight:700>.</span>forPath(self<span style=color:#ff7b72;font-weight:700>.</span>spark, table_path)
</span></span><span style=display:flex><span>                <span style=color:#ff7b72;font-weight:700>.</span>optimize()
</span></span><span style=display:flex><span>                <span style=color:#ff7b72;font-weight:700>.</span>executeZOrderBy(<span style=color:#a5d6ff>&#34;date&#34;</span>))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#8b949e;font-style:italic># ä¼˜åŒ–æ•°æ®æ–‡ä»¶</span>
</span></span><span style=display:flex><span>            (DeltaTable<span style=color:#ff7b72;font-weight:700>.</span>forPath(self<span style=color:#ff7b72;font-weight:700>.</span>spark, table_path)
</span></span><span style=display:flex><span>                <span style=color:#ff7b72;font-weight:700>.</span>optimize()
</span></span><span style=display:flex><span>                <span style=color:#ff7b72;font-weight:700>.</span>executeCompaction())
</span></span></code></pre></td></tr></table></div></div><h2 id=è¡¨æ ¼å¼å¯¹æ¯”>è¡¨æ ¼å¼å¯¹æ¯”<a hidden class=anchor aria-hidden=true href=#è¡¨æ ¼å¼å¯¹æ¯”>#</a></h2><h3 id=delta-lake-vs-iceberg-vs-hudi>Delta Lake vs Iceberg vs Hudi<a hidden class=anchor aria-hidden=true href=#delta-lake-vs-iceberg-vs-hudi>#</a></h3><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 56
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 57
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 58
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 59
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 60
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 61
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 62
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 63
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 64
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 65
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 66
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 67
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 68
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 69
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 70
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 71
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 72
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 73
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 74
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 75
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 76
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 77
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 78
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 79
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 80
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 81
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 82
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 83
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 84
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 85
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 86
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 87
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 88
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 89
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 90
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 91
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 92
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 93
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 94
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 95
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 96
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 97
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 98
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 99
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">100
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">101
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">102
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">103
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">104
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">105
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">106
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">107
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">108
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">109
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">110
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">111
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">112
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">113
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">114
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">115
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">116
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">117
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">118
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">119
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">120
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#8b949e;font-style:italic># è¡¨æ ¼å¼å¯¹æ¯”</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>class</span> <span style=color:#f0883e;font-weight:700>TableFormatComparison</span>:
</span></span><span style=display:flex><span>    <span style=color:#a5d6ff>&#34;&#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>    åŠŸèƒ½å¯¹æ¯”è¡¨ï¼š
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>    â”‚    ç‰¹æ€§      â”‚ Delta Lake â”‚  Iceberg â”‚   Hudi   â”‚
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>    â”‚ ACIDäº‹åŠ¡     â”‚     âœ“      â”‚    âœ“     â”‚    âœ“     â”‚
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>    â”‚ Schemaæ¼”å˜   â”‚     âœ“      â”‚    âœ“     â”‚    âœ“     â”‚
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>    â”‚ Time Travel  â”‚     âœ“      â”‚    âœ“     â”‚    âœ“     â”‚
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>    â”‚ DELETEæ”¯æŒ   â”‚     âœ“      â”‚    âœ“     â”‚    âœ“     â”‚
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>    â”‚ UPDATEæ”¯æŒ   â”‚     âœ“      â”‚    âœ“     â”‚    âœ“     â”‚
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>    â”‚ Sparké›†æˆ    â”‚   ä¼˜ç§€     â”‚   è‰¯å¥½    â”‚   è‰¯å¥½    â”‚
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>    â”‚ ç¤¾åŒºæ´»è·ƒåº¦    â”‚   éå¸¸é«˜   â”‚    é«˜     â”‚    ä¸­     â”‚
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>    â”‚ å­¦ä¹ æ›²çº¿      â”‚   å¹³ç¼“     â”‚   é™¡å³­    â”‚   é™¡å³­    â”‚
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>    &#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>delta_lake_example</span>(self):
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;&#34;&#34;Delta Lakeç¤ºä¾‹&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>from</span> <span style=color:#ff7b72>delta</span> <span style=color:#ff7b72>import</span> <span style=color:#ff7b72;font-weight:700>*</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># åˆ›å»ºè¡¨</span>
</span></span><span style=display:flex><span>        data <span style=color:#ff7b72;font-weight:700>=</span> spark<span style=color:#ff7b72;font-weight:700>.</span>range(<span style=color:#a5d6ff>0</span>, <span style=color:#a5d6ff>1000</span>)
</span></span><span style=display:flex><span>        data<span style=color:#ff7b72;font-weight:700>.</span>write<span style=color:#ff7b72;font-weight:700>.</span>format(<span style=color:#a5d6ff>&#34;delta&#34;</span>)<span style=color:#ff7b72;font-weight:700>.</span>save(<span style=color:#a5d6ff>&#34;/tmp/delta-table&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># æ—¶é—´æ—…è¡ŒæŸ¥è¯¢</span>
</span></span><span style=display:flex><span>        df_old <span style=color:#ff7b72;font-weight:700>=</span> (spark<span style=color:#ff7b72;font-weight:700>.</span>read
</span></span><span style=display:flex><span>            <span style=color:#ff7b72;font-weight:700>.</span>format(<span style=color:#a5d6ff>&#34;delta&#34;</span>)
</span></span><span style=display:flex><span>            <span style=color:#ff7b72;font-weight:700>.</span>option(<span style=color:#a5d6ff>&#34;timestampAsOf&#34;</span>, <span style=color:#a5d6ff>&#34;2024-01-01&#34;</span>)
</span></span><span style=display:flex><span>            <span style=color:#ff7b72;font-weight:700>.</span>load(<span style=color:#a5d6ff>&#34;/tmp/delta-table&#34;</span>))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># æ›´æ–°æ“ä½œ</span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>from</span> <span style=color:#ff7b72>delta.tables</span> <span style=color:#ff7b72>import</span> DeltaTable
</span></span><span style=display:flex><span>        deltaTable <span style=color:#ff7b72;font-weight:700>=</span> DeltaTable<span style=color:#ff7b72;font-weight:700>.</span>forPath(spark, <span style=color:#a5d6ff>&#34;/tmp/delta-table&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        (deltaTable
</span></span><span style=display:flex><span>            <span style=color:#ff7b72;font-weight:700>.</span>update(<span style=color:#a5d6ff>&#34;id % 2 == 0&#34;</span>)
</span></span><span style=display:flex><span>            <span style=color:#ff7b72;font-weight:700>.</span>set(<span style=color:#a5d6ff>&#34;id&#34;</span>, col(<span style=color:#a5d6ff>&#34;id&#34;</span>) <span style=color:#ff7b72;font-weight:700>+</span> <span style=color:#a5d6ff>1000</span>))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># åˆ é™¤æ“ä½œ</span>
</span></span><span style=display:flex><span>        (deltaTable
</span></span><span style=display:flex><span>            <span style=color:#ff7b72;font-weight:700>.</span>delete(<span style=color:#a5d6ff>&#34;id &gt; 500&#34;</span>))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># åˆå¹¶æ“ä½œï¼ˆCDCï¼‰</span>
</span></span><span style=display:flex><span>        new_data <span style=color:#ff7b72;font-weight:700>=</span> spark<span style=color:#ff7b72;font-weight:700>.</span>range(<span style=color:#a5d6ff>1000</span>, <span style=color:#a5d6ff>1500</span>)
</span></span><span style=display:flex><span>        (deltaTable
</span></span><span style=display:flex><span>            <span style=color:#ff7b72;font-weight:700>.</span>alias(<span style=color:#a5d6ff>&#34;old&#34;</span>)
</span></span><span style=display:flex><span>            <span style=color:#ff7b72;font-weight:700>.</span>merge(
</span></span><span style=display:flex><span>                new_data<span style=color:#ff7b72;font-weight:700>.</span>alias(<span style=color:#a5d6ff>&#34;new&#34;</span>),
</span></span><span style=display:flex><span>                <span style=color:#a5d6ff>&#34;old.id = new.id&#34;</span>
</span></span><span style=display:flex><span>            )
</span></span><span style=display:flex><span>            <span style=color:#ff7b72;font-weight:700>.</span>whenMatchedUpdateAll()
</span></span><span style=display:flex><span>            <span style=color:#ff7b72;font-weight:700>.</span>whenNotMatchedInsertAll()
</span></span><span style=display:flex><span>            <span style=color:#ff7b72;font-weight:700>.</span>execute())
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>iceberg_example</span>(self):
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;&#34;&#34;Apache Icebergç¤ºä¾‹&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># åˆ›å»ºIcebergè¡¨</span>
</span></span><span style=display:flex><span>        spark<span style=color:#ff7b72;font-weight:700>.</span>sql(<span style=color:#a5d6ff>&#34;&#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>            CREATE TABLE hive_prod.db.orders (
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>                order_id BIGINT,
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>                user_id BIGINT,
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>                product_id INT,
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>                amount DECIMAL(10, 2),
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>                order_date TIMESTAMP
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>            )
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>            USING iceberg
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>            PARTITIONED BY (days(order_date))
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>            LOCATION &#39;s3://my-bucket/warehouse/orders&#39;
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>        &#34;&#34;&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># Schemaæ¼”å˜</span>
</span></span><span style=display:flex><span>        spark<span style=color:#ff7b72;font-weight:700>.</span>sql(<span style=color:#a5d6ff>&#34;&#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>            ALTER TABLE hive_prod.db.orders
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>            ADD COLUMN discount DECIMAL(5, 2)
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>        &#34;&#34;&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># æ—¶é—´æ—…è¡Œ</span>
</span></span><span style=display:flex><span>        spark<span style=color:#ff7b72;font-weight:700>.</span>sql(<span style=color:#a5d6ff>&#34;&#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>            SELECT * FROM hive_prod.db.orders
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>            VERSION AS OF 5
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>        &#34;&#34;&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># åˆ†åŒºæ¼”å˜</span>
</span></span><span style=display:flex><span>        spark<span style=color:#ff7b72;font-weight:700>.</span>sql(<span style=color:#a5d6ff>&#34;&#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>            ALTER TABLE hive_prod.db.orders
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>            SET PARTITION SPECIES (days(order_date))
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>        &#34;&#34;&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>hudi_example</span>(self):
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;&#34;&#34;Apache Hudiç¤ºä¾‹&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># åˆ›å»ºHudiè¡¨</span>
</span></span><span style=display:flex><span>        hudi_options <span style=color:#ff7b72;font-weight:700>=</span> {
</span></span><span style=display:flex><span>            <span style=color:#a5d6ff>&#39;hoodie.table.name&#39;</span>: <span style=color:#a5d6ff>&#39;orders&#39;</span>,
</span></span><span style=display:flex><span>            <span style=color:#a5d6ff>&#39;hoodie.datasource.write.recordkey.field&#39;</span>: <span style=color:#a5d6ff>&#39;order_id&#39;</span>,
</span></span><span style=display:flex><span>            <span style=color:#a5d6ff>&#39;hoodie.datasource.write.partitionpath.field&#39;</span>: <span style=color:#a5d6ff>&#39;order_date&#39;</span>,
</span></span><span style=display:flex><span>            <span style=color:#a5d6ff>&#39;hoodie.datasource.write.precombine.field&#39;</span>: <span style=color:#a5d6ff>&#39;updated_at&#39;</span>,
</span></span><span style=display:flex><span>            <span style=color:#a5d6ff>&#39;hoodie.upsert.shuffle.parallelism&#39;</span>: <span style=color:#a5d6ff>200</span>,
</span></span><span style=display:flex><span>            <span style=color:#a5d6ff>&#39;hoodie.cleaner.policy&#39;</span>: <span style=color:#a5d6ff>&#39;KEEP_LATEST_COMMITS&#39;</span>,
</span></span><span style=display:flex><span>            <span style=color:#a5d6ff>&#39;hoodie.cleaner.commits.retained&#39;</span>: <span style=color:#a5d6ff>10</span>
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># å†™å…¥æ•°æ®</span>
</span></span><span style=display:flex><span>        (df<span style=color:#ff7b72;font-weight:700>.</span>write
</span></span><span style=display:flex><span>            <span style=color:#ff7b72;font-weight:700>.</span>format(<span style=color:#a5d6ff>&#34;hudi&#34;</span>)
</span></span><span style=display:flex><span>            <span style=color:#ff7b72;font-weight:700>.</span>options(<span style=color:#ff7b72;font-weight:700>**</span>hudi_options)
</span></span><span style=display:flex><span>            <span style=color:#ff7b72;font-weight:700>.</span>mode(<span style=color:#a5d6ff>&#34;overwrite&#34;</span>)
</span></span><span style=display:flex><span>            <span style=color:#ff7b72;font-weight:700>.</span>save(<span style=color:#a5d6ff>&#34;s3://my-bucket/hudi/orders&#34;</span>))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># å¢é‡æŸ¥è¯¢</span>
</span></span><span style=display:flex><span>        (spark<span style=color:#ff7b72;font-weight:700>.</span>read
</span></span><span style=display:flex><span>            <span style=color:#ff7b72;font-weight:700>.</span>format(<span style=color:#a5d6ff>&#34;hudi&#34;</span>)
</span></span><span style=display:flex><span>            <span style=color:#ff7b72;font-weight:700>.</span>load(<span style=color:#a5d6ff>&#34;s3://my-bucket/hudi/orders&#34;</span>)
</span></span><span style=display:flex><span>            <span style=color:#ff7b72;font-weight:700>.</span>createTempView(<span style=color:#a5d6ff>&#34;orders&#34;</span>))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        spark<span style=color:#ff7b72;font-weight:700>.</span>sql(<span style=color:#a5d6ff>&#34;&#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>            SELECT * FROM orders
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>            WHERE `_hoodie_commit_time` &gt; &#39;2024-01-01&#39;
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>        &#34;&#34;&#34;</span>)
</span></span></code></pre></td></tr></table></div></div><h2 id=æ•°æ®æ¹–ä¼˜åŒ–ç­–ç•¥>æ•°æ®æ¹–ä¼˜åŒ–ç­–ç•¥<a hidden class=anchor aria-hidden=true href=#æ•°æ®æ¹–ä¼˜åŒ–ç­–ç•¥>#</a></h2><h3 id=æ–‡ä»¶ç»„ç»‡ä¸åˆ†åŒº>æ–‡ä»¶ç»„ç»‡ä¸åˆ†åŒº<a hidden class=anchor aria-hidden=true href=#æ–‡ä»¶ç»„ç»‡ä¸åˆ†åŒº>#</a></h3><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">56
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">57
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">58
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">59
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">60
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">61
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">62
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">63
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">64
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">65
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#ff7b72>class</span> <span style=color:#f0883e;font-weight:700>DataLakeOptimizer</span>:
</span></span><span style=display:flex><span>    <span style=color:#a5d6ff>&#34;&#34;&#34;æ•°æ®æ¹–ä¼˜åŒ–å™¨&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>optimize_partitioning</span>(self):
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;&#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>        åˆ†åŒºç­–ç•¥è®¾è®¡åŸåˆ™ï¼š
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>        1. åˆ†åŒºåŸºæ•° &lt; 1000
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>        2. åˆ†åŒºå¤§å° &gt; 1GB
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>        3. æŒ‰æŸ¥è¯¢é¢‘ç‡é«˜çš„å­—æ®µåˆ†åŒº
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>        4. é¿å…è¿‡ç»†åˆ†åŒº
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>        å¥½çš„åˆ†åŒºï¼š
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>        - date (å¤©çº§åˆ«)
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>        - region (åœ°åŒº)
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>        - product_category (ç±»åˆ«)
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>        å·®çš„åˆ†åŒºï¼š
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>        - user_id (åŸºæ•°å¤ªå¤§)
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>        - timestamp (è¿‡ç»†åˆ†åŒº)
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>        &#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># æ¨èçš„åˆ†åŒºç­–ç•¥</span>
</span></span><span style=display:flex><span>        partition_strategy <span style=color:#ff7b72;font-weight:700>=</span> {
</span></span><span style=display:flex><span>            <span style=color:#a5d6ff>&#34;orders&#34;</span>: [<span style=color:#a5d6ff>&#34;year&#34;</span>, <span style=color:#a5d6ff>&#34;month&#34;</span>, <span style=color:#a5d6ff>&#34;day&#34;</span>],
</span></span><span style=display:flex><span>            <span style=color:#a5d6ff>&#34;user_events&#34;</span>: [<span style=color:#a5d6ff>&#34;date&#34;</span>, <span style=color:#a5d6ff>&#34;event_type&#34;</span>],
</span></span><span style=display:flex><span>            <span style=color:#a5d6ff>&#34;logs&#34;</span>: [<span style=color:#a5d6ff>&#34;date&#34;</span>, <span style=color:#a5d6ff>&#34;level&#34;</span>, <span style=color:#a5d6ff>&#34;service&#34;</span>]
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>return</span> partition_strategy
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>optimize_file_size</span>(self, table_path: str):
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;&#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>        æ–‡ä»¶å¤§å°ä¼˜åŒ–
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>        - ç›®æ ‡å¤§å°ï¼š128MB - 1GB
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>        - å¤ªå°ï¼šå¤§é‡å°æ–‡ä»¶ï¼ŒNameNodeå‹åŠ›å¤§
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>        - å¤ªå¤§ï¼šæŸ¥è¯¢æ—¶éœ€è¦è¯»å–æ•´ä¸ªæ–‡ä»¶
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>        &#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>from</span> <span style=color:#ff7b72>delta.tables</span> <span style=color:#ff7b72>import</span> DeltaTable
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        delta_table <span style=color:#ff7b72;font-weight:700>=</span> DeltaTable<span style=color:#ff7b72;font-weight:700>.</span>forPath(self<span style=color:#ff7b72;font-weight:700>.</span>spark, table_path)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># æ–‡ä»¶å‹ç¼©</span>
</span></span><span style=display:flex><span>        (delta_table
</span></span><span style=display:flex><span>            <span style=color:#ff7b72;font-weight:700>.</span>optimize()
</span></span><span style=display:flex><span>            <span style=color:#ff7b72;font-weight:700>.</span>executeCompaction())
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># æ•°æ®å€¾æ–œå¤„ç†</span>
</span></span><span style=display:flex><span>        (delta_table
</span></span><span style=display:flex><span>            <span style=color:#ff7b72;font-weight:700>.</span>optimize()
</span></span><span style=display:flex><span>            <span style=color:#ff7b72;font-weight:700>.</span>executeZOrderBy(<span style=color:#a5d6ff>&#34;date&#34;</span>))  <span style=color:#8b949e;font-style:italic># Z-ORDERä¼˜åŒ–</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>implement_vacuum</span>(self, table_path: str, retention_days: int <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>7</span>):
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;&#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>        æ¸…ç†æ—§ç‰ˆæœ¬æ•°æ®
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>        - å®šæœŸæ‰§è¡Œä»¥èŠ‚çœå­˜å‚¨
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>        - ä¿ç•™è¶³å¤Ÿæ—¶é—´ç‚¹ç”¨äºå›æ»š
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>        &#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>from</span> <span style=color:#ff7b72>delta.tables</span> <span style=color:#ff7b72>import</span> DeltaTable
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        delta_table <span style=color:#ff7b72;font-weight:700>=</span> DeltaTable<span style=color:#ff7b72;font-weight:700>.</span>forPath(self<span style=color:#ff7b72;font-weight:700>.</span>spark, table_path)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># ä¿ç•™æœ€è¿‘7å¤©çš„æ•°æ®</span>
</span></span><span style=display:flex><span>        delta_table<span style=color:#ff7b72;font-weight:700>.</span>vacuum(retention_hours <span style=color:#ff7b72;font-weight:700>*</span> retention_days <span style=color:#ff7b72;font-weight:700>*</span> <span style=color:#a5d6ff>24</span>)
</span></span></code></pre></td></tr></table></div></div><h2 id=æ•°æ®ç®¡é“å®ç°>æ•°æ®ç®¡é“å®ç°<a hidden class=anchor aria-hidden=true href=#æ•°æ®ç®¡é“å®ç°>#</a></h2><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 56
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 57
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 58
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 59
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 60
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 61
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 62
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 63
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 64
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 65
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 66
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 67
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 68
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 69
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 70
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 71
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 72
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 73
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 74
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 75
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 76
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 77
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 78
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 79
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 80
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 81
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 82
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 83
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 84
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 85
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 86
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 87
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 88
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 89
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 90
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 91
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 92
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 93
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 94
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 95
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 96
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 97
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 98
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 99
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">100
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">101
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">102
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">103
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">104
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">105
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">106
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">107
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">108
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">109
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">110
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">111
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">112
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">113
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">114
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">115
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">116
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">117
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">118
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">119
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">120
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">121
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">122
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">123
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">124
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">125
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">126
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">127
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">128
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">129
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">130
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">131
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">132
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">133
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">134
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#8b949e;font-style:italic># å®Œæ•´çš„ETLç®¡é“</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>from</span> <span style=color:#ff7b72>airflow</span> <span style=color:#ff7b72>import</span> DAG
</span></span><span style=display:flex><span><span style=color:#ff7b72>from</span> <span style=color:#ff7b72>airflow.operators.python</span> <span style=color:#ff7b72>import</span> PythonOperator
</span></span><span style=display:flex><span><span style=color:#ff7b72>from</span> <span style=color:#ff7b72>airflow.providers.spark.operators.spark_submit</span> <span style=color:#ff7b72>import</span> SparkSubmitOperator
</span></span><span style=display:flex><span><span style=color:#ff7b72>from</span> <span style=color:#ff7b72>datetime</span> <span style=color:#ff7b72>import</span> datetime, timedelta
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>build_data_pipeline</span>():
</span></span><span style=display:flex><span>    <span style=color:#a5d6ff>&#34;&#34;&#34;æ„å»ºæ•°æ®ç®¡é“&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    default_args <span style=color:#ff7b72;font-weight:700>=</span> {
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#39;owner&#39;</span>: <span style=color:#a5d6ff>&#39;data-team&#39;</span>,
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#39;depends_on_past&#39;</span>: <span style=color:#79c0ff>False</span>,
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#39;start_date&#39;</span>: datetime(<span style=color:#a5d6ff>2024</span>, <span style=color:#a5d6ff>1</span>, <span style=color:#a5d6ff>1</span>),
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#39;email_on_failure&#39;</span>: <span style=color:#79c0ff>True</span>,
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#39;email_on_retry&#39;</span>: <span style=color:#79c0ff>False</span>,
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#39;retries&#39;</span>: <span style=color:#a5d6ff>2</span>,
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#39;retry_delay&#39;</span>: timedelta(minutes<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>5</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    dag <span style=color:#ff7b72;font-weight:700>=</span> DAG(
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#39;data_lake_pipeline&#39;</span>,
</span></span><span style=display:flex><span>        default_args<span style=color:#ff7b72;font-weight:700>=</span>default_args,
</span></span><span style=display:flex><span>        description<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>&#39;æ•°æ®æ¹–ETLç®¡é“&#39;</span>,
</span></span><span style=display:flex><span>        schedule_interval<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>&#39;0 2 * * *&#39;</span>,  <span style=color:#8b949e;font-style:italic># æ¯å¤©å‡Œæ™¨2ç‚¹</span>
</span></span><span style=display:flex><span>        catchup<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#79c0ff>False</span>,
</span></span><span style=display:flex><span>        tags<span style=color:#ff7b72;font-weight:700>=</span>[<span style=color:#a5d6ff>&#39;datalake&#39;</span>, <span style=color:#a5d6ff>&#39;etl&#39;</span>]
</span></span><span style=display:flex><span>    )
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8b949e;font-style:italic># ä»»åŠ¡1ï¼šä»Kafkaæ‘„å–æ•°æ®åˆ°Bronzeå±‚</span>
</span></span><span style=display:flex><span>    kafka_to_bronze <span style=color:#ff7b72;font-weight:700>=</span> SparkSubmitOperator(
</span></span><span style=display:flex><span>        task_id<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>&#39;kafka_to_bronze&#39;</span>,
</span></span><span style=display:flex><span>        application<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>&#39;jobs/ingest_kafka_to_bronze.py&#39;</span>,
</span></span><span style=display:flex><span>        name<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>&#39;ingest-kafka-to-bronze&#39;</span>,
</span></span><span style=display:flex><span>        conn_id<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>&#39;spark_default&#39;</span>,
</span></span><span style=display:flex><span>        conf<span style=color:#ff7b72;font-weight:700>=</span>{
</span></span><span style=display:flex><span>            <span style=color:#a5d6ff>&#39;spark.dynamicAllocation.enabled&#39;</span>: <span style=color:#a5d6ff>&#39;true&#39;</span>,
</span></span><span style=display:flex><span>            <span style=color:#a5d6ff>&#39;spark.dynamicAllocation.maxExecutors&#39;</span>: <span style=color:#a5d6ff>&#39;10&#39;</span>,
</span></span><span style=display:flex><span>            <span style=color:#a5d6ff>&#39;spark.executor.memory&#39;</span>: <span style=color:#a5d6ff>&#39;4g&#39;</span>,
</span></span><span style=display:flex><span>            <span style=color:#a5d6ff>&#39;spark.executor.cores&#39;</span>: <span style=color:#a5d6ff>&#39;2&#39;</span>
</span></span><span style=display:flex><span>        },
</span></span><span style=display:flex><span>        dag<span style=color:#ff7b72;font-weight:700>=</span>dag
</span></span><span style=display:flex><span>    )
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8b949e;font-style:italic># ä»»åŠ¡2ï¼šæ¸…æ´—æ•°æ®åˆ°Silverå±‚</span>
</span></span><span style=display:flex><span>    bronze_to_silver <span style=color:#ff7b72;font-weight:700>=</span> SparkSubmitOperator(
</span></span><span style=display:flex><span>        task_id<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>&#39;bronze_to_silver&#39;</span>,
</span></span><span style=display:flex><span>        application<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>&#39;jobs/bronze_to_silver.py&#39;</span>,
</span></span><span style=display:flex><span>        name<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>&#39;bronze-to-silver&#39;</span>,
</span></span><span style=display:flex><span>        conf<span style=color:#ff7b72;font-weight:700>=</span>{
</span></span><span style=display:flex><span>            <span style=color:#a5d6ff>&#39;spark.sql.adaptive.enabled&#39;</span>: <span style=color:#a5d6ff>&#39;true&#39;</span>,
</span></span><span style=display:flex><span>            <span style=color:#a5d6ff>&#39;spark.sql.adaptive.coalescePartitions.enabled&#39;</span>: <span style=color:#a5d6ff>&#39;true&#39;</span>
</span></span><span style=display:flex><span>        },
</span></span><span style=display:flex><span>        dag<span style=color:#ff7b72;font-weight:700>=</span>dag
</span></span><span style=display:flex><span>    )
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8b949e;font-style:italic># ä»»åŠ¡3ï¼šæ„å»ºèšåˆè¡¨åˆ°Goldå±‚</span>
</span></span><span style=display:flex><span>    silver_to_gold <span style=color:#ff7b72;font-weight:700>=</span> SparkSubmitOperator(
</span></span><span style=display:flex><span>        task_id<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>&#39;silver_to_gold&#39;</span>,
</span></span><span style=display:flex><span>        application<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>&#39;jobs/silver_to_gold.py&#39;</span>,
</span></span><span style=display:flex><span>        name<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>&#39;silver-to-gold&#39;</span>,
</span></span><span style=display:flex><span>        dag<span style=color:#ff7b72;font-weight:700>=</span>dag
</span></span><span style=display:flex><span>    )
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8b949e;font-style:italic># ä»»åŠ¡4ï¼šæ•°æ®è´¨é‡æ£€æŸ¥</span>
</span></span><span style=display:flex><span>    data_quality_check <span style=color:#ff7b72;font-weight:700>=</span> PythonOperator(
</span></span><span style=display:flex><span>        task_id<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>&#39;data_quality_check&#39;</span>,
</span></span><span style=display:flex><span>        python_callable<span style=color:#ff7b72;font-weight:700>=</span>run_quality_checks,
</span></span><span style=display:flex><span>        dag<span style=color:#ff7b72;font-weight:700>=</span>dag
</span></span><span style=display:flex><span>    )
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8b949e;font-style:italic># ä»»åŠ¡5ï¼šæ•°æ®è¡€ç¼˜æ›´æ–°</span>
</span></span><span style=display:flex><span>    update_lineage <span style=color:#ff7b72;font-weight:700>=</span> PythonOperator(
</span></span><span style=display:flex><span>        task_id<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>&#39;update_lineage&#39;</span>,
</span></span><span style=display:flex><span>        python_callable<span style=color:#ff7b72;font-weight:700>=</span>update_data_lineage,
</span></span><span style=display:flex><span>        dag<span style=color:#ff7b72;font-weight:700>=</span>dag
</span></span><span style=display:flex><span>    )
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8b949e;font-style:italic># ä»»åŠ¡6ï¼šå‘é€æŠ¥å‘Š</span>
</span></span><span style=display:flex><span>    send_report <span style=color:#ff7b72;font-weight:700>=</span> PythonOperator(
</span></span><span style=display:flex><span>        task_id<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>&#39;send_report&#39;</span>,
</span></span><span style=display:flex><span>        python_callable<span style=color:#ff7b72;font-weight:700>=</span>send_pipeline_report,
</span></span><span style=display:flex><span>        dag<span style=color:#ff7b72;font-weight:700>=</span>dag
</span></span><span style=display:flex><span>    )
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8b949e;font-style:italic># è®¾ç½®ä»»åŠ¡ä¾èµ–</span>
</span></span><span style=display:flex><span>    kafka_to_bronze <span style=color:#ff7b72;font-weight:700>&gt;&gt;</span> bronze_to_silver <span style=color:#ff7b72;font-weight:700>&gt;&gt;</span> silver_to_gold
</span></span><span style=display:flex><span>    silver_to_gold <span style=color:#ff7b72;font-weight:700>&gt;&gt;</span> data_quality_check <span style=color:#ff7b72;font-weight:700>&gt;&gt;</span> update_lineage <span style=color:#ff7b72;font-weight:700>&gt;&gt;</span> send_report
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>return</span> dag
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic># ä¸»å‡½æ•°</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>run_quality_checks</span>(<span style=color:#ff7b72;font-weight:700>**</span>context):
</span></span><span style=display:flex><span>    <span style=color:#a5d6ff>&#34;&#34;&#34;è¿è¡Œæ•°æ®è´¨é‡æ£€æŸ¥&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>from</span> <span style=color:#ff7b72>quality_checker</span> <span style=color:#ff7b72>import</span> DataQualityChecker
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    checker <span style=color:#ff7b72;font-weight:700>=</span> DataQualityChecker()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8b949e;font-style:italic># æ£€æŸ¥ç©ºå€¼ç‡</span>
</span></span><span style=display:flex><span>    null_checks <span style=color:#ff7b72;font-weight:700>=</span> checker<span style=color:#ff7b72;font-weight:700>.</span>check_nullity(<span style=color:#a5d6ff>&#34;gold.fact_orders&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8b949e;font-style:italic># æ£€æŸ¥æ•°æ®èŒƒå›´</span>
</span></span><span style=display:flex><span>    range_checks <span style=color:#ff7b72;font-weight:700>=</span> checker<span style=color:#ff7b72;font-weight:700>.</span>check_ranges(<span style=color:#a5d6ff>&#34;gold.fact_orders&#34;</span>, {
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;total_amount&#34;</span>: (<span style=color:#a5d6ff>0</span>, <span style=color:#a5d6ff>1000000</span>),
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;order_count&#34;</span>: (<span style=color:#a5d6ff>0</span>, <span style=color:#a5d6ff>10000</span>)
</span></span><span style=display:flex><span>    })
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8b949e;font-style:italic># æ£€æŸ¥æ•°æ®å®Œæ•´æ€§</span>
</span></span><span style=display:flex><span>    integrity_checks <span style=color:#ff7b72;font-weight:700>=</span> checker<span style=color:#ff7b72;font-weight:700>.</span>check_referential_integrity(
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;gold.fact_orders&#34;</span>,
</span></span><span style=display:flex><span>        {<span style=color:#a5d6ff>&#34;dim_products&#34;</span>: [<span style=color:#a5d6ff>&#34;product_id&#34;</span>], <span style=color:#a5d6ff>&#34;dim_users&#34;</span>: [<span style=color:#a5d6ff>&#34;user_id&#34;</span>]}
</span></span><span style=display:flex><span>    )
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8b949e;font-style:italic># ç”Ÿæˆè´¨é‡æŠ¥å‘Š</span>
</span></span><span style=display:flex><span>    report <span style=color:#ff7b72;font-weight:700>=</span> {
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;null_checks&#34;</span>: null_checks,
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;range_checks&#34;</span>: range_checks,
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;integrity_checks&#34;</span>: integrity_checks,
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;overall_score&#34;</span>: calculate_overall_score([
</span></span><span style=display:flex><span>            null_checks, range_checks, integrity_checks
</span></span><span style=display:flex><span>        ])
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>if</span> report[<span style=color:#a5d6ff>&#34;overall_score&#34;</span>] <span style=color:#ff7b72;font-weight:700>&lt;</span> <span style=color:#a5d6ff>0.9</span>:
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>raise</span> <span style=color:#f0883e;font-weight:700>Exception</span>(<span style=color:#79c0ff>f</span><span style=color:#a5d6ff>&#34;Data quality score too low: </span><span style=color:#a5d6ff>{</span>report[<span style=color:#a5d6ff>&#39;overall_score&#39;</span>]<span style=color:#a5d6ff>}</span><span style=color:#a5d6ff>&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>return</span> report
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>calculate_overall_score</span>(checks):
</span></span><span style=display:flex><span>    <span style=color:#a5d6ff>&#34;&#34;&#34;è®¡ç®—æ€»ä½“è´¨é‡åˆ†æ•°&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>    scores <span style=color:#ff7b72;font-weight:700>=</span> []
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>for</span> check <span style=color:#ff7b72;font-weight:700>in</span> checks:
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>if</span> isinstance(check, dict):
</span></span><span style=display:flex><span>            scores<span style=color:#ff7b72;font-weight:700>.</span>append(check<span style=color:#ff7b72;font-weight:700>.</span>get(<span style=color:#a5d6ff>&#34;score&#34;</span>, <span style=color:#a5d6ff>1.0</span>))
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>return</span> sum(scores) <span style=color:#ff7b72;font-weight:700>/</span> len(scores) <span style=color:#ff7b72>if</span> scores <span style=color:#ff7b72>else</span> <span style=color:#a5d6ff>1.0</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=å®æˆ˜å»ºè®®>å®æˆ˜å»ºè®®<a hidden class=anchor aria-hidden=true href=#å®æˆ˜å»ºè®®>#</a></h2><h3 id=å­˜å‚¨æˆæœ¬ä¼˜åŒ–>å­˜å‚¨æˆæœ¬ä¼˜åŒ–<a hidden class=anchor aria-hidden=true href=#å­˜å‚¨æˆæœ¬ä¼˜åŒ–>#</a></h3><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">56
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#ff7b72>class</span> <span style=color:#f0883e;font-weight:700>StorageOptimizer</span>:
</span></span><span style=display:flex><span>    <span style=color:#a5d6ff>&#34;&#34;&#34;å­˜å‚¨ä¼˜åŒ–ç­–ç•¥&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>implement_tiered_storage</span>(self):
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;&#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>        åˆ†å±‚å­˜å‚¨ç­–ç•¥ï¼š
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>        - çƒ­æ•°æ®ï¼šSSDï¼ˆæœ€è¿‘7å¤©ï¼‰
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>        - æ¸©æ•°æ®ï¼šHDDï¼ˆ30å¤©ï¼‰
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>        - å†·æ•°æ®ï¼šS3 Glacierï¼ˆå½’æ¡£ï¼‰
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>        &#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># ç”Ÿå‘½å‘¨æœŸç­–ç•¥</span>
</span></span><span style=display:flex><span>        lifecycle_policy <span style=color:#ff7b72;font-weight:700>=</span> {
</span></span><span style=display:flex><span>            <span style=color:#a5d6ff>&#34;rules&#34;</span>: [
</span></span><span style=display:flex><span>                {
</span></span><span style=display:flex><span>                    <span style=color:#a5d6ff>&#34;id&#34;</span>: <span style=color:#a5d6ff>&#34;hot-to-warm&#34;</span>,
</span></span><span style=display:flex><span>                    <span style=color:#a5d6ff>&#34;transition&#34;</span>: {
</span></span><span style=display:flex><span>                        <span style=color:#a5d6ff>&#34;days&#34;</span>: <span style=color:#a5d6ff>7</span>,
</span></span><span style=display:flex><span>                        <span style=color:#a5d6ff>&#34;storage_class&#34;</span>: <span style=color:#a5d6ff>&#34;STANDARD_IA&#34;</span>
</span></span><span style=display:flex><span>                    }
</span></span><span style=display:flex><span>                },
</span></span><span style=display:flex><span>                {
</span></span><span style=display:flex><span>                    <span style=color:#a5d6ff>&#34;id&#34;</span>: <span style=color:#a5d6ff>&#34;warm-to-cold&#34;</span>,
</span></span><span style=display:flex><span>                    <span style=color:#a5d6ff>&#34;transition&#34;</span>: {
</span></span><span style=display:flex><span>                        <span style=color:#a5d6ff>&#34;days&#34;</span>: <span style=color:#a5d6ff>30</span>,
</span></span><span style=display:flex><span>                        <span style=color:#a5d6ff>&#34;storage_class&#34;</span>: <span style=color:#a5d6ff>&#34;GLACIER&#34;</span>
</span></span><span style=display:flex><span>                    }
</span></span><span style=display:flex><span>                },
</span></span><span style=display:flex><span>                {
</span></span><span style=display:flex><span>                    <span style=color:#a5d6ff>&#34;id&#34;</span>: <span style=color:#a5d6ff>&#34;expiration&#34;</span>,
</span></span><span style=display:flex><span>                    <span style=color:#a5d6ff>&#34;expiration&#34;</span>: {
</span></span><span style=display:flex><span>                        <span style=color:#a5d6ff>&#34;days&#34;</span>: <span style=color:#a5d6ff>365</span>
</span></span><span style=display:flex><span>                    }
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>            ]
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>return</span> lifecycle_policy
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>implement_columnar_format</span>(self):
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;&#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>        åˆ—å¼å­˜å‚¨ä¼˜åŒ–
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>        - Parquetï¼šå‹ç¼©ç‡é«˜ï¼ŒæŸ¥è¯¢å¿«
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>        - ORCï¼šé€‚åˆå¤æ‚ç±»å‹
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>        - Avroï¼šé€‚åˆå†™å¯†é›†
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>        &#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        format_recommendations <span style=color:#ff7b72;font-weight:700>=</span> {
</span></span><span style=display:flex><span>            <span style=color:#a5d6ff>&#34;åˆ†ææŸ¥è¯¢&#34;</span>: <span style=color:#a5d6ff>&#34;parquet&#34;</span>,
</span></span><span style=display:flex><span>            <span style=color:#a5d6ff>&#34;æµå¼å†™å…¥&#34;</span>: <span style=color:#a5d6ff>&#34;avro&#34;</span>,
</span></span><span style=display:flex><span>            <span style=color:#a5d6ff>&#34;å¤æ‚åµŒå¥—&#34;</span>: <span style=color:#a5d6ff>&#34;orc&#34;</span>,
</span></span><span style=display:flex><span>            <span style=color:#a5d6ff>&#34;è¯»å–å¯†é›†&#34;</span>: <span style=color:#a5d6ff>&#34;parquet&#34;</span>,
</span></span><span style=display:flex><span>            <span style=color:#a5d6ff>&#34;å†™å…¥å¯†é›†&#34;</span>: <span style=color:#a5d6ff>&#34;avro&#34;</span>
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>return</span> format_recommendations
</span></span></code></pre></td></tr></table></div></div><h2 id=æ€»ç»“>æ€»ç»“<a hidden class=anchor aria-hidden=true href=#æ€»ç»“>#</a></h2><p>æ„å»ºç°ä»£æ•°æ®æ¹–çš„å…³é”®è¦ç´ ï¼š</p><ol><li><strong>åˆ†å±‚æ¶æ„</strong>ï¼šBronze-Silver-Goldä¸‰å±‚è®¾è®¡</li><li><strong>è¡¨æ ¼å¼é€‰æ‹©</strong>ï¼šDelta Lakeï¼ˆæ¨èï¼‰ã€Icebergã€Hudi</li><li><strong>åˆ†åŒºç­–ç•¥</strong>ï¼šåˆç†é€‰æ‹©åˆ†åŒºå­—æ®µå’Œç²’åº¦</li><li><strong>æ–‡ä»¶ä¼˜åŒ–</strong>ï¼šæ§åˆ¶æ–‡ä»¶å¤§å°å’Œæ•°é‡</li><li><strong>ACIDäº‹åŠ¡</strong>ï¼šæ”¯æŒæ›´æ–°å’Œåˆ é™¤æ“ä½œ</li><li><strong>Schemaæ¼”å˜</strong>ï¼šçµæ´»åº”å¯¹ä¸šåŠ¡å˜åŒ–</li><li><strong>æˆæœ¬ä¼˜åŒ–</strong>ï¼šåˆ†å±‚å­˜å‚¨å’Œç”Ÿå‘½å‘¨æœŸç®¡ç†</li></ol><p>æ•°æ®æ¹–ä¸æ˜¯æŠ€æœ¯å †ç Œï¼Œè€Œæ˜¯æœåŠ¡äºä¸šåŠ¡çš„æ™ºèƒ½åŒ–æ•°æ®å¹³å°ã€‚</p></div><footer class=post-footer-modern><div class=post-tags-modern><span class=tags-label>ğŸ·ï¸ æ ‡ç­¾</span><div class=tags-list><a href=/blog/tags/%E6%95%B0%E6%8D%AE%E6%B9%96/ class=tag-pill>æ•°æ®æ¹–
</a><a href=/blog/tags/%E5%A4%A7%E6%95%B0%E6%8D%AE/ class=tag-pill>å¤§æ•°æ®
</a><a href=/blog/tags/delta-lake/ class=tag-pill>Delta Lake
</a><a href=/blog/tags/iceberg/ class=tag-pill>Iceberg
</a><a href=/blog/tags/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/ class=tag-pill>æ•°æ®ä»“åº“</a></div></div><style>.post-footer-modern{margin-top:3rem;padding-top:2rem;border-top:1px solid var(--border,#333333)}.post-tags-modern{display:flex;align-items:center;gap:1rem;margin-bottom:2rem;flex-wrap:wrap}.tags-label{font-size:.875rem;font-weight:600;color:var(--secondary,#999999) !important;white-space:nowrap}.tags-list{display:flex;flex-wrap:wrap;gap:.5rem;flex:1}.tag-pill{display:inline-block;padding:.25rem .75rem;background:rgba(255,255,255,5%);border:1px solid var(--border,#333333);border-radius:0;color:var(--secondary,#cccccc) !important;text-decoration:none;font-size:.8rem;font-weight:500;transition:all .2s ease}.tag-pill:hover{background:var(--primary,#ffffff);color:var(--background,#000000) !important;border-color:var(--primary,#ffffff);transform:translateY(-1px)}.post-nav-modern{margin-top:2rem}.nav-grid{display:grid;grid-template-columns:1fr 1fr;gap:1rem}.nav-card{display:flex;align-items:center;gap:1rem;padding:1.25rem;background:rgba(255,255,255,2%);border:1px solid var(--border,#333333);border-radius:12px;text-decoration:none;transition:all .2s ease;min-height:80px}.nav-card:hover{background:rgba(255,255,255,5%);border-color:var(--primary,#ffffff);transform:translateY(-2px)}.nav-card.nav-prev{justify-content:flex-start}.nav-card.nav-next{justify-content:flex-end;text-align:right}.nav-card.nav-next .nav-content{text-align:right}.nav-empty{display:flex;align-items:center;justify-content:center;background:rgba(255,255,255,1%);border:1px dashed var(--border,#333333);color:var(--secondary,#666666)}.nav-arrow{font-size:1.5rem;color:var(--primary,#ffffff);font-weight:300}.nav-content{flex:1}.nav-title{font-size:.95rem;font-weight:600;color:var(--primary,#ffffff) !important;line-height:1.4;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden}[data-theme=light] .post-footer-modern{border-color:var(--border-light,#dee2e6)}[data-theme=light] .tags-label{color:var(--secondary-light,#6c757d) !important}[data-theme=light] .tag-pill{background:rgba(0,0,0,5%);border-color:var(--border-light,#dee2e6);color:var(--secondary-light,#495057) !important}[data-theme=light] .tag-pill:hover{background:var(--primary-light,#0066cc);color:var(--background-light,#ffffff) !important;border-color:var(--primary-light,#0066cc)}[data-theme=light] .nav-card{background:rgba(0,0,0,2%);border-color:var(--border-light,#dee2e6)}[data-theme=light] .nav-card:hover{background:rgba(0,102,204,5%);border-color:var(--primary-light,#0066cc)}[data-theme=light] .nav-empty{background:rgba(0,0,0,1%);border-color:var(--border-light,#dee2e6);color:var(--secondary-light,#6c757d)}[data-theme=light] .nav-arrow{color:var(--primary-light,#0066cc)}[data-theme=light] .nav-title{color:var(--primary-light,#212529) !important}@media(max-width:768px){.nav-grid{grid-template-columns:1fr;gap:.75rem}.nav-card{padding:1rem;min-height:70px}.nav-card.nav-next{text-align:left}.nav-card.nav-next .nav-content{text-align:left}.nav-title{font-size:.875rem}.post-tags-modern{flex-direction:column;gap:.75rem}}@media(max-width:480px){.nav-arrow{font-size:1.25rem}.nav-card{padding:.875rem}.nav-title{font-size:.8rem;-webkit-line-clamp:1}}</style><nav class=post-nav-modern><div class=nav-grid><a href=/blog/articles/%E7%94%A8%E6%88%B7%E4%BD%93%E9%AA%8C%E8%AE%BE%E8%AE%A1%E5%8E%9F%E5%88%99%E6%89%93%E9%80%A0%E8%AE%A9%E7%94%A8%E6%88%B7%E7%88%B1%E4%B8%8D%E9%87%8A%E6%89%8B%E7%9A%84%E4%BA%A7%E5%93%81/ class="nav-card nav-prev"><div class=nav-arrow>â†</div><div class=nav-content><div class=nav-title>ç”¨æˆ·ä½“éªŒè®¾è®¡åŸåˆ™ï¼šæ‰“é€ è®©ç”¨æˆ·çˆ±ä¸é‡Šæ‰‹çš„äº§å“</div></div></a><a href=/blog/articles/llm%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91%E5%AE%9E%E6%88%98%E4%BB%8E%E5%8E%9F%E5%9E%8B%E5%88%B0%E7%94%9F%E4%BA%A7%E9%83%A8%E7%BD%B2%E7%9A%84%E5%AE%8C%E6%95%B4%E6%8C%87%E5%8D%97/ class="nav-card nav-next"><div class=nav-content><div class=nav-title>LLMåº”ç”¨å¼€å‘å®æˆ˜ï¼šä»åŸå‹åˆ°ç”Ÿäº§éƒ¨ç½²çš„å®Œæ•´æŒ‡å—</div></div><div class=nav-arrow>â†’</div></a></div></nav></footer></main><aside class=post-sidebar><div class=sidebar-toc id=sidebar-toc><div class=toc-header><div class=toc-title>ç›®å½•</div><button class=toc-toggle id=toc-toggle aria-label="Toggle TOC">
<svg class="toc-toggle-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 6 6 18M6 6l12 12"/></svg></button></div><div class=toc-content id=toc-content><ul class=toc-list><li class="toc-item toc-h2"><a href=#h2-0 class=toc-item-link><span class=toc-item-text>æ•°æ®æ¹– vs æ•°æ®ä»“åº“</span></a></li><li class="toc-item toc-h2"><a href=#h2-1 class=toc-item-link><span class=toc-item-text>æ•°æ®æ¹–åˆ†å±‚æ¶æ„</span></a></li><li class="toc-item toc-h2"><a href=#h2-2 class=toc-item-link><span class=toc-item-text>è¡¨æ ¼å¼å¯¹æ¯”</span></a></li><li class="toc-item toc-h2"><a href=#h2-3 class=toc-item-link><span class=toc-item-text>æ•°æ®æ¹–ä¼˜åŒ–ç­–ç•¥</span></a></li><li class="toc-item toc-h2"><a href=#h2-4 class=toc-item-link><span class=toc-item-text>æ•°æ®ç®¡é“å®ç°</span></a></li><li class="toc-item toc-h2"><a href=#h2-5 class=toc-item-link><span class=toc-item-text>å®æˆ˜å»ºè®®</span></a></li><li class="toc-item toc-h2"><a href=#h2-6 class=toc-item-link><span class=toc-item-text>æ€»ç»“</span></a></li></ul></div></div><script>document.addEventListener("DOMContentLoaded",function(){const e=document.getElementById("sidebar-toc"),t=document.getElementById("toc-toggle"),o=document.getElementById("toc-content"),i=t?.querySelector(".toc-toggle-icon");if(!e)return;let n=!1;t&&t.addEventListener("click",function(){n=!n,n?(o.style.display="none",e.style.width="auto",i.innerHTML='<path d="M9 18l6-6-6-6"/>'):(o.style.display="block",e.style.width="200px",i.innerHTML='<path d="M18 6L6 18M6 6l12 12"/>')});const s=document.querySelector(".post-content");if(s){const e=s.querySelectorAll("h1");e.forEach((e,t)=>{e.id=`h1-${t}`});const t=s.querySelectorAll("h2");t.forEach((e,t)=>{e.id=`h2-${t}`})}const a=document.querySelectorAll(".toc-item-link");a.forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();const n=this.getAttribute("href").substring(1),t=document.getElementById(n);if(t){const e=document.querySelector(".post-header-main")?.offsetHeight||0,n=t.offsetTop-e-20;window.scrollTo({top:n,behavior:"smooth"})}})})})</script><style>.sidebar-toc{position:sticky;top:2rem;width:200px;background:#fff;border:1px solid #e5e7eb;border-radius:4px;overflow:hidden;box-shadow:0 1px 3px rgba(0,0,0,.1);z-index:100}.sidebar-toc.hidden{display:none}.toc-header{padding:12px 16px;border-bottom:1px solid #e5e7eb;background:#fafbfc;display:flex;align-items:center;justify-content:space-between}.toc-title{margin:0;font-size:13px;font-weight:500;color:#374151 !important;font-family:-apple-system,BlinkMacSystemFont,segoe ui,Roboto,sans-serif;text-transform:uppercase;letter-spacing:1px}.toc-toggle{background:0 0;border:none;cursor:pointer;padding:4px;border-radius:4px;display:flex;align-items:center;justify-content:center;transition:all .2s ease;color:#6b7280}.toc-toggle:hover{background:#e5e7eb;color:#374151}.toc-toggle-icon{transition:transform .2s ease}.toc-content{padding:12px 0}.toc-list{list-style:none;margin:0;padding:0}.toc-item{margin-bottom:4px;display:block !important;visibility:visible !important}.toc-h1,.toc-h2{display:block !important}.toc-h2{margin-left:0}.toc-item-link{display:flex;align-items:center;gap:8px;padding:8px 12px;color:#374151 !important;text-decoration:none;font-size:13px;line-height:1.4;border-radius:3px;transition:all .2s ease;font-weight:400}.toc-item-link:hover{background:#f8fafc;color:#1f2937 !important}.toc-item-link.active{background:#e0f2fe;color:#01579b !important;font-weight:500}.toc-dot{width:8px;height:8px;border-radius:50%;flex-shrink:0}.dot-red{background:#ef4444}.dot-blue{background:#2196f3}.toc-item-text{color:#1f2937 !important;font-weight:400;flex:1;display:inline !important;visibility:visible !important;opacity:1 !important;font-size:13px !important;line-height:1.4 !important}.toc-item-link .toc-item-text{color:#1f2937 !important;display:inline !important;visibility:visible !important;opacity:1 !important}.toc-item.active .dot-red{background:#d32f2f}.toc-item.active .dot-blue{background:#1976d2}[data-theme=dark] .sidebar-toc{background:#1f2937;border-color:#374151;box-shadow:0 1px 3px rgba(0,0,0,.3)}[data-theme=dark] .toc-header{background:#111827;border-color:#374151}[data-theme=dark] .toc-title{color:#f3f4f6 !important}[data-theme=dark] .toc-toggle{color:#9ca3af}[data-theme=dark] .toc-toggle:hover{background:#374151;color:#f3f4f6}[data-theme=dark] .toc-item-link{color:#e5e7eb !important}[data-theme=dark] .toc-item-link:hover{background:#374151;color:#f9fafb !important}[data-theme=dark] .toc-item-link.active{background:#0d47a1;color:#fff !important}[data-theme=dark] .toc-item-text{color:#f9fafb !important;display:inline !important;visibility:visible !important;opacity:1 !important}[data-theme=dark] .toc-item-link .toc-item-text{color:#f9fafb !important;display:inline !important;visibility:visible !important;opacity:1 !important}@media(max-width:1024px){.sidebar-toc{display:none}.post-content-wrapper{grid-template-columns:1fr !important;padding:0 1rem !important}}</style><style>.post-content-wrapper{display:grid;grid-template-columns:1fr 200px;gap:2rem;padding:0 2rem;max-width:100%}.post-content-main{min-width:0}.post-sidebar{position:sticky;top:2rem;height:fit-content;min-width:0}.post-header-main{margin-bottom:2rem;padding-bottom:1rem;border-bottom:1px solid var(--border,#333333)}.post-header-main .post-title{color:var(--primary,#ffffff) !important;font-size:2.5rem;font-weight:700;line-height:1.2;margin-bottom:1rem}.post-header-main .post-description{color:var(--secondary,#cccccc) !important;font-size:1.1rem;line-height:1.6;margin-bottom:1rem}.post-header-main .post-meta{margin-bottom:0}@media(max-width:1024px){.post-content-wrapper{grid-template-columns:1fr !important;gap:1rem;padding:0 1rem !important}.post-sidebar{display:none}}@media(max-width:768px){.post-header-main .post-title{font-size:2rem}.post-header-main .post-description{font-size:1rem}}</style></aside></div></article></main><footer class=footer><span>Â© 2024-2025 æœ‰æ¡å·¥å…·æŠ€æœ¯åšå®¢</span> Â·</footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");if(menu){const e=localStorage.getItem("menu-scroll-position");e&&(menu.scrollLeft=parseInt(e,10)),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}}document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{const e=document.querySelector("html");e.dataset.theme==="dark"?(e.dataset.theme="light",localStorage.setItem("pref-theme","light")):(e.dataset.theme="dark",localStorage.setItem("pref-theme","dark"))})</script></body></html>