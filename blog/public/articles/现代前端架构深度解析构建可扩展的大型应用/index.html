<!doctype html><html lang=zh-cn dir=auto data-theme=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>现代前端架构深度解析：构建可扩展的大型应用 | 技术博客 - 有条工具</title><meta name=keywords content="前端架构设计,微前端架构,Webpack模块联邦,前端性能优化,状态管理最佳实践,React架构,Vue架构,大型前端应用"><meta name=description content="深入探讨现代前端架构设计，包括微前端、模块联邦、状态管理、性能优化等核心主题，帮助开发者构建可维护、可扩展的大型前端应用。"><meta name=author content="有条工具团队"><link rel=canonical href=/blog/articles/%E7%8E%B0%E4%BB%A3%E5%89%8D%E7%AB%AF%E6%9E%B6%E6%9E%84%E6%B7%B1%E5%BA%A6%E8%A7%A3%E6%9E%90%E6%9E%84%E5%BB%BA%E5%8F%AF%E6%89%A9%E5%B1%95%E7%9A%84%E5%A4%A7%E5%9E%8B%E5%BA%94%E7%94%A8/><link crossorigin=anonymous href=/blog/assets/css/stylesheet.7e8505b7cdf8bb22ab2305e53c2700bb06c7e64faeb72cd3468823a9a3bd3d6e.css integrity="sha256-foUFt834uyKrIwXlPCcAuwbH5k+utyzTRogjqaO9PW4=" rel="preload stylesheet" as=style><link rel=icon href=/favicon.ico><link rel=icon type=image/png sizes=16x16 href=/blog/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=/blog/favicon-32x32.png><link rel=apple-touch-icon href=/blog/apple-touch-icon.png><link rel=mask-icon href=/blog/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate type=application/rss+xml href=/blog/articles/%E7%8E%B0%E4%BB%A3%E5%89%8D%E7%AB%AF%E6%9E%B6%E6%9E%84%E6%B7%B1%E5%BA%A6%E8%A7%A3%E6%9E%90%E6%9E%84%E5%BB%BA%E5%8F%AF%E6%89%A9%E5%B1%95%E7%9A%84%E5%A4%A7%E5%9E%8B%E5%BA%94%E7%94%A8/feed.xml title=rss><link rel=alternate hreflang=zh-cn href=/blog/articles/%E7%8E%B0%E4%BB%A3%E5%89%8D%E7%AB%AF%E6%9E%B6%E6%9E%84%E6%B7%B1%E5%BA%A6%E8%A7%A3%E6%9E%90%E6%9E%84%E5%BB%BA%E5%8F%AF%E6%89%A9%E5%B1%95%E7%9A%84%E5%A4%A7%E5%9E%8B%E5%BA%94%E7%94%A8/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51);color-scheme:dark}.list{background:var(--theme)}.toc{background:var(--entry)}}@media(prefers-color-scheme:light){.list::-webkit-scrollbar-thumb{border-color:var(--code-bg)}}</style></noscript><script>localStorage.getItem("pref-theme")==="dark"?document.querySelector("html").dataset.theme="dark":localStorage.getItem("pref-theme")==="light"?document.querySelector("html").dataset.theme="light":window.matchMedia("(prefers-color-scheme: dark)").matches?document.querySelector("html").dataset.theme="dark":document.querySelector("html").dataset.theme="light"</script><script src=/js/external-link-config.js></script><script src=/js/external-link-interceptor.js></script><link rel=stylesheet href=/blog/css/custom.css media=screen><script type=application/ld+json>{"@context":"https://schema.org","@type":"WebSite","name":"技术博客 - 有条工具 | 开发者工具使用教程 & 编程技巧分享","url":"https://www.util.cn/blog/","description":"有条工具技术博客 - 分享开发者工具使用教程、编程技巧和实战开发经验。提供JSON格式化、SQL优化、Markdown编辑器等在线工具的详细使用指南，帮助开发者提升工作效率。","publisher":{"@type":"Organization","name":"有条工具","url":"https://www.util.cn","logo":{"@type":"ImageObject","url":"https://www.util.cn/blog/logo/logo-256.png","width":256,"height":256}},"potentialAction":[{"@type":"SearchAction","target":"https://www.util.cn/blog/search?q={search_term_string}","query-input":"required name=search_term_string"}]}</script><meta property="og:type" content="website"><meta property="og:title" content="技术博客 - 有条工具 | 开发者工具使用教程 & 编程技巧分享"><meta property="og:description" content="有条工具技术博客 - 分享开发者工具使用教程、编程技巧和实战开发经验。提供JSON格式化、SQL优化、Markdown编辑器等在线工具的详细使用指南，帮助开发者提升工作效率。"><meta property="og:url" content="https://www.util.cn/blog/"><meta property="og:site_name" content="有条工具技术博客"><meta property="og:image" content="https://www.util.cn/blog/logo/logo-256.png"><meta property="og:image:width" content="1200"><meta property="og:image:height" content="630"><meta name=twitter:card content="summary_large_image"><meta name=twitter:title content="技术博客 - 有条工具 | 开发者工具使用教程 & 编程技巧分享"><meta name=twitter:description content="有条工具技术博客 - 分享开发者工具使用教程、编程技巧和实战开发经验。"><meta name=twitter:image content="https://www.util.cn/blog/logo/logo-256.png"><meta name=baidu-site-verification content><meta name=category content="技术博客,开发者工具,编程教程"><meta name=coverage content="Worldwide"><meta name=distribution content="Global"><meta name=rating content="General"><script id=51la_code async crossorigin=anonymous src="https://sdk.51.la/js-sdk-pro.min.js?id=3OM52V0xJAPv6ozF&hash=pro"></script><script>window.addEventListener("load",function(){setTimeout(function(){typeof la!="undefined"?console.log("51la统计已加载"):(console.warn("51la统计加载失败，使用备用方案"),function(){var e=document.createElement("script");e.src="https://sdk.51.la/js-sdk-pro.min.js?id=3OM52V0xJAPv6ozF&hash=backup",e.async=!0,document.head.appendChild(e)}())},3e3)})</script><meta property="og:url" content="/blog/articles/%E7%8E%B0%E4%BB%A3%E5%89%8D%E7%AB%AF%E6%9E%B6%E6%9E%84%E6%B7%B1%E5%BA%A6%E8%A7%A3%E6%9E%90%E6%9E%84%E5%BB%BA%E5%8F%AF%E6%89%A9%E5%B1%95%E7%9A%84%E5%A4%A7%E5%9E%8B%E5%BA%94%E7%94%A8/"><meta property="og:site_name" content="技术博客 - 有条工具"><meta property="og:title" content="现代前端架构深度解析：构建可扩展的大型应用"><meta property="og:description" content="深入探讨现代前端架构设计，包括微前端、模块联邦、状态管理、性能优化等核心主题，帮助开发者构建可维护、可扩展的大型前端应用。"><meta property="og:locale" content="zh-cn"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2025-12-30T10:00:00+08:00"><meta property="article:modified_time" content="2025-12-30T10:00:00+08:00"><meta property="article:tag" content="前端架构"><meta property="article:tag" content="微前端"><meta property="article:tag" content="性能优化"><meta property="article:tag" content="状态管理"><meta property="article:tag" content="模块联邦"><meta name=twitter:card content="summary"><meta name=twitter:title content="现代前端架构深度解析：构建可扩展的大型应用"><meta name=twitter:description content="深入探讨现代前端架构设计，包括微前端、模块联邦、状态管理、性能优化等核心主题，帮助开发者构建可维护、可扩展的大型前端应用。"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"所有文章","item":"/blog/posts/"},{"@type":"ListItem","position":2,"name":"现代前端架构深度解析：构建可扩展的大型应用","item":"/blog/articles/%E7%8E%B0%E4%BB%A3%E5%89%8D%E7%AB%AF%E6%9E%B6%E6%9E%84%E6%B7%B1%E5%BA%A6%E8%A7%A3%E6%9E%90%E6%9E%84%E5%BB%BA%E5%8F%AF%E6%89%A9%E5%B1%95%E7%9A%84%E5%A4%A7%E5%9E%8B%E5%BA%94%E7%94%A8/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"现代前端架构深度解析：构建可扩展的大型应用","name":"现代前端架构深度解析：构建可扩展的大型应用","description":"深入探讨现代前端架构设计，包括微前端、模块联邦、状态管理、性能优化等核心主题，帮助开发者构建可维护、可扩展的大型前端应用。","keywords":["前端架构设计","微前端架构","Webpack模块联邦","前端性能优化","状态管理最佳实践","React架构","Vue架构","大型前端应用"],"articleBody":"引言 随着前端应用的复杂度不断增加，传统的单体前端架构已难以满足大型项目的需求。现代前端架构需要解决代码分割、团队协作、性能优化、可维护性等多方面的挑战。本文将从架构设计的角度，深入探讨如何构建可扩展的大型前端应用。\n一、前端架构演进史 1.1 从页面到应用的发展历程 jQuery时代 → AMD/RequireJS → CommonJS/Node.js → ES6 Modules → 现代框架时代 发展阶段\n阶段 特点 代表技术 局限性 静态页面 HTML + CSS + 少量JS jQuery、Prototype 代码复用差 模块化初期 RequireJS、SeaJS AMD、CMD 加载复杂 组件化 React、Vue诞生 Virtual DOM 状态管理混乱 工程化 Webpack、Rollup ES6 Modules 构建复杂度高 现代化 Next.js、Nuxt.js SSR、SSR Streaming 学习曲线陡峭 1.2 当前架构挑战 大型前端应用面临的核心问题\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 // 问题1: 代码组织混乱 // src/ // components/ // 1000+ 组件 // pages/ // 200+ 页面 // utils/ // 工具函数散落各处 // api/ // API调用不规范 // 问题2: 状态管理复杂 // - 全局状态与局部状态边界模糊 // - 状态流转难以追踪 // - 多个状态管理方案混用 // 问题3: 性能瓶颈 // - 首屏加载时间长 // - 路由切换卡顿 // - 内存泄漏风险 // 问题4: 团队协作困难 // - 代码冲突频繁 // - 发布周期长 // - 技术栈不统一 二、架构设计原则 2.1 SOLID原则在前端的应用 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 // S - 单一职责原则 // ❌ 违反单一职责 class UserComponent { render() { } fetchUser() { } validateInput() { } formatData() { } logAnalytics() { } } // ✅ 遵循单一职责 class UserComponent { constructor( private renderer: UserRenderer, private userService: UserService, private validator: InputValidator ) { } render() { this.renderer.render() } fetchUser() { this.userService.fetch() } } // O - 开闭原则 // 使用插件系统扩展功能 interface ComponentPlugin { install(component: any): void uninstall(component: any): void } class Component { private plugins: ComponentPlugin[] = [] use(plugin: ComponentPlugin) { this.plugins.push(plugin) plugin.install(this) return this } } // L - 里氏替换原则 // 基类可被子类无缝替换 abstract class BaseStore\u003cT\u003e { abstract get(id: string): Promise\u003cT\u003e abstract set(id: string, data: T): Promise\u003cvoid\u003e } class UserStore extends BaseStore\u003cUser\u003e { async get(id: string): Promise\u003cUser\u003e { } async set(id: string, data: User): Promise\u003cvoid\u003e { } } // I - 接口隔离原则 // 拆分大接口为小接口 interface ReadOnlyRepository\u003cT\u003e { findById(id: string): Promise\u003cT\u003e findAll(): Promise\u003cT[]\u003e } interface WriteOnlyRepository\u003cT\u003e { create(data: T): Promise\u003cT\u003e update(id: string, data: Partial\u003cT\u003e): Promise\u003cT\u003e delete(id: string): Promise\u003cvoid\u003e } // D - 依赖倒置原则 // 依赖抽象而非具体实现 interface CacheService { get(key: string): Promise\u003cany\u003e set(key: string, value: any): Promise\u003cvoid\u003e } class UserService { constructor(private cache: CacheService) { } } 2.2 分层架构 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 // 标准前端分层架构 ┌─────────────────────────────────────────────┐ │ Presentation Layer │ │ (Components, Pages, UI Logic) │ ├─────────────────────────────────────────────┤ │ Business Logic Layer │ │ (Hooks, Composables, Use Cases) │ ├─────────────────────────────────────────────┤ │ Data Access Layer │ │ (API Client, Cache, State Management) │ ├─────────────────────────────────────────────┤ │ Infrastructure Layer │ │ (HTTP, WebSocket, LocalStorage) │ └─────────────────────────────────────────────┘ // 实现示例 // ========== Presentation Layer ========== // views/UserList.vue \u003ctemplate\u003e \u003cUserDataTable :users=\"users\" :loading=\"loading\" @refresh=\"handleRefresh\" /\u003e \u003c/template\u003e // ========== Business Logic Layer ========== // composables/useUserList.ts export function useUserList() { const { users, loading, error, fetch } = userRepository() const refresh = async () =\u003e { await fetch() analytics.track('user_list_refreshed') } const filteredUsers = computed(() =\u003e { return users.value.filter(user =\u003e user.active) }) return { users: filteredUsers, loading, error, refresh } } // ========== Data Access Layer ========== // repositories/userRepository.ts export function userRepository() { const api = useApiClient() const cache = useCache() const fetch = async () =\u003e { const cached = await cache.get('users') if (cached) return cached const data = await api.get('/users') await cache.set('users', data, 300) // 5分钟 return data } return { users: ref([]), loading: ref(false), error: ref(null), fetch } } // ========== Infrastructure Layer =========== // utils/apiClient.ts class ApiClient { private baseURL: string private interceptors: RequestInterceptor[] async get\u003cT\u003e(url: string): Promise\u003cT\u003e { const request = new Request(this.baseURL + url) return this.execute\u003cT\u003e(request) } } 2.3 领域驱动设计(DDD)在前端 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 // 1. 领域模型定义 // domains/user/User.ts export class User { constructor( private readonly id: UserId, private readonly email: Email, private name: UserName, private status: UserStatus ) {} // 领域逻辑 activate(): void { if (this.status === UserStatus.ACTIVE) { throw new Error('User already active') } this.status = UserStatus.ACTIVE } deactivate(): void { this.status = UserStatus.INACTIVE } isActive(): boolean { return this.status === UserStatus.ACTIVE } } // 值对象 export class Email { constructor(private readonly value: string) { if (!this.validate(value)) { throw new Error('Invalid email') } } private validate(email: string): boolean { return /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/.test(email) } getValue(): string { return this.value } } // 2. 领域服务 // domains/user/UserService.ts export class UserService { constructor( private userRepo: UserRepository, private emailService: EmailService ) {} async registerUser(data: RegisterUserData): Promise\u003cUser\u003e { // 业务规则验证 if (await this.userRepo.existsByEmail(data.email)) { throw new Error('Email already registered') } // 创建领域对象 const user = new User( UserId.generate(), new Email(data.email), new UserName(data.name), UserStatus.PENDING ) // 持久化 await this.userRepo.save(user) // 发送欢迎邮件 await this.emailService.sendWelcome(user.email.getValue()) return user } } // 3. 应用服务（用例） // application/useCases/RegisterUserUseCase.ts export class RegisterUserUseCase { constructor(private userService: UserService) { } async execute(request: RegisterUserRequest): Promise\u003cRegisterUserResponse\u003e { try { const user = await this.userService.registerUser(request.data) return { success: true, userId: user.id.getValue(), message: 'Registration successful' } } catch (error) { return { success: false, error: error.message } } } } // 4. 在组件中使用 // components/RegisterForm.vue export default { setup() { const registerUser = useRegisterUserUseCase() const handleSubmit = async (formData) =\u003e { const result = await registerUser.execute({ data: { email: formData.email, name: formData.name, password: formData.password } }) if (result.success) { router.push(`/welcome/${result.userId}`) } else { showError(result.error) } } return { handleSubmit } } } 三、微前端架构 3.1 微前端架构模式 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 // 模式1: 路由分发 // 主应用根据路由加载不同子应用 const microApps = [ { name: 'user-center', entry: '//localhost:3001', container: '#subapp', activeRule: '/users' }, { name: 'order-system', entry: '//localhost:3002', container: '#subapp', activeRule: '/orders' } ] // 模式2: 组合式集成 // 主应用提供容器，子应用作为组件渲染 \u003ctemplate\u003e \u003cdiv\u003e \u003cAppHeader /\u003e \u003cMicroApp name=\"user-center\" :props=\"userProps\" /\u003e \u003cAppFooter /\u003e \u003c/div\u003e \u003c/template\u003e // 模式3: EMP (EMP Module Federation) // 去中心化的模块共享 // 子应用A new ModuleFederationPlugin({ name: 'appA', exposes: { './UserList': './src/components/UserList' }, shared: ['vue', 'vue-router'] }) // 子应用B使用A的组件 import UserList from 'appA/UserList' 3.2 模块联邦实现 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 // webpack.config.js - 主应用 const ModuleFederationPlugin = require('webpack/lib/container/ModuleFederationPlugin') module.exports = { plugins: [ new ModuleFederationPlugin({ name: 'host_app', remotes: { userApp: 'user_app@http://localhost:3001/remoteEntry.js', orderApp: 'order_app@http://localhost:3002/remoteEntry.js' }, shared: { vue: { singleton: true, requiredVersion: '^3.0.0' }, 'vue-router': { singleton: true } } }) ] } // 在主应用中使用远程模块 // src/App.vue \u003cscript\u003e import { defineAsyncComponent } from 'vue' // 动态加载远程组件 const UserDashboard = defineAsyncComponent(() =\u003e import('userApp/Dashboard') ) const OrderList = defineAsyncComponent(() =\u003e import('orderApp/OrderList') ) export default { components: { UserDashboard, OrderList } } \u003c/script\u003e // 子应用配置 - userApp // webpack.config.js module.exports = { plugins: [ new ModuleFederationPlugin({ name: 'user_app', filename: 'remoteEntry.js', exposes: { './Dashboard': './src/components/Dashboard.vue', './UserProfile': './src/components/UserProfile.vue', './UserStore': './src/stores/user' }, shared: { vue: { singleton: true, requiredVersion: '^3.0.0' } } }) ] } 3.3 微前端通信方案 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 // ========== 方案1: 自定义事件总线 ========== // utils/eventBus.ts class MicroEventBus { private events: Map\u003cstring, Set\u003cFunction\u003e\u003e constructor() { this.events = new Map() } on(event: string, callback: Function) { if (!this.events.has(event)) { this.events.set(event, new Set()) } this.events.get(event)!.add(callback) } off(event: string, callback: Function) { this.events.get(event)?.delete(callback) } emit(event: string, data?: any) { this.events.get(event)?.forEach(callback =\u003e callback(data)) } } // 全局单例 export const microEventBus = new MicroEventBus() // 子应用A - 发送事件 import { microEventBus } from './eventBus' microEventBus.emit('user:login', { userId: '123', userName: 'Alice' }) // 子应用B - 监听事件 microEventBus.on('user:login', (user) =\u003e { console.log('User logged in:', user) updateUI(user) }) // ========== 方案2: 状态共享 ========== // stores/sharedStore.ts import { reactive, readonly } from 'vue' const state = reactive({ user: null, theme: 'light', locale: 'zh-CN' }) export const sharedStore = { state: readonly(state), setUser(user: any) { state.user = user }, setTheme(theme: string) { state.theme = theme }, setLocale(locale: string) { state.locale = locale } } // ========== 方案3: 全局状态管理 ========== // 使用Pinia创建跨应用store // stores/global.ts import { defineStore } from 'pinia' export const useGlobalStore = defineStore('global', { state: () =\u003e ({ currentUser: null, notifications: [] }), actions: { async login(credentials) { const user = await api.login(credentials) this.currentUser = user }, logout() { this.currentUser = null }, addNotification(notification) { this.notifications.push(notification) } } }) 3.4 样式隔离 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 // ========== 方案1: CSS Modules ========== // components/UserCard.module.css .card { padding: 20px; border-radius: 8px; background: white; } .title { font-size: 18px; color: #333; } // components/UserCard.vue \u003ctemplate\u003e \u003cdiv :class=\"$style.card\"\u003e \u003ch3 :class=\"$style.title\"\u003e{{ title }}\u003c/h3\u003e \u003c/div\u003e \u003c/template\u003e \u003cscript\u003e import styles from './UserCard.module.css' export default { $style: styles } \u003c/script\u003e // ========== 方案2: Shadow DOM ========== // components/ShadowWidget.ts class ShadowWidget extends HTMLElement { constructor() { super() // 创建Shadow DOM const shadow = this.attachShadow({ mode: 'open' }) // 隔离的样式 const style = document.createElement('style') style.textContent = ` .widget { padding: 20px; background: #f5f5f5; } .widget h3 { color: #333; margin: 0 0 10px 0; } ` // 隔离的内容 const wrapper = document.createElement('div') wrapper.className = 'widget' wrapper.innerHTML = ` Shadow DOM Widget This is isolated from host page styles\n` shadow.appendChild(style) shadow.appendChild(wrapper) } } customElements.define('shadow-widget', ShadowWidget) // ========== 方案3: CSS-in-JS ========== // 使用styled-components或emotion import styled from 'styled-components' const Card = styled.div` padding: 20px; border-radius: 8px; background: white; h3 { font-size: 18px; color: #333; } ` // 组件自动生成唯一类名 \u003cCard\u003e \u003ch3\u003eTitle\u003c/h3\u003e \u003c/Card\u003e // ========== 方案4: 命名空间 ========== // 推荐的BEM + 命名空间组合 // [子应用名]-[块]__[元素]--[修饰器] .user-center-card__header--active { background: #007bff; } .order-system-list__item--highlighted { background: #ffc107; } 四、状态管理架构 4.1 状态管理选型 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 // ========== 方案对比 ========== // 1. Redux Toolkit - 复杂应用 import { createSlice, configureStore } from '@reduxjs/toolkit' const userSlice = createSlice({ name: 'user', initialState: { user: null, status: 'idle' }, reducers: { setUser(state, action) { state.user = action.payload }, clearUser(state) { state.user = null } }, extraReducers: (builder) =\u003e { builder .addCase(fetchUser.pending, (state) =\u003e { state.status = 'loading' }) .addCase(fetchUser.fulfilled, (state, action) =\u003e { state.status = 'succeeded' state.user = action.payload }) } }) export const { setUser, clearUser } = userSlice.actions export default configureStore({ reducer: { user: userSlice.reducer } }) // 2. Zustand - 轻量级 import create from 'zustand' const useUserStore = create((set, get) =\u003e ({ user: null, status: 'idle', setUser: (user) =\u003e set({ user }), fetchUser: async (id) =\u003e { set({ status: 'loading' }) const user = await api.getUser(id) set({ user, status: 'succeeded' }) }, getUserAge: () =\u003e { const { user } = get() return user ? calculateAge(user.birthday) : 0 } })) // 3. Pinia - Vue推荐 import { defineStore } from 'pinia' export const useUserStore = defineStore('user', { state: () =\u003e ({ user: null, status: 'idle' }), getters: { isLoggedIn: (state) =\u003e !!state.user, userName: (state) =\u003e state.user?.name || 'Guest' }, actions: { async fetchUser(id) { this.status = 'loading' this.user = await api.getUser(id) this.status = 'succeeded' } } }) // 4. Jotai - 原子化状态 import { atom, useAtom } from 'jotai' // 原子状态 const userAtom = atom(null) const statusAtom = atom('idle') // 派生原子 const isLoggedInAtom = atom( (get) =\u003e !!get(userAtom) ) // 组件中使用 function UserProfile() { const [user, setUser] = useAtom(userAtom) const [status] = useAtom(statusAtom) const [isLoggedIn] = useAtom(isLoggedInAtom) // ... } 4.2 分层状态架构 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 // ========== 状态分层设计 ========== // 1. 服务端状态 - React Query / SWR import { useQuery, useMutation, useQueryClient } from '@tanstack/react-query' // 获取数据 function useUser(id: string) { return useQuery({ queryKey: ['user', id], queryFn: () =\u003e api.getUser(id), staleTime: 5 * 60 * 1000, // 5分钟 cacheTime: 10 * 60 * 1000 // 10分钟 }) } // 修改数据 function useUpdateUser() { const queryClient = useQueryClient() return useMutation({ mutationFn: ({ id, data }) =\u003e api.updateUser(id, data), onSuccess: (data, variables) =\u003e { // 自动更新缓存 queryClient.setQueryData(['user', variables.id], data) // 或使缓存失效 queryClient.invalidateQueries(['user', variables.id]) } }) } // 2. 全局UI状态 - Zustand import create from 'zustand/vanilla' const uiStore = create((set) =\u003e ({ theme: 'light', sidebarOpen: true, modalOpen: false, toggleTheme: () =\u003e set((state) =\u003e ({ theme: state.theme === 'light' ? 'dark' : 'light' })), toggleSidebar: () =\u003e set((state) =\u003e ({ sidebarOpen: !state.sidebarOpen })), openModal: () =\u003e set({ modalOpen: true }), closeModal: () =\u003e set({ modalOpen: false }) })) // 3. 表单状态 - 原子状态 import { atom, useAtom } from 'jotai' const formDataAtom = atom({ username: '', email: '', password: '' }) const formErrorsAtom = atom({}) const useForm = () =\u003e { const [data, setData] = useAtom(formDataAtom) const [errors, setErrors] = useAtom(formErrorsAtom) const updateField = (field, value) =\u003e { setData((prev) =\u003e ({ ...prev, [field]: value })) } const validate = () =\u003e { const newErrors = {} if (!data.username) newErrors.username = 'Required' if (!data.email) newErrors.email = 'Required' setErrors(newErrors) return Object.keys(newErrors).length === 0 } return { data, errors, updateField, validate } } // ========== 状态组合使用 ========== function UserProfile({ userId }) { // 服务端状态 const { data: user, isLoading } = useUser(userId) const updateUser = useUpdateUser() // UI状态 const { theme, toggleTheme } = useUiStore() // 本地状态 const [isEditing, setIsEditing] = useState(false) if (isLoading) return \u003cSpinner /\u003e return ( \u003cdiv className={theme}\u003e {isEditing ? ( \u003cEditForm user={user} onSave={(data) =\u003e updateUser.mutate({ id: userId, data })} onCancel={() =\u003e setIsEditing(false)} /\u003e ) : ( \u003cUserDetail user={user} onEdit={() =\u003e setIsEditing(true)} /\u003e )} \u003cbutton onClick={toggleTheme}\u003eToggle Theme\u003c/button\u003e \u003c/div\u003e ) } 4.3 状态持久化 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 // ========== 本地持久化方案 ========== // 1. Zustand + localStorage import { persist } from 'zustand/middleware' export const useUserStore = create( persist( (set) =\u003e ({ user: null, token: null, setUser: (user) =\u003e set({ user }), setToken: (token) =\u003e set({ token }), logout: () =\u003e set({ user: null, token: null }) }), { name: 'user-storage', // 部分持久化 partialize: (state) =\u003e ({ user: state.user, token: state.token }) } ) ) // 2. Pinia + localStorage import { createPinia } from 'pinia' import piniaPluginPersistedstate from 'pinia-plugin-persistedstate' const pinia = createPinia() pinia.use(piniaPluginPersistedstate) export const useAuthStore = defineStore('auth', { state: () =\u003e ({ token: null, refreshToken: null }), actions: { setTokens(token, refreshToken) { this.token = token this.refreshToken = refreshToken } }, persist: { key: 'auth', storage: localStorage, pick: ['token', 'refreshToken'] } }) // 3. IndexedDB - 大量数据 import { openDB } from 'idb' const dbPromise = openDB('app-db', 1, { upgrade(db) { db.createObjectStore('cache') } }) export const idbStorage = { async getItem(key) { const db = await dbPromise return await db.get('cache', key) }, async setItem(key, value) { const db = await dbPromise return await db.put('cache', value, key) }, async removeItem(key) { const db = await dbPromise return await db.delete('cache', key) } } // 4. 服务端状态同步 import { useQuery, useMutation } from '@tanstack/react-query' // 自动同步到服务端 function useSyncedState(key, initialValue) { const queryClient = useQueryClient() const { data } = useQuery({ queryKey: ['state', key], queryFn: () =\u003e api.getState(key), initialData: initialValue }) const mutation = useMutation({ mutationFn: (value) =\u003e api.setState(key, value), onSuccess: () =\u003e { queryClient.invalidateQueries(['state', key]) } }) const setState = (value) =\u003e { mutation.mutate(value) } return [data, setState] } 五、性能优化架构 5.1 代码分割策略 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 // ========== 路由级别分割 ========== // Vue Router const routes = [ { path: '/dashboard', component: () =\u003e import( /* webpackChunkName: \"dashboard\" */ './views/Dashboard.vue' ) }, { path: '/users', component: () =\u003e import( /* webpackChunkName: \"users\" */ './views/Users.vue' ) } ] // React Router const Dashboard = lazy(() =\u003e import('./views/Dashboard')) const Users = lazy(() =\u003e import('./views/Users')) function App() { return ( \u003cSuspense fallback={\u003cSpinner /\u003e}\u003e \u003cRoutes\u003e \u003cRoute path=\"/dashboard\" element={\u003cDashboard /\u003e} /\u003e \u003cRoute path=\"/users\" element={\u003cUsers /\u003e} /\u003e \u003c/Routes\u003e \u003c/Suspense\u003e ) } // ========== 组件级别分割 ========== // Vue 3 - defineAsyncComponent const HeavyComponent = defineAsyncComponent({ loader: () =\u003e import('./HeavyComponent.vue'), loadingComponent: LoadingSpinner, errorComponent: ErrorDisplay, delay: 200, timeout: 5000 }) // React - lazy + Suspense const HeavyChart = lazy(() =\u003e import('./HeavyChart')) function Dashboard() { const [showChart, setShowChart] = useState(false) return ( \u003cdiv\u003e \u003cbutton onClick={() =\u003e setShowChart(true)}\u003e Show Chart \u003c/button\u003e {showChart \u0026\u0026 ( \u003cSuspense fallback={\u003cSpinner /\u003e}\u003e \u003cHeavyChart /\u003e \u003c/Suspense\u003e )} \u003c/div\u003e ) } // ========== 条件加载 ========== // 只在需要时加载库 const loadMonaco = async () =\u003e { const monaco = await import('monaco-editor') return monaco } const loadChartLibrary = async () =\u003e { if (window.matchMedia('(prefers-reduced-motion: reduce)').matches) { return null // 用户不喜欢动画 } const chart = await import('echarts') return chart } // ========== 预加载策略 ========== // 预加载下一个可能访问的页面 function ProductList({ products }) { const prefetch = usePrefetch() const handleMouseEnter = (productId) =\u003e { // 鼠标悬停时预加载 prefetch(`/products/${productId}`) } return ( \u003cul\u003e {products.map(product =\u003e ( \u003cli key={product.id} onMouseEnter={() =\u003e handleMouseEnter(product.id)} \u003e \u003cLink to={`/products/${product.id}`}\u003e {product.name} \u003c/Link\u003e \u003c/li\u003e ))} \u003c/ul\u003e ) } // Webpack魔法注释 const ProductDetail = lazy(() =\u003e import( /* webpackPrefetch: true */ /* webpackChunkName: \"product-detail\" */ './ProductDetail' )) 5.2 渲染优化 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 174 175 176 177 178 179 180 181 182 183 184 185 186 187 188 189 190 191 192 193 194 195 196 197 198 199 200 201 202 203 // ========== 虚拟列表 ========== import { useVirtualizer } from '@tanstack/react-virtual' function VirtualList({ items }) { const parentRef = useRef() const virtualizer = useVirtualizer({ count: items.length, getScrollElement: () =\u003e parentRef.current, estimateSize: () =\u003e 50, // 每项高度 overscan: 5 // 额外渲染项数 }) return ( \u003cdiv ref={parentRef} style={{ height: '400px', overflow: 'auto' }}\u003e \u003cdiv style={{ height: `${virtualizer.getTotalSize()}px`, position: 'relative' }} \u003e {virtualizer.getVirtualItems().map(virtualItem =\u003e ( \u003cdiv key={virtualItem.key} style={{ position: 'absolute', top: 0, left: 0, width: '100%', height: `${virtualItem.size}px`, transform: `translateY(${virtualItem.start}px)` }} \u003e {items[virtualItem.index].content} \u003c/div\u003e ))} \u003c/div\u003e \u003c/div\u003e ) } // ========== 防抖/节流 ========== import { useDebouncedCallback, useThrottledCallback } from '@hooks' function SearchInput() { // 防抖搜索 const debouncedSearch = useDebouncedCallback( (query) =\u003e { performSearch(query) }, 500 // 延迟 ) return ( \u003cinput type=\"text\" onChange={(e) =\u003e debouncedSearch(e.target.value)} /\u003e ) } function ScrollHandler() { // 节流滚动事件 const throttledScroll = useThrottledCallback( () =\u003e { updatePosition() }, 100 // 间隔 ) useEffect(() =\u003e { window.addEventListener('scroll', throttledScroll) return () =\u003e window.removeEventListener('scroll', throttledScroll) }, [throttledScroll]) } // ========== React优化 ========== import { memo, useMemo, useCallback, useRef } from 'react' // 1. 组件记忆化 const ExpensiveComponent = memo(function ExpensiveComponent({ data }) { return \u003cdiv\u003e{/* 复杂渲染 */}\u003c/div\u003e }) // 2. 计算缓存 function DataProcessor({ items }) { const sorted = useMemo(() =\u003e { return items.sort((a, b) =\u003e a.value - b.value) }, [items]) // 只在items变化时重新计算 const filtered = useMemo(() =\u003e { return sorted.filter(item =\u003e item.active) }, [sorted]) return \u003cList items={filtered} /\u003e } // 3. 函数稳定化 function ParentComponent() { const [count, setCount] = useState(0) // 不稳定的函数引用 const handleClickBad = () =\u003e { setCount(count + 1) } // 稳定的函数引用 const handleClickGood = useCallback(() =\u003e { setCount(c =\u003e c + 1) }, []) // 依赖为空，函数引用不变 return \u003cChildComponent onClick={handleClickGood} /\u003e } // 4. 列表渲染优化 function TodoList({ todos, onToggle }) { const todoRefs = useRef(new Map()) const handleToggle = useCallback((id) =\u003e { // 批量更新 startTransition(() =\u003e { onToggle(id) }) }, [onToggle]) return ( \u003cul\u003e {todos.map(todo =\u003e ( \u003cTodoItem key={todo.id} ref={(node) =\u003e { if (node) { todoRefs.current.set(todo.id, node) } else { todoRefs.current.delete(todo.id) } }} todo={todo} onToggle={handleToggle} /\u003e ))} \u003c/ul\u003e ) } const TodoItem = memo(function TodoItem({ todo, onToggle }) { return ( \u003cli onClick={() =\u003e onToggle(todo.id)}\u003e {todo.text} \u003c/li\u003e ) }) // ========== Vue优化 ========== // 1. computed缓存 export default { setup() { const items = ref([]) // 计算属性自动缓存 const filtered = computed(() =\u003e { return items.value.filter(item =\u003e item.active) }) const sorted = computed(() =\u003e { return filtered.value.sort((a, b) =\u003e a.value - b.value) }) return { sorted } } } // 2. v-once/v-memo \u003ctemplate\u003e \u003cLogo v-once /\u003e \u003cdiv v-for=\"item in list\" :key=\"item.id\" v-memo=\"[item.id, item.selected]\"\u003e {{ item.text }} \u003c/div\u003e \u003c/template\u003e // 3. watchEffect优化 watchEffect((onCleanup) =\u003e { const timer = setInterval(() =\u003e { updateData() }, 1000) onCleanup(() =\u003e { clearInterval(timer) // 清理副作用 }) }) // 4. shallowRef/shallowReactive // 大对象优化 const state = shallowReactive({ // 只顶层是响应式的 items: largeItemsArray }) // 只需要重新赋值时使用 const data = shallowRef(null) 5.3 资源优化 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 174 175 176 177 178 179 180 181 182 183 184 185 186 187 188 189 190 191 192 193 194 195 196 197 198 199 200 201 202 203 204 205 206 207 208 209 210 211 212 213 214 215 216 // ========== 图片优化 ========== // 1. 响应式图片 \u003cpicture\u003e \u003csource media=\"(min-width: 1024px)\" srcSet=\"image-large.webp\" type=\"image/webp\" /\u003e \u003csource media=\"(min-width: 768px)\" srcSet=\"image-medium.webp\" type=\"image/webp\" /\u003e \u003csource srcSet=\"image-small.webp\" type=\"image/webp\" /\u003e \u003cimg src=\"image-fallback.jpg\" alt=\"Description\" loading=\"lazy\" /\u003e \u003c/picture\u003e // 2. 懒加载图片 import { lazyload } from '@utils/lazyload' function ImageWithLazy({ src, alt }) { const imgRef = useRef() const [isLoaded, setIsLoaded] = useState(false) useEffect(() =\u003e { const observer = new IntersectionObserver( (entries) =\u003e { entries.forEach(entry =\u003e { if (entry.isIntersecting) { const img = entry.target img.src = img.dataset.src observer.unobserve(img) } }) }, { rootMargin: '50px' } ) if (imgRef.current) { observer.observe(imgRef.current) } return () =\u003e observer.disconnect() }, []) return ( \u003cimg ref={imgRef} data-src={src} alt={alt} onLoad={() =\u003e setIsLoaded(true)} style={{ opacity: isLoaded ? 1 : 0 }} /\u003e ) } // 3. 图片组件封装 function OptimizedImage({ src, alt, width, height, priority = false }) { const [imageSrc, setImageSrc] = useState(null) useEffect(() =\u003e { const load = async () =\u003e { // 使用WebP转换服务 const webpSrc = await convertToWebP(src, width) setImageSrc(webpSrc) } if (priority) { load() } else { const observer = new IntersectionObserver((entries) =\u003e { if (entries[0].isIntersecting) { load() observer.disconnect() } }) // ... observe logic } }, [src, width, priority]) return \u003cimg src={imageSrc} alt={alt} loading={!priority ? 'lazy' : 'eager'} /\u003e } // ========== 字体优化 ========== // 1. 字体预加载 \u003clink rel=\"preload\" href=\"/fonts/main.woff2\" as=\"font\" type=\"font/woff2\" crossOrigin=\"anonymous\" /\u003e // 2. 字体显示策略 @font-face { font-family: 'CustomFont'; src: url('/fonts/custom.woff2') format('woff2'); font-display: swap; /* 立即显示后备字体 */ /* font-display: optional; 短暂等待后使用后备字体 */ /* font-display: fallback; 短暂等待，隐藏短时间 */ } // 3. 字体子集化 // 只包含使用的字符 // 使用fonttools或在线工具生成subset // ========== 第三方资源优化 ========== // 动态加载重型库 const loadGoogleMaps = () =\u003e { return new Promise((resolve) =\u003e { if (window.google) { resolve(window.google) return } const script = document.createElement('script') script.src = `https://maps.googleapis.com/maps/api/js?key=${API_KEY}` script.async = true script.onload = () =\u003e resolve(window.google) document.head.appendChild(script) }) } // 使用场景 function MapComponent() { const [map, setMap] = useState(null) useEffect(() =\u003e { let mounted = true loadGoogleMaps().then(google =\u003e { if (mounted) { setMap(new google.maps.Map(/* ... */)) } }) return () =\u003e { mounted = false } }, []) return \u003cdiv ref={mapRef} /\u003e } // ========== 缓存策略 ========== // Service Worker缓存 // sw.js const CACHE_NAME = 'app-v1' const STATIC_CACHE = [ '/', '/styles/main.css', '/scripts/main.js' ] self.addEventListener('install', (event) =\u003e { event.waitUntil( caches.open(CACHE_NAME).then((cache) =\u003e { return cache.addAll(STATIC_CACHE) }) ) }) self.addEventListener('fetch', (event) =\u003e { event.respondWith( caches.match(event.request).then((response) =\u003e { return response || fetch(event.request) }) ) }) // 网络优先策略 async function networkFirst(request) { try { const response = await fetch(request) const cache = await caches.open(CACHE_NAME) cache.put(request, response.clone()) return response } catch { return caches.match(request) } } // 缓存优先策略 async function cacheFirst(request) { const cached = await caches.match(request) if (cached) return cached const response = await fetch(request) const cache = await caches.open(CACHE_NAME) cache.put(request, response.clone()) return response } // 过期策略 async function staleWhileRevalidate(request) { const cache = await caches.open(CACHE_NAME) const cached = await cache.match(request) const fetchPromise = fetch(request).then((response) =\u003e { cache.put(request, response.clone()) return response }) return cached || fetchPromise } 六、构建优化 6.1 Webpack优化配置 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 // webpack.config.js const path = require('path') const TerserPlugin = require('terser-webpack-plugin') const CssMinimizerPlugin = require('css-minimizer-webpack-plugin') module.exports = { // ========== 1. 构建模式 ========== mode: 'production', // ========== 2. 代码分割 ========== optimization: { splitChunks: { chunks: 'all', cacheGroups: { // 框架代码单独打包 framework: { test: /[\\\\/]node_modules[\\\\/](react|react-dom|vue)[\\\\/]/, name: 'framework', priority: 40 }, // UI库单独打包 ui: { test: /[\\\\/]node_modules[\\\\/](@mui|@ant-design|element-plus)[\\\\/]/, name: 'ui', priority: 30 }, // 工具库 lib: { test: /[\\\\/]node_modules[\\\\/](lodash|axios|dayjs)[\\\\/]/, name: 'lib', priority: 20 }, // 公共代码 commons: { minChunks: 2, priority: 10, reuseExistingChunk: true } } }, // 运行时代码单独提取 runtimeChunk: 'single', // 压缩配置 minimize: true, minimizer: [ new TerserPlugin({ terserOptions: { parse: { ecma: 8 }, compress: { ecma: 5, warnings: false, comparisons: false, inline: 2, drop_console: true }, mangle: { safari10: true }, output: { ecma: 5, comments: false, ascii_only: true } } }), new CssMinimizerPlugin() ] }, // ========== 3. 模块解析 ========== resolve: { // 路径别名 alias: { '@': path.resolve(__dirname, 'src'), '@components': path.resolve(__dirname, 'src/components'), '@utils': path.resolve(__dirname, 'src/utils') }, // 扩展名 extensions: ['.js', '.jsx', '.ts', '.tsx', '.vue', '.json'], // 模块查找路径 modules: ['node_modules', path.resolve(__dirname, 'src')] }, // ========== 4. 缓存配置 ========== cache: { type: 'filesystem', buildDependencies: { config: [__filename] } }, // ========== 5. 输出配置 ========== output: { path: path.resolve(__dirname, 'dist'), filename: 'js/[name].[contenthash:8].js', chunkFilename: 'js/[name].[contenthash:8].chunk.js', // 资源文件名 assetModuleFilename: 'assets/[name].[hash:8][ext]' }, // ========== 6. 性能优化 ========== performance: { hints: 'warning', maxAssetSize: 244 * 1024, // 244KB maxEntrypointSize: 244 * 1024 } } 6.2 Vite优化配置 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 // vite.config.ts import { defineConfig } from 'vite' import vue from '@vitejs/plugin-vue' import { visualizer } from 'rollup-plugin-visualizer' import viteCompression from 'vite-plugin-compression' export default defineConfig({ plugins: [ vue(), // 构建分析 visualizer({ open: true, gzipSize: true, brotliSize: true }), // Gzip压缩 viteCompression({ algorithm: 'gzip', ext: '.gz' }), // Brotli压缩 viteCompression({ algorithm: 'brotliCompress', ext: '.br' }) ], build: { // 产物目录 outDir: 'dist', // 静态资源目录 assetsDir: 'assets', // 生成source map sourcemap: false, // 构建后是否生成 manifest.json manifest: true, // chunk大小警告阈值 chunkSizeWarningLimit: 1000, // 代码分割 rollupOptions: { output: { // 手动分包 manualChunks: { 'vue-vendor': ['vue', 'vue-router', 'pinia'], 'ui-lib': ['element-plus'], 'utils': ['axios', 'lodash-es', 'dayjs'] }, // 文件命名 chunkFileNames: 'js/[name]-[hash].js', entryFileNames: 'js/[name]-[hash].js', assetFileNames: '[ext]/[name]-[hash].[ext]' } }, // 压缩 minify: 'terser', terserOptions: { compress: { drop_console: true, drop_debugger: true } } }, // 依赖优化 optimizeDeps: { include: ['vue', 'vue-router', 'pinia'], exclude: ['some-large-dep'] }, // CSS配置 css: { modules: { localsConvention: 'camelCase' }, preprocessorOptions: { scss: { additionalData: `@import \"@/styles/variables.scss\";` } } }, // 开发服务器 server: { port: 3000, open: true, proxy: { '/api': { target: 'http://localhost:8080', changeOrigin: true, rewrite: (path) =\u003e path.replace(/^\\/api/, '') } } } }) 七、监控与调试 7.1 性能监控 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 174 175 176 177 178 179 180 181 182 183 184 185 186 187 188 189 190 191 192 193 194 195 196 197 198 199 200 201 202 // ========== Core Web Vitals监控 ========== // utils/performanceMonitor.ts interface PerformanceMetrics { FCP: number // First Contentful Paint LCP: number // Largest Contentful Paint FID: number // First Input Delay CLS: number // Cumulative Layout Shift TTFB: number // Time to First Byte } export class PerformanceMonitor { private metrics: Partial\u003cPerformanceMetrics\u003e = {} async collectMetrics(): Promise\u003cPerformanceMetrics\u003e { // 等待页面加载完成 await new Promise(resolve =\u003e window.addEventListener('load', resolve)) // FCP const fcpEntry = performance.getEntriesByName('first-contentful-paint')[0] as any this.metrics.FCP = fcpEntry?.startTime || 0 // LCP this.metrics.LCP = await this.getLCP() // FID this.metrics.FID = await this.getFID() // CLS this.metrics.CLS = await this.getCLS() // TTFB const navigation = performance.getEntriesByType('navigation')[0] as any this.metrics.TTFB = navigation?.responseStart || 0 return this.metrics as PerformanceMetrics } private getLCP(): Promise\u003cnumber\u003e { return new Promise(resolve =\u003e { new PerformanceObserver((list) =\u003e { const entries = list.getEntries() const lastEntry = entries[entries.length - 1] as any resolve(lastEntry?.startTime || 0) }).observe({ entryTypes: ['largest-contentful-paint'] }) }) } private getFID(): Promise\u003cnumber\u003e { return new Promise(resolve =\u003e { new PerformanceObserver((list) =\u003e { const firstInput = list.getEntries()[0] as any resolve(firstInput?.processingStart - firstInput?.startTime || 0) }).observe({ entryTypes: ['first-input'] }) }) } private getCLS(): Promise\u003cnumber\u003e { return new Promise(resolve =\u003e { let clsValue = 0 new PerformanceObserver((list) =\u003e { for (const entry of list.getEntries() as any[]) { if (!entry.hadRecentInput) { clsValue += entry.value } } resolve(clsValue) }).observe({ entryTypes: ['layout-shift'] }) }) } reportToAnalytics(metrics: PerformanceMetrics) { // 发送到分析平台 analytics.track('page_performance', { fcp: metrics.FCP, lcp: metrics.LCP, fid: metrics.FID, cls: metrics.CLS, ttfb: metrics.TTFB, url: window.location.href, userAgent: navigator.userAgent }) } } // ========== 错误监控 ========== // utils/errorTracker.ts export class ErrorTracker { private errors: Error[] = [] init() { // 全局错误捕获 window.addEventListener('error', (event) =\u003e { this.captureError(event.error || new Error(event.message)) }) // Promise拒绝捕获 window.addEventListener('unhandledrejection', (event) =\u003e { this.captureError(event.reason) }) // Vue错误处理 if (typeof app !== 'undefined' \u0026\u0026 app.config) { app.config.errorHandler = (err, instance, info) =\u003e { this.captureError(err, { componentName: instance?.$options?.name, lifecycle: info }) } } } captureError(error: Error, context?: any) { const errorInfo = { message: error.message, stack: error.stack, timestamp: Date.now(), url: window.location.href, userAgent: navigator.userAgent, context } this.errors.push(error as any) // 发送到错误追踪服务 this.sendToService(errorInfo) } private sendToService(errorInfo: any) { // 发送到Sentry、自建服务等 fetch('/api/errors', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(errorInfo) }).catch(console.error) } } // ========== 用户行为追踪 ========== // utils/analytics.ts export class UserBehaviorTracker { private events: any[] = [] trackPageView() { this.trackEvent('page_view', { url: window.location.href, referrer: document.referrer, title: document.title }) } trackClick(element: HTMLElement) { this.trackEvent('click', { tagName: element.tagName, id: element.id, className: element.className, text: element.textContent?.substring(0, 50) }) } trackScroll(depth: number) { this.trackEvent('scroll', { scrollDepth: depth, pageHeight: document.body.scrollHeight }) } trackEngagement(duration: number) { this.trackEvent('engagement', { duration, interactions: this.events.length }) } private trackEvent(type: string, data: any) { const event = { type, data, timestamp: Date.now() } this.events.push(event) this.sendEvent(event) } private sendEvent(event: any) { // 批量发送或实时发送 if (this.events.length \u003e= 10) { this.flush() } } flush() { if (this.events.length === 0) return fetch('/api/analytics/events', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ events: this.events }) }).then(() =\u003e { this.events = [] }).catch(console.error) } } 7.2 调试工具 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 // ========== Vue DevTools集成 ========== // 开发环境启用调试功能 if (import.meta.env.DEV) { app.config.devtools = true // 添加组件名称便于调试 app.component('UserProfile', UserProfile) } // ========== React DevTools ========== // 使用React Developer Tools Profiler import { Profiler } from 'react' function onRenderCallback( id, phase, actualDuration, baseDuration, startTime, commitTime ) { console.log({ id, phase, actualDuration, baseDuration, startTime, commitTime }) } \u003cProfiler id=\"UserProfile\" onRender={onRenderCallback}\u003e \u003cUserProfile /\u003e \u003c/Profiler\u003e // ========== 自定义调试工具 ========== // utils/debug.ts export const debug = { log: (...args: any[]) =\u003e { if (import.meta.env.DEV) { console.log('[DEBUG]', ...args) } }, group: (label: string, fn: () =\u003e void) =\u003e { if (import.meta.env.DEV) { console.group(label) fn() console.groupEnd() } }, time: (label: string) =\u003e { if (import.meta.env.DEV) { console.time(label) } }, timeEnd: (label: string) =\u003e { if (import.meta.env.DEV) { console.timeEnd(label) } }, track: (name: string, value: any) =\u003e { if (import.meta.env.DEV) { console.log(`[TRACK] ${name}:`, value) } } } // 使用示例 debug.time('dataFetch') fetchData().then(data =\u003e { debug.track('fetchedData', data) debug.timeEnd('dataFetch') }) 总结 构建现代前端架构需要综合考虑多个维度：\n架构设计：采用分层架构、领域驱动设计，确保代码可维护性 微前端：合理拆分应用，实现团队独立开发部署 状态管理：根据场景选择合适的状态管理方案 性能优化：代码分割、渲染优化、资源优化、构建优化 监控调试：建立完善的监控体系，持续优化 前端架构是一个不断演进的过程，需要根据项目实际情况灵活调整。\n相关工具推荐\nJSON格式化工具 - JSON数据处理 正则表达式测试 - 正则测试与调试 Base64编码工具 - 编码转换 ","wordCount":"6410","inLanguage":"zh-cn","datePublished":"2025-12-30T10:00:00+08:00","dateModified":"2025-12-30T10:00:00+08:00","author":{"@type":"Person","name":"有条工具团队"},"mainEntityOfPage":{"@type":"WebPage","@id":"/blog/articles/%E7%8E%B0%E4%BB%A3%E5%89%8D%E7%AB%AF%E6%9E%B6%E6%9E%84%E6%B7%B1%E5%BA%A6%E8%A7%A3%E6%9E%90%E6%9E%84%E5%BB%BA%E5%8F%AF%E6%89%A9%E5%B1%95%E7%9A%84%E5%A4%A7%E5%9E%8B%E5%BA%94%E7%94%A8/"},"publisher":{"@type":"Organization","name":"技术博客 - 有条工具","logo":{"@type":"ImageObject","url":"/favicon.ico"}}}</script></head><body id=top><header class=header><nav class=nav><div class=logo><a href=/blog/ accesskey=h title="技术博客 - 有条工具 (Alt + H)">技术博客 - 有条工具</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=/blog/posts/ title="所有文章列表 - 有条工具技术博客：查看所有技术文章和教程内容"><span>文章</span></a></li><li><a href=https://www.util.cn title="有条工具 - 开发者的常用工具集合：无广告 · 本地计算 · 即开即用的在线工具平台，提供JSON格式化、SQL格式化、Markdown编辑器等实用工具"><span>有条工具</span>&nbsp;
<svg fill="none" shape-rendering="geometricPrecision" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" height="12" width="12"><path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"/><path d="M15 3h6v6"/><path d="M10 14 21 3"/></svg></a></li><li><a href=/blog/categories/ title="文章分类 - 有条工具技术博客：按技术领域分类的优质文章，包括前端开发、工具使用、编程技巧等"><span>分类</span></a></li><li><a href=/blog/tags/ title="标签云 - 有条工具技术博客：通过标签快速找到感兴趣的技术文章和教程内容"><span>标签</span></a></li><li><a href=/blog/archives/ title="文章归档 - 有条工具技术博客：按时间查看历史文章"><span>归档</span></a></li><li><a href=/blog/search/ title="搜索文章 - 有条工具技术博客：通过关键词搜索找到感兴趣的技术文章和教程内容，支持标题、内容、分类和标签搜索"><span>搜索</span></a></li></ul></nav></header><main class=main><article class=post-single><div class=post-content-wrapper><main class=post-content-main><header class=post-header-main><h1 class="post-title entry-hint-parent">现代前端架构深度解析：构建可扩展的大型应用</h1><div class=post-description>深入探讨现代前端架构设计，包括微前端、模块联邦、状态管理、性能优化等核心主题，帮助开发者构建可维护、可扩展的大型前端应用。</div><div class=post-meta><div class=post-meta-content><div class=post-categories-inline><a href=/blog/categories/%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/ class=category-link>前端开发</a><a href=/blog/categories/%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1/ class=category-link>架构设计</a></div><span class=post-date>2025-12-30</span><span class=post-author>有条工具团队</span></div><style>.post-meta-content{display:flex;align-items:center;flex-wrap:wrap;gap:.75rem;font-family:sf mono,monaco,courier new,monospace;font-size:.875rem;color:#9ca3af !important}.post-categories-inline{display:inline-flex;align-items:center;gap:.5rem}.category-link{display:inline-flex;align-items:center;gap:.25rem;padding:.25rem .75rem;background:rgba(255,255,255,.1);color:#e5e7eb !important;text-decoration:none;font-size:.75rem;font-weight:600;text-transform:uppercase;letter-spacing:.05em;border:1px solid rgba(255,255,255,.2);border-radius:0;transition:all .3s ease;white-space:nowrap}.category-link:hover{background:rgba(255,255,255,.2);color:#fff !important;border-color:rgba(255,255,255,.3);transform:translateY(-1px)}.category-link::before{content:'📁';font-size:.7rem;opacity:.8}.post-date,.post-reading-time,.post-word-count,.post-author{color:#9ca3af !important}[data-theme=dark] .post-meta-content{color:#9ca3af !important}[data-theme=dark] .category-link{background:rgba(255,255,255,.1);color:#e5e7eb !important;border-color:rgba(255,255,255,.2)}[data-theme=dark] .category-link:hover{background:rgba(255,255,255,.2);color:#fff !important;border-color:rgba(255,255,255,.3)}[data-theme=dark] .post-date,[data-theme=dark] .post-reading-time,[data-theme=dark] .post-word-count,[data-theme=dark] .post-author{color:#9ca3af !important}[data-theme=light] .post-meta-content{color:#6c757d !important}[data-theme=light] .category-link{background:rgba(0,0,0,5%);color:#495057 !important;border-color:rgba(0,0,0,.15)}[data-theme=light] .category-link:hover{background:rgba(0,102,204,.1);color:#212529 !important;border-color:rgba(0,102,204,.3)}[data-theme=light] .post-date,[data-theme=light] .post-reading-time,[data-theme=light] .post-word-count,[data-theme=light] .post-author{color:#6c757d !important}@media(max-width:768px){.post-meta-content{gap:.5rem;font-size:.8rem}.category-link{padding:.2rem .6rem;font-size:.7rem}}</style></div></header><div class=post-content><h2 id=引言>引言<a hidden class=anchor aria-hidden=true href=#引言>#</a></h2><p>随着前端应用的复杂度不断增加，传统的单体前端架构已难以满足大型项目的需求。现代前端架构需要解决代码分割、团队协作、性能优化、可维护性等多方面的挑战。本文将从架构设计的角度，深入探讨如何构建可扩展的大型前端应用。</p><h2 id=一前端架构演进史>一、前端架构演进史<a hidden class=anchor aria-hidden=true href=#一前端架构演进史>#</a></h2><h3 id=11-从页面到应用的发展历程>1.1 从页面到应用的发展历程<a hidden class=anchor aria-hidden=true href=#11-从页面到应用的发展历程>#</a></h3><pre tabindex=0><code>jQuery时代 → AMD/RequireJS → CommonJS/Node.js → ES6 Modules → 现代框架时代
</code></pre><p><strong>发展阶段</strong></p><table><thead><tr><th>阶段</th><th>特点</th><th>代表技术</th><th>局限性</th></tr></thead><tbody><tr><td><strong>静态页面</strong></td><td>HTML + CSS + 少量JS</td><td>jQuery、Prototype</td><td>代码复用差</td></tr><tr><td><strong>模块化初期</strong></td><td>RequireJS、SeaJS</td><td>AMD、CMD</td><td>加载复杂</td></tr><tr><td><strong>组件化</strong></td><td>React、Vue诞生</td><td>Virtual DOM</td><td>状态管理混乱</td></tr><tr><td><strong>工程化</strong></td><td>Webpack、Rollup</td><td>ES6 Modules</td><td>构建复杂度高</td></tr><tr><td><strong>现代化</strong></td><td>Next.js、Nuxt.js</td><td>SSR、SSR Streaming</td><td>学习曲线陡峭</td></tr></tbody></table><h3 id=12-当前架构挑战>1.2 当前架构挑战<a hidden class=anchor aria-hidden=true href=#12-当前架构挑战>#</a></h3><p><strong>大型前端应用面临的核心问题</strong></p><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">21
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// 问题1: 代码组织混乱
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// src/
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>//   components/     // 1000+ 组件
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>//   pages/         // 200+ 页面
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>//   utils/         // 工具函数散落各处
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>//   api/           // API调用不规范
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// 问题2: 状态管理复杂
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// - 全局状态与局部状态边界模糊
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// - 状态流转难以追踪
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// - 多个状态管理方案混用
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// 问题3: 性能瓶颈
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// - 首屏加载时间长
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// - 路由切换卡顿
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// - 内存泄漏风险
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// 问题4: 团队协作困难
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// - 代码冲突频繁
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// - 发布周期长
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// - 技术栈不统一
</span></span></span></code></pre></td></tr></table></div></div><h2 id=二架构设计原则>二、架构设计原则<a hidden class=anchor aria-hidden=true href=#二架构设计原则>#</a></h2><h3 id=21-solid原则在前端的应用>2.1 SOLID原则在前端的应用<a hidden class=anchor aria-hidden=true href=#21-solid原则在前端的应用>#</a></h3><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">56
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">57
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">58
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">59
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">60
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">61
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">62
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">63
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">64
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">65
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">66
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">67
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">68
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">69
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">70
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">71
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">72
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">73
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">74
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// S - 单一职责原则
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// ❌ 违反单一职责
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span><span style=color:#ff7b72>class</span> UserComponent {
</span></span><span style=display:flex><span>  render() { }
</span></span><span style=display:flex><span>  fetchUser() { }
</span></span><span style=display:flex><span>  validateInput() { }
</span></span><span style=display:flex><span>  formatData() { }
</span></span><span style=display:flex><span>  logAnalytics() { }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// ✅ 遵循单一职责
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span><span style=color:#ff7b72>class</span> UserComponent {
</span></span><span style=display:flex><span>  <span style=color:#ff7b72>constructor</span>(
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>private</span> renderer: <span style=color:#ff7b72>UserRenderer</span>,
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>private</span> userService: <span style=color:#ff7b72>UserService</span>,
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>private</span> validator: <span style=color:#ff7b72>InputValidator</span>
</span></span><span style=display:flex><span>  ) { }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  render() { <span style=color:#ff7b72>this</span>.renderer.render() }
</span></span><span style=display:flex><span>  fetchUser() { <span style=color:#ff7b72>this</span>.userService.fetch() }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// O - 开闭原则
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// 使用插件系统扩展功能
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span><span style=color:#ff7b72>interface</span> ComponentPlugin {
</span></span><span style=display:flex><span>  install(component: <span style=color:#ff7b72>any</span>)<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#ff7b72>void</span>
</span></span><span style=display:flex><span>  uninstall(component: <span style=color:#ff7b72>any</span>)<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#ff7b72>void</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>class</span> Component {
</span></span><span style=display:flex><span>  <span style=color:#ff7b72>private</span> plugins: <span style=color:#ff7b72>ComponentPlugin</span>[] <span style=color:#ff7b72;font-weight:700>=</span> []
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  use(plugin: <span style=color:#ff7b72>ComponentPlugin</span>) {
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>this</span>.plugins.push(plugin)
</span></span><span style=display:flex><span>    plugin.install(<span style=color:#ff7b72>this</span>)
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>return</span> <span style=color:#ff7b72>this</span>
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// L - 里氏替换原则
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// 基类可被子类无缝替换
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span><span style=color:#ff7b72>abstract</span> <span style=color:#ff7b72>class</span> BaseStore&lt;<span style=color:#7ee787>T</span>&gt; {
</span></span><span style=display:flex><span>  <span style=color:#ff7b72>abstract</span> <span style=color:#ff7b72>get</span>(id: <span style=color:#ff7b72>string</span>)<span style=color:#ff7b72;font-weight:700>:</span> Promise&lt;<span style=color:#7ee787>T</span>&gt;
</span></span><span style=display:flex><span>  <span style=color:#ff7b72>abstract</span> <span style=color:#ff7b72>set</span>(id: <span style=color:#ff7b72>string</span>, data: <span style=color:#ff7b72>T</span>)<span style=color:#ff7b72;font-weight:700>:</span> Promise&lt;<span style=color:#7ee787>void</span>&gt;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>class</span> UserStore <span style=color:#ff7b72>extends</span> BaseStore&lt;<span style=color:#7ee787>User</span>&gt; {
</span></span><span style=display:flex><span>  <span style=color:#ff7b72>async</span> <span style=color:#ff7b72>get</span>(id: <span style=color:#ff7b72>string</span>)<span style=color:#ff7b72;font-weight:700>:</span> Promise&lt;<span style=color:#7ee787>User</span>&gt; { }
</span></span><span style=display:flex><span>  <span style=color:#ff7b72>async</span> <span style=color:#ff7b72>set</span>(id: <span style=color:#ff7b72>string</span>, data: <span style=color:#ff7b72>User</span>)<span style=color:#ff7b72;font-weight:700>:</span> Promise&lt;<span style=color:#7ee787>void</span>&gt; { }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// I - 接口隔离原则
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// 拆分大接口为小接口
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span><span style=color:#ff7b72>interface</span> ReadOnlyRepository&lt;<span style=color:#7ee787>T</span>&gt; {
</span></span><span style=display:flex><span>  findById(id: <span style=color:#ff7b72>string</span>)<span style=color:#ff7b72;font-weight:700>:</span> Promise&lt;<span style=color:#7ee787>T</span>&gt;
</span></span><span style=display:flex><span>  findAll()<span style=color:#ff7b72;font-weight:700>:</span> Promise&lt;<span style=color:#7ee787>T</span><span style=color:#f85149>[]</span>&gt;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>interface</span> WriteOnlyRepository&lt;<span style=color:#7ee787>T</span>&gt; {
</span></span><span style=display:flex><span>  create(data: <span style=color:#ff7b72>T</span>)<span style=color:#ff7b72;font-weight:700>:</span> Promise&lt;<span style=color:#7ee787>T</span>&gt;
</span></span><span style=display:flex><span>  update(id: <span style=color:#ff7b72>string</span>, data: <span style=color:#ff7b72>Partial</span>&lt;<span style=color:#7ee787>T</span>&gt;)<span style=color:#ff7b72;font-weight:700>:</span> Promise&lt;<span style=color:#7ee787>T</span>&gt;
</span></span><span style=display:flex><span>  <span style=color:#ff7b72>delete</span>(id: <span style=color:#ff7b72>string</span>)<span style=color:#ff7b72;font-weight:700>:</span> Promise&lt;<span style=color:#7ee787>void</span>&gt;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// D - 依赖倒置原则
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// 依赖抽象而非具体实现
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span><span style=color:#ff7b72>interface</span> CacheService {
</span></span><span style=display:flex><span>  <span style=color:#ff7b72>get</span>(key: <span style=color:#ff7b72>string</span>)<span style=color:#ff7b72;font-weight:700>:</span> Promise&lt;<span style=color:#7ee787>any</span>&gt;
</span></span><span style=display:flex><span>  <span style=color:#ff7b72>set</span>(key: <span style=color:#ff7b72>string</span>, value: <span style=color:#ff7b72>any</span>)<span style=color:#ff7b72;font-weight:700>:</span> Promise&lt;<span style=color:#7ee787>void</span>&gt;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>class</span> UserService {
</span></span><span style=display:flex><span>  <span style=color:#ff7b72>constructor</span>(<span style=color:#ff7b72>private</span> cache: <span style=color:#ff7b72>CacheService</span>) { }
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div><h3 id=22-分层架构>2.2 分层架构<a hidden class=anchor aria-hidden=true href=#22-分层架构>#</a></h3><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">56
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">57
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">58
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">59
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">60
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">61
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">62
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">63
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">64
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">65
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">66
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">67
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">68
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">69
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">70
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">71
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">72
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">73
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">74
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">75
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">76
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">77
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">78
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">79
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">80
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">81
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">82
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// 标准前端分层架构
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span><span style=color:#f85149>┌─────────────────────────────────────────────┐</span>
</span></span><span style=display:flex><span><span style=color:#f85149>│</span>          Presentation Layer                 <span style=color:#f85149>│</span>
</span></span><span style=display:flex><span><span style=color:#f85149>│</span>  (Components, Pages, UI Logic)              <span style=color:#f85149>│</span>
</span></span><span style=display:flex><span><span style=color:#f85149>├─────────────────────────────────────────────┤</span>
</span></span><span style=display:flex><span><span style=color:#f85149>│</span>          Business Logic Layer               <span style=color:#f85149>│</span>
</span></span><span style=display:flex><span><span style=color:#f85149>│</span>  (Hooks, Composables, Use Cases)            <span style=color:#f85149>│</span>
</span></span><span style=display:flex><span><span style=color:#f85149>├─────────────────────────────────────────────┤</span>
</span></span><span style=display:flex><span><span style=color:#f85149>│</span>          Data Access Layer                  <span style=color:#f85149>│</span>
</span></span><span style=display:flex><span><span style=color:#f85149>│</span>  (API Client, Cache, State Management)      <span style=color:#f85149>│</span>
</span></span><span style=display:flex><span><span style=color:#f85149>├─────────────────────────────────────────────┤</span>
</span></span><span style=display:flex><span><span style=color:#f85149>│</span>          Infrastructure Layer               <span style=color:#f85149>│</span>
</span></span><span style=display:flex><span><span style=color:#f85149>│</span>  (HTTP, WebSocket, LocalStorage)            <span style=color:#f85149>│</span>
</span></span><span style=display:flex><span><span style=color:#f85149>└─────────────────────────────────────────────┘</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// 实现示例
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// ========== Presentation Layer ==========
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// views/UserList.vue
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>&lt;<span style=color:#7ee787>template</span>&gt;
</span></span><span style=display:flex><span>  &lt;<span style=color:#7ee787>UserDataTable</span>
</span></span><span style=display:flex><span>    <span style=color:#f85149>:</span>users<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>&#34;users&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f85149>:</span>loading<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>&#34;loading&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f85149>@</span>refresh<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>&#34;handleRefresh&#34;</span>
</span></span><span style=display:flex><span>  /&gt;
</span></span><span style=display:flex><span>&lt;/<span style=color:#7ee787>template</span>&gt;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// ========== Business Logic Layer ==========
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// composables/useUserList.ts
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span><span style=color:#ff7b72>export</span> <span style=color:#ff7b72>function</span> useUserList() {
</span></span><span style=display:flex><span>  <span style=color:#ff7b72>const</span> { users, loading, error, fetch } <span style=color:#ff7b72;font-weight:700>=</span> userRepository()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#ff7b72>const</span> refresh <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#ff7b72>async</span> () <span style=color:#ff7b72;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>await</span> fetch()
</span></span><span style=display:flex><span>    analytics.track(<span style=color:#a5d6ff>&#39;user_list_refreshed&#39;</span>)
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#ff7b72>const</span> filteredUsers <span style=color:#ff7b72;font-weight:700>=</span> computed(() <span style=color:#ff7b72;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>return</span> users.value.filter(user <span style=color:#ff7b72;font-weight:700>=&gt;</span> user.active)
</span></span><span style=display:flex><span>  })
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#ff7b72>return</span> {
</span></span><span style=display:flex><span>    users: <span style=color:#ff7b72>filteredUsers</span>,
</span></span><span style=display:flex><span>    loading,
</span></span><span style=display:flex><span>    error,
</span></span><span style=display:flex><span>    refresh
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// ========== Data Access Layer ==========
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// repositories/userRepository.ts
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span><span style=color:#ff7b72>export</span> <span style=color:#ff7b72>function</span> userRepository() {
</span></span><span style=display:flex><span>  <span style=color:#ff7b72>const</span> api <span style=color:#ff7b72;font-weight:700>=</span> useApiClient()
</span></span><span style=display:flex><span>  <span style=color:#ff7b72>const</span> cache <span style=color:#ff7b72;font-weight:700>=</span> useCache()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#ff7b72>const</span> fetch <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#ff7b72>async</span> () <span style=color:#ff7b72;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>const</span> cached <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#ff7b72>await</span> cache.<span style=color:#ff7b72>get</span>(<span style=color:#a5d6ff>&#39;users&#39;</span>)
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>if</span> (cached) <span style=color:#ff7b72>return</span> cached
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>const</span> data <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#ff7b72>await</span> api.<span style=color:#ff7b72>get</span>(<span style=color:#a5d6ff>&#39;/users&#39;</span>)
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>await</span> cache.<span style=color:#ff7b72>set</span>(<span style=color:#a5d6ff>&#39;users&#39;</span>, data, <span style=color:#a5d6ff>300</span>) <span style=color:#8b949e;font-style:italic>// 5分钟
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>    <span style=color:#ff7b72>return</span> data
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#ff7b72>return</span> {
</span></span><span style=display:flex><span>    users: <span style=color:#ff7b72>ref</span>([]),
</span></span><span style=display:flex><span>    loading: <span style=color:#ff7b72>ref</span>(<span style=color:#79c0ff>false</span>),
</span></span><span style=display:flex><span>    error: <span style=color:#ff7b72>ref</span>(<span style=color:#79c0ff>null</span>),
</span></span><span style=display:flex><span>    fetch
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// ========== Infrastructure Layer ===========
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// utils/apiClient.ts
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span><span style=color:#ff7b72>class</span> ApiClient {
</span></span><span style=display:flex><span>  <span style=color:#ff7b72>private</span> baseURL: <span style=color:#ff7b72>string</span>
</span></span><span style=display:flex><span>  <span style=color:#ff7b72>private</span> interceptors: <span style=color:#ff7b72>RequestInterceptor</span>[]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#ff7b72>async</span> <span style=color:#ff7b72>get</span>&lt;<span style=color:#7ee787>T</span>&gt;(url: <span style=color:#ff7b72>string</span>)<span style=color:#ff7b72;font-weight:700>:</span> Promise&lt;<span style=color:#7ee787>T</span>&gt; {
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>const</span> request <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#ff7b72>new</span> Request(<span style=color:#ff7b72>this</span>.baseURL <span style=color:#ff7b72;font-weight:700>+</span> url)
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>return</span> <span style=color:#ff7b72>this</span>.execute&lt;<span style=color:#7ee787>T</span>&gt;(request)
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div><h3 id=23-领域驱动设计ddd在前端>2.3 领域驱动设计(DDD)在前端<a hidden class=anchor aria-hidden=true href=#23-领域驱动设计ddd在前端>#</a></h3><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 56
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 57
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 58
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 59
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 60
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 61
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 62
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 63
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 64
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 65
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 66
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 67
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 68
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 69
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 70
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 71
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 72
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 73
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 74
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 75
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 76
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 77
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 78
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 79
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 80
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 81
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 82
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 83
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 84
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 85
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 86
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 87
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 88
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 89
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 90
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 91
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 92
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 93
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 94
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 95
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 96
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 97
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 98
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 99
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">100
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">101
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">102
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">103
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">104
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">105
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">106
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">107
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">108
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">109
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">110
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">111
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">112
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">113
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">114
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">115
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">116
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">117
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">118
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">119
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">120
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">121
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">122
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">123
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">124
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// 1. 领域模型定义
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// domains/user/User.ts
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span><span style=color:#ff7b72>export</span> <span style=color:#ff7b72>class</span> User {
</span></span><span style=display:flex><span>  <span style=color:#ff7b72>constructor</span>(
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>private</span> <span style=color:#ff7b72>readonly</span> id: <span style=color:#ff7b72>UserId</span>,
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>private</span> <span style=color:#ff7b72>readonly</span> email: <span style=color:#ff7b72>Email</span>,
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>private</span> name: <span style=color:#ff7b72>UserName</span>,
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>private</span> status: <span style=color:#ff7b72>UserStatus</span>
</span></span><span style=display:flex><span>  ) {}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#8b949e;font-style:italic>// 领域逻辑
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>  activate()<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#ff7b72>void</span> {
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>if</span> (<span style=color:#ff7b72>this</span>.status <span style=color:#ff7b72;font-weight:700>===</span> UserStatus.ACTIVE) {
</span></span><span style=display:flex><span>      <span style=color:#ff7b72>throw</span> <span style=color:#ff7b72>new</span> Error(<span style=color:#a5d6ff>&#39;User already active&#39;</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>this</span>.status <span style=color:#ff7b72;font-weight:700>=</span> UserStatus.ACTIVE
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  deactivate()<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#ff7b72>void</span> {
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>this</span>.status <span style=color:#ff7b72;font-weight:700>=</span> UserStatus.INACTIVE
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  isActive()<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#ff7b72>boolean</span> {
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>return</span> <span style=color:#ff7b72>this</span>.status <span style=color:#ff7b72;font-weight:700>===</span> UserStatus.ACTIVE
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// 值对象
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span><span style=color:#ff7b72>export</span> <span style=color:#ff7b72>class</span> Email {
</span></span><span style=display:flex><span>  <span style=color:#ff7b72>constructor</span>(<span style=color:#ff7b72>private</span> <span style=color:#ff7b72>readonly</span> value: <span style=color:#ff7b72>string</span>) {
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>if</span> (<span style=color:#ff7b72;font-weight:700>!</span><span style=color:#ff7b72>this</span>.validate(value)) {
</span></span><span style=display:flex><span>      <span style=color:#ff7b72>throw</span> <span style=color:#ff7b72>new</span> Error(<span style=color:#a5d6ff>&#39;Invalid email&#39;</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#ff7b72>private</span> validate(email: <span style=color:#ff7b72>string</span>)<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#ff7b72>boolean</span> {
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>return</span> <span style=color:#79c0ff>/^[^\s@]+@[^\s@]+\.[^\s@]+$/</span>.test(email)
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  getValue()<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#ff7b72>string</span> {
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>return</span> <span style=color:#ff7b72>this</span>.value
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// 2. 领域服务
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// domains/user/UserService.ts
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span><span style=color:#ff7b72>export</span> <span style=color:#ff7b72>class</span> UserService {
</span></span><span style=display:flex><span>  <span style=color:#ff7b72>constructor</span>(
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>private</span> userRepo: <span style=color:#ff7b72>UserRepository</span>,
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>private</span> emailService: <span style=color:#ff7b72>EmailService</span>
</span></span><span style=display:flex><span>  ) {}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#ff7b72>async</span> registerUser(data: <span style=color:#ff7b72>RegisterUserData</span>)<span style=color:#ff7b72;font-weight:700>:</span> Promise&lt;<span style=color:#7ee787>User</span>&gt; {
</span></span><span style=display:flex><span>    <span style=color:#8b949e;font-style:italic>// 业务规则验证
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>    <span style=color:#ff7b72>if</span> (<span style=color:#ff7b72>await</span> <span style=color:#ff7b72>this</span>.userRepo.existsByEmail(data.email)) {
</span></span><span style=display:flex><span>      <span style=color:#ff7b72>throw</span> <span style=color:#ff7b72>new</span> Error(<span style=color:#a5d6ff>&#39;Email already registered&#39;</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8b949e;font-style:italic>// 创建领域对象
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>    <span style=color:#ff7b72>const</span> user <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#ff7b72>new</span> User(
</span></span><span style=display:flex><span>      UserId.generate(),
</span></span><span style=display:flex><span>      <span style=color:#ff7b72>new</span> Email(data.email),
</span></span><span style=display:flex><span>      <span style=color:#ff7b72>new</span> UserName(data.name),
</span></span><span style=display:flex><span>      UserStatus.PENDING
</span></span><span style=display:flex><span>    )
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8b949e;font-style:italic>// 持久化
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>    <span style=color:#ff7b72>await</span> <span style=color:#ff7b72>this</span>.userRepo.save(user)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8b949e;font-style:italic>// 发送欢迎邮件
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>    <span style=color:#ff7b72>await</span> <span style=color:#ff7b72>this</span>.emailService.sendWelcome(user.email.getValue())
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>return</span> user
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// 3. 应用服务（用例）
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// application/useCases/RegisterUserUseCase.ts
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span><span style=color:#ff7b72>export</span> <span style=color:#ff7b72>class</span> RegisterUserUseCase {
</span></span><span style=display:flex><span>  <span style=color:#ff7b72>constructor</span>(<span style=color:#ff7b72>private</span> userService: <span style=color:#ff7b72>UserService</span>) { }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#ff7b72>async</span> execute(request: <span style=color:#ff7b72>RegisterUserRequest</span>)<span style=color:#ff7b72;font-weight:700>:</span> Promise&lt;<span style=color:#7ee787>RegisterUserResponse</span>&gt; {
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>try</span> {
</span></span><span style=display:flex><span>      <span style=color:#ff7b72>const</span> user <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#ff7b72>await</span> <span style=color:#ff7b72>this</span>.userService.registerUser(request.data)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      <span style=color:#ff7b72>return</span> {
</span></span><span style=display:flex><span>        success: <span style=color:#ff7b72>true</span>,
</span></span><span style=display:flex><span>        userId: <span style=color:#ff7b72>user.id.getValue</span>(),
</span></span><span style=display:flex><span>        message<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#a5d6ff>&#39;Registration successful&#39;</span>
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>    } <span style=color:#ff7b72>catch</span> (error) {
</span></span><span style=display:flex><span>      <span style=color:#ff7b72>return</span> {
</span></span><span style=display:flex><span>        success: <span style=color:#ff7b72>false</span>,
</span></span><span style=display:flex><span>        error: <span style=color:#ff7b72>error.message</span>
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// 4. 在组件中使用
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// components/RegisterForm.vue
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span><span style=color:#ff7b72>export</span> <span style=color:#ff7b72>default</span> {
</span></span><span style=display:flex><span>  setup() {
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>const</span> registerUser <span style=color:#ff7b72;font-weight:700>=</span> useRegisterUserUseCase()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>const</span> handleSubmit <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#ff7b72>async</span> (formData) <span style=color:#ff7b72;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span>      <span style=color:#ff7b72>const</span> result <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#ff7b72>await</span> registerUser.execute({
</span></span><span style=display:flex><span>        data<span style=color:#ff7b72;font-weight:700>:</span> {
</span></span><span style=display:flex><span>          email: <span style=color:#ff7b72>formData.email</span>,
</span></span><span style=display:flex><span>          name: <span style=color:#ff7b72>formData.name</span>,
</span></span><span style=display:flex><span>          password: <span style=color:#ff7b72>formData.password</span>
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>      })
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      <span style=color:#ff7b72>if</span> (result.success) {
</span></span><span style=display:flex><span>        router.push(<span style=color:#a5d6ff>`/welcome/</span><span style=color:#a5d6ff>${</span>result.userId<span style=color:#a5d6ff>}</span><span style=color:#a5d6ff>`</span>)
</span></span><span style=display:flex><span>      } <span style=color:#ff7b72>else</span> {
</span></span><span style=display:flex><span>        showError(result.error)
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>return</span> { handleSubmit }
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div><h2 id=三微前端架构>三、微前端架构<a hidden class=anchor aria-hidden=true href=#三微前端架构>#</a></h2><h3 id=31-微前端架构模式>3.1 微前端架构模式<a hidden class=anchor aria-hidden=true href=#31-微前端架构模式>#</a></h3><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">40
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// 模式1: 路由分发
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// 主应用根据路由加载不同子应用
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span><span style=color:#ff7b72>const</span> microApps <span style=color:#ff7b72;font-weight:700>=</span> [
</span></span><span style=display:flex><span>  {
</span></span><span style=display:flex><span>    name<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#a5d6ff>&#39;user-center&#39;</span>,
</span></span><span style=display:flex><span>    entry<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#a5d6ff>&#39;//localhost:3001&#39;</span>,
</span></span><span style=display:flex><span>    container<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#a5d6ff>&#39;#subapp&#39;</span>,
</span></span><span style=display:flex><span>    activeRule<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#a5d6ff>&#39;/users&#39;</span>
</span></span><span style=display:flex><span>  },
</span></span><span style=display:flex><span>  {
</span></span><span style=display:flex><span>    name<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#a5d6ff>&#39;order-system&#39;</span>,
</span></span><span style=display:flex><span>    entry<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#a5d6ff>&#39;//localhost:3002&#39;</span>,
</span></span><span style=display:flex><span>    container<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#a5d6ff>&#39;#subapp&#39;</span>,
</span></span><span style=display:flex><span>    activeRule<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#a5d6ff>&#39;/orders&#39;</span>
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// 模式2: 组合式集成
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// 主应用提供容器，子应用作为组件渲染
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>&lt;<span style=color:#7ee787>template</span>&gt;
</span></span><span style=display:flex><span>  &lt;<span style=color:#7ee787>div</span>&gt;
</span></span><span style=display:flex><span>    &lt;<span style=color:#7ee787>AppHeader</span> /&gt;
</span></span><span style=display:flex><span>    &lt;<span style=color:#7ee787>MicroApp</span> name<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>&#34;user-center&#34;</span> <span style=color:#f85149>:</span>props<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>&#34;userProps&#34;</span> /&gt;
</span></span><span style=display:flex><span>    &lt;<span style=color:#7ee787>AppFooter</span> /&gt;
</span></span><span style=display:flex><span>  &lt;/<span style=color:#7ee787>div</span>&gt;
</span></span><span style=display:flex><span>&lt;/<span style=color:#7ee787>template</span>&gt;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// 模式3: EMP (EMP Module Federation)
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// 去中心化的模块共享
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// 子应用A
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span><span style=color:#ff7b72>new</span> ModuleFederationPlugin({
</span></span><span style=display:flex><span>  name<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#a5d6ff>&#39;appA&#39;</span>,
</span></span><span style=display:flex><span>  exposes<span style=color:#ff7b72;font-weight:700>:</span> {
</span></span><span style=display:flex><span>    <span style=color:#a5d6ff>&#39;./UserList&#39;</span><span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#a5d6ff>&#39;./src/components/UserList&#39;</span>
</span></span><span style=display:flex><span>  },
</span></span><span style=display:flex><span>  shared<span style=color:#ff7b72;font-weight:700>:</span> [<span style=color:#a5d6ff>&#39;vue&#39;</span>, <span style=color:#a5d6ff>&#39;vue-router&#39;</span>]
</span></span><span style=display:flex><span>})
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// 子应用B使用A的组件
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span><span style=color:#ff7b72>import</span> UserList <span style=color:#ff7b72>from</span> <span style=color:#a5d6ff>&#39;appA/UserList&#39;</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=32-模块联邦实现>3.2 模块联邦实现<a hidden class=anchor aria-hidden=true href=#32-模块联邦实现>#</a></h3><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">56
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">57
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">58
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">59
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">60
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">61
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">62
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">63
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">64
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">65
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">66
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">67
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// webpack.config.js - 主应用
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span><span style=color:#ff7b72>const</span> ModuleFederationPlugin <span style=color:#ff7b72;font-weight:700>=</span> require(<span style=color:#a5d6ff>&#39;webpack/lib/container/ModuleFederationPlugin&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>module.exports <span style=color:#ff7b72;font-weight:700>=</span> {
</span></span><span style=display:flex><span>  plugins<span style=color:#ff7b72;font-weight:700>:</span> [
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>new</span> ModuleFederationPlugin({
</span></span><span style=display:flex><span>      name<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#a5d6ff>&#39;host_app&#39;</span>,
</span></span><span style=display:flex><span>      remotes<span style=color:#ff7b72;font-weight:700>:</span> {
</span></span><span style=display:flex><span>        userApp<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#a5d6ff>&#39;user_app@http://localhost:3001/remoteEntry.js&#39;</span>,
</span></span><span style=display:flex><span>        orderApp<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#a5d6ff>&#39;order_app@http://localhost:3002/remoteEntry.js&#39;</span>
</span></span><span style=display:flex><span>      },
</span></span><span style=display:flex><span>      shared<span style=color:#ff7b72;font-weight:700>:</span> {
</span></span><span style=display:flex><span>        vue<span style=color:#ff7b72;font-weight:700>:</span> {
</span></span><span style=display:flex><span>          singleton<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#79c0ff>true</span>,
</span></span><span style=display:flex><span>          requiredVersion<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#a5d6ff>&#39;^3.0.0&#39;</span>
</span></span><span style=display:flex><span>        },
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#39;vue-router&#39;</span><span style=color:#ff7b72;font-weight:700>:</span> {
</span></span><span style=display:flex><span>          singleton<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#79c0ff>true</span>
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>    })
</span></span><span style=display:flex><span>  ]
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// 在主应用中使用远程模块
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// src/App.vue
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span><span style=color:#ff7b72;font-weight:700>&lt;</span>script<span style=color:#ff7b72;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>import</span> { defineAsyncComponent } from <span style=color:#a5d6ff>&#39;vue&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// 动态加载远程组件
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span><span style=color:#ff7b72>const</span> UserDashboard <span style=color:#ff7b72;font-weight:700>=</span> defineAsyncComponent(() =&gt;
</span></span><span style=display:flex><span>  <span style=color:#ff7b72>import</span>(<span style=color:#a5d6ff>&#39;userApp/Dashboard&#39;</span>)
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>const</span> OrderList <span style=color:#ff7b72;font-weight:700>=</span> defineAsyncComponent(() =&gt;
</span></span><span style=display:flex><span>  <span style=color:#ff7b72>import</span>(<span style=color:#a5d6ff>&#39;orderApp/OrderList&#39;</span>)
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>export</span> <span style=color:#ff7b72>default</span> {
</span></span><span style=display:flex><span>  components<span style=color:#ff7b72;font-weight:700>:</span> {
</span></span><span style=display:flex><span>    UserDashboard,
</span></span><span style=display:flex><span>    OrderList
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#ff7b72;font-weight:700>&lt;</span><span style=color:#f85149>/script&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// 子应用配置 - userApp
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// webpack.config.js
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>module.exports <span style=color:#ff7b72;font-weight:700>=</span> {
</span></span><span style=display:flex><span>  plugins<span style=color:#ff7b72;font-weight:700>:</span> [
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>new</span> ModuleFederationPlugin({
</span></span><span style=display:flex><span>      name<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#a5d6ff>&#39;user_app&#39;</span>,
</span></span><span style=display:flex><span>      filename<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#a5d6ff>&#39;remoteEntry.js&#39;</span>,
</span></span><span style=display:flex><span>      exposes<span style=color:#ff7b72;font-weight:700>:</span> {
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#39;./Dashboard&#39;</span><span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#a5d6ff>&#39;./src/components/Dashboard.vue&#39;</span>,
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#39;./UserProfile&#39;</span><span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#a5d6ff>&#39;./src/components/UserProfile.vue&#39;</span>,
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#39;./UserStore&#39;</span><span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#a5d6ff>&#39;./src/stores/user&#39;</span>
</span></span><span style=display:flex><span>      },
</span></span><span style=display:flex><span>      shared<span style=color:#ff7b72;font-weight:700>:</span> {
</span></span><span style=display:flex><span>        vue<span style=color:#ff7b72;font-weight:700>:</span> {
</span></span><span style=display:flex><span>          singleton<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#79c0ff>true</span>,
</span></span><span style=display:flex><span>          requiredVersion<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#a5d6ff>&#39;^3.0.0&#39;</span>
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>    })
</span></span><span style=display:flex><span>  ]
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div><h3 id=33-微前端通信方案>3.3 微前端通信方案<a hidden class=anchor aria-hidden=true href=#33-微前端通信方案>#</a></h3><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">56
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">57
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">58
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">59
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">60
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">61
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">62
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">63
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">64
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">65
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">66
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">67
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">68
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">69
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">70
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">71
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">72
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">73
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">74
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">75
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">76
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">77
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">78
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">79
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">80
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">81
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">82
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">83
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">84
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">85
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">86
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">87
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">88
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">89
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">90
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">91
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">92
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">93
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">94
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// ========== 方案1: 自定义事件总线 ==========
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// utils/eventBus.ts
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span><span style=color:#ff7b72>class</span> MicroEventBus {
</span></span><span style=display:flex><span>  <span style=color:#ff7b72>private</span> events: <span style=color:#ff7b72>Map</span>&lt;<span style=color:#7ee787>string</span>, Set&lt;<span style=color:#7ee787>Function</span>&gt;&gt;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#ff7b72>constructor</span>() {
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>this</span>.events <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#ff7b72>new</span> Map()
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  on(event: <span style=color:#ff7b72>string</span>, callback: <span style=color:#ff7b72>Function</span>) {
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>if</span> (<span style=color:#ff7b72;font-weight:700>!</span><span style=color:#ff7b72>this</span>.events.has(event)) {
</span></span><span style=display:flex><span>      <span style=color:#ff7b72>this</span>.events.<span style=color:#ff7b72>set</span>(event, <span style=color:#ff7b72>new</span> Set())
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>this</span>.events.<span style=color:#ff7b72>get</span>(event)<span style=color:#ff7b72;font-weight:700>!</span>.add(callback)
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  off(event: <span style=color:#ff7b72>string</span>, callback: <span style=color:#ff7b72>Function</span>) {
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>this</span>.events.<span style=color:#ff7b72>get</span>(event)<span style=color:#ff7b72;font-weight:700>?</span>.<span style=color:#ff7b72>delete</span>(callback)
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  emit(event: <span style=color:#ff7b72>string</span>, data?: <span style=color:#ff7b72>any</span>) {
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>this</span>.events.<span style=color:#ff7b72>get</span>(event)<span style=color:#ff7b72;font-weight:700>?</span>.forEach(callback <span style=color:#ff7b72;font-weight:700>=&gt;</span> callback(data))
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// 全局单例
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span><span style=color:#ff7b72>export</span> <span style=color:#ff7b72>const</span> microEventBus <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#ff7b72>new</span> MicroEventBus()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// 子应用A - 发送事件
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span><span style=color:#ff7b72>import</span> { microEventBus } <span style=color:#ff7b72>from</span> <span style=color:#a5d6ff>&#39;./eventBus&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>microEventBus.emit(<span style=color:#a5d6ff>&#39;user:login&#39;</span>, {
</span></span><span style=display:flex><span>  userId<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#a5d6ff>&#39;123&#39;</span>,
</span></span><span style=display:flex><span>  userName<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#a5d6ff>&#39;Alice&#39;</span>
</span></span><span style=display:flex><span>})
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// 子应用B - 监听事件
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>microEventBus.on(<span style=color:#a5d6ff>&#39;user:login&#39;</span>, (user) <span style=color:#ff7b72;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span>  console.log(<span style=color:#a5d6ff>&#39;User logged in:&#39;</span>, user)
</span></span><span style=display:flex><span>  updateUI(user)
</span></span><span style=display:flex><span>})
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// ========== 方案2: 状态共享 ==========
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// stores/sharedStore.ts
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span><span style=color:#ff7b72>import</span> { reactive, <span style=color:#ff7b72>readonly</span> } <span style=color:#ff7b72>from</span> <span style=color:#a5d6ff>&#39;vue&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>const</span> state <span style=color:#ff7b72;font-weight:700>=</span> reactive({
</span></span><span style=display:flex><span>  user: <span style=color:#ff7b72>null</span>,
</span></span><span style=display:flex><span>  theme<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#a5d6ff>&#39;light&#39;</span>,
</span></span><span style=display:flex><span>  locale<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#a5d6ff>&#39;zh-CN&#39;</span>
</span></span><span style=display:flex><span>})
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>export</span> <span style=color:#ff7b72>const</span> sharedStore <span style=color:#ff7b72;font-weight:700>=</span> {
</span></span><span style=display:flex><span>  state: <span style=color:#ff7b72>readonly</span>(state),
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  setUser(user: <span style=color:#ff7b72>any</span>) {
</span></span><span style=display:flex><span>    state.user <span style=color:#ff7b72;font-weight:700>=</span> user
</span></span><span style=display:flex><span>  },
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  setTheme(theme: <span style=color:#ff7b72>string</span>) {
</span></span><span style=display:flex><span>    state.theme <span style=color:#ff7b72;font-weight:700>=</span> theme
</span></span><span style=display:flex><span>  },
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  setLocale(locale: <span style=color:#ff7b72>string</span>) {
</span></span><span style=display:flex><span>    state.locale <span style=color:#ff7b72;font-weight:700>=</span> locale
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// ========== 方案3: 全局状态管理 ==========
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// 使用Pinia创建跨应用store
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// stores/global.ts
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span><span style=color:#ff7b72>import</span> { defineStore } <span style=color:#ff7b72>from</span> <span style=color:#a5d6ff>&#39;pinia&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>export</span> <span style=color:#ff7b72>const</span> useGlobalStore <span style=color:#ff7b72;font-weight:700>=</span> defineStore(<span style=color:#a5d6ff>&#39;global&#39;</span>, {
</span></span><span style=display:flex><span>  state<span style=color:#ff7b72;font-weight:700>:</span> () <span style=color:#ff7b72;font-weight:700>=&gt;</span> ({
</span></span><span style=display:flex><span>    currentUser: <span style=color:#ff7b72>null</span>,
</span></span><span style=display:flex><span>    notifications<span style=color:#ff7b72;font-weight:700>:</span> []
</span></span><span style=display:flex><span>  }),
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  actions<span style=color:#ff7b72;font-weight:700>:</span> {
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>async</span> login(credentials) {
</span></span><span style=display:flex><span>      <span style=color:#ff7b72>const</span> user <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#ff7b72>await</span> api.login(credentials)
</span></span><span style=display:flex><span>      <span style=color:#ff7b72>this</span>.currentUser <span style=color:#ff7b72;font-weight:700>=</span> user
</span></span><span style=display:flex><span>    },
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    logout() {
</span></span><span style=display:flex><span>      <span style=color:#ff7b72>this</span>.currentUser <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#79c0ff>null</span>
</span></span><span style=display:flex><span>    },
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    addNotification(notification) {
</span></span><span style=display:flex><span>      <span style=color:#ff7b72>this</span>.notifications.push(notification)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>})
</span></span></code></pre></td></tr></table></div></div><h3 id=34-样式隔离>3.4 样式隔离<a hidden class=anchor aria-hidden=true href=#34-样式隔离>#</a></h3><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">56
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">57
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">58
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">59
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">60
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">61
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">62
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">63
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">64
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">65
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">66
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">67
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">68
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">69
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">70
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">71
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">72
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">73
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">74
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">75
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">76
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">77
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">78
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">79
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">80
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">81
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">82
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">83
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">84
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">85
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">86
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">87
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">88
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">89
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">90
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">91
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">92
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">93
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">94
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// ========== 方案1: CSS Modules ==========
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// components/UserCard.module.css
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>.card {
</span></span><span style=display:flex><span>  padding: <span style=color:#ff7b72>20px</span>;
</span></span><span style=display:flex><span>  border<span style=color:#ff7b72;font-weight:700>-</span>radius: <span style=color:#ff7b72>8px</span>;
</span></span><span style=display:flex><span>  background: <span style=color:#ff7b72>white</span>;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>.title {
</span></span><span style=display:flex><span>  font<span style=color:#ff7b72;font-weight:700>-</span>size: <span style=color:#ff7b72>18px</span>;
</span></span><span style=display:flex><span>  color<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#f85149>#</span><span style=color:#a5d6ff>333</span>;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// components/UserCard.vue
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>&lt;<span style=color:#7ee787>template</span>&gt;
</span></span><span style=display:flex><span>  &lt;<span style=color:#7ee787>div</span> <span style=color:#f85149>:</span>class<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>&#34;$style.card&#34;</span>&gt;
</span></span><span style=display:flex><span>    &lt;<span style=color:#7ee787>h3</span> <span style=color:#f85149>:</span>class<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>&#34;$style.title&#34;</span>&gt;{{ title }}&lt;/<span style=color:#7ee787>h3</span>&gt;
</span></span><span style=display:flex><span>  &lt;/<span style=color:#7ee787>div</span>&gt;
</span></span><span style=display:flex><span>&lt;/<span style=color:#7ee787>template</span>&gt;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>&lt;<span style=color:#7ee787>script</span>&gt;
</span></span><span style=display:flex><span><span style=color:#ff7b72>import</span> styles <span style=color:#ff7b72>from</span> <span style=color:#a5d6ff>&#39;./UserCard.module.css&#39;</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>export</span> <span style=color:#ff7b72>default</span> {
</span></span><span style=display:flex><span>  $style: <span style=color:#ff7b72>styles</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>&lt;/<span style=color:#7ee787>script</span>&gt;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// ========== 方案2: Shadow DOM ==========
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// components/ShadowWidget.ts
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span><span style=color:#ff7b72>class</span> ShadowWidget <span style=color:#ff7b72>extends</span> HTMLElement {
</span></span><span style=display:flex><span>  <span style=color:#ff7b72>constructor</span>() {
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>super</span>()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8b949e;font-style:italic>// 创建Shadow DOM
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>    <span style=color:#ff7b72>const</span> shadow <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#ff7b72>this</span>.attachShadow({ mode<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#a5d6ff>&#39;open&#39;</span> })
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8b949e;font-style:italic>// 隔离的样式
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>    <span style=color:#ff7b72>const</span> style <span style=color:#ff7b72;font-weight:700>=</span> document.createElement(<span style=color:#a5d6ff>&#39;style&#39;</span>)
</span></span><span style=display:flex><span>    style.textContent <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>`
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>      .widget {
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>        padding: 20px;
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>        background: #f5f5f5;
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>      }
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>      .widget h3 {
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>        color: #333;
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>        margin: 0 0 10px 0;
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>      }
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>    `</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8b949e;font-style:italic>// 隔离的内容
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>    <span style=color:#ff7b72>const</span> wrapper <span style=color:#ff7b72;font-weight:700>=</span> document.createElement(<span style=color:#a5d6ff>&#39;div&#39;</span>)
</span></span><span style=display:flex><span>    wrapper.className <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>&#39;widget&#39;</span>
</span></span><span style=display:flex><span>    wrapper.innerHTML <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>`
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>      &lt;h3&gt;Shadow DOM Widget&lt;/h3&gt;
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>      &lt;p&gt;This is isolated from host page styles&lt;/p&gt;
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>    `</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    shadow.appendChild(style)
</span></span><span style=display:flex><span>    shadow.appendChild(wrapper)
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>customElements.define(<span style=color:#a5d6ff>&#39;shadow-widget&#39;</span>, ShadowWidget)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// ========== 方案3: CSS-in-JS ==========
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// 使用styled-components或emotion
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span><span style=color:#ff7b72>import</span> styled <span style=color:#ff7b72>from</span> <span style=color:#a5d6ff>&#39;styled-components&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>const</span> Card <span style=color:#ff7b72;font-weight:700>=</span> styled.div<span style=color:#a5d6ff>`
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>  padding: 20px;
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>  border-radius: 8px;
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>  background: white;
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>  h3 {
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>    font-size: 18px;
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>    color: #333;
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>  }
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>`</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// 组件自动生成唯一类名
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>&lt;<span style=color:#7ee787>Card</span>&gt;
</span></span><span style=display:flex><span>  &lt;<span style=color:#7ee787>h3</span>&gt;Title&lt;/<span style=color:#7ee787>h3</span>&gt;
</span></span><span style=display:flex><span>&lt;/<span style=color:#7ee787>Card</span>&gt;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// ========== 方案4: 命名空间 ==========
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// 推荐的BEM + 命名空间组合
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// [子应用名]-[块]__[元素]--[修饰器]
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>.user<span style=color:#ff7b72;font-weight:700>-</span>center<span style=color:#ff7b72;font-weight:700>-</span>card__header<span style=color:#ff7b72;font-weight:700>--</span>active {
</span></span><span style=display:flex><span>  background<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#f85149>#</span><span style=color:#a5d6ff>007</span>bff;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>.order<span style=color:#ff7b72;font-weight:700>-</span>system<span style=color:#ff7b72;font-weight:700>-</span>list__item<span style=color:#ff7b72;font-weight:700>--</span>highlighted {
</span></span><span style=display:flex><span>  background<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#f85149>#</span>ffc107;
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div><h2 id=四状态管理架构>四、状态管理架构<a hidden class=anchor aria-hidden=true href=#四状态管理架构>#</a></h2><h3 id=41-状态管理选型>4.1 状态管理选型<a hidden class=anchor aria-hidden=true href=#41-状态管理选型>#</a></h3><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 56
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 57
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 58
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 59
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 60
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 61
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 62
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 63
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 64
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 65
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 66
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 67
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 68
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 69
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 70
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 71
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 72
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 73
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 74
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 75
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 76
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 77
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 78
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 79
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 80
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 81
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 82
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 83
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 84
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 85
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 86
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 87
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 88
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 89
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 90
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 91
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 92
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 93
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 94
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 95
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 96
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 97
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 98
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 99
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">100
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">101
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// ========== 方案对比 ==========
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// 1. Redux Toolkit - 复杂应用
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span><span style=color:#ff7b72>import</span> { createSlice, configureStore } <span style=color:#ff7b72>from</span> <span style=color:#a5d6ff>&#39;@reduxjs/toolkit&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>const</span> userSlice <span style=color:#ff7b72;font-weight:700>=</span> createSlice({
</span></span><span style=display:flex><span>  name<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#a5d6ff>&#39;user&#39;</span>,
</span></span><span style=display:flex><span>  initialState<span style=color:#ff7b72;font-weight:700>:</span> {
</span></span><span style=display:flex><span>    user: <span style=color:#ff7b72>null</span>,
</span></span><span style=display:flex><span>    status<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#a5d6ff>&#39;idle&#39;</span>
</span></span><span style=display:flex><span>  },
</span></span><span style=display:flex><span>  reducers<span style=color:#ff7b72;font-weight:700>:</span> {
</span></span><span style=display:flex><span>    setUser(state, action) {
</span></span><span style=display:flex><span>      state.user <span style=color:#ff7b72;font-weight:700>=</span> action.payload
</span></span><span style=display:flex><span>    },
</span></span><span style=display:flex><span>    clearUser(state) {
</span></span><span style=display:flex><span>      state.user <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#79c0ff>null</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  },
</span></span><span style=display:flex><span>  extraReducers<span style=color:#ff7b72;font-weight:700>:</span> (builder) <span style=color:#ff7b72;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span>    builder
</span></span><span style=display:flex><span>      .addCase(fetchUser.pending, (state) <span style=color:#ff7b72;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span>        state.status <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>&#39;loading&#39;</span>
</span></span><span style=display:flex><span>      })
</span></span><span style=display:flex><span>      .addCase(fetchUser.fulfilled, (state, action) <span style=color:#ff7b72;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span>        state.status <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>&#39;succeeded&#39;</span>
</span></span><span style=display:flex><span>        state.user <span style=color:#ff7b72;font-weight:700>=</span> action.payload
</span></span><span style=display:flex><span>      })
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>})
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>export</span> <span style=color:#ff7b72>const</span> { setUser, clearUser } <span style=color:#ff7b72;font-weight:700>=</span> userSlice.actions
</span></span><span style=display:flex><span><span style=color:#ff7b72>export</span> <span style=color:#ff7b72>default</span> configureStore({
</span></span><span style=display:flex><span>  reducer<span style=color:#ff7b72;font-weight:700>:</span> {
</span></span><span style=display:flex><span>    user: <span style=color:#ff7b72>userSlice.reducer</span>
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>})
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// 2. Zustand - 轻量级
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span><span style=color:#ff7b72>import</span> create <span style=color:#ff7b72>from</span> <span style=color:#a5d6ff>&#39;zustand&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>const</span> useUserStore <span style=color:#ff7b72;font-weight:700>=</span> create((<span style=color:#ff7b72>set</span>, <span style=color:#ff7b72>get</span>) <span style=color:#ff7b72;font-weight:700>=&gt;</span> ({
</span></span><span style=display:flex><span>  user: <span style=color:#ff7b72>null</span>,
</span></span><span style=display:flex><span>  status<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#a5d6ff>&#39;idle&#39;</span>,
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  setUser<span style=color:#ff7b72;font-weight:700>:</span> (user) <span style=color:#ff7b72;font-weight:700>=&gt;</span> <span style=color:#ff7b72>set</span>({ user }),
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  fetchUser: <span style=color:#ff7b72>async</span> (id) <span style=color:#ff7b72;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>set</span>({ status<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#a5d6ff>&#39;loading&#39;</span> })
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>const</span> user <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#ff7b72>await</span> api.getUser(id)
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>set</span>({ user, status<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#a5d6ff>&#39;succeeded&#39;</span> })
</span></span><span style=display:flex><span>  },
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  getUserAge<span style=color:#ff7b72;font-weight:700>:</span> () <span style=color:#ff7b72;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>const</span> { user } <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#ff7b72>get</span>()
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>return</span> user <span style=color:#ff7b72;font-weight:700>?</span> calculateAge(user.birthday) <span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#a5d6ff>0</span>
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// 3. Pinia - Vue推荐
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span><span style=color:#ff7b72>import</span> { defineStore } <span style=color:#ff7b72>from</span> <span style=color:#a5d6ff>&#39;pinia&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>export</span> <span style=color:#ff7b72>const</span> useUserStore <span style=color:#ff7b72;font-weight:700>=</span> defineStore(<span style=color:#a5d6ff>&#39;user&#39;</span>, {
</span></span><span style=display:flex><span>  state<span style=color:#ff7b72;font-weight:700>:</span> () <span style=color:#ff7b72;font-weight:700>=&gt;</span> ({
</span></span><span style=display:flex><span>    user: <span style=color:#ff7b72>null</span>,
</span></span><span style=display:flex><span>    status<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#a5d6ff>&#39;idle&#39;</span>
</span></span><span style=display:flex><span>  }),
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  getters<span style=color:#ff7b72;font-weight:700>:</span> {
</span></span><span style=display:flex><span>    isLoggedIn<span style=color:#ff7b72;font-weight:700>:</span> (state) <span style=color:#ff7b72;font-weight:700>=&gt;</span> <span style=color:#ff7b72;font-weight:700>!!</span>state.user,
</span></span><span style=display:flex><span>    userName<span style=color:#ff7b72;font-weight:700>:</span> (state) <span style=color:#ff7b72;font-weight:700>=&gt;</span> state.user<span style=color:#ff7b72;font-weight:700>?</span>.name <span style=color:#ff7b72;font-weight:700>||</span> <span style=color:#a5d6ff>&#39;Guest&#39;</span>
</span></span><span style=display:flex><span>  },
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  actions<span style=color:#ff7b72;font-weight:700>:</span> {
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>async</span> fetchUser(id) {
</span></span><span style=display:flex><span>      <span style=color:#ff7b72>this</span>.status <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>&#39;loading&#39;</span>
</span></span><span style=display:flex><span>      <span style=color:#ff7b72>this</span>.user <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#ff7b72>await</span> api.getUser(id)
</span></span><span style=display:flex><span>      <span style=color:#ff7b72>this</span>.status <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>&#39;succeeded&#39;</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>})
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// 4. Jotai - 原子化状态
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span><span style=color:#ff7b72>import</span> { atom, useAtom } <span style=color:#ff7b72>from</span> <span style=color:#a5d6ff>&#39;jotai&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// 原子状态
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span><span style=color:#ff7b72>const</span> userAtom <span style=color:#ff7b72;font-weight:700>=</span> atom(<span style=color:#79c0ff>null</span>)
</span></span><span style=display:flex><span><span style=color:#ff7b72>const</span> statusAtom <span style=color:#ff7b72;font-weight:700>=</span> atom(<span style=color:#a5d6ff>&#39;idle&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// 派生原子
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span><span style=color:#ff7b72>const</span> isLoggedInAtom <span style=color:#ff7b72;font-weight:700>=</span> atom(
</span></span><span style=display:flex><span>  (<span style=color:#ff7b72>get</span>) <span style=color:#ff7b72;font-weight:700>=&gt;</span> <span style=color:#ff7b72;font-weight:700>!!</span><span style=color:#ff7b72>get</span>(userAtom)
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// 组件中使用
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span><span style=color:#ff7b72>function</span> UserProfile() {
</span></span><span style=display:flex><span>  <span style=color:#ff7b72>const</span> [user, setUser] <span style=color:#ff7b72;font-weight:700>=</span> useAtom(userAtom)
</span></span><span style=display:flex><span>  <span style=color:#ff7b72>const</span> [status] <span style=color:#ff7b72;font-weight:700>=</span> useAtom(statusAtom)
</span></span><span style=display:flex><span>  <span style=color:#ff7b72>const</span> [isLoggedIn] <span style=color:#ff7b72;font-weight:700>=</span> useAtom(isLoggedInAtom)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#8b949e;font-style:italic>// ...
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>}
</span></span></code></pre></td></tr></table></div></div><h3 id=42-分层状态架构>4.2 分层状态架构<a hidden class=anchor aria-hidden=true href=#42-分层状态架构>#</a></h3><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 56
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 57
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 58
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 59
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 60
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 61
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 62
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 63
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 64
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 65
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 66
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 67
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 68
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 69
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 70
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 71
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 72
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 73
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 74
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 75
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 76
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 77
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 78
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 79
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 80
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 81
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 82
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 83
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 84
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 85
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 86
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 87
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 88
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 89
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 90
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 91
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 92
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 93
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 94
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 95
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 96
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 97
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 98
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 99
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">100
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">101
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">102
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">103
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">104
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">105
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">106
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">107
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">108
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">109
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">110
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">111
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">112
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">113
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">114
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">115
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">116
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// ========== 状态分层设计 ==========
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// 1. 服务端状态 - React Query / SWR
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span><span style=color:#ff7b72>import</span> { useQuery, useMutation, useQueryClient } <span style=color:#ff7b72>from</span> <span style=color:#a5d6ff>&#39;@tanstack/react-query&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// 获取数据
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span><span style=color:#ff7b72>function</span> useUser(id: <span style=color:#ff7b72>string</span>) {
</span></span><span style=display:flex><span>  <span style=color:#ff7b72>return</span> useQuery({
</span></span><span style=display:flex><span>    queryKey<span style=color:#ff7b72;font-weight:700>:</span> [<span style=color:#a5d6ff>&#39;user&#39;</span>, id],
</span></span><span style=display:flex><span>    queryFn<span style=color:#ff7b72;font-weight:700>:</span> () <span style=color:#ff7b72;font-weight:700>=&gt;</span> api.getUser(id),
</span></span><span style=display:flex><span>    staleTime: <span style=color:#ff7b72>5</span> <span style=color:#ff7b72;font-weight:700>*</span> <span style=color:#a5d6ff>60</span> <span style=color:#ff7b72;font-weight:700>*</span> <span style=color:#a5d6ff>1000</span>, <span style=color:#8b949e;font-style:italic>// 5分钟
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>    cacheTime: <span style=color:#ff7b72>10</span> <span style=color:#ff7b72;font-weight:700>*</span> <span style=color:#a5d6ff>60</span> <span style=color:#ff7b72;font-weight:700>*</span> <span style=color:#a5d6ff>1000</span> <span style=color:#8b949e;font-style:italic>// 10分钟
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>  })
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// 修改数据
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span><span style=color:#ff7b72>function</span> useUpdateUser() {
</span></span><span style=display:flex><span>  <span style=color:#ff7b72>const</span> queryClient <span style=color:#ff7b72;font-weight:700>=</span> useQueryClient()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#ff7b72>return</span> useMutation({
</span></span><span style=display:flex><span>    mutationFn<span style=color:#ff7b72;font-weight:700>:</span> ({ id, data }) <span style=color:#ff7b72;font-weight:700>=&gt;</span> api.updateUser(id, data),
</span></span><span style=display:flex><span>    onSuccess<span style=color:#ff7b72;font-weight:700>:</span> (data, variables) <span style=color:#ff7b72;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span>      <span style=color:#8b949e;font-style:italic>// 自动更新缓存
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>      queryClient.setQueryData([<span style=color:#a5d6ff>&#39;user&#39;</span>, variables.id], data)
</span></span><span style=display:flex><span>      <span style=color:#8b949e;font-style:italic>// 或使缓存失效
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>      queryClient.invalidateQueries([<span style=color:#a5d6ff>&#39;user&#39;</span>, variables.id])
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  })
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// 2. 全局UI状态 - Zustand
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span><span style=color:#ff7b72>import</span> create <span style=color:#ff7b72>from</span> <span style=color:#a5d6ff>&#39;zustand/vanilla&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>const</span> uiStore <span style=color:#ff7b72;font-weight:700>=</span> create((<span style=color:#ff7b72>set</span>) <span style=color:#ff7b72;font-weight:700>=&gt;</span> ({
</span></span><span style=display:flex><span>  theme<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#a5d6ff>&#39;light&#39;</span>,
</span></span><span style=display:flex><span>  sidebarOpen: <span style=color:#ff7b72>true</span>,
</span></span><span style=display:flex><span>  modalOpen: <span style=color:#ff7b72>false</span>,
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  toggleTheme<span style=color:#ff7b72;font-weight:700>:</span> () <span style=color:#ff7b72;font-weight:700>=&gt;</span> <span style=color:#ff7b72>set</span>((state) <span style=color:#ff7b72;font-weight:700>=&gt;</span> ({
</span></span><span style=display:flex><span>    theme: <span style=color:#ff7b72>state.theme</span> <span style=color:#ff7b72;font-weight:700>===</span> <span style=color:#a5d6ff>&#39;light&#39;</span> <span style=color:#ff7b72;font-weight:700>?</span> <span style=color:#a5d6ff>&#39;dark&#39;</span> <span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#a5d6ff>&#39;light&#39;</span>
</span></span><span style=display:flex><span>  })),
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  toggleSidebar<span style=color:#ff7b72;font-weight:700>:</span> () <span style=color:#ff7b72;font-weight:700>=&gt;</span> <span style=color:#ff7b72>set</span>((state) <span style=color:#ff7b72;font-weight:700>=&gt;</span> ({
</span></span><span style=display:flex><span>    sidebarOpen<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#ff7b72;font-weight:700>!</span>state.sidebarOpen
</span></span><span style=display:flex><span>  })),
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  openModal<span style=color:#ff7b72;font-weight:700>:</span> () <span style=color:#ff7b72;font-weight:700>=&gt;</span> <span style=color:#ff7b72>set</span>({ modalOpen: <span style=color:#ff7b72>true</span> }),
</span></span><span style=display:flex><span>  closeModal<span style=color:#ff7b72;font-weight:700>:</span> () <span style=color:#ff7b72;font-weight:700>=&gt;</span> <span style=color:#ff7b72>set</span>({ modalOpen: <span style=color:#ff7b72>false</span> })
</span></span><span style=display:flex><span>}))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// 3. 表单状态 - 原子状态
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span><span style=color:#ff7b72>import</span> { atom, useAtom } <span style=color:#ff7b72>from</span> <span style=color:#a5d6ff>&#39;jotai&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>const</span> formDataAtom <span style=color:#ff7b72;font-weight:700>=</span> atom({
</span></span><span style=display:flex><span>  username<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#a5d6ff>&#39;&#39;</span>,
</span></span><span style=display:flex><span>  email<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#a5d6ff>&#39;&#39;</span>,
</span></span><span style=display:flex><span>  password<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#a5d6ff>&#39;&#39;</span>
</span></span><span style=display:flex><span>})
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>const</span> formErrorsAtom <span style=color:#ff7b72;font-weight:700>=</span> atom({})
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>const</span> useForm <span style=color:#ff7b72;font-weight:700>=</span> () <span style=color:#ff7b72;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span>  <span style=color:#ff7b72>const</span> [data, setData] <span style=color:#ff7b72;font-weight:700>=</span> useAtom(formDataAtom)
</span></span><span style=display:flex><span>  <span style=color:#ff7b72>const</span> [errors, setErrors] <span style=color:#ff7b72;font-weight:700>=</span> useAtom(formErrorsAtom)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#ff7b72>const</span> updateField <span style=color:#ff7b72;font-weight:700>=</span> (field, value) <span style=color:#ff7b72;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span>    setData((prev) <span style=color:#ff7b72;font-weight:700>=&gt;</span> ({
</span></span><span style=display:flex><span>      ...prev,
</span></span><span style=display:flex><span>      [field]<span style=color:#ff7b72;font-weight:700>:</span> value
</span></span><span style=display:flex><span>    }))
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#ff7b72>const</span> validate <span style=color:#ff7b72;font-weight:700>=</span> () <span style=color:#ff7b72;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>const</span> newErrors <span style=color:#ff7b72;font-weight:700>=</span> {}
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>if</span> (<span style=color:#ff7b72;font-weight:700>!</span>data.username) newErrors.username <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>&#39;Required&#39;</span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>if</span> (<span style=color:#ff7b72;font-weight:700>!</span>data.email) newErrors.email <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>&#39;Required&#39;</span>
</span></span><span style=display:flex><span>    setErrors(newErrors)
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>return</span> Object.keys(newErrors).length <span style=color:#ff7b72;font-weight:700>===</span> <span style=color:#a5d6ff>0</span>
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#ff7b72>return</span> {
</span></span><span style=display:flex><span>    data,
</span></span><span style=display:flex><span>    errors,
</span></span><span style=display:flex><span>    updateField,
</span></span><span style=display:flex><span>    validate
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// ========== 状态组合使用 ==========
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span><span style=color:#ff7b72>function</span> UserProfile({ userId }) {
</span></span><span style=display:flex><span>  <span style=color:#8b949e;font-style:italic>// 服务端状态
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>  <span style=color:#ff7b72>const</span> { data: <span style=color:#ff7b72>user</span>, isLoading } <span style=color:#ff7b72;font-weight:700>=</span> useUser(userId)
</span></span><span style=display:flex><span>  <span style=color:#ff7b72>const</span> updateUser <span style=color:#ff7b72;font-weight:700>=</span> useUpdateUser()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#8b949e;font-style:italic>// UI状态
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>  <span style=color:#ff7b72>const</span> { theme, toggleTheme } <span style=color:#ff7b72;font-weight:700>=</span> useUiStore()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#8b949e;font-style:italic>// 本地状态
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>  <span style=color:#ff7b72>const</span> [isEditing, setIsEditing] <span style=color:#ff7b72;font-weight:700>=</span> useState(<span style=color:#79c0ff>false</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#ff7b72>if</span> (isLoading) <span style=color:#ff7b72>return</span> &lt;<span style=color:#7ee787>Spinner</span> /&gt;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#ff7b72>return</span> (
</span></span><span style=display:flex><span>    &lt;<span style=color:#7ee787>div</span> className<span style=color:#ff7b72;font-weight:700>=</span>{theme}&gt;
</span></span><span style=display:flex><span>      {isEditing <span style=color:#ff7b72;font-weight:700>?</span> (
</span></span><span style=display:flex><span>        &lt;<span style=color:#7ee787>EditForm</span>
</span></span><span style=display:flex><span>          user<span style=color:#ff7b72;font-weight:700>=</span>{user}
</span></span><span style=display:flex><span>          onSave<span style=color:#ff7b72;font-weight:700>=</span>{(data) <span style=color:#ff7b72;font-weight:700>=&gt;</span> updateUser.mutate({ id: <span style=color:#ff7b72>userId</span>, data })}
</span></span><span style=display:flex><span>          onCancel<span style=color:#ff7b72;font-weight:700>=</span>{() <span style=color:#ff7b72;font-weight:700>=&gt;</span> setIsEditing(<span style=color:#79c0ff>false</span>)}
</span></span><span style=display:flex><span>        /&gt;
</span></span><span style=display:flex><span>      ) <span style=color:#ff7b72;font-weight:700>:</span> (
</span></span><span style=display:flex><span>        &lt;<span style=color:#7ee787>UserDetail</span> user<span style=color:#ff7b72;font-weight:700>=</span>{user} onEdit<span style=color:#ff7b72;font-weight:700>=</span>{() <span style=color:#ff7b72;font-weight:700>=&gt;</span> setIsEditing(<span style=color:#79c0ff>true</span>)} /&gt;
</span></span><span style=display:flex><span>      )}
</span></span><span style=display:flex><span>      &lt;<span style=color:#7ee787>button</span> onClick<span style=color:#ff7b72;font-weight:700>=</span>{toggleTheme}&gt;Toggle Theme&lt;/<span style=color:#7ee787>button</span>&gt;
</span></span><span style=display:flex><span>    &lt;/<span style=color:#7ee787>div</span>&gt;
</span></span><span style=display:flex><span>  )
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div><h3 id=43-状态持久化>4.3 状态持久化<a hidden class=anchor aria-hidden=true href=#43-状态持久化>#</a></h3><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 56
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 57
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 58
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 59
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 60
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 61
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 62
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 63
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 64
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 65
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 66
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 67
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 68
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 69
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 70
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 71
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 72
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 73
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 74
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 75
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 76
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 77
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 78
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 79
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 80
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 81
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 82
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 83
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 84
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 85
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 86
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 87
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 88
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 89
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 90
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 91
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 92
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 93
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 94
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 95
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 96
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 97
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 98
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 99
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">100
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">101
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">102
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">103
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// ========== 本地持久化方案 ==========
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// 1. Zustand + localStorage
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span><span style=color:#ff7b72>import</span> { persist } <span style=color:#ff7b72>from</span> <span style=color:#a5d6ff>&#39;zustand/middleware&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>export</span> <span style=color:#ff7b72>const</span> useUserStore <span style=color:#ff7b72;font-weight:700>=</span> create(
</span></span><span style=display:flex><span>  persist(
</span></span><span style=display:flex><span>    (<span style=color:#ff7b72>set</span>) <span style=color:#ff7b72;font-weight:700>=&gt;</span> ({
</span></span><span style=display:flex><span>      user: <span style=color:#ff7b72>null</span>,
</span></span><span style=display:flex><span>      token: <span style=color:#ff7b72>null</span>,
</span></span><span style=display:flex><span>      setUser<span style=color:#ff7b72;font-weight:700>:</span> (user) <span style=color:#ff7b72;font-weight:700>=&gt;</span> <span style=color:#ff7b72>set</span>({ user }),
</span></span><span style=display:flex><span>      setToken<span style=color:#ff7b72;font-weight:700>:</span> (token) <span style=color:#ff7b72;font-weight:700>=&gt;</span> <span style=color:#ff7b72>set</span>({ token }),
</span></span><span style=display:flex><span>      logout<span style=color:#ff7b72;font-weight:700>:</span> () <span style=color:#ff7b72;font-weight:700>=&gt;</span> <span style=color:#ff7b72>set</span>({ user: <span style=color:#ff7b72>null</span>, token: <span style=color:#ff7b72>null</span> })
</span></span><span style=display:flex><span>    }),
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>      name<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#a5d6ff>&#39;user-storage&#39;</span>,
</span></span><span style=display:flex><span>      <span style=color:#8b949e;font-style:italic>// 部分持久化
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>      partialize<span style=color:#ff7b72;font-weight:700>:</span> (state) <span style=color:#ff7b72;font-weight:700>=&gt;</span> ({
</span></span><span style=display:flex><span>        user: <span style=color:#ff7b72>state.user</span>,
</span></span><span style=display:flex><span>        token: <span style=color:#ff7b72>state.token</span>
</span></span><span style=display:flex><span>      })
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  )
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// 2. Pinia + localStorage
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span><span style=color:#ff7b72>import</span> { createPinia } <span style=color:#ff7b72>from</span> <span style=color:#a5d6ff>&#39;pinia&#39;</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>import</span> piniaPluginPersistedstate <span style=color:#ff7b72>from</span> <span style=color:#a5d6ff>&#39;pinia-plugin-persistedstate&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>const</span> pinia <span style=color:#ff7b72;font-weight:700>=</span> createPinia()
</span></span><span style=display:flex><span>pinia.use(piniaPluginPersistedstate)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>export</span> <span style=color:#ff7b72>const</span> useAuthStore <span style=color:#ff7b72;font-weight:700>=</span> defineStore(<span style=color:#a5d6ff>&#39;auth&#39;</span>, {
</span></span><span style=display:flex><span>  state<span style=color:#ff7b72;font-weight:700>:</span> () <span style=color:#ff7b72;font-weight:700>=&gt;</span> ({
</span></span><span style=display:flex><span>    token: <span style=color:#ff7b72>null</span>,
</span></span><span style=display:flex><span>    refreshToken: <span style=color:#ff7b72>null</span>
</span></span><span style=display:flex><span>  }),
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  actions<span style=color:#ff7b72;font-weight:700>:</span> {
</span></span><span style=display:flex><span>    setTokens(token, refreshToken) {
</span></span><span style=display:flex><span>      <span style=color:#ff7b72>this</span>.token <span style=color:#ff7b72;font-weight:700>=</span> token
</span></span><span style=display:flex><span>      <span style=color:#ff7b72>this</span>.refreshToken <span style=color:#ff7b72;font-weight:700>=</span> refreshToken
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  },
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  persist<span style=color:#ff7b72;font-weight:700>:</span> {
</span></span><span style=display:flex><span>    key<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#a5d6ff>&#39;auth&#39;</span>,
</span></span><span style=display:flex><span>    storage: <span style=color:#ff7b72>localStorage</span>,
</span></span><span style=display:flex><span>    pick<span style=color:#ff7b72;font-weight:700>:</span> [<span style=color:#a5d6ff>&#39;token&#39;</span>, <span style=color:#a5d6ff>&#39;refreshToken&#39;</span>]
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>})
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// 3. IndexedDB - 大量数据
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span><span style=color:#ff7b72>import</span> { openDB } <span style=color:#ff7b72>from</span> <span style=color:#a5d6ff>&#39;idb&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>const</span> dbPromise <span style=color:#ff7b72;font-weight:700>=</span> openDB(<span style=color:#a5d6ff>&#39;app-db&#39;</span>, <span style=color:#a5d6ff>1</span>, {
</span></span><span style=display:flex><span>  upgrade(db) {
</span></span><span style=display:flex><span>    db.createObjectStore(<span style=color:#a5d6ff>&#39;cache&#39;</span>)
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>})
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>export</span> <span style=color:#ff7b72>const</span> idbStorage <span style=color:#ff7b72;font-weight:700>=</span> {
</span></span><span style=display:flex><span>  <span style=color:#ff7b72>async</span> getItem(key) {
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>const</span> db <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#ff7b72>await</span> dbPromise
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>return</span> <span style=color:#ff7b72>await</span> db.<span style=color:#ff7b72>get</span>(<span style=color:#a5d6ff>&#39;cache&#39;</span>, key)
</span></span><span style=display:flex><span>  },
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#ff7b72>async</span> setItem(key, value) {
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>const</span> db <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#ff7b72>await</span> dbPromise
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>return</span> <span style=color:#ff7b72>await</span> db.put(<span style=color:#a5d6ff>&#39;cache&#39;</span>, value, key)
</span></span><span style=display:flex><span>  },
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#ff7b72>async</span> removeItem(key) {
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>const</span> db <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#ff7b72>await</span> dbPromise
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>return</span> <span style=color:#ff7b72>await</span> db.<span style=color:#ff7b72>delete</span>(<span style=color:#a5d6ff>&#39;cache&#39;</span>, key)
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// 4. 服务端状态同步
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span><span style=color:#ff7b72>import</span> { useQuery, useMutation } <span style=color:#ff7b72>from</span> <span style=color:#a5d6ff>&#39;@tanstack/react-query&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// 自动同步到服务端
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span><span style=color:#ff7b72>function</span> useSyncedState(key, initialValue) {
</span></span><span style=display:flex><span>  <span style=color:#ff7b72>const</span> queryClient <span style=color:#ff7b72;font-weight:700>=</span> useQueryClient()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#ff7b72>const</span> { data } <span style=color:#ff7b72;font-weight:700>=</span> useQuery({
</span></span><span style=display:flex><span>    queryKey<span style=color:#ff7b72;font-weight:700>:</span> [<span style=color:#a5d6ff>&#39;state&#39;</span>, key],
</span></span><span style=display:flex><span>    queryFn<span style=color:#ff7b72;font-weight:700>:</span> () <span style=color:#ff7b72;font-weight:700>=&gt;</span> api.getState(key),
</span></span><span style=display:flex><span>    initialData: <span style=color:#ff7b72>initialValue</span>
</span></span><span style=display:flex><span>  })
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#ff7b72>const</span> mutation <span style=color:#ff7b72;font-weight:700>=</span> useMutation({
</span></span><span style=display:flex><span>    mutationFn<span style=color:#ff7b72;font-weight:700>:</span> (value) <span style=color:#ff7b72;font-weight:700>=&gt;</span> api.setState(key, value),
</span></span><span style=display:flex><span>    onSuccess<span style=color:#ff7b72;font-weight:700>:</span> () <span style=color:#ff7b72;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span>      queryClient.invalidateQueries([<span style=color:#a5d6ff>&#39;state&#39;</span>, key])
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  })
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#ff7b72>const</span> setState <span style=color:#ff7b72;font-weight:700>=</span> (value) <span style=color:#ff7b72;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span>    mutation.mutate(value)
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#ff7b72>return</span> [data, setState]
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div><h2 id=五性能优化架构>五、性能优化架构<a hidden class=anchor aria-hidden=true href=#五性能优化架构>#</a></h2><h3 id=51-代码分割策略>5.1 代码分割策略<a hidden class=anchor aria-hidden=true href=#51-代码分割策略>#</a></h3><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 56
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 57
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 58
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 59
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 60
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 61
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 62
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 63
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 64
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 65
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 66
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 67
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 68
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 69
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 70
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 71
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 72
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 73
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 74
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 75
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 76
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 77
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 78
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 79
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 80
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 81
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 82
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 83
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 84
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 85
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 86
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 87
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 88
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 89
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 90
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 91
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 92
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 93
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 94
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 95
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 96
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 97
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 98
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 99
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">100
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">101
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">102
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">103
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">104
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">105
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">106
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">107
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">108
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">109
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">110
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">111
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">112
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// ========== 路由级别分割 ==========
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// Vue Router
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span><span style=color:#ff7b72>const</span> routes <span style=color:#ff7b72;font-weight:700>=</span> [
</span></span><span style=display:flex><span>  {
</span></span><span style=display:flex><span>    path<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#a5d6ff>&#39;/dashboard&#39;</span>,
</span></span><span style=display:flex><span>    component<span style=color:#ff7b72;font-weight:700>:</span> () <span style=color:#ff7b72;font-weight:700>=&gt;</span> <span style=color:#ff7b72>import</span>(
</span></span><span style=display:flex><span>      <span style=color:#8b949e;font-style:italic>/* webpackChunkName: &#34;dashboard&#34; */</span>
</span></span><span style=display:flex><span>      <span style=color:#a5d6ff>&#39;./views/Dashboard.vue&#39;</span>
</span></span><span style=display:flex><span>    )
</span></span><span style=display:flex><span>  },
</span></span><span style=display:flex><span>  {
</span></span><span style=display:flex><span>    path<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#a5d6ff>&#39;/users&#39;</span>,
</span></span><span style=display:flex><span>    component<span style=color:#ff7b72;font-weight:700>:</span> () <span style=color:#ff7b72;font-weight:700>=&gt;</span> <span style=color:#ff7b72>import</span>(
</span></span><span style=display:flex><span>      <span style=color:#8b949e;font-style:italic>/* webpackChunkName: &#34;users&#34; */</span>
</span></span><span style=display:flex><span>      <span style=color:#a5d6ff>&#39;./views/Users.vue&#39;</span>
</span></span><span style=display:flex><span>    )
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// React Router
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span><span style=color:#ff7b72>const</span> Dashboard <span style=color:#ff7b72;font-weight:700>=</span> lazy(() <span style=color:#ff7b72;font-weight:700>=&gt;</span> <span style=color:#ff7b72>import</span>(<span style=color:#a5d6ff>&#39;./views/Dashboard&#39;</span>))
</span></span><span style=display:flex><span><span style=color:#ff7b72>const</span> Users <span style=color:#ff7b72;font-weight:700>=</span> lazy(() <span style=color:#ff7b72;font-weight:700>=&gt;</span> <span style=color:#ff7b72>import</span>(<span style=color:#a5d6ff>&#39;./views/Users&#39;</span>))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>function</span> App() {
</span></span><span style=display:flex><span>  <span style=color:#ff7b72>return</span> (
</span></span><span style=display:flex><span>    &lt;<span style=color:#7ee787>Suspense</span> fallback<span style=color:#ff7b72;font-weight:700>=</span>{&lt;<span style=color:#7ee787>Spinner</span> /&gt;}&gt;
</span></span><span style=display:flex><span>      &lt;<span style=color:#7ee787>Routes</span>&gt;
</span></span><span style=display:flex><span>        &lt;<span style=color:#7ee787>Route</span> path<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>&#34;/dashboard&#34;</span> element<span style=color:#ff7b72;font-weight:700>=</span>{&lt;<span style=color:#7ee787>Dashboard</span> /&gt;} /&gt;
</span></span><span style=display:flex><span>        &lt;<span style=color:#7ee787>Route</span> path<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>&#34;/users&#34;</span> element<span style=color:#ff7b72;font-weight:700>=</span>{&lt;<span style=color:#7ee787>Users</span> /&gt;} /&gt;
</span></span><span style=display:flex><span>      &lt;/<span style=color:#7ee787>Routes</span>&gt;
</span></span><span style=display:flex><span>    &lt;/<span style=color:#7ee787>Suspense</span>&gt;
</span></span><span style=display:flex><span>  )
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// ========== 组件级别分割 ==========
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// Vue 3 - defineAsyncComponent
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span><span style=color:#ff7b72>const</span> HeavyComponent <span style=color:#ff7b72;font-weight:700>=</span> defineAsyncComponent({
</span></span><span style=display:flex><span>  loader<span style=color:#ff7b72;font-weight:700>:</span> () <span style=color:#ff7b72;font-weight:700>=&gt;</span> <span style=color:#ff7b72>import</span>(<span style=color:#a5d6ff>&#39;./HeavyComponent.vue&#39;</span>),
</span></span><span style=display:flex><span>  loadingComponent: <span style=color:#ff7b72>LoadingSpinner</span>,
</span></span><span style=display:flex><span>  errorComponent: <span style=color:#ff7b72>ErrorDisplay</span>,
</span></span><span style=display:flex><span>  delay: <span style=color:#ff7b72>200</span>,
</span></span><span style=display:flex><span>  timeout: <span style=color:#ff7b72>5000</span>
</span></span><span style=display:flex><span>})
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// React - lazy + Suspense
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span><span style=color:#ff7b72>const</span> HeavyChart <span style=color:#ff7b72;font-weight:700>=</span> lazy(() <span style=color:#ff7b72;font-weight:700>=&gt;</span> <span style=color:#ff7b72>import</span>(<span style=color:#a5d6ff>&#39;./HeavyChart&#39;</span>))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>function</span> Dashboard() {
</span></span><span style=display:flex><span>  <span style=color:#ff7b72>const</span> [showChart, setShowChart] <span style=color:#ff7b72;font-weight:700>=</span> useState(<span style=color:#79c0ff>false</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#ff7b72>return</span> (
</span></span><span style=display:flex><span>    &lt;<span style=color:#7ee787>div</span>&gt;
</span></span><span style=display:flex><span>      &lt;<span style=color:#7ee787>button</span> onClick<span style=color:#ff7b72;font-weight:700>=</span>{() <span style=color:#ff7b72;font-weight:700>=&gt;</span> setShowChart(<span style=color:#79c0ff>true</span>)}&gt;
</span></span><span style=display:flex><span>        Show Chart
</span></span><span style=display:flex><span>      &lt;/<span style=color:#7ee787>button</span>&gt;
</span></span><span style=display:flex><span>      {showChart <span style=color:#ff7b72;font-weight:700>&amp;&amp;</span> (
</span></span><span style=display:flex><span>        &lt;<span style=color:#7ee787>Suspense</span> fallback<span style=color:#ff7b72;font-weight:700>=</span>{&lt;<span style=color:#7ee787>Spinner</span> /&gt;}&gt;
</span></span><span style=display:flex><span>          &lt;<span style=color:#7ee787>HeavyChart</span> /&gt;
</span></span><span style=display:flex><span>        &lt;/<span style=color:#7ee787>Suspense</span>&gt;
</span></span><span style=display:flex><span>      )}
</span></span><span style=display:flex><span>    &lt;/<span style=color:#7ee787>div</span>&gt;
</span></span><span style=display:flex><span>  )
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// ========== 条件加载 ==========
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// 只在需要时加载库
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span><span style=color:#ff7b72>const</span> loadMonaco <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#ff7b72>async</span> () <span style=color:#ff7b72;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span>  <span style=color:#ff7b72>const</span> monaco <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#ff7b72>await</span> <span style=color:#ff7b72>import</span>(<span style=color:#a5d6ff>&#39;monaco-editor&#39;</span>)
</span></span><span style=display:flex><span>  <span style=color:#ff7b72>return</span> monaco
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>const</span> loadChartLibrary <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#ff7b72>async</span> () <span style=color:#ff7b72;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span>  <span style=color:#ff7b72>if</span> (window.matchMedia(<span style=color:#a5d6ff>&#39;(prefers-reduced-motion: reduce)&#39;</span>).matches) {
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>return</span> <span style=color:#79c0ff>null</span> <span style=color:#8b949e;font-style:italic>// 用户不喜欢动画
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#ff7b72>const</span> chart <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#ff7b72>await</span> <span style=color:#ff7b72>import</span>(<span style=color:#a5d6ff>&#39;echarts&#39;</span>)
</span></span><span style=display:flex><span>  <span style=color:#ff7b72>return</span> chart
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// ========== 预加载策略 ==========
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// 预加载下一个可能访问的页面
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span><span style=color:#ff7b72>function</span> ProductList({ products }) {
</span></span><span style=display:flex><span>  <span style=color:#ff7b72>const</span> prefetch <span style=color:#ff7b72;font-weight:700>=</span> usePrefetch()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#ff7b72>const</span> handleMouseEnter <span style=color:#ff7b72;font-weight:700>=</span> (productId) <span style=color:#ff7b72;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span>    <span style=color:#8b949e;font-style:italic>// 鼠标悬停时预加载
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>    prefetch(<span style=color:#a5d6ff>`/products/</span><span style=color:#a5d6ff>${</span>productId<span style=color:#a5d6ff>}</span><span style=color:#a5d6ff>`</span>)
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#ff7b72>return</span> (
</span></span><span style=display:flex><span>    &lt;<span style=color:#7ee787>ul</span>&gt;
</span></span><span style=display:flex><span>      {products.map(product <span style=color:#ff7b72;font-weight:700>=&gt;</span> (
</span></span><span style=display:flex><span>        &lt;<span style=color:#7ee787>li</span>
</span></span><span style=display:flex><span>          key<span style=color:#ff7b72;font-weight:700>=</span>{product.id}
</span></span><span style=display:flex><span>          onMouseEnter<span style=color:#ff7b72;font-weight:700>=</span>{() <span style=color:#ff7b72;font-weight:700>=&gt;</span> handleMouseEnter(product.id)}
</span></span><span style=display:flex><span>        &gt;
</span></span><span style=display:flex><span>          &lt;<span style=color:#7ee787>Link</span> to<span style=color:#ff7b72;font-weight:700>=</span>{<span style=color:#a5d6ff>`/products/</span><span style=color:#a5d6ff>${</span>product.id<span style=color:#a5d6ff>}</span><span style=color:#a5d6ff>`</span>}&gt;
</span></span><span style=display:flex><span>            {product.name}
</span></span><span style=display:flex><span>          &lt;/<span style=color:#7ee787>Link</span>&gt;
</span></span><span style=display:flex><span>        &lt;/<span style=color:#7ee787>li</span>&gt;
</span></span><span style=display:flex><span>      ))}
</span></span><span style=display:flex><span>    &lt;/<span style=color:#7ee787>ul</span>&gt;
</span></span><span style=display:flex><span>  )
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// Webpack魔法注释
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span><span style=color:#ff7b72>const</span> ProductDetail <span style=color:#ff7b72;font-weight:700>=</span> lazy(() <span style=color:#ff7b72;font-weight:700>=&gt;</span> <span style=color:#ff7b72>import</span>(
</span></span><span style=display:flex><span>  <span style=color:#8b949e;font-style:italic>/* webpackPrefetch: true */</span>
</span></span><span style=display:flex><span>  <span style=color:#8b949e;font-style:italic>/* webpackChunkName: &#34;product-detail&#34; */</span>
</span></span><span style=display:flex><span>  <span style=color:#a5d6ff>&#39;./ProductDetail&#39;</span>
</span></span><span style=display:flex><span>))
</span></span></code></pre></td></tr></table></div></div><h3 id=52-渲染优化>5.2 渲染优化<a hidden class=anchor aria-hidden=true href=#52-渲染优化>#</a></h3><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 56
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 57
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 58
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 59
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 60
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 61
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 62
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 63
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 64
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 65
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 66
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 67
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 68
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 69
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 70
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 71
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 72
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 73
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 74
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 75
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 76
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 77
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 78
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 79
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 80
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 81
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 82
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 83
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 84
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 85
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 86
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 87
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 88
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 89
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 90
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 91
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 92
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 93
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 94
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 95
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 96
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 97
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 98
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 99
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">100
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">101
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">102
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">103
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">104
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">105
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">106
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">107
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">108
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">109
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">110
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">111
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">112
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">113
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">114
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">115
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">116
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">117
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">118
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">119
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">120
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">121
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">122
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">123
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">124
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">125
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">126
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">127
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">128
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">129
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">130
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">131
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">132
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">133
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">134
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">135
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">136
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">137
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">138
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">139
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">140
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">141
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">142
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">143
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">144
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">145
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">146
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">147
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">148
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">149
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">150
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">151
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">152
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">153
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">154
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">155
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">156
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">157
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">158
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">159
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">160
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">161
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">162
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">163
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">164
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">165
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">166
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">167
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">168
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">169
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">170
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">171
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">172
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">173
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">174
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">175
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">176
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">177
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">178
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">179
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">180
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">181
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">182
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">183
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">184
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">185
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">186
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">187
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">188
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">189
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">190
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">191
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">192
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">193
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">194
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">195
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">196
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">197
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">198
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">199
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">200
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">201
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">202
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">203
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// ========== 虚拟列表 ==========
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span><span style=color:#ff7b72>import</span> { useVirtualizer } <span style=color:#ff7b72>from</span> <span style=color:#a5d6ff>&#39;@tanstack/react-virtual&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>function</span> VirtualList({ items }) {
</span></span><span style=display:flex><span>  <span style=color:#ff7b72>const</span> parentRef <span style=color:#ff7b72;font-weight:700>=</span> useRef()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#ff7b72>const</span> virtualizer <span style=color:#ff7b72;font-weight:700>=</span> useVirtualizer({
</span></span><span style=display:flex><span>    count: <span style=color:#ff7b72>items.length</span>,
</span></span><span style=display:flex><span>    getScrollElement<span style=color:#ff7b72;font-weight:700>:</span> () <span style=color:#ff7b72;font-weight:700>=&gt;</span> parentRef.current,
</span></span><span style=display:flex><span>    estimateSize<span style=color:#ff7b72;font-weight:700>:</span> () <span style=color:#ff7b72;font-weight:700>=&gt;</span> <span style=color:#a5d6ff>50</span>, <span style=color:#8b949e;font-style:italic>// 每项高度
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>    overscan: <span style=color:#ff7b72>5</span> <span style=color:#8b949e;font-style:italic>// 额外渲染项数
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>  })
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#ff7b72>return</span> (
</span></span><span style=display:flex><span>    &lt;<span style=color:#7ee787>div</span> ref<span style=color:#ff7b72;font-weight:700>=</span>{parentRef} style<span style=color:#ff7b72;font-weight:700>=</span>{{ height<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#a5d6ff>&#39;400px&#39;</span>, overflow<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#a5d6ff>&#39;auto&#39;</span> }}&gt;
</span></span><span style=display:flex><span>      &lt;<span style=color:#7ee787>div</span>
</span></span><span style=display:flex><span>        style<span style=color:#ff7b72;font-weight:700>=</span>{{
</span></span><span style=display:flex><span>          height<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#a5d6ff>`</span><span style=color:#a5d6ff>${</span>virtualizer.getTotalSize()<span style=color:#a5d6ff>}</span><span style=color:#a5d6ff>px`</span>,
</span></span><span style=display:flex><span>          position<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#a5d6ff>&#39;relative&#39;</span>
</span></span><span style=display:flex><span>        }}
</span></span><span style=display:flex><span>      &gt;
</span></span><span style=display:flex><span>        {virtualizer.getVirtualItems().map(virtualItem <span style=color:#ff7b72;font-weight:700>=&gt;</span> (
</span></span><span style=display:flex><span>          &lt;<span style=color:#7ee787>div</span>
</span></span><span style=display:flex><span>            key<span style=color:#ff7b72;font-weight:700>=</span>{virtualItem.key}
</span></span><span style=display:flex><span>            style<span style=color:#ff7b72;font-weight:700>=</span>{{
</span></span><span style=display:flex><span>              position<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#a5d6ff>&#39;absolute&#39;</span>,
</span></span><span style=display:flex><span>              top: <span style=color:#ff7b72>0</span>,
</span></span><span style=display:flex><span>              left: <span style=color:#ff7b72>0</span>,
</span></span><span style=display:flex><span>              width<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#a5d6ff>&#39;100%&#39;</span>,
</span></span><span style=display:flex><span>              height<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#a5d6ff>`</span><span style=color:#a5d6ff>${</span>virtualItem.size<span style=color:#a5d6ff>}</span><span style=color:#a5d6ff>px`</span>,
</span></span><span style=display:flex><span>              transform<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#a5d6ff>`translateY(</span><span style=color:#a5d6ff>${</span>virtualItem.start<span style=color:#a5d6ff>}</span><span style=color:#a5d6ff>px)`</span>
</span></span><span style=display:flex><span>            }}
</span></span><span style=display:flex><span>          &gt;
</span></span><span style=display:flex><span>            {items[virtualItem.index].content}
</span></span><span style=display:flex><span>          &lt;/<span style=color:#7ee787>div</span>&gt;
</span></span><span style=display:flex><span>        ))}
</span></span><span style=display:flex><span>      &lt;/<span style=color:#7ee787>div</span>&gt;
</span></span><span style=display:flex><span>    &lt;/<span style=color:#7ee787>div</span>&gt;
</span></span><span style=display:flex><span>  )
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// ========== 防抖/节流 ==========
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span><span style=color:#ff7b72>import</span> { useDebouncedCallback, useThrottledCallback } <span style=color:#ff7b72>from</span> <span style=color:#a5d6ff>&#39;@hooks&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>function</span> SearchInput() {
</span></span><span style=display:flex><span>  <span style=color:#8b949e;font-style:italic>// 防抖搜索
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>  <span style=color:#ff7b72>const</span> debouncedSearch <span style=color:#ff7b72;font-weight:700>=</span> useDebouncedCallback(
</span></span><span style=display:flex><span>    (query) <span style=color:#ff7b72;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span>      performSearch(query)
</span></span><span style=display:flex><span>    },
</span></span><span style=display:flex><span>    <span style=color:#a5d6ff>500</span> <span style=color:#8b949e;font-style:italic>// 延迟
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>  )
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#ff7b72>return</span> (
</span></span><span style=display:flex><span>    &lt;<span style=color:#7ee787>input</span>
</span></span><span style=display:flex><span>      type<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>&#34;text&#34;</span>
</span></span><span style=display:flex><span>      onChange<span style=color:#ff7b72;font-weight:700>=</span>{(e) <span style=color:#ff7b72;font-weight:700>=&gt;</span> debouncedSearch(e.target.value)}
</span></span><span style=display:flex><span>    /&gt;
</span></span><span style=display:flex><span>  )
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>function</span> ScrollHandler() {
</span></span><span style=display:flex><span>  <span style=color:#8b949e;font-style:italic>// 节流滚动事件
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>  <span style=color:#ff7b72>const</span> throttledScroll <span style=color:#ff7b72;font-weight:700>=</span> useThrottledCallback(
</span></span><span style=display:flex><span>    () <span style=color:#ff7b72;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span>      updatePosition()
</span></span><span style=display:flex><span>    },
</span></span><span style=display:flex><span>    <span style=color:#a5d6ff>100</span> <span style=color:#8b949e;font-style:italic>// 间隔
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>  )
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  useEffect(() <span style=color:#ff7b72;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span>    window.addEventListener(<span style=color:#a5d6ff>&#39;scroll&#39;</span>, throttledScroll)
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>return</span> () <span style=color:#ff7b72;font-weight:700>=&gt;</span> window.removeEventListener(<span style=color:#a5d6ff>&#39;scroll&#39;</span>, throttledScroll)
</span></span><span style=display:flex><span>  }, [throttledScroll])
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// ========== React优化 ==========
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span><span style=color:#ff7b72>import</span> { memo, useMemo, useCallback, useRef } <span style=color:#ff7b72>from</span> <span style=color:#a5d6ff>&#39;react&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// 1. 组件记忆化
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span><span style=color:#ff7b72>const</span> ExpensiveComponent <span style=color:#ff7b72;font-weight:700>=</span> memo(<span style=color:#ff7b72>function</span> ExpensiveComponent({ data }) {
</span></span><span style=display:flex><span>  <span style=color:#ff7b72>return</span> &lt;<span style=color:#7ee787>div</span>&gt;{<span style=color:#8b949e;font-style:italic>/* 复杂渲染 */</span>}&lt;/<span style=color:#7ee787>div</span>&gt;
</span></span><span style=display:flex><span>})
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// 2. 计算缓存
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span><span style=color:#ff7b72>function</span> DataProcessor({ items }) {
</span></span><span style=display:flex><span>  <span style=color:#ff7b72>const</span> sorted <span style=color:#ff7b72;font-weight:700>=</span> useMemo(() <span style=color:#ff7b72;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>return</span> items.sort((a, b) <span style=color:#ff7b72;font-weight:700>=&gt;</span> a.value <span style=color:#ff7b72;font-weight:700>-</span> b.value)
</span></span><span style=display:flex><span>  }, [items]) <span style=color:#8b949e;font-style:italic>// 只在items变化时重新计算
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>
</span></span><span style=display:flex><span>  <span style=color:#ff7b72>const</span> filtered <span style=color:#ff7b72;font-weight:700>=</span> useMemo(() <span style=color:#ff7b72;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>return</span> sorted.filter(item <span style=color:#ff7b72;font-weight:700>=&gt;</span> item.active)
</span></span><span style=display:flex><span>  }, [sorted])
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#ff7b72>return</span> &lt;<span style=color:#7ee787>List</span> items<span style=color:#ff7b72;font-weight:700>=</span>{filtered} /&gt;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// 3. 函数稳定化
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span><span style=color:#ff7b72>function</span> ParentComponent() {
</span></span><span style=display:flex><span>  <span style=color:#ff7b72>const</span> [count, setCount] <span style=color:#ff7b72;font-weight:700>=</span> useState(<span style=color:#a5d6ff>0</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#8b949e;font-style:italic>// 不稳定的函数引用
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>  <span style=color:#ff7b72>const</span> handleClickBad <span style=color:#ff7b72;font-weight:700>=</span> () <span style=color:#ff7b72;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span>    setCount(count <span style=color:#ff7b72;font-weight:700>+</span> <span style=color:#a5d6ff>1</span>)
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#8b949e;font-style:italic>// 稳定的函数引用
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>  <span style=color:#ff7b72>const</span> handleClickGood <span style=color:#ff7b72;font-weight:700>=</span> useCallback(() <span style=color:#ff7b72;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span>    setCount(c <span style=color:#ff7b72;font-weight:700>=&gt;</span> c <span style=color:#ff7b72;font-weight:700>+</span> <span style=color:#a5d6ff>1</span>)
</span></span><span style=display:flex><span>  }, []) <span style=color:#8b949e;font-style:italic>// 依赖为空，函数引用不变
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>
</span></span><span style=display:flex><span>  <span style=color:#ff7b72>return</span> &lt;<span style=color:#7ee787>ChildComponent</span> onClick<span style=color:#ff7b72;font-weight:700>=</span>{handleClickGood} /&gt;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// 4. 列表渲染优化
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span><span style=color:#ff7b72>function</span> TodoList({ todos, onToggle }) {
</span></span><span style=display:flex><span>  <span style=color:#ff7b72>const</span> todoRefs <span style=color:#ff7b72;font-weight:700>=</span> useRef(<span style=color:#ff7b72>new</span> Map())
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#ff7b72>const</span> handleToggle <span style=color:#ff7b72;font-weight:700>=</span> useCallback((id) <span style=color:#ff7b72;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span>    <span style=color:#8b949e;font-style:italic>// 批量更新
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>    startTransition(() <span style=color:#ff7b72;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span>      onToggle(id)
</span></span><span style=display:flex><span>    })
</span></span><span style=display:flex><span>  }, [onToggle])
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#ff7b72>return</span> (
</span></span><span style=display:flex><span>    &lt;<span style=color:#7ee787>ul</span>&gt;
</span></span><span style=display:flex><span>      {todos.map(todo <span style=color:#ff7b72;font-weight:700>=&gt;</span> (
</span></span><span style=display:flex><span>        &lt;<span style=color:#7ee787>TodoItem</span>
</span></span><span style=display:flex><span>          key<span style=color:#ff7b72;font-weight:700>=</span>{todo.id}
</span></span><span style=display:flex><span>          ref<span style=color:#ff7b72;font-weight:700>=</span>{(node) <span style=color:#ff7b72;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>if</span> (node) {
</span></span><span style=display:flex><span>              todoRefs.current.<span style=color:#ff7b72>set</span>(todo.id, node)
</span></span><span style=display:flex><span>            } <span style=color:#ff7b72>else</span> {
</span></span><span style=display:flex><span>              todoRefs.current.<span style=color:#ff7b72>delete</span>(todo.id)
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>          }}
</span></span><span style=display:flex><span>          todo<span style=color:#ff7b72;font-weight:700>=</span>{todo}
</span></span><span style=display:flex><span>          onToggle<span style=color:#ff7b72;font-weight:700>=</span>{handleToggle}
</span></span><span style=display:flex><span>        /&gt;
</span></span><span style=display:flex><span>      ))}
</span></span><span style=display:flex><span>    &lt;/<span style=color:#7ee787>ul</span>&gt;
</span></span><span style=display:flex><span>  )
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>const</span> TodoItem <span style=color:#ff7b72;font-weight:700>=</span> memo(<span style=color:#ff7b72>function</span> TodoItem({ todo, onToggle }) {
</span></span><span style=display:flex><span>  <span style=color:#ff7b72>return</span> (
</span></span><span style=display:flex><span>    &lt;<span style=color:#7ee787>li</span> onClick<span style=color:#ff7b72;font-weight:700>=</span>{() <span style=color:#ff7b72;font-weight:700>=&gt;</span> onToggle(todo.id)}&gt;
</span></span><span style=display:flex><span>      {todo.text}
</span></span><span style=display:flex><span>    &lt;/<span style=color:#7ee787>li</span>&gt;
</span></span><span style=display:flex><span>  )
</span></span><span style=display:flex><span>})
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// ========== Vue优化 ==========
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// 1. computed缓存
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span><span style=color:#ff7b72>export</span> <span style=color:#ff7b72>default</span> {
</span></span><span style=display:flex><span>  setup() {
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>const</span> items <span style=color:#ff7b72;font-weight:700>=</span> ref([])
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8b949e;font-style:italic>// 计算属性自动缓存
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>    <span style=color:#ff7b72>const</span> filtered <span style=color:#ff7b72;font-weight:700>=</span> computed(() <span style=color:#ff7b72;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span>      <span style=color:#ff7b72>return</span> items.value.filter(item <span style=color:#ff7b72;font-weight:700>=&gt;</span> item.active)
</span></span><span style=display:flex><span>    })
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>const</span> sorted <span style=color:#ff7b72;font-weight:700>=</span> computed(() <span style=color:#ff7b72;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span>      <span style=color:#ff7b72>return</span> filtered.value.sort((a, b) <span style=color:#ff7b72;font-weight:700>=&gt;</span> a.value <span style=color:#ff7b72;font-weight:700>-</span> b.value)
</span></span><span style=display:flex><span>    })
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>return</span> { sorted }
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// 2. v-once/v-memo
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>&lt;<span style=color:#7ee787>template</span>&gt;
</span></span><span style=display:flex><span>  <span style=color:#8b949e;font-style:italic>&lt;!-- 只渲染一次 --&gt;</span>
</span></span><span style=display:flex><span>  &lt;<span style=color:#7ee787>Logo</span> v<span style=color:#f85149>-</span>once /&gt;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#8b949e;font-style:italic>&lt;!-- 按条件记忆 --&gt;</span>
</span></span><span style=display:flex><span>  &lt;<span style=color:#7ee787>div</span> v-for<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>&#34;item in list&#34;</span> <span style=color:#f85149>:</span>key<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>&#34;item.id&#34;</span> v-memo<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>&#34;[item.id, item.selected]&#34;</span>&gt;
</span></span><span style=display:flex><span>    {{ item.text }}
</span></span><span style=display:flex><span>  &lt;/<span style=color:#7ee787>div</span>&gt;
</span></span><span style=display:flex><span>&lt;/<span style=color:#7ee787>template</span>&gt;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// 3. watchEffect优化
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>watchEffect((onCleanup) <span style=color:#ff7b72;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span>  <span style=color:#ff7b72>const</span> timer <span style=color:#ff7b72;font-weight:700>=</span> setInterval(() <span style=color:#ff7b72;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span>    updateData()
</span></span><span style=display:flex><span>  }, <span style=color:#a5d6ff>1000</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  onCleanup(() <span style=color:#ff7b72;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span>    clearInterval(timer) <span style=color:#8b949e;font-style:italic>// 清理副作用
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>  })
</span></span><span style=display:flex><span>})
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// 4. shallowRef/shallowReactive
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// 大对象优化
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span><span style=color:#ff7b72>const</span> state <span style=color:#ff7b72;font-weight:700>=</span> shallowReactive({
</span></span><span style=display:flex><span>  <span style=color:#8b949e;font-style:italic>// 只顶层是响应式的
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>  items: <span style=color:#ff7b72>largeItemsArray</span>
</span></span><span style=display:flex><span>})
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// 只需要重新赋值时使用
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span><span style=color:#ff7b72>const</span> data <span style=color:#ff7b72;font-weight:700>=</span> shallowRef(<span style=color:#79c0ff>null</span>)
</span></span></code></pre></td></tr></table></div></div><h3 id=53-资源优化>5.3 资源优化<a hidden class=anchor aria-hidden=true href=#53-资源优化>#</a></h3><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 56
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 57
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 58
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 59
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 60
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 61
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 62
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 63
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 64
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 65
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 66
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 67
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 68
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 69
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 70
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 71
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 72
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 73
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 74
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 75
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 76
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 77
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 78
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 79
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 80
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 81
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 82
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 83
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 84
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 85
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 86
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 87
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 88
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 89
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 90
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 91
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 92
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 93
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 94
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 95
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 96
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 97
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 98
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 99
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">100
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">101
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">102
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">103
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">104
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">105
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">106
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">107
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">108
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">109
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">110
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">111
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">112
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">113
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">114
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">115
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">116
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">117
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">118
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">119
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">120
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">121
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">122
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">123
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">124
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">125
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">126
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">127
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">128
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">129
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">130
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">131
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">132
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">133
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">134
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">135
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">136
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">137
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">138
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">139
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">140
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">141
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">142
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">143
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">144
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">145
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">146
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">147
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">148
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">149
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">150
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">151
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">152
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">153
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">154
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">155
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">156
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">157
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">158
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">159
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">160
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">161
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">162
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">163
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">164
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">165
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">166
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">167
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">168
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">169
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">170
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">171
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">172
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">173
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">174
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">175
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">176
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">177
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">178
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">179
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">180
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">181
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">182
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">183
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">184
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">185
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">186
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">187
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">188
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">189
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">190
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">191
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">192
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">193
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">194
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">195
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">196
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">197
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">198
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">199
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">200
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">201
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">202
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">203
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">204
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">205
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">206
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">207
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">208
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">209
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">210
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">211
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">212
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">213
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">214
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">215
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">216
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// ========== 图片优化 ==========
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// 1. 响应式图片
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>&lt;<span style=color:#7ee787>picture</span>&gt;
</span></span><span style=display:flex><span>  &lt;<span style=color:#7ee787>source</span>
</span></span><span style=display:flex><span>    media<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>&#34;(min-width: 1024px)&#34;</span>
</span></span><span style=display:flex><span>    srcSet<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>&#34;image-large.webp&#34;</span>
</span></span><span style=display:flex><span>    type<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>&#34;image/webp&#34;</span>
</span></span><span style=display:flex><span>  /&gt;
</span></span><span style=display:flex><span>  &lt;<span style=color:#7ee787>source</span>
</span></span><span style=display:flex><span>    media<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>&#34;(min-width: 768px)&#34;</span>
</span></span><span style=display:flex><span>    srcSet<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>&#34;image-medium.webp&#34;</span>
</span></span><span style=display:flex><span>    type<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>&#34;image/webp&#34;</span>
</span></span><span style=display:flex><span>  /&gt;
</span></span><span style=display:flex><span>  &lt;<span style=color:#7ee787>source</span>
</span></span><span style=display:flex><span>    srcSet<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>&#34;image-small.webp&#34;</span>
</span></span><span style=display:flex><span>    type<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>&#34;image/webp&#34;</span>
</span></span><span style=display:flex><span>  /&gt;
</span></span><span style=display:flex><span>  &lt;<span style=color:#7ee787>img</span>
</span></span><span style=display:flex><span>    src<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>&#34;image-fallback.jpg&#34;</span>
</span></span><span style=display:flex><span>    alt<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>&#34;Description&#34;</span>
</span></span><span style=display:flex><span>    loading<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>&#34;lazy&#34;</span>
</span></span><span style=display:flex><span>  /&gt;
</span></span><span style=display:flex><span>&lt;/<span style=color:#7ee787>picture</span>&gt;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// 2. 懒加载图片
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span><span style=color:#ff7b72>import</span> { lazyload } <span style=color:#ff7b72>from</span> <span style=color:#a5d6ff>&#39;@utils/lazyload&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>function</span> ImageWithLazy({ src, alt }) {
</span></span><span style=display:flex><span>  <span style=color:#ff7b72>const</span> imgRef <span style=color:#ff7b72;font-weight:700>=</span> useRef()
</span></span><span style=display:flex><span>  <span style=color:#ff7b72>const</span> [isLoaded, setIsLoaded] <span style=color:#ff7b72;font-weight:700>=</span> useState(<span style=color:#79c0ff>false</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  useEffect(() <span style=color:#ff7b72;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>const</span> observer <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#ff7b72>new</span> IntersectionObserver(
</span></span><span style=display:flex><span>      (entries) <span style=color:#ff7b72;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span>        entries.forEach(entry <span style=color:#ff7b72;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span>          <span style=color:#ff7b72>if</span> (entry.isIntersecting) {
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>const</span> img <span style=color:#ff7b72;font-weight:700>=</span> entry.target
</span></span><span style=display:flex><span>            img.src <span style=color:#ff7b72;font-weight:700>=</span> img.dataset.src
</span></span><span style=display:flex><span>            observer.unobserve(img)
</span></span><span style=display:flex><span>          }
</span></span><span style=display:flex><span>        })
</span></span><span style=display:flex><span>      },
</span></span><span style=display:flex><span>      { rootMargin<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#a5d6ff>&#39;50px&#39;</span> }
</span></span><span style=display:flex><span>    )
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>if</span> (imgRef.current) {
</span></span><span style=display:flex><span>      observer.observe(imgRef.current)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>return</span> () <span style=color:#ff7b72;font-weight:700>=&gt;</span> observer.disconnect()
</span></span><span style=display:flex><span>  }, [])
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#ff7b72>return</span> (
</span></span><span style=display:flex><span>    &lt;<span style=color:#7ee787>img</span>
</span></span><span style=display:flex><span>      ref<span style=color:#ff7b72;font-weight:700>=</span>{imgRef}
</span></span><span style=display:flex><span>      data-src<span style=color:#ff7b72;font-weight:700>=</span>{src}
</span></span><span style=display:flex><span>      alt<span style=color:#ff7b72;font-weight:700>=</span>{alt}
</span></span><span style=display:flex><span>      onLoad<span style=color:#ff7b72;font-weight:700>=</span>{() <span style=color:#ff7b72;font-weight:700>=&gt;</span> setIsLoaded(<span style=color:#79c0ff>true</span>)}
</span></span><span style=display:flex><span>      style<span style=color:#ff7b72;font-weight:700>=</span>{{ opacity: <span style=color:#ff7b72>isLoaded</span> <span style=color:#ff7b72;font-weight:700>?</span> 1 : <span style=color:#ff7b72>0</span> }}
</span></span><span style=display:flex><span>    /&gt;
</span></span><span style=display:flex><span>  )
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// 3. 图片组件封装
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span><span style=color:#ff7b72>function</span> OptimizedImage({
</span></span><span style=display:flex><span>  src,
</span></span><span style=display:flex><span>  alt,
</span></span><span style=display:flex><span>  width,
</span></span><span style=display:flex><span>  height,
</span></span><span style=display:flex><span>  priority <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#79c0ff>false</span>
</span></span><span style=display:flex><span>}) {
</span></span><span style=display:flex><span>  <span style=color:#ff7b72>const</span> [imageSrc, setImageSrc] <span style=color:#ff7b72;font-weight:700>=</span> useState(<span style=color:#79c0ff>null</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  useEffect(() <span style=color:#ff7b72;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>const</span> load <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#ff7b72>async</span> () <span style=color:#ff7b72;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span>      <span style=color:#8b949e;font-style:italic>// 使用WebP转换服务
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>      <span style=color:#ff7b72>const</span> webpSrc <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#ff7b72>await</span> convertToWebP(src, width)
</span></span><span style=display:flex><span>      setImageSrc(webpSrc)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>if</span> (priority) {
</span></span><span style=display:flex><span>      load()
</span></span><span style=display:flex><span>    } <span style=color:#ff7b72>else</span> {
</span></span><span style=display:flex><span>      <span style=color:#ff7b72>const</span> observer <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#ff7b72>new</span> IntersectionObserver((entries) <span style=color:#ff7b72;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>if</span> (entries[<span style=color:#a5d6ff>0</span>].isIntersecting) {
</span></span><span style=display:flex><span>          load()
</span></span><span style=display:flex><span>          observer.disconnect()
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>      })
</span></span><span style=display:flex><span>      <span style=color:#8b949e;font-style:italic>// ... observe logic
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>    }
</span></span><span style=display:flex><span>  }, [src, width, priority])
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#ff7b72>return</span> &lt;<span style=color:#7ee787>img</span> src<span style=color:#ff7b72;font-weight:700>=</span>{imageSrc} alt<span style=color:#ff7b72;font-weight:700>=</span>{alt} loading<span style=color:#ff7b72;font-weight:700>=</span>{<span style=color:#ff7b72;font-weight:700>!</span>priority <span style=color:#ff7b72;font-weight:700>?</span> <span style=color:#a5d6ff>&#39;lazy&#39;</span> <span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#a5d6ff>&#39;eager&#39;</span>} /&gt;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// ========== 字体优化 ==========
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// 1. 字体预加载
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>&lt;<span style=color:#7ee787>link</span>
</span></span><span style=display:flex><span>  rel<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>&#34;preload&#34;</span>
</span></span><span style=display:flex><span>  href<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>&#34;/fonts/main.woff2&#34;</span>
</span></span><span style=display:flex><span>  as<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>&#34;font&#34;</span>
</span></span><span style=display:flex><span>  type<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>&#34;font/woff2&#34;</span>
</span></span><span style=display:flex><span>  crossOrigin<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>&#34;anonymous&#34;</span>
</span></span><span style=display:flex><span>/&gt;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// 2. 字体显示策略
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span><span style=color:#ff7b72>@font</span><span style=color:#ff7b72;font-weight:700>-</span>face {
</span></span><span style=display:flex><span>  font<span style=color:#ff7b72;font-weight:700>-</span>family<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#a5d6ff>&#39;CustomFont&#39;</span>;
</span></span><span style=display:flex><span>  src: <span style=color:#ff7b72>url</span>(<span style=color:#a5d6ff>&#39;/fonts/custom.woff2&#39;</span>) format(<span style=color:#a5d6ff>&#39;woff2&#39;</span>);
</span></span><span style=display:flex><span>  font<span style=color:#ff7b72;font-weight:700>-</span>display: <span style=color:#ff7b72>swap</span>; <span style=color:#8b949e;font-style:italic>/* 立即显示后备字体 */</span>
</span></span><span style=display:flex><span>  <span style=color:#8b949e;font-style:italic>/* font-display: optional; 短暂等待后使用后备字体 */</span>
</span></span><span style=display:flex><span>  <span style=color:#8b949e;font-style:italic>/* font-display: fallback; 短暂等待，隐藏短时间 */</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// 3. 字体子集化
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// 只包含使用的字符
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// 使用fonttools或在线工具生成subset
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// ========== 第三方资源优化 ==========
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// 动态加载重型库
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span><span style=color:#ff7b72>const</span> loadGoogleMaps <span style=color:#ff7b72;font-weight:700>=</span> () <span style=color:#ff7b72;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span>  <span style=color:#ff7b72>return</span> <span style=color:#ff7b72>new</span> Promise((resolve) <span style=color:#ff7b72;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>if</span> (window.google) {
</span></span><span style=display:flex><span>      resolve(window.google)
</span></span><span style=display:flex><span>      <span style=color:#ff7b72>return</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>const</span> script <span style=color:#ff7b72;font-weight:700>=</span> document.createElement(<span style=color:#a5d6ff>&#39;script&#39;</span>)
</span></span><span style=display:flex><span>    script.src <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>`https://maps.googleapis.com/maps/api/js?key=</span><span style=color:#a5d6ff>${</span>API_KEY<span style=color:#a5d6ff>}</span><span style=color:#a5d6ff>`</span>
</span></span><span style=display:flex><span>    script.<span style=color:#ff7b72>async</span> <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#79c0ff>true</span>
</span></span><span style=display:flex><span>    script.onload <span style=color:#ff7b72;font-weight:700>=</span> () <span style=color:#ff7b72;font-weight:700>=&gt;</span> resolve(window.google)
</span></span><span style=display:flex><span>    document.head.appendChild(script)
</span></span><span style=display:flex><span>  })
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// 使用场景
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span><span style=color:#ff7b72>function</span> MapComponent() {
</span></span><span style=display:flex><span>  <span style=color:#ff7b72>const</span> [map, setMap] <span style=color:#ff7b72;font-weight:700>=</span> useState(<span style=color:#79c0ff>null</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  useEffect(() <span style=color:#ff7b72;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>let</span> mounted <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#79c0ff>true</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    loadGoogleMaps().then(google <span style=color:#ff7b72;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span>      <span style=color:#ff7b72>if</span> (mounted) {
</span></span><span style=display:flex><span>        setMap(<span style=color:#ff7b72>new</span> google.maps.Map(<span style=color:#8b949e;font-style:italic>/* ... */</span>))
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>    })
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>return</span> () <span style=color:#ff7b72;font-weight:700>=&gt;</span> { mounted <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#79c0ff>false</span> }
</span></span><span style=display:flex><span>  }, [])
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#ff7b72>return</span> &lt;<span style=color:#7ee787>div</span> ref<span style=color:#ff7b72;font-weight:700>=</span>{mapRef} /&gt;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// ========== 缓存策略 ==========
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// Service Worker缓存
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// sw.js
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span><span style=color:#ff7b72>const</span> CACHE_NAME <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>&#39;app-v1&#39;</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>const</span> STATIC_CACHE <span style=color:#ff7b72;font-weight:700>=</span> [
</span></span><span style=display:flex><span>  <span style=color:#a5d6ff>&#39;/&#39;</span>,
</span></span><span style=display:flex><span>  <span style=color:#a5d6ff>&#39;/styles/main.css&#39;</span>,
</span></span><span style=display:flex><span>  <span style=color:#a5d6ff>&#39;/scripts/main.js&#39;</span>
</span></span><span style=display:flex><span>]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>self.addEventListener(<span style=color:#a5d6ff>&#39;install&#39;</span>, (event) <span style=color:#ff7b72;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span>  event.waitUntil(
</span></span><span style=display:flex><span>    caches.open(CACHE_NAME).then((cache) <span style=color:#ff7b72;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span>      <span style=color:#ff7b72>return</span> cache.addAll(STATIC_CACHE)
</span></span><span style=display:flex><span>    })
</span></span><span style=display:flex><span>  )
</span></span><span style=display:flex><span>})
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>self.addEventListener(<span style=color:#a5d6ff>&#39;fetch&#39;</span>, (event) <span style=color:#ff7b72;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span>  event.respondWith(
</span></span><span style=display:flex><span>    caches.match(event.request).then((response) <span style=color:#ff7b72;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span>      <span style=color:#ff7b72>return</span> response <span style=color:#ff7b72;font-weight:700>||</span> fetch(event.request)
</span></span><span style=display:flex><span>    })
</span></span><span style=display:flex><span>  )
</span></span><span style=display:flex><span>})
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// 网络优先策略
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span><span style=color:#ff7b72>async</span> <span style=color:#ff7b72>function</span> networkFirst(request) {
</span></span><span style=display:flex><span>  <span style=color:#ff7b72>try</span> {
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>const</span> response <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#ff7b72>await</span> fetch(request)
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>const</span> cache <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#ff7b72>await</span> caches.open(CACHE_NAME)
</span></span><span style=display:flex><span>    cache.put(request, response.clone())
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>return</span> response
</span></span><span style=display:flex><span>  } <span style=color:#ff7b72>catch</span> {
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>return</span> caches.match(request)
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// 缓存优先策略
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span><span style=color:#ff7b72>async</span> <span style=color:#ff7b72>function</span> cacheFirst(request) {
</span></span><span style=display:flex><span>  <span style=color:#ff7b72>const</span> cached <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#ff7b72>await</span> caches.match(request)
</span></span><span style=display:flex><span>  <span style=color:#ff7b72>if</span> (cached) <span style=color:#ff7b72>return</span> cached
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#ff7b72>const</span> response <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#ff7b72>await</span> fetch(request)
</span></span><span style=display:flex><span>  <span style=color:#ff7b72>const</span> cache <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#ff7b72>await</span> caches.open(CACHE_NAME)
</span></span><span style=display:flex><span>  cache.put(request, response.clone())
</span></span><span style=display:flex><span>  <span style=color:#ff7b72>return</span> response
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// 过期策略
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span><span style=color:#ff7b72>async</span> <span style=color:#ff7b72>function</span> staleWhileRevalidate(request) {
</span></span><span style=display:flex><span>  <span style=color:#ff7b72>const</span> cache <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#ff7b72>await</span> caches.open(CACHE_NAME)
</span></span><span style=display:flex><span>  <span style=color:#ff7b72>const</span> cached <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#ff7b72>await</span> cache.match(request)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#ff7b72>const</span> fetchPromise <span style=color:#ff7b72;font-weight:700>=</span> fetch(request).then((response) <span style=color:#ff7b72;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span>    cache.put(request, response.clone())
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>return</span> response
</span></span><span style=display:flex><span>  })
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#ff7b72>return</span> cached <span style=color:#ff7b72;font-weight:700>||</span> fetchPromise
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div><h2 id=六构建优化>六、构建优化<a hidden class=anchor aria-hidden=true href=#六构建优化>#</a></h2><h3 id=61-webpack优化配置>6.1 Webpack优化配置<a hidden class=anchor aria-hidden=true href=#61-webpack优化配置>#</a></h3><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 56
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 57
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 58
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 59
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 60
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 61
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 62
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 63
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 64
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 65
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 66
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 67
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 68
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 69
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 70
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 71
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 72
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 73
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 74
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 75
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 76
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 77
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 78
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 79
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 80
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 81
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 82
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 83
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 84
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 85
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 86
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 87
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 88
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 89
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 90
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 91
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 92
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 93
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 94
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 95
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 96
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 97
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 98
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 99
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">100
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">101
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">102
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">103
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">104
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">105
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">106
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">107
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">108
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">109
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">110
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// webpack.config.js
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span><span style=color:#ff7b72>const</span> path <span style=color:#ff7b72;font-weight:700>=</span> require(<span style=color:#a5d6ff>&#39;path&#39;</span>)
</span></span><span style=display:flex><span><span style=color:#ff7b72>const</span> TerserPlugin <span style=color:#ff7b72;font-weight:700>=</span> require(<span style=color:#a5d6ff>&#39;terser-webpack-plugin&#39;</span>)
</span></span><span style=display:flex><span><span style=color:#ff7b72>const</span> CssMinimizerPlugin <span style=color:#ff7b72;font-weight:700>=</span> require(<span style=color:#a5d6ff>&#39;css-minimizer-webpack-plugin&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>module.exports <span style=color:#ff7b72;font-weight:700>=</span> {
</span></span><span style=display:flex><span>  <span style=color:#8b949e;font-style:italic>// ========== 1. 构建模式 ==========
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>  mode<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#a5d6ff>&#39;production&#39;</span>,
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#8b949e;font-style:italic>// ========== 2. 代码分割 ==========
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>  optimization<span style=color:#ff7b72;font-weight:700>:</span> {
</span></span><span style=display:flex><span>    splitChunks<span style=color:#ff7b72;font-weight:700>:</span> {
</span></span><span style=display:flex><span>      chunks<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#a5d6ff>&#39;all&#39;</span>,
</span></span><span style=display:flex><span>      cacheGroups<span style=color:#ff7b72;font-weight:700>:</span> {
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic>// 框架代码单独打包
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>        framework<span style=color:#ff7b72;font-weight:700>:</span> {
</span></span><span style=display:flex><span>          test<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#79c0ff>/[\\/]node_modules[\\/](react|react-dom|vue)[\\/]/</span>,
</span></span><span style=display:flex><span>          name<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#a5d6ff>&#39;framework&#39;</span>,
</span></span><span style=display:flex><span>          priority<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#a5d6ff>40</span>
</span></span><span style=display:flex><span>        },
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic>// UI库单独打包
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>        ui<span style=color:#ff7b72;font-weight:700>:</span> {
</span></span><span style=display:flex><span>          test<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#79c0ff>/[\\/]node_modules[\\/](@mui|@ant-design|element-plus)[\\/]/</span>,
</span></span><span style=display:flex><span>          name<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#a5d6ff>&#39;ui&#39;</span>,
</span></span><span style=display:flex><span>          priority<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#a5d6ff>30</span>
</span></span><span style=display:flex><span>        },
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic>// 工具库
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>        lib<span style=color:#ff7b72;font-weight:700>:</span> {
</span></span><span style=display:flex><span>          test<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#79c0ff>/[\\/]node_modules[\\/](lodash|axios|dayjs)[\\/]/</span>,
</span></span><span style=display:flex><span>          name<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#a5d6ff>&#39;lib&#39;</span>,
</span></span><span style=display:flex><span>          priority<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#a5d6ff>20</span>
</span></span><span style=display:flex><span>        },
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic>// 公共代码
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>        commons<span style=color:#ff7b72;font-weight:700>:</span> {
</span></span><span style=display:flex><span>          minChunks<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#a5d6ff>2</span>,
</span></span><span style=display:flex><span>          priority<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#a5d6ff>10</span>,
</span></span><span style=display:flex><span>          reuseExistingChunk<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#79c0ff>true</span>
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>    },
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8b949e;font-style:italic>// 运行时代码单独提取
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>    runtimeChunk<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#a5d6ff>&#39;single&#39;</span>,
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8b949e;font-style:italic>// 压缩配置
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>    minimize<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#79c0ff>true</span>,
</span></span><span style=display:flex><span>    minimizer<span style=color:#ff7b72;font-weight:700>:</span> [
</span></span><span style=display:flex><span>      <span style=color:#ff7b72>new</span> TerserPlugin({
</span></span><span style=display:flex><span>        terserOptions<span style=color:#ff7b72;font-weight:700>:</span> {
</span></span><span style=display:flex><span>          parse<span style=color:#ff7b72;font-weight:700>:</span> { ecma<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#a5d6ff>8</span> },
</span></span><span style=display:flex><span>          compress<span style=color:#ff7b72;font-weight:700>:</span> {
</span></span><span style=display:flex><span>            ecma<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#a5d6ff>5</span>,
</span></span><span style=display:flex><span>            warnings<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#79c0ff>false</span>,
</span></span><span style=display:flex><span>            comparisons<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#79c0ff>false</span>,
</span></span><span style=display:flex><span>            inline<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#a5d6ff>2</span>,
</span></span><span style=display:flex><span>            drop_console<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#79c0ff>true</span>
</span></span><span style=display:flex><span>          },
</span></span><span style=display:flex><span>          mangle<span style=color:#ff7b72;font-weight:700>:</span> { safari10<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#79c0ff>true</span> },
</span></span><span style=display:flex><span>          output<span style=color:#ff7b72;font-weight:700>:</span> {
</span></span><span style=display:flex><span>            ecma<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#a5d6ff>5</span>,
</span></span><span style=display:flex><span>            comments<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#79c0ff>false</span>,
</span></span><span style=display:flex><span>            ascii_only<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#79c0ff>true</span>
</span></span><span style=display:flex><span>          }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>      }),
</span></span><span style=display:flex><span>      <span style=color:#ff7b72>new</span> CssMinimizerPlugin()
</span></span><span style=display:flex><span>    ]
</span></span><span style=display:flex><span>  },
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#8b949e;font-style:italic>// ========== 3. 模块解析 ==========
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>  resolve<span style=color:#ff7b72;font-weight:700>:</span> {
</span></span><span style=display:flex><span>    <span style=color:#8b949e;font-style:italic>// 路径别名
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>    alias<span style=color:#ff7b72;font-weight:700>:</span> {
</span></span><span style=display:flex><span>      <span style=color:#a5d6ff>&#39;@&#39;</span><span style=color:#ff7b72;font-weight:700>:</span> path.resolve(__dirname, <span style=color:#a5d6ff>&#39;src&#39;</span>),
</span></span><span style=display:flex><span>      <span style=color:#a5d6ff>&#39;@components&#39;</span><span style=color:#ff7b72;font-weight:700>:</span> path.resolve(__dirname, <span style=color:#a5d6ff>&#39;src/components&#39;</span>),
</span></span><span style=display:flex><span>      <span style=color:#a5d6ff>&#39;@utils&#39;</span><span style=color:#ff7b72;font-weight:700>:</span> path.resolve(__dirname, <span style=color:#a5d6ff>&#39;src/utils&#39;</span>)
</span></span><span style=display:flex><span>    },
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8b949e;font-style:italic>// 扩展名
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>    extensions<span style=color:#ff7b72;font-weight:700>:</span> [<span style=color:#a5d6ff>&#39;.js&#39;</span>, <span style=color:#a5d6ff>&#39;.jsx&#39;</span>, <span style=color:#a5d6ff>&#39;.ts&#39;</span>, <span style=color:#a5d6ff>&#39;.tsx&#39;</span>, <span style=color:#a5d6ff>&#39;.vue&#39;</span>, <span style=color:#a5d6ff>&#39;.json&#39;</span>],
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8b949e;font-style:italic>// 模块查找路径
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>    modules<span style=color:#ff7b72;font-weight:700>:</span> [<span style=color:#a5d6ff>&#39;node_modules&#39;</span>, path.resolve(__dirname, <span style=color:#a5d6ff>&#39;src&#39;</span>)]
</span></span><span style=display:flex><span>  },
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#8b949e;font-style:italic>// ========== 4. 缓存配置 ==========
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>  cache<span style=color:#ff7b72;font-weight:700>:</span> {
</span></span><span style=display:flex><span>    type<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#a5d6ff>&#39;filesystem&#39;</span>,
</span></span><span style=display:flex><span>    buildDependencies<span style=color:#ff7b72;font-weight:700>:</span> {
</span></span><span style=display:flex><span>      config<span style=color:#ff7b72;font-weight:700>:</span> [__filename]
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  },
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#8b949e;font-style:italic>// ========== 5. 输出配置 ==========
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>  output<span style=color:#ff7b72;font-weight:700>:</span> {
</span></span><span style=display:flex><span>    path<span style=color:#ff7b72;font-weight:700>:</span> path.resolve(__dirname, <span style=color:#a5d6ff>&#39;dist&#39;</span>),
</span></span><span style=display:flex><span>    filename<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#a5d6ff>&#39;js/[name].[contenthash:8].js&#39;</span>,
</span></span><span style=display:flex><span>    chunkFilename<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#a5d6ff>&#39;js/[name].[contenthash:8].chunk.js&#39;</span>,
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8b949e;font-style:italic>// 资源文件名
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>    assetModuleFilename<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#a5d6ff>&#39;assets/[name].[hash:8][ext]&#39;</span>
</span></span><span style=display:flex><span>  },
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#8b949e;font-style:italic>// ========== 6. 性能优化 ==========
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>  performance<span style=color:#ff7b72;font-weight:700>:</span> {
</span></span><span style=display:flex><span>    hints<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#a5d6ff>&#39;warning&#39;</span>,
</span></span><span style=display:flex><span>    maxAssetSize<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#a5d6ff>244</span> <span style=color:#ff7b72;font-weight:700>*</span> <span style=color:#a5d6ff>1024</span>, <span style=color:#8b949e;font-style:italic>// 244KB
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>    maxEntrypointSize<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#a5d6ff>244</span> <span style=color:#ff7b72;font-weight:700>*</span> <span style=color:#a5d6ff>1024</span>
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div><h3 id=62-vite优化配置>6.2 Vite优化配置<a hidden class=anchor aria-hidden=true href=#62-vite优化配置>#</a></h3><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 56
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 57
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 58
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 59
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 60
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 61
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 62
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 63
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 64
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 65
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 66
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 67
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 68
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 69
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 70
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 71
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 72
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 73
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 74
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 75
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 76
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 77
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 78
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 79
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 80
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 81
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 82
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 83
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 84
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 85
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 86
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 87
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 88
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 89
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 90
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 91
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 92
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 93
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 94
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 95
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 96
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 97
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 98
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 99
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">100
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">101
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">102
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">103
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">104
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// vite.config.ts
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span><span style=color:#ff7b72>import</span> { defineConfig } from <span style=color:#a5d6ff>&#39;vite&#39;</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>import</span> vue from <span style=color:#a5d6ff>&#39;@vitejs/plugin-vue&#39;</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>import</span> { visualizer } from <span style=color:#a5d6ff>&#39;rollup-plugin-visualizer&#39;</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>import</span> viteCompression from <span style=color:#a5d6ff>&#39;vite-plugin-compression&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>export</span> <span style=color:#ff7b72>default</span> defineConfig({
</span></span><span style=display:flex><span>  plugins<span style=color:#ff7b72;font-weight:700>:</span> [
</span></span><span style=display:flex><span>    vue(),
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8b949e;font-style:italic>// 构建分析
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>    visualizer({
</span></span><span style=display:flex><span>      open<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#79c0ff>true</span>,
</span></span><span style=display:flex><span>      gzipSize<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#79c0ff>true</span>,
</span></span><span style=display:flex><span>      brotliSize<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#79c0ff>true</span>
</span></span><span style=display:flex><span>    }),
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8b949e;font-style:italic>// Gzip压缩
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>    viteCompression({
</span></span><span style=display:flex><span>      algorithm<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#a5d6ff>&#39;gzip&#39;</span>,
</span></span><span style=display:flex><span>      ext<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#a5d6ff>&#39;.gz&#39;</span>
</span></span><span style=display:flex><span>    }),
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8b949e;font-style:italic>// Brotli压缩
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>    viteCompression({
</span></span><span style=display:flex><span>      algorithm<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#a5d6ff>&#39;brotliCompress&#39;</span>,
</span></span><span style=display:flex><span>      ext<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#a5d6ff>&#39;.br&#39;</span>
</span></span><span style=display:flex><span>    })
</span></span><span style=display:flex><span>  ],
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  build<span style=color:#ff7b72;font-weight:700>:</span> {
</span></span><span style=display:flex><span>    <span style=color:#8b949e;font-style:italic>// 产物目录
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>    outDir<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#a5d6ff>&#39;dist&#39;</span>,
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8b949e;font-style:italic>// 静态资源目录
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>    assetsDir<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#a5d6ff>&#39;assets&#39;</span>,
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8b949e;font-style:italic>// 生成source map
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>    sourcemap<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#79c0ff>false</span>,
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8b949e;font-style:italic>// 构建后是否生成 manifest.json
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>    manifest<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#79c0ff>true</span>,
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8b949e;font-style:italic>// chunk大小警告阈值
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>    chunkSizeWarningLimit<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#a5d6ff>1000</span>,
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8b949e;font-style:italic>// 代码分割
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>    rollupOptions<span style=color:#ff7b72;font-weight:700>:</span> {
</span></span><span style=display:flex><span>      output<span style=color:#ff7b72;font-weight:700>:</span> {
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic>// 手动分包
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>        manualChunks<span style=color:#ff7b72;font-weight:700>:</span> {
</span></span><span style=display:flex><span>          <span style=color:#a5d6ff>&#39;vue-vendor&#39;</span><span style=color:#ff7b72;font-weight:700>:</span> [<span style=color:#a5d6ff>&#39;vue&#39;</span>, <span style=color:#a5d6ff>&#39;vue-router&#39;</span>, <span style=color:#a5d6ff>&#39;pinia&#39;</span>],
</span></span><span style=display:flex><span>          <span style=color:#a5d6ff>&#39;ui-lib&#39;</span><span style=color:#ff7b72;font-weight:700>:</span> [<span style=color:#a5d6ff>&#39;element-plus&#39;</span>],
</span></span><span style=display:flex><span>          <span style=color:#a5d6ff>&#39;utils&#39;</span><span style=color:#ff7b72;font-weight:700>:</span> [<span style=color:#a5d6ff>&#39;axios&#39;</span>, <span style=color:#a5d6ff>&#39;lodash-es&#39;</span>, <span style=color:#a5d6ff>&#39;dayjs&#39;</span>]
</span></span><span style=display:flex><span>        },
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic>// 文件命名
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>        chunkFileNames<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#a5d6ff>&#39;js/[name]-[hash].js&#39;</span>,
</span></span><span style=display:flex><span>        entryFileNames<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#a5d6ff>&#39;js/[name]-[hash].js&#39;</span>,
</span></span><span style=display:flex><span>        assetFileNames<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#a5d6ff>&#39;[ext]/[name]-[hash].[ext]&#39;</span>
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>    },
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8b949e;font-style:italic>// 压缩
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>    minify<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#a5d6ff>&#39;terser&#39;</span>,
</span></span><span style=display:flex><span>    terserOptions<span style=color:#ff7b72;font-weight:700>:</span> {
</span></span><span style=display:flex><span>      compress<span style=color:#ff7b72;font-weight:700>:</span> {
</span></span><span style=display:flex><span>        drop_console<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#79c0ff>true</span>,
</span></span><span style=display:flex><span>        drop_debugger<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#79c0ff>true</span>
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  },
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#8b949e;font-style:italic>// 依赖优化
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>  optimizeDeps<span style=color:#ff7b72;font-weight:700>:</span> {
</span></span><span style=display:flex><span>    include<span style=color:#ff7b72;font-weight:700>:</span> [<span style=color:#a5d6ff>&#39;vue&#39;</span>, <span style=color:#a5d6ff>&#39;vue-router&#39;</span>, <span style=color:#a5d6ff>&#39;pinia&#39;</span>],
</span></span><span style=display:flex><span>    exclude<span style=color:#ff7b72;font-weight:700>:</span> [<span style=color:#a5d6ff>&#39;some-large-dep&#39;</span>]
</span></span><span style=display:flex><span>  },
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#8b949e;font-style:italic>// CSS配置
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>  css<span style=color:#ff7b72;font-weight:700>:</span> {
</span></span><span style=display:flex><span>    modules<span style=color:#ff7b72;font-weight:700>:</span> {
</span></span><span style=display:flex><span>      localsConvention<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#a5d6ff>&#39;camelCase&#39;</span>
</span></span><span style=display:flex><span>    },
</span></span><span style=display:flex><span>    preprocessorOptions<span style=color:#ff7b72;font-weight:700>:</span> {
</span></span><span style=display:flex><span>      scss<span style=color:#ff7b72;font-weight:700>:</span> {
</span></span><span style=display:flex><span>        additionalData<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#a5d6ff>`@import &#34;@/styles/variables.scss&#34;;`</span>
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  },
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#8b949e;font-style:italic>// 开发服务器
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>  server<span style=color:#ff7b72;font-weight:700>:</span> {
</span></span><span style=display:flex><span>    port<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#a5d6ff>3000</span>,
</span></span><span style=display:flex><span>    open<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#79c0ff>true</span>,
</span></span><span style=display:flex><span>    proxy<span style=color:#ff7b72;font-weight:700>:</span> {
</span></span><span style=display:flex><span>      <span style=color:#a5d6ff>&#39;/api&#39;</span><span style=color:#ff7b72;font-weight:700>:</span> {
</span></span><span style=display:flex><span>        target<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#a5d6ff>&#39;http://localhost:8080&#39;</span>,
</span></span><span style=display:flex><span>        changeOrigin<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#79c0ff>true</span>,
</span></span><span style=display:flex><span>        rewrite<span style=color:#ff7b72;font-weight:700>:</span> (path) =&gt; path.replace(<span style=color:#79c0ff>/^\/api/</span>, <span style=color:#a5d6ff>&#39;&#39;</span>)
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>})
</span></span></code></pre></td></tr></table></div></div><h2 id=七监控与调试>七、监控与调试<a hidden class=anchor aria-hidden=true href=#七监控与调试>#</a></h2><h3 id=71-性能监控>7.1 性能监控<a hidden class=anchor aria-hidden=true href=#71-性能监控>#</a></h3><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 56
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 57
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 58
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 59
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 60
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 61
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 62
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 63
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 64
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 65
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 66
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 67
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 68
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 69
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 70
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 71
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 72
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 73
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 74
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 75
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 76
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 77
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 78
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 79
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 80
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 81
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 82
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 83
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 84
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 85
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 86
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 87
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 88
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 89
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 90
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 91
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 92
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 93
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 94
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 95
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 96
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 97
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 98
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 99
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">100
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">101
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">102
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">103
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">104
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">105
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">106
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">107
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">108
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">109
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">110
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">111
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">112
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">113
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">114
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">115
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">116
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">117
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">118
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">119
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">120
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">121
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">122
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">123
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">124
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">125
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">126
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">127
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">128
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">129
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">130
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">131
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">132
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">133
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">134
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">135
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">136
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">137
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">138
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">139
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">140
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">141
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">142
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">143
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">144
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">145
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">146
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">147
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">148
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">149
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">150
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">151
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">152
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">153
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">154
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">155
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">156
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">157
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">158
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">159
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">160
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">161
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">162
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">163
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">164
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">165
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">166
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">167
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">168
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">169
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">170
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">171
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">172
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">173
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">174
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">175
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">176
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">177
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">178
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">179
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">180
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">181
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">182
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">183
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">184
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">185
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">186
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">187
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">188
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">189
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">190
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">191
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">192
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">193
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">194
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">195
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">196
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">197
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">198
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">199
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">200
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">201
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">202
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// ========== Core Web Vitals监控 ==========
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// utils/performanceMonitor.ts
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span><span style=color:#ff7b72>interface</span> PerformanceMetrics {
</span></span><span style=display:flex><span>  FCP: <span style=color:#ff7b72>number</span> <span style=color:#8b949e;font-style:italic>// First Contentful Paint
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>  LCP: <span style=color:#ff7b72>number</span> <span style=color:#8b949e;font-style:italic>// Largest Contentful Paint
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>  FID: <span style=color:#ff7b72>number</span> <span style=color:#8b949e;font-style:italic>// First Input Delay
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>  CLS: <span style=color:#ff7b72>number</span> <span style=color:#8b949e;font-style:italic>// Cumulative Layout Shift
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>  TTFB: <span style=color:#ff7b72>number</span> <span style=color:#8b949e;font-style:italic>// Time to First Byte
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>export</span> <span style=color:#ff7b72>class</span> PerformanceMonitor {
</span></span><span style=display:flex><span>  <span style=color:#ff7b72>private</span> metrics: <span style=color:#ff7b72>Partial</span>&lt;<span style=color:#7ee787>PerformanceMetrics</span>&gt; <span style=color:#ff7b72;font-weight:700>=</span> {}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#ff7b72>async</span> collectMetrics()<span style=color:#ff7b72;font-weight:700>:</span> Promise&lt;<span style=color:#7ee787>PerformanceMetrics</span>&gt; {
</span></span><span style=display:flex><span>    <span style=color:#8b949e;font-style:italic>// 等待页面加载完成
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>    <span style=color:#ff7b72>await</span> <span style=color:#ff7b72>new</span> Promise(resolve <span style=color:#ff7b72;font-weight:700>=&gt;</span> window.addEventListener(<span style=color:#a5d6ff>&#39;load&#39;</span>, resolve))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8b949e;font-style:italic>// FCP
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>    <span style=color:#ff7b72>const</span> fcpEntry <span style=color:#ff7b72;font-weight:700>=</span> performance.getEntriesByName(<span style=color:#a5d6ff>&#39;first-contentful-paint&#39;</span>)[<span style=color:#a5d6ff>0</span>] <span style=color:#ff7b72>as</span> <span style=color:#ff7b72>any</span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>this</span>.metrics.FCP <span style=color:#ff7b72;font-weight:700>=</span> fcpEntry<span style=color:#ff7b72;font-weight:700>?</span>.startTime <span style=color:#ff7b72;font-weight:700>||</span> <span style=color:#a5d6ff>0</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8b949e;font-style:italic>// LCP
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>    <span style=color:#ff7b72>this</span>.metrics.LCP <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#ff7b72>await</span> <span style=color:#ff7b72>this</span>.getLCP()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8b949e;font-style:italic>// FID
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>    <span style=color:#ff7b72>this</span>.metrics.FID <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#ff7b72>await</span> <span style=color:#ff7b72>this</span>.getFID()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8b949e;font-style:italic>// CLS
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>    <span style=color:#ff7b72>this</span>.metrics.CLS <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#ff7b72>await</span> <span style=color:#ff7b72>this</span>.getCLS()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8b949e;font-style:italic>// TTFB
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>    <span style=color:#ff7b72>const</span> navigation <span style=color:#ff7b72;font-weight:700>=</span> performance.getEntriesByType(<span style=color:#a5d6ff>&#39;navigation&#39;</span>)[<span style=color:#a5d6ff>0</span>] <span style=color:#ff7b72>as</span> <span style=color:#ff7b72>any</span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>this</span>.metrics.TTFB <span style=color:#ff7b72;font-weight:700>=</span> navigation<span style=color:#ff7b72;font-weight:700>?</span>.responseStart <span style=color:#ff7b72;font-weight:700>||</span> <span style=color:#a5d6ff>0</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>return</span> <span style=color:#ff7b72>this</span>.metrics <span style=color:#ff7b72>as</span> PerformanceMetrics
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#ff7b72>private</span> getLCP()<span style=color:#ff7b72;font-weight:700>:</span> Promise&lt;<span style=color:#7ee787>number</span>&gt; {
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>return</span> <span style=color:#ff7b72>new</span> Promise(resolve <span style=color:#ff7b72;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span>      <span style=color:#ff7b72>new</span> PerformanceObserver((list) <span style=color:#ff7b72;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>const</span> entries <span style=color:#ff7b72;font-weight:700>=</span> list.getEntries()
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>const</span> lastEntry <span style=color:#ff7b72;font-weight:700>=</span> entries[entries.length <span style=color:#ff7b72;font-weight:700>-</span> <span style=color:#a5d6ff>1</span>] <span style=color:#ff7b72>as</span> <span style=color:#ff7b72>any</span>
</span></span><span style=display:flex><span>        resolve(lastEntry<span style=color:#ff7b72;font-weight:700>?</span>.startTime <span style=color:#ff7b72;font-weight:700>||</span> <span style=color:#a5d6ff>0</span>)
</span></span><span style=display:flex><span>      }).observe({ entryTypes<span style=color:#ff7b72;font-weight:700>:</span> [<span style=color:#a5d6ff>&#39;largest-contentful-paint&#39;</span>] })
</span></span><span style=display:flex><span>    })
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#ff7b72>private</span> getFID()<span style=color:#ff7b72;font-weight:700>:</span> Promise&lt;<span style=color:#7ee787>number</span>&gt; {
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>return</span> <span style=color:#ff7b72>new</span> Promise(resolve <span style=color:#ff7b72;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span>      <span style=color:#ff7b72>new</span> PerformanceObserver((list) <span style=color:#ff7b72;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>const</span> firstInput <span style=color:#ff7b72;font-weight:700>=</span> list.getEntries()[<span style=color:#a5d6ff>0</span>] <span style=color:#ff7b72>as</span> <span style=color:#ff7b72>any</span>
</span></span><span style=display:flex><span>        resolve(firstInput<span style=color:#ff7b72;font-weight:700>?</span>.processingStart <span style=color:#ff7b72;font-weight:700>-</span> firstInput<span style=color:#ff7b72;font-weight:700>?</span>.startTime <span style=color:#ff7b72;font-weight:700>||</span> <span style=color:#a5d6ff>0</span>)
</span></span><span style=display:flex><span>      }).observe({ entryTypes<span style=color:#ff7b72;font-weight:700>:</span> [<span style=color:#a5d6ff>&#39;first-input&#39;</span>] })
</span></span><span style=display:flex><span>    })
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#ff7b72>private</span> getCLS()<span style=color:#ff7b72;font-weight:700>:</span> Promise&lt;<span style=color:#7ee787>number</span>&gt; {
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>return</span> <span style=color:#ff7b72>new</span> Promise(resolve <span style=color:#ff7b72;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span>      <span style=color:#ff7b72>let</span> clsValue <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>0</span>
</span></span><span style=display:flex><span>      <span style=color:#ff7b72>new</span> PerformanceObserver((list) <span style=color:#ff7b72;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>for</span> (<span style=color:#ff7b72>const</span> entry <span style=color:#ff7b72>of</span> list.getEntries() <span style=color:#ff7b72>as</span> <span style=color:#ff7b72>any</span>[]) {
</span></span><span style=display:flex><span>          <span style=color:#ff7b72>if</span> (<span style=color:#ff7b72;font-weight:700>!</span>entry.hadRecentInput) {
</span></span><span style=display:flex><span>            clsValue <span style=color:#ff7b72;font-weight:700>+=</span> entry.value
</span></span><span style=display:flex><span>          }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        resolve(clsValue)
</span></span><span style=display:flex><span>      }).observe({ entryTypes<span style=color:#ff7b72;font-weight:700>:</span> [<span style=color:#a5d6ff>&#39;layout-shift&#39;</span>] })
</span></span><span style=display:flex><span>    })
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  reportToAnalytics(metrics: <span style=color:#ff7b72>PerformanceMetrics</span>) {
</span></span><span style=display:flex><span>    <span style=color:#8b949e;font-style:italic>// 发送到分析平台
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>    analytics.track(<span style=color:#a5d6ff>&#39;page_performance&#39;</span>, {
</span></span><span style=display:flex><span>      fcp: <span style=color:#ff7b72>metrics.FCP</span>,
</span></span><span style=display:flex><span>      lcp: <span style=color:#ff7b72>metrics.LCP</span>,
</span></span><span style=display:flex><span>      fid: <span style=color:#ff7b72>metrics.FID</span>,
</span></span><span style=display:flex><span>      cls: <span style=color:#ff7b72>metrics.CLS</span>,
</span></span><span style=display:flex><span>      ttfb: <span style=color:#ff7b72>metrics.TTFB</span>,
</span></span><span style=display:flex><span>      url: <span style=color:#ff7b72>window.location.href</span>,
</span></span><span style=display:flex><span>      userAgent: <span style=color:#ff7b72>navigator.userAgent</span>
</span></span><span style=display:flex><span>    })
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// ========== 错误监控 ==========
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// utils/errorTracker.ts
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span><span style=color:#ff7b72>export</span> <span style=color:#ff7b72>class</span> ErrorTracker {
</span></span><span style=display:flex><span>  <span style=color:#ff7b72>private</span> errors: <span style=color:#ff7b72>Error</span>[] <span style=color:#ff7b72;font-weight:700>=</span> []
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  init() {
</span></span><span style=display:flex><span>    <span style=color:#8b949e;font-style:italic>// 全局错误捕获
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>    window.addEventListener(<span style=color:#a5d6ff>&#39;error&#39;</span>, (event) <span style=color:#ff7b72;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span>      <span style=color:#ff7b72>this</span>.captureError(event.error <span style=color:#ff7b72;font-weight:700>||</span> <span style=color:#ff7b72>new</span> Error(event.message))
</span></span><span style=display:flex><span>    })
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8b949e;font-style:italic>// Promise拒绝捕获
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>    window.addEventListener(<span style=color:#a5d6ff>&#39;unhandledrejection&#39;</span>, (event) <span style=color:#ff7b72;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span>      <span style=color:#ff7b72>this</span>.captureError(event.reason)
</span></span><span style=display:flex><span>    })
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8b949e;font-style:italic>// Vue错误处理
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>    <span style=color:#ff7b72>if</span> (<span style=color:#ff7b72>typeof</span> app <span style=color:#ff7b72;font-weight:700>!==</span> <span style=color:#a5d6ff>&#39;undefined&#39;</span> <span style=color:#ff7b72;font-weight:700>&amp;&amp;</span> app.config) {
</span></span><span style=display:flex><span>      app.config.errorHandler <span style=color:#ff7b72;font-weight:700>=</span> (err, instance, info) <span style=color:#ff7b72;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>this</span>.captureError(err, {
</span></span><span style=display:flex><span>          componentName: <span style=color:#ff7b72>instance?.$options?.name</span>,
</span></span><span style=display:flex><span>          lifecycle: <span style=color:#ff7b72>info</span>
</span></span><span style=display:flex><span>        })
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  captureError(error: <span style=color:#ff7b72>Error</span>, context?: <span style=color:#ff7b72>any</span>) {
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>const</span> errorInfo <span style=color:#ff7b72;font-weight:700>=</span> {
</span></span><span style=display:flex><span>      message: <span style=color:#ff7b72>error.message</span>,
</span></span><span style=display:flex><span>      stack: <span style=color:#ff7b72>error.stack</span>,
</span></span><span style=display:flex><span>      timestamp: <span style=color:#ff7b72>Date.now</span>(),
</span></span><span style=display:flex><span>      url: <span style=color:#ff7b72>window.location.href</span>,
</span></span><span style=display:flex><span>      userAgent: <span style=color:#ff7b72>navigator.userAgent</span>,
</span></span><span style=display:flex><span>      context
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>this</span>.errors.push(error <span style=color:#ff7b72>as</span> <span style=color:#ff7b72>any</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8b949e;font-style:italic>// 发送到错误追踪服务
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>    <span style=color:#ff7b72>this</span>.sendToService(errorInfo)
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#ff7b72>private</span> sendToService(errorInfo: <span style=color:#ff7b72>any</span>) {
</span></span><span style=display:flex><span>    <span style=color:#8b949e;font-style:italic>// 发送到Sentry、自建服务等
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>    fetch(<span style=color:#a5d6ff>&#39;/api/errors&#39;</span>, {
</span></span><span style=display:flex><span>      method<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#a5d6ff>&#39;POST&#39;</span>,
</span></span><span style=display:flex><span>      headers<span style=color:#ff7b72;font-weight:700>:</span> { <span style=color:#a5d6ff>&#39;Content-Type&#39;</span><span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#a5d6ff>&#39;application/json&#39;</span> },
</span></span><span style=display:flex><span>      body: <span style=color:#ff7b72>JSON.stringify</span>(errorInfo)
</span></span><span style=display:flex><span>    }).<span style=color:#ff7b72>catch</span>(console.error)
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// ========== 用户行为追踪 ==========
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// utils/analytics.ts
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span><span style=color:#ff7b72>export</span> <span style=color:#ff7b72>class</span> UserBehaviorTracker {
</span></span><span style=display:flex><span>  <span style=color:#ff7b72>private</span> events: <span style=color:#ff7b72>any</span>[] <span style=color:#ff7b72;font-weight:700>=</span> []
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  trackPageView() {
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>this</span>.trackEvent(<span style=color:#a5d6ff>&#39;page_view&#39;</span>, {
</span></span><span style=display:flex><span>      url: <span style=color:#ff7b72>window.location.href</span>,
</span></span><span style=display:flex><span>      referrer: <span style=color:#ff7b72>document.referrer</span>,
</span></span><span style=display:flex><span>      title: <span style=color:#ff7b72>document.title</span>
</span></span><span style=display:flex><span>    })
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  trackClick(element: <span style=color:#ff7b72>HTMLElement</span>) {
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>this</span>.trackEvent(<span style=color:#a5d6ff>&#39;click&#39;</span>, {
</span></span><span style=display:flex><span>      tagName: <span style=color:#ff7b72>element.tagName</span>,
</span></span><span style=display:flex><span>      id: <span style=color:#ff7b72>element.id</span>,
</span></span><span style=display:flex><span>      className: <span style=color:#ff7b72>element.className</span>,
</span></span><span style=display:flex><span>      text: <span style=color:#ff7b72>element.textContent?.substring</span>(<span style=color:#a5d6ff>0</span>, <span style=color:#a5d6ff>50</span>)
</span></span><span style=display:flex><span>    })
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  trackScroll(depth: <span style=color:#ff7b72>number</span>) {
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>this</span>.trackEvent(<span style=color:#a5d6ff>&#39;scroll&#39;</span>, {
</span></span><span style=display:flex><span>      scrollDepth: <span style=color:#ff7b72>depth</span>,
</span></span><span style=display:flex><span>      pageHeight: <span style=color:#ff7b72>document.body.scrollHeight</span>
</span></span><span style=display:flex><span>    })
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  trackEngagement(duration: <span style=color:#ff7b72>number</span>) {
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>this</span>.trackEvent(<span style=color:#a5d6ff>&#39;engagement&#39;</span>, {
</span></span><span style=display:flex><span>      duration,
</span></span><span style=display:flex><span>      interactions: <span style=color:#ff7b72>this.events.length</span>
</span></span><span style=display:flex><span>    })
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#ff7b72>private</span> trackEvent(<span style=color:#ff7b72>type</span><span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#ff7b72>string</span>, data: <span style=color:#ff7b72>any</span>) {
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>const</span> event <span style=color:#ff7b72;font-weight:700>=</span> {
</span></span><span style=display:flex><span>      <span style=color:#ff7b72>type</span>,
</span></span><span style=display:flex><span>      data,
</span></span><span style=display:flex><span>      timestamp: <span style=color:#ff7b72>Date.now</span>()
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>this</span>.events.push(event)
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>this</span>.sendEvent(event)
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#ff7b72>private</span> sendEvent(event: <span style=color:#ff7b72>any</span>) {
</span></span><span style=display:flex><span>    <span style=color:#8b949e;font-style:italic>// 批量发送或实时发送
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>    <span style=color:#ff7b72>if</span> (<span style=color:#ff7b72>this</span>.events.length <span style=color:#ff7b72;font-weight:700>&gt;=</span> <span style=color:#a5d6ff>10</span>) {
</span></span><span style=display:flex><span>      <span style=color:#ff7b72>this</span>.flush()
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  flush() {
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>if</span> (<span style=color:#ff7b72>this</span>.events.length <span style=color:#ff7b72;font-weight:700>===</span> <span style=color:#a5d6ff>0</span>) <span style=color:#ff7b72>return</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    fetch(<span style=color:#a5d6ff>&#39;/api/analytics/events&#39;</span>, {
</span></span><span style=display:flex><span>      method<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#a5d6ff>&#39;POST&#39;</span>,
</span></span><span style=display:flex><span>      headers<span style=color:#ff7b72;font-weight:700>:</span> { <span style=color:#a5d6ff>&#39;Content-Type&#39;</span><span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#a5d6ff>&#39;application/json&#39;</span> },
</span></span><span style=display:flex><span>      body: <span style=color:#ff7b72>JSON.stringify</span>({ events: <span style=color:#ff7b72>this.events</span> })
</span></span><span style=display:flex><span>    }).then(() <span style=color:#ff7b72;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span>      <span style=color:#ff7b72>this</span>.events <span style=color:#ff7b72;font-weight:700>=</span> []
</span></span><span style=display:flex><span>    }).<span style=color:#ff7b72>catch</span>(console.error)
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div><h3 id=72-调试工具>7.2 调试工具<a hidden class=anchor aria-hidden=true href=#72-调试工具>#</a></h3><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">56
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">57
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">58
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">59
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">60
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">61
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">62
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">63
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">64
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">65
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">66
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">67
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">68
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">69
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">70
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">71
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">72
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">73
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">74
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">75
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">76
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">77
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// ========== Vue DevTools集成 ==========
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// 开发环境启用调试功能
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span><span style=color:#ff7b72>if</span> (<span style=color:#ff7b72>import</span>.meta.env.DEV) {
</span></span><span style=display:flex><span>  app.config.devtools <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#79c0ff>true</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#8b949e;font-style:italic>// 添加组件名称便于调试
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>  app.component(<span style=color:#a5d6ff>&#39;UserProfile&#39;</span>, UserProfile)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// ========== React DevTools ==========
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// 使用React Developer Tools Profiler
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span><span style=color:#ff7b72>import</span> { Profiler } <span style=color:#ff7b72>from</span> <span style=color:#a5d6ff>&#39;react&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>function</span> onRenderCallback(
</span></span><span style=display:flex><span>  id,
</span></span><span style=display:flex><span>  phase,
</span></span><span style=display:flex><span>  actualDuration,
</span></span><span style=display:flex><span>  baseDuration,
</span></span><span style=display:flex><span>  startTime,
</span></span><span style=display:flex><span>  commitTime
</span></span><span style=display:flex><span>) {
</span></span><span style=display:flex><span>  console.log({
</span></span><span style=display:flex><span>    id,
</span></span><span style=display:flex><span>    phase,
</span></span><span style=display:flex><span>    actualDuration,
</span></span><span style=display:flex><span>    baseDuration,
</span></span><span style=display:flex><span>    startTime,
</span></span><span style=display:flex><span>    commitTime
</span></span><span style=display:flex><span>  })
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>&lt;<span style=color:#7ee787>Profiler</span> id<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>&#34;UserProfile&#34;</span> onRender<span style=color:#ff7b72;font-weight:700>=</span>{onRenderCallback}&gt;
</span></span><span style=display:flex><span>  &lt;<span style=color:#7ee787>UserProfile</span> /&gt;
</span></span><span style=display:flex><span>&lt;/<span style=color:#7ee787>Profiler</span>&gt;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// ========== 自定义调试工具 ==========
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// utils/debug.ts
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span><span style=color:#ff7b72>export</span> <span style=color:#ff7b72>const</span> debug <span style=color:#ff7b72;font-weight:700>=</span> {
</span></span><span style=display:flex><span>  log<span style=color:#ff7b72;font-weight:700>:</span> (...args: <span style=color:#ff7b72>any</span>[]) <span style=color:#ff7b72;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>if</span> (<span style=color:#ff7b72>import</span>.meta.env.DEV) {
</span></span><span style=display:flex><span>      console.log(<span style=color:#a5d6ff>&#39;[DEBUG]&#39;</span>, ...args)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  },
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  group<span style=color:#ff7b72;font-weight:700>:</span> (label: <span style=color:#ff7b72>string</span>, fn<span style=color:#ff7b72;font-weight:700>:</span> () <span style=color:#ff7b72;font-weight:700>=&gt;</span> <span style=color:#ff7b72>void</span>) <span style=color:#ff7b72;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>if</span> (<span style=color:#ff7b72>import</span>.meta.env.DEV) {
</span></span><span style=display:flex><span>      console.group(label)
</span></span><span style=display:flex><span>      fn()
</span></span><span style=display:flex><span>      console.groupEnd()
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  },
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  time<span style=color:#ff7b72;font-weight:700>:</span> (label: <span style=color:#ff7b72>string</span>) <span style=color:#ff7b72;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>if</span> (<span style=color:#ff7b72>import</span>.meta.env.DEV) {
</span></span><span style=display:flex><span>      console.time(label)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  },
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  timeEnd<span style=color:#ff7b72;font-weight:700>:</span> (label: <span style=color:#ff7b72>string</span>) <span style=color:#ff7b72;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>if</span> (<span style=color:#ff7b72>import</span>.meta.env.DEV) {
</span></span><span style=display:flex><span>      console.timeEnd(label)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  },
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  track<span style=color:#ff7b72;font-weight:700>:</span> (name: <span style=color:#ff7b72>string</span>, value: <span style=color:#ff7b72>any</span>) <span style=color:#ff7b72;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>if</span> (<span style=color:#ff7b72>import</span>.meta.env.DEV) {
</span></span><span style=display:flex><span>      console.log(<span style=color:#a5d6ff>`[TRACK] </span><span style=color:#a5d6ff>${</span>name<span style=color:#a5d6ff>}</span><span style=color:#a5d6ff>:`</span>, value)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// 使用示例
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>debug.time(<span style=color:#a5d6ff>&#39;dataFetch&#39;</span>)
</span></span><span style=display:flex><span>fetchData().then(data <span style=color:#ff7b72;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span>  debug.track(<span style=color:#a5d6ff>&#39;fetchedData&#39;</span>, data)
</span></span><span style=display:flex><span>  debug.timeEnd(<span style=color:#a5d6ff>&#39;dataFetch&#39;</span>)
</span></span><span style=display:flex><span>})
</span></span></code></pre></td></tr></table></div></div><h2 id=总结>总结<a hidden class=anchor aria-hidden=true href=#总结>#</a></h2><p>构建现代前端架构需要综合考虑多个维度：</p><ol><li><strong>架构设计</strong>：采用分层架构、领域驱动设计，确保代码可维护性</li><li><strong>微前端</strong>：合理拆分应用，实现团队独立开发部署</li><li><strong>状态管理</strong>：根据场景选择合适的状态管理方案</li><li><strong>性能优化</strong>：代码分割、渲染优化、资源优化、构建优化</li><li><strong>监控调试</strong>：建立完善的监控体系，持续优化</li></ol><p>前端架构是一个不断演进的过程，需要根据项目实际情况灵活调整。</p><blockquote><p><strong>相关工具推荐</strong></p><ul><li><a href=https://www.util.cn/tools/json-formatter/>JSON格式化工具</a> - JSON数据处理</li><li><a href=https://www.util.cn/tools/regex-tester/>正则表达式测试</a> - 正则测试与调试</li><li><a href=https://www.util.cn/tools/base64-encode/>Base64编码工具</a> - 编码转换</li></ul></blockquote></div><footer class=post-footer-modern><div class=post-tags-modern><span class=tags-label>🏷️ 标签</span><div class=tags-list><a href=/blog/tags/%E5%89%8D%E7%AB%AF%E6%9E%B6%E6%9E%84/ class=tag-pill>前端架构
</a><a href=/blog/tags/%E5%BE%AE%E5%89%8D%E7%AB%AF/ class=tag-pill>微前端
</a><a href=/blog/tags/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/ class=tag-pill>性能优化
</a><a href=/blog/tags/%E7%8A%B6%E6%80%81%E7%AE%A1%E7%90%86/ class=tag-pill>状态管理
</a><a href=/blog/tags/%E6%A8%A1%E5%9D%97%E8%81%94%E9%82%A6/ class=tag-pill>模块联邦</a></div></div><style>.post-footer-modern{margin-top:3rem;padding-top:2rem;border-top:1px solid var(--border,#333333)}.post-tags-modern{display:flex;align-items:center;gap:1rem;margin-bottom:2rem;flex-wrap:wrap}.tags-label{font-size:.875rem;font-weight:600;color:var(--secondary,#999999) !important;white-space:nowrap}.tags-list{display:flex;flex-wrap:wrap;gap:.5rem;flex:1}.tag-pill{display:inline-block;padding:.25rem .75rem;background:rgba(255,255,255,5%);border:1px solid var(--border,#333333);border-radius:0;color:var(--secondary,#cccccc) !important;text-decoration:none;font-size:.8rem;font-weight:500;transition:all .2s ease}.tag-pill:hover{background:var(--primary,#ffffff);color:var(--background,#000000) !important;border-color:var(--primary,#ffffff);transform:translateY(-1px)}.post-nav-modern{margin-top:2rem}.nav-grid{display:grid;grid-template-columns:1fr 1fr;gap:1rem}.nav-card{display:flex;align-items:center;gap:1rem;padding:1.25rem;background:rgba(255,255,255,2%);border:1px solid var(--border,#333333);border-radius:12px;text-decoration:none;transition:all .2s ease;min-height:80px}.nav-card:hover{background:rgba(255,255,255,5%);border-color:var(--primary,#ffffff);transform:translateY(-2px)}.nav-card.nav-prev{justify-content:flex-start}.nav-card.nav-next{justify-content:flex-end;text-align:right}.nav-card.nav-next .nav-content{text-align:right}.nav-empty{display:flex;align-items:center;justify-content:center;background:rgba(255,255,255,1%);border:1px dashed var(--border,#333333);color:var(--secondary,#666666)}.nav-arrow{font-size:1.5rem;color:var(--primary,#ffffff);font-weight:300}.nav-content{flex:1}.nav-title{font-size:.95rem;font-weight:600;color:var(--primary,#ffffff) !important;line-height:1.4;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden}[data-theme=light] .post-footer-modern{border-color:var(--border-light,#dee2e6)}[data-theme=light] .tags-label{color:var(--secondary-light,#6c757d) !important}[data-theme=light] .tag-pill{background:rgba(0,0,0,5%);border-color:var(--border-light,#dee2e6);color:var(--secondary-light,#495057) !important}[data-theme=light] .tag-pill:hover{background:var(--primary-light,#0066cc);color:var(--background-light,#ffffff) !important;border-color:var(--primary-light,#0066cc)}[data-theme=light] .nav-card{background:rgba(0,0,0,2%);border-color:var(--border-light,#dee2e6)}[data-theme=light] .nav-card:hover{background:rgba(0,102,204,5%);border-color:var(--primary-light,#0066cc)}[data-theme=light] .nav-empty{background:rgba(0,0,0,1%);border-color:var(--border-light,#dee2e6);color:var(--secondary-light,#6c757d)}[data-theme=light] .nav-arrow{color:var(--primary-light,#0066cc)}[data-theme=light] .nav-title{color:var(--primary-light,#212529) !important}@media(max-width:768px){.nav-grid{grid-template-columns:1fr;gap:.75rem}.nav-card{padding:1rem;min-height:70px}.nav-card.nav-next{text-align:left}.nav-card.nav-next .nav-content{text-align:left}.nav-title{font-size:.875rem}.post-tags-modern{flex-direction:column;gap:.75rem}}@media(max-width:480px){.nav-arrow{font-size:1.25rem}.nav-card{padding:.875rem}.nav-title{font-size:.8rem;-webkit-line-clamp:1}}</style><nav class=post-nav-modern><div class=nav-grid><a href=/blog/articles/webassembly%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E5%AE%9E%E8%B7%B5%E7%AA%81%E7%A0%B4web%E5%BA%94%E7%94%A8%E6%80%A7%E8%83%BD%E7%93%B6%E9%A2%88/ class="nav-card nav-prev"><div class=nav-arrow>←</div><div class=nav-content><div class=nav-title>WebAssembly性能优化实践：突破Web应用性能瓶颈</div></div></a><a href=/blog/articles/%E5%88%86%E5%B8%83%E5%BC%8F%E7%B3%BB%E7%BB%9F%E4%B8%80%E8%87%B4%E6%80%A7%E7%AE%97%E6%B3%95%E6%B7%B1%E5%BA%A6%E8%A7%A3%E6%9E%90%E4%BB%8Epaxos%E5%88%B0raft/ class="nav-card nav-next"><div class=nav-content><div class=nav-title>分布式系统一致性算法深度解析：从Paxos到Raft</div></div><div class=nav-arrow>→</div></a></div></nav></footer></main><aside class=post-sidebar><div class=sidebar-toc id=sidebar-toc><div class=toc-header><div class=toc-title>目录</div><button class=toc-toggle id=toc-toggle aria-label="Toggle TOC">
<svg class="toc-toggle-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 6 6 18M6 6l12 12"/></svg></button></div><div class=toc-content id=toc-content><ul class=toc-list><li class="toc-item toc-h2"><a href=#h2-0 class=toc-item-link><span class=toc-item-text>引言</span></a></li><li class="toc-item toc-h2"><a href=#h2-1 class=toc-item-link><span class=toc-item-text>一、前端架构演进史</span></a></li><li class="toc-item toc-h2"><a href=#h2-2 class=toc-item-link><span class=toc-item-text>二、架构设计原则</span></a></li><li class="toc-item toc-h2"><a href=#h2-3 class=toc-item-link><span class=toc-item-text>三、微前端架构</span></a></li><li class="toc-item toc-h2"><a href=#h2-4 class=toc-item-link><span class=toc-item-text>四、状态管理架构</span></a></li><li class="toc-item toc-h2"><a href=#h2-5 class=toc-item-link><span class=toc-item-text>五、性能优化架构</span></a></li><li class="toc-item toc-h2"><a href=#h2-6 class=toc-item-link><span class=toc-item-text>六、构建优化</span></a></li><li class="toc-item toc-h2"><a href=#h2-7 class=toc-item-link><span class=toc-item-text>七、监控与调试</span></a></li><li class="toc-item toc-h2"><a href=#h2-8 class=toc-item-link><span class=toc-item-text>总结</span></a></li></ul></div></div><script>document.addEventListener("DOMContentLoaded",function(){const e=document.getElementById("sidebar-toc"),t=document.getElementById("toc-toggle"),o=document.getElementById("toc-content"),i=t?.querySelector(".toc-toggle-icon");if(!e)return;let n=!1;t&&t.addEventListener("click",function(){n=!n,n?(o.style.display="none",e.style.width="auto",i.innerHTML='<path d="M9 18l6-6-6-6"/>'):(o.style.display="block",e.style.width="200px",i.innerHTML='<path d="M18 6L6 18M6 6l12 12"/>')});const s=document.querySelector(".post-content");if(s){const e=s.querySelectorAll("h1");e.forEach((e,t)=>{e.id=`h1-${t}`});const t=s.querySelectorAll("h2");t.forEach((e,t)=>{e.id=`h2-${t}`})}const a=document.querySelectorAll(".toc-item-link");a.forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();const n=this.getAttribute("href").substring(1),t=document.getElementById(n);if(t){const e=document.querySelector(".post-header-main")?.offsetHeight||0,n=t.offsetTop-e-20;window.scrollTo({top:n,behavior:"smooth"})}})})})</script><style>.sidebar-toc{position:sticky;top:2rem;width:200px;background:#fff;border:1px solid #e5e7eb;border-radius:4px;overflow:hidden;box-shadow:0 1px 3px rgba(0,0,0,.1);z-index:100}.sidebar-toc.hidden{display:none}.toc-header{padding:12px 16px;border-bottom:1px solid #e5e7eb;background:#fafbfc;display:flex;align-items:center;justify-content:space-between}.toc-title{margin:0;font-size:13px;font-weight:500;color:#374151 !important;font-family:-apple-system,BlinkMacSystemFont,segoe ui,Roboto,sans-serif;text-transform:uppercase;letter-spacing:1px}.toc-toggle{background:0 0;border:none;cursor:pointer;padding:4px;border-radius:4px;display:flex;align-items:center;justify-content:center;transition:all .2s ease;color:#6b7280}.toc-toggle:hover{background:#e5e7eb;color:#374151}.toc-toggle-icon{transition:transform .2s ease}.toc-content{padding:12px 0}.toc-list{list-style:none;margin:0;padding:0}.toc-item{margin-bottom:4px;display:block !important;visibility:visible !important}.toc-h1,.toc-h2{display:block !important}.toc-h2{margin-left:0}.toc-item-link{display:flex;align-items:center;gap:8px;padding:8px 12px;color:#374151 !important;text-decoration:none;font-size:13px;line-height:1.4;border-radius:3px;transition:all .2s ease;font-weight:400}.toc-item-link:hover{background:#f8fafc;color:#1f2937 !important}.toc-item-link.active{background:#e0f2fe;color:#01579b !important;font-weight:500}.toc-dot{width:8px;height:8px;border-radius:50%;flex-shrink:0}.dot-red{background:#ef4444}.dot-blue{background:#2196f3}.toc-item-text{color:#1f2937 !important;font-weight:400;flex:1;display:inline !important;visibility:visible !important;opacity:1 !important;font-size:13px !important;line-height:1.4 !important}.toc-item-link .toc-item-text{color:#1f2937 !important;display:inline !important;visibility:visible !important;opacity:1 !important}.toc-item.active .dot-red{background:#d32f2f}.toc-item.active .dot-blue{background:#1976d2}[data-theme=dark] .sidebar-toc{background:#1f2937;border-color:#374151;box-shadow:0 1px 3px rgba(0,0,0,.3)}[data-theme=dark] .toc-header{background:#111827;border-color:#374151}[data-theme=dark] .toc-title{color:#f3f4f6 !important}[data-theme=dark] .toc-toggle{color:#9ca3af}[data-theme=dark] .toc-toggle:hover{background:#374151;color:#f3f4f6}[data-theme=dark] .toc-item-link{color:#e5e7eb !important}[data-theme=dark] .toc-item-link:hover{background:#374151;color:#f9fafb !important}[data-theme=dark] .toc-item-link.active{background:#0d47a1;color:#fff !important}[data-theme=dark] .toc-item-text{color:#f9fafb !important;display:inline !important;visibility:visible !important;opacity:1 !important}[data-theme=dark] .toc-item-link .toc-item-text{color:#f9fafb !important;display:inline !important;visibility:visible !important;opacity:1 !important}@media(max-width:1024px){.sidebar-toc{display:none}.post-content-wrapper{grid-template-columns:1fr !important;padding:0 1rem !important}}</style><style>.post-content-wrapper{display:grid;grid-template-columns:1fr 200px;gap:2rem;padding:0 2rem;max-width:100%}.post-content-main{min-width:0}.post-sidebar{position:sticky;top:2rem;height:fit-content;min-width:0}.post-header-main{margin-bottom:2rem;padding-bottom:1rem;border-bottom:1px solid var(--border,#333333)}.post-header-main .post-title{color:var(--primary,#ffffff) !important;font-size:2.5rem;font-weight:700;line-height:1.2;margin-bottom:1rem}.post-header-main .post-description{color:var(--secondary,#cccccc) !important;font-size:1.1rem;line-height:1.6;margin-bottom:1rem}.post-header-main .post-meta{margin-bottom:0}@media(max-width:1024px){.post-content-wrapper{grid-template-columns:1fr !important;gap:1rem;padding:0 1rem !important}.post-sidebar{display:none}}@media(max-width:768px){.post-header-main .post-title{font-size:2rem}.post-header-main .post-description{font-size:1rem}}</style></aside></div></article></main><footer class=footer><span>© 2024-2025 有条工具技术博客</span> ·</footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");if(menu){const e=localStorage.getItem("menu-scroll-position");e&&(menu.scrollLeft=parseInt(e,10)),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}}document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{const e=document.querySelector("html");e.dataset.theme==="dark"?(e.dataset.theme="light",localStorage.setItem("pref-theme","light")):(e.dataset.theme="dark",localStorage.setItem("pref-theme","dark"))})</script></body></html>