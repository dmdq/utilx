<!DOCTYPE html>
<html lang="zh-cn" dir="auto" data-theme="auto">

<head><script src="///blog/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=//blog/livereload" data-no-instant defer></script><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>JavaScriptå¼‚æ­¥ç¼–ç¨‹æœ€ä½³å®è·µï¼šä»å›è°ƒåˆ°Async/Awaitçš„å®Œæ•´æŒ‡å— | æŠ€æœ¯åšå®¢ - æœ‰æ¡å·¥å…·</title>
<meta name="keywords" content="JavaScriptå¼‚æ­¥ç¼–ç¨‹, Promiseæœ€ä½³å®è·µ, Async/AwaitæŒ‡å—, JavaScriptå¹¶å‘æ§åˆ¶, å¼‚æ­¥é”™è¯¯å¤„ç†">
<meta name="description" content="JavaScriptå¼‚æ­¥ç¼–ç¨‹æœ€ä½³å®è·µå®Œæ•´æŒ‡å—ï¼ŒåŒ…å«å›è°ƒå‡½æ•°ã€Promiseé“¾ã€Async/Awaitæ¨¡å¼ã€é”™è¯¯å¤„ç†ã€å¹¶å‘æ§åˆ¶ç­‰å¼‚æ­¥ç¼–ç¨‹æ ¸å¿ƒæ¦‚å¿µå’Œå®æˆ˜æŠ€å·§">
<meta name="author" content="æœ‰æ¡å·¥å…·å›¢é˜Ÿ">
<link rel="canonical" href="//localhost:1313///blog/articles/javascript-async-programming-best-practices/">
<link crossorigin="anonymous" href="///blog/assets/css/stylesheet.7e8505b7cdf8bb22ab2305e53c2700bb06c7e64faeb72cd3468823a9a3bd3d6e.css" integrity="sha256-foUFt834uyKrIwXlPCcAuwbH5k&#43;utyzTRogjqaO9PW4=" rel="preload stylesheet" as="style">
<link rel="icon" href="//localhost:1313/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="//localhost:1313/blog/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="//localhost:1313/blog/favicon-32x32.png">
<link rel="apple-touch-icon" href="//localhost:1313/blog/apple-touch-icon.png">
<link rel="mask-icon" href="//localhost:1313/blog/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" type="application/rss+xml" href="//localhost:1313///blog/articles/javascript-async-programming-best-practices/feed.xml" title="rss">
<link rel="alternate" hreflang="zh-cn" href="//localhost:1313///blog/articles/javascript-async-programming-best-practices/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-block-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
                color-scheme: dark;
            }

            .list {
                background: var(--theme);
            }

            .toc {
                background: var(--entry);
            }
        }

        @media (prefers-color-scheme: light) {
            .list::-webkit-scrollbar-thumb {
                border-color: var(--code-bg);
            }
        }

    </style>
</noscript>
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.querySelector("html").dataset.theme = 'dark';
    } else if (localStorage.getItem("pref-theme") === "light") {
       document.querySelector("html").dataset.theme = 'light';
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.querySelector("html").dataset.theme = 'dark';
    } else {
        document.querySelector("html").dataset.theme = 'light';
    }

</script><link rel="stylesheet" href="/blog/css/custom.css" media="screen">


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "WebSite",
  "name": "æŠ€æœ¯åšå®¢ - æœ‰æ¡å·¥å…· | å¼€å‘è€…å·¥å…·ä½¿ç”¨æ•™ç¨‹ & ç¼–ç¨‹æŠ€å·§åˆ†äº«",
  "url": "https://www.util.cn/blog/",
  "description": "æœ‰æ¡å·¥å…·æŠ€æœ¯åšå®¢ - åˆ†äº«å¼€å‘è€…å·¥å…·ä½¿ç”¨æ•™ç¨‹ã€ç¼–ç¨‹æŠ€å·§å’Œå®æˆ˜å¼€å‘ç»éªŒã€‚æä¾›JSONæ ¼å¼åŒ–ã€SQLä¼˜åŒ–ã€Markdownç¼–è¾‘å™¨ç­‰åœ¨çº¿å·¥å…·çš„è¯¦ç»†ä½¿ç”¨æŒ‡å—ï¼Œå¸®åŠ©å¼€å‘è€…æå‡å·¥ä½œæ•ˆç‡ã€‚",
  "publisher": {
    "@type": "Organization",
    "name": "æœ‰æ¡å·¥å…·",
    "url": "https://www.util.cn",
    "logo": {
      "@type": "ImageObject",
      "url": "https://www.util.cn/blog/logo/logo-256.png",
      "width": 256,
      "height": 256
    }
  },
  "potentialAction": [
    {
      "@type": "SearchAction",
      "target": "https://www.util.cn/blog/search?q={search_term_string}",
      "query-input": "required name=search_term_string"
    }
  ]
}
</script>


<meta property="og:type" content="website">
<meta property="og:title" content="æŠ€æœ¯åšå®¢ - æœ‰æ¡å·¥å…· | å¼€å‘è€…å·¥å…·ä½¿ç”¨æ•™ç¨‹ & ç¼–ç¨‹æŠ€å·§åˆ†äº«">
<meta property="og:description" content="æœ‰æ¡å·¥å…·æŠ€æœ¯åšå®¢ - åˆ†äº«å¼€å‘è€…å·¥å…·ä½¿ç”¨æ•™ç¨‹ã€ç¼–ç¨‹æŠ€å·§å’Œå®æˆ˜å¼€å‘ç»éªŒã€‚æä¾›JSONæ ¼å¼åŒ–ã€SQLä¼˜åŒ–ã€Markdownç¼–è¾‘å™¨ç­‰åœ¨çº¿å·¥å…·çš„è¯¦ç»†ä½¿ç”¨æŒ‡å—ï¼Œå¸®åŠ©å¼€å‘è€…æå‡å·¥ä½œæ•ˆç‡ã€‚">
<meta property="og:url" content="https://www.util.cn/blog/">
<meta property="og:site_name" content="æœ‰æ¡å·¥å…·æŠ€æœ¯åšå®¢">
<meta property="og:image" content="https://www.util.cn/blog/logo/logo-256.png">
<meta property="og:image:width" content="1200">
<meta property="og:image:height" content="630">

<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:title" content="æŠ€æœ¯åšå®¢ - æœ‰æ¡å·¥å…· | å¼€å‘è€…å·¥å…·ä½¿ç”¨æ•™ç¨‹ & ç¼–ç¨‹æŠ€å·§åˆ†äº«">
<meta name="twitter:description" content="æœ‰æ¡å·¥å…·æŠ€æœ¯åšå®¢ - åˆ†äº«å¼€å‘è€…å·¥å…·ä½¿ç”¨æ•™ç¨‹ã€ç¼–ç¨‹æŠ€å·§å’Œå®æˆ˜å¼€å‘ç»éªŒã€‚">
<meta name="twitter:image" content="https://www.util.cn/blog/logo/logo-256.png">


<meta name="baidu-site-verification" content="">


<meta name="category" content="æŠ€æœ¯åšå®¢,å¼€å‘è€…å·¥å…·,ç¼–ç¨‹æ•™ç¨‹">
<meta name="coverage" content="Worldwide">
<meta name="distribution" content="Global">
<meta name="rating" content="General">


<script charset="UTF-8" id="51la_code" async crossorigin="anonymous" src="https://sdk.51.la/js-sdk-pro.min.js?id=3OM52V0xJAPv6ozF&hash=pro"></script>


<script>

window.addEventListener('load', function() {
    
    setTimeout(function() {
        if (typeof la != 'undefined') {
            console.log('51laç»Ÿè®¡å·²åŠ è½½');
        } else {
            console.warn('51laç»Ÿè®¡åŠ è½½å¤±è´¥ï¼Œä½¿ç”¨å¤‡ç”¨æ–¹æ¡ˆ');
            
            (function() {
                var script = document.createElement('script');
                script.src = 'https://sdk.51.la/js-sdk-pro.min.js?id=3OM52V0xJAPv6ozF&hash=backup';
                script.async = true;
                document.head.appendChild(script);
            })();
        }
    }, 3000);
});
</script><meta property="og:url" content="//localhost:1313///blog/articles/javascript-async-programming-best-practices/">
  <meta property="og:site_name" content="æŠ€æœ¯åšå®¢ - æœ‰æ¡å·¥å…·">
  <meta property="og:title" content="JavaScriptå¼‚æ­¥ç¼–ç¨‹æœ€ä½³å®è·µï¼šä»å›è°ƒåˆ°Async/Awaitçš„å®Œæ•´æŒ‡å—">
  <meta property="og:description" content="JavaScriptå¼‚æ­¥ç¼–ç¨‹æœ€ä½³å®è·µå®Œæ•´æŒ‡å—ï¼ŒåŒ…å«å›è°ƒå‡½æ•°ã€Promiseé“¾ã€Async/Awaitæ¨¡å¼ã€é”™è¯¯å¤„ç†ã€å¹¶å‘æ§åˆ¶ç­‰å¼‚æ­¥ç¼–ç¨‹æ ¸å¿ƒæ¦‚å¿µå’Œå®æˆ˜æŠ€å·§">
  <meta property="og:locale" content="zh-cn">
  <meta property="og:type" content="article">
    <meta property="article:section" content="articles">
    <meta property="article:published_time" content="2025-12-18T19:00:00+08:00">
    <meta property="article:modified_time" content="2025-12-18T19:00:00+08:00">
    <meta property="article:tag" content="JavaScript">
    <meta property="article:tag" content="å¼‚æ­¥ç¼–ç¨‹">
    <meta property="article:tag" content="Promise">
    <meta property="article:tag" content="Async/Await">
    <meta property="article:tag" content="å‰ç«¯å¼€å‘">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="JavaScriptå¼‚æ­¥ç¼–ç¨‹æœ€ä½³å®è·µï¼šä»å›è°ƒåˆ°Async/Awaitçš„å®Œæ•´æŒ‡å—">
<meta name="twitter:description" content="JavaScriptå¼‚æ­¥ç¼–ç¨‹æœ€ä½³å®è·µå®Œæ•´æŒ‡å—ï¼ŒåŒ…å«å›è°ƒå‡½æ•°ã€Promiseé“¾ã€Async/Awaitæ¨¡å¼ã€é”™è¯¯å¤„ç†ã€å¹¶å‘æ§åˆ¶ç­‰å¼‚æ­¥ç¼–ç¨‹æ ¸å¿ƒæ¦‚å¿µå’Œå®æˆ˜æŠ€å·§">


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "æŠ€æœ¯æ–‡ç« ",
      "item": "//localhost:1313///blog/articles/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "JavaScriptå¼‚æ­¥ç¼–ç¨‹æœ€ä½³å®è·µï¼šä»å›è°ƒåˆ°Async/Awaitçš„å®Œæ•´æŒ‡å—",
      "item": "//localhost:1313///blog/articles/javascript-async-programming-best-practices/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "JavaScriptå¼‚æ­¥ç¼–ç¨‹æœ€ä½³å®è·µï¼šä»å›è°ƒåˆ°Async/Awaitçš„å®Œæ•´æŒ‡å—",
  "name": "JavaScriptå¼‚æ­¥ç¼–ç¨‹æœ€ä½³å®è·µï¼šä»å›è°ƒåˆ°Async\/Awaitçš„å®Œæ•´æŒ‡å—",
  "description": "JavaScriptå¼‚æ­¥ç¼–ç¨‹æœ€ä½³å®è·µå®Œæ•´æŒ‡å—ï¼ŒåŒ…å«å›è°ƒå‡½æ•°ã€Promiseé“¾ã€Async/Awaitæ¨¡å¼ã€é”™è¯¯å¤„ç†ã€å¹¶å‘æ§åˆ¶ç­‰å¼‚æ­¥ç¼–ç¨‹æ ¸å¿ƒæ¦‚å¿µå’Œå®æˆ˜æŠ€å·§",
  "keywords": [
    "JavaScriptå¼‚æ­¥ç¼–ç¨‹", "Promiseæœ€ä½³å®è·µ", "Async/AwaitæŒ‡å—", "JavaScriptå¹¶å‘æ§åˆ¶", "å¼‚æ­¥é”™è¯¯å¤„ç†"
  ],
  "articleBody": "JavaScriptçš„å¼‚æ­¥ç¼–ç¨‹æ˜¯ç°ä»£Webå¼€å‘çš„æ ¸å¿ƒæ¦‚å¿µä¹‹ä¸€ã€‚ä»æœ€åˆçš„å›è°ƒå‡½æ•°åˆ°ç°åœ¨çš„Async/Awaitï¼ŒJavaScriptå¼‚æ­¥ç¼–ç¨‹ç»å†äº†å·¨å¤§çš„æ¼”è¿›ã€‚æœ¬æ–‡å°†æ·±å…¥æ¢è®¨å¼‚æ­¥ç¼–ç¨‹çš„æœ€ä½³å®è·µï¼Œå¸®åŠ©ä½ å†™å‡ºæ›´æ¸…æ™°ã€æ›´å¯ç»´æŠ¤çš„å¼‚æ­¥ä»£ç ã€‚\nå¼‚æ­¥ç¼–ç¨‹æ¼”è¿›å² 1. å›è°ƒå‡½æ•°æ—¶ä»£ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 // ä¼ ç»Ÿçš„å›è°ƒå‡½æ•° function fetchData(callback) { setTimeout(() =\u003e { callback('Data loaded') }, 1000) } function processData(callback) { fetchData((data) =\u003e { const result = data.toUpperCase() callback(result) }) } // å›è°ƒåœ°ç‹± function getData(callback) { fetchData((data1) =\u003e { processData((data2) =\u003e { anotherProcess((data3) =\u003e { finalProcess((data4) =\u003e { callback(data4) }) }) }) }) } 2. Promiseæ—¶ä»£ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 // PromiseåŸºç¡€ç”¨æ³• function fetchData() { return new Promise((resolve, reject) =\u003e { setTimeout(() =\u003e { resolve('Data loaded') }, 1000) }) } // Promiseé“¾ fetchData() .then(data =\u003e { console.log(data) return processData(data) }) .then(result =\u003e { console.log(result) return anotherProcess(result) }) .catch(error =\u003e { console.error('Error:', error) }) 3. Async/Awaitæ—¶ä»£ 1 2 3 4 5 6 7 8 9 10 11 12 // Async/AwaitåŸºç¡€ç”¨æ³• async function getData() { try { const data = await fetchData() const result = await processData(data) const finalResult = await anotherProcess(result) return finalResult } catch (error) { console.error('Error:', error) throw error } } Promiseæ·±åº¦è§£æ 1. Promiseçš„ä¸‰ç§çŠ¶æ€ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 // Pendingï¼ˆè¿›è¡Œä¸­ï¼‰ const promise = new Promise((resolve, reject) =\u003e { // å¼‚æ­¥æ“ä½œè¿›è¡Œä¸­ setTimeout(() =\u003e { resolve('Success') // Fulfilledï¼ˆå·²å®Œæˆï¼‰ }, 1000) }) console.log(promise) // Promise { } // çŠ¶æ€å˜åŒ–å›¾è§£ // Pending â†’ Fulfilled // Pending â†’ Rejected // çŠ¶æ€ä¸€æ—¦ç¡®å®šå°±ä¸å¯é€†è½¬ 2. Promiseæ„é€ å‡½æ•°çš„æ­£ç¡®ä½¿ç”¨ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 // âŒ é”™è¯¯ç”¨æ³•ï¼šåœ¨æ„é€ å‡½æ•°ä¸­åŒæ­¥è°ƒç”¨resolve function badPromise() { const promise = new Promise((resolve) =\u003e { resolve('Already resolved') // è¿™é‡Œçš„ä»£ç æ°¸è¿œä¸ä¼šæ‰§è¡Œ console.log('This will never run') }) return promise } // âœ… æ­£ç¡®ç”¨æ³•ï¼šå¼‚æ­¥è°ƒç”¨resolve function goodPromise() { return new Promise((resolve, reject) =\u003e { setTimeout(() =\u003e { resolve('Resolved asynchronously') console.log('This will run') }, 1000) }) } 3. Promiseçš„é”™è¯¯å¤„ç† 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 // Promiseé”™è¯¯å¤„ç†çš„å‡ ç§æ–¹å¼ // 1. ä½¿ç”¨catch() fetch('/api/data') .then(response =\u003e response.json()) .then(data =\u003e console.log(data)) .catch(error =\u003e console.error(error)) // 2. ä½¿ç”¨ç¬¬äºŒä¸ªå‚æ•° fetch('/api/data') .then( response =\u003e response.json(), error =\u003e console.error(error) ) // 3. ä½¿ç”¨try-catchåŒ…è£… function async fetchWithErrorHandling() { try { const response = await fetch('/api/data') const data = await response.json() console.log(data) } catch (error) { console.error(error) } } 4. Promiseç»„åˆæ–¹æ³• 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 // Promise.all - æ‰€æœ‰Promiseéƒ½å®Œæˆ function fetchMultipleData() { const promise1 = fetch('/api/users') const promise2 = fetch('/api/posts') const promise3 = fetch('/api/comments') return Promise.all([promise1, promise2, promise3]) .then(([users, posts, comments]) =\u003e { console.log('All data loaded') return { users, posts, comments } }) .catch(error =\u003e { console.error('One of the requests failed:', error) throw error }) } // Promise.allSettled - æ‰€æœ‰Promiseéƒ½å®Œæˆï¼ˆä¸è®ºæˆåŠŸå¤±è´¥ï¼‰ function fetchAllSettled() { const urls = ['/api/users', '/api/posts', '/api/comments'] const promises = urls.map(url =\u003e fetch(url).then(response =\u003e response.json()) ) return Promise.allSettled(promises) .then(results =\u003e { const successful = results.filter(result =\u003e result.status === 'fulfilled') const failed = results.filter(result =\u003e result.status === 'rejected') console.log('Successful requests:', successful.length) console.log('Failed requests:', failed.length) return { successful: successful.map(r =\u003e r.value), failed: failed.map(f =\u003e f.reason) } }) } // Promise.race - æœ€å¿«å®Œæˆçš„Promise function fetchWithRace() { const timeoutPromise = new Promise((_, reject) =\u003e { setTimeout(() =\u003e reject(new Error('Request timeout')), 5000) }) const fetchPromise = fetch('/api/data') .then(response =\u003e response.json()) return Promise.race([fetchPromise, timeoutPromise]) .catch(error =\u003e { if (error.message === 'Request timeout') { console.log('è¯·æ±‚è¶…æ—¶') } throw error }) } Async/Awaitæœ€ä½³å®è·µ 1. é”™è¯¯å¤„ç†ç­–ç•¥ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 // 1. ç»Ÿä¸€çš„é”™è¯¯å¤„ç†ä¸­é—´ä»¶ class ApiClient { async request(url, options = {}) { try { const response = await fetch(url, { headers: { 'Content-Type': 'application/json', ...options.headers, }, ...options, }) if (!response.ok) { throw new Error(`HTTP Error: ${response.status} ${response.statusText}`) } return await response.json() } catch (error) { if (error instanceof TypeError) { throw new Error('Network error: ' + error.message) } throw error } } } // 2. è‡ªå®šä¹‰é”™è¯¯ç±» class NetworkError extends Error { constructor(message, response) { super(message) this.name = 'NetworkError' this.response = response } } class ValidationError extends Error { constructor(message, field) { super(message) this.name = 'ValidationError' this.field = field } } // ä½¿ç”¨ç¤ºä¾‹ const apiClient = new ApiClient() async function getUserData(userId) { try { const userData = await apiClient.request(`/api/users/${userId}`) if (!userData.email) { throw new ValidationError('Email is required', 'email') } return userData } catch (error) { if (error instanceof ValidationError) { console.error(`Validation error in ${error.field}: ${error.message}`) } else if (error instanceof NetworkError) { console.error('Network error:', error.message) } else { console.error('Unexpected error:', error.message) } throw error } } 2. å¹¶å‘æ§åˆ¶ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 // å¹¶å‘é™åˆ¶å™¨ class ConcurrencyLimiter { constructor(maxConcurrent) { this.maxConcurrent = maxConcurrent this.currentCount = 0 this.queue = [] } async execute(task) { return new Promise((resolve, reject) =\u003e { this.queue.push({ task, resolve, reject }) this.processQueue() }) } async processQueue() { if (this.currentCount \u003e= this.maxConcurrent || this.queue.length === 0) { return } this.currentCount++ const { task, resolve, reject } = this.queue.shift() try { const result = await task() resolve(result) } catch (error) { reject(error) } finally { this.currentCount-- this.processQueue() } } } // ä½¿ç”¨ç¤ºä¾‹ const limiter = new ConcurrencyLimiter(3) async function processBatch(items) { const tasks = items.map(item =\u003e limiter.execute(() =\u003e processItem(item)) ) return Promise.all(tasks) } async function processItem(item) { console.log(`Processing item: ${item}`) await new Promise(resolve =\u003e setTimeout(resolve, 1000)) return `Processed: ${item}` } 3. é‡è¯•æœºåˆ¶ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 // æŒ‡æ•°é€€é¿é‡è¯• async function retryWithBackoff(fn, maxRetries = 3, baseDelay = 1000) { let lastError for (let attempt = 0; attempt \u003c= maxRetries; attempt++) { try { const result = await fn() return result } catch (error) { lastError = error if (attempt === maxRetries) { throw error } const delay = baseDelay * Math.pow(2, attempt) console.log(`Attempt ${attempt + 1} failed, retrying in ${delay}ms`) await new Promise(resolve =\u003e setTimeout(resolve, delay)) } } throw lastError } // çº¿æ€§é€€é¿é‡è¯• async function retryLinear(fn, maxRetries = 3, delay = 1000) { let lastError for (let attempt = 0; attempt \u003c= maxRetries; attempt++) { try { const result = await fn() return result } catch (error) { lastError = error if (attempt === maxRetries) { throw error } const waitTime = delay * (attempt + 1) console.log(`Attempt ${attempt + 1} failed, retrying in ${waitTime}ms`) await new Promise(resolve =\u003e setTimeout(resolve, waitTime)) } } throw lastError } // ä½¿ç”¨ç¤ºä¾‹ async function fetchWithRetry(url) { return retryWithBackoff(async () =\u003e { const response = await fetch(url) if (!response.ok) { throw new Error(`HTTP ${response.status}`) } return response.json() }, 5) } 4. è¶…æ—¶æ§åˆ¶ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 // å¸¦è¶…æ—¶çš„fetch async function fetchWithTimeout(url, timeout = 5000) { const controller = new AbortController() const timeoutId = setTimeout(() =\u003e controller.abort(), timeout) try { const response = await fetch(url, { signal: controller.signal, }) if (!response.ok) { throw new Error(`HTTP Error: ${response.status}`) } return response.json() } finally { clearTimeout(timeoutId) } } // Promise.raceå®ç°çš„è¶…æ—¶ async function fetchWithTimeoutRace(url, timeout = 5000) { const fetchPromise = fetch(url).then(response =\u003e { if (!response.ok) { throw new Error(`HTTP Error: ${response.status}`) }) return response.json() }) const timeoutPromise = new Promise((_, reject) =\u003e { setTimeout(() =\u003e reject(new Error('Request timeout')), timeout) }) return Promise.race([fetchPromise, timeoutPromise]) } // ä½¿ç”¨ç¤ºä¾‹ try { const data = await fetchWithTimeout('/api/data', 3000) console.log(data) } catch (error) { if (error.name === 'AbortError') { console.log('Request was aborted due to timeout') } else { console.error('Error:', error.message) } } é«˜çº§å¼‚æ­¥æ¨¡å¼ 1. å¹¶è¡Œå¤„ç† 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 // å¹¶è¡Œå¤„ç†æ•°ç»„ä¸­çš„å¼‚æ­¥æ“ä½œ async function processItemsInParallel(items, processor) { const promises = items.map(item =\u003e processor(item)) const results = await Promise.all(promises) return results } // åˆ†æ‰¹å¹¶è¡Œå¤„ç† async function processItemsInBatches(items, processor, batchSize = 5) { const results = [] for (let i = 0; i \u003c items.length; i += batchSize) { const batch = items.slice(i, i + batchSize) const batchResults = await Promise.all( batch.map(item =\u003e processor(item)) ) results.push(...batchResults) } return results } // ä½¿ç”¨ç¤ºä¾‹ async function fetchUsersInParallel(userIds) { const fetchUser = async (id) =\u003e { const response = await fetch(`/api/users/${id}`) return response.json() } const users = await processItemsInParallel(userIds, fetchUser) return users } 2. ç€¡é“æ¨¡å¼ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 // å¼‚æ­¥ç®¡é“ class AsyncPipeline { constructor() { this.steps = [] } step(fn) { this.steps.push(fn) return this } async execute(data) { let result = data for (const step of this.steps) { result = await step(result) } return result } } // ä½¿ç”¨ç¤ºä¾‹ const pipeline = new AsyncPipeline() pipeline .step(async (data) =\u003e { console.log('Step 1: Data validation') if (!data.id) { throw new Error('ID is required') } return { ...data, validated: true } }) .step(async (data) =\u003e { console.log('Step 2: Data transformation') return { ...data, transformed: true } }) .step(async (data) =\u003e { console.log('Step 3: Data saving') await saveData(data) return { ...data, saved: true } }) const result = await pipeline.execute({ id: 1, name: 'Test' }) 3. å‘å¸ƒè®¢é˜…æ¨¡å¼ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 // å¼‚æ­¥äº‹ä»¶å‘å°„å™¨ class AsyncEventEmitter { constructor() { this.listeners = new Map() } on(event, listener) { if (!this.listeners.has(event)) { this.listeners.set(event, []) } this.listeners.get(event).push(listener) return this } off(event, listener) { if (this.listeners.has(event)) { const listeners = this.listeners.get(event) const index = listeners.indexOf(listener) if (index !== -1) { listeners.splice(index, 1) } } return this } async emit(event, ...args) { if (!this.listeners.has(event)) { return } const listeners = this.listeners.get(event) const promises = listeners.map(listener =\u003e Promise.resolve(listener(...args)) ) await Promise.all(promises) } async emitSeries(event, ...args) { if (!this.listeners.has(event)) { return } const listeners = this.listeners.get(event) for (const listener of listeners) { await Promise.resolve(listener(...args)) } } } // ä½¿ç”¨ç¤ºä¾‹ const emitter = new AsyncEventEmitter() emitter.on('data', async (data) =\u003e { console.log('Listener 1 received data:', data) await processData(data) }) emitter.on('data', async (data) =\u003e { console.log('Listener 2 received data:', data) await saveData(data) }) await emitter.emit('data', { id: 1, name: 'Test' }) å¼‚æ­¥æ¨¡å¼åœ¨Reactä¸­çš„åº”ç”¨ 1. æ•°æ®è·å–Hook 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 import { useState, useEffect, useCallback } from 'react' // è‡ªå®šä¹‰æ•°æ®è·å–Hook function useApi(url, options = {}) { const [data, setData] = useState(null) const [loading, setLoading] = useState(true) const [error, setError] = useState(null) const fetchData = useCallback(async () =\u003e { try { setLoading(true) setError(null) const response = await fetch(url, options) if (!response.ok) { throw new Error(`HTTP error! status: ${response.status}`) } const result = await response.json() setData(result) } catch (err) { setError(err.message) } finally { setLoading(false) } }, [url, options]) useEffect(() =\u003e { fetchData() }, [fetchData]) return { data, loading, error, refetch: fetchData } } // ä½¿ç”¨ç¤ºä¾‹ function UserProfile({ userId }) { const { data: user, loading, error, refetch } = useApi(`/api/users/${userId}`) if (loading) return \u003cdiv\u003eLoading...\u003c/div\u003e if (error) return \u003cdiv\u003eError: {error}\u003c/div\u003e if (!user) return \u003cdiv\u003eNo user found\u003c/div\u003e return ( \u003cdiv\u003e \u003ch1\u003e{user.name}\u003c/h1\u003e \u003cp\u003e{user.email}\u003c/p\u003e \u003cbutton onClick={refetch}\u003eRefresh\u003c/button\u003e \u003c/div\u003e ) } 2. è¡¨å•æäº¤å¤„ç† 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 import { useState } from 'react' function useAsyncForm(initialValues, submitHandler) { const [values, setValues] = useState(initialValues) const [errors, setErrors] = useState({}) const [isSubmitting, setIsSubmitting] = useState(false) const handleChange = useCallback((e) =\u003e { const { name, value, type, checked } = e.target const fieldValue = type === 'checkbox' ? checked : value setValues(prev =\u003e ({ ...prev, [name]: fieldValue })) if (errors[name]) { setErrors(prev =\u003e ({ ...prev, [name]: '' })) } }, [errors]) const handleSubmit = useCallback(async (e) =\u003e { e.preventDefault() setIsSubmitting(true) setErrors({}) try { await submitHandler(values) } catch (error) { if (error.validationErrors) { setErrors(error.validationErrors) } else { console.error('Submit error:', error) } } finally { setIsSubmitting(false) } }, [values, submitHandler]) const reset = useCallback(() =\u003e { setValues(initialValues) setErrors({}) setIsSubmitting(false) }, [initialValues]) return { values, errors, isSubmitting, handleChange, handleSubmit, reset } } // ä½¿ç”¨ç¤ºä¾‹ function UserForm() { const submitHandler = async (values) =\u003e { const response = await fetch('/api/users', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(values), }) if (!response.ok) { const error = await response.json() throw new Error(error.message || 'Submit failed') } return response.json() } const { values, errors, isSubmitting, handleChange, handleSubmit, reset } = useAsyncForm({ name: '', email: '' }, submitHandler) return ( \u003cform onSubmit={handleSubmit}\u003e \u003cdiv\u003e \u003clabel\u003eName:\u003c/label\u003e \u003cinput type=\"text\" name=\"name\" value={values.name} onChange={handleChange} /\u003e {errors.name \u0026\u0026 \u003cspan style={{ color: 'red' }}\u003e{errors.name}\u003c/span\u003e} \u003c/div\u003e \u003cdiv\u003e \u003clabel\u003eEmail:\u003c/label\u003e \u003cinput type=\"email\" name=\"email\" value={values.email} onChange={handleChange} /\u003e {errors.email \u0026\u0026 \u003cspan style={{ color: 'red' }}\u003e{errors.email}\u003c/span\u003e} \u003c/div\u003e \u003cbutton type=\"submit\" disabled={isSubmitting}\u003e {isSubmitting ? 'Submitting...' : 'Submit'} \u003c/button\u003e \u003cbutton type=\"button\" onClick={reset}\u003e Reset \u003c/button\u003e \u003c/form\u003e ) } æ€§èƒ½ä¼˜åŒ–æŠ€å·§ 1. è¯·æ±‚ç¼“å­˜ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 // ç®€å•çš„å†…å­˜ç¼“å­˜ class Cache { constructor(ttl = 5 * 60 * 1000) { // 5åˆ†é’ŸTTL this.cache = new Map() this.ttl = ttl } set(key, value) { this.cache.set(key, { value, timestamp: Date.now() }) } get(key) { const item = this.cache.get(key) if (!item) { return null } if (Date.now() - item.timestamp \u003e this.ttl) { this.cache.delete(key) return null } return item.value } clear() { this.cache.clear() } } // å¸¦ç¼“å­˜çš„APIå®¢æˆ·ç«¯ class CachedApiClient { constructor() { this.cache = new Cache() } async get(url, options = {}) { const cacheKey = `${url}:${JSON.stringify(options)}` const cachedData = this.cache.get(cacheKey) if (cachedData) { console.log('Returning cached data for:', url) return cachedData } console.log('Fetching fresh data for:', url) const response = await fetch(url, options) const data = await response.json() this.cache.set(cacheKey, data) return data } } // ä½¿ç”¨ç¤ºä¾‹ const apiClient = new CachedApiClient() // ç¬¬ä¸€æ¬¡è¯·æ±‚ - å‘é€ç½‘ç»œè¯·æ±‚ const data1 = await apiClient.get('/api/users') // ç¬¬äºŒæ¬¡è¯·æ±‚ - è¿”å›ç¼“å­˜æ•°æ® const data2 = await apiClient.get('/api/users') 2. è¯·æ±‚å»é‡ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 // é˜²æŠ–å’ŒèŠ‚æµ function debounce(func, delay) { let timeoutId return function(...args) { clearTimeout(timeoutId) timeoutId = setTimeout(() =\u003e func.apply(this, args), delay) } } function throttle(func, delay) { let lastCall = 0 return function(...args) { const now = Date.now() if (now - lastCall \u003e= delay) { lastCall = now return func.apply(this, args) } } } // è¯·æ±‚å»é‡å™¨ class RequestDeduplicator { constructor() { this.pendingRequests = new Map() } async deduplicate(key, requestFn) { if (this.pendingRequests.has(key)) { return this.pendingRequests.get(key) } const promise = requestFn() .finally(() =\u003e { this.pendingRequests.delete(key) }) this.pendingRequests.set(key, promise) return promise } } // ä½¿ç”¨ç¤ºä¾‹ const deduplicator = new RequestDeduplicator() async function fetchUserData(userId) { return deduplicator.deduplicate(`user:${userId}`, async () =\u003e { const response = await fetch(`/api/users/${userId}`) return response.json() }) } // é˜²æŠ–æœç´¢ const debouncedSearch = debounce(async (query) =\u003e { const response = await fetch(`/api/search?q=${query}`) return response.json() }, 300) // èŠ‚æµæ»šåŠ¨å¤„ç† const throttledHandleScroll = throttle((event) =\u003e { console.log('Scroll position:', event.target.scrollTop) }, 100) æµ‹è¯•å¼‚æ­¥ä»£ç  1. æµ‹è¯•Promise 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 // Jestæµ‹è¯•Promise const fetchData = () =\u003e { return new Promise(resolve =\u003e { setTimeout(() =\u003e resolve('data'), 100) }) } describe('fetchData', () =\u003e { test('should resolve with data', async () =\u003e { const result = await fetchData() expect(result).toBe('data') }) test('should handle rejection', async () =\u003e { const rejectFn = jest.fn() const errorPromise = new Promise((_, reject) =\u003e { rejectFn('error') }) expect(errorPromise).rejects.toMatch('error') expect(rejectFn).toHaveBeenCalled() }) }) 2. æµ‹è¯•Async/Await 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 // æµ‹è¯•å¼‚æ­¥å‡½æ•° async function processUser(userData) { const validatedData = await validateUser(userData) const savedData = await saveUser(validatedData) return savedData } const mockValidateUser = jest.fn() const mockSaveUser = jest.fn() jest.mock('./validation', () =\u003e ({ validateUser: mockValidateUser })) jest.mock('./database', () =\u003e ({ saveUser: mockSaveUser })) describe('processUser', () =\u003e { beforeEach(() =\u003e { jest.clearAllMocks() }) test('should process user successfully', async () =\u003e { const userData = { name: 'John', email: 'john@example.com' } mockValidateUser.mockResolvedValue(userData) mockSaveUser.mockResolvedValue({ id: 1, ...userData }) const result = await processUser(userData) expect(mockValidateUser).toHaveBeenCalledWith(userData) expect(mockSaveUser).toHaveBeenCalledWith(userData) expect(result).toEqual({ id: 1, ...userData }) }) test('should handle validation errors', async () =\u003e { const userData = { name: '', email: 'invalid-email' } mockValidateUser.mockRejectedValue(new Error('Invalid user data')) await expect(processUser(userData)).rejects.toThrow('Invalid user data') }) }) 3. æµ‹è¯•å¹¶å‘æ§åˆ¶ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 // æµ‹è¯•å¹¶å‘é™åˆ¶å™¨ describe('ConcurrencyLimiter', () =\u003e { let limiter let executionCount = 0 beforeEach(() =\u003e { limiter = new ConcurrencyLimiter(2) executionCount = 0 }) test('should limit concurrent execution', async () =\u003e { const task = jest.fn().mockImplementation(async () =\u003e { executionCount++ await new Promise(resolve =\u003e setTimeout(resolve, 100)) return executionCount }) const promises = [ limiter.execute(task), limiter.execute(task), limiter.execute(task), limiter.execute(task), limiter.execute(task) ] const results = await Promise.all(promises) expect(results).toEqual([1, 2, 3, 4, 5]) expect(task).toHaveBeenCalledTimes(5) }) }) æ€»ç»“ JavaScriptå¼‚æ­¥ç¼–ç¨‹å·²ç»ä»å›è°ƒåœ°ç‹±å‘å±•åˆ°äº†ä¼˜é›…çš„Async/Awaitæ—¶ä»£ã€‚é€šè¿‡æŒæ¡è¿™äº›æœ€ä½³å®è·µï¼Œä½ å¯ä»¥ï¼š\næ ¸å¿ƒè¦ç‚¹ ç†è§£Promiseæœºåˆ¶ï¼šæŒæ¡Promiseçš„ä¸‰ç§çŠ¶æ€å’Œç”Ÿå‘½å‘¨æœŸ åˆç†ä½¿ç”¨Async/Awaitï¼šç®€åŒ–å¼‚æ­¥ä»£ç ï¼Œæé«˜å¯è¯»æ€§ å®Œå–„çš„é”™è¯¯å¤„ç†ï¼šå®ç°å¥å£®çš„é”™è¯¯å¤„ç†æœºåˆ¶ å¹¶å‘æ§åˆ¶ï¼šåˆç†æ§åˆ¶å¹¶å‘æ•°é‡ï¼Œé¿å…èµ„æºè€—å°½ æ€§èƒ½ä¼˜åŒ–ï¼šä½¿ç”¨ç¼“å­˜ã€å»é‡ç­‰æŠ€æœ¯æå‡æ€§èƒ½ å®è·µå»ºè®® ä¼˜å…ˆä½¿ç”¨Async/Awaitè€Œä¸æ˜¯Promiseé“¾ ç»Ÿä¸€é”™è¯¯å¤„ç†ç­–ç•¥ å®ç°åˆç†çš„é‡è¯•å’Œè¶…æ—¶æœºåˆ¶ ä½¿ç”¨ç¼“å­˜å‡å°‘ä¸å¿…è¦çš„è¯·æ±‚ å……åˆ†æµ‹è¯•å¼‚æ­¥ä»£ç  JavaScriptå¼‚æ­¥ç¼–ç¨‹æ˜¯ä¸€ä¸ªä¸æ–­å‘å±•çš„é¢†åŸŸï¼Œä¿æŒå­¦ä¹ å’Œå®è·µæ˜¯æŒæ¡å…¶ç²¾é«“çš„å…³é”®ã€‚é€šè¿‡éµå¾ªè¿™äº›æœ€ä½³å®è·µï¼Œä½ å¯ä»¥ç¼–å†™å‡ºæ›´æ¸…æ™°ã€æ›´å¯é ã€æ›´é«˜æ•ˆçš„å¼‚æ­¥ä»£ç ã€‚\n",
  "wordCount" : "3279",
  "inLanguage": "zh-cn",
  "datePublished": "2025-12-18T19:00:00+08:00",
  "dateModified": "2025-12-18T19:00:00+08:00",
  "author":{
    "@type": "Person",
    "name": "æœ‰æ¡å·¥å…·å›¢é˜Ÿ"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "//localhost:1313///blog/articles/javascript-async-programming-best-practices/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "æŠ€æœ¯åšå®¢ - æœ‰æ¡å·¥å…·",
    "logo": {
      "@type": "ImageObject",
      "url": "//localhost:1313/favicon.ico"
    }
  }
}
</script>
</head>
<body id="top">
    <header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="//localhost:1313/blog/" accesskey="h" title="æŠ€æœ¯åšå®¢ - æœ‰æ¡å·¥å…· (Alt + H)">æŠ€æœ¯åšå®¢ - æœ‰æ¡å·¥å…·</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)" aria-label="Toggle theme">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="//localhost:1313/blog/posts/" title="æ‰€æœ‰æ–‡ç« åˆ—è¡¨ - æœ‰æ¡å·¥å…·æŠ€æœ¯åšå®¢ï¼šæŸ¥çœ‹æ‰€æœ‰æŠ€æœ¯æ–‡ç« å’Œæ•™ç¨‹å†…å®¹">
                    <span>æ–‡ç« </span>
                </a>
            </li>
            <li>
                <a href="https://www.util.cn" title="æœ‰æ¡å·¥å…· - å¼€å‘è€…çš„å¸¸ç”¨å·¥å…·é›†åˆï¼šæ— å¹¿å‘Š Â· æœ¬åœ°è®¡ç®— Â· å³å¼€å³ç”¨çš„åœ¨çº¿å·¥å…·å¹³å°ï¼Œæä¾›JSONæ ¼å¼åŒ–ã€SQLæ ¼å¼åŒ–ã€Markdownç¼–è¾‘å™¨ç­‰å®ç”¨å·¥å…·">
                    <span>æœ‰æ¡å·¥å…·</span>&nbsp;
                    <svg fill="none" shape-rendering="geometricPrecision" stroke="currentColor" stroke-linecap="round"
                        stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" height="12" width="12">
                        <path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"></path>
                        <path d="M15 3h6v6"></path>
                        <path d="M10 14L21 3"></path>
                    </svg>
                </a>
            </li>
            <li>
                <a href="//localhost:1313/blog/categories/" title="æ–‡ç« åˆ†ç±» - æœ‰æ¡å·¥å…·æŠ€æœ¯åšå®¢ï¼šæŒ‰æŠ€æœ¯é¢†åŸŸåˆ†ç±»çš„ä¼˜è´¨æ–‡ç« ï¼ŒåŒ…æ‹¬å‰ç«¯å¼€å‘ã€å·¥å…·ä½¿ç”¨ã€ç¼–ç¨‹æŠ€å·§ç­‰">
                    <span>åˆ†ç±»</span>
                </a>
            </li>
            <li>
                <a href="//localhost:1313/blog/tags/" title="æ ‡ç­¾äº‘ - æœ‰æ¡å·¥å…·æŠ€æœ¯åšå®¢ï¼šé€šè¿‡æ ‡ç­¾å¿«é€Ÿæ‰¾åˆ°æ„Ÿå…´è¶£çš„æŠ€æœ¯æ–‡ç« å’Œæ•™ç¨‹å†…å®¹">
                    <span>æ ‡ç­¾</span>
                </a>
            </li>
            <li>
                <a href="//localhost:1313/blog/archives/" title="æ–‡ç« å½’æ¡£ - æœ‰æ¡å·¥å…·æŠ€æœ¯åšå®¢ï¼šæŒ‰æ—¶é—´æŸ¥çœ‹å†å²æ–‡ç« ">
                    <span>å½’æ¡£</span>
                </a>
            </li>
            <li>
                <a href="//localhost:1313/blog/search/" title="æœç´¢æ–‡ç«  - æœ‰æ¡å·¥å…·æŠ€æœ¯åšå®¢ï¼šé€šè¿‡å…³é”®è¯æœç´¢æ‰¾åˆ°æ„Ÿå…´è¶£çš„æŠ€æœ¯æ–‡ç« å’Œæ•™ç¨‹å†…å®¹ï¼Œæ”¯æŒæ ‡é¢˜ã€å†…å®¹ã€åˆ†ç±»å’Œæ ‡ç­¾æœç´¢">
                    <span>æœç´¢</span>
                </a>
            </li>
        </ul>
    </nav>

  </header><main class="main">

<article class="post-single">
   

  
  <div class="post-content-wrapper">
    
    <main class="post-content-main">
      <header class="post-header-main">
        
        <h1 class="post-title entry-hint-parent">
          JavaScriptå¼‚æ­¥ç¼–ç¨‹æœ€ä½³å®è·µï¼šä»å›è°ƒåˆ°Async/Awaitçš„å®Œæ•´æŒ‡å—
        </h1>
        <div class="post-description">
          JavaScriptå¼‚æ­¥ç¼–ç¨‹æœ€ä½³å®è·µå®Œæ•´æŒ‡å—ï¼ŒåŒ…å«å›è°ƒå‡½æ•°ã€Promiseé“¾ã€Async/Awaitæ¨¡å¼ã€é”™è¯¯å¤„ç†ã€å¹¶å‘æ§åˆ¶ç­‰å¼‚æ­¥ç¼–ç¨‹æ ¸å¿ƒæ¦‚å¿µå’Œå®æˆ˜æŠ€å·§
        </div>
        <div class="post-meta">






<div class="post-meta-content"><div class="post-categories-inline"><a href="//localhost:1313///blog/categories/%E6%8A%80%E6%9C%AF%E5%8D%9A%E5%AE%A2/" class="category-link">æŠ€æœ¯åšå®¢</a></div><span class='post-date'>2025-12-18</span><span class='post-author'>æœ‰æ¡å·¥å…·å›¢é˜Ÿ</span></div>

<style>
.post-meta-content {
  display: flex;
  align-items: center;
  flex-wrap: wrap;
  gap: 0.75rem;
  font-family: 'SF Mono', 'Monaco', 'Courier New', monospace;
  font-size: 0.875rem;
  color: #9ca3af !important;  
}

.post-categories-inline {
  display: inline-flex;
  align-items: center;
  gap: 0.5rem;
}

.category-link {
  display: inline-flex;
  align-items: center;
  gap: 0.25rem;
  padding: 0.25rem 0.75rem;
  background: rgba(255, 255, 255, 0.1);
  color: #e5e7eb !important;
  text-decoration: none;
  font-size: 0.75rem;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.05em;
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 0;  
  transition: all 0.3s ease;
  white-space: nowrap;
}

.category-link:hover {
  background: rgba(255, 255, 255, 0.2);
  color: #ffffff !important;
  border-color: rgba(255, 255, 255, 0.3);
  transform: translateY(-1px);
}

.category-link::before {
  content: 'ğŸ“';
  font-size: 0.7rem;
  opacity: 0.8;
}

.post-date,
.post-reading-time,
.post-word-count,
.post-author {
  color: #9ca3af !important;
}

 
[data-theme="dark"] .post-meta-content {
  color: #9ca3af !important;  
}

[data-theme="dark"] .category-link {
  background: rgba(255, 255, 255, 0.1);
  color: #e5e7eb !important;
  border-color: rgba(255, 255, 255, 0.2);
}

[data-theme="dark"] .category-link:hover {
  background: rgba(255, 255, 255, 0.2);
  color: #ffffff !important;
  border-color: rgba(255, 255, 255, 0.3);
}

[data-theme="dark"] .post-date,
[data-theme="dark"] .post-reading-time,
[data-theme="dark"] .post-word-count,
[data-theme="dark"] .post-author {
  color: #9ca3af !important;
}

 
[data-theme="light"] .post-meta-content {
  color: #6c757d !important;  
}

[data-theme="light"] .category-link {
  background: rgba(0, 0, 0, 0.05);
  color: #495057 !important;
  border-color: rgba(0, 0, 0, 0.15);
}

[data-theme="light"] .category-link:hover {
  background: rgba(0, 102, 204, 0.1);
  color: #212529 !important;
  border-color: rgba(0, 102, 204, 0.3);
}

[data-theme="light"] .post-date,
[data-theme="light"] .post-reading-time,
[data-theme="light"] .post-word-count,
[data-theme="light"] .post-author {
  color: #6c757d !important;
}

 
@media (max-width: 768px) {
  .post-meta-content {
    gap: 0.5rem;
    font-size: 0.8rem;
  }

  .category-link {
    padding: 0.2rem 0.6rem;
    font-size: 0.7rem;
  }
}
</style>

</div>
      </header>
      <div class="post-content"><p>JavaScriptçš„å¼‚æ­¥ç¼–ç¨‹æ˜¯ç°ä»£Webå¼€å‘çš„æ ¸å¿ƒæ¦‚å¿µä¹‹ä¸€ã€‚ä»æœ€åˆçš„å›è°ƒå‡½æ•°åˆ°ç°åœ¨çš„Async/Awaitï¼ŒJavaScriptå¼‚æ­¥ç¼–ç¨‹ç»å†äº†å·¨å¤§çš„æ¼”è¿›ã€‚æœ¬æ–‡å°†æ·±å…¥æ¢è®¨å¼‚æ­¥ç¼–ç¨‹çš„æœ€ä½³å®è·µï¼Œå¸®åŠ©ä½ å†™å‡ºæ›´æ¸…æ™°ã€æ›´å¯ç»´æŠ¤çš„å¼‚æ­¥ä»£ç ã€‚</p>
<h2 id="å¼‚æ­¥ç¼–ç¨‹æ¼”è¿›å²">å¼‚æ­¥ç¼–ç¨‹æ¼”è¿›å²<a hidden class="anchor" aria-hidden="true" href="#å¼‚æ­¥ç¼–ç¨‹æ¼”è¿›å²">#</a></h2>
<h3 id="1-å›è°ƒå‡½æ•°æ—¶ä»£">1. å›è°ƒå‡½æ•°æ—¶ä»£<a hidden class="anchor" aria-hidden="true" href="#1-å›è°ƒå‡½æ•°æ—¶ä»£">#</a></h3>
<div class="highlight"><div style="color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">26
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#8b949e;font-style:italic">// ä¼ ç»Ÿçš„å›è°ƒå‡½æ•°
</span></span></span><span style="display:flex;"><span><span style="color:#8b949e;font-style:italic"></span><span style="color:#ff7b72">function</span> fetchData(callback) {
</span></span><span style="display:flex;"><span>  setTimeout(() =&gt; {
</span></span><span style="display:flex;"><span>    callback(<span style="color:#a5d6ff">&#39;Data loaded&#39;</span>)
</span></span><span style="display:flex;"><span>  }, <span style="color:#a5d6ff">1000</span>)
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff7b72">function</span> processData(callback) {
</span></span><span style="display:flex;"><span>  fetchData((data) =&gt; {
</span></span><span style="display:flex;"><span>    <span style="color:#ff7b72">const</span> result <span style="color:#ff7b72;font-weight:bold">=</span> data.toUpperCase()
</span></span><span style="display:flex;"><span>    callback(result)
</span></span><span style="display:flex;"><span>  })
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8b949e;font-style:italic">// å›è°ƒåœ°ç‹±
</span></span></span><span style="display:flex;"><span><span style="color:#8b949e;font-style:italic"></span><span style="color:#ff7b72">function</span> getData(callback) {
</span></span><span style="display:flex;"><span>  fetchData((data1) =&gt; {
</span></span><span style="display:flex;"><span>    processData((data2) =&gt; {
</span></span><span style="display:flex;"><span>      anotherProcess((data3) =&gt; {
</span></span><span style="display:flex;"><span>        finalProcess((data4) =&gt; {
</span></span><span style="display:flex;"><span>          callback(data4)
</span></span><span style="display:flex;"><span>        })
</span></span><span style="display:flex;"><span>      })
</span></span><span style="display:flex;"><span>    })
</span></span><span style="display:flex;"><span>  })
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="2-promiseæ—¶ä»£">2. Promiseæ—¶ä»£<a hidden class="anchor" aria-hidden="true" href="#2-promiseæ—¶ä»£">#</a></h3>
<div class="highlight"><div style="color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">22
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#8b949e;font-style:italic">// PromiseåŸºç¡€ç”¨æ³•
</span></span></span><span style="display:flex;"><span><span style="color:#8b949e;font-style:italic"></span><span style="color:#ff7b72">function</span> fetchData() {
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">return</span> <span style="color:#ff7b72">new</span> Promise((resolve, reject) =&gt; {
</span></span><span style="display:flex;"><span>    setTimeout(() =&gt; {
</span></span><span style="display:flex;"><span>      resolve(<span style="color:#a5d6ff">&#39;Data loaded&#39;</span>)
</span></span><span style="display:flex;"><span>    }, <span style="color:#a5d6ff">1000</span>)
</span></span><span style="display:flex;"><span>  })
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8b949e;font-style:italic">// Promiseé“¾
</span></span></span><span style="display:flex;"><span><span style="color:#8b949e;font-style:italic"></span>fetchData()
</span></span><span style="display:flex;"><span>  .then(data =&gt; {
</span></span><span style="display:flex;"><span>    console.log(data)
</span></span><span style="display:flex;"><span>    <span style="color:#ff7b72">return</span> processData(data)
</span></span><span style="display:flex;"><span>  })
</span></span><span style="display:flex;"><span>  .then(result =&gt; {
</span></span><span style="display:flex;"><span>    console.log(result)
</span></span><span style="display:flex;"><span>    <span style="color:#ff7b72">return</span> anotherProcess(result)
</span></span><span style="display:flex;"><span>  })
</span></span><span style="display:flex;"><span>  .<span style="color:#ff7b72">catch</span>(error =&gt; {
</span></span><span style="display:flex;"><span>    console.error(<span style="color:#a5d6ff">&#39;Error:&#39;</span>, error)
</span></span><span style="display:flex;"><span>  })
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="3-asyncawaitæ—¶ä»£">3. Async/Awaitæ—¶ä»£<a hidden class="anchor" aria-hidden="true" href="#3-asyncawaitæ—¶ä»£">#</a></h3>
<div class="highlight"><div style="color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">12
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#8b949e;font-style:italic">// Async/AwaitåŸºç¡€ç”¨æ³•
</span></span></span><span style="display:flex;"><span><span style="color:#8b949e;font-style:italic"></span><span style="color:#ff7b72">async</span> <span style="color:#ff7b72">function</span> getData() {
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">try</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#ff7b72">const</span> data <span style="color:#ff7b72;font-weight:bold">=</span> <span style="color:#ff7b72">await</span> fetchData()
</span></span><span style="display:flex;"><span>    <span style="color:#ff7b72">const</span> result <span style="color:#ff7b72;font-weight:bold">=</span> <span style="color:#ff7b72">await</span> processData(data)
</span></span><span style="display:flex;"><span>    <span style="color:#ff7b72">const</span> finalResult <span style="color:#ff7b72;font-weight:bold">=</span> <span style="color:#ff7b72">await</span> anotherProcess(result)
</span></span><span style="display:flex;"><span>    <span style="color:#ff7b72">return</span> finalResult
</span></span><span style="display:flex;"><span>  } <span style="color:#ff7b72">catch</span> (error) {
</span></span><span style="display:flex;"><span>    console.error(<span style="color:#a5d6ff">&#39;Error:&#39;</span>, error)
</span></span><span style="display:flex;"><span>    <span style="color:#ff7b72">throw</span> error
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="promiseæ·±åº¦è§£æ">Promiseæ·±åº¦è§£æ<a hidden class="anchor" aria-hidden="true" href="#promiseæ·±åº¦è§£æ">#</a></h2>
<h3 id="1-promiseçš„ä¸‰ç§çŠ¶æ€">1. Promiseçš„ä¸‰ç§çŠ¶æ€<a hidden class="anchor" aria-hidden="true" href="#1-promiseçš„ä¸‰ç§çŠ¶æ€">#</a></h3>
<div class="highlight"><div style="color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">14
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#8b949e;font-style:italic">// Pendingï¼ˆè¿›è¡Œä¸­ï¼‰
</span></span></span><span style="display:flex;"><span><span style="color:#8b949e;font-style:italic"></span><span style="color:#ff7b72">const</span> promise <span style="color:#ff7b72;font-weight:bold">=</span> <span style="color:#ff7b72">new</span> Promise((resolve, reject) =&gt; {
</span></span><span style="display:flex;"><span>  <span style="color:#8b949e;font-style:italic">// å¼‚æ­¥æ“ä½œè¿›è¡Œä¸­
</span></span></span><span style="display:flex;"><span><span style="color:#8b949e;font-style:italic"></span>  setTimeout(() =&gt; {
</span></span><span style="display:flex;"><span>    resolve(<span style="color:#a5d6ff">&#39;Success&#39;</span>) <span style="color:#8b949e;font-style:italic">// Fulfilledï¼ˆå·²å®Œæˆï¼‰
</span></span></span><span style="display:flex;"><span><span style="color:#8b949e;font-style:italic"></span>  }, <span style="color:#a5d6ff">1000</span>)
</span></span><span style="display:flex;"><span>})
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>console.log(promise) <span style="color:#8b949e;font-style:italic">// Promise { &lt;pending&gt; }
</span></span></span><span style="display:flex;"><span><span style="color:#8b949e;font-style:italic"></span>
</span></span><span style="display:flex;"><span><span style="color:#8b949e;font-style:italic">// çŠ¶æ€å˜åŒ–å›¾è§£
</span></span></span><span style="display:flex;"><span><span style="color:#8b949e;font-style:italic">// Pending â†’ Fulfilled
</span></span></span><span style="display:flex;"><span><span style="color:#8b949e;font-style:italic">// Pending â†’ Rejected
</span></span></span><span style="display:flex;"><span><span style="color:#8b949e;font-style:italic">// çŠ¶æ€ä¸€æ—¦ç¡®å®šå°±ä¸å¯é€†è½¬
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="2-promiseæ„é€ å‡½æ•°çš„æ­£ç¡®ä½¿ç”¨">2. Promiseæ„é€ å‡½æ•°çš„æ­£ç¡®ä½¿ç”¨<a hidden class="anchor" aria-hidden="true" href="#2-promiseæ„é€ å‡½æ•°çš„æ­£ç¡®ä½¿ç”¨">#</a></h3>
<div class="highlight"><div style="color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">19
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#8b949e;font-style:italic">// âŒ é”™è¯¯ç”¨æ³•ï¼šåœ¨æ„é€ å‡½æ•°ä¸­åŒæ­¥è°ƒç”¨resolve
</span></span></span><span style="display:flex;"><span><span style="color:#8b949e;font-style:italic"></span><span style="color:#ff7b72">function</span> badPromise() {
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">const</span> promise <span style="color:#ff7b72;font-weight:bold">=</span> <span style="color:#ff7b72">new</span> Promise((resolve) =&gt; {
</span></span><span style="display:flex;"><span>    resolve(<span style="color:#a5d6ff">&#39;Already resolved&#39;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#8b949e;font-style:italic">// è¿™é‡Œçš„ä»£ç æ°¸è¿œä¸ä¼šæ‰§è¡Œ
</span></span></span><span style="display:flex;"><span><span style="color:#8b949e;font-style:italic"></span>    console.log(<span style="color:#a5d6ff">&#39;This will never run&#39;</span>)
</span></span><span style="display:flex;"><span>  })
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">return</span> promise
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8b949e;font-style:italic">// âœ… æ­£ç¡®ç”¨æ³•ï¼šå¼‚æ­¥è°ƒç”¨resolve
</span></span></span><span style="display:flex;"><span><span style="color:#8b949e;font-style:italic"></span><span style="color:#ff7b72">function</span> goodPromise() {
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">return</span> <span style="color:#ff7b72">new</span> Promise((resolve, reject) =&gt; {
</span></span><span style="display:flex;"><span>    setTimeout(() =&gt; {
</span></span><span style="display:flex;"><span>      resolve(<span style="color:#a5d6ff">&#39;Resolved asynchronously&#39;</span>)
</span></span><span style="display:flex;"><span>      console.log(<span style="color:#a5d6ff">&#39;This will run&#39;</span>)
</span></span><span style="display:flex;"><span>    }, <span style="color:#a5d6ff">1000</span>)
</span></span><span style="display:flex;"><span>  })
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="3-promiseçš„é”™è¯¯å¤„ç†">3. Promiseçš„é”™è¯¯å¤„ç†<a hidden class="anchor" aria-hidden="true" href="#3-promiseçš„é”™è¯¯å¤„ç†">#</a></h3>
<div class="highlight"><div style="color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">24
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#8b949e;font-style:italic">// Promiseé”™è¯¯å¤„ç†çš„å‡ ç§æ–¹å¼
</span></span></span><span style="display:flex;"><span><span style="color:#8b949e;font-style:italic">// 1. ä½¿ç”¨catch()
</span></span></span><span style="display:flex;"><span><span style="color:#8b949e;font-style:italic"></span>fetch(<span style="color:#a5d6ff">&#39;/api/data&#39;</span>)
</span></span><span style="display:flex;"><span>  .then(response =&gt; response.json())
</span></span><span style="display:flex;"><span>  .then(data =&gt; console.log(data))
</span></span><span style="display:flex;"><span>  .<span style="color:#ff7b72">catch</span>(error =&gt; console.error(error))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8b949e;font-style:italic">// 2. ä½¿ç”¨ç¬¬äºŒä¸ªå‚æ•°
</span></span></span><span style="display:flex;"><span><span style="color:#8b949e;font-style:italic"></span>fetch(<span style="color:#a5d6ff">&#39;/api/data&#39;</span>)
</span></span><span style="display:flex;"><span>  .then(
</span></span><span style="display:flex;"><span>    response =&gt; response.json(),
</span></span><span style="display:flex;"><span>    error =&gt; console.error(error)
</span></span><span style="display:flex;"><span>  )
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8b949e;font-style:italic">// 3. ä½¿ç”¨try-catchåŒ…è£…
</span></span></span><span style="display:flex;"><span><span style="color:#8b949e;font-style:italic"></span><span style="color:#ff7b72">function</span> <span style="color:#ff7b72">async</span> fetchWithErrorHandling() {
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">try</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#ff7b72">const</span> response <span style="color:#ff7b72;font-weight:bold">=</span> <span style="color:#ff7b72">await</span> fetch(<span style="color:#a5d6ff">&#39;/api/data&#39;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#ff7b72">const</span> data <span style="color:#ff7b72;font-weight:bold">=</span> <span style="color:#ff7b72">await</span> response.json()
</span></span><span style="display:flex;"><span>    console.log(data)
</span></span><span style="display:flex;"><span>  } <span style="color:#ff7b72">catch</span> (error) {
</span></span><span style="display:flex;"><span>    console.error(error)
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="4-promiseç»„åˆæ–¹æ³•">4. Promiseç»„åˆæ–¹æ³•<a hidden class="anchor" aria-hidden="true" href="#4-promiseç»„åˆæ–¹æ³•">#</a></h3>
<div class="highlight"><div style="color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">56
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">57
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#8b949e;font-style:italic">// Promise.all - æ‰€æœ‰Promiseéƒ½å®Œæˆ
</span></span></span><span style="display:flex;"><span><span style="color:#8b949e;font-style:italic"></span><span style="color:#ff7b72">function</span> fetchMultipleData() {
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">const</span> promise1 <span style="color:#ff7b72;font-weight:bold">=</span> fetch(<span style="color:#a5d6ff">&#39;/api/users&#39;</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">const</span> promise2 <span style="color:#ff7b72;font-weight:bold">=</span> fetch(<span style="color:#a5d6ff">&#39;/api/posts&#39;</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">const</span> promise3 <span style="color:#ff7b72;font-weight:bold">=</span> fetch(<span style="color:#a5d6ff">&#39;/api/comments&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">return</span> Promise.all([promise1, promise2, promise3])
</span></span><span style="display:flex;"><span>    .then(([users, posts, comments]) =&gt; {
</span></span><span style="display:flex;"><span>      console.log(<span style="color:#a5d6ff">&#39;All data loaded&#39;</span>)
</span></span><span style="display:flex;"><span>      <span style="color:#ff7b72">return</span> { users, posts, comments }
</span></span><span style="display:flex;"><span>    })
</span></span><span style="display:flex;"><span>    .<span style="color:#ff7b72">catch</span>(error =&gt; {
</span></span><span style="display:flex;"><span>      console.error(<span style="color:#a5d6ff">&#39;One of the requests failed:&#39;</span>, error)
</span></span><span style="display:flex;"><span>      <span style="color:#ff7b72">throw</span> error
</span></span><span style="display:flex;"><span>    })
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8b949e;font-style:italic">// Promise.allSettled - æ‰€æœ‰Promiseéƒ½å®Œæˆï¼ˆä¸è®ºæˆåŠŸå¤±è´¥ï¼‰
</span></span></span><span style="display:flex;"><span><span style="color:#8b949e;font-style:italic"></span><span style="color:#ff7b72">function</span> fetchAllSettled() {
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">const</span> urls <span style="color:#ff7b72;font-weight:bold">=</span> [<span style="color:#a5d6ff">&#39;/api/users&#39;</span>, <span style="color:#a5d6ff">&#39;/api/posts&#39;</span>, <span style="color:#a5d6ff">&#39;/api/comments&#39;</span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">const</span> promises <span style="color:#ff7b72;font-weight:bold">=</span> urls.map(url =&gt;
</span></span><span style="display:flex;"><span>    fetch(url).then(response =&gt; response.json())
</span></span><span style="display:flex;"><span>  )
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">return</span> Promise.allSettled(promises)
</span></span><span style="display:flex;"><span>    .then(results =&gt; {
</span></span><span style="display:flex;"><span>      <span style="color:#ff7b72">const</span> successful <span style="color:#ff7b72;font-weight:bold">=</span> results.filter(result =&gt; result.status <span style="color:#ff7b72;font-weight:bold">===</span> <span style="color:#a5d6ff">&#39;fulfilled&#39;</span>)
</span></span><span style="display:flex;"><span>      <span style="color:#ff7b72">const</span> failed <span style="color:#ff7b72;font-weight:bold">=</span> results.filter(result =&gt; result.status <span style="color:#ff7b72;font-weight:bold">===</span> <span style="color:#a5d6ff">&#39;rejected&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      console.log(<span style="color:#a5d6ff">&#39;Successful requests:&#39;</span>, successful.length)
</span></span><span style="display:flex;"><span>      console.log(<span style="color:#a5d6ff">&#39;Failed requests:&#39;</span>, failed.length)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      <span style="color:#ff7b72">return</span> {
</span></span><span style="display:flex;"><span>        successful<span style="color:#ff7b72;font-weight:bold">:</span> successful.map(r =&gt; r.value),
</span></span><span style="display:flex;"><span>        failed<span style="color:#ff7b72;font-weight:bold">:</span> failed.map(f =&gt; f.reason)
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    })
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8b949e;font-style:italic">// Promise.race - æœ€å¿«å®Œæˆçš„Promise
</span></span></span><span style="display:flex;"><span><span style="color:#8b949e;font-style:italic"></span><span style="color:#ff7b72">function</span> fetchWithRace() {
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">const</span> timeoutPromise <span style="color:#ff7b72;font-weight:bold">=</span> <span style="color:#ff7b72">new</span> Promise((_, reject) =&gt; {
</span></span><span style="display:flex;"><span>    setTimeout(() =&gt; reject(<span style="color:#ff7b72">new</span> Error(<span style="color:#a5d6ff">&#39;Request timeout&#39;</span>)), <span style="color:#a5d6ff">5000</span>)
</span></span><span style="display:flex;"><span>  })
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">const</span> fetchPromise <span style="color:#ff7b72;font-weight:bold">=</span> fetch(<span style="color:#a5d6ff">&#39;/api/data&#39;</span>)
</span></span><span style="display:flex;"><span>    .then(response =&gt; response.json())
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">return</span> Promise.race([fetchPromise, timeoutPromise])
</span></span><span style="display:flex;"><span>    .<span style="color:#ff7b72">catch</span>(error =&gt; {
</span></span><span style="display:flex;"><span>      <span style="color:#ff7b72">if</span> (error.message <span style="color:#ff7b72;font-weight:bold">===</span> <span style="color:#a5d6ff">&#39;Request timeout&#39;</span>) {
</span></span><span style="display:flex;"><span>        console.log(<span style="color:#a5d6ff">&#39;è¯·æ±‚è¶…æ—¶&#39;</span>)
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>      <span style="color:#ff7b72">throw</span> error
</span></span><span style="display:flex;"><span>    })
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="asyncawaitæœ€ä½³å®è·µ">Async/Awaitæœ€ä½³å®è·µ<a hidden class="anchor" aria-hidden="true" href="#asyncawaitæœ€ä½³å®è·µ">#</a></h2>
<h3 id="1-é”™è¯¯å¤„ç†ç­–ç•¥">1. é”™è¯¯å¤„ç†ç­–ç•¥<a hidden class="anchor" aria-hidden="true" href="#1-é”™è¯¯å¤„ç†ç­–ç•¥">#</a></h3>
<div class="highlight"><div style="color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">56
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">57
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">58
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">59
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">60
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">61
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">62
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">63
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">64
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">65
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">66
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#8b949e;font-style:italic">// 1. ç»Ÿä¸€çš„é”™è¯¯å¤„ç†ä¸­é—´ä»¶
</span></span></span><span style="display:flex;"><span><span style="color:#8b949e;font-style:italic"></span><span style="color:#ff7b72">class</span> ApiClient {
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">async</span> request(url, options <span style="color:#ff7b72;font-weight:bold">=</span> {}) {
</span></span><span style="display:flex;"><span>    <span style="color:#ff7b72">try</span> {
</span></span><span style="display:flex;"><span>      <span style="color:#ff7b72">const</span> response <span style="color:#ff7b72;font-weight:bold">=</span> <span style="color:#ff7b72">await</span> fetch(url, {
</span></span><span style="display:flex;"><span>        headers<span style="color:#ff7b72;font-weight:bold">:</span> {
</span></span><span style="display:flex;"><span>          <span style="color:#a5d6ff">&#39;Content-Type&#39;</span><span style="color:#ff7b72;font-weight:bold">:</span> <span style="color:#a5d6ff">&#39;application/json&#39;</span>,
</span></span><span style="display:flex;"><span>          ...options.headers,
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>        ...options,
</span></span><span style="display:flex;"><span>      })
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      <span style="color:#ff7b72">if</span> (<span style="color:#ff7b72;font-weight:bold">!</span>response.ok) {
</span></span><span style="display:flex;"><span>        <span style="color:#ff7b72">throw</span> <span style="color:#ff7b72">new</span> Error(<span style="color:#a5d6ff">`HTTP Error: </span><span style="color:#a5d6ff">${</span>response.status<span style="color:#a5d6ff">}</span><span style="color:#a5d6ff"> </span><span style="color:#a5d6ff">${</span>response.statusText<span style="color:#a5d6ff">}</span><span style="color:#a5d6ff">`</span>)
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      <span style="color:#ff7b72">return</span> <span style="color:#ff7b72">await</span> response.json()
</span></span><span style="display:flex;"><span>    } <span style="color:#ff7b72">catch</span> (error) {
</span></span><span style="display:flex;"><span>      <span style="color:#ff7b72">if</span> (error <span style="color:#ff7b72">instanceof</span> TypeError) {
</span></span><span style="display:flex;"><span>        <span style="color:#ff7b72">throw</span> <span style="color:#ff7b72">new</span> Error(<span style="color:#a5d6ff">&#39;Network error: &#39;</span> <span style="color:#ff7b72;font-weight:bold">+</span> error.message)
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>      <span style="color:#ff7b72">throw</span> error
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8b949e;font-style:italic">// 2. è‡ªå®šä¹‰é”™è¯¯ç±»
</span></span></span><span style="display:flex;"><span><span style="color:#8b949e;font-style:italic"></span><span style="color:#ff7b72">class</span> NetworkError <span style="color:#ff7b72">extends</span> Error {
</span></span><span style="display:flex;"><span>  constructor(message, response) {
</span></span><span style="display:flex;"><span>    <span style="color:#ff7b72">super</span>(message)
</span></span><span style="display:flex;"><span>    <span style="color:#ff7b72">this</span>.name <span style="color:#ff7b72;font-weight:bold">=</span> <span style="color:#a5d6ff">&#39;NetworkError&#39;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff7b72">this</span>.response <span style="color:#ff7b72;font-weight:bold">=</span> response
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff7b72">class</span> ValidationError <span style="color:#ff7b72">extends</span> Error {
</span></span><span style="display:flex;"><span>  constructor(message, field) {
</span></span><span style="display:flex;"><span>    <span style="color:#ff7b72">super</span>(message)
</span></span><span style="display:flex;"><span>    <span style="color:#ff7b72">this</span>.name <span style="color:#ff7b72;font-weight:bold">=</span> <span style="color:#a5d6ff">&#39;ValidationError&#39;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff7b72">this</span>.field <span style="color:#ff7b72;font-weight:bold">=</span> field
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8b949e;font-style:italic">// ä½¿ç”¨ç¤ºä¾‹
</span></span></span><span style="display:flex;"><span><span style="color:#8b949e;font-style:italic"></span><span style="color:#ff7b72">const</span> apiClient <span style="color:#ff7b72;font-weight:bold">=</span> <span style="color:#ff7b72">new</span> ApiClient()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff7b72">async</span> <span style="color:#ff7b72">function</span> getUserData(userId) {
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">try</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#ff7b72">const</span> userData <span style="color:#ff7b72;font-weight:bold">=</span> <span style="color:#ff7b72">await</span> apiClient.request(<span style="color:#a5d6ff">`/api/users/</span><span style="color:#a5d6ff">${</span>userId<span style="color:#a5d6ff">}</span><span style="color:#a5d6ff">`</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff7b72">if</span> (<span style="color:#ff7b72;font-weight:bold">!</span>userData.email) {
</span></span><span style="display:flex;"><span>      <span style="color:#ff7b72">throw</span> <span style="color:#ff7b72">new</span> ValidationError(<span style="color:#a5d6ff">&#39;Email is required&#39;</span>, <span style="color:#a5d6ff">&#39;email&#39;</span>)
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff7b72">return</span> userData
</span></span><span style="display:flex;"><span>  } <span style="color:#ff7b72">catch</span> (error) {
</span></span><span style="display:flex;"><span>    <span style="color:#ff7b72">if</span> (error <span style="color:#ff7b72">instanceof</span> ValidationError) {
</span></span><span style="display:flex;"><span>      console.error(<span style="color:#a5d6ff">`Validation error in </span><span style="color:#a5d6ff">${</span>error.field<span style="color:#a5d6ff">}</span><span style="color:#a5d6ff">: </span><span style="color:#a5d6ff">${</span>error.message<span style="color:#a5d6ff">}</span><span style="color:#a5d6ff">`</span>)
</span></span><span style="display:flex;"><span>    } <span style="color:#ff7b72">else</span> <span style="color:#ff7b72">if</span> (error <span style="color:#ff7b72">instanceof</span> NetworkError) {
</span></span><span style="display:flex;"><span>      console.error(<span style="color:#a5d6ff">&#39;Network error:&#39;</span>, error.message)
</span></span><span style="display:flex;"><span>    } <span style="color:#ff7b72">else</span> {
</span></span><span style="display:flex;"><span>      console.error(<span style="color:#a5d6ff">&#39;Unexpected error:&#39;</span>, error.message)
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#ff7b72">throw</span> error
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="2-å¹¶å‘æ§åˆ¶">2. å¹¶å‘æ§åˆ¶<a hidden class="anchor" aria-hidden="true" href="#2-å¹¶å‘æ§åˆ¶">#</a></h3>
<div class="highlight"><div style="color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">51
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#8b949e;font-style:italic">// å¹¶å‘é™åˆ¶å™¨
</span></span></span><span style="display:flex;"><span><span style="color:#8b949e;font-style:italic"></span><span style="color:#ff7b72">class</span> ConcurrencyLimiter {
</span></span><span style="display:flex;"><span>  constructor(maxConcurrent) {
</span></span><span style="display:flex;"><span>    <span style="color:#ff7b72">this</span>.maxConcurrent <span style="color:#ff7b72;font-weight:bold">=</span> maxConcurrent
</span></span><span style="display:flex;"><span>    <span style="color:#ff7b72">this</span>.currentCount <span style="color:#ff7b72;font-weight:bold">=</span> <span style="color:#a5d6ff">0</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff7b72">this</span>.queue <span style="color:#ff7b72;font-weight:bold">=</span> []
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">async</span> execute(task) {
</span></span><span style="display:flex;"><span>    <span style="color:#ff7b72">return</span> <span style="color:#ff7b72">new</span> Promise((resolve, reject) =&gt; {
</span></span><span style="display:flex;"><span>      <span style="color:#ff7b72">this</span>.queue.push({ task, resolve, reject })
</span></span><span style="display:flex;"><span>      <span style="color:#ff7b72">this</span>.processQueue()
</span></span><span style="display:flex;"><span>    })
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">async</span> processQueue() {
</span></span><span style="display:flex;"><span>    <span style="color:#ff7b72">if</span> (<span style="color:#ff7b72">this</span>.currentCount <span style="color:#ff7b72;font-weight:bold">&gt;=</span> <span style="color:#ff7b72">this</span>.maxConcurrent <span style="color:#ff7b72;font-weight:bold">||</span> <span style="color:#ff7b72">this</span>.queue.length <span style="color:#ff7b72;font-weight:bold">===</span> <span style="color:#a5d6ff">0</span>) {
</span></span><span style="display:flex;"><span>      <span style="color:#ff7b72">return</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff7b72">this</span>.currentCount<span style="color:#ff7b72;font-weight:bold">++</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff7b72">const</span> { task, resolve, reject } <span style="color:#ff7b72;font-weight:bold">=</span> <span style="color:#ff7b72">this</span>.queue.shift()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff7b72">try</span> {
</span></span><span style="display:flex;"><span>      <span style="color:#ff7b72">const</span> result <span style="color:#ff7b72;font-weight:bold">=</span> <span style="color:#ff7b72">await</span> task()
</span></span><span style="display:flex;"><span>      resolve(result)
</span></span><span style="display:flex;"><span>    } <span style="color:#ff7b72">catch</span> (error) {
</span></span><span style="display:flex;"><span>      reject(error)
</span></span><span style="display:flex;"><span>    } <span style="color:#ff7b72">finally</span> {
</span></span><span style="display:flex;"><span>      <span style="color:#ff7b72">this</span>.currentCount<span style="color:#ff7b72;font-weight:bold">--</span>
</span></span><span style="display:flex;"><span>      <span style="color:#ff7b72">this</span>.processQueue()
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8b949e;font-style:italic">// ä½¿ç”¨ç¤ºä¾‹
</span></span></span><span style="display:flex;"><span><span style="color:#8b949e;font-style:italic"></span><span style="color:#ff7b72">const</span> limiter <span style="color:#ff7b72;font-weight:bold">=</span> <span style="color:#ff7b72">new</span> ConcurrencyLimiter(<span style="color:#a5d6ff">3</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff7b72">async</span> <span style="color:#ff7b72">function</span> processBatch(items) {
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">const</span> tasks <span style="color:#ff7b72;font-weight:bold">=</span> items.map(item =&gt;
</span></span><span style="display:flex;"><span>    limiter.execute(() =&gt; processItem(item))
</span></span><span style="display:flex;"><span>  )
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">return</span> Promise.all(tasks)
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff7b72">async</span> <span style="color:#ff7b72">function</span> processItem(item) {
</span></span><span style="display:flex;"><span>  console.log(<span style="color:#a5d6ff">`Processing item: </span><span style="color:#a5d6ff">${</span>item<span style="color:#a5d6ff">}</span><span style="color:#a5d6ff">`</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">await</span> <span style="color:#ff7b72">new</span> Promise(resolve =&gt; setTimeout(resolve, <span style="color:#a5d6ff">1000</span>))
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">return</span> <span style="color:#a5d6ff">`Processed: </span><span style="color:#a5d6ff">${</span>item<span style="color:#a5d6ff">}</span><span style="color:#a5d6ff">`</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="3-é‡è¯•æœºåˆ¶">3. é‡è¯•æœºåˆ¶<a hidden class="anchor" aria-hidden="true" href="#3-é‡è¯•æœºåˆ¶">#</a></h3>
<div class="highlight"><div style="color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">56
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">57
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">58
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">59
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">60
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#8b949e;font-style:italic">// æŒ‡æ•°é€€é¿é‡è¯•
</span></span></span><span style="display:flex;"><span><span style="color:#8b949e;font-style:italic"></span><span style="color:#ff7b72">async</span> <span style="color:#ff7b72">function</span> retryWithBackoff(fn, maxRetries <span style="color:#ff7b72;font-weight:bold">=</span> <span style="color:#a5d6ff">3</span>, baseDelay <span style="color:#ff7b72;font-weight:bold">=</span> <span style="color:#a5d6ff">1000</span>) {
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">let</span> lastError
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">for</span> (<span style="color:#ff7b72">let</span> attempt <span style="color:#ff7b72;font-weight:bold">=</span> <span style="color:#a5d6ff">0</span>; attempt <span style="color:#ff7b72;font-weight:bold">&lt;=</span> maxRetries; attempt<span style="color:#ff7b72;font-weight:bold">++</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#ff7b72">try</span> {
</span></span><span style="display:flex;"><span>      <span style="color:#ff7b72">const</span> result <span style="color:#ff7b72;font-weight:bold">=</span> <span style="color:#ff7b72">await</span> fn()
</span></span><span style="display:flex;"><span>      <span style="color:#ff7b72">return</span> result
</span></span><span style="display:flex;"><span>    } <span style="color:#ff7b72">catch</span> (error) {
</span></span><span style="display:flex;"><span>      lastError <span style="color:#ff7b72;font-weight:bold">=</span> error
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      <span style="color:#ff7b72">if</span> (attempt <span style="color:#ff7b72;font-weight:bold">===</span> maxRetries) {
</span></span><span style="display:flex;"><span>        <span style="color:#ff7b72">throw</span> error
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      <span style="color:#ff7b72">const</span> delay <span style="color:#ff7b72;font-weight:bold">=</span> baseDelay <span style="color:#ff7b72;font-weight:bold">*</span> Math.pow(<span style="color:#a5d6ff">2</span>, attempt)
</span></span><span style="display:flex;"><span>      console.log(<span style="color:#a5d6ff">`Attempt </span><span style="color:#a5d6ff">${</span>attempt <span style="color:#ff7b72;font-weight:bold">+</span> <span style="color:#a5d6ff">1</span><span style="color:#a5d6ff">}</span><span style="color:#a5d6ff"> failed, retrying in </span><span style="color:#a5d6ff">${</span>delay<span style="color:#a5d6ff">}</span><span style="color:#a5d6ff">ms`</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      <span style="color:#ff7b72">await</span> <span style="color:#ff7b72">new</span> Promise(resolve =&gt; setTimeout(resolve, delay))
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">throw</span> lastError
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8b949e;font-style:italic">// çº¿æ€§é€€é¿é‡è¯•
</span></span></span><span style="display:flex;"><span><span style="color:#8b949e;font-style:italic"></span><span style="color:#ff7b72">async</span> <span style="color:#ff7b72">function</span> retryLinear(fn, maxRetries <span style="color:#ff7b72;font-weight:bold">=</span> <span style="color:#a5d6ff">3</span>, delay <span style="color:#ff7b72;font-weight:bold">=</span> <span style="color:#a5d6ff">1000</span>) {
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">let</span> lastError
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">for</span> (<span style="color:#ff7b72">let</span> attempt <span style="color:#ff7b72;font-weight:bold">=</span> <span style="color:#a5d6ff">0</span>; attempt <span style="color:#ff7b72;font-weight:bold">&lt;=</span> maxRetries; attempt<span style="color:#ff7b72;font-weight:bold">++</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#ff7b72">try</span> {
</span></span><span style="display:flex;"><span>      <span style="color:#ff7b72">const</span> result <span style="color:#ff7b72;font-weight:bold">=</span> <span style="color:#ff7b72">await</span> fn()
</span></span><span style="display:flex;"><span>      <span style="color:#ff7b72">return</span> result
</span></span><span style="display:flex;"><span>    } <span style="color:#ff7b72">catch</span> (error) {
</span></span><span style="display:flex;"><span>      lastError <span style="color:#ff7b72;font-weight:bold">=</span> error
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      <span style="color:#ff7b72">if</span> (attempt <span style="color:#ff7b72;font-weight:bold">===</span> maxRetries) {
</span></span><span style="display:flex;"><span>        <span style="color:#ff7b72">throw</span> error
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      <span style="color:#ff7b72">const</span> waitTime <span style="color:#ff7b72;font-weight:bold">=</span> delay <span style="color:#ff7b72;font-weight:bold">*</span> (attempt <span style="color:#ff7b72;font-weight:bold">+</span> <span style="color:#a5d6ff">1</span>)
</span></span><span style="display:flex;"><span>      console.log(<span style="color:#a5d6ff">`Attempt </span><span style="color:#a5d6ff">${</span>attempt <span style="color:#ff7b72;font-weight:bold">+</span> <span style="color:#a5d6ff">1</span><span style="color:#a5d6ff">}</span><span style="color:#a5d6ff"> failed, retrying in </span><span style="color:#a5d6ff">${</span>waitTime<span style="color:#a5d6ff">}</span><span style="color:#a5d6ff">ms`</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      <span style="color:#ff7b72">await</span> <span style="color:#ff7b72">new</span> Promise(resolve =&gt; setTimeout(resolve, waitTime))
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">throw</span> lastError
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8b949e;font-style:italic">// ä½¿ç”¨ç¤ºä¾‹
</span></span></span><span style="display:flex;"><span><span style="color:#8b949e;font-style:italic"></span><span style="color:#ff7b72">async</span> <span style="color:#ff7b72">function</span> fetchWithRetry(url) {
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">return</span> retryWithBackoff(<span style="color:#ff7b72">async</span> () =&gt; {
</span></span><span style="display:flex;"><span>    <span style="color:#ff7b72">const</span> response <span style="color:#ff7b72;font-weight:bold">=</span> <span style="color:#ff7b72">await</span> fetch(url)
</span></span><span style="display:flex;"><span>    <span style="color:#ff7b72">if</span> (<span style="color:#ff7b72;font-weight:bold">!</span>response.ok) {
</span></span><span style="display:flex;"><span>      <span style="color:#ff7b72">throw</span> <span style="color:#ff7b72">new</span> Error(<span style="color:#a5d6ff">`HTTP </span><span style="color:#a5d6ff">${</span>response.status<span style="color:#a5d6ff">}</span><span style="color:#a5d6ff">`</span>)
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#ff7b72">return</span> response.json()
</span></span><span style="display:flex;"><span>  }, <span style="color:#a5d6ff">5</span>)
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="4-è¶…æ—¶æ§åˆ¶">4. è¶…æ—¶æ§åˆ¶<a hidden class="anchor" aria-hidden="true" href="#4-è¶…æ—¶æ§åˆ¶">#</a></h3>
<div class="highlight"><div style="color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">47
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#8b949e;font-style:italic">// å¸¦è¶…æ—¶çš„fetch
</span></span></span><span style="display:flex;"><span><span style="color:#8b949e;font-style:italic"></span><span style="color:#ff7b72">async</span> <span style="color:#ff7b72">function</span> fetchWithTimeout(url, timeout <span style="color:#ff7b72;font-weight:bold">=</span> <span style="color:#a5d6ff">5000</span>) {
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">const</span> controller <span style="color:#ff7b72;font-weight:bold">=</span> <span style="color:#ff7b72">new</span> AbortController()
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">const</span> timeoutId <span style="color:#ff7b72;font-weight:bold">=</span> setTimeout(() =&gt; controller.abort(), timeout)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">try</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#ff7b72">const</span> response <span style="color:#ff7b72;font-weight:bold">=</span> <span style="color:#ff7b72">await</span> fetch(url, {
</span></span><span style="display:flex;"><span>      signal<span style="color:#ff7b72;font-weight:bold">:</span> controller.signal,
</span></span><span style="display:flex;"><span>    })
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff7b72">if</span> (<span style="color:#ff7b72;font-weight:bold">!</span>response.ok) {
</span></span><span style="display:flex;"><span>      <span style="color:#ff7b72">throw</span> <span style="color:#ff7b72">new</span> Error(<span style="color:#a5d6ff">`HTTP Error: </span><span style="color:#a5d6ff">${</span>response.status<span style="color:#a5d6ff">}</span><span style="color:#a5d6ff">`</span>)
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff7b72">return</span> response.json()
</span></span><span style="display:flex;"><span>  } <span style="color:#ff7b72">finally</span> {
</span></span><span style="display:flex;"><span>    clearTimeout(timeoutId)
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8b949e;font-style:italic">// Promise.raceå®ç°çš„è¶…æ—¶
</span></span></span><span style="display:flex;"><span><span style="color:#8b949e;font-style:italic"></span><span style="color:#ff7b72">async</span> <span style="color:#ff7b72">function</span> fetchWithTimeoutRace(url, timeout <span style="color:#ff7b72;font-weight:bold">=</span> <span style="color:#a5d6ff">5000</span>) {
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">const</span> fetchPromise <span style="color:#ff7b72;font-weight:bold">=</span> fetch(url).then(response =&gt; {
</span></span><span style="display:flex;"><span>    <span style="color:#ff7b72">if</span> (<span style="color:#ff7b72;font-weight:bold">!</span>response.ok) {
</span></span><span style="display:flex;"><span>      <span style="color:#ff7b72">throw</span> <span style="color:#ff7b72">new</span> Error(<span style="color:#a5d6ff">`HTTP Error: </span><span style="color:#a5d6ff">${</span>response.status<span style="color:#a5d6ff">}</span><span style="color:#a5d6ff">`</span>)
</span></span><span style="display:flex;"><span>    })
</span></span><span style="display:flex;"><span>    <span style="color:#ff7b72">return</span> response.json()
</span></span><span style="display:flex;"><span>  })
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">const</span> timeoutPromise <span style="color:#ff7b72;font-weight:bold">=</span> <span style="color:#ff7b72">new</span> Promise((_, reject) =&gt; {
</span></span><span style="display:flex;"><span>    setTimeout(() =&gt; reject(<span style="color:#ff7b72">new</span> Error(<span style="color:#a5d6ff">&#39;Request timeout&#39;</span>)), timeout)
</span></span><span style="display:flex;"><span>  })
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">return</span> Promise.race([fetchPromise, timeoutPromise])
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8b949e;font-style:italic">// ä½¿ç”¨ç¤ºä¾‹
</span></span></span><span style="display:flex;"><span><span style="color:#8b949e;font-style:italic"></span><span style="color:#ff7b72">try</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">const</span> data <span style="color:#ff7b72;font-weight:bold">=</span> <span style="color:#ff7b72">await</span> fetchWithTimeout(<span style="color:#a5d6ff">&#39;/api/data&#39;</span>, <span style="color:#a5d6ff">3000</span>)
</span></span><span style="display:flex;"><span>  console.log(data)
</span></span><span style="display:flex;"><span>} <span style="color:#ff7b72">catch</span> (error) {
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">if</span> (error.name <span style="color:#ff7b72;font-weight:bold">===</span> <span style="color:#a5d6ff">&#39;AbortError&#39;</span>) {
</span></span><span style="display:flex;"><span>    console.log(<span style="color:#a5d6ff">&#39;Request was aborted due to timeout&#39;</span>)
</span></span><span style="display:flex;"><span>  } <span style="color:#ff7b72">else</span> {
</span></span><span style="display:flex;"><span>    console.error(<span style="color:#a5d6ff">&#39;Error:&#39;</span>, error.message)
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="é«˜çº§å¼‚æ­¥æ¨¡å¼">é«˜çº§å¼‚æ­¥æ¨¡å¼<a hidden class="anchor" aria-hidden="true" href="#é«˜çº§å¼‚æ­¥æ¨¡å¼">#</a></h2>
<h3 id="1-å¹¶è¡Œå¤„ç†">1. å¹¶è¡Œå¤„ç†<a hidden class="anchor" aria-hidden="true" href="#1-å¹¶è¡Œå¤„ç†">#</a></h3>
<div class="highlight"><div style="color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">32
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#8b949e;font-style:italic">// å¹¶è¡Œå¤„ç†æ•°ç»„ä¸­çš„å¼‚æ­¥æ“ä½œ
</span></span></span><span style="display:flex;"><span><span style="color:#8b949e;font-style:italic"></span><span style="color:#ff7b72">async</span> <span style="color:#ff7b72">function</span> processItemsInParallel(items, processor) {
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">const</span> promises <span style="color:#ff7b72;font-weight:bold">=</span> items.map(item =&gt; processor(item))
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">const</span> results <span style="color:#ff7b72;font-weight:bold">=</span> <span style="color:#ff7b72">await</span> Promise.all(promises)
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">return</span> results
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8b949e;font-style:italic">// åˆ†æ‰¹å¹¶è¡Œå¤„ç†
</span></span></span><span style="display:flex;"><span><span style="color:#8b949e;font-style:italic"></span><span style="color:#ff7b72">async</span> <span style="color:#ff7b72">function</span> processItemsInBatches(items, processor, batchSize <span style="color:#ff7b72;font-weight:bold">=</span> <span style="color:#a5d6ff">5</span>) {
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">const</span> results <span style="color:#ff7b72;font-weight:bold">=</span> []
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">for</span> (<span style="color:#ff7b72">let</span> i <span style="color:#ff7b72;font-weight:bold">=</span> <span style="color:#a5d6ff">0</span>; i <span style="color:#ff7b72;font-weight:bold">&lt;</span> items.length; i <span style="color:#ff7b72;font-weight:bold">+=</span> batchSize) {
</span></span><span style="display:flex;"><span>    <span style="color:#ff7b72">const</span> batch <span style="color:#ff7b72;font-weight:bold">=</span> items.slice(i, i <span style="color:#ff7b72;font-weight:bold">+</span> batchSize)
</span></span><span style="display:flex;"><span>    <span style="color:#ff7b72">const</span> batchResults <span style="color:#ff7b72;font-weight:bold">=</span> <span style="color:#ff7b72">await</span> Promise.all(
</span></span><span style="display:flex;"><span>      batch.map(item =&gt; processor(item))
</span></span><span style="display:flex;"><span>    )
</span></span><span style="display:flex;"><span>    results.push(...batchResults)
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">return</span> results
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8b949e;font-style:italic">// ä½¿ç”¨ç¤ºä¾‹
</span></span></span><span style="display:flex;"><span><span style="color:#8b949e;font-style:italic"></span><span style="color:#ff7b72">async</span> <span style="color:#ff7b72">function</span> fetchUsersInParallel(userIds) {
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">const</span> fetchUser <span style="color:#ff7b72;font-weight:bold">=</span> <span style="color:#ff7b72">async</span> (id) =&gt; {
</span></span><span style="display:flex;"><span>    <span style="color:#ff7b72">const</span> response <span style="color:#ff7b72;font-weight:bold">=</span> <span style="color:#ff7b72">await</span> fetch(<span style="color:#a5d6ff">`/api/users/</span><span style="color:#a5d6ff">${</span>id<span style="color:#a5d6ff">}</span><span style="color:#a5d6ff">`</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#ff7b72">return</span> response.json()
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">const</span> users <span style="color:#ff7b72;font-weight:bold">=</span> <span style="color:#ff7b72">await</span> processItemsInParallel(userIds, fetchUser)
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">return</span> users
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="2-ç€¡é“æ¨¡å¼">2. ç€¡é“æ¨¡å¼<a hidden class="anchor" aria-hidden="true" href="#2-ç€¡é“æ¨¡å¼">#</a></h3>
<div class="highlight"><div style="color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">44
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#8b949e;font-style:italic">// å¼‚æ­¥ç®¡é“
</span></span></span><span style="display:flex;"><span><span style="color:#8b949e;font-style:italic"></span><span style="color:#ff7b72">class</span> AsyncPipeline {
</span></span><span style="display:flex;"><span>  constructor() {
</span></span><span style="display:flex;"><span>    <span style="color:#ff7b72">this</span>.steps <span style="color:#ff7b72;font-weight:bold">=</span> []
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  step(fn) {
</span></span><span style="display:flex;"><span>    <span style="color:#ff7b72">this</span>.steps.push(fn)
</span></span><span style="display:flex;"><span>    <span style="color:#ff7b72">return</span> <span style="color:#ff7b72">this</span>
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">async</span> execute(data) {
</span></span><span style="display:flex;"><span>    <span style="color:#ff7b72">let</span> result <span style="color:#ff7b72;font-weight:bold">=</span> data
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff7b72">for</span> (<span style="color:#ff7b72">const</span> step <span style="color:#ff7b72">of</span> <span style="color:#ff7b72">this</span>.steps) {
</span></span><span style="display:flex;"><span>      result <span style="color:#ff7b72;font-weight:bold">=</span> <span style="color:#ff7b72">await</span> step(result)
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff7b72">return</span> result
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8b949e;font-style:italic">// ä½¿ç”¨ç¤ºä¾‹
</span></span></span><span style="display:flex;"><span><span style="color:#8b949e;font-style:italic"></span><span style="color:#ff7b72">const</span> pipeline <span style="color:#ff7b72;font-weight:bold">=</span> <span style="color:#ff7b72">new</span> AsyncPipeline()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>pipeline
</span></span><span style="display:flex;"><span>  .step(<span style="color:#ff7b72">async</span> (data) =&gt; {
</span></span><span style="display:flex;"><span>    console.log(<span style="color:#a5d6ff">&#39;Step 1: Data validation&#39;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#ff7b72">if</span> (<span style="color:#ff7b72;font-weight:bold">!</span>data.id) {
</span></span><span style="display:flex;"><span>      <span style="color:#ff7b72">throw</span> <span style="color:#ff7b72">new</span> Error(<span style="color:#a5d6ff">&#39;ID is required&#39;</span>)
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#ff7b72">return</span> { ...data, validated<span style="color:#ff7b72;font-weight:bold">:</span> <span style="color:#79c0ff">true</span> }
</span></span><span style="display:flex;"><span>  })
</span></span><span style="display:flex;"><span>  .step(<span style="color:#ff7b72">async</span> (data) =&gt; {
</span></span><span style="display:flex;"><span>    console.log(<span style="color:#a5d6ff">&#39;Step 2: Data transformation&#39;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#ff7b72">return</span> { ...data, transformed<span style="color:#ff7b72;font-weight:bold">:</span> <span style="color:#79c0ff">true</span> }
</span></span><span style="display:flex;"><span>  })
</span></span><span style="display:flex;"><span>  .step(<span style="color:#ff7b72">async</span> (data) =&gt; {
</span></span><span style="display:flex;"><span>    console.log(<span style="color:#a5d6ff">&#39;Step 3: Data saving&#39;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#ff7b72">await</span> saveData(data)
</span></span><span style="display:flex;"><span>    <span style="color:#ff7b72">return</span> { ...data, saved<span style="color:#ff7b72;font-weight:bold">:</span> <span style="color:#79c0ff">true</span> }
</span></span><span style="display:flex;"><span>  })
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff7b72">const</span> result <span style="color:#ff7b72;font-weight:bold">=</span> <span style="color:#ff7b72">await</span> pipeline.execute({ id<span style="color:#ff7b72;font-weight:bold">:</span> <span style="color:#a5d6ff">1</span>, name<span style="color:#ff7b72;font-weight:bold">:</span> <span style="color:#a5d6ff">&#39;Test&#39;</span> })
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="3-å‘å¸ƒè®¢é˜…æ¨¡å¼">3. å‘å¸ƒè®¢é˜…æ¨¡å¼<a hidden class="anchor" aria-hidden="true" href="#3-å‘å¸ƒè®¢é˜…æ¨¡å¼">#</a></h3>
<div class="highlight"><div style="color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">56
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">57
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">58
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">59
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">60
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">61
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">62
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">63
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">64
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#8b949e;font-style:italic">// å¼‚æ­¥äº‹ä»¶å‘å°„å™¨
</span></span></span><span style="display:flex;"><span><span style="color:#8b949e;font-style:italic"></span><span style="color:#ff7b72">class</span> AsyncEventEmitter {
</span></span><span style="display:flex;"><span>  constructor() {
</span></span><span style="display:flex;"><span>    <span style="color:#ff7b72">this</span>.listeners <span style="color:#ff7b72;font-weight:bold">=</span> <span style="color:#ff7b72">new</span> Map()
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  on(event, listener) {
</span></span><span style="display:flex;"><span>    <span style="color:#ff7b72">if</span> (<span style="color:#ff7b72;font-weight:bold">!</span><span style="color:#ff7b72">this</span>.listeners.has(event)) {
</span></span><span style="display:flex;"><span>      <span style="color:#ff7b72">this</span>.listeners.set(event, [])
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#ff7b72">this</span>.listeners.get(event).push(listener)
</span></span><span style="display:flex;"><span>    <span style="color:#ff7b72">return</span> <span style="color:#ff7b72">this</span>
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  off(event, listener) {
</span></span><span style="display:flex;"><span>    <span style="color:#ff7b72">if</span> (<span style="color:#ff7b72">this</span>.listeners.has(event)) {
</span></span><span style="display:flex;"><span>      <span style="color:#ff7b72">const</span> listeners <span style="color:#ff7b72;font-weight:bold">=</span> <span style="color:#ff7b72">this</span>.listeners.get(event)
</span></span><span style="display:flex;"><span>      <span style="color:#ff7b72">const</span> index <span style="color:#ff7b72;font-weight:bold">=</span> listeners.indexOf(listener)
</span></span><span style="display:flex;"><span>      <span style="color:#ff7b72">if</span> (index <span style="color:#ff7b72;font-weight:bold">!==</span> <span style="color:#ff7b72;font-weight:bold">-</span><span style="color:#a5d6ff">1</span>) {
</span></span><span style="display:flex;"><span>        listeners.splice(index, <span style="color:#a5d6ff">1</span>)
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#ff7b72">return</span> <span style="color:#ff7b72">this</span>
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">async</span> emit(event, ...args) {
</span></span><span style="display:flex;"><span>    <span style="color:#ff7b72">if</span> (<span style="color:#ff7b72;font-weight:bold">!</span><span style="color:#ff7b72">this</span>.listeners.has(event)) {
</span></span><span style="display:flex;"><span>      <span style="color:#ff7b72">return</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff7b72">const</span> listeners <span style="color:#ff7b72;font-weight:bold">=</span> <span style="color:#ff7b72">this</span>.listeners.get(event)
</span></span><span style="display:flex;"><span>    <span style="color:#ff7b72">const</span> promises <span style="color:#ff7b72;font-weight:bold">=</span> listeners.map(listener =&gt;
</span></span><span style="display:flex;"><span>      Promise.resolve(listener(...args))
</span></span><span style="display:flex;"><span>    )
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff7b72">await</span> Promise.all(promises)
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">async</span> emitSeries(event, ...args) {
</span></span><span style="display:flex;"><span>    <span style="color:#ff7b72">if</span> (<span style="color:#ff7b72;font-weight:bold">!</span><span style="color:#ff7b72">this</span>.listeners.has(event)) {
</span></span><span style="display:flex;"><span>      <span style="color:#ff7b72">return</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff7b72">const</span> listeners <span style="color:#ff7b72;font-weight:bold">=</span> <span style="color:#ff7b72">this</span>.listeners.get(event)
</span></span><span style="display:flex;"><span>    <span style="color:#ff7b72">for</span> (<span style="color:#ff7b72">const</span> listener <span style="color:#ff7b72">of</span> listeners) {
</span></span><span style="display:flex;"><span>      <span style="color:#ff7b72">await</span> Promise.resolve(listener(...args))
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8b949e;font-style:italic">// ä½¿ç”¨ç¤ºä¾‹
</span></span></span><span style="display:flex;"><span><span style="color:#8b949e;font-style:italic"></span><span style="color:#ff7b72">const</span> emitter <span style="color:#ff7b72;font-weight:bold">=</span> <span style="color:#ff7b72">new</span> AsyncEventEmitter()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>emitter.on(<span style="color:#a5d6ff">&#39;data&#39;</span>, <span style="color:#ff7b72">async</span> (data) =&gt; {
</span></span><span style="display:flex;"><span>  console.log(<span style="color:#a5d6ff">&#39;Listener 1 received data:&#39;</span>, data)
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">await</span> processData(data)
</span></span><span style="display:flex;"><span>})
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>emitter.on(<span style="color:#a5d6ff">&#39;data&#39;</span>, <span style="color:#ff7b72">async</span> (data) =&gt; {
</span></span><span style="display:flex;"><span>  console.log(<span style="color:#a5d6ff">&#39;Listener 2 received data:&#39;</span>, data)
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">await</span> saveData(data)
</span></span><span style="display:flex;"><span>})
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff7b72">await</span> emitter.emit(<span style="color:#a5d6ff">&#39;data&#39;</span>, { id<span style="color:#ff7b72;font-weight:bold">:</span> <span style="color:#a5d6ff">1</span>, name<span style="color:#ff7b72;font-weight:bold">:</span> <span style="color:#a5d6ff">&#39;Test&#39;</span> })
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="å¼‚æ­¥æ¨¡å¼åœ¨reactä¸­çš„åº”ç”¨">å¼‚æ­¥æ¨¡å¼åœ¨Reactä¸­çš„åº”ç”¨<a hidden class="anchor" aria-hidden="true" href="#å¼‚æ­¥æ¨¡å¼åœ¨reactä¸­çš„åº”ç”¨">#</a></h2>
<h3 id="1-æ•°æ®è·å–hook">1. æ•°æ®è·å–Hook<a hidden class="anchor" aria-hidden="true" href="#1-æ•°æ®è·å–hook">#</a></h3>
<div class="highlight"><div style="color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">50
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#ff7b72">import</span> { useState, useEffect, useCallback } from <span style="color:#a5d6ff">&#39;react&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8b949e;font-style:italic">// è‡ªå®šä¹‰æ•°æ®è·å–Hook
</span></span></span><span style="display:flex;"><span><span style="color:#8b949e;font-style:italic"></span><span style="color:#ff7b72">function</span> useApi(url, options <span style="color:#ff7b72;font-weight:bold">=</span> {}) {
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">const</span> [data, setData] <span style="color:#ff7b72;font-weight:bold">=</span> useState(<span style="color:#79c0ff">null</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">const</span> [loading, setLoading] <span style="color:#ff7b72;font-weight:bold">=</span> useState(<span style="color:#79c0ff">true</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">const</span> [error, setError] <span style="color:#ff7b72;font-weight:bold">=</span> useState(<span style="color:#79c0ff">null</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">const</span> fetchData <span style="color:#ff7b72;font-weight:bold">=</span> useCallback(<span style="color:#ff7b72">async</span> () =&gt; {
</span></span><span style="display:flex;"><span>    <span style="color:#ff7b72">try</span> {
</span></span><span style="display:flex;"><span>      setLoading(<span style="color:#79c0ff">true</span>)
</span></span><span style="display:flex;"><span>      setError(<span style="color:#79c0ff">null</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      <span style="color:#ff7b72">const</span> response <span style="color:#ff7b72;font-weight:bold">=</span> <span style="color:#ff7b72">await</span> fetch(url, options)
</span></span><span style="display:flex;"><span>      <span style="color:#ff7b72">if</span> (<span style="color:#ff7b72;font-weight:bold">!</span>response.ok) {
</span></span><span style="display:flex;"><span>        <span style="color:#ff7b72">throw</span> <span style="color:#ff7b72">new</span> Error(<span style="color:#a5d6ff">`HTTP error! status: </span><span style="color:#a5d6ff">${</span>response.status<span style="color:#a5d6ff">}</span><span style="color:#a5d6ff">`</span>)
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      <span style="color:#ff7b72">const</span> result <span style="color:#ff7b72;font-weight:bold">=</span> <span style="color:#ff7b72">await</span> response.json()
</span></span><span style="display:flex;"><span>      setData(result)
</span></span><span style="display:flex;"><span>    } <span style="color:#ff7b72">catch</span> (err) {
</span></span><span style="display:flex;"><span>      setError(err.message)
</span></span><span style="display:flex;"><span>    } <span style="color:#ff7b72">finally</span> {
</span></span><span style="display:flex;"><span>      setLoading(<span style="color:#79c0ff">false</span>)
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }, [url, options])
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  useEffect(() =&gt; {
</span></span><span style="display:flex;"><span>    fetchData()
</span></span><span style="display:flex;"><span>  }, [fetchData])
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">return</span> { data, loading, error, refetch<span style="color:#ff7b72;font-weight:bold">:</span> fetchData }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8b949e;font-style:italic">// ä½¿ç”¨ç¤ºä¾‹
</span></span></span><span style="display:flex;"><span><span style="color:#8b949e;font-style:italic"></span><span style="color:#ff7b72">function</span> UserProfile({ userId }) {
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">const</span> { data<span style="color:#ff7b72;font-weight:bold">:</span> user, loading, error, refetch } <span style="color:#ff7b72;font-weight:bold">=</span> useApi(<span style="color:#a5d6ff">`/api/users/</span><span style="color:#a5d6ff">${</span>userId<span style="color:#a5d6ff">}</span><span style="color:#a5d6ff">`</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">if</span> (loading) <span style="color:#ff7b72">return</span> <span style="color:#ff7b72;font-weight:bold">&lt;</span>div<span style="color:#ff7b72;font-weight:bold">&gt;</span>Loading...<span style="color:#ff7b72;font-weight:bold">&lt;</span><span style="color:#f85149">/div&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">if</span> (error) <span style="color:#ff7b72">return</span> <span style="color:#ff7b72;font-weight:bold">&lt;</span>div<span style="color:#ff7b72;font-weight:bold">&gt;</span>Error<span style="color:#ff7b72;font-weight:bold">:</span> {error}<span style="color:#ff7b72;font-weight:bold">&lt;</span><span style="color:#f85149">/div&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">if</span> (<span style="color:#ff7b72;font-weight:bold">!</span>user) <span style="color:#ff7b72">return</span> <span style="color:#ff7b72;font-weight:bold">&lt;</span>div<span style="color:#ff7b72;font-weight:bold">&gt;</span>No user found<span style="color:#ff7b72;font-weight:bold">&lt;</span><span style="color:#f85149">/div&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">return</span> (
</span></span><span style="display:flex;"><span>    <span style="color:#ff7b72;font-weight:bold">&lt;</span>div<span style="color:#ff7b72;font-weight:bold">&gt;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#ff7b72;font-weight:bold">&lt;</span>h1<span style="color:#ff7b72;font-weight:bold">&gt;</span>{user.name}<span style="color:#ff7b72;font-weight:bold">&lt;</span><span style="color:#f85149">/h1&gt;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#ff7b72;font-weight:bold">&lt;</span>p<span style="color:#ff7b72;font-weight:bold">&gt;</span>{user.email}<span style="color:#ff7b72;font-weight:bold">&lt;</span><span style="color:#f85149">/p&gt;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#ff7b72;font-weight:bold">&lt;</span>button onClick<span style="color:#ff7b72;font-weight:bold">=</span>{refetch}<span style="color:#ff7b72;font-weight:bold">&gt;</span>Refresh<span style="color:#ff7b72;font-weight:bold">&lt;</span><span style="color:#f85149">/button&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff7b72;font-weight:bold">&lt;</span><span style="color:#f85149">/div&gt;</span>
</span></span><span style="display:flex;"><span>  )
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="2-è¡¨å•æäº¤å¤„ç†">2. è¡¨å•æäº¤å¤„ç†<a hidden class="anchor" aria-hidden="true" href="#2-è¡¨å•æäº¤å¤„ç†">#</a></h3>
<div class="highlight"><div style="color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">  1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">  2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">  3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">  4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">  5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">  6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">  7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">  8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">  9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 56
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 57
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 58
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 59
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 60
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 61
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 62
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 63
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 64
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 65
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 66
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 67
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 68
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 69
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 70
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 71
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 72
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 73
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 74
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 75
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 76
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 77
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 78
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 79
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 80
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 81
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 82
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 83
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 84
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 85
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 86
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 87
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 88
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 89
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 90
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 91
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 92
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 93
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 94
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 95
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 96
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 97
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 98
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 99
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">100
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">101
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">102
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">103
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">104
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">105
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">106
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">107
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">108
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">109
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">110
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">111
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">112
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">113
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">114
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">115
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">116
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">117
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#ff7b72">import</span> { useState } from <span style="color:#a5d6ff">&#39;react&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff7b72">function</span> useAsyncForm(initialValues, submitHandler) {
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">const</span> [values, setValues] <span style="color:#ff7b72;font-weight:bold">=</span> useState(initialValues)
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">const</span> [errors, setErrors] <span style="color:#ff7b72;font-weight:bold">=</span> useState({})
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">const</span> [isSubmitting, setIsSubmitting] <span style="color:#ff7b72;font-weight:bold">=</span> useState(<span style="color:#79c0ff">false</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">const</span> handleChange <span style="color:#ff7b72;font-weight:bold">=</span> useCallback((e) =&gt; {
</span></span><span style="display:flex;"><span>    <span style="color:#ff7b72">const</span> { name, value, type, checked } <span style="color:#ff7b72;font-weight:bold">=</span> e.target
</span></span><span style="display:flex;"><span>    <span style="color:#ff7b72">const</span> fieldValue <span style="color:#ff7b72;font-weight:bold">=</span> type <span style="color:#ff7b72;font-weight:bold">===</span> <span style="color:#a5d6ff">&#39;checkbox&#39;</span> <span style="color:#ff7b72;font-weight:bold">?</span> checked <span style="color:#ff7b72;font-weight:bold">:</span> value
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    setValues(prev =&gt; ({
</span></span><span style="display:flex;"><span>      ...prev,
</span></span><span style="display:flex;"><span>      [name]<span style="color:#ff7b72;font-weight:bold">:</span> fieldValue
</span></span><span style="display:flex;"><span>    }))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff7b72">if</span> (errors[name]) {
</span></span><span style="display:flex;"><span>      setErrors(prev =&gt; ({
</span></span><span style="display:flex;"><span>        ...prev,
</span></span><span style="display:flex;"><span>        [name]<span style="color:#ff7b72;font-weight:bold">:</span> <span style="color:#a5d6ff">&#39;&#39;</span>
</span></span><span style="display:flex;"><span>      }))
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }, [errors])
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">const</span> handleSubmit <span style="color:#ff7b72;font-weight:bold">=</span> useCallback(<span style="color:#ff7b72">async</span> (e) =&gt; {
</span></span><span style="display:flex;"><span>    e.preventDefault()
</span></span><span style="display:flex;"><span>    setIsSubmitting(<span style="color:#79c0ff">true</span>)
</span></span><span style="display:flex;"><span>    setErrors({})
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff7b72">try</span> {
</span></span><span style="display:flex;"><span>      <span style="color:#ff7b72">await</span> submitHandler(values)
</span></span><span style="display:flex;"><span>    } <span style="color:#ff7b72">catch</span> (error) {
</span></span><span style="display:flex;"><span>      <span style="color:#ff7b72">if</span> (error.validationErrors) {
</span></span><span style="display:flex;"><span>        setErrors(error.validationErrors)
</span></span><span style="display:flex;"><span>      } <span style="color:#ff7b72">else</span> {
</span></span><span style="display:flex;"><span>        console.error(<span style="color:#a5d6ff">&#39;Submit error:&#39;</span>, error)
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    } <span style="color:#ff7b72">finally</span> {
</span></span><span style="display:flex;"><span>      setIsSubmitting(<span style="color:#79c0ff">false</span>)
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }, [values, submitHandler])
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">const</span> reset <span style="color:#ff7b72;font-weight:bold">=</span> useCallback(() =&gt; {
</span></span><span style="display:flex;"><span>    setValues(initialValues)
</span></span><span style="display:flex;"><span>    setErrors({})
</span></span><span style="display:flex;"><span>    setIsSubmitting(<span style="color:#79c0ff">false</span>)
</span></span><span style="display:flex;"><span>  }, [initialValues])
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">return</span> {
</span></span><span style="display:flex;"><span>    values,
</span></span><span style="display:flex;"><span>    errors,
</span></span><span style="display:flex;"><span>    isSubmitting,
</span></span><span style="display:flex;"><span>    handleChange,
</span></span><span style="display:flex;"><span>    handleSubmit,
</span></span><span style="display:flex;"><span>    reset
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8b949e;font-style:italic">// ä½¿ç”¨ç¤ºä¾‹
</span></span></span><span style="display:flex;"><span><span style="color:#8b949e;font-style:italic"></span><span style="color:#ff7b72">function</span> UserForm() {
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">const</span> submitHandler <span style="color:#ff7b72;font-weight:bold">=</span> <span style="color:#ff7b72">async</span> (values) =&gt; {
</span></span><span style="display:flex;"><span>    <span style="color:#ff7b72">const</span> response <span style="color:#ff7b72;font-weight:bold">=</span> <span style="color:#ff7b72">await</span> fetch(<span style="color:#a5d6ff">&#39;/api/users&#39;</span>, {
</span></span><span style="display:flex;"><span>      method<span style="color:#ff7b72;font-weight:bold">:</span> <span style="color:#a5d6ff">&#39;POST&#39;</span>,
</span></span><span style="display:flex;"><span>      headers<span style="color:#ff7b72;font-weight:bold">:</span> { <span style="color:#a5d6ff">&#39;Content-Type&#39;</span><span style="color:#ff7b72;font-weight:bold">:</span> <span style="color:#a5d6ff">&#39;application/json&#39;</span> },
</span></span><span style="display:flex;"><span>      body<span style="color:#ff7b72;font-weight:bold">:</span> JSON.stringify(values),
</span></span><span style="display:flex;"><span>    })
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff7b72">if</span> (<span style="color:#ff7b72;font-weight:bold">!</span>response.ok) {
</span></span><span style="display:flex;"><span>      <span style="color:#ff7b72">const</span> error <span style="color:#ff7b72;font-weight:bold">=</span> <span style="color:#ff7b72">await</span> response.json()
</span></span><span style="display:flex;"><span>      <span style="color:#ff7b72">throw</span> <span style="color:#ff7b72">new</span> Error(error.message <span style="color:#ff7b72;font-weight:bold">||</span> <span style="color:#a5d6ff">&#39;Submit failed&#39;</span>)
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff7b72">return</span> response.json()
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">const</span> {
</span></span><span style="display:flex;"><span>    values,
</span></span><span style="display:flex;"><span>    errors,
</span></span><span style="display:flex;"><span>    isSubmitting,
</span></span><span style="display:flex;"><span>    handleChange,
</span></span><span style="display:flex;"><span>    handleSubmit,
</span></span><span style="display:flex;"><span>    reset
</span></span><span style="display:flex;"><span>  } <span style="color:#ff7b72;font-weight:bold">=</span> useAsyncForm({ name<span style="color:#ff7b72;font-weight:bold">:</span> <span style="color:#a5d6ff">&#39;&#39;</span>, email<span style="color:#ff7b72;font-weight:bold">:</span> <span style="color:#a5d6ff">&#39;&#39;</span> }, submitHandler)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">return</span> (
</span></span><span style="display:flex;"><span>    <span style="color:#ff7b72;font-weight:bold">&lt;</span>form onSubmit<span style="color:#ff7b72;font-weight:bold">=</span>{handleSubmit}<span style="color:#ff7b72;font-weight:bold">&gt;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#ff7b72;font-weight:bold">&lt;</span>div<span style="color:#ff7b72;font-weight:bold">&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff7b72;font-weight:bold">&lt;</span>label<span style="color:#ff7b72;font-weight:bold">&gt;</span>Name<span style="color:#ff7b72;font-weight:bold">:&lt;</span><span style="color:#f85149">/label&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff7b72;font-weight:bold">&lt;</span>input
</span></span><span style="display:flex;"><span>          type<span style="color:#ff7b72;font-weight:bold">=</span><span style="color:#a5d6ff">&#34;text&#34;</span>
</span></span><span style="display:flex;"><span>          name<span style="color:#ff7b72;font-weight:bold">=</span><span style="color:#a5d6ff">&#34;name&#34;</span>
</span></span><span style="display:flex;"><span>          value<span style="color:#ff7b72;font-weight:bold">=</span>{values.name}
</span></span><span style="display:flex;"><span>          onChange<span style="color:#ff7b72;font-weight:bold">=</span>{handleChange}
</span></span><span style="display:flex;"><span>        <span style="color:#ff7b72;font-weight:bold">/&gt;</span>
</span></span><span style="display:flex;"><span>        {errors.name <span style="color:#ff7b72;font-weight:bold">&amp;&amp;</span> <span style="color:#ff7b72;font-weight:bold">&lt;</span>span style<span style="color:#ff7b72;font-weight:bold">=</span>{{ color<span style="color:#ff7b72;font-weight:bold">:</span> <span style="color:#a5d6ff">&#39;red&#39;</span> }}<span style="color:#ff7b72;font-weight:bold">&gt;</span>{errors.name}<span style="color:#ff7b72;font-weight:bold">&lt;</span><span style="color:#f85149">/span&gt;}</span>
</span></span><span style="display:flex;"><span>      <span style="color:#ff7b72;font-weight:bold">&lt;</span><span style="color:#f85149">/div&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      <span style="color:#ff7b72;font-weight:bold">&lt;</span>div<span style="color:#ff7b72;font-weight:bold">&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff7b72;font-weight:bold">&lt;</span>label<span style="color:#ff7b72;font-weight:bold">&gt;</span>Email<span style="color:#ff7b72;font-weight:bold">:&lt;</span><span style="color:#f85149">/label&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff7b72;font-weight:bold">&lt;</span>input
</span></span><span style="display:flex;"><span>          type<span style="color:#ff7b72;font-weight:bold">=</span><span style="color:#a5d6ff">&#34;email&#34;</span>
</span></span><span style="display:flex;"><span>          name<span style="color:#ff7b72;font-weight:bold">=</span><span style="color:#a5d6ff">&#34;email&#34;</span>
</span></span><span style="display:flex;"><span>          value<span style="color:#ff7b72;font-weight:bold">=</span>{values.email}
</span></span><span style="display:flex;"><span>          onChange<span style="color:#ff7b72;font-weight:bold">=</span>{handleChange}
</span></span><span style="display:flex;"><span>        <span style="color:#ff7b72;font-weight:bold">/&gt;</span>
</span></span><span style="display:flex;"><span>        {errors.email <span style="color:#ff7b72;font-weight:bold">&amp;&amp;</span> <span style="color:#ff7b72;font-weight:bold">&lt;</span>span style<span style="color:#ff7b72;font-weight:bold">=</span>{{ color<span style="color:#ff7b72;font-weight:bold">:</span> <span style="color:#a5d6ff">&#39;red&#39;</span> }}<span style="color:#ff7b72;font-weight:bold">&gt;</span>{errors.email}<span style="color:#ff7b72;font-weight:bold">&lt;</span><span style="color:#f85149">/span&gt;}</span>
</span></span><span style="display:flex;"><span>      <span style="color:#ff7b72;font-weight:bold">&lt;</span><span style="color:#f85149">/div&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      <span style="color:#ff7b72;font-weight:bold">&lt;</span>button type<span style="color:#ff7b72;font-weight:bold">=</span><span style="color:#a5d6ff">&#34;submit&#34;</span> disabled<span style="color:#ff7b72;font-weight:bold">=</span>{isSubmitting}<span style="color:#ff7b72;font-weight:bold">&gt;</span>
</span></span><span style="display:flex;"><span>        {isSubmitting <span style="color:#ff7b72;font-weight:bold">?</span> <span style="color:#a5d6ff">&#39;Submitting...&#39;</span> <span style="color:#ff7b72;font-weight:bold">:</span> <span style="color:#a5d6ff">&#39;Submit&#39;</span>}
</span></span><span style="display:flex;"><span>      <span style="color:#ff7b72;font-weight:bold">&lt;</span><span style="color:#f85149">/button&gt;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#ff7b72;font-weight:bold">&lt;</span>button type<span style="color:#ff7b72;font-weight:bold">=</span><span style="color:#a5d6ff">&#34;button&#34;</span> onClick<span style="color:#ff7b72;font-weight:bold">=</span>{reset}<span style="color:#ff7b72;font-weight:bold">&gt;</span>
</span></span><span style="display:flex;"><span>        Reset
</span></span><span style="display:flex;"><span>      <span style="color:#ff7b72;font-weight:bold">&lt;</span><span style="color:#f85149">/button&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff7b72;font-weight:bold">&lt;</span><span style="color:#f85149">/form&gt;</span>
</span></span><span style="display:flex;"><span>  )
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="æ€§èƒ½ä¼˜åŒ–æŠ€å·§">æ€§èƒ½ä¼˜åŒ–æŠ€å·§<a hidden class="anchor" aria-hidden="true" href="#æ€§èƒ½ä¼˜åŒ–æŠ€å·§">#</a></h2>
<h3 id="1-è¯·æ±‚ç¼“å­˜">1. è¯·æ±‚ç¼“å­˜<a hidden class="anchor" aria-hidden="true" href="#1-è¯·æ±‚ç¼“å­˜">#</a></h3>
<div class="highlight"><div style="color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">56
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">57
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">58
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">59
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">60
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">61
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">62
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">63
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">64
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">65
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#8b949e;font-style:italic">// ç®€å•çš„å†…å­˜ç¼“å­˜
</span></span></span><span style="display:flex;"><span><span style="color:#8b949e;font-style:italic"></span><span style="color:#ff7b72">class</span> Cache {
</span></span><span style="display:flex;"><span>  constructor(ttl <span style="color:#ff7b72;font-weight:bold">=</span> <span style="color:#a5d6ff">5</span> <span style="color:#ff7b72;font-weight:bold">*</span> <span style="color:#a5d6ff">60</span> <span style="color:#ff7b72;font-weight:bold">*</span> <span style="color:#a5d6ff">1000</span>) { <span style="color:#8b949e;font-style:italic">// 5åˆ†é’ŸTTL
</span></span></span><span style="display:flex;"><span><span style="color:#8b949e;font-style:italic"></span>    <span style="color:#ff7b72">this</span>.cache <span style="color:#ff7b72;font-weight:bold">=</span> <span style="color:#ff7b72">new</span> Map()
</span></span><span style="display:flex;"><span>    <span style="color:#ff7b72">this</span>.ttl <span style="color:#ff7b72;font-weight:bold">=</span> ttl
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  set(key, value) {
</span></span><span style="display:flex;"><span>    <span style="color:#ff7b72">this</span>.cache.set(key, {
</span></span><span style="display:flex;"><span>      value,
</span></span><span style="display:flex;"><span>      timestamp<span style="color:#ff7b72;font-weight:bold">:</span> Date.now()
</span></span><span style="display:flex;"><span>    })
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  get(key) {
</span></span><span style="display:flex;"><span>    <span style="color:#ff7b72">const</span> item <span style="color:#ff7b72;font-weight:bold">=</span> <span style="color:#ff7b72">this</span>.cache.get(key)
</span></span><span style="display:flex;"><span>    <span style="color:#ff7b72">if</span> (<span style="color:#ff7b72;font-weight:bold">!</span>item) {
</span></span><span style="display:flex;"><span>      <span style="color:#ff7b72">return</span> <span style="color:#79c0ff">null</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff7b72">if</span> (Date.now() <span style="color:#ff7b72;font-weight:bold">-</span> item.timestamp <span style="color:#ff7b72;font-weight:bold">&gt;</span> <span style="color:#ff7b72">this</span>.ttl) {
</span></span><span style="display:flex;"><span>      <span style="color:#ff7b72">this</span>.cache.<span style="color:#ff7b72">delete</span>(key)
</span></span><span style="display:flex;"><span>      <span style="color:#ff7b72">return</span> <span style="color:#79c0ff">null</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff7b72">return</span> item.value
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  clear() {
</span></span><span style="display:flex;"><span>    <span style="color:#ff7b72">this</span>.cache.clear()
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8b949e;font-style:italic">// å¸¦ç¼“å­˜çš„APIå®¢æˆ·ç«¯
</span></span></span><span style="display:flex;"><span><span style="color:#8b949e;font-style:italic"></span><span style="color:#ff7b72">class</span> CachedApiClient {
</span></span><span style="display:flex;"><span>  constructor() {
</span></span><span style="display:flex;"><span>    <span style="color:#ff7b72">this</span>.cache <span style="color:#ff7b72;font-weight:bold">=</span> <span style="color:#ff7b72">new</span> Cache()
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">async</span> get(url, options <span style="color:#ff7b72;font-weight:bold">=</span> {}) {
</span></span><span style="display:flex;"><span>    <span style="color:#ff7b72">const</span> cacheKey <span style="color:#ff7b72;font-weight:bold">=</span> <span style="color:#a5d6ff">`</span><span style="color:#a5d6ff">${</span>url<span style="color:#a5d6ff">}</span><span style="color:#a5d6ff">:</span><span style="color:#a5d6ff">${</span>JSON.stringify(options)<span style="color:#a5d6ff">}</span><span style="color:#a5d6ff">`</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff7b72">const</span> cachedData <span style="color:#ff7b72;font-weight:bold">=</span> <span style="color:#ff7b72">this</span>.cache.get(cacheKey)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff7b72">if</span> (cachedData) {
</span></span><span style="display:flex;"><span>      console.log(<span style="color:#a5d6ff">&#39;Returning cached data for:&#39;</span>, url)
</span></span><span style="display:flex;"><span>      <span style="color:#ff7b72">return</span> cachedData
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    console.log(<span style="color:#a5d6ff">&#39;Fetching fresh data for:&#39;</span>, url)
</span></span><span style="display:flex;"><span>    <span style="color:#ff7b72">const</span> response <span style="color:#ff7b72;font-weight:bold">=</span> <span style="color:#ff7b72">await</span> fetch(url, options)
</span></span><span style="display:flex;"><span>    <span style="color:#ff7b72">const</span> data <span style="color:#ff7b72;font-weight:bold">=</span> <span style="color:#ff7b72">await</span> response.json()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff7b72">this</span>.cache.set(cacheKey, data)
</span></span><span style="display:flex;"><span>    <span style="color:#ff7b72">return</span> data
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8b949e;font-style:italic">// ä½¿ç”¨ç¤ºä¾‹
</span></span></span><span style="display:flex;"><span><span style="color:#8b949e;font-style:italic"></span><span style="color:#ff7b72">const</span> apiClient <span style="color:#ff7b72;font-weight:bold">=</span> <span style="color:#ff7b72">new</span> CachedApiClient()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8b949e;font-style:italic">// ç¬¬ä¸€æ¬¡è¯·æ±‚ - å‘é€ç½‘ç»œè¯·æ±‚
</span></span></span><span style="display:flex;"><span><span style="color:#8b949e;font-style:italic"></span><span style="color:#ff7b72">const</span> data1 <span style="color:#ff7b72;font-weight:bold">=</span> <span style="color:#ff7b72">await</span> apiClient.get(<span style="color:#a5d6ff">&#39;/api/users&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8b949e;font-style:italic">// ç¬¬äºŒæ¬¡è¯·æ±‚ - è¿”å›ç¼“å­˜æ•°æ®
</span></span></span><span style="display:flex;"><span><span style="color:#8b949e;font-style:italic"></span><span style="color:#ff7b72">const</span> data2 <span style="color:#ff7b72;font-weight:bold">=</span> <span style="color:#ff7b72">await</span> apiClient.get(<span style="color:#a5d6ff">&#39;/api/users&#39;</span>)
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="2-è¯·æ±‚å»é‡">2. è¯·æ±‚å»é‡<a hidden class="anchor" aria-hidden="true" href="#2-è¯·æ±‚å»é‡">#</a></h3>
<div class="highlight"><div style="color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">56
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">57
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">58
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">59
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">60
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">61
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#8b949e;font-style:italic">// é˜²æŠ–å’ŒèŠ‚æµ
</span></span></span><span style="display:flex;"><span><span style="color:#8b949e;font-style:italic"></span><span style="color:#ff7b72">function</span> debounce(func, delay) {
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">let</span> timeoutId
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">return</span> <span style="color:#ff7b72">function</span>(...args) {
</span></span><span style="display:flex;"><span>    clearTimeout(timeoutId)
</span></span><span style="display:flex;"><span>    timeoutId <span style="color:#ff7b72;font-weight:bold">=</span> setTimeout(() =&gt; func.apply(<span style="color:#ff7b72">this</span>, args), delay)
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff7b72">function</span> throttle(func, delay) {
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">let</span> lastCall <span style="color:#ff7b72;font-weight:bold">=</span> <span style="color:#a5d6ff">0</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">return</span> <span style="color:#ff7b72">function</span>(...args) {
</span></span><span style="display:flex;"><span>    <span style="color:#ff7b72">const</span> now <span style="color:#ff7b72;font-weight:bold">=</span> Date.now()
</span></span><span style="display:flex;"><span>    <span style="color:#ff7b72">if</span> (now <span style="color:#ff7b72;font-weight:bold">-</span> lastCall <span style="color:#ff7b72;font-weight:bold">&gt;=</span> delay) {
</span></span><span style="display:flex;"><span>      lastCall <span style="color:#ff7b72;font-weight:bold">=</span> now
</span></span><span style="display:flex;"><span>      <span style="color:#ff7b72">return</span> func.apply(<span style="color:#ff7b72">this</span>, args)
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8b949e;font-style:italic">// è¯·æ±‚å»é‡å™¨
</span></span></span><span style="display:flex;"><span><span style="color:#8b949e;font-style:italic"></span><span style="color:#ff7b72">class</span> RequestDeduplicator {
</span></span><span style="display:flex;"><span>  constructor() {
</span></span><span style="display:flex;"><span>    <span style="color:#ff7b72">this</span>.pendingRequests <span style="color:#ff7b72;font-weight:bold">=</span> <span style="color:#ff7b72">new</span> Map()
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">async</span> deduplicate(key, requestFn) {
</span></span><span style="display:flex;"><span>    <span style="color:#ff7b72">if</span> (<span style="color:#ff7b72">this</span>.pendingRequests.has(key)) {
</span></span><span style="display:flex;"><span>      <span style="color:#ff7b72">return</span> <span style="color:#ff7b72">this</span>.pendingRequests.get(key)
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff7b72">const</span> promise <span style="color:#ff7b72;font-weight:bold">=</span> requestFn()
</span></span><span style="display:flex;"><span>      .<span style="color:#ff7b72">finally</span>(() =&gt; {
</span></span><span style="display:flex;"><span>        <span style="color:#ff7b72">this</span>.pendingRequests.<span style="color:#ff7b72">delete</span>(key)
</span></span><span style="display:flex;"><span>      })
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff7b72">this</span>.pendingRequests.set(key, promise)
</span></span><span style="display:flex;"><span>    <span style="color:#ff7b72">return</span> promise
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8b949e;font-style:italic">// ä½¿ç”¨ç¤ºä¾‹
</span></span></span><span style="display:flex;"><span><span style="color:#8b949e;font-style:italic"></span><span style="color:#ff7b72">const</span> deduplicator <span style="color:#ff7b72;font-weight:bold">=</span> <span style="color:#ff7b72">new</span> RequestDeduplicator()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff7b72">async</span> <span style="color:#ff7b72">function</span> fetchUserData(userId) {
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">return</span> deduplicator.deduplicate(<span style="color:#a5d6ff">`user:</span><span style="color:#a5d6ff">${</span>userId<span style="color:#a5d6ff">}</span><span style="color:#a5d6ff">`</span>, <span style="color:#ff7b72">async</span> () =&gt; {
</span></span><span style="display:flex;"><span>    <span style="color:#ff7b72">const</span> response <span style="color:#ff7b72;font-weight:bold">=</span> <span style="color:#ff7b72">await</span> fetch(<span style="color:#a5d6ff">`/api/users/</span><span style="color:#a5d6ff">${</span>userId<span style="color:#a5d6ff">}</span><span style="color:#a5d6ff">`</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#ff7b72">return</span> response.json()
</span></span><span style="display:flex;"><span>  })
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8b949e;font-style:italic">// é˜²æŠ–æœç´¢
</span></span></span><span style="display:flex;"><span><span style="color:#8b949e;font-style:italic"></span><span style="color:#ff7b72">const</span> debouncedSearch <span style="color:#ff7b72;font-weight:bold">=</span> debounce(<span style="color:#ff7b72">async</span> (query) =&gt; {
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">const</span> response <span style="color:#ff7b72;font-weight:bold">=</span> <span style="color:#ff7b72">await</span> fetch(<span style="color:#a5d6ff">`/api/search?q=</span><span style="color:#a5d6ff">${</span>query<span style="color:#a5d6ff">}</span><span style="color:#a5d6ff">`</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">return</span> response.json()
</span></span><span style="display:flex;"><span>}, <span style="color:#a5d6ff">300</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8b949e;font-style:italic">// èŠ‚æµæ»šåŠ¨å¤„ç†
</span></span></span><span style="display:flex;"><span><span style="color:#8b949e;font-style:italic"></span><span style="color:#ff7b72">const</span> throttledHandleScroll <span style="color:#ff7b72;font-weight:bold">=</span> throttle((event) =&gt; {
</span></span><span style="display:flex;"><span>  console.log(<span style="color:#a5d6ff">&#39;Scroll position:&#39;</span>, event.target.scrollTop)
</span></span><span style="display:flex;"><span>}, <span style="color:#a5d6ff">100</span>)
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="æµ‹è¯•å¼‚æ­¥ä»£ç ">æµ‹è¯•å¼‚æ­¥ä»£ç <a hidden class="anchor" aria-hidden="true" href="#æµ‹è¯•å¼‚æ­¥ä»£ç ">#</a></h2>
<h3 id="1-æµ‹è¯•promise">1. æµ‹è¯•Promise<a hidden class="anchor" aria-hidden="true" href="#1-æµ‹è¯•promise">#</a></h3>
<div class="highlight"><div style="color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">23
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#8b949e;font-style:italic">// Jestæµ‹è¯•Promise
</span></span></span><span style="display:flex;"><span><span style="color:#8b949e;font-style:italic"></span><span style="color:#ff7b72">const</span> fetchData <span style="color:#ff7b72;font-weight:bold">=</span> () =&gt; {
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">return</span> <span style="color:#ff7b72">new</span> Promise(resolve =&gt; {
</span></span><span style="display:flex;"><span>    setTimeout(() =&gt; resolve(<span style="color:#a5d6ff">&#39;data&#39;</span>), <span style="color:#a5d6ff">100</span>)
</span></span><span style="display:flex;"><span>  })
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>describe(<span style="color:#a5d6ff">&#39;fetchData&#39;</span>, () =&gt; {
</span></span><span style="display:flex;"><span>  test(<span style="color:#a5d6ff">&#39;should resolve with data&#39;</span>, <span style="color:#ff7b72">async</span> () =&gt; {
</span></span><span style="display:flex;"><span>    <span style="color:#ff7b72">const</span> result <span style="color:#ff7b72;font-weight:bold">=</span> <span style="color:#ff7b72">await</span> fetchData()
</span></span><span style="display:flex;"><span>    expect(result).toBe(<span style="color:#a5d6ff">&#39;data&#39;</span>)
</span></span><span style="display:flex;"><span>  })
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  test(<span style="color:#a5d6ff">&#39;should handle rejection&#39;</span>, <span style="color:#ff7b72">async</span> () =&gt; {
</span></span><span style="display:flex;"><span>    <span style="color:#ff7b72">const</span> rejectFn <span style="color:#ff7b72;font-weight:bold">=</span> jest.fn()
</span></span><span style="display:flex;"><span>    <span style="color:#ff7b72">const</span> errorPromise <span style="color:#ff7b72;font-weight:bold">=</span> <span style="color:#ff7b72">new</span> Promise((_, reject) =&gt; {
</span></span><span style="display:flex;"><span>      rejectFn(<span style="color:#a5d6ff">&#39;error&#39;</span>)
</span></span><span style="display:flex;"><span>    })
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    expect(errorPromise).rejects.toMatch(<span style="color:#a5d6ff">&#39;error&#39;</span>)
</span></span><span style="display:flex;"><span>    expect(rejectFn).toHaveBeenCalled()
</span></span><span style="display:flex;"><span>  })
</span></span><span style="display:flex;"><span>})
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="2-æµ‹è¯•asyncawait">2. æµ‹è¯•Async/Await<a hidden class="anchor" aria-hidden="true" href="#2-æµ‹è¯•asyncawait">#</a></h3>
<div class="highlight"><div style="color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">42
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#8b949e;font-style:italic">// æµ‹è¯•å¼‚æ­¥å‡½æ•°
</span></span></span><span style="display:flex;"><span><span style="color:#8b949e;font-style:italic"></span><span style="color:#ff7b72">async</span> <span style="color:#ff7b72">function</span> processUser(userData) {
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">const</span> validatedData <span style="color:#ff7b72;font-weight:bold">=</span> <span style="color:#ff7b72">await</span> validateUser(userData)
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">const</span> savedData <span style="color:#ff7b72;font-weight:bold">=</span> <span style="color:#ff7b72">await</span> saveUser(validatedData)
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">return</span> savedData
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff7b72">const</span> mockValidateUser <span style="color:#ff7b72;font-weight:bold">=</span> jest.fn()
</span></span><span style="display:flex;"><span><span style="color:#ff7b72">const</span> mockSaveUser <span style="color:#ff7b72;font-weight:bold">=</span> jest.fn()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>jest.mock(<span style="color:#a5d6ff">&#39;./validation&#39;</span>, () =&gt; ({
</span></span><span style="display:flex;"><span>  validateUser<span style="color:#ff7b72;font-weight:bold">:</span> mockValidateUser
</span></span><span style="display:flex;"><span>}))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>jest.mock(<span style="color:#a5d6ff">&#39;./database&#39;</span>, () =&gt; ({
</span></span><span style="display:flex;"><span>  saveUser<span style="color:#ff7b72;font-weight:bold">:</span> mockSaveUser
</span></span><span style="display:flex;"><span>}))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>describe(<span style="color:#a5d6ff">&#39;processUser&#39;</span>, () =&gt; {
</span></span><span style="display:flex;"><span>  beforeEach(() =&gt; {
</span></span><span style="display:flex;"><span>    jest.clearAllMocks()
</span></span><span style="display:flex;"><span>  })
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  test(<span style="color:#a5d6ff">&#39;should process user successfully&#39;</span>, <span style="color:#ff7b72">async</span> () =&gt; {
</span></span><span style="display:flex;"><span>    <span style="color:#ff7b72">const</span> userData <span style="color:#ff7b72;font-weight:bold">=</span> { name<span style="color:#ff7b72;font-weight:bold">:</span> <span style="color:#a5d6ff">&#39;John&#39;</span>, email<span style="color:#ff7b72;font-weight:bold">:</span> <span style="color:#a5d6ff">&#39;john@example.com&#39;</span> }
</span></span><span style="display:flex;"><span>    mockValidateUser.mockResolvedValue(userData)
</span></span><span style="display:flex;"><span>    mockSaveUser.mockResolvedValue({ id<span style="color:#ff7b72;font-weight:bold">:</span> <span style="color:#a5d6ff">1</span>, ...userData })
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff7b72">const</span> result <span style="color:#ff7b72;font-weight:bold">=</span> <span style="color:#ff7b72">await</span> processUser(userData)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    expect(mockValidateUser).toHaveBeenCalledWith(userData)
</span></span><span style="display:flex;"><span>    expect(mockSaveUser).toHaveBeenCalledWith(userData)
</span></span><span style="display:flex;"><span>    expect(result).toEqual({ id<span style="color:#ff7b72;font-weight:bold">:</span> <span style="color:#a5d6ff">1</span>, ...userData })
</span></span><span style="display:flex;"><span>  })
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  test(<span style="color:#a5d6ff">&#39;should handle validation errors&#39;</span>, <span style="color:#ff7b72">async</span> () =&gt; {
</span></span><span style="display:flex;"><span>    <span style="color:#ff7b72">const</span> userData <span style="color:#ff7b72;font-weight:bold">=</span> { name<span style="color:#ff7b72;font-weight:bold">:</span> <span style="color:#a5d6ff">&#39;&#39;</span>, email<span style="color:#ff7b72;font-weight:bold">:</span> <span style="color:#a5d6ff">&#39;invalid-email&#39;</span> }
</span></span><span style="display:flex;"><span>    mockValidateUser.mockRejectedValue(<span style="color:#ff7b72">new</span> Error(<span style="color:#a5d6ff">&#39;Invalid user data&#39;</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff7b72">await</span> expect(processUser(userData)).rejects.toThrow(<span style="color:#a5d6ff">&#39;Invalid user data&#39;</span>)
</span></span><span style="display:flex;"><span>  })
</span></span><span style="display:flex;"><span>})
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="3-æµ‹è¯•å¹¶å‘æ§åˆ¶">3. æµ‹è¯•å¹¶å‘æ§åˆ¶<a hidden class="anchor" aria-hidden="true" href="#3-æµ‹è¯•å¹¶å‘æ§åˆ¶">#</a></h3>
<div class="highlight"><div style="color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">31
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#8b949e;font-style:italic">// æµ‹è¯•å¹¶å‘é™åˆ¶å™¨
</span></span></span><span style="display:flex;"><span><span style="color:#8b949e;font-style:italic"></span>describe(<span style="color:#a5d6ff">&#39;ConcurrencyLimiter&#39;</span>, () =&gt; {
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">let</span> limiter
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">let</span> executionCount <span style="color:#ff7b72;font-weight:bold">=</span> <span style="color:#a5d6ff">0</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  beforeEach(() =&gt; {
</span></span><span style="display:flex;"><span>    limiter <span style="color:#ff7b72;font-weight:bold">=</span> <span style="color:#ff7b72">new</span> ConcurrencyLimiter(<span style="color:#a5d6ff">2</span>)
</span></span><span style="display:flex;"><span>    executionCount <span style="color:#ff7b72;font-weight:bold">=</span> <span style="color:#a5d6ff">0</span>
</span></span><span style="display:flex;"><span>  })
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  test(<span style="color:#a5d6ff">&#39;should limit concurrent execution&#39;</span>, <span style="color:#ff7b72">async</span> () =&gt; {
</span></span><span style="display:flex;"><span>    <span style="color:#ff7b72">const</span> task <span style="color:#ff7b72;font-weight:bold">=</span> jest.fn().mockImplementation(<span style="color:#ff7b72">async</span> () =&gt; {
</span></span><span style="display:flex;"><span>      executionCount<span style="color:#ff7b72;font-weight:bold">++</span>
</span></span><span style="display:flex;"><span>      <span style="color:#ff7b72">await</span> <span style="color:#ff7b72">new</span> Promise(resolve =&gt; setTimeout(resolve, <span style="color:#a5d6ff">100</span>))
</span></span><span style="display:flex;"><span>      <span style="color:#ff7b72">return</span> executionCount
</span></span><span style="display:flex;"><span>    })
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff7b72">const</span> promises <span style="color:#ff7b72;font-weight:bold">=</span> [
</span></span><span style="display:flex;"><span>      limiter.execute(task),
</span></span><span style="display:flex;"><span>      limiter.execute(task),
</span></span><span style="display:flex;"><span>      limiter.execute(task),
</span></span><span style="display:flex;"><span>      limiter.execute(task),
</span></span><span style="display:flex;"><span>      limiter.execute(task)
</span></span><span style="display:flex;"><span>    ]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff7b72">const</span> results <span style="color:#ff7b72;font-weight:bold">=</span> <span style="color:#ff7b72">await</span> Promise.all(promises)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    expect(results).toEqual([<span style="color:#a5d6ff">1</span>, <span style="color:#a5d6ff">2</span>, <span style="color:#a5d6ff">3</span>, <span style="color:#a5d6ff">4</span>, <span style="color:#a5d6ff">5</span>])
</span></span><span style="display:flex;"><span>    expect(task).toHaveBeenCalledTimes(<span style="color:#a5d6ff">5</span>)
</span></span><span style="display:flex;"><span>  })
</span></span><span style="display:flex;"><span>})
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="æ€»ç»“">æ€»ç»“<a hidden class="anchor" aria-hidden="true" href="#æ€»ç»“">#</a></h2>
<p>JavaScriptå¼‚æ­¥ç¼–ç¨‹å·²ç»ä»å›è°ƒåœ°ç‹±å‘å±•åˆ°äº†ä¼˜é›…çš„Async/Awaitæ—¶ä»£ã€‚é€šè¿‡æŒæ¡è¿™äº›æœ€ä½³å®è·µï¼Œä½ å¯ä»¥ï¼š</p>
<h3 id="æ ¸å¿ƒè¦ç‚¹">æ ¸å¿ƒè¦ç‚¹<a hidden class="anchor" aria-hidden="true" href="#æ ¸å¿ƒè¦ç‚¹">#</a></h3>
<ol>
<li><strong>ç†è§£Promiseæœºåˆ¶</strong>ï¼šæŒæ¡Promiseçš„ä¸‰ç§çŠ¶æ€å’Œç”Ÿå‘½å‘¨æœŸ</li>
<li><strong>åˆç†ä½¿ç”¨Async/Await</strong>ï¼šç®€åŒ–å¼‚æ­¥ä»£ç ï¼Œæé«˜å¯è¯»æ€§</li>
<li><strong>å®Œå–„çš„é”™è¯¯å¤„ç†</strong>ï¼šå®ç°å¥å£®çš„é”™è¯¯å¤„ç†æœºåˆ¶</li>
<li><strong>å¹¶å‘æ§åˆ¶</strong>ï¼šåˆç†æ§åˆ¶å¹¶å‘æ•°é‡ï¼Œé¿å…èµ„æºè€—å°½</li>
<li><strong>æ€§èƒ½ä¼˜åŒ–</strong>ï¼šä½¿ç”¨ç¼“å­˜ã€å»é‡ç­‰æŠ€æœ¯æå‡æ€§èƒ½</li>
</ol>
<h3 id="å®è·µå»ºè®®">å®è·µå»ºè®®<a hidden class="anchor" aria-hidden="true" href="#å®è·µå»ºè®®">#</a></h3>
<ul>
<li>ä¼˜å…ˆä½¿ç”¨Async/Awaitè€Œä¸æ˜¯Promiseé“¾</li>
<li>ç»Ÿä¸€é”™è¯¯å¤„ç†ç­–ç•¥</li>
<li>å®ç°åˆç†çš„é‡è¯•å’Œè¶…æ—¶æœºåˆ¶</li>
<li>ä½¿ç”¨ç¼“å­˜å‡å°‘ä¸å¿…è¦çš„è¯·æ±‚</li>
<li>å……åˆ†æµ‹è¯•å¼‚æ­¥ä»£ç </li>
</ul>
<p>JavaScriptå¼‚æ­¥ç¼–ç¨‹æ˜¯ä¸€ä¸ªä¸æ–­å‘å±•çš„é¢†åŸŸï¼Œä¿æŒå­¦ä¹ å’Œå®è·µæ˜¯æŒæ¡å…¶ç²¾é«“çš„å…³é”®ã€‚é€šè¿‡éµå¾ªè¿™äº›æœ€ä½³å®è·µï¼Œä½ å¯ä»¥ç¼–å†™å‡ºæ›´æ¸…æ™°ã€æ›´å¯é ã€æ›´é«˜æ•ˆçš„å¼‚æ­¥ä»£ç ã€‚</p>


      </div>

      <footer class="post-footer-modern">
        
<div class="post-tags-modern">
  <span class="tags-label">ğŸ·ï¸ æ ‡ç­¾</span>
  <div class="tags-list">
    <a href="//localhost:1313///blog/tags/javascript/" class="tag-pill">
      JavaScript
    </a>
    <a href="//localhost:1313///blog/tags/%E5%BC%82%E6%AD%A5%E7%BC%96%E7%A8%8B/" class="tag-pill">
      å¼‚æ­¥ç¼–ç¨‹
    </a>
    <a href="//localhost:1313///blog/tags/promise/" class="tag-pill">
      Promise
    </a>
    <a href="//localhost:1313///blog/tags/async/await/" class="tag-pill">
      Async/Await
    </a>
    <a href="//localhost:1313///blog/tags/%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/" class="tag-pill">
      å‰ç«¯å¼€å‘
    </a>
  </div>
</div>

<style>
 
.post-footer-modern {
  margin-top: 3rem;
  padding-top: 2rem;
  border-top: 1px solid var(--border, #333333);
}

 
.post-tags-modern {
  display: flex;
  align-items: center;
  gap: 1rem;
  margin-bottom: 2rem;
  flex-wrap: wrap;
}

.tags-label {
  font-size: 0.875rem;
  font-weight: 600;
  color: var(--secondary, #999999) !important;
  white-space: nowrap;
}

.tags-list {
  display: flex;
  flex-wrap: wrap;
  gap: 0.5rem;
  flex: 1;
}

.tag-pill {
  display: inline-block;
  padding: 0.25rem 0.75rem;
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid var(--border, #333333);
  border-radius: 0;
  color: var(--secondary, #cccccc) !important;
  text-decoration: none;
  font-size: 0.8rem;
  font-weight: 500;
  transition: all 0.2s ease;
}

.tag-pill:hover {
  background: var(--primary, #ffffff);
  color: var(--background, #000000) !important;
  border-color: var(--primary, #ffffff);
  transform: translateY(-1px);
}

 
.post-nav-modern {
  margin-top: 2rem;
}

.nav-grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 1rem;
}

.nav-card {
  display: flex;
  align-items: center;
  gap: 1rem;
  padding: 1.25rem;
  background: rgba(255, 255, 255, 0.02);
  border: 1px solid var(--border, #333333);
  border-radius: 12px;
  text-decoration: none;
  transition: all 0.2s ease;
  min-height: 80px;
}

.nav-card:hover {
  background: rgba(255, 255, 255, 0.05);
  border-color: var(--primary, #ffffff);
  transform: translateY(-2px);
}

.nav-card.nav-prev {
  justify-content: flex-start;
}

.nav-card.nav-next {
  justify-content: flex-end;
  text-align: right;
}

.nav-card.nav-next .nav-content {
  text-align: right;
}

.nav-empty {
  display: flex;
  align-items: center;
  justify-content: center;
  background: rgba(255, 255, 255, 0.01);
  border: 1px dashed var(--border, #333333);
  color: var(--secondary, #666666);
}

.nav-arrow {
  font-size: 1.5rem;
  color: var(--primary, #ffffff);
  font-weight: 300;
}

.nav-content {
  flex: 1;
}

.nav-title {
  font-size: 0.95rem;
  font-weight: 600;
  color: var(--primary, #ffffff) !important;
  line-height: 1.4;
  display: -webkit-box;
  -webkit-line-clamp: 2;
  -webkit-box-orient: vertical;
  overflow: hidden;
}

 
[data-theme="light"] .post-footer-modern {
  border-color: var(--border-light, #dee2e6);
}

[data-theme="light"] .tags-label {
  color: var(--secondary-light, #6c757d) !important;
}

[data-theme="light"] .tag-pill {
  background: rgba(0, 0, 0, 0.05);
  border-color: var(--border-light, #dee2e6);
  color: var(--secondary-light, #495057) !important;
}

[data-theme="light"] .tag-pill:hover {
  background: var(--primary-light, #0066cc);
  color: var(--background-light, #ffffff) !important;
  border-color: var(--primary-light, #0066cc);
}

[data-theme="light"] .nav-card {
  background: rgba(0, 0, 0, 0.02);
  border-color: var(--border-light, #dee2e6);
}

[data-theme="light"] .nav-card:hover {
  background: rgba(0, 102, 204, 0.05);
  border-color: var(--primary-light, #0066cc);
}

[data-theme="light"] .nav-empty {
  background: rgba(0, 0, 0, 0.01);
  border-color: var(--border-light, #dee2e6);
  color: var(--secondary-light, #6c757d);
}

[data-theme="light"] .nav-arrow {
  color: var(--primary-light, #0066cc);
}

[data-theme="light"] .nav-title {
  color: var(--primary-light, #212529) !important;
}

 
@media (max-width: 768px) {
  .nav-grid {
    grid-template-columns: 1fr;
    gap: 0.75rem;
  }

  .nav-card {
    padding: 1rem;
    min-height: 70px;
  }

  .nav-card.nav-next {
    text-align: left;
  }

  .nav-card.nav-next .nav-content {
    text-align: left;
  }

  .nav-title {
    font-size: 0.875rem;
  }

  .post-tags-modern {
    flex-direction: column;
    gap: 0.75rem;
  }
}

@media (max-width: 480px) {
  .nav-arrow {
    font-size: 1.25rem;
  }

  .nav-card {
    padding: 0.875rem;
  }

  .nav-title {
    font-size: 0.8rem;
    -webkit-line-clamp: 1;
  }
}
</style>

        
      </footer>
    </main>

    
    <aside class="post-sidebar">
<div class="sidebar-toc" id="sidebar-toc">
  <div class="toc-header">
    <div class="toc-title">ç›®å½•</div>
    <button class="toc-toggle" id="toc-toggle" aria-label="Toggle TOC">
      <svg class="toc-toggle-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M18 6L6 18M6 6l12 12"/>
      </svg>
    </button>
  </div>

  <div class="toc-content" id="toc-content">
    <ul class="toc-list">
        <li class="toc-item toc-h2">
          <a href="#h2-0" class="toc-item-link">
            <span class="toc-item-text">å¼‚æ­¥ç¼–ç¨‹æ¼”è¿›å²</span>
          </a>
        </li>
        <li class="toc-item toc-h2">
          <a href="#h2-1" class="toc-item-link">
            <span class="toc-item-text">Promiseæ·±åº¦è§£æ</span>
          </a>
        </li>
        <li class="toc-item toc-h2">
          <a href="#h2-2" class="toc-item-link">
            <span class="toc-item-text">Async/Awaitæœ€ä½³å®è·µ</span>
          </a>
        </li>
        <li class="toc-item toc-h2">
          <a href="#h2-3" class="toc-item-link">
            <span class="toc-item-text">é«˜çº§å¼‚æ­¥æ¨¡å¼</span>
          </a>
        </li>
        <li class="toc-item toc-h2">
          <a href="#h2-4" class="toc-item-link">
            <span class="toc-item-text">å¼‚æ­¥æ¨¡å¼åœ¨Reactä¸­çš„åº”ç”¨</span>
          </a>
        </li>
        <li class="toc-item toc-h2">
          <a href="#h2-5" class="toc-item-link">
            <span class="toc-item-text">æ€§èƒ½ä¼˜åŒ–æŠ€å·§</span>
          </a>
        </li>
        <li class="toc-item toc-h2">
          <a href="#h2-6" class="toc-item-link">
            <span class="toc-item-text">æµ‹è¯•å¼‚æ­¥ä»£ç </span>
          </a>
        </li>
        <li class="toc-item toc-h2">
          <a href="#h2-7" class="toc-item-link">
            <span class="toc-item-text">æ€»ç»“</span>
          </a>
        </li>
    </ul>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const toc = document.getElementById('sidebar-toc');
  const tocToggle = document.getElementById('toc-toggle');
  const tocContent = document.getElementById('toc-content');
  const tocToggleIcon = tocToggle?.querySelector('.toc-toggle-icon');

  if (!toc) return;

  
  let isCollapsed = false;

  
  if (tocToggle) {
    tocToggle.addEventListener('click', function() {
      isCollapsed = !isCollapsed;

      if (isCollapsed) {
        tocContent.style.display = 'none';
        toc.style.width = 'auto';
        tocToggleIcon.innerHTML = '<path d="M9 18l6-6-6-6"/>';
      } else {
        tocContent.style.display = 'block';
        toc.style.width = '200px';
        tocToggleIcon.innerHTML = '<path d="M18 6L6 18M6 6l12 12"/>';
      }
    });
  }

  
  const content = document.querySelector('.post-content');
  if (content) {
    
    const h1Headers = content.querySelectorAll('h1');
    h1Headers.forEach((header, index) => {
      header.id = `h1-${index}`;
    });

    
    const h2Headers = content.querySelectorAll('h2');
    h2Headers.forEach((header, index) => {
      header.id = `h2-${index}`;
    });
  }

  
  const tocLinks = document.querySelectorAll('.toc-item-link');
  tocLinks.forEach(link => {
    link.addEventListener('click', function(e) {
      e.preventDefault();
      const targetId = this.getAttribute('href').substring(1);
      const targetElement = document.getElementById(targetId);

      if (targetElement) {
        const headerHeight = document.querySelector('.post-header-main')?.offsetHeight || 0;
        const offsetTop = targetElement.offsetTop - headerHeight - 20;

        window.scrollTo({
          top: offsetTop,
          behavior: 'smooth'
        });
      }
    });
  });
});
</script>

<style>
 
.sidebar-toc {
  position: sticky;
  top: 2rem;
  width: 200px;
  background: #ffffff;
  border: 1px solid #e5e7eb;
  border-radius: 4px;
  overflow: hidden;
  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
  z-index: 100;
}

.sidebar-toc.hidden {
  display: none;
}

 
.toc-header {
  padding: 12px 16px;
  border-bottom: 1px solid #e5e7eb;
  background: #fafbfc;
  display: flex;
  align-items: center;
  justify-content: space-between;
}

.toc-title {
  margin: 0;
  font-size: 13px;
  font-weight: 500;
  color: #374151 !important;
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
  text-transform: uppercase;
  letter-spacing: 1px;
}

.toc-toggle {
  background: none;
  border: none;
  cursor: pointer;
  padding: 4px;
  border-radius: 4px;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all 0.2s ease;
  color: #6b7280;
}

.toc-toggle:hover {
  background: #e5e7eb;
  color: #374151;
}

.toc-toggle-icon {
  transition: transform 0.2s ease;
}

 
.toc-content {
  padding: 12px 0;
}

.toc-list {
  list-style: none;
  margin: 0;
  padding: 0;
}

.toc-item {
  margin-bottom: 4px;
  display: block !important;
  visibility: visible !important;
}

 
.toc-h1, .toc-h2 {
  display: block !important;
}

 
.toc-h2 {
  margin-left: 0;
}


.toc-item-link {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 8px 12px;
  color: #374151 !important;
  text-decoration: none;
  font-size: 13px;
  line-height: 1.4;
  border-radius: 3px;
  transition: all 0.2s ease;
  font-weight: 400;
}


.toc-item-link:hover {
  background: #f8fafc;
  color: #1f2937 !important;
}

.toc-item-link.active {
  background: #e0f2fe;
  color: #01579b !important;
  font-weight: 500;
}

 
.toc-dot {
  width: 8px;
  height: 8px;
  border-radius: 50%;
  flex-shrink: 0;
}

.dot-red {
  background: #ef4444;
}

.dot-blue {
  background: #2196f3;
}


 
.toc-item-text {
  color: #1f2937 !important;
  font-weight: 400;
  flex: 1;
  display: inline !important;
  visibility: visible !important;
  opacity: 1 !important;
  font-size: 13px !important;
  line-height: 1.4 !important;
}

 
.toc-item-link .toc-item-text {
  color: #1f2937 !important;
  display: inline !important;
  visibility: visible !important;
  opacity: 1 !important;
}

 
.toc-item.active .dot-red {
  background: #d32f2f;
}

.toc-item.active .dot-blue {
  background: #1976d2;
}

 
[data-theme="dark"] .sidebar-toc {
  background: #1f2937;
  border-color: #374151;
  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.3);
}

[data-theme="dark"] .toc-header {
  background: #111827;
  border-color: #374151;
}

[data-theme="dark"] .toc-title {
  color: #f3f4f6 !important;
}

[data-theme="dark"] .toc-toggle {
  color: #9ca3af;
}

[data-theme="dark"] .toc-toggle:hover {
  background: #374151;
  color: #f3f4f6;
}


[data-theme="dark"] .toc-item-link {
  color: #e5e7eb !important;
}

[data-theme="dark"] .toc-item-link:hover {
  background: #374151;
  color: #f9fafb !important;
}


[data-theme="dark"] .toc-item-link.active {
  background: #0d47a1;
  color: #ffffff !important;
}

[data-theme="dark"] .toc-item-text {
  color: #f9fafb !important;
  display: inline !important;
  visibility: visible !important;
  opacity: 1 !important;
}

 
[data-theme="dark"] .toc-item-link .toc-item-text {
  color: #f9fafb !important;
  display: inline !important;
  visibility: visible !important;
  opacity: 1 !important;
}

 
@media (max-width: 1024px) {
  .sidebar-toc {
    display: none;
  }

  .post-content-wrapper {
    grid-template-columns: 1fr !important;
    padding: 0 1rem !important;
  }
}
</style>

<style>
 
.post-content-wrapper {
  display: grid;
  grid-template-columns: 1fr 200px;
  gap: 2rem;
  padding: 0 2rem;
  max-width: 100%;
}

.post-content-main {
  min-width: 0;
}

.post-sidebar {
  position: sticky;
  top: 2rem;
  height: fit-content;
  min-width: 0;
}

 
.post-header-main {
  margin-bottom: 2rem;
  padding-bottom: 1rem;
  border-bottom: 1px solid var(--border, #333333);
}

.post-header-main .post-title {
  color: var(--primary, #ffffff) !important;
  font-size: 2.5rem;
  font-weight: 700;
  line-height: 1.2;
  margin-bottom: 1rem;
}

.post-header-main .post-description {
  color: var(--secondary, #cccccc) !important;
  font-size: 1.1rem;
  line-height: 1.6;
  margin-bottom: 1rem;
}

.post-header-main .post-meta {
  margin-bottom: 0;
}

 
@media (max-width: 1024px) {
  .post-content-wrapper {
    grid-template-columns: 1fr !important;
    gap: 1rem;
    padding: 0 1rem !important;
  }

  .post-sidebar {
    display: none;
  }
}

@media (max-width: 768px) {
  .post-header-main .post-title {
    font-size: 2rem;
  }

  .post-header-main .post-description {
    font-size: 1rem;
  }
}
</style>
    </aside>
  </div>
</article>
    </main>
    
<footer class="footer">
        <span>Â© 2024-2025 æœ‰æ¡å·¥å…·æŠ€æœ¯åšå®¢</span> Â· 

    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu');
    if (menu) {
        
        const scrollPosition = localStorage.getItem("menu-scroll-position");
        if (scrollPosition) {
            menu.scrollLeft = parseInt(scrollPosition, 10);
        }
        
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        const html = document.querySelector("html");
        if (html.dataset.theme === "dark") {
            html.dataset.theme = 'light';
            localStorage.setItem("pref-theme", 'light');
        } else {
            html.dataset.theme = 'dark';
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
</body>

</html>
