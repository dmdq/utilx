<!doctype html><html lang=zh-cn dir=auto data-theme=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>RAGç³»ç»Ÿæ„å»ºå®Œå…¨æŒ‡å—ï¼šæ‰“é€ ä¼ä¸šçº§çŸ¥è¯†é—®ç­”ç³»ç»Ÿ | æŠ€æœ¯åšå®¢ - æœ‰æ¡å·¥å…·</title><meta name=keywords content="RAG,å‘é‡æ•°æ®åº“,çŸ¥è¯†åº“,LLM,Embeddings"><meta name=description content="æ·±å…¥è§£ææ£€ç´¢å¢å¼ºç”Ÿæˆï¼ˆRAGï¼‰ç³»ç»Ÿçš„æ¶æ„è®¾è®¡ã€å‘é‡æ•°æ®åº“ã€åµŒå…¥æ¨¡å‹å’Œè¯„ä¼°æ–¹æ³•ï¼Œå¸®åŠ©ä½ æ„å»ºå‡†ç¡®å¯é çš„ä¼ä¸šçŸ¥è¯†é—®ç­”ç³»ç»Ÿã€‚"><meta name=author content="æœ‰æ¡å·¥å…·å›¢é˜Ÿ"><link rel=canonical href=/blog/articles/rag%E7%B3%BB%E7%BB%9F%E6%9E%84%E5%BB%BA%E5%AE%8C%E5%85%A8%E6%8C%87%E5%8D%97%E6%89%93%E9%80%A0%E4%BC%81%E4%B8%9A%E7%BA%A7%E7%9F%A5%E8%AF%86%E9%97%AE%E7%AD%94%E7%B3%BB%E7%BB%9F/><link crossorigin=anonymous href=/blog/assets/css/stylesheet.7e8505b7cdf8bb22ab2305e53c2700bb06c7e64faeb72cd3468823a9a3bd3d6e.css integrity="sha256-foUFt834uyKrIwXlPCcAuwbH5k+utyzTRogjqaO9PW4=" rel="preload stylesheet" as=style><link rel=icon href=/favicon.ico><link rel=icon type=image/png sizes=16x16 href=/blog/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=/blog/favicon-32x32.png><link rel=apple-touch-icon href=/blog/apple-touch-icon.png><link rel=mask-icon href=/blog/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate type=application/rss+xml href=/blog/articles/rag%E7%B3%BB%E7%BB%9F%E6%9E%84%E5%BB%BA%E5%AE%8C%E5%85%A8%E6%8C%87%E5%8D%97%E6%89%93%E9%80%A0%E4%BC%81%E4%B8%9A%E7%BA%A7%E7%9F%A5%E8%AF%86%E9%97%AE%E7%AD%94%E7%B3%BB%E7%BB%9F/feed.xml title=rss><link rel=alternate hreflang=zh-cn href=/blog/articles/rag%E7%B3%BB%E7%BB%9F%E6%9E%84%E5%BB%BA%E5%AE%8C%E5%85%A8%E6%8C%87%E5%8D%97%E6%89%93%E9%80%A0%E4%BC%81%E4%B8%9A%E7%BA%A7%E7%9F%A5%E8%AF%86%E9%97%AE%E7%AD%94%E7%B3%BB%E7%BB%9F/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51);color-scheme:dark}.list{background:var(--theme)}.toc{background:var(--entry)}}@media(prefers-color-scheme:light){.list::-webkit-scrollbar-thumb{border-color:var(--code-bg)}}</style></noscript><script>localStorage.getItem("pref-theme")==="dark"?document.querySelector("html").dataset.theme="dark":localStorage.getItem("pref-theme")==="light"?document.querySelector("html").dataset.theme="light":window.matchMedia("(prefers-color-scheme: dark)").matches?document.querySelector("html").dataset.theme="dark":document.querySelector("html").dataset.theme="light"</script><script src=/js/external-link-config.js></script><script src=/js/external-link-interceptor.js></script><link rel=stylesheet href=/blog/css/custom.css media=screen><script type=application/ld+json>{"@context":"https://schema.org","@type":"WebSite","name":"æŠ€æœ¯åšå®¢ - æœ‰æ¡å·¥å…· | å¼€å‘è€…å·¥å…·ä½¿ç”¨æ•™ç¨‹ & ç¼–ç¨‹æŠ€å·§åˆ†äº«","url":"https://www.util.cn/blog/","description":"æœ‰æ¡å·¥å…·æŠ€æœ¯åšå®¢ - åˆ†äº«å¼€å‘è€…å·¥å…·ä½¿ç”¨æ•™ç¨‹ã€ç¼–ç¨‹æŠ€å·§å’Œå®æˆ˜å¼€å‘ç»éªŒã€‚æä¾›JSONæ ¼å¼åŒ–ã€SQLä¼˜åŒ–ã€Markdownç¼–è¾‘å™¨ç­‰åœ¨çº¿å·¥å…·çš„è¯¦ç»†ä½¿ç”¨æŒ‡å—ï¼Œå¸®åŠ©å¼€å‘è€…æå‡å·¥ä½œæ•ˆç‡ã€‚","publisher":{"@type":"Organization","name":"æœ‰æ¡å·¥å…·","url":"https://www.util.cn","logo":{"@type":"ImageObject","url":"https://www.util.cn/blog/logo/logo-256.png","width":256,"height":256}},"potentialAction":[{"@type":"SearchAction","target":"https://www.util.cn/blog/search?q={search_term_string}","query-input":"required name=search_term_string"}]}</script><meta property="og:type" content="website"><meta property="og:title" content="æŠ€æœ¯åšå®¢ - æœ‰æ¡å·¥å…· | å¼€å‘è€…å·¥å…·ä½¿ç”¨æ•™ç¨‹ & ç¼–ç¨‹æŠ€å·§åˆ†äº«"><meta property="og:description" content="æœ‰æ¡å·¥å…·æŠ€æœ¯åšå®¢ - åˆ†äº«å¼€å‘è€…å·¥å…·ä½¿ç”¨æ•™ç¨‹ã€ç¼–ç¨‹æŠ€å·§å’Œå®æˆ˜å¼€å‘ç»éªŒã€‚æä¾›JSONæ ¼å¼åŒ–ã€SQLä¼˜åŒ–ã€Markdownç¼–è¾‘å™¨ç­‰åœ¨çº¿å·¥å…·çš„è¯¦ç»†ä½¿ç”¨æŒ‡å—ï¼Œå¸®åŠ©å¼€å‘è€…æå‡å·¥ä½œæ•ˆç‡ã€‚"><meta property="og:url" content="https://www.util.cn/blog/"><meta property="og:site_name" content="æœ‰æ¡å·¥å…·æŠ€æœ¯åšå®¢"><meta property="og:image" content="https://www.util.cn/blog/logo/logo-256.png"><meta property="og:image:width" content="1200"><meta property="og:image:height" content="630"><meta name=twitter:card content="summary_large_image"><meta name=twitter:title content="æŠ€æœ¯åšå®¢ - æœ‰æ¡å·¥å…· | å¼€å‘è€…å·¥å…·ä½¿ç”¨æ•™ç¨‹ & ç¼–ç¨‹æŠ€å·§åˆ†äº«"><meta name=twitter:description content="æœ‰æ¡å·¥å…·æŠ€æœ¯åšå®¢ - åˆ†äº«å¼€å‘è€…å·¥å…·ä½¿ç”¨æ•™ç¨‹ã€ç¼–ç¨‹æŠ€å·§å’Œå®æˆ˜å¼€å‘ç»éªŒã€‚"><meta name=twitter:image content="https://www.util.cn/blog/logo/logo-256.png"><meta name=baidu-site-verification content><meta name=category content="æŠ€æœ¯åšå®¢,å¼€å‘è€…å·¥å…·,ç¼–ç¨‹æ•™ç¨‹"><meta name=coverage content="Worldwide"><meta name=distribution content="Global"><meta name=rating content="General"><script id=51la_code async crossorigin=anonymous src="https://sdk.51.la/js-sdk-pro.min.js?id=3OM52V0xJAPv6ozF&hash=pro"></script><script>window.addEventListener("load",function(){setTimeout(function(){typeof la!="undefined"?console.log("51laç»Ÿè®¡å·²åŠ è½½"):(console.warn("51laç»Ÿè®¡åŠ è½½å¤±è´¥ï¼Œä½¿ç”¨å¤‡ç”¨æ–¹æ¡ˆ"),function(){var e=document.createElement("script");e.src="https://sdk.51.la/js-sdk-pro.min.js?id=3OM52V0xJAPv6ozF&hash=backup",e.async=!0,document.head.appendChild(e)}())},3e3)})</script><meta property="og:url" content="/blog/articles/rag%E7%B3%BB%E7%BB%9F%E6%9E%84%E5%BB%BA%E5%AE%8C%E5%85%A8%E6%8C%87%E5%8D%97%E6%89%93%E9%80%A0%E4%BC%81%E4%B8%9A%E7%BA%A7%E7%9F%A5%E8%AF%86%E9%97%AE%E7%AD%94%E7%B3%BB%E7%BB%9F/"><meta property="og:site_name" content="æŠ€æœ¯åšå®¢ - æœ‰æ¡å·¥å…·"><meta property="og:title" content="RAGç³»ç»Ÿæ„å»ºå®Œå…¨æŒ‡å—ï¼šæ‰“é€ ä¼ä¸šçº§çŸ¥è¯†é—®ç­”ç³»ç»Ÿ"><meta property="og:description" content="æ·±å…¥è§£ææ£€ç´¢å¢å¼ºç”Ÿæˆï¼ˆRAGï¼‰ç³»ç»Ÿçš„æ¶æ„è®¾è®¡ã€å‘é‡æ•°æ®åº“ã€åµŒå…¥æ¨¡å‹å’Œè¯„ä¼°æ–¹æ³•ï¼Œå¸®åŠ©ä½ æ„å»ºå‡†ç¡®å¯é çš„ä¼ä¸šçŸ¥è¯†é—®ç­”ç³»ç»Ÿã€‚"><meta property="og:locale" content="zh-cn"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2025-12-25T23:00:00+08:00"><meta property="article:modified_time" content="2025-12-25T23:00:00+08:00"><meta property="article:tag" content="RAG"><meta property="article:tag" content="å‘é‡æ•°æ®åº“"><meta property="article:tag" content="çŸ¥è¯†åº“"><meta property="article:tag" content="LLM"><meta property="article:tag" content="Embeddings"><meta name=twitter:card content="summary"><meta name=twitter:title content="RAGç³»ç»Ÿæ„å»ºå®Œå…¨æŒ‡å—ï¼šæ‰“é€ ä¼ä¸šçº§çŸ¥è¯†é—®ç­”ç³»ç»Ÿ"><meta name=twitter:description content="æ·±å…¥è§£ææ£€ç´¢å¢å¼ºç”Ÿæˆï¼ˆRAGï¼‰ç³»ç»Ÿçš„æ¶æ„è®¾è®¡ã€å‘é‡æ•°æ®åº“ã€åµŒå…¥æ¨¡å‹å’Œè¯„ä¼°æ–¹æ³•ï¼Œå¸®åŠ©ä½ æ„å»ºå‡†ç¡®å¯é çš„ä¼ä¸šçŸ¥è¯†é—®ç­”ç³»ç»Ÿã€‚"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"æ‰€æœ‰æ–‡ç« ","item":"/blog/posts/"},{"@type":"ListItem","position":2,"name":"RAGç³»ç»Ÿæ„å»ºå®Œå…¨æŒ‡å—ï¼šæ‰“é€ ä¼ä¸šçº§çŸ¥è¯†é—®ç­”ç³»ç»Ÿ","item":"/blog/articles/rag%E7%B3%BB%E7%BB%9F%E6%9E%84%E5%BB%BA%E5%AE%8C%E5%85%A8%E6%8C%87%E5%8D%97%E6%89%93%E9%80%A0%E4%BC%81%E4%B8%9A%E7%BA%A7%E7%9F%A5%E8%AF%86%E9%97%AE%E7%AD%94%E7%B3%BB%E7%BB%9F/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"RAGç³»ç»Ÿæ„å»ºå®Œå…¨æŒ‡å—ï¼šæ‰“é€ ä¼ä¸šçº§çŸ¥è¯†é—®ç­”ç³»ç»Ÿ","name":"RAGç³»ç»Ÿæ„å»ºå®Œå…¨æŒ‡å—ï¼šæ‰“é€ ä¼ä¸šçº§çŸ¥è¯†é—®ç­”ç³»ç»Ÿ","description":"æ·±å…¥è§£ææ£€ç´¢å¢å¼ºç”Ÿæˆï¼ˆRAGï¼‰ç³»ç»Ÿçš„æ¶æ„è®¾è®¡ã€å‘é‡æ•°æ®åº“ã€åµŒå…¥æ¨¡å‹å’Œè¯„ä¼°æ–¹æ³•ï¼Œå¸®åŠ©ä½ æ„å»ºå‡†ç¡®å¯é çš„ä¼ä¸šçŸ¥è¯†é—®ç­”ç³»ç»Ÿã€‚","keywords":["RAG","å‘é‡æ•°æ®åº“","çŸ¥è¯†åº“","LLM","Embeddings"],"articleBody":"æ£€ç´¢å¢å¼ºç”Ÿæˆï¼ˆRetrieval-Augmented Generation, RAGï¼‰æ˜¯å¤§è¯­è¨€æ¨¡å‹åº”ç”¨çš„æ ¸å¿ƒæŠ€æœ¯ã€‚å®ƒç»“åˆäº†ä¿¡æ¯æ£€ç´¢å’Œç”Ÿæˆå¼AIçš„èƒ½åŠ›ï¼Œè®©LLMèƒ½å¤Ÿè®¿é—®å’Œåˆ©ç”¨å¤–éƒ¨çŸ¥è¯†åº“ï¼Œæä¾›æ›´å‡†ç¡®ã€æ›´å¯é çš„å›ç­”ã€‚\nRAG æ ¸å¿ƒæ¦‚å¿µ å·¥ä½œæµç¨‹ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ ç”¨æˆ· â”‚â”€â”€â”€\u003eâ”‚ æ£€ç´¢å™¨ â”‚â”€â”€â”€\u003eâ”‚ LLM â”‚â”€â”€â”€\u003eâ”‚ ç­”æ¡ˆ â”‚ â”‚ é—®é¢˜ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â–¼ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ å‘é‡æ•°æ®åº“ â”‚ â”‚ (çŸ¥è¯†åº“) â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ ç³»ç»Ÿæ¶æ„è®¾è®¡ å®Œæ•´çš„RAGæµç¨‹ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 174 175 176 177 178 179 180 181 182 183 184 185 186 187 188 189 190 191 192 193 194 195 196 197 198 199 200 201 202 203 204 205 206 207 208 209 210 211 212 213 214 215 216 217 218 219 220 221 222 223 224 225 226 227 228 229 230 231 232 233 234 235 236 237 238 239 240 241 242 243 244 245 246 247 248 249 250 251 252 253 254 255 256 257 258 259 260 261 262 263 264 265 266 from typing import List, Dict, Any from sentence_transformers import SentenceTransformer import numpy as np class EnterpriseRAG: \"\"\"ä¼ä¸šçº§RAGç³»ç»Ÿ\"\"\" def __init__(self, config: Dict[str, Any]): # é…ç½® self.config = config # åµŒå…¥æ¨¡å‹ self.embedder = SentenceTransformer( config.get(\"embed_model\", \"sentence-transformers/all-MiniLM-L6-v2\") ) # å‘é‡æ•°æ®åº“ self.vector_db = self._init_vector_db(config.get(\"vector_db\")) # LLMå®¢æˆ·ç«¯ self.llm = self._init_llm(config.get(\"llm\")) def _init_vector_db(self, db_config: Dict): \"\"\"åˆå§‹åŒ–å‘é‡æ•°æ®åº“\"\"\" db_type = db_config.get(\"type\", \"faiss\") if db_type == \"faiss\": import faiss dimension = self.embedder.get_sentence_embedding_dimension() index = faiss.IndexFlatIP(dimension) return {\"type\": \"faiss\", \"index\": index} elif db_type == \"pinecone\": import pinecone pinecone.init( api_key=db_config[\"api_key\"], environment=db_config[\"environment\"] ) return {\"type\": \"pinecone\"} elif db_type == \"milvus\": from pymilvus import connections, Collection connections.connect( alias=\"default\", host=db_config[\"host\"], port=db_config[\"port\"] ) return {\"type\": \"milvus\"} def _init_llm(self, llm_config: Dict): \"\"\"åˆå§‹åŒ–LLM\"\"\" provider = llm_config.get(\"provider\", \"anthropic\") if provider == \"anthropic\": from anthropic import Anthropic return Anthropic(api_key=llm_config[\"api_key\"]) elif provider == \"openai\": from openai import OpenAI return OpenAI(api_key=llm_config[\"api_key\"]) elif provider == \"local\": # ä½¿ç”¨æœ¬åœ°æ¨¡å‹ return None def index_documents(self, documents: List[Dict[str, Any]]): \"\"\"ç´¢å¼•æ–‡æ¡£\"\"\" # æå–æ–‡æœ¬ texts = [doc[\"content\"] for doc in documents] # æ–‡æœ¬åˆ‡åˆ† chunks = self._chunk_texts(texts, chunk_size=500, overlap=50) # ç”ŸæˆåµŒå…¥ embeddings = self.embedder.encode( [chunk[\"text\"] for chunk in chunks] ) # å­˜å‚¨åˆ°å‘é‡æ•°æ®åº“ self._store_embeddings(chunks, embeddings) def _chunk_texts( self, texts: List[str], chunk_size: int = 500, overlap: int = 50 ) -\u003e List[Dict]: \"\"\"æ–‡æœ¬åˆ‡åˆ†\"\"\" chunks = [] for idx, text in enumerate(texts): # æŒ‰æ®µè½åˆ‡åˆ† paragraphs = text.split(\"\\n\\n\") current_chunk = \"\" chunk_id = 0 for para in paragraphs: if len(current_chunk) + len(para) \u003e chunk_size: if current_chunk: chunks.append({ \"text\": current_chunk.strip(), \"doc_id\": idx, \"chunk_id\": chunk_id }) chunk_id += 1 current_chunk = para[overlap:] else: current_chunk += \"\\n\\n\" + para if current_chunk: chunks.append({ \"text\": current_chunk.strip(), \"doc_id\": idx, \"chunk_id\": chunk_id }) return chunks def _store_embeddings(self, chunks: List[Dict], embeddings: np.ndarray): \"\"\"å­˜å‚¨åµŒå…¥\"\"\" db_type = self.vector_db[\"type\"] if db_type == \"faiss\": import faiss # å½’ä¸€åŒ– faiss.normalize_L2(embeddings) # æ·»åŠ åˆ°ç´¢å¼• self.vector_db[\"index\"].add( embeddings.astype(\"float32\") ) # å­˜å‚¨å…ƒæ•°æ® if \"metadata\" not in self.vector_db: self.vector_db[\"metadata\"] = [] self.vector_db[\"metadata\"].extend(chunks) elif db_type == \"pinecone\": import pinecone index = pinecone.Index(self.vector_db[\"index_name\"]) for i, (chunk, embedding) in enumerate(zip(chunks, embeddings)): index.upsert([ (str(i), embedding.tolist(), { \"text\": chunk[\"text\"], \"doc_id\": chunk[\"doc_id\"] }) ]) def retrieve(self, query: str, top_k: int = 5) -\u003e List[Dict]: \"\"\"æ£€ç´¢ç›¸å…³æ–‡æ¡£\"\"\" # ç”ŸæˆæŸ¥è¯¢åµŒå…¥ query_embedding = self.embedder.encode([query]) db_type = self.vector_db[\"type\"] if db_type == \"faiss\": import faiss # å½’ä¸€åŒ– faiss.normalize_L2(query_embedding) # æœç´¢ scores, indices = self.vector_db[\"index\"].search( query_embedding.astype(\"float32\"), top_k ) # ç»„è£…ç»“æœ results = [] for score, idx in zip(scores[0], indices[0]): if idx \u003c len(self.vector_db[\"metadata\"]): meta = self.vector_db[\"metadata\"][idx] results.append({ \"text\": meta[\"text\"], \"score\": float(score), \"doc_id\": meta[\"doc_id\"] }) return results elif db_type == \"pinecone\": import pinecone index = pinecone.Index(self.vector_db[\"index_name\"]) query_result = index.query( vector=query_embedding[0].tolist(), top_k=top_k, include_metadata=True ) return [ { \"text\": match[\"metadata\"][\"text\"], \"score\": match[\"score\"], \"doc_id\": match[\"metadata\"][\"doc_id\"] } for match in query_result[\"matches\"] ] def generate(self, query: str, context: List[Dict]) -\u003e str: \"\"\"ç”Ÿæˆå›ç­”\"\"\" # æ„å»ºæç¤º context_text = \"\\n\\n\".join([ f\"[æ–‡æ¡£{i+1}] {doc['text']}\" for i, doc in enumerate(context) ]) prompt = f\"\"\" åŸºäºä»¥ä¸‹æ–‡æ¡£å›ç­”é—®é¢˜ã€‚å¦‚æœæ–‡æ¡£ä¸­æ²¡æœ‰ç›¸å…³ä¿¡æ¯ï¼Œè¯·æ˜ç¡®è¯´æ˜ã€‚ {context_text} é—®é¢˜ï¼š{query} å›ç­”ï¼š \"\"\" # è°ƒç”¨LLM if self.llm: response = self.llm.messages.create( model=\"claude-3-5-sonnet-20241022\", max_tokens=2048, messages=[{\"role\": \"user\", \"content\": prompt}] ) return response.content[0].text else: # æœ¬åœ°æ¨¡å‹ pass def ask(self, query: str, top_k: int = 5) -\u003e Dict[str, Any]: \"\"\"é—®ç­”æ¥å£\"\"\" # æ£€ç´¢ retrieved_docs = self.retrieve(query, top_k=top_k) # æ£€æŸ¥ç›¸å…³æ€§ if retrieved_docs and retrieved_docs[0][\"score\"] \u003c 0.5: return { \"answer\": \"æŠ±æ­‰ï¼Œæˆ‘åœ¨çŸ¥è¯†åº“ä¸­æ²¡æœ‰æ‰¾åˆ°ç›¸å…³ä¿¡æ¯ã€‚\", \"sources\": [], \"confidence\": \"low\" } # ç”Ÿæˆ answer = self.generate(query, retrieved_docs) return { \"answer\": answer, \"sources\": [ {\"doc_id\": doc[\"doc_id\"], \"score\": doc[\"score\"]} for doc in retrieved_docs ], \"confidence\": \"high\" if retrieved_docs[0][\"score\"] \u003e 0.7 else \"medium\" } é«˜çº§æŠ€å·§ æ··åˆæ£€ç´¢ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 class HybridRetriever: \"\"\"æ··åˆæ£€ç´¢ï¼šå‘é‡+å…³é”®è¯\"\"\" def __init__(self, vector_db, keyword_index): self.vector_db = vector_db self.keyword_index = keyword_index def retrieve(self, query: str, alpha: float = 0.5, k: int = 5): \"\"\" æ··åˆæ£€ç´¢ alpha: å‘é‡æ£€ç´¢æƒé‡ (0-1) 1-alpha: å…³é”®è¯æ£€ç´¢æƒé‡ \"\"\" # å‘é‡æ£€ç´¢ vector_results = self.vector_db.search(query, k=k*2) # å…³é”®è¯æ£€ç´¢ keyword_results = self.keyword_index.search(query, k=k*2) # ç»“æœèåˆï¼ˆRRFç®—æ³•ï¼‰ fused = self.reciprocal_rank_fusion( { \"vector\": vector_results, \"keyword\": keyword_results }, weights={\"vector\": alpha, \"keyword\": 1-alpha} ) return sorted( fused.items(), key=lambda x: x[1], reverse=True )[:k] def reciprocal_rank_fusion(self, results: Dict, weights: Dict, k: int = 60): \"\"\"RRFèåˆç®—æ³•\"\"\" fused = {} for method, items in results.items(): weight = weights.get(method, 1.0) for rank, item in enumerate(items): item_id = item[\"id\"] if item_id not in fused: fused[item_id] = 0 # RRFå…¬å¼ fused[item_id] += weight / (k + rank + 1) return fused é‡æ’åº 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 class Reranker: \"\"\"é‡æ’åºå™¨\"\"\" def __init__(self): from sentence_transformers import CrossEncoder self.reranker = CrossEncoder( \"cross-encoder/ms-marco-MiniLM-L-6-v2\" ) def rerank(self, query: str, documents: List[Dict], top_k: int = 5): \"\"\"é‡æ’åº\"\"\" # è®¡ç®—æŸ¥è¯¢-æ–‡æ¡£ç›¸å…³æ€§åˆ†æ•° pairs = [[query, doc[\"text\"]] for doc in documents] scores = self.reranker.predict(pairs) # æ›´æ–°åˆ†æ•° for doc, score in zip(documents, scores): doc[\"rerank_score\"] = float(score) # æŒ‰æ–°åˆ†æ•°æ’åº reranked = sorted( documents, key=lambda x: x[\"rerank_score\"], reverse=True ) return reranked[:top_k] è¯„ä¼°ä½“ç³» 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 class RAGEvaluator: \"\"\"RAGç³»ç»Ÿè¯„ä¼°\"\"\" def evaluate( self, test_queries: List[Dict], rag_system: EnterpriseRAG ) -\u003e Dict[str, float]: \"\"\" test_queries: [ { \"query\": \"ä»€ä¹ˆæ˜¯æœºå™¨å­¦ä¹ ï¼Ÿ\", \"expected_answer\": \"æœºå™¨å­¦ä¹ æ˜¯...\", \"expected_docs\": [1, 3, 5] } ] \"\"\" metrics = { \"retrieval_precision\": [], \"retrieval_recall\": [], \"answer_relevance\": [], \"answer_faithfulness\": [] } for test in test_queries: # æ‰§è¡ŒæŸ¥è¯¢ result = rag_system.ask(test[\"query\"]) # æ£€ç´¢è¯„ä¼° retrieved_doc_ids = [s[\"doc_id\"] for s in result[\"sources\"]] expected_doc_ids = test[\"expected_docs\"] # ç²¾ç¡®ç‡ precision = len( set(retrieved_doc_ids) \u0026 set(expected_doc_ids) ) / len(retrieved_doc_ids) metrics[\"retrieval_precision\"].append(precision) # å¬å›ç‡ recall = len( set(retrieved_doc_ids) \u0026 set(expected_doc_ids) ) / len(expected_doc_ids) metrics[\"retrieval_recall\"].append(recall) # ç­”æ¡ˆç›¸å…³æ€§ relevance = self._compute_relevance( result[\"answer\"], test[\"expected_answer\"] ) metrics[\"answer_relevance\"].append(relevance) # å¿ å®åº¦ faithfulness = self._compute_faithfulness( result[\"answer\"], [s[\"text\"] for s in result[\"sources\"]] ) metrics[\"answer_faithfulness\"].append(faithfulness) # è®¡ç®—å¹³å‡æŒ‡æ ‡ return { k: sum(v) / len(v) for k, v in metrics.items() } def _compute_relevance(self, generated: str, expected: str) -\u003e float: \"\"\"è®¡ç®—ç›¸å…³æ€§ï¼ˆä½¿ç”¨ä½™å¼¦ç›¸ä¼¼åº¦ï¼‰\"\"\" from sentence_transformers import SentenceTransformer embedding_model = SentenceTransformer(\"all-MiniLM-L6-v2\") emb1 = embedding_model.encode([generated]) emb2 = embedding_model.encode([expected]) from sklearn.metrics.pairwise import cosine_similarity return cosine_similarity(emb1, emb2)[0][0] def _compute_faithfulness(self, answer: str, contexts: List[str]) -\u003e float: \"\"\"è®¡ç®—å¿ å®åº¦ï¼ˆç­”æ¡ˆæ˜¯å¦åŸºäºä¸Šä¸‹æ–‡ï¼‰\"\"\" # ç®€å•æ–¹æ³•ï¼šæ£€æŸ¥ç­”æ¡ˆä¸­çš„å…³é”®å®ä½“æ˜¯å¦åœ¨ä¸Šä¸‹æ–‡ä¸­ import spacy nlp = spacy.load(\"zh_core_web_sm\") doc = nlp(answer) entities = [ent.text for ent in doc.ents] found = sum( 1 for ent in entities if any(ent in ctx for ctx in contexts) ) return found / len(entities) if entities else 1.0 éƒ¨ç½²æ–¹æ¡ˆ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 from fastapi import FastAPI from pydantic import BaseModel app = FastAPI(title=\"Enterprise RAG API\") class Question(BaseModel): text: str top_k: int = 5 class Answer(BaseModel): answer: str sources: List[Dict] confidence: str # åˆå§‹åŒ–RAGç³»ç»Ÿ rag = EnterpriseRAG({ \"embed_model\": \"sentence-transformers/all-MiniLM-L6-v2\", \"vector_db\": { \"type\": \"pinecone\", \"api_key\": \"your-api-key\", \"environment\": \"us-east-1-aws\", \"index_name\": \"enterprise-kb\" }, \"llm\": { \"provider\": \"anthropic\", \"api_key\": \"your-api-key\" } }) # å¯åŠ¨æ—¶ç´¢å¼•æ–‡æ¡£ @app.on_event(\"startup\") async def startup(): documents = load_documents_from_s3() rag.index_documents(documents) @app.post(\"/api/ask\", response_model=Answer) async def ask(question: Question): \"\"\"é—®ç­”æ¥å£\"\"\" result = rag.ask(question.text, question.top_k) return Answer(**result) if __name__ == \"__main__\": import uvicorn uvicorn.run(app, host=\"0.0.0.0\", port=8000) æœ€ä½³å®è·µ æ–‡æ¡£é¢„å¤„ç†ï¼šæ¸…æ´—ã€å»é‡ã€åˆ†æ®µ åµŒå…¥æ¨¡å‹é€‰æ‹©ï¼šå¹³è¡¡æ€§èƒ½å’Œæˆæœ¬ å‘é‡æ•°æ®åº“ï¼šé€‰æ‹©åˆé€‚çš„è§„æ¨¡å’Œé…ç½® æ··åˆæ£€ç´¢ï¼šç»“åˆå‘é‡å’Œå…³é”®è¯æ£€ç´¢ é‡æ’åºï¼šæé«˜æ£€ç´¢ç²¾åº¦ ç¼“å­˜ç­–ç•¥ï¼šç¼“å­˜å¸¸è§é—®é¢˜ æŒç»­è¯„ä¼°ï¼šè·Ÿè¸ªç³»ç»Ÿæ€§èƒ½ RAGç³»ç»Ÿä¸æ˜¯ä¸€æˆä¸å˜çš„ï¼Œéœ€è¦æ ¹æ®å®é™…ä½¿ç”¨æƒ…å†µæŒç»­ä¼˜åŒ–ã€‚\n","wordCount":"1543","inLanguage":"zh-cn","datePublished":"2025-12-25T23:00:00+08:00","dateModified":"2025-12-25T23:00:00+08:00","author":{"@type":"Person","name":"æœ‰æ¡å·¥å…·å›¢é˜Ÿ"},"mainEntityOfPage":{"@type":"WebPage","@id":"/blog/articles/rag%E7%B3%BB%E7%BB%9F%E6%9E%84%E5%BB%BA%E5%AE%8C%E5%85%A8%E6%8C%87%E5%8D%97%E6%89%93%E9%80%A0%E4%BC%81%E4%B8%9A%E7%BA%A7%E7%9F%A5%E8%AF%86%E9%97%AE%E7%AD%94%E7%B3%BB%E7%BB%9F/"},"publisher":{"@type":"Organization","name":"æŠ€æœ¯åšå®¢ - æœ‰æ¡å·¥å…·","logo":{"@type":"ImageObject","url":"/favicon.ico"}}}</script></head><body id=top><header class=header><nav class=nav><div class=logo><a href=/blog/ accesskey=h title="æŠ€æœ¯åšå®¢ - æœ‰æ¡å·¥å…· (Alt + H)">æŠ€æœ¯åšå®¢ - æœ‰æ¡å·¥å…·</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=/blog/posts/ title="æ‰€æœ‰æ–‡ç« åˆ—è¡¨ - æœ‰æ¡å·¥å…·æŠ€æœ¯åšå®¢ï¼šæŸ¥çœ‹æ‰€æœ‰æŠ€æœ¯æ–‡ç« å’Œæ•™ç¨‹å†…å®¹"><span>æ–‡ç« </span></a></li><li><a href=https://www.util.cn title="æœ‰æ¡å·¥å…· - å¼€å‘è€…çš„å¸¸ç”¨å·¥å…·é›†åˆï¼šæ— å¹¿å‘Š Â· æœ¬åœ°è®¡ç®— Â· å³å¼€å³ç”¨çš„åœ¨çº¿å·¥å…·å¹³å°ï¼Œæä¾›JSONæ ¼å¼åŒ–ã€SQLæ ¼å¼åŒ–ã€Markdownç¼–è¾‘å™¨ç­‰å®ç”¨å·¥å…·"><span>æœ‰æ¡å·¥å…·</span>&nbsp;
<svg fill="none" shape-rendering="geometricPrecision" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" height="12" width="12"><path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"/><path d="M15 3h6v6"/><path d="M10 14 21 3"/></svg></a></li><li><a href=/blog/categories/ title="æ–‡ç« åˆ†ç±» - æœ‰æ¡å·¥å…·æŠ€æœ¯åšå®¢ï¼šæŒ‰æŠ€æœ¯é¢†åŸŸåˆ†ç±»çš„ä¼˜è´¨æ–‡ç« ï¼ŒåŒ…æ‹¬å‰ç«¯å¼€å‘ã€å·¥å…·ä½¿ç”¨ã€ç¼–ç¨‹æŠ€å·§ç­‰"><span>åˆ†ç±»</span></a></li><li><a href=/blog/tags/ title="æ ‡ç­¾äº‘ - æœ‰æ¡å·¥å…·æŠ€æœ¯åšå®¢ï¼šé€šè¿‡æ ‡ç­¾å¿«é€Ÿæ‰¾åˆ°æ„Ÿå…´è¶£çš„æŠ€æœ¯æ–‡ç« å’Œæ•™ç¨‹å†…å®¹"><span>æ ‡ç­¾</span></a></li><li><a href=/blog/archives/ title="æ–‡ç« å½’æ¡£ - æœ‰æ¡å·¥å…·æŠ€æœ¯åšå®¢ï¼šæŒ‰æ—¶é—´æŸ¥çœ‹å†å²æ–‡ç« "><span>å½’æ¡£</span></a></li><li><a href=/blog/search/ title="æœç´¢æ–‡ç«  - æœ‰æ¡å·¥å…·æŠ€æœ¯åšå®¢ï¼šé€šè¿‡å…³é”®è¯æœç´¢æ‰¾åˆ°æ„Ÿå…´è¶£çš„æŠ€æœ¯æ–‡ç« å’Œæ•™ç¨‹å†…å®¹ï¼Œæ”¯æŒæ ‡é¢˜ã€å†…å®¹ã€åˆ†ç±»å’Œæ ‡ç­¾æœç´¢"><span>æœç´¢</span></a></li></ul></nav></header><main class=main><article class=post-single><div class=post-content-wrapper><main class=post-content-main><header class=post-header-main><h1 class="post-title entry-hint-parent">RAGç³»ç»Ÿæ„å»ºå®Œå…¨æŒ‡å—ï¼šæ‰“é€ ä¼ä¸šçº§çŸ¥è¯†é—®ç­”ç³»ç»Ÿ</h1><div class=post-meta><div class=post-meta-content><div class=post-categories-inline><a href=/blog/categories/ai%E5%BC%80%E5%8F%91/ class=category-link>AIå¼€å‘</a></div><span class=post-date>2025-12-25</span><span class=post-author>æœ‰æ¡å·¥å…·å›¢é˜Ÿ</span></div><style>.post-meta-content{display:flex;align-items:center;flex-wrap:wrap;gap:.75rem;font-family:sf mono,monaco,courier new,monospace;font-size:.875rem;color:#9ca3af !important}.post-categories-inline{display:inline-flex;align-items:center;gap:.5rem}.category-link{display:inline-flex;align-items:center;gap:.25rem;padding:.25rem .75rem;background:rgba(255,255,255,.1);color:#e5e7eb !important;text-decoration:none;font-size:.75rem;font-weight:600;text-transform:uppercase;letter-spacing:.05em;border:1px solid rgba(255,255,255,.2);border-radius:0;transition:all .3s ease;white-space:nowrap}.category-link:hover{background:rgba(255,255,255,.2);color:#fff !important;border-color:rgba(255,255,255,.3);transform:translateY(-1px)}.category-link::before{content:'ğŸ“';font-size:.7rem;opacity:.8}.post-date,.post-reading-time,.post-word-count,.post-author{color:#9ca3af !important}[data-theme=dark] .post-meta-content{color:#9ca3af !important}[data-theme=dark] .category-link{background:rgba(255,255,255,.1);color:#e5e7eb !important;border-color:rgba(255,255,255,.2)}[data-theme=dark] .category-link:hover{background:rgba(255,255,255,.2);color:#fff !important;border-color:rgba(255,255,255,.3)}[data-theme=dark] .post-date,[data-theme=dark] .post-reading-time,[data-theme=dark] .post-word-count,[data-theme=dark] .post-author{color:#9ca3af !important}[data-theme=light] .post-meta-content{color:#6c757d !important}[data-theme=light] .category-link{background:rgba(0,0,0,5%);color:#495057 !important;border-color:rgba(0,0,0,.15)}[data-theme=light] .category-link:hover{background:rgba(0,102,204,.1);color:#212529 !important;border-color:rgba(0,102,204,.3)}[data-theme=light] .post-date,[data-theme=light] .post-reading-time,[data-theme=light] .post-word-count,[data-theme=light] .post-author{color:#6c757d !important}@media(max-width:768px){.post-meta-content{gap:.5rem;font-size:.8rem}.category-link{padding:.2rem .6rem;font-size:.7rem}}</style></div></header><div class=post-content><p>æ£€ç´¢å¢å¼ºç”Ÿæˆï¼ˆRetrieval-Augmented Generation, RAGï¼‰æ˜¯å¤§è¯­è¨€æ¨¡å‹åº”ç”¨çš„æ ¸å¿ƒæŠ€æœ¯ã€‚å®ƒç»“åˆäº†ä¿¡æ¯æ£€ç´¢å’Œç”Ÿæˆå¼AIçš„èƒ½åŠ›ï¼Œè®©LLMèƒ½å¤Ÿè®¿é—®å’Œåˆ©ç”¨å¤–éƒ¨çŸ¥è¯†åº“ï¼Œæä¾›æ›´å‡†ç¡®ã€æ›´å¯é çš„å›ç­”ã€‚</p><h2 id=rag-æ ¸å¿ƒæ¦‚å¿µ>RAG æ ¸å¿ƒæ¦‚å¿µ<a hidden class=anchor aria-hidden=true href=#rag-æ ¸å¿ƒæ¦‚å¿µ>#</a></h2><h3 id=å·¥ä½œæµç¨‹>å·¥ä½œæµç¨‹<a hidden class=anchor aria-hidden=true href=#å·¥ä½œæµç¨‹>#</a></h3><pre tabindex=0><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç”¨æˆ·    â”‚â”€â”€â”€&gt;â”‚ æ£€ç´¢å™¨  â”‚â”€â”€â”€&gt;â”‚ LLM     â”‚â”€â”€â”€&gt;â”‚ ç­”æ¡ˆ    â”‚
â”‚ é—®é¢˜    â”‚    â”‚         â”‚    â”‚         â”‚    â”‚         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚  å‘é‡æ•°æ®åº“  â”‚
              â”‚  (çŸ¥è¯†åº“)    â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre><h2 id=ç³»ç»Ÿæ¶æ„è®¾è®¡>ç³»ç»Ÿæ¶æ„è®¾è®¡<a hidden class=anchor aria-hidden=true href=#ç³»ç»Ÿæ¶æ„è®¾è®¡>#</a></h2><h3 id=å®Œæ•´çš„ragæµç¨‹>å®Œæ•´çš„RAGæµç¨‹<a hidden class=anchor aria-hidden=true href=#å®Œæ•´çš„ragæµç¨‹>#</a></h3><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 56
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 57
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 58
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 59
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 60
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 61
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 62
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 63
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 64
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 65
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 66
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 67
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 68
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 69
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 70
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 71
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 72
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 73
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 74
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 75
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 76
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 77
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 78
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 79
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 80
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 81
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 82
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 83
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 84
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 85
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 86
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 87
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 88
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 89
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 90
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 91
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 92
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 93
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 94
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 95
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 96
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 97
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 98
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 99
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">100
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">101
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">102
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">103
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">104
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">105
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">106
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">107
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">108
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">109
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">110
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">111
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">112
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">113
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">114
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">115
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">116
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">117
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">118
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">119
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">120
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">121
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">122
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">123
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">124
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">125
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">126
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">127
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">128
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">129
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">130
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">131
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">132
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">133
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">134
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">135
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">136
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">137
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">138
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">139
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">140
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">141
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">142
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">143
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">144
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">145
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">146
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">147
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">148
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">149
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">150
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">151
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">152
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">153
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">154
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">155
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">156
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">157
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">158
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">159
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">160
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">161
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">162
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">163
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">164
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">165
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">166
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">167
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">168
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">169
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">170
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">171
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">172
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">173
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">174
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">175
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">176
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">177
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">178
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">179
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">180
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">181
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">182
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">183
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">184
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">185
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">186
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">187
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">188
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">189
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">190
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">191
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">192
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">193
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">194
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">195
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">196
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">197
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">198
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">199
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">200
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">201
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">202
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">203
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">204
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">205
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">206
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">207
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">208
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">209
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">210
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">211
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">212
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">213
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">214
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">215
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">216
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">217
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">218
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">219
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">220
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">221
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">222
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">223
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">224
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">225
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">226
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">227
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">228
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">229
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">230
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">231
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">232
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">233
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">234
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">235
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">236
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">237
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">238
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">239
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">240
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">241
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">242
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">243
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">244
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">245
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">246
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">247
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">248
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">249
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">250
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">251
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">252
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">253
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">254
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">255
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">256
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">257
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">258
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">259
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">260
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">261
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">262
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">263
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">264
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">265
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">266
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#ff7b72>from</span> <span style=color:#ff7b72>typing</span> <span style=color:#ff7b72>import</span> List, Dict, Any
</span></span><span style=display:flex><span><span style=color:#ff7b72>from</span> <span style=color:#ff7b72>sentence_transformers</span> <span style=color:#ff7b72>import</span> SentenceTransformer
</span></span><span style=display:flex><span><span style=color:#ff7b72>import</span> <span style=color:#ff7b72>numpy</span> <span style=color:#ff7b72>as</span> <span style=color:#ff7b72>np</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>class</span> <span style=color:#f0883e;font-weight:700>EnterpriseRAG</span>:
</span></span><span style=display:flex><span>    <span style=color:#a5d6ff>&#34;&#34;&#34;ä¼ä¸šçº§RAGç³»ç»Ÿ&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>__init__</span>(self, config: Dict[str, Any]):
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># é…ç½®</span>
</span></span><span style=display:flex><span>        self<span style=color:#ff7b72;font-weight:700>.</span>config <span style=color:#ff7b72;font-weight:700>=</span> config
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># åµŒå…¥æ¨¡å‹</span>
</span></span><span style=display:flex><span>        self<span style=color:#ff7b72;font-weight:700>.</span>embedder <span style=color:#ff7b72;font-weight:700>=</span> SentenceTransformer(
</span></span><span style=display:flex><span>            config<span style=color:#ff7b72;font-weight:700>.</span>get(<span style=color:#a5d6ff>&#34;embed_model&#34;</span>, <span style=color:#a5d6ff>&#34;sentence-transformers/all-MiniLM-L6-v2&#34;</span>)
</span></span><span style=display:flex><span>        )
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># å‘é‡æ•°æ®åº“</span>
</span></span><span style=display:flex><span>        self<span style=color:#ff7b72;font-weight:700>.</span>vector_db <span style=color:#ff7b72;font-weight:700>=</span> self<span style=color:#ff7b72;font-weight:700>.</span>_init_vector_db(config<span style=color:#ff7b72;font-weight:700>.</span>get(<span style=color:#a5d6ff>&#34;vector_db&#34;</span>))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># LLMå®¢æˆ·ç«¯</span>
</span></span><span style=display:flex><span>        self<span style=color:#ff7b72;font-weight:700>.</span>llm <span style=color:#ff7b72;font-weight:700>=</span> self<span style=color:#ff7b72;font-weight:700>.</span>_init_llm(config<span style=color:#ff7b72;font-weight:700>.</span>get(<span style=color:#a5d6ff>&#34;llm&#34;</span>))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>_init_vector_db</span>(self, db_config: Dict):
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;&#34;&#34;åˆå§‹åŒ–å‘é‡æ•°æ®åº“&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        db_type <span style=color:#ff7b72;font-weight:700>=</span> db_config<span style=color:#ff7b72;font-weight:700>.</span>get(<span style=color:#a5d6ff>&#34;type&#34;</span>, <span style=color:#a5d6ff>&#34;faiss&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>if</span> db_type <span style=color:#ff7b72;font-weight:700>==</span> <span style=color:#a5d6ff>&#34;faiss&#34;</span>:
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>import</span> <span style=color:#ff7b72>faiss</span>
</span></span><span style=display:flex><span>            dimension <span style=color:#ff7b72;font-weight:700>=</span> self<span style=color:#ff7b72;font-weight:700>.</span>embedder<span style=color:#ff7b72;font-weight:700>.</span>get_sentence_embedding_dimension()
</span></span><span style=display:flex><span>            index <span style=color:#ff7b72;font-weight:700>=</span> faiss<span style=color:#ff7b72;font-weight:700>.</span>IndexFlatIP(dimension)
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>return</span> {<span style=color:#a5d6ff>&#34;type&#34;</span>: <span style=color:#a5d6ff>&#34;faiss&#34;</span>, <span style=color:#a5d6ff>&#34;index&#34;</span>: index}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>elif</span> db_type <span style=color:#ff7b72;font-weight:700>==</span> <span style=color:#a5d6ff>&#34;pinecone&#34;</span>:
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>import</span> <span style=color:#ff7b72>pinecone</span>
</span></span><span style=display:flex><span>            pinecone<span style=color:#ff7b72;font-weight:700>.</span>init(
</span></span><span style=display:flex><span>                api_key<span style=color:#ff7b72;font-weight:700>=</span>db_config[<span style=color:#a5d6ff>&#34;api_key&#34;</span>],
</span></span><span style=display:flex><span>                environment<span style=color:#ff7b72;font-weight:700>=</span>db_config[<span style=color:#a5d6ff>&#34;environment&#34;</span>]
</span></span><span style=display:flex><span>            )
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>return</span> {<span style=color:#a5d6ff>&#34;type&#34;</span>: <span style=color:#a5d6ff>&#34;pinecone&#34;</span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>elif</span> db_type <span style=color:#ff7b72;font-weight:700>==</span> <span style=color:#a5d6ff>&#34;milvus&#34;</span>:
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>from</span> <span style=color:#ff7b72>pymilvus</span> <span style=color:#ff7b72>import</span> connections, Collection
</span></span><span style=display:flex><span>            connections<span style=color:#ff7b72;font-weight:700>.</span>connect(
</span></span><span style=display:flex><span>                alias<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>&#34;default&#34;</span>,
</span></span><span style=display:flex><span>                host<span style=color:#ff7b72;font-weight:700>=</span>db_config[<span style=color:#a5d6ff>&#34;host&#34;</span>],
</span></span><span style=display:flex><span>                port<span style=color:#ff7b72;font-weight:700>=</span>db_config[<span style=color:#a5d6ff>&#34;port&#34;</span>]
</span></span><span style=display:flex><span>            )
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>return</span> {<span style=color:#a5d6ff>&#34;type&#34;</span>: <span style=color:#a5d6ff>&#34;milvus&#34;</span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>_init_llm</span>(self, llm_config: Dict):
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;&#34;&#34;åˆå§‹åŒ–LLM&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        provider <span style=color:#ff7b72;font-weight:700>=</span> llm_config<span style=color:#ff7b72;font-weight:700>.</span>get(<span style=color:#a5d6ff>&#34;provider&#34;</span>, <span style=color:#a5d6ff>&#34;anthropic&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>if</span> provider <span style=color:#ff7b72;font-weight:700>==</span> <span style=color:#a5d6ff>&#34;anthropic&#34;</span>:
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>from</span> <span style=color:#ff7b72>anthropic</span> <span style=color:#ff7b72>import</span> Anthropic
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>return</span> Anthropic(api_key<span style=color:#ff7b72;font-weight:700>=</span>llm_config[<span style=color:#a5d6ff>&#34;api_key&#34;</span>])
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>elif</span> provider <span style=color:#ff7b72;font-weight:700>==</span> <span style=color:#a5d6ff>&#34;openai&#34;</span>:
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>from</span> <span style=color:#ff7b72>openai</span> <span style=color:#ff7b72>import</span> OpenAI
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>return</span> OpenAI(api_key<span style=color:#ff7b72;font-weight:700>=</span>llm_config[<span style=color:#a5d6ff>&#34;api_key&#34;</span>])
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>elif</span> provider <span style=color:#ff7b72;font-weight:700>==</span> <span style=color:#a5d6ff>&#34;local&#34;</span>:
</span></span><span style=display:flex><span>            <span style=color:#8b949e;font-style:italic># ä½¿ç”¨æœ¬åœ°æ¨¡å‹</span>
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>return</span> <span style=color:#79c0ff>None</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>index_documents</span>(self, documents: List[Dict[str, Any]]):
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;&#34;&#34;ç´¢å¼•æ–‡æ¡£&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># æå–æ–‡æœ¬</span>
</span></span><span style=display:flex><span>        texts <span style=color:#ff7b72;font-weight:700>=</span> [doc[<span style=color:#a5d6ff>&#34;content&#34;</span>] <span style=color:#ff7b72>for</span> doc <span style=color:#ff7b72;font-weight:700>in</span> documents]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># æ–‡æœ¬åˆ‡åˆ†</span>
</span></span><span style=display:flex><span>        chunks <span style=color:#ff7b72;font-weight:700>=</span> self<span style=color:#ff7b72;font-weight:700>.</span>_chunk_texts(texts, chunk_size<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>500</span>, overlap<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>50</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># ç”ŸæˆåµŒå…¥</span>
</span></span><span style=display:flex><span>        embeddings <span style=color:#ff7b72;font-weight:700>=</span> self<span style=color:#ff7b72;font-weight:700>.</span>embedder<span style=color:#ff7b72;font-weight:700>.</span>encode(
</span></span><span style=display:flex><span>            [chunk[<span style=color:#a5d6ff>&#34;text&#34;</span>] <span style=color:#ff7b72>for</span> chunk <span style=color:#ff7b72;font-weight:700>in</span> chunks]
</span></span><span style=display:flex><span>        )
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># å­˜å‚¨åˆ°å‘é‡æ•°æ®åº“</span>
</span></span><span style=display:flex><span>        self<span style=color:#ff7b72;font-weight:700>.</span>_store_embeddings(chunks, embeddings)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>_chunk_texts</span>(
</span></span><span style=display:flex><span>        self,
</span></span><span style=display:flex><span>        texts: List[str],
</span></span><span style=display:flex><span>        chunk_size: int <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>500</span>,
</span></span><span style=display:flex><span>        overlap: int <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>50</span>
</span></span><span style=display:flex><span>    ) <span style=color:#ff7b72;font-weight:700>-&gt;</span> List[Dict]:
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;&#34;&#34;æ–‡æœ¬åˆ‡åˆ†&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        chunks <span style=color:#ff7b72;font-weight:700>=</span> []
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>for</span> idx, text <span style=color:#ff7b72;font-weight:700>in</span> enumerate(texts):
</span></span><span style=display:flex><span>            <span style=color:#8b949e;font-style:italic># æŒ‰æ®µè½åˆ‡åˆ†</span>
</span></span><span style=display:flex><span>            paragraphs <span style=color:#ff7b72;font-weight:700>=</span> text<span style=color:#ff7b72;font-weight:700>.</span>split(<span style=color:#a5d6ff>&#34;</span><span style=color:#79c0ff>\n\n</span><span style=color:#a5d6ff>&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            current_chunk <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>&#34;&#34;</span>
</span></span><span style=display:flex><span>            chunk_id <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>0</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>for</span> para <span style=color:#ff7b72;font-weight:700>in</span> paragraphs:
</span></span><span style=display:flex><span>                <span style=color:#ff7b72>if</span> len(current_chunk) <span style=color:#ff7b72;font-weight:700>+</span> len(para) <span style=color:#ff7b72;font-weight:700>&gt;</span> chunk_size:
</span></span><span style=display:flex><span>                    <span style=color:#ff7b72>if</span> current_chunk:
</span></span><span style=display:flex><span>                        chunks<span style=color:#ff7b72;font-weight:700>.</span>append({
</span></span><span style=display:flex><span>                            <span style=color:#a5d6ff>&#34;text&#34;</span>: current_chunk<span style=color:#ff7b72;font-weight:700>.</span>strip(),
</span></span><span style=display:flex><span>                            <span style=color:#a5d6ff>&#34;doc_id&#34;</span>: idx,
</span></span><span style=display:flex><span>                            <span style=color:#a5d6ff>&#34;chunk_id&#34;</span>: chunk_id
</span></span><span style=display:flex><span>                        })
</span></span><span style=display:flex><span>                        chunk_id <span style=color:#ff7b72;font-weight:700>+=</span> <span style=color:#a5d6ff>1</span>
</span></span><span style=display:flex><span>                    current_chunk <span style=color:#ff7b72;font-weight:700>=</span> para[overlap:]
</span></span><span style=display:flex><span>                <span style=color:#ff7b72>else</span>:
</span></span><span style=display:flex><span>                    current_chunk <span style=color:#ff7b72;font-weight:700>+=</span> <span style=color:#a5d6ff>&#34;</span><span style=color:#79c0ff>\n\n</span><span style=color:#a5d6ff>&#34;</span> <span style=color:#ff7b72;font-weight:700>+</span> para
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>if</span> current_chunk:
</span></span><span style=display:flex><span>                chunks<span style=color:#ff7b72;font-weight:700>.</span>append({
</span></span><span style=display:flex><span>                    <span style=color:#a5d6ff>&#34;text&#34;</span>: current_chunk<span style=color:#ff7b72;font-weight:700>.</span>strip(),
</span></span><span style=display:flex><span>                    <span style=color:#a5d6ff>&#34;doc_id&#34;</span>: idx,
</span></span><span style=display:flex><span>                    <span style=color:#a5d6ff>&#34;chunk_id&#34;</span>: chunk_id
</span></span><span style=display:flex><span>                })
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>return</span> chunks
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>_store_embeddings</span>(self, chunks: List[Dict], embeddings: np<span style=color:#ff7b72;font-weight:700>.</span>ndarray):
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;&#34;&#34;å­˜å‚¨åµŒå…¥&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        db_type <span style=color:#ff7b72;font-weight:700>=</span> self<span style=color:#ff7b72;font-weight:700>.</span>vector_db[<span style=color:#a5d6ff>&#34;type&#34;</span>]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>if</span> db_type <span style=color:#ff7b72;font-weight:700>==</span> <span style=color:#a5d6ff>&#34;faiss&#34;</span>:
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>import</span> <span style=color:#ff7b72>faiss</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#8b949e;font-style:italic># å½’ä¸€åŒ–</span>
</span></span><span style=display:flex><span>            faiss<span style=color:#ff7b72;font-weight:700>.</span>normalize_L2(embeddings)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#8b949e;font-style:italic># æ·»åŠ åˆ°ç´¢å¼•</span>
</span></span><span style=display:flex><span>            self<span style=color:#ff7b72;font-weight:700>.</span>vector_db[<span style=color:#a5d6ff>&#34;index&#34;</span>]<span style=color:#ff7b72;font-weight:700>.</span>add(
</span></span><span style=display:flex><span>                embeddings<span style=color:#ff7b72;font-weight:700>.</span>astype(<span style=color:#a5d6ff>&#34;float32&#34;</span>)
</span></span><span style=display:flex><span>            )
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#8b949e;font-style:italic># å­˜å‚¨å…ƒæ•°æ®</span>
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>if</span> <span style=color:#a5d6ff>&#34;metadata&#34;</span> <span style=color:#ff7b72;font-weight:700>not</span> <span style=color:#ff7b72;font-weight:700>in</span> self<span style=color:#ff7b72;font-weight:700>.</span>vector_db:
</span></span><span style=display:flex><span>                self<span style=color:#ff7b72;font-weight:700>.</span>vector_db[<span style=color:#a5d6ff>&#34;metadata&#34;</span>] <span style=color:#ff7b72;font-weight:700>=</span> []
</span></span><span style=display:flex><span>            self<span style=color:#ff7b72;font-weight:700>.</span>vector_db[<span style=color:#a5d6ff>&#34;metadata&#34;</span>]<span style=color:#ff7b72;font-weight:700>.</span>extend(chunks)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>elif</span> db_type <span style=color:#ff7b72;font-weight:700>==</span> <span style=color:#a5d6ff>&#34;pinecone&#34;</span>:
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>import</span> <span style=color:#ff7b72>pinecone</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            index <span style=color:#ff7b72;font-weight:700>=</span> pinecone<span style=color:#ff7b72;font-weight:700>.</span>Index(self<span style=color:#ff7b72;font-weight:700>.</span>vector_db[<span style=color:#a5d6ff>&#34;index_name&#34;</span>])
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>for</span> i, (chunk, embedding) <span style=color:#ff7b72;font-weight:700>in</span> enumerate(zip(chunks, embeddings)):
</span></span><span style=display:flex><span>                index<span style=color:#ff7b72;font-weight:700>.</span>upsert([
</span></span><span style=display:flex><span>                    (str(i), embedding<span style=color:#ff7b72;font-weight:700>.</span>tolist(), {
</span></span><span style=display:flex><span>                        <span style=color:#a5d6ff>&#34;text&#34;</span>: chunk[<span style=color:#a5d6ff>&#34;text&#34;</span>],
</span></span><span style=display:flex><span>                        <span style=color:#a5d6ff>&#34;doc_id&#34;</span>: chunk[<span style=color:#a5d6ff>&#34;doc_id&#34;</span>]
</span></span><span style=display:flex><span>                    })
</span></span><span style=display:flex><span>                ])
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>retrieve</span>(self, query: str, top_k: int <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>5</span>) <span style=color:#ff7b72;font-weight:700>-&gt;</span> List[Dict]:
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;&#34;&#34;æ£€ç´¢ç›¸å…³æ–‡æ¡£&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># ç”ŸæˆæŸ¥è¯¢åµŒå…¥</span>
</span></span><span style=display:flex><span>        query_embedding <span style=color:#ff7b72;font-weight:700>=</span> self<span style=color:#ff7b72;font-weight:700>.</span>embedder<span style=color:#ff7b72;font-weight:700>.</span>encode([query])
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        db_type <span style=color:#ff7b72;font-weight:700>=</span> self<span style=color:#ff7b72;font-weight:700>.</span>vector_db[<span style=color:#a5d6ff>&#34;type&#34;</span>]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>if</span> db_type <span style=color:#ff7b72;font-weight:700>==</span> <span style=color:#a5d6ff>&#34;faiss&#34;</span>:
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>import</span> <span style=color:#ff7b72>faiss</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#8b949e;font-style:italic># å½’ä¸€åŒ–</span>
</span></span><span style=display:flex><span>            faiss<span style=color:#ff7b72;font-weight:700>.</span>normalize_L2(query_embedding)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#8b949e;font-style:italic># æœç´¢</span>
</span></span><span style=display:flex><span>            scores, indices <span style=color:#ff7b72;font-weight:700>=</span> self<span style=color:#ff7b72;font-weight:700>.</span>vector_db[<span style=color:#a5d6ff>&#34;index&#34;</span>]<span style=color:#ff7b72;font-weight:700>.</span>search(
</span></span><span style=display:flex><span>                query_embedding<span style=color:#ff7b72;font-weight:700>.</span>astype(<span style=color:#a5d6ff>&#34;float32&#34;</span>),
</span></span><span style=display:flex><span>                top_k
</span></span><span style=display:flex><span>            )
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#8b949e;font-style:italic># ç»„è£…ç»“æœ</span>
</span></span><span style=display:flex><span>            results <span style=color:#ff7b72;font-weight:700>=</span> []
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>for</span> score, idx <span style=color:#ff7b72;font-weight:700>in</span> zip(scores[<span style=color:#a5d6ff>0</span>], indices[<span style=color:#a5d6ff>0</span>]):
</span></span><span style=display:flex><span>                <span style=color:#ff7b72>if</span> idx <span style=color:#ff7b72;font-weight:700>&lt;</span> len(self<span style=color:#ff7b72;font-weight:700>.</span>vector_db[<span style=color:#a5d6ff>&#34;metadata&#34;</span>]):
</span></span><span style=display:flex><span>                    meta <span style=color:#ff7b72;font-weight:700>=</span> self<span style=color:#ff7b72;font-weight:700>.</span>vector_db[<span style=color:#a5d6ff>&#34;metadata&#34;</span>][idx]
</span></span><span style=display:flex><span>                    results<span style=color:#ff7b72;font-weight:700>.</span>append({
</span></span><span style=display:flex><span>                        <span style=color:#a5d6ff>&#34;text&#34;</span>: meta[<span style=color:#a5d6ff>&#34;text&#34;</span>],
</span></span><span style=display:flex><span>                        <span style=color:#a5d6ff>&#34;score&#34;</span>: float(score),
</span></span><span style=display:flex><span>                        <span style=color:#a5d6ff>&#34;doc_id&#34;</span>: meta[<span style=color:#a5d6ff>&#34;doc_id&#34;</span>]
</span></span><span style=display:flex><span>                    })
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>return</span> results
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>elif</span> db_type <span style=color:#ff7b72;font-weight:700>==</span> <span style=color:#a5d6ff>&#34;pinecone&#34;</span>:
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>import</span> <span style=color:#ff7b72>pinecone</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            index <span style=color:#ff7b72;font-weight:700>=</span> pinecone<span style=color:#ff7b72;font-weight:700>.</span>Index(self<span style=color:#ff7b72;font-weight:700>.</span>vector_db[<span style=color:#a5d6ff>&#34;index_name&#34;</span>])
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            query_result <span style=color:#ff7b72;font-weight:700>=</span> index<span style=color:#ff7b72;font-weight:700>.</span>query(
</span></span><span style=display:flex><span>                vector<span style=color:#ff7b72;font-weight:700>=</span>query_embedding[<span style=color:#a5d6ff>0</span>]<span style=color:#ff7b72;font-weight:700>.</span>tolist(),
</span></span><span style=display:flex><span>                top_k<span style=color:#ff7b72;font-weight:700>=</span>top_k,
</span></span><span style=display:flex><span>                include_metadata<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#79c0ff>True</span>
</span></span><span style=display:flex><span>            )
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>return</span> [
</span></span><span style=display:flex><span>                {
</span></span><span style=display:flex><span>                    <span style=color:#a5d6ff>&#34;text&#34;</span>: <span style=color:#ff7b72>match</span>[<span style=color:#a5d6ff>&#34;metadata&#34;</span>][<span style=color:#a5d6ff>&#34;text&#34;</span>],
</span></span><span style=display:flex><span>                    <span style=color:#a5d6ff>&#34;score&#34;</span>: <span style=color:#ff7b72>match</span>[<span style=color:#a5d6ff>&#34;score&#34;</span>],
</span></span><span style=display:flex><span>                    <span style=color:#a5d6ff>&#34;doc_id&#34;</span>: <span style=color:#ff7b72>match</span>[<span style=color:#a5d6ff>&#34;metadata&#34;</span>][<span style=color:#a5d6ff>&#34;doc_id&#34;</span>]
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>                <span style=color:#ff7b72>for</span> <span style=color:#ff7b72>match</span> <span style=color:#ff7b72;font-weight:700>in</span> query_result[<span style=color:#a5d6ff>&#34;matches&#34;</span>]
</span></span><span style=display:flex><span>            ]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>generate</span>(self, query: str, context: List[Dict]) <span style=color:#ff7b72;font-weight:700>-&gt;</span> str:
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;&#34;&#34;ç”Ÿæˆå›ç­”&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># æ„å»ºæç¤º</span>
</span></span><span style=display:flex><span>        context_text <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>&#34;</span><span style=color:#79c0ff>\n\n</span><span style=color:#a5d6ff>&#34;</span><span style=color:#ff7b72;font-weight:700>.</span>join([
</span></span><span style=display:flex><span>            <span style=color:#79c0ff>f</span><span style=color:#a5d6ff>&#34;[æ–‡æ¡£</span><span style=color:#a5d6ff>{</span>i<span style=color:#ff7b72;font-weight:700>+</span><span style=color:#a5d6ff>1</span><span style=color:#a5d6ff>}</span><span style=color:#a5d6ff>] </span><span style=color:#a5d6ff>{</span>doc[<span style=color:#a5d6ff>&#39;text&#39;</span>]<span style=color:#a5d6ff>}</span><span style=color:#a5d6ff>&#34;</span>
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>for</span> i, doc <span style=color:#ff7b72;font-weight:700>in</span> enumerate(context)
</span></span><span style=display:flex><span>        ])
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        prompt <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#79c0ff>f</span><span style=color:#a5d6ff>&#34;&#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>åŸºäºä»¥ä¸‹æ–‡æ¡£å›ç­”é—®é¢˜ã€‚å¦‚æœæ–‡æ¡£ä¸­æ²¡æœ‰ç›¸å…³ä¿¡æ¯ï¼Œè¯·æ˜ç¡®è¯´æ˜ã€‚
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff></span><span style=color:#a5d6ff>{</span>context_text<span style=color:#a5d6ff>}</span><span style=color:#a5d6ff>
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>é—®é¢˜ï¼š</span><span style=color:#a5d6ff>{</span>query<span style=color:#a5d6ff>}</span><span style=color:#a5d6ff>
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>å›ç­”ï¼š
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># è°ƒç”¨LLM</span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>if</span> self<span style=color:#ff7b72;font-weight:700>.</span>llm:
</span></span><span style=display:flex><span>            response <span style=color:#ff7b72;font-weight:700>=</span> self<span style=color:#ff7b72;font-weight:700>.</span>llm<span style=color:#ff7b72;font-weight:700>.</span>messages<span style=color:#ff7b72;font-weight:700>.</span>create(
</span></span><span style=display:flex><span>                model<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>&#34;claude-3-5-sonnet-20241022&#34;</span>,
</span></span><span style=display:flex><span>                max_tokens<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>2048</span>,
</span></span><span style=display:flex><span>                messages<span style=color:#ff7b72;font-weight:700>=</span>[{<span style=color:#a5d6ff>&#34;role&#34;</span>: <span style=color:#a5d6ff>&#34;user&#34;</span>, <span style=color:#a5d6ff>&#34;content&#34;</span>: prompt}]
</span></span><span style=display:flex><span>            )
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>return</span> response<span style=color:#ff7b72;font-weight:700>.</span>content[<span style=color:#a5d6ff>0</span>]<span style=color:#ff7b72;font-weight:700>.</span>text
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>else</span>:
</span></span><span style=display:flex><span>            <span style=color:#8b949e;font-style:italic># æœ¬åœ°æ¨¡å‹</span>
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>pass</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>ask</span>(self, query: str, top_k: int <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>5</span>) <span style=color:#ff7b72;font-weight:700>-&gt;</span> Dict[str, Any]:
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;&#34;&#34;é—®ç­”æ¥å£&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># æ£€ç´¢</span>
</span></span><span style=display:flex><span>        retrieved_docs <span style=color:#ff7b72;font-weight:700>=</span> self<span style=color:#ff7b72;font-weight:700>.</span>retrieve(query, top_k<span style=color:#ff7b72;font-weight:700>=</span>top_k)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># æ£€æŸ¥ç›¸å…³æ€§</span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>if</span> retrieved_docs <span style=color:#ff7b72;font-weight:700>and</span> retrieved_docs[<span style=color:#a5d6ff>0</span>][<span style=color:#a5d6ff>&#34;score&#34;</span>] <span style=color:#ff7b72;font-weight:700>&lt;</span> <span style=color:#a5d6ff>0.5</span>:
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>return</span> {
</span></span><span style=display:flex><span>                <span style=color:#a5d6ff>&#34;answer&#34;</span>: <span style=color:#a5d6ff>&#34;æŠ±æ­‰ï¼Œæˆ‘åœ¨çŸ¥è¯†åº“ä¸­æ²¡æœ‰æ‰¾åˆ°ç›¸å…³ä¿¡æ¯ã€‚&#34;</span>,
</span></span><span style=display:flex><span>                <span style=color:#a5d6ff>&#34;sources&#34;</span>: [],
</span></span><span style=display:flex><span>                <span style=color:#a5d6ff>&#34;confidence&#34;</span>: <span style=color:#a5d6ff>&#34;low&#34;</span>
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># ç”Ÿæˆ</span>
</span></span><span style=display:flex><span>        answer <span style=color:#ff7b72;font-weight:700>=</span> self<span style=color:#ff7b72;font-weight:700>.</span>generate(query, retrieved_docs)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>return</span> {
</span></span><span style=display:flex><span>            <span style=color:#a5d6ff>&#34;answer&#34;</span>: answer,
</span></span><span style=display:flex><span>            <span style=color:#a5d6ff>&#34;sources&#34;</span>: [
</span></span><span style=display:flex><span>                {<span style=color:#a5d6ff>&#34;doc_id&#34;</span>: doc[<span style=color:#a5d6ff>&#34;doc_id&#34;</span>], <span style=color:#a5d6ff>&#34;score&#34;</span>: doc[<span style=color:#a5d6ff>&#34;score&#34;</span>]}
</span></span><span style=display:flex><span>                <span style=color:#ff7b72>for</span> doc <span style=color:#ff7b72;font-weight:700>in</span> retrieved_docs
</span></span><span style=display:flex><span>            ],
</span></span><span style=display:flex><span>            <span style=color:#a5d6ff>&#34;confidence&#34;</span>: <span style=color:#a5d6ff>&#34;high&#34;</span> <span style=color:#ff7b72>if</span> retrieved_docs[<span style=color:#a5d6ff>0</span>][<span style=color:#a5d6ff>&#34;score&#34;</span>] <span style=color:#ff7b72;font-weight:700>&gt;</span> <span style=color:#a5d6ff>0.7</span> <span style=color:#ff7b72>else</span> <span style=color:#a5d6ff>&#34;medium&#34;</span>
</span></span><span style=display:flex><span>        }
</span></span></code></pre></td></tr></table></div></div><h2 id=é«˜çº§æŠ€å·§>é«˜çº§æŠ€å·§<a hidden class=anchor aria-hidden=true href=#é«˜çº§æŠ€å·§>#</a></h2><h3 id=æ··åˆæ£€ç´¢>æ··åˆæ£€ç´¢<a hidden class=anchor aria-hidden=true href=#æ··åˆæ£€ç´¢>#</a></h3><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">53
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#ff7b72>class</span> <span style=color:#f0883e;font-weight:700>HybridRetriever</span>:
</span></span><span style=display:flex><span>    <span style=color:#a5d6ff>&#34;&#34;&#34;æ··åˆæ£€ç´¢ï¼šå‘é‡+å…³é”®è¯&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>__init__</span>(self, vector_db, keyword_index):
</span></span><span style=display:flex><span>        self<span style=color:#ff7b72;font-weight:700>.</span>vector_db <span style=color:#ff7b72;font-weight:700>=</span> vector_db
</span></span><span style=display:flex><span>        self<span style=color:#ff7b72;font-weight:700>.</span>keyword_index <span style=color:#ff7b72;font-weight:700>=</span> keyword_index
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>retrieve</span>(self, query: str, alpha: float <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>0.5</span>, k: int <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>5</span>):
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;&#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>        æ··åˆæ£€ç´¢
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>        alpha: å‘é‡æ£€ç´¢æƒé‡ (0-1)
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>        1-alpha: å…³é”®è¯æ£€ç´¢æƒé‡
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>        &#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># å‘é‡æ£€ç´¢</span>
</span></span><span style=display:flex><span>        vector_results <span style=color:#ff7b72;font-weight:700>=</span> self<span style=color:#ff7b72;font-weight:700>.</span>vector_db<span style=color:#ff7b72;font-weight:700>.</span>search(query, k<span style=color:#ff7b72;font-weight:700>=</span>k<span style=color:#ff7b72;font-weight:700>*</span><span style=color:#a5d6ff>2</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># å…³é”®è¯æ£€ç´¢</span>
</span></span><span style=display:flex><span>        keyword_results <span style=color:#ff7b72;font-weight:700>=</span> self<span style=color:#ff7b72;font-weight:700>.</span>keyword_index<span style=color:#ff7b72;font-weight:700>.</span>search(query, k<span style=color:#ff7b72;font-weight:700>=</span>k<span style=color:#ff7b72;font-weight:700>*</span><span style=color:#a5d6ff>2</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># ç»“æœèåˆï¼ˆRRFç®—æ³•ï¼‰</span>
</span></span><span style=display:flex><span>        fused <span style=color:#ff7b72;font-weight:700>=</span> self<span style=color:#ff7b72;font-weight:700>.</span>reciprocal_rank_fusion(
</span></span><span style=display:flex><span>            {
</span></span><span style=display:flex><span>                <span style=color:#a5d6ff>&#34;vector&#34;</span>: vector_results,
</span></span><span style=display:flex><span>                <span style=color:#a5d6ff>&#34;keyword&#34;</span>: keyword_results
</span></span><span style=display:flex><span>            },
</span></span><span style=display:flex><span>            weights<span style=color:#ff7b72;font-weight:700>=</span>{<span style=color:#a5d6ff>&#34;vector&#34;</span>: alpha, <span style=color:#a5d6ff>&#34;keyword&#34;</span>: <span style=color:#a5d6ff>1</span><span style=color:#ff7b72;font-weight:700>-</span>alpha}
</span></span><span style=display:flex><span>        )
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>return</span> sorted(
</span></span><span style=display:flex><span>            fused<span style=color:#ff7b72;font-weight:700>.</span>items(),
</span></span><span style=display:flex><span>            key<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#ff7b72>lambda</span> x: x[<span style=color:#a5d6ff>1</span>],
</span></span><span style=display:flex><span>            reverse<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#79c0ff>True</span>
</span></span><span style=display:flex><span>        )[:k]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>reciprocal_rank_fusion</span>(self, results: Dict, weights: Dict, k: int <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>60</span>):
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;&#34;&#34;RRFèåˆç®—æ³•&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        fused <span style=color:#ff7b72;font-weight:700>=</span> {}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>for</span> method, items <span style=color:#ff7b72;font-weight:700>in</span> results<span style=color:#ff7b72;font-weight:700>.</span>items():
</span></span><span style=display:flex><span>            weight <span style=color:#ff7b72;font-weight:700>=</span> weights<span style=color:#ff7b72;font-weight:700>.</span>get(method, <span style=color:#a5d6ff>1.0</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>for</span> rank, item <span style=color:#ff7b72;font-weight:700>in</span> enumerate(items):
</span></span><span style=display:flex><span>                item_id <span style=color:#ff7b72;font-weight:700>=</span> item[<span style=color:#a5d6ff>&#34;id&#34;</span>]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>                <span style=color:#ff7b72>if</span> item_id <span style=color:#ff7b72;font-weight:700>not</span> <span style=color:#ff7b72;font-weight:700>in</span> fused:
</span></span><span style=display:flex><span>                    fused[item_id] <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>0</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>                <span style=color:#8b949e;font-style:italic># RRFå…¬å¼</span>
</span></span><span style=display:flex><span>                fused[item_id] <span style=color:#ff7b72;font-weight:700>+=</span> weight <span style=color:#ff7b72;font-weight:700>/</span> (k <span style=color:#ff7b72;font-weight:700>+</span> rank <span style=color:#ff7b72;font-weight:700>+</span> <span style=color:#a5d6ff>1</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>return</span> fused
</span></span></code></pre></td></tr></table></div></div><h3 id=é‡æ’åº>é‡æ’åº<a hidden class=anchor aria-hidden=true href=#é‡æ’åº>#</a></h3><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">28
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#ff7b72>class</span> <span style=color:#f0883e;font-weight:700>Reranker</span>:
</span></span><span style=display:flex><span>    <span style=color:#a5d6ff>&#34;&#34;&#34;é‡æ’åºå™¨&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>__init__</span>(self):
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>from</span> <span style=color:#ff7b72>sentence_transformers</span> <span style=color:#ff7b72>import</span> CrossEncoder
</span></span><span style=display:flex><span>        self<span style=color:#ff7b72;font-weight:700>.</span>reranker <span style=color:#ff7b72;font-weight:700>=</span> CrossEncoder(
</span></span><span style=display:flex><span>            <span style=color:#a5d6ff>&#34;cross-encoder/ms-marco-MiniLM-L-6-v2&#34;</span>
</span></span><span style=display:flex><span>        )
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>rerank</span>(self, query: str, documents: List[Dict], top_k: int <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>5</span>):
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;&#34;&#34;é‡æ’åº&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># è®¡ç®—æŸ¥è¯¢-æ–‡æ¡£ç›¸å…³æ€§åˆ†æ•°</span>
</span></span><span style=display:flex><span>        pairs <span style=color:#ff7b72;font-weight:700>=</span> [[query, doc[<span style=color:#a5d6ff>&#34;text&#34;</span>]] <span style=color:#ff7b72>for</span> doc <span style=color:#ff7b72;font-weight:700>in</span> documents]
</span></span><span style=display:flex><span>        scores <span style=color:#ff7b72;font-weight:700>=</span> self<span style=color:#ff7b72;font-weight:700>.</span>reranker<span style=color:#ff7b72;font-weight:700>.</span>predict(pairs)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># æ›´æ–°åˆ†æ•°</span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>for</span> doc, score <span style=color:#ff7b72;font-weight:700>in</span> zip(documents, scores):
</span></span><span style=display:flex><span>            doc[<span style=color:#a5d6ff>&#34;rerank_score&#34;</span>] <span style=color:#ff7b72;font-weight:700>=</span> float(score)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># æŒ‰æ–°åˆ†æ•°æ’åº</span>
</span></span><span style=display:flex><span>        reranked <span style=color:#ff7b72;font-weight:700>=</span> sorted(
</span></span><span style=display:flex><span>            documents,
</span></span><span style=display:flex><span>            key<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#ff7b72>lambda</span> x: x[<span style=color:#a5d6ff>&#34;rerank_score&#34;</span>],
</span></span><span style=display:flex><span>            reverse<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#79c0ff>True</span>
</span></span><span style=display:flex><span>        )
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>return</span> reranked[:top_k]
</span></span></code></pre></td></tr></table></div></div><h2 id=è¯„ä¼°ä½“ç³»>è¯„ä¼°ä½“ç³»<a hidden class=anchor aria-hidden=true href=#è¯„ä¼°ä½“ç³»>#</a></h2><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">56
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">57
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">58
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">59
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">60
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">61
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">62
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">63
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">64
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">65
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">66
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">67
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">68
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">69
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">70
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">71
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">72
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">73
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">74
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">75
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">76
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">77
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">78
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">79
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">80
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">81
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">82
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">83
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">84
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">85
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">86
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">87
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">88
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">89
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">90
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">91
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">92
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">93
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#ff7b72>class</span> <span style=color:#f0883e;font-weight:700>RAGEvaluator</span>:
</span></span><span style=display:flex><span>    <span style=color:#a5d6ff>&#34;&#34;&#34;RAGç³»ç»Ÿè¯„ä¼°&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>evaluate</span>(
</span></span><span style=display:flex><span>        self,
</span></span><span style=display:flex><span>        test_queries: List[Dict],
</span></span><span style=display:flex><span>        rag_system: EnterpriseRAG
</span></span><span style=display:flex><span>    ) <span style=color:#ff7b72;font-weight:700>-&gt;</span> Dict[str, float]:
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;&#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>        test_queries: [
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>            {
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>                &#34;query&#34;: &#34;ä»€ä¹ˆæ˜¯æœºå™¨å­¦ä¹ ï¼Ÿ&#34;,
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>                &#34;expected_answer&#34;: &#34;æœºå™¨å­¦ä¹ æ˜¯...&#34;,
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>                &#34;expected_docs&#34;: [1, 3, 5]
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>            }
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>        ]
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>        &#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        metrics <span style=color:#ff7b72;font-weight:700>=</span> {
</span></span><span style=display:flex><span>            <span style=color:#a5d6ff>&#34;retrieval_precision&#34;</span>: [],
</span></span><span style=display:flex><span>            <span style=color:#a5d6ff>&#34;retrieval_recall&#34;</span>: [],
</span></span><span style=display:flex><span>            <span style=color:#a5d6ff>&#34;answer_relevance&#34;</span>: [],
</span></span><span style=display:flex><span>            <span style=color:#a5d6ff>&#34;answer_faithfulness&#34;</span>: []
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>for</span> test <span style=color:#ff7b72;font-weight:700>in</span> test_queries:
</span></span><span style=display:flex><span>            <span style=color:#8b949e;font-style:italic># æ‰§è¡ŒæŸ¥è¯¢</span>
</span></span><span style=display:flex><span>            result <span style=color:#ff7b72;font-weight:700>=</span> rag_system<span style=color:#ff7b72;font-weight:700>.</span>ask(test[<span style=color:#a5d6ff>&#34;query&#34;</span>])
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#8b949e;font-style:italic># æ£€ç´¢è¯„ä¼°</span>
</span></span><span style=display:flex><span>            retrieved_doc_ids <span style=color:#ff7b72;font-weight:700>=</span> [s[<span style=color:#a5d6ff>&#34;doc_id&#34;</span>] <span style=color:#ff7b72>for</span> s <span style=color:#ff7b72;font-weight:700>in</span> result[<span style=color:#a5d6ff>&#34;sources&#34;</span>]]
</span></span><span style=display:flex><span>            expected_doc_ids <span style=color:#ff7b72;font-weight:700>=</span> test[<span style=color:#a5d6ff>&#34;expected_docs&#34;</span>]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#8b949e;font-style:italic># ç²¾ç¡®ç‡</span>
</span></span><span style=display:flex><span>            precision <span style=color:#ff7b72;font-weight:700>=</span> len(
</span></span><span style=display:flex><span>                set(retrieved_doc_ids) <span style=color:#ff7b72;font-weight:700>&amp;</span> set(expected_doc_ids)
</span></span><span style=display:flex><span>            ) <span style=color:#ff7b72;font-weight:700>/</span> len(retrieved_doc_ids)
</span></span><span style=display:flex><span>            metrics[<span style=color:#a5d6ff>&#34;retrieval_precision&#34;</span>]<span style=color:#ff7b72;font-weight:700>.</span>append(precision)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#8b949e;font-style:italic># å¬å›ç‡</span>
</span></span><span style=display:flex><span>            recall <span style=color:#ff7b72;font-weight:700>=</span> len(
</span></span><span style=display:flex><span>                set(retrieved_doc_ids) <span style=color:#ff7b72;font-weight:700>&amp;</span> set(expected_doc_ids)
</span></span><span style=display:flex><span>            ) <span style=color:#ff7b72;font-weight:700>/</span> len(expected_doc_ids)
</span></span><span style=display:flex><span>            metrics[<span style=color:#a5d6ff>&#34;retrieval_recall&#34;</span>]<span style=color:#ff7b72;font-weight:700>.</span>append(recall)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#8b949e;font-style:italic># ç­”æ¡ˆç›¸å…³æ€§</span>
</span></span><span style=display:flex><span>            relevance <span style=color:#ff7b72;font-weight:700>=</span> self<span style=color:#ff7b72;font-weight:700>.</span>_compute_relevance(
</span></span><span style=display:flex><span>                result[<span style=color:#a5d6ff>&#34;answer&#34;</span>],
</span></span><span style=display:flex><span>                test[<span style=color:#a5d6ff>&#34;expected_answer&#34;</span>]
</span></span><span style=display:flex><span>            )
</span></span><span style=display:flex><span>            metrics[<span style=color:#a5d6ff>&#34;answer_relevance&#34;</span>]<span style=color:#ff7b72;font-weight:700>.</span>append(relevance)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#8b949e;font-style:italic># å¿ å®åº¦</span>
</span></span><span style=display:flex><span>            faithfulness <span style=color:#ff7b72;font-weight:700>=</span> self<span style=color:#ff7b72;font-weight:700>.</span>_compute_faithfulness(
</span></span><span style=display:flex><span>                result[<span style=color:#a5d6ff>&#34;answer&#34;</span>],
</span></span><span style=display:flex><span>                [s[<span style=color:#a5d6ff>&#34;text&#34;</span>] <span style=color:#ff7b72>for</span> s <span style=color:#ff7b72;font-weight:700>in</span> result[<span style=color:#a5d6ff>&#34;sources&#34;</span>]]
</span></span><span style=display:flex><span>            )
</span></span><span style=display:flex><span>            metrics[<span style=color:#a5d6ff>&#34;answer_faithfulness&#34;</span>]<span style=color:#ff7b72;font-weight:700>.</span>append(faithfulness)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># è®¡ç®—å¹³å‡æŒ‡æ ‡</span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>return</span> {
</span></span><span style=display:flex><span>            k: sum(v) <span style=color:#ff7b72;font-weight:700>/</span> len(v)
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>for</span> k, v <span style=color:#ff7b72;font-weight:700>in</span> metrics<span style=color:#ff7b72;font-weight:700>.</span>items()
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>_compute_relevance</span>(self, generated: str, expected: str) <span style=color:#ff7b72;font-weight:700>-&gt;</span> float:
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;&#34;&#34;è®¡ç®—ç›¸å…³æ€§ï¼ˆä½¿ç”¨ä½™å¼¦ç›¸ä¼¼åº¦ï¼‰&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>from</span> <span style=color:#ff7b72>sentence_transformers</span> <span style=color:#ff7b72>import</span> SentenceTransformer
</span></span><span style=display:flex><span>        embedding_model <span style=color:#ff7b72;font-weight:700>=</span> SentenceTransformer(<span style=color:#a5d6ff>&#34;all-MiniLM-L6-v2&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        emb1 <span style=color:#ff7b72;font-weight:700>=</span> embedding_model<span style=color:#ff7b72;font-weight:700>.</span>encode([generated])
</span></span><span style=display:flex><span>        emb2 <span style=color:#ff7b72;font-weight:700>=</span> embedding_model<span style=color:#ff7b72;font-weight:700>.</span>encode([expected])
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>from</span> <span style=color:#ff7b72>sklearn.metrics.pairwise</span> <span style=color:#ff7b72>import</span> cosine_similarity
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>return</span> cosine_similarity(emb1, emb2)[<span style=color:#a5d6ff>0</span>][<span style=color:#a5d6ff>0</span>]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>_compute_faithfulness</span>(self, answer: str, contexts: List[str]) <span style=color:#ff7b72;font-weight:700>-&gt;</span> float:
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;&#34;&#34;è®¡ç®—å¿ å®åº¦ï¼ˆç­”æ¡ˆæ˜¯å¦åŸºäºä¸Šä¸‹æ–‡ï¼‰&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># ç®€å•æ–¹æ³•ï¼šæ£€æŸ¥ç­”æ¡ˆä¸­çš„å…³é”®å®ä½“æ˜¯å¦åœ¨ä¸Šä¸‹æ–‡ä¸­</span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>import</span> <span style=color:#ff7b72>spacy</span>
</span></span><span style=display:flex><span>        nlp <span style=color:#ff7b72;font-weight:700>=</span> spacy<span style=color:#ff7b72;font-weight:700>.</span>load(<span style=color:#a5d6ff>&#34;zh_core_web_sm&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        doc <span style=color:#ff7b72;font-weight:700>=</span> nlp(answer)
</span></span><span style=display:flex><span>        entities <span style=color:#ff7b72;font-weight:700>=</span> [ent<span style=color:#ff7b72;font-weight:700>.</span>text <span style=color:#ff7b72>for</span> ent <span style=color:#ff7b72;font-weight:700>in</span> doc<span style=color:#ff7b72;font-weight:700>.</span>ents]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        found <span style=color:#ff7b72;font-weight:700>=</span> sum(
</span></span><span style=display:flex><span>            <span style=color:#a5d6ff>1</span> <span style=color:#ff7b72>for</span> ent <span style=color:#ff7b72;font-weight:700>in</span> entities
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>if</span> any(ent <span style=color:#ff7b72;font-weight:700>in</span> ctx <span style=color:#ff7b72>for</span> ctx <span style=color:#ff7b72;font-weight:700>in</span> contexts)
</span></span><span style=display:flex><span>        )
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>return</span> found <span style=color:#ff7b72;font-weight:700>/</span> len(entities) <span style=color:#ff7b72>if</span> entities <span style=color:#ff7b72>else</span> <span style=color:#a5d6ff>1.0</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=éƒ¨ç½²æ–¹æ¡ˆ>éƒ¨ç½²æ–¹æ¡ˆ<a hidden class=anchor aria-hidden=true href=#éƒ¨ç½²æ–¹æ¡ˆ>#</a></h2><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">46
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#ff7b72>from</span> <span style=color:#ff7b72>fastapi</span> <span style=color:#ff7b72>import</span> FastAPI
</span></span><span style=display:flex><span><span style=color:#ff7b72>from</span> <span style=color:#ff7b72>pydantic</span> <span style=color:#ff7b72>import</span> BaseModel
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>app <span style=color:#ff7b72;font-weight:700>=</span> FastAPI(title<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>&#34;Enterprise RAG API&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>class</span> <span style=color:#f0883e;font-weight:700>Question</span>(BaseModel):
</span></span><span style=display:flex><span>    text: str
</span></span><span style=display:flex><span>    top_k: int <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>5</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>class</span> <span style=color:#f0883e;font-weight:700>Answer</span>(BaseModel):
</span></span><span style=display:flex><span>    answer: str
</span></span><span style=display:flex><span>    sources: List[Dict]
</span></span><span style=display:flex><span>    confidence: str
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic># åˆå§‹åŒ–RAGç³»ç»Ÿ</span>
</span></span><span style=display:flex><span>rag <span style=color:#ff7b72;font-weight:700>=</span> EnterpriseRAG({
</span></span><span style=display:flex><span>    <span style=color:#a5d6ff>&#34;embed_model&#34;</span>: <span style=color:#a5d6ff>&#34;sentence-transformers/all-MiniLM-L6-v2&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#a5d6ff>&#34;vector_db&#34;</span>: {
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;type&#34;</span>: <span style=color:#a5d6ff>&#34;pinecone&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;api_key&#34;</span>: <span style=color:#a5d6ff>&#34;your-api-key&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;environment&#34;</span>: <span style=color:#a5d6ff>&#34;us-east-1-aws&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;index_name&#34;</span>: <span style=color:#a5d6ff>&#34;enterprise-kb&#34;</span>
</span></span><span style=display:flex><span>    },
</span></span><span style=display:flex><span>    <span style=color:#a5d6ff>&#34;llm&#34;</span>: {
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;provider&#34;</span>: <span style=color:#a5d6ff>&#34;anthropic&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;api_key&#34;</span>: <span style=color:#a5d6ff>&#34;your-api-key&#34;</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>})
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic># å¯åŠ¨æ—¶ç´¢å¼•æ–‡æ¡£</span>
</span></span><span style=display:flex><span><span style=color:#d2a8ff;font-weight:700>@app.on_event</span>(<span style=color:#a5d6ff>&#34;startup&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#ff7b72>async</span> <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>startup</span>():
</span></span><span style=display:flex><span>    documents <span style=color:#ff7b72;font-weight:700>=</span> load_documents_from_s3()
</span></span><span style=display:flex><span>    rag<span style=color:#ff7b72;font-weight:700>.</span>index_documents(documents)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#d2a8ff;font-weight:700>@app.post</span>(<span style=color:#a5d6ff>&#34;/api/ask&#34;</span>, response_model<span style=color:#ff7b72;font-weight:700>=</span>Answer)
</span></span><span style=display:flex><span><span style=color:#ff7b72>async</span> <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>ask</span>(question: Question):
</span></span><span style=display:flex><span>    <span style=color:#a5d6ff>&#34;&#34;&#34;é—®ç­”æ¥å£&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    result <span style=color:#ff7b72;font-weight:700>=</span> rag<span style=color:#ff7b72;font-weight:700>.</span>ask(question<span style=color:#ff7b72;font-weight:700>.</span>text, question<span style=color:#ff7b72;font-weight:700>.</span>top_k)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>return</span> Answer(<span style=color:#ff7b72;font-weight:700>**</span>result)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>if</span> <span style=color:#79c0ff>__name__</span> <span style=color:#ff7b72;font-weight:700>==</span> <span style=color:#a5d6ff>&#34;__main__&#34;</span>:
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>import</span> <span style=color:#ff7b72>uvicorn</span>
</span></span><span style=display:flex><span>    uvicorn<span style=color:#ff7b72;font-weight:700>.</span>run(app, host<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>&#34;0.0.0.0&#34;</span>, port<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>8000</span>)
</span></span></code></pre></td></tr></table></div></div><h2 id=æœ€ä½³å®è·µ>æœ€ä½³å®è·µ<a hidden class=anchor aria-hidden=true href=#æœ€ä½³å®è·µ>#</a></h2><ol><li><strong>æ–‡æ¡£é¢„å¤„ç†</strong>ï¼šæ¸…æ´—ã€å»é‡ã€åˆ†æ®µ</li><li><strong>åµŒå…¥æ¨¡å‹é€‰æ‹©</strong>ï¼šå¹³è¡¡æ€§èƒ½å’Œæˆæœ¬</li><li><strong>å‘é‡æ•°æ®åº“</strong>ï¼šé€‰æ‹©åˆé€‚çš„è§„æ¨¡å’Œé…ç½®</li><li><strong>æ··åˆæ£€ç´¢</strong>ï¼šç»“åˆå‘é‡å’Œå…³é”®è¯æ£€ç´¢</li><li><strong>é‡æ’åº</strong>ï¼šæé«˜æ£€ç´¢ç²¾åº¦</li><li><strong>ç¼“å­˜ç­–ç•¥</strong>ï¼šç¼“å­˜å¸¸è§é—®é¢˜</li><li><strong>æŒç»­è¯„ä¼°</strong>ï¼šè·Ÿè¸ªç³»ç»Ÿæ€§èƒ½</li></ol><p>RAGç³»ç»Ÿä¸æ˜¯ä¸€æˆä¸å˜çš„ï¼Œéœ€è¦æ ¹æ®å®é™…ä½¿ç”¨æƒ…å†µæŒç»­ä¼˜åŒ–ã€‚</p></div><footer class=post-footer-modern><div class=post-tags-modern><span class=tags-label>ğŸ·ï¸ æ ‡ç­¾</span><div class=tags-list><a href=/blog/tags/rag/ class=tag-pill>RAG
</a><a href=/blog/tags/%E5%90%91%E9%87%8F%E6%95%B0%E6%8D%AE%E5%BA%93/ class=tag-pill>å‘é‡æ•°æ®åº“
</a><a href=/blog/tags/%E7%9F%A5%E8%AF%86%E5%BA%93/ class=tag-pill>çŸ¥è¯†åº“
</a><a href=/blog/tags/llm/ class=tag-pill>LLM
</a><a href=/blog/tags/embeddings/ class=tag-pill>Embeddings</a></div></div><style>.post-footer-modern{margin-top:3rem;padding-top:2rem;border-top:1px solid var(--border,#333333)}.post-tags-modern{display:flex;align-items:center;gap:1rem;margin-bottom:2rem;flex-wrap:wrap}.tags-label{font-size:.875rem;font-weight:600;color:var(--secondary,#999999) !important;white-space:nowrap}.tags-list{display:flex;flex-wrap:wrap;gap:.5rem;flex:1}.tag-pill{display:inline-block;padding:.25rem .75rem;background:rgba(255,255,255,5%);border:1px solid var(--border,#333333);border-radius:0;color:var(--secondary,#cccccc) !important;text-decoration:none;font-size:.8rem;font-weight:500;transition:all .2s ease}.tag-pill:hover{background:var(--primary,#ffffff);color:var(--background,#000000) !important;border-color:var(--primary,#ffffff);transform:translateY(-1px)}.post-nav-modern{margin-top:2rem}.nav-grid{display:grid;grid-template-columns:1fr 1fr;gap:1rem}.nav-card{display:flex;align-items:center;gap:1rem;padding:1.25rem;background:rgba(255,255,255,2%);border:1px solid var(--border,#333333);border-radius:12px;text-decoration:none;transition:all .2s ease;min-height:80px}.nav-card:hover{background:rgba(255,255,255,5%);border-color:var(--primary,#ffffff);transform:translateY(-2px)}.nav-card.nav-prev{justify-content:flex-start}.nav-card.nav-next{justify-content:flex-end;text-align:right}.nav-card.nav-next .nav-content{text-align:right}.nav-empty{display:flex;align-items:center;justify-content:center;background:rgba(255,255,255,1%);border:1px dashed var(--border,#333333);color:var(--secondary,#666666)}.nav-arrow{font-size:1.5rem;color:var(--primary,#ffffff);font-weight:300}.nav-content{flex:1}.nav-title{font-size:.95rem;font-weight:600;color:var(--primary,#ffffff) !important;line-height:1.4;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden}[data-theme=light] .post-footer-modern{border-color:var(--border-light,#dee2e6)}[data-theme=light] .tags-label{color:var(--secondary-light,#6c757d) !important}[data-theme=light] .tag-pill{background:rgba(0,0,0,5%);border-color:var(--border-light,#dee2e6);color:var(--secondary-light,#495057) !important}[data-theme=light] .tag-pill:hover{background:var(--primary-light,#0066cc);color:var(--background-light,#ffffff) !important;border-color:var(--primary-light,#0066cc)}[data-theme=light] .nav-card{background:rgba(0,0,0,2%);border-color:var(--border-light,#dee2e6)}[data-theme=light] .nav-card:hover{background:rgba(0,102,204,5%);border-color:var(--primary-light,#0066cc)}[data-theme=light] .nav-empty{background:rgba(0,0,0,1%);border-color:var(--border-light,#dee2e6);color:var(--secondary-light,#6c757d)}[data-theme=light] .nav-arrow{color:var(--primary-light,#0066cc)}[data-theme=light] .nav-title{color:var(--primary-light,#212529) !important}@media(max-width:768px){.nav-grid{grid-template-columns:1fr;gap:.75rem}.nav-card{padding:1rem;min-height:70px}.nav-card.nav-next{text-align:left}.nav-card.nav-next .nav-content{text-align:left}.nav-title{font-size:.875rem}.post-tags-modern{flex-direction:column;gap:.75rem}}@media(max-width:480px){.nav-arrow{font-size:1.25rem}.nav-card{padding:.875rem}.nav-title{font-size:.8rem;-webkit-line-clamp:1}}</style><nav class=post-nav-modern><div class=nav-grid><a href=/blog/articles/llm%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91%E5%AE%9E%E6%88%98%E4%BB%8E%E5%8E%9F%E5%9E%8B%E5%88%B0%E7%94%9F%E4%BA%A7%E9%83%A8%E7%BD%B2%E7%9A%84%E5%AE%8C%E6%95%B4%E6%8C%87%E5%8D%97/ class="nav-card nav-prev"><div class=nav-arrow>â†</div><div class=nav-content><div class=nav-title>LLMåº”ç”¨å¼€å‘å®æˆ˜ï¼šä»åŸå‹åˆ°ç”Ÿäº§éƒ¨ç½²çš„å®Œæ•´æŒ‡å—</div></div></a><a href=/blog/articles/ai%E8%BE%85%E5%8A%A9%E7%BC%96%E7%A8%8B%E5%B7%A5%E5%85%B7%E6%B7%B1%E5%BA%A6%E8%A7%A3%E6%9E%90claude-codecursorgithub-copilot%E5%85%A8%E5%AF%B9%E6%AF%94/ class="nav-card nav-next"><div class=nav-content><div class=nav-title>AIè¾…åŠ©ç¼–ç¨‹å·¥å…·æ·±åº¦è§£æï¼šClaude Codeã€Cursorã€GitHub Copilotå…¨å¯¹æ¯”</div></div><div class=nav-arrow>â†’</div></a></div></nav></footer></main><aside class=post-sidebar><div class=sidebar-toc id=sidebar-toc><div class=toc-header><div class=toc-title>ç›®å½•</div><button class=toc-toggle id=toc-toggle aria-label="Toggle TOC">
<svg class="toc-toggle-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 6 6 18M6 6l12 12"/></svg></button></div><div class=toc-content id=toc-content><ul class=toc-list><li class="toc-item toc-h2"><a href=#h2-0 class=toc-item-link><span class=toc-item-text>RAG æ ¸å¿ƒæ¦‚å¿µ</span></a></li><li class="toc-item toc-h2"><a href=#h2-1 class=toc-item-link><span class=toc-item-text>ç³»ç»Ÿæ¶æ„è®¾è®¡</span></a></li><li class="toc-item toc-h2"><a href=#h2-2 class=toc-item-link><span class=toc-item-text>é«˜çº§æŠ€å·§</span></a></li><li class="toc-item toc-h2"><a href=#h2-3 class=toc-item-link><span class=toc-item-text>è¯„ä¼°ä½“ç³»</span></a></li><li class="toc-item toc-h2"><a href=#h2-4 class=toc-item-link><span class=toc-item-text>éƒ¨ç½²æ–¹æ¡ˆ</span></a></li><li class="toc-item toc-h2"><a href=#h2-5 class=toc-item-link><span class=toc-item-text>æœ€ä½³å®è·µ</span></a></li></ul></div></div><script>document.addEventListener("DOMContentLoaded",function(){const e=document.getElementById("sidebar-toc"),t=document.getElementById("toc-toggle"),o=document.getElementById("toc-content"),i=t?.querySelector(".toc-toggle-icon");if(!e)return;let n=!1;t&&t.addEventListener("click",function(){n=!n,n?(o.style.display="none",e.style.width="auto",i.innerHTML='<path d="M9 18l6-6-6-6"/>'):(o.style.display="block",e.style.width="200px",i.innerHTML='<path d="M18 6L6 18M6 6l12 12"/>')});const s=document.querySelector(".post-content");if(s){const e=s.querySelectorAll("h1");e.forEach((e,t)=>{e.id=`h1-${t}`});const t=s.querySelectorAll("h2");t.forEach((e,t)=>{e.id=`h2-${t}`})}const a=document.querySelectorAll(".toc-item-link");a.forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();const n=this.getAttribute("href").substring(1),t=document.getElementById(n);if(t){const e=document.querySelector(".post-header-main")?.offsetHeight||0,n=t.offsetTop-e-20;window.scrollTo({top:n,behavior:"smooth"})}})})})</script><style>.sidebar-toc{position:sticky;top:2rem;width:200px;background:#fff;border:1px solid #e5e7eb;border-radius:4px;overflow:hidden;box-shadow:0 1px 3px rgba(0,0,0,.1);z-index:100}.sidebar-toc.hidden{display:none}.toc-header{padding:12px 16px;border-bottom:1px solid #e5e7eb;background:#fafbfc;display:flex;align-items:center;justify-content:space-between}.toc-title{margin:0;font-size:13px;font-weight:500;color:#374151 !important;font-family:-apple-system,BlinkMacSystemFont,segoe ui,Roboto,sans-serif;text-transform:uppercase;letter-spacing:1px}.toc-toggle{background:0 0;border:none;cursor:pointer;padding:4px;border-radius:4px;display:flex;align-items:center;justify-content:center;transition:all .2s ease;color:#6b7280}.toc-toggle:hover{background:#e5e7eb;color:#374151}.toc-toggle-icon{transition:transform .2s ease}.toc-content{padding:12px 0}.toc-list{list-style:none;margin:0;padding:0}.toc-item{margin-bottom:4px;display:block !important;visibility:visible !important}.toc-h1,.toc-h2{display:block !important}.toc-h2{margin-left:0}.toc-item-link{display:flex;align-items:center;gap:8px;padding:8px 12px;color:#374151 !important;text-decoration:none;font-size:13px;line-height:1.4;border-radius:3px;transition:all .2s ease;font-weight:400}.toc-item-link:hover{background:#f8fafc;color:#1f2937 !important}.toc-item-link.active{background:#e0f2fe;color:#01579b !important;font-weight:500}.toc-dot{width:8px;height:8px;border-radius:50%;flex-shrink:0}.dot-red{background:#ef4444}.dot-blue{background:#2196f3}.toc-item-text{color:#1f2937 !important;font-weight:400;flex:1;display:inline !important;visibility:visible !important;opacity:1 !important;font-size:13px !important;line-height:1.4 !important}.toc-item-link .toc-item-text{color:#1f2937 !important;display:inline !important;visibility:visible !important;opacity:1 !important}.toc-item.active .dot-red{background:#d32f2f}.toc-item.active .dot-blue{background:#1976d2}[data-theme=dark] .sidebar-toc{background:#1f2937;border-color:#374151;box-shadow:0 1px 3px rgba(0,0,0,.3)}[data-theme=dark] .toc-header{background:#111827;border-color:#374151}[data-theme=dark] .toc-title{color:#f3f4f6 !important}[data-theme=dark] .toc-toggle{color:#9ca3af}[data-theme=dark] .toc-toggle:hover{background:#374151;color:#f3f4f6}[data-theme=dark] .toc-item-link{color:#e5e7eb !important}[data-theme=dark] .toc-item-link:hover{background:#374151;color:#f9fafb !important}[data-theme=dark] .toc-item-link.active{background:#0d47a1;color:#fff !important}[data-theme=dark] .toc-item-text{color:#f9fafb !important;display:inline !important;visibility:visible !important;opacity:1 !important}[data-theme=dark] .toc-item-link .toc-item-text{color:#f9fafb !important;display:inline !important;visibility:visible !important;opacity:1 !important}@media(max-width:1024px){.sidebar-toc{display:none}.post-content-wrapper{grid-template-columns:1fr !important;padding:0 1rem !important}}</style><style>.post-content-wrapper{display:grid;grid-template-columns:1fr 200px;gap:2rem;padding:0 2rem;max-width:100%}.post-content-main{min-width:0}.post-sidebar{position:sticky;top:2rem;height:fit-content;min-width:0}.post-header-main{margin-bottom:2rem;padding-bottom:1rem;border-bottom:1px solid var(--border,#333333)}.post-header-main .post-title{color:var(--primary,#ffffff) !important;font-size:2.5rem;font-weight:700;line-height:1.2;margin-bottom:1rem}.post-header-main .post-description{color:var(--secondary,#cccccc) !important;font-size:1.1rem;line-height:1.6;margin-bottom:1rem}.post-header-main .post-meta{margin-bottom:0}@media(max-width:1024px){.post-content-wrapper{grid-template-columns:1fr !important;gap:1rem;padding:0 1rem !important}.post-sidebar{display:none}}@media(max-width:768px){.post-header-main .post-title{font-size:2rem}.post-header-main .post-description{font-size:1rem}}</style></aside></div></article></main><footer class=footer><span>Â© 2024-2025 æœ‰æ¡å·¥å…·æŠ€æœ¯åšå®¢</span> Â·</footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");if(menu){const e=localStorage.getItem("menu-scroll-position");e&&(menu.scrollLeft=parseInt(e,10)),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}}document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{const e=document.querySelector("html");e.dataset.theme==="dark"?(e.dataset.theme="light",localStorage.setItem("pref-theme","light")):(e.dataset.theme="dark",localStorage.setItem("pref-theme","dark"))})</script></body></html>