<!doctype html><html lang=zh-cn dir=auto data-theme=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>ç”¨æˆ·è¡Œä¸ºåˆ†æå®æˆ˜ï¼šæ´å¯Ÿç”¨æˆ·è¡Œä¸ºï¼Œä¼˜åŒ–äº§å“ä½“éªŒ | æŠ€æœ¯åšå®¢ - æœ‰æ¡å·¥å…·</title><meta name=keywords content="ç”¨æˆ·è¡Œä¸ºåˆ†æ,äº§å“ä¼˜åŒ–,ç”¨æˆ·åˆ†ç¾¤,ç•™å­˜åˆ†æ,è¡Œä¸ºæ¼æ–—"><meta name=description content="æ·±å…¥æ¢è®¨ç”¨æˆ·è¡Œä¸ºåˆ†æçš„æ–¹æ³•è®ºå’Œå®è·µæŠ€å·§ï¼Œä»æ•°æ®é‡‡é›†ã€è¡Œä¸ºåˆ†æã€æ¼æ–—ä¼˜åŒ–åˆ°ä¸ªæ€§åŒ–æ¨èï¼Œå¸®åŠ©ä½ å…¨é¢ç†è§£ç”¨æˆ·ï¼Œæå‡äº§å“ä½“éªŒå’Œè½¬åŒ–ç‡ã€‚"><meta name=author content="æœ‰æ¡å·¥å…·å›¢é˜Ÿ"><link rel=canonical href=/blog/articles/%E7%94%A8%E6%88%B7%E8%A1%8C%E4%B8%BA%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E6%B4%9E%E5%AF%9F%E7%94%A8%E6%88%B7%E8%A1%8C%E4%B8%BA%E4%BC%98%E5%8C%96%E4%BA%A7%E5%93%81%E4%BD%93%E9%AA%8C/><link crossorigin=anonymous href=/blog/assets/css/stylesheet.7e8505b7cdf8bb22ab2305e53c2700bb06c7e64faeb72cd3468823a9a3bd3d6e.css integrity="sha256-foUFt834uyKrIwXlPCcAuwbH5k+utyzTRogjqaO9PW4=" rel="preload stylesheet" as=style><link rel=icon href=/favicon.ico><link rel=icon type=image/png sizes=16x16 href=/blog/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=/blog/favicon-32x32.png><link rel=apple-touch-icon href=/blog/apple-touch-icon.png><link rel=mask-icon href=/blog/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate type=application/rss+xml href=/blog/articles/%E7%94%A8%E6%88%B7%E8%A1%8C%E4%B8%BA%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E6%B4%9E%E5%AF%9F%E7%94%A8%E6%88%B7%E8%A1%8C%E4%B8%BA%E4%BC%98%E5%8C%96%E4%BA%A7%E5%93%81%E4%BD%93%E9%AA%8C/feed.xml title=rss><link rel=alternate hreflang=zh-cn href=/blog/articles/%E7%94%A8%E6%88%B7%E8%A1%8C%E4%B8%BA%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E6%B4%9E%E5%AF%9F%E7%94%A8%E6%88%B7%E8%A1%8C%E4%B8%BA%E4%BC%98%E5%8C%96%E4%BA%A7%E5%93%81%E4%BD%93%E9%AA%8C/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51);color-scheme:dark}.list{background:var(--theme)}.toc{background:var(--entry)}}@media(prefers-color-scheme:light){.list::-webkit-scrollbar-thumb{border-color:var(--code-bg)}}</style></noscript><script>localStorage.getItem("pref-theme")==="dark"?document.querySelector("html").dataset.theme="dark":localStorage.getItem("pref-theme")==="light"?document.querySelector("html").dataset.theme="light":window.matchMedia("(prefers-color-scheme: dark)").matches?document.querySelector("html").dataset.theme="dark":document.querySelector("html").dataset.theme="light"</script><script src=/js/external-link-config.js></script><script src=/js/external-link-interceptor.js></script><link rel=stylesheet href=/blog/css/custom.css media=screen><script type=application/ld+json>{"@context":"https://schema.org","@type":"WebSite","name":"æŠ€æœ¯åšå®¢ - æœ‰æ¡å·¥å…· | å¼€å‘è€…å·¥å…·ä½¿ç”¨æ•™ç¨‹ & ç¼–ç¨‹æŠ€å·§åˆ†äº«","url":"https://www.util.cn/blog/","description":"æœ‰æ¡å·¥å…·æŠ€æœ¯åšå®¢ - åˆ†äº«å¼€å‘è€…å·¥å…·ä½¿ç”¨æ•™ç¨‹ã€ç¼–ç¨‹æŠ€å·§å’Œå®æˆ˜å¼€å‘ç»éªŒã€‚æä¾›JSONæ ¼å¼åŒ–ã€SQLä¼˜åŒ–ã€Markdownç¼–è¾‘å™¨ç­‰åœ¨çº¿å·¥å…·çš„è¯¦ç»†ä½¿ç”¨æŒ‡å—ï¼Œå¸®åŠ©å¼€å‘è€…æå‡å·¥ä½œæ•ˆç‡ã€‚","publisher":{"@type":"Organization","name":"æœ‰æ¡å·¥å…·","url":"https://www.util.cn","logo":{"@type":"ImageObject","url":"https://www.util.cn/blog/logo/logo-256.png","width":256,"height":256}},"potentialAction":[{"@type":"SearchAction","target":"https://www.util.cn/blog/search?q={search_term_string}","query-input":"required name=search_term_string"}]}</script><meta property="og:type" content="website"><meta property="og:title" content="æŠ€æœ¯åšå®¢ - æœ‰æ¡å·¥å…· | å¼€å‘è€…å·¥å…·ä½¿ç”¨æ•™ç¨‹ & ç¼–ç¨‹æŠ€å·§åˆ†äº«"><meta property="og:description" content="æœ‰æ¡å·¥å…·æŠ€æœ¯åšå®¢ - åˆ†äº«å¼€å‘è€…å·¥å…·ä½¿ç”¨æ•™ç¨‹ã€ç¼–ç¨‹æŠ€å·§å’Œå®æˆ˜å¼€å‘ç»éªŒã€‚æä¾›JSONæ ¼å¼åŒ–ã€SQLä¼˜åŒ–ã€Markdownç¼–è¾‘å™¨ç­‰åœ¨çº¿å·¥å…·çš„è¯¦ç»†ä½¿ç”¨æŒ‡å—ï¼Œå¸®åŠ©å¼€å‘è€…æå‡å·¥ä½œæ•ˆç‡ã€‚"><meta property="og:url" content="https://www.util.cn/blog/"><meta property="og:site_name" content="æœ‰æ¡å·¥å…·æŠ€æœ¯åšå®¢"><meta property="og:image" content="https://www.util.cn/blog/logo/logo-256.png"><meta property="og:image:width" content="1200"><meta property="og:image:height" content="630"><meta name=twitter:card content="summary_large_image"><meta name=twitter:title content="æŠ€æœ¯åšå®¢ - æœ‰æ¡å·¥å…· | å¼€å‘è€…å·¥å…·ä½¿ç”¨æ•™ç¨‹ & ç¼–ç¨‹æŠ€å·§åˆ†äº«"><meta name=twitter:description content="æœ‰æ¡å·¥å…·æŠ€æœ¯åšå®¢ - åˆ†äº«å¼€å‘è€…å·¥å…·ä½¿ç”¨æ•™ç¨‹ã€ç¼–ç¨‹æŠ€å·§å’Œå®æˆ˜å¼€å‘ç»éªŒã€‚"><meta name=twitter:image content="https://www.util.cn/blog/logo/logo-256.png"><meta name=baidu-site-verification content><meta name=category content="æŠ€æœ¯åšå®¢,å¼€å‘è€…å·¥å…·,ç¼–ç¨‹æ•™ç¨‹"><meta name=coverage content="Worldwide"><meta name=distribution content="Global"><meta name=rating content="General"><script id=51la_code async crossorigin=anonymous src="https://sdk.51.la/js-sdk-pro.min.js?id=3OM52V0xJAPv6ozF&hash=pro"></script><script>window.addEventListener("load",function(){setTimeout(function(){typeof la!="undefined"?console.log("51laç»Ÿè®¡å·²åŠ è½½"):(console.warn("51laç»Ÿè®¡åŠ è½½å¤±è´¥ï¼Œä½¿ç”¨å¤‡ç”¨æ–¹æ¡ˆ"),function(){var e=document.createElement("script");e.src="https://sdk.51.la/js-sdk-pro.min.js?id=3OM52V0xJAPv6ozF&hash=backup",e.async=!0,document.head.appendChild(e)}())},3e3)})</script><meta property="og:url" content="/blog/articles/%E7%94%A8%E6%88%B7%E8%A1%8C%E4%B8%BA%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E6%B4%9E%E5%AF%9F%E7%94%A8%E6%88%B7%E8%A1%8C%E4%B8%BA%E4%BC%98%E5%8C%96%E4%BA%A7%E5%93%81%E4%BD%93%E9%AA%8C/"><meta property="og:site_name" content="æŠ€æœ¯åšå®¢ - æœ‰æ¡å·¥å…·"><meta property="og:title" content="ç”¨æˆ·è¡Œä¸ºåˆ†æå®æˆ˜ï¼šæ´å¯Ÿç”¨æˆ·è¡Œä¸ºï¼Œä¼˜åŒ–äº§å“ä½“éªŒ"><meta property="og:description" content="æ·±å…¥æ¢è®¨ç”¨æˆ·è¡Œä¸ºåˆ†æçš„æ–¹æ³•è®ºå’Œå®è·µæŠ€å·§ï¼Œä»æ•°æ®é‡‡é›†ã€è¡Œä¸ºåˆ†æã€æ¼æ–—ä¼˜åŒ–åˆ°ä¸ªæ€§åŒ–æ¨èï¼Œå¸®åŠ©ä½ å…¨é¢ç†è§£ç”¨æˆ·ï¼Œæå‡äº§å“ä½“éªŒå’Œè½¬åŒ–ç‡ã€‚"><meta property="og:locale" content="zh-cn"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2025-12-23T13:00:00+08:00"><meta property="article:modified_time" content="2025-12-23T13:00:00+08:00"><meta property="article:tag" content="ç”¨æˆ·è¡Œä¸º"><meta property="article:tag" content="äº§å“åˆ†æ"><meta property="article:tag" content="ç”¨æˆ·ä½“éªŒ"><meta property="article:tag" content="è½¬åŒ–ä¼˜åŒ–"><meta property="article:tag" content="è¡Œä¸ºåˆ†æ"><meta name=twitter:card content="summary"><meta name=twitter:title content="ç”¨æˆ·è¡Œä¸ºåˆ†æå®æˆ˜ï¼šæ´å¯Ÿç”¨æˆ·è¡Œä¸ºï¼Œä¼˜åŒ–äº§å“ä½“éªŒ"><meta name=twitter:description content="æ·±å…¥æ¢è®¨ç”¨æˆ·è¡Œä¸ºåˆ†æçš„æ–¹æ³•è®ºå’Œå®è·µæŠ€å·§ï¼Œä»æ•°æ®é‡‡é›†ã€è¡Œä¸ºåˆ†æã€æ¼æ–—ä¼˜åŒ–åˆ°ä¸ªæ€§åŒ–æ¨èï¼Œå¸®åŠ©ä½ å…¨é¢ç†è§£ç”¨æˆ·ï¼Œæå‡äº§å“ä½“éªŒå’Œè½¬åŒ–ç‡ã€‚"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"æ‰€æœ‰æ–‡ç« ","item":"/blog/posts/"},{"@type":"ListItem","position":2,"name":"ç”¨æˆ·è¡Œä¸ºåˆ†æå®æˆ˜ï¼šæ´å¯Ÿç”¨æˆ·è¡Œä¸ºï¼Œä¼˜åŒ–äº§å“ä½“éªŒ","item":"/blog/articles/%E7%94%A8%E6%88%B7%E8%A1%8C%E4%B8%BA%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E6%B4%9E%E5%AF%9F%E7%94%A8%E6%88%B7%E8%A1%8C%E4%B8%BA%E4%BC%98%E5%8C%96%E4%BA%A7%E5%93%81%E4%BD%93%E9%AA%8C/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"ç”¨æˆ·è¡Œä¸ºåˆ†æå®æˆ˜ï¼šæ´å¯Ÿç”¨æˆ·è¡Œä¸ºï¼Œä¼˜åŒ–äº§å“ä½“éªŒ","name":"ç”¨æˆ·è¡Œä¸ºåˆ†æå®æˆ˜ï¼šæ´å¯Ÿç”¨æˆ·è¡Œä¸ºï¼Œä¼˜åŒ–äº§å“ä½“éªŒ","description":"æ·±å…¥æ¢è®¨ç”¨æˆ·è¡Œä¸ºåˆ†æçš„æ–¹æ³•è®ºå’Œå®è·µæŠ€å·§ï¼Œä»æ•°æ®é‡‡é›†ã€è¡Œä¸ºåˆ†æã€æ¼æ–—ä¼˜åŒ–åˆ°ä¸ªæ€§åŒ–æ¨èï¼Œå¸®åŠ©ä½ å…¨é¢ç†è§£ç”¨æˆ·ï¼Œæå‡äº§å“ä½“éªŒå’Œè½¬åŒ–ç‡ã€‚","keywords":["ç”¨æˆ·è¡Œä¸ºåˆ†æ","äº§å“ä¼˜åŒ–","ç”¨æˆ·åˆ†ç¾¤","ç•™å­˜åˆ†æ","è¡Œä¸ºæ¼æ–—"],"articleBody":"å¼•è¨€ ç”¨æˆ·è¡Œä¸ºåˆ†ææ˜¯äº§å“ä¼˜åŒ–çš„æ ¸å¿ƒã€‚é€šè¿‡æ·±å…¥äº†è§£ç”¨æˆ·å¦‚ä½•ä½¿ç”¨äº§å“ï¼Œæˆ‘ä»¬å¯ä»¥å‘ç°ç—›ç‚¹ã€ä¼˜åŒ–ä½“éªŒã€æå‡è½¬åŒ–ã€‚æœ¬æ–‡å°†ç³»ç»Ÿè®²è§£ç”¨æˆ·è¡Œä¸ºåˆ†æçš„å®Œæ•´æ–¹æ³•è®ºã€‚\nä¸€ã€ç”¨æˆ·è¡Œä¸ºæ•°æ®é‡‡é›† 1.1 è¡Œä¸ºæ•°æ®æ¨¡å‹ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 // ç”¨æˆ·è¡Œä¸ºäº‹ä»¶æ•°æ®æ¨¡å‹ const UserBehaviorEvent = { // æ ¸å¿ƒäº‹ä»¶å±æ€§ event: { name: \"product_view\", // äº‹ä»¶åç§° category: \"engagement\", // äº‹ä»¶åˆ†ç±» timestamp: 1703270400000, // æ—¶é—´æˆ³ userId: \"user_12345\", // ç”¨æˆ·ID sessionId: \"session_abc\", // ä¼šè¯ID // äº‹ä»¶å±æ€§ properties: { // äº§å“ç›¸å…³ productId: \"prod_001\", productName: \"Premium Plan\", category: \"subscription\", price: 99.00, // ç”¨æˆ·ä¸Šä¸‹æ–‡ referrer: \"https://google.com\", utmSource: \"google\", utmMedium: \"cpc\", utmCampaign: \"winter_sale\", // æŠ€æœ¯ç¯å¢ƒ device: \"desktop\", browser: \"Chrome\", os: \"Windows 10\", screenResolution: \"1920x1080\", // é¡µé¢ä¿¡æ¯ pageUrl: \"/products/premium\", pageTitle: \"Premium Plan\", previousPage: \"/pricing\" } }, // ç”¨æˆ·å±æ€§ user: { userId: \"user_12345\", email: \"user@example.com\", country: \"CN\", language: \"zh-CN\", timezone: \"Asia/Shanghai\", // è‡ªå®šä¹‰å±æ€§ customerTier: \"free\", registrationDate: \"2025-01-15\", lastLoginDate: \"2025-12-20\", totalSpent: 0, purchaseCount: 0 } }; // äº‹ä»¶è¿½è¸ªä»£ç ç¤ºä¾‹ function trackEvent(eventName, properties = {}) { const event = { event: eventName, timestamp: Date.now(), userId: getCurrentUserId(), sessionId: getSessionId(), properties: { ...properties, page: window.location.href, referrer: document.referrer } }; // å‘é€åˆ°åˆ†æå¹³å° // Mixpanel / Amplitude / Google Analytics analytics.track(eventName, properties); return event; } // å¸¸è§äº‹ä»¶å®šä¹‰ const CommonEvents = { // é¡µé¢æµè§ˆ pageView: (pageName) =\u003e trackEvent('page_view', { page_name: pageName }), // ç”¨æˆ·æ³¨å†Œ signUp: (method) =\u003e trackEvent('sign_up', { signup_method: method }), // äº§å“ä½¿ç”¨ featureUse: (featureName) =\u003e trackEvent('feature_used', { feature_name: featureName }), // è½¬åŒ–äº‹ä»¶ purchase: (orderId, value) =\u003e trackEvent('purchase', { order_id: orderId, revenue: value }) }; 1.2 åŸ‹ç‚¹è®¾è®¡åŸåˆ™ åŸ‹ç‚¹è®¾è®¡æ¡†æ¶\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 äº‹ä»¶è®¾è®¡åŸåˆ™: å‘½åè§„èŒƒ: - ä½¿ç”¨åŠ¨è¯+åè¯ç»„åˆ - ç»Ÿä¸€ä½¿ç”¨ä¸‹åˆ’çº¿åˆ†éš” - ä¿æŒå‘½åä¸€è‡´æ€§ - é¿å…ä½¿ç”¨ç¼©å†™ å¥½çš„ä¾‹å­: - product_viewed - cart_item_added - search_performed - video_played ä¸å¥½çš„ä¾‹å­: - prodView - add2cart - srch - vidPlay å±æ€§è®¾è®¡: - å¿…éœ€å±æ€§ vs å¯é€‰å±æ€§ - æ•°æ®ç±»å‹æ˜ç¡® - æä¾›é»˜è®¤å€¼ - æ–‡æ¡£è¯´æ˜æ¸…æ™° æ ‡å‡†å±æ€§: - event_time (datetime) - user_id (string) - session_id (string) - platform (string) - device_type (string) äº‹ä»¶å±‚çº§: Level 1 - æ ¸å¿ƒä¸šåŠ¡äº‹ä»¶: - sign_up - purchase - subscription_renewal Level 2 - åŠŸèƒ½ä½¿ç”¨äº‹ä»¶: - feature_used - tool_accessed - report_generated Level 3 - äº¤äº’ç»†èŠ‚äº‹ä»¶: - button_clicked - form_field_focus - error_displayed é‡‡æ ·ç­–ç•¥: é«˜ä»·å€¼äº‹ä»¶: 100% é‡‡é›† - è´­ä¹°ã€æ³¨å†Œã€è®¢é˜… ä¸­ç­‰ä»·å€¼äº‹ä»¶: 10-50% é‡‡æ · - é¡µé¢æµè§ˆã€ç‚¹å‡» ä½ä»·å€¼äº‹ä»¶: 1-10% é‡‡æ · - é¼ æ ‡ç§»åŠ¨ã€æ»šåŠ¨ äºŒã€ç”¨æˆ·åˆ†ç¾¤åˆ†æ 2.1 RFMç”¨æˆ·åˆ†å±‚ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 174 175 176 177 178 179 180 181 182 183 184 185 186 187 188 189 190 191 192 193 194 195 196 # RFMç”¨æˆ·ä»·å€¼åˆ†å±‚åˆ†æ import pandas as pd import numpy as np from datetime import datetime, timedelta class RFMAnalysis: \"\"\"RFMç”¨æˆ·ä»·å€¼åˆ†æ\"\"\" def __init__(self, transactions_df): \"\"\" transactions_df: åŒ…å«ç”¨æˆ·äº¤æ˜“æ•°æ® å¿…éœ€åˆ—: user_id, order_date, amount \"\"\" self.df = transactions_df self.analysis_date = datetime.now() def calculate_rfm(self): \"\"\"è®¡ç®—RFMæŒ‡æ ‡\"\"\" # è®¡ç®—æœ€è¿‘è´­ä¹°æ—¶é—´ recency = self.df.groupby('user_id')['order_date'].max().reset_index() recency['recency'] = ( self.analysis_date - recency['order_date'] ).dt.days # è®¡ç®—è´­ä¹°é¢‘ç‡ frequency = self.df.groupby('user_id')['order_date'].count().reset_index() frequency.columns = ['user_id', 'frequency'] # è®¡ç®—è´­ä¹°é‡‘é¢ monetary = self.df.groupby('user_id')['amount'].sum().reset_index() monetary.columns = ['user_id', 'monetary'] # åˆå¹¶RFM rfm = recency.merge(frequency, on='user_id').merge(monetary, on='user_id') rfm = rfm[['user_id', 'recency', 'frequency', 'monetary']] return rfm def score_rfm(self, rfm_df, n_quantiles=5): \"\"\"RFMè¯„åˆ†ï¼ˆ1-5åˆ†ï¼‰\"\"\" # Råˆ†æ•°ï¼šè¶Šå°è¶Šå¥½ï¼ˆæœ€è¿‘è´­ä¹°å¾—åˆ†é«˜ï¼‰ rfm_df['R_score'] = pd.qcut( rfm_df['recency'], n_quantiles, labels=[5, 4, 3, 2, 1], duplicates='drop' ).astype(int) # Fåˆ†æ•°ï¼šè¶Šå¤§è¶Šå¥½ rfm_df['F_score'] = pd.qcut( rfm_df['frequency'].rank(method='first'), n_quantiles, labels=[1, 2, 3, 4, 5], duplicates='drop' ).astype(int) # Måˆ†æ•°ï¼šè¶Šå¤§è¶Šå¥½ rfm_df['M_score'] = pd.qcut( rfm_df['monetary'].rank(method='first'), n_quantiles, labels=[1, 2, 3, 4, 5], duplicates='drop' ).astype(int) # è®¡ç®—ç»¼åˆRFMåˆ†æ•° rfm_df['RFM_score'] = ( rfm_df['R_score'] * 100 + rfm_df['F_score'] * 10 + rfm_df['M_score'] ) return rfm_df def segment_users(self, rfm_df): \"\"\"ç”¨æˆ·åˆ†ç¾¤\"\"\" def assign_segment(row): R, F, M = row['R_score'], row['F_score'], row['M_score'] # é‡è¦ä»·å€¼å®¢æˆ· if R \u003e= 4 and F \u003e= 4 and M \u003e= 4: return 'Champions' # é‡è¦ä¿æŒå®¢æˆ· elif R \u003e= 3 and F \u003e= 3 and M \u003e= 3: return 'Loyal Customers' # æ½œåŠ›å®¢æˆ· elif R \u003e= 3 and F \u003c= 2 and M \u003e= 3: return 'Potential Loyalist' # é‡è¦æŒ½ç•™å®¢æˆ· elif R \u003c= 2 and F \u003e= 3 and M \u003e= 3: return 'At Risk' # æµå¤±å®¢æˆ· elif R \u003c= 2 and F \u003c= 2 and M \u003c= 2: return 'Lost' # æ–°å®¢æˆ· elif F \u003c= 2 and M \u003c= 2: return 'New Customers' else: return 'Others' rfm_df['segment'] = rfm_df.apply(assign_segment, axis=1) return rfm_df def get_segment_insights(self, rfm_df): \"\"\"åˆ†ç¾¤æ´å¯Ÿ\"\"\" segments = rfm_df.groupby('segment').agg({ 'user_id': 'count', 'recency': 'mean', 'frequency': 'mean', 'monetary': ['mean', 'sum'] }).round(2) segments.columns = [ 'user_count', 'avg_recency', 'avg_frequency', 'avg_monetary', 'total_monetary' ] segments = segments.sort_values('total_monetary', ascending=False) return segments def recommend_strategies(self, segment): \"\"\"åˆ†ç¾¤ç­–ç•¥å»ºè®®\"\"\" strategies = { 'Champions': { 'priority': 'Highest', 'strategy': 'VIPæœåŠ¡', 'actions': [ 'ä¸“å±å®¢æœ', 'ä¼˜å…ˆåŠŸèƒ½è®¿é—®', 'ä¸“å±æŠ˜æ‰£', 'æ¨èè®¡åˆ’é‚€è¯·' ], 'expected_impact': 'ä¿æŒå¿ è¯šåº¦ï¼Œæé«˜å¤è´­' }, 'Loyal Customers': { 'priority': 'High', 'strategy': 'ä¼šå‘˜å‡çº§', 'actions': [ 'å¿ è¯šåº¦å¥–åŠ±', 'å‡çº§ä¼˜æƒ ', 'ä¼šå‘˜ç‰¹æƒ', 'ç”Ÿæ—¥ç¦åˆ©' ], 'expected_impact': 'æå‡æ¶ˆè´¹é¢‘æ¬¡' }, 'At Risk': { 'priority': 'High', 'strategy': 'æŒ½å›æ¿€æ´»', 'actions': [ 'ä¸ªæ€§åŒ–ä¼˜æƒ ', 'äº§å“æ›´æ–°é€šçŸ¥', 'å®¢æœå›è®¿', 'é™æ—¶æŠ˜æ‰£' ], 'expected_impact': 'é˜²æ­¢æµå¤±ï¼Œé‡æ–°æ¿€æ´»' }, 'Lost': { 'priority': 'Medium', 'strategy': 'é‡æ–°è·å®¢', 'actions': [ 'å¤§å¹…æŠ˜æ‰£', 'æ–°äº§å“æ¨è', 'é—®å·è°ƒæŸ¥', 'æ”¹è¿›æ²Ÿé€š' ], 'expected_impact': 'éƒ¨åˆ†æŒ½å›' }, 'New Customers': { 'priority': 'Medium', 'strategy': 'æ–°æ‰‹åŸ¹å…»', 'actions': [ 'æ–°æ‰‹å¼•å¯¼', 'åŠŸèƒ½æ•™ç¨‹', 'é¦–æ¬¡è´­ä¹°ä¼˜æƒ ', 'ç¤¾ç¾¤é‚€è¯·' ], 'expected_impact': 'è½¬åŒ–ä¸ºæ´»è·ƒç”¨æˆ·' } } return strategies.get(segment, {}) 2.2 è¡Œä¸ºç‰¹å¾åˆ†ç¾¤ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 # åŸºäºè¡Œä¸ºçš„ç”¨æˆ·åˆ†ç¾¤ from sklearn.cluster import KMeans from sklearn.preprocessing import StandardScaler from sklearn.decomposition import PCA class BehaviorSegmentation: \"\"\"è¡Œä¸ºç‰¹å¾åˆ†ç¾¤\"\"\" def __init__(self, event_data): \"\"\" event_data: ç”¨æˆ·è¡Œä¸ºäº‹ä»¶æ•°æ® \"\"\" self.events = event_data def create_behavior_features(self): \"\"\"åˆ›å»ºè¡Œä¸ºç‰¹å¾\"\"\" # ç‰¹å¾1ï¼šæ´»è·ƒåº¦ï¼ˆäº‹ä»¶æ€»æ•°ï¼‰ activity = self.events.groupby('user_id').size().reset_index() activity.columns = ['user_id', 'total_events'] # ç‰¹å¾2ï¼šä½¿ç”¨å¤©æ•° active_days = self.events.groupby('user_id')['date'].nunique().reset_index() active_days.columns = ['user_id', 'active_days'] # ç‰¹å¾3ï¼šåŠŸèƒ½ä½¿ç”¨å¹¿åº¦ï¼ˆä¸åŒäº‹ä»¶ç±»å‹æ•°ï¼‰ feature_breadth = self.events.groupby('user_id')['event_name'].nunique().reset_index() feature_breadth.columns = ['user_id', 'unique_events'] # ç‰¹å¾4ï¼šä¼šè¯æ—¶é•¿ session_duration = self.events.groupby(['user_id', 'session_id']).agg({ 'timestamp': lambda x: x.max() - x.min() }).reset_index() session_duration['duration_seconds'] = session_duration['timestamp'].dt.total_seconds() avg_duration = session_duration.groupby('user_id')['duration_seconds'].mean().reset_index() avg_duration.columns = ['user_id', 'avg_session_duration'] # ç‰¹å¾5ï¼šæ ¸å¿ƒåŠŸèƒ½ä½¿ç”¨ç‡ core_events = ['purchase', 'checkout', 'add_to_cart'] core_usage = self.events[ self.events['event_name'].isin(core_events) ].groupby('user_id').size().reset_index() core_usage.columns = ['user_id', 'core_events_count'] # åˆå¹¶æ‰€æœ‰ç‰¹å¾ features = activity.merge(active_days, on='user_id', how='outer') \\ .merge(feature_breadth, on='user_id', how='outer') \\ .merge(avg_duration, on='user_id', how='outer') \\ .merge(core_usage, on='user_id', how='outer') # å¡«å……ç¼ºå¤±å€¼ features = features.fillna(0) # è®¡ç®—è¡ç”Ÿç‰¹å¾ features['events_per_day'] = features['total_events'] / (features['active_days'] + 1) features['core_event_ratio'] = features['core_events_count'] / (features['total_events'] + 1) return features def perform_clustering(self, features_df, n_clusters=5): \"\"\"æ‰§è¡Œèšç±»åˆ†æ\"\"\" # å‡†å¤‡ç‰¹å¾ï¼ˆå»é™¤user_idï¼‰ feature_cols = [col for col in features_df.columns if col != 'user_id'] X = features_df[feature_cols].values # æ ‡å‡†åŒ– scaler = StandardScaler() X_scaled = scaler.fit_transform(X) # èšç±» kmeans = KMeans( n_clusters=n_clusters, random_state=42, n_init=10 ) clusters = kmeans.fit_predict(X_scaled) # æ·»åŠ èšç±»æ ‡ç­¾ result = features_df.copy() result['cluster'] = clusters # ä¿å­˜æ¨¡å‹å’Œæ ‡å‡†åŒ–å™¨ self.kmeans = kmeans self.scaler = scaler return result, kmeans.cluster_centers_ def interpret_clusters(self, clustered_df, feature_cols): \"\"\"è§£é‡Šèšç±»ç»“æœ\"\"\" cluster_profiles = [] for cluster_id in sorted(clustered_df['cluster'].unique()): cluster_data = clustered_df[ clustered_df['cluster'] == cluster_id ] profile = { 'cluster_id': cluster_id, 'size': len(cluster_data), 'percentage': len(cluster_data) / len(clustered_df) * 100, 'characteristics': {} } # è®¡ç®—å„ç‰¹å¾çš„å¹³å‡å€¼ for col in feature_cols: cluster_mean = cluster_data[col].mean() overall_mean = clustered_df[col].mean() # è®¡ç®—ç›¸å¯¹äºæ•´ä½“çš„å·®å¼‚ diff_pct = ((cluster_mean - overall_mean) / overall_mean) * 100 profile['characteristics'][col] = { 'cluster_mean': cluster_mean, 'overall_mean': overall_mean, 'difference_pct': diff_pct } cluster_profiles.append(profile) return cluster_profiles ä¸‰ã€ç”¨æˆ·ç•™å­˜åˆ†æ 3.1 ç•™å­˜ç‡è®¡ç®— 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 # ç”¨æˆ·ç•™å­˜åˆ†æ import pandas as pd import numpy as np class RetentionAnalysis: \"\"\"ç”¨æˆ·ç•™å­˜åˆ†æ\"\"\" def __init__(self, activity_data): \"\"\" activity_data: ç”¨æˆ·æ´»åŠ¨æ—¥å¿— å¿…éœ€åˆ—: user_id, activity_date \"\"\" self.data = activity_data def calculate_cohort_retention(self): \"\"\"è®¡ç®—åŒæœŸç¾¤ç•™å­˜\"\"\" # æ‰¾åˆ°æ¯ä¸ªç”¨æˆ·çš„é¦–æ¬¡æ´»åŠ¨æ—¥æœŸ self.data['activity_date'] = pd.to_datetime(self.data['activity_date']) cohort = self.data.groupby('user_id')['activity_date'].min().reset_index() cohort.columns = ['user_id', 'cohort_date'] # åˆå¹¶åŒæœŸç¾¤ä¿¡æ¯ df_with_cohort = self.data.merge(cohort, on='user_id') # è®¡ç®—åŒæœŸç¾¤å‘¨æœŸï¼ˆæœˆï¼‰ df_with_cohort['cohort_period'] = ( df_with_cohort['activity_date'].dt.to_period('M') - df_with_cohort['cohort_date'].dt.to_period('M') ).apply(lambda x: x.n) # åˆ›å»ºåŒæœŸç¾¤é€è§†è¡¨ cohort_data = df_with_cohort.groupby( ['cohort_date', 'cohort_period'] )['user_id'].nunique().reset_index() cohort_pivot = cohort_data.pivot( index='cohort_date', columns='cohort_period', values='user_id' ) # è®¡ç®—ç•™å­˜ç‡ cohort_size = cohort_pivot.iloc[:, 0] retention = cohort_pivot.divide(cohort_size, axis=0) * 100 return { 'cohort_data': cohort_pivot, 'retention_rate': retention.round(2), 'cohort_size': cohort_size } def calculate_retention_metrics(self, periods=[1, 7, 30]): \"\"\"è®¡ç®—ç‰¹å®šå‘¨æœŸçš„ç•™å­˜ç‡\"\"\" # æ‰¾åˆ°æ¯ä¸ªç”¨æˆ·çš„é¦–æ¬¡æ´»åŠ¨æ—¥æœŸ first_activity = self.data.groupby('user_id')['activity_date'].min().reset_index() first_activity.columns = ['user_id', 'first_date'] # åˆå¹¶é¦–æ¬¡æ´»åŠ¨ä¿¡æ¯ df_with_first = self.data.merge(first_activity, on='user_id') retention_metrics = {} for period in periods: # è®¡ç®—ç‰¹å®šå‘¨æœŸçš„ç•™å­˜ period_end = df_with_first['first_date'] + pd.Timedelta(days=period) retained_users = df_with_first[ df_with_first['activity_date'] \u003c= period_end ].groupby('user_id').size().reset_index() # æ ‡è®°ç•™å­˜ç”¨æˆ· retained_users['retained'] = retained_users[0] \u003e= 2 # è‡³å°‘2æ¬¡æ´»åŠ¨ retention_rate = retained_users['retained'].mean() * 100 retention_metrics[f'Day_{period}_retention'] = retention_rate.round(2) return retention_metrics def retention_curve_analysis(self): \"\"\"ç•™å­˜æ›²çº¿åˆ†æ\"\"\" # è®¡ç®—æ¯ä¸ªç”¨æˆ·çš„ç•™å­˜å¤©æ•° user_retention = self.data.groupby('user_id')['activity_date'].agg([ ('first_date', 'min'), ('last_date', 'max'), ('activity_days', lambda x: x.nunique()) ]).reset_index() user_retention['lifespan_days'] = ( user_retention['last_date'] - user_retention['first_date'] ).dt.days + 1 # ç•™å­˜æ›²çº¿ retention_curve = user_retention.groupby('lifespan_days').size().cumsum() / len(user_retention) * 100 return { 'retention_curve': retention_curve, 'median_lifespan': user_retention['lifespan_days'].median(), 'avg_lifespan': user_retention['lifespan_days'].mean() } 3.2 æµå¤±é¢„æµ‹ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 # ç”¨æˆ·æµå¤±é¢„æµ‹ from sklearn.model_selection import train_test_split from sklearn.ensemble import RandomForestClassifier from sklearn.metrics import classification_report, roc_auc_score class ChurnPrediction: \"\"\"ç”¨æˆ·æµå¤±é¢„æµ‹\"\"\" def __init__(self, activity_data): self.data = activity_data def create_churn_features(self, churn_days=30): \"\"\"åˆ›å»ºæµå¤±é¢„æµ‹ç‰¹å¾\"\"\" # å®šä¹‰æµå¤±ï¼šXå¤©æ²¡æœ‰æ´»åŠ¨ last_date = self.data['activity_date'].max() churn_date = last_date - pd.Timedelta(days=churn_days) # è®¡ç®—æ¯ä¸ªç”¨æˆ·çš„ç‰¹å¾ features = self.data.groupby('user_id').agg({ 'activity_date': [ ('last_activity', 'max'), ('first_activity', 'min'), ('activity_count', 'count'), ('unique_days', lambda x: x.nunique()) ] }).reset_index() features.columns = ['user_id', 'last_activity', 'first_activity', 'activity_count', 'unique_days'] # è®¡ç®—é¢å¤–ç‰¹å¾ features['account_age_days'] = ( features['last_activity'] - features['first_activity'] ).dt.days features['avg_daily_activity'] = features['activity_count'] / (features['unique_days'] + 1) features['days_since_last'] = ( last_date - features['last_activity'] ).dt.days # æ ‡è®°æµå¤±ç”¨æˆ· features['churned'] = (features['last_activity'] \u003c churn_date).astype(int) # é€‰æ‹©ç‰¹å¾åˆ— feature_cols = ['activity_count', 'unique_days', 'account_age_days', 'avg_daily_activity', 'days_since_last'] return features, feature_cols def train_churn_model(self, features_df, feature_cols): \"\"\"è®­ç»ƒæµå¤±é¢„æµ‹æ¨¡å‹\"\"\" X = features_df[feature_cols] y = features_df['churned'] # åˆ†å‰²æ•°æ® X_train, X_test, y_train, y_test = train_test_split( X, y, test_size=0.2, random_state=42 ) # è®­ç»ƒæ¨¡å‹ model = RandomForestClassifier( n_estimators=100, max_depth=10, random_state=42 ) model.fit(X_train, y_train) # é¢„æµ‹ y_pred = model.predict(X_test) y_prob = model.predict_proba(X_test)[:, 1] # è¯„ä¼° metrics = { 'accuracy': model.score(X_test, y_test), 'roc_auc': roc_auc_score(y_test, y_prob), 'classification_report': classification_report(y_test, y_pred), 'feature_importance': dict(zip(feature_cols, model.feature_importances_)) } self.model = model self.feature_cols = feature_cols return model, metrics def predict_churn_risk(self, user_data): \"\"\"é¢„æµ‹ç”¨æˆ·æµå¤±é£é™©\"\"\" # ç¡®ä¿ç‰¹å¾é¡ºåºä¸€è‡´ X = user_data[self.feature_cols] # é¢„æµ‹ churn_prob = self.model.predict_proba(X)[:, 1] # é£é™©åˆ†å±‚ risk_levels = [] for prob in churn_prob: if prob \u003e= 0.7: risk_levels.append('High') elif prob \u003e= 0.4: risk_levels.append('Medium') else: risk_levels.append('Low') return churn_prob, risk_levels å››ã€ç”¨æˆ·æ—…ç¨‹åˆ†æ 4.1 è·¯å¾„åˆ†æ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 # ç”¨æˆ·è·¯å¾„åˆ†æ class UserJourneyAnalysis: \"\"\"ç”¨æˆ·æ—…ç¨‹åˆ†æ\"\"\" def __init__(self, event_data): self.data = event_data def analyze_common_paths(self, top_n=10): \"\"\"åˆ†æå¸¸è§ç”¨æˆ·è·¯å¾„\"\"\" # æŒ‰ç”¨æˆ·å’Œä¼šè¯åˆ†ç»„ï¼Œåˆ›å»ºäº‹ä»¶åºåˆ— user_paths = self.data.sort_values(['user_id', 'session_id', 'timestamp']) \\ .groupby(['user_id', 'session_id'])['event_name'] \\ .apply(list).reset_index() user_paths.columns = ['user_id', 'session_id', 'path'] # ç»Ÿè®¡è·¯å¾„é¢‘ç‡ path_tuples = user_paths['path'].apply(tuple) path_counts = path_tuples.value_counts().head(top_n) return path_counts def create_transition_matrix(self): \"\"\"åˆ›å»ºçŠ¶æ€è½¬ç§»çŸ©é˜µ\"\"\" # åˆ›å»ºäº‹ä»¶å¯¹ self.data = self.data.sort_values(['user_id', 'timestamp']) self.data['next_event'] = self.data.groupby('user_id')['event_name'].shift(-1) # è®¡ç®—è½¬ç§»æ¦‚ç‡ transitions = self.data.groupby(['event_name', 'next_event']).size().reset_index() transitions.columns = ['from_event', 'to_event', 'count'] # åˆ›å»ºè½¬ç§»çŸ©é˜µ transition_matrix = transitions.pivot( index='from_event', columns='to_event', values='count' ).fillna(0) # å½’ä¸€åŒ– transition_matrix = transition_matrix.div(transition_matrix.sum(axis=1), axis=0) return transition_matrix def find_conversion_paths(self, start_event, end_event): \"\"\"æŸ¥æ‰¾ä»èµ·å§‹åˆ°ç»“æŸçš„è·¯å¾„\"\"\" # ç­›é€‰åŒ…å«èµ·å§‹äº‹ä»¶çš„ä¼šè¯ sessions_with_start = self.data[ self.data['event_name'] == start_event ]['session_id'].unique() # åœ¨è¿™äº›ä¼šè¯ä¸­æŸ¥æ‰¾ç»“æŸäº‹ä»¶ conversion_sessions = self.data[ (self.data['session_id'].isin(sessions_with_start)) \u0026 (self.data['event_name'] == end_event) ]['session_id'].unique() # æå–å®Œæ•´è·¯å¾„ conversion_paths = self.data[ self.data['session_id'].isin(conversion_sessions) ].sort_values(['session_id', 'timestamp']) \\ .groupby('session_id')['event_name'] \\ .apply(list) # ç»Ÿè®¡è·¯å¾„ path_stats = {} for path in conversion_paths: # æ‰¾åˆ°start_eventå’Œend_eventä¹‹é—´çš„è·¯å¾„ try: start_idx = path.index(start_event) end_idx = path.index(end_event) journey = path[start_idx:end_idx + 1] journey_tuple = tuple(journey) path_stats[journey_tuple] = path_stats.get(journey_tuple, 0) + 1 except ValueError: continue # æ’åºå¹¶è¿”å› sorted_paths = sorted(path_stats.items(), key=lambda x: x[1], reverse=True) return sorted_paths[:10] äº”ã€äº§å“ä¼˜åŒ–å®è·µ 5.1 A/Bæµ‹è¯•æ¡†æ¶ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 # A/Bæµ‹è¯•åˆ†æ from scipy import stats import pandas as pd class ABTestAnalyzer: \"\"\"A/Bæµ‹è¯•åˆ†æå™¨\"\"\" def __init__(self, experiment_data): \"\"\" experiment_data columns: - user_id - variant (A/B) - converted (0/1) - metric_value (å¯é€‰) \"\"\" self.data = experiment_data def calculate_conversion_rate(self): \"\"\"è®¡ç®—è½¬åŒ–ç‡\"\"\" summary = self.data.groupby('variant').agg({ 'user_id': 'count', 'converted': ['sum', 'mean'] }).round(4) summary.columns = ['total_users', 'conversions', 'conversion_rate'] return summary def statistical_test(self, confidence_level=0.95): \"\"\"ç»Ÿè®¡æ˜¾è‘—æ€§æ£€éªŒ\"\"\" # å‡†å¤‡æ•°æ® variant_a = self.data[self.data['variant'] == 'A']['converted'] variant_b = self.data[self.data['variant'] == 'B']['converted'] # æ‰§è¡ŒZæ£€éªŒ count_a = variant_a.sum() count_b = variant_b.sum() nobs_a = len(variant_a) nobs_b = len(variant_b) z_stat, p_value = stats.proportions_ztest( [count_a, count_b], [nobs_a, nobs_b] ) # è®¡ç®—ç½®ä¿¡åŒºé—´ se_A = np.sqrt(variant_a.std() / nobs_a) se_B = np.sqrt(variant_b.std() / nobs_b) cr_A = variant_a.mean() cr_B = variant_b.mean() diff = cr_B - cr_A se_diff = np.sqrt(se_A**2 + se_B**2) ci_lower = diff - stats.norm.ppf(1 - (1 - confidence_level) / 2) * se_diff ci_upper = diff + stats.norm.ppf(1 - (1 - confidence_level) / 2) * se_diff results = { 'variant_A_cr': cr_A, 'variant_B_cr': cr_B, 'absolute_lift': diff, 'relative_lift': diff / cr_A if cr_A \u003e 0 else 0, 'z_statistic': z_stat, 'p_value': p_value, 'is_significant': p_value \u003c (1 - confidence_level), 'confidence_interval': (ci_lower, ci_upper), 'confidence_level': confidence_level } return results def calculate_sample_size(self, baseline_cr, mde, alpha=0.05, power=0.8): \"\"\" è®¡ç®—æ‰€éœ€æ ·æœ¬é‡ baseline_cr: åŸºçº¿è½¬åŒ–ç‡ mde: æœ€å°å¯æ£€æµ‹æ•ˆåº” alpha: æ˜¾è‘—æ€§æ°´å¹³ power: ç»Ÿè®¡åŠŸæ•ˆ \"\"\" effect_size = mde / baseline_cr # ä½¿ç”¨Cohen's hè®¡ç®— from statsmodels.stats.proportion import proportion_effectsize from statsmodels.stats.power import NormalIndPower effect = proportion_effectsize(baseline_cr, baseline_cr * (1 + mde)) power_analysis = NormalIndPower() sample_size = power_analysis.solve_power( effect_size=effect, alpha=alpha, power=power ) return int(np.ceil(sample_size)) å…­ã€è¡Œä¸ºæ•°æ®å¯è§†åŒ– 6.1 ç”¨æˆ·è¡Œä¸ºçƒ­åŠ›å›¾ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 // ç”¨æˆ·è¡Œä¸ºçƒ­åŠ›å›¾å®ç° class UserBehaviorHeatmap { constructor(container, data) { this.container = container; this.data = data; this.init(); } init() { // åˆ›å»ºçƒ­åŠ›å›¾å›¾å±‚ this.heatmap = h337.createContainer({ container: this.container, radius: 25, maxOpacity: .8, minOpacity: 0, blur: .75 }); // æ·»åŠ æ•°æ®ç‚¹ const points = this.data.map(point =\u003e ({ x: point.x, y: point.y, value: 1 // æ¯ä¸ªç‚¹å‡»çš„æƒé‡ })); this.heatmap.setData({ max: Math.max(...this.data.map(d =\u003e d.value || 1)), data: points }); } // æŒ‰è®¾å¤‡ç±»å‹ç­›é€‰ filterByDevice(device) { const filtered = this.data.filter(d =\u003e d.device === device); this.heatmap.setData({ data: filtered }); } // æŒ‰æ—¥æœŸèŒƒå›´ç­›é€‰ filterByDateRange(startDate, endDate) { const filtered = this.data.filter(d =\u003e d.timestamp \u003e= startDate \u0026\u0026 d.timestamp \u003c= endDate ); this.heatmap.setData({ data: filtered }); } } æ€»ç»“ ç”¨æˆ·è¡Œä¸ºåˆ†ææ˜¯äº§å“ä¼˜åŒ–çš„åŸºçŸ³ã€‚é€šè¿‡ç³»ç»Ÿçš„è¡Œä¸ºåˆ†æï¼Œæˆ‘ä»¬å¯ä»¥ï¼š\nç†è§£ç”¨æˆ·éœ€æ±‚ - é€šè¿‡è¡Œä¸ºæ•°æ®æ´å¯Ÿç”¨æˆ·çœŸå®æ„å›¾ å‘ç°äº§å“é—®é¢˜ - è¯†åˆ«ç”¨æˆ·æµå¤±ç‚¹å’Œç“¶é¢ˆ ä¼˜åŒ–ç”¨æˆ·ä½“éªŒ - åŸºäºæ•°æ®åšå‡ºäº§å“å†³ç­– æå‡å…³é”®æŒ‡æ ‡ - ç•™å­˜ç‡ã€è½¬åŒ–ç‡ã€ç”¨æˆ·æ»¡æ„åº¦ è®°ä½ï¼Œæ•°æ®åªæ˜¯æ‰‹æ®µï¼Œæå‡ç”¨æˆ·ä½“éªŒæ‰æ˜¯ç›®çš„ã€‚å§‹ç»ˆä»¥ç”¨æˆ·ä¸ºä¸­å¿ƒï¼Œç”¨æ•°æ®é©±åŠ¨äº§å“å†³ç­–ã€‚\nå®ç”¨å·¥å…·\næ—¶é—´æˆ³è½¬æ¢ - æ—¶é—´æ•°æ®å¤„ç† JSONæ ¼å¼åŒ– - åˆ†ææ•°æ®æ ¼å¼åŒ– æ­£åˆ™è¡¨è¾¾å¼æµ‹è¯• - æ•°æ®æå–è¾…åŠ© ","wordCount":"2843","inLanguage":"zh-cn","datePublished":"2025-12-23T13:00:00+08:00","dateModified":"2025-12-23T13:00:00+08:00","author":{"@type":"Person","name":"æœ‰æ¡å·¥å…·å›¢é˜Ÿ"},"mainEntityOfPage":{"@type":"WebPage","@id":"/blog/articles/%E7%94%A8%E6%88%B7%E8%A1%8C%E4%B8%BA%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E6%B4%9E%E5%AF%9F%E7%94%A8%E6%88%B7%E8%A1%8C%E4%B8%BA%E4%BC%98%E5%8C%96%E4%BA%A7%E5%93%81%E4%BD%93%E9%AA%8C/"},"publisher":{"@type":"Organization","name":"æŠ€æœ¯åšå®¢ - æœ‰æ¡å·¥å…·","logo":{"@type":"ImageObject","url":"/favicon.ico"}}}</script></head><body id=top><header class=header><nav class=nav><div class=logo><a href=/blog/ accesskey=h title="æŠ€æœ¯åšå®¢ - æœ‰æ¡å·¥å…· (Alt + H)">æŠ€æœ¯åšå®¢ - æœ‰æ¡å·¥å…·</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=/blog/posts/ title="æ‰€æœ‰æ–‡ç« åˆ—è¡¨ - æœ‰æ¡å·¥å…·æŠ€æœ¯åšå®¢ï¼šæŸ¥çœ‹æ‰€æœ‰æŠ€æœ¯æ–‡ç« å’Œæ•™ç¨‹å†…å®¹"><span>æ–‡ç« </span></a></li><li><a href=https://www.util.cn title="æœ‰æ¡å·¥å…· - å¼€å‘è€…çš„å¸¸ç”¨å·¥å…·é›†åˆï¼šæ— å¹¿å‘Š Â· æœ¬åœ°è®¡ç®— Â· å³å¼€å³ç”¨çš„åœ¨çº¿å·¥å…·å¹³å°ï¼Œæä¾›JSONæ ¼å¼åŒ–ã€SQLæ ¼å¼åŒ–ã€Markdownç¼–è¾‘å™¨ç­‰å®ç”¨å·¥å…·"><span>æœ‰æ¡å·¥å…·</span>&nbsp;
<svg fill="none" shape-rendering="geometricPrecision" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" height="12" width="12"><path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"/><path d="M15 3h6v6"/><path d="M10 14 21 3"/></svg></a></li><li><a href=/blog/categories/ title="æ–‡ç« åˆ†ç±» - æœ‰æ¡å·¥å…·æŠ€æœ¯åšå®¢ï¼šæŒ‰æŠ€æœ¯é¢†åŸŸåˆ†ç±»çš„ä¼˜è´¨æ–‡ç« ï¼ŒåŒ…æ‹¬å‰ç«¯å¼€å‘ã€å·¥å…·ä½¿ç”¨ã€ç¼–ç¨‹æŠ€å·§ç­‰"><span>åˆ†ç±»</span></a></li><li><a href=/blog/tags/ title="æ ‡ç­¾äº‘ - æœ‰æ¡å·¥å…·æŠ€æœ¯åšå®¢ï¼šé€šè¿‡æ ‡ç­¾å¿«é€Ÿæ‰¾åˆ°æ„Ÿå…´è¶£çš„æŠ€æœ¯æ–‡ç« å’Œæ•™ç¨‹å†…å®¹"><span>æ ‡ç­¾</span></a></li><li><a href=/blog/archives/ title="æ–‡ç« å½’æ¡£ - æœ‰æ¡å·¥å…·æŠ€æœ¯åšå®¢ï¼šæŒ‰æ—¶é—´æŸ¥çœ‹å†å²æ–‡ç« "><span>å½’æ¡£</span></a></li><li><a href=/blog/search/ title="æœç´¢æ–‡ç«  - æœ‰æ¡å·¥å…·æŠ€æœ¯åšå®¢ï¼šé€šè¿‡å…³é”®è¯æœç´¢æ‰¾åˆ°æ„Ÿå…´è¶£çš„æŠ€æœ¯æ–‡ç« å’Œæ•™ç¨‹å†…å®¹ï¼Œæ”¯æŒæ ‡é¢˜ã€å†…å®¹ã€åˆ†ç±»å’Œæ ‡ç­¾æœç´¢"><span>æœç´¢</span></a></li></ul></nav></header><main class=main><article class=post-single><div class=post-content-wrapper><main class=post-content-main><header class=post-header-main><h1 class="post-title entry-hint-parent">ç”¨æˆ·è¡Œä¸ºåˆ†æå®æˆ˜ï¼šæ´å¯Ÿç”¨æˆ·è¡Œä¸ºï¼Œä¼˜åŒ–äº§å“ä½“éªŒ</h1><div class=post-description>æ·±å…¥æ¢è®¨ç”¨æˆ·è¡Œä¸ºåˆ†æçš„æ–¹æ³•è®ºå’Œå®è·µæŠ€å·§ï¼Œä»æ•°æ®é‡‡é›†ã€è¡Œä¸ºåˆ†æã€æ¼æ–—ä¼˜åŒ–åˆ°ä¸ªæ€§åŒ–æ¨èï¼Œå¸®åŠ©ä½ å…¨é¢ç†è§£ç”¨æˆ·ï¼Œæå‡äº§å“ä½“éªŒå’Œè½¬åŒ–ç‡ã€‚</div><div class=post-meta><div class=post-meta-content><div class=post-categories-inline><a href=/blog/categories/%E7%94%A8%E6%88%B7%E7%A0%94%E7%A9%B6/ class=category-link>ç”¨æˆ·ç ”ç©¶</a><a href=/blog/categories/%E4%BA%A7%E5%93%81%E4%BC%98%E5%8C%96/ class=category-link>äº§å“ä¼˜åŒ–</a></div><span class=post-date>2025-12-23</span><span class=post-author>æœ‰æ¡å·¥å…·å›¢é˜Ÿ</span></div><style>.post-meta-content{display:flex;align-items:center;flex-wrap:wrap;gap:.75rem;font-family:sf mono,monaco,courier new,monospace;font-size:.875rem;color:#9ca3af !important}.post-categories-inline{display:inline-flex;align-items:center;gap:.5rem}.category-link{display:inline-flex;align-items:center;gap:.25rem;padding:.25rem .75rem;background:rgba(255,255,255,.1);color:#e5e7eb !important;text-decoration:none;font-size:.75rem;font-weight:600;text-transform:uppercase;letter-spacing:.05em;border:1px solid rgba(255,255,255,.2);border-radius:0;transition:all .3s ease;white-space:nowrap}.category-link:hover{background:rgba(255,255,255,.2);color:#fff !important;border-color:rgba(255,255,255,.3);transform:translateY(-1px)}.category-link::before{content:'ğŸ“';font-size:.7rem;opacity:.8}.post-date,.post-reading-time,.post-word-count,.post-author{color:#9ca3af !important}[data-theme=dark] .post-meta-content{color:#9ca3af !important}[data-theme=dark] .category-link{background:rgba(255,255,255,.1);color:#e5e7eb !important;border-color:rgba(255,255,255,.2)}[data-theme=dark] .category-link:hover{background:rgba(255,255,255,.2);color:#fff !important;border-color:rgba(255,255,255,.3)}[data-theme=dark] .post-date,[data-theme=dark] .post-reading-time,[data-theme=dark] .post-word-count,[data-theme=dark] .post-author{color:#9ca3af !important}[data-theme=light] .post-meta-content{color:#6c757d !important}[data-theme=light] .category-link{background:rgba(0,0,0,5%);color:#495057 !important;border-color:rgba(0,0,0,.15)}[data-theme=light] .category-link:hover{background:rgba(0,102,204,.1);color:#212529 !important;border-color:rgba(0,102,204,.3)}[data-theme=light] .post-date,[data-theme=light] .post-reading-time,[data-theme=light] .post-word-count,[data-theme=light] .post-author{color:#6c757d !important}@media(max-width:768px){.post-meta-content{gap:.5rem;font-size:.8rem}.category-link{padding:.2rem .6rem;font-size:.7rem}}</style></div></header><div class=post-content><h2 id=å¼•è¨€>å¼•è¨€<a hidden class=anchor aria-hidden=true href=#å¼•è¨€>#</a></h2><p>ç”¨æˆ·è¡Œä¸ºåˆ†ææ˜¯äº§å“ä¼˜åŒ–çš„æ ¸å¿ƒã€‚é€šè¿‡æ·±å…¥äº†è§£ç”¨æˆ·å¦‚ä½•ä½¿ç”¨äº§å“ï¼Œæˆ‘ä»¬å¯ä»¥å‘ç°ç—›ç‚¹ã€ä¼˜åŒ–ä½“éªŒã€æå‡è½¬åŒ–ã€‚æœ¬æ–‡å°†ç³»ç»Ÿè®²è§£ç”¨æˆ·è¡Œä¸ºåˆ†æçš„å®Œæ•´æ–¹æ³•è®ºã€‚</p><h2 id=ä¸€ç”¨æˆ·è¡Œä¸ºæ•°æ®é‡‡é›†>ä¸€ã€ç”¨æˆ·è¡Œä¸ºæ•°æ®é‡‡é›†<a hidden class=anchor aria-hidden=true href=#ä¸€ç”¨æˆ·è¡Œä¸ºæ•°æ®é‡‡é›†>#</a></h2><h3 id=11-è¡Œä¸ºæ•°æ®æ¨¡å‹>1.1 è¡Œä¸ºæ•°æ®æ¨¡å‹<a hidden class=anchor aria-hidden=true href=#11-è¡Œä¸ºæ•°æ®æ¨¡å‹>#</a></h3><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">56
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">57
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">58
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">59
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">60
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">61
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">62
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">63
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">64
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">65
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">66
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">67
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">68
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">69
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">70
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">71
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">72
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">73
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">74
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">75
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">76
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">77
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">78
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">79
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">80
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">81
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">82
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">83
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">84
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">85
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">86
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">87
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">88
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">89
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">90
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">91
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">92
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">93
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">94
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">95
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">96
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">97
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">98
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// ç”¨æˆ·è¡Œä¸ºäº‹ä»¶æ•°æ®æ¨¡å‹
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span><span style=color:#ff7b72>const</span> UserBehaviorEvent <span style=color:#ff7b72;font-weight:700>=</span> {
</span></span><span style=display:flex><span>  <span style=color:#8b949e;font-style:italic>// æ ¸å¿ƒäº‹ä»¶å±æ€§
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>  event<span style=color:#ff7b72;font-weight:700>:</span> {
</span></span><span style=display:flex><span>    name<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#a5d6ff>&#34;product_view&#34;</span>,        <span style=color:#8b949e;font-style:italic>// äº‹ä»¶åç§°
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>    category<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#a5d6ff>&#34;engagement&#34;</span>,       <span style=color:#8b949e;font-style:italic>// äº‹ä»¶åˆ†ç±»
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>    timestamp<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#a5d6ff>1703270400000</span>,     <span style=color:#8b949e;font-style:italic>// æ—¶é—´æˆ³
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>    userId<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#a5d6ff>&#34;user_12345&#34;</span>,         <span style=color:#8b949e;font-style:italic>// ç”¨æˆ·ID
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>    sessionId<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#a5d6ff>&#34;session_abc&#34;</span>,     <span style=color:#8b949e;font-style:italic>// ä¼šè¯ID
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>
</span></span><span style=display:flex><span>    <span style=color:#8b949e;font-style:italic>// äº‹ä»¶å±æ€§
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>    properties<span style=color:#ff7b72;font-weight:700>:</span> {
</span></span><span style=display:flex><span>      <span style=color:#8b949e;font-style:italic>// äº§å“ç›¸å…³
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>      productId<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#a5d6ff>&#34;prod_001&#34;</span>,
</span></span><span style=display:flex><span>      productName<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#a5d6ff>&#34;Premium Plan&#34;</span>,
</span></span><span style=display:flex><span>      category<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#a5d6ff>&#34;subscription&#34;</span>,
</span></span><span style=display:flex><span>      price<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#a5d6ff>99.00</span>,
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      <span style=color:#8b949e;font-style:italic>// ç”¨æˆ·ä¸Šä¸‹æ–‡
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>      referrer<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#a5d6ff>&#34;https://google.com&#34;</span>,
</span></span><span style=display:flex><span>      utmSource<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#a5d6ff>&#34;google&#34;</span>,
</span></span><span style=display:flex><span>      utmMedium<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#a5d6ff>&#34;cpc&#34;</span>,
</span></span><span style=display:flex><span>      utmCampaign<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#a5d6ff>&#34;winter_sale&#34;</span>,
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      <span style=color:#8b949e;font-style:italic>// æŠ€æœ¯ç¯å¢ƒ
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>      device<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#a5d6ff>&#34;desktop&#34;</span>,
</span></span><span style=display:flex><span>      browser<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#a5d6ff>&#34;Chrome&#34;</span>,
</span></span><span style=display:flex><span>      os<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#a5d6ff>&#34;Windows 10&#34;</span>,
</span></span><span style=display:flex><span>      screenResolution<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#a5d6ff>&#34;1920x1080&#34;</span>,
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      <span style=color:#8b949e;font-style:italic>// é¡µé¢ä¿¡æ¯
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>      pageUrl<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#a5d6ff>&#34;/products/premium&#34;</span>,
</span></span><span style=display:flex><span>      pageTitle<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#a5d6ff>&#34;Premium Plan&#34;</span>,
</span></span><span style=display:flex><span>      previousPage<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#a5d6ff>&#34;/pricing&#34;</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  },
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#8b949e;font-style:italic>// ç”¨æˆ·å±æ€§
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>  user<span style=color:#ff7b72;font-weight:700>:</span> {
</span></span><span style=display:flex><span>    userId<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#a5d6ff>&#34;user_12345&#34;</span>,
</span></span><span style=display:flex><span>    email<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#a5d6ff>&#34;user@example.com&#34;</span>,
</span></span><span style=display:flex><span>    country<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#a5d6ff>&#34;CN&#34;</span>,
</span></span><span style=display:flex><span>    language<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#a5d6ff>&#34;zh-CN&#34;</span>,
</span></span><span style=display:flex><span>    timezone<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#a5d6ff>&#34;Asia/Shanghai&#34;</span>,
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8b949e;font-style:italic>// è‡ªå®šä¹‰å±æ€§
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>    customerTier<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#a5d6ff>&#34;free&#34;</span>,
</span></span><span style=display:flex><span>    registrationDate<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#a5d6ff>&#34;2025-01-15&#34;</span>,
</span></span><span style=display:flex><span>    lastLoginDate<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#a5d6ff>&#34;2025-12-20&#34;</span>,
</span></span><span style=display:flex><span>    totalSpent<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#a5d6ff>0</span>,
</span></span><span style=display:flex><span>    purchaseCount<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#a5d6ff>0</span>
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>};
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// äº‹ä»¶è¿½è¸ªä»£ç ç¤ºä¾‹
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span><span style=color:#ff7b72>function</span> trackEvent(eventName, properties <span style=color:#ff7b72;font-weight:700>=</span> {}) {
</span></span><span style=display:flex><span>  <span style=color:#ff7b72>const</span> event <span style=color:#ff7b72;font-weight:700>=</span> {
</span></span><span style=display:flex><span>    event<span style=color:#ff7b72;font-weight:700>:</span> eventName,
</span></span><span style=display:flex><span>    timestamp<span style=color:#ff7b72;font-weight:700>:</span> Date.now(),
</span></span><span style=display:flex><span>    userId<span style=color:#ff7b72;font-weight:700>:</span> getCurrentUserId(),
</span></span><span style=display:flex><span>    sessionId<span style=color:#ff7b72;font-weight:700>:</span> getSessionId(),
</span></span><span style=display:flex><span>    properties<span style=color:#ff7b72;font-weight:700>:</span> {
</span></span><span style=display:flex><span>      ...properties,
</span></span><span style=display:flex><span>      page<span style=color:#ff7b72;font-weight:700>:</span> window.location.href,
</span></span><span style=display:flex><span>      referrer<span style=color:#ff7b72;font-weight:700>:</span> document.referrer
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  };
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#8b949e;font-style:italic>// å‘é€åˆ°åˆ†æå¹³å°
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>  <span style=color:#8b949e;font-style:italic>// Mixpanel / Amplitude / Google Analytics
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>  analytics.track(eventName, properties);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#ff7b72>return</span> event;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// å¸¸è§äº‹ä»¶å®šä¹‰
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span><span style=color:#ff7b72>const</span> CommonEvents <span style=color:#ff7b72;font-weight:700>=</span> {
</span></span><span style=display:flex><span>  <span style=color:#8b949e;font-style:italic>// é¡µé¢æµè§ˆ
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>  pageView<span style=color:#ff7b72;font-weight:700>:</span> (pageName) =&gt; trackEvent(<span style=color:#a5d6ff>&#39;page_view&#39;</span>, {
</span></span><span style=display:flex><span>    page_name<span style=color:#ff7b72;font-weight:700>:</span> pageName
</span></span><span style=display:flex><span>  }),
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#8b949e;font-style:italic>// ç”¨æˆ·æ³¨å†Œ
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>  signUp<span style=color:#ff7b72;font-weight:700>:</span> (method) =&gt; trackEvent(<span style=color:#a5d6ff>&#39;sign_up&#39;</span>, {
</span></span><span style=display:flex><span>    signup_method<span style=color:#ff7b72;font-weight:700>:</span> method
</span></span><span style=display:flex><span>  }),
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#8b949e;font-style:italic>// äº§å“ä½¿ç”¨
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>  featureUse<span style=color:#ff7b72;font-weight:700>:</span> (featureName) =&gt; trackEvent(<span style=color:#a5d6ff>&#39;feature_used&#39;</span>, {
</span></span><span style=display:flex><span>    feature_name<span style=color:#ff7b72;font-weight:700>:</span> featureName
</span></span><span style=display:flex><span>  }),
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#8b949e;font-style:italic>// è½¬åŒ–äº‹ä»¶
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>  purchase<span style=color:#ff7b72;font-weight:700>:</span> (orderId, value) =&gt; trackEvent(<span style=color:#a5d6ff>&#39;purchase&#39;</span>, {
</span></span><span style=display:flex><span>    order_id<span style=color:#ff7b72;font-weight:700>:</span> orderId,
</span></span><span style=display:flex><span>    revenue<span style=color:#ff7b72;font-weight:700>:</span> value
</span></span><span style=display:flex><span>  })
</span></span><span style=display:flex><span>};
</span></span></code></pre></td></tr></table></div></div><h3 id=12-åŸ‹ç‚¹è®¾è®¡åŸåˆ™>1.2 åŸ‹ç‚¹è®¾è®¡åŸåˆ™<a hidden class=anchor aria-hidden=true href=#12-åŸ‹ç‚¹è®¾è®¡åŸåˆ™>#</a></h3><p><strong>åŸ‹ç‚¹è®¾è®¡æ¡†æ¶</strong></p><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">56
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">57
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">58
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#7ee787>äº‹ä»¶è®¾è®¡åŸåˆ™</span>:<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>  </span><span style=color:#7ee787>å‘½åè§„èŒƒ</span>:<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span>- <span style=color:#a5d6ff>ä½¿ç”¨åŠ¨è¯+åè¯ç»„åˆ</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span>- <span style=color:#a5d6ff>ç»Ÿä¸€ä½¿ç”¨ä¸‹åˆ’çº¿åˆ†éš”</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span>- <span style=color:#a5d6ff>ä¿æŒå‘½åä¸€è‡´æ€§</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span>- <span style=color:#a5d6ff>é¿å…ä½¿ç”¨ç¼©å†™</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span><span style=color:#7ee787>å¥½çš„ä¾‹å­</span>:<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>      </span>- <span style=color:#a5d6ff>product_viewed</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>      </span>- <span style=color:#a5d6ff>cart_item_added</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>      </span>- <span style=color:#a5d6ff>search_performed</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>      </span>- <span style=color:#a5d6ff>video_played</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span><span style=color:#7ee787>ä¸å¥½çš„ä¾‹å­</span>:<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>      </span>- <span style=color:#a5d6ff>prodView</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>      </span>- <span style=color:#a5d6ff>add2cart</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>      </span>- <span style=color:#a5d6ff>srch</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>      </span>- <span style=color:#a5d6ff>vidPlay</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>  </span><span style=color:#7ee787>å±æ€§è®¾è®¡</span>:<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span>- <span style=color:#a5d6ff>å¿…éœ€å±æ€§ vs å¯é€‰å±æ€§</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span>- <span style=color:#a5d6ff>æ•°æ®ç±»å‹æ˜ç¡®</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span>- <span style=color:#a5d6ff>æä¾›é»˜è®¤å€¼</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span>- <span style=color:#a5d6ff>æ–‡æ¡£è¯´æ˜æ¸…æ™°</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span><span style=color:#7ee787>æ ‡å‡†å±æ€§</span>:<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>      </span>- <span style=color:#a5d6ff>event_time (datetime)</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>      </span>- <span style=color:#a5d6ff>user_id (string)</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>      </span>- <span style=color:#a5d6ff>session_id (string)</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>      </span>- <span style=color:#a5d6ff>platform (string)</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>      </span>- <span style=color:#a5d6ff>device_type (string)</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>  </span><span style=color:#7ee787>äº‹ä»¶å±‚çº§</span>:<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span><span style=color:#7ee787>Level 1 - æ ¸å¿ƒä¸šåŠ¡äº‹ä»¶</span>:<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>      </span>- <span style=color:#a5d6ff>sign_up</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>      </span>- <span style=color:#a5d6ff>purchase</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>      </span>- <span style=color:#a5d6ff>subscription_renewal</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span><span style=color:#7ee787>Level 2 - åŠŸèƒ½ä½¿ç”¨äº‹ä»¶</span>:<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>      </span>- <span style=color:#a5d6ff>feature_used</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>      </span>- <span style=color:#a5d6ff>tool_accessed</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>      </span>- <span style=color:#a5d6ff>report_generated</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span><span style=color:#7ee787>Level 3 - äº¤äº’ç»†èŠ‚äº‹ä»¶</span>:<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>      </span>- <span style=color:#a5d6ff>button_clicked</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>      </span>- <span style=color:#a5d6ff>form_field_focus</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>      </span>- <span style=color:#a5d6ff>error_displayed</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>  </span><span style=color:#7ee787>é‡‡æ ·ç­–ç•¥</span>:<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span><span style=color:#7ee787>é«˜ä»·å€¼äº‹ä»¶</span>:<span style=color:#6e7681> </span><span style=color:#a5d6ff>100</span><span style=color:#a5d6ff>% é‡‡é›†</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>      </span>- <span style=color:#a5d6ff>è´­ä¹°ã€æ³¨å†Œã€è®¢é˜…</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span><span style=color:#7ee787>ä¸­ç­‰ä»·å€¼äº‹ä»¶</span>:<span style=color:#6e7681> </span><span style=color:#a5d6ff>10-50</span><span style=color:#a5d6ff>% é‡‡æ ·</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>      </span>- <span style=color:#a5d6ff>é¡µé¢æµè§ˆã€ç‚¹å‡»</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span><span style=color:#7ee787>ä½ä»·å€¼äº‹ä»¶</span>:<span style=color:#6e7681> </span><span style=color:#a5d6ff>1-10</span><span style=color:#a5d6ff>% é‡‡æ ·</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>      </span>- <span style=color:#a5d6ff>é¼ æ ‡ç§»åŠ¨ã€æ»šåŠ¨</span><span style=color:#6e7681>
</span></span></span></code></pre></td></tr></table></div></div><h2 id=äºŒç”¨æˆ·åˆ†ç¾¤åˆ†æ>äºŒã€ç”¨æˆ·åˆ†ç¾¤åˆ†æ<a hidden class=anchor aria-hidden=true href=#äºŒç”¨æˆ·åˆ†ç¾¤åˆ†æ>#</a></h2><h3 id=21-rfmç”¨æˆ·åˆ†å±‚>2.1 RFMç”¨æˆ·åˆ†å±‚<a hidden class=anchor aria-hidden=true href=#21-rfmç”¨æˆ·åˆ†å±‚>#</a></h3><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 56
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 57
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 58
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 59
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 60
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 61
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 62
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 63
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 64
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 65
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 66
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 67
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 68
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 69
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 70
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 71
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 72
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 73
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 74
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 75
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 76
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 77
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 78
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 79
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 80
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 81
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 82
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 83
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 84
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 85
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 86
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 87
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 88
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 89
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 90
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 91
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 92
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 93
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 94
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 95
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 96
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 97
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 98
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 99
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">100
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">101
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">102
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">103
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">104
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">105
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">106
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">107
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">108
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">109
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">110
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">111
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">112
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">113
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">114
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">115
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">116
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">117
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">118
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">119
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">120
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">121
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">122
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">123
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">124
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">125
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">126
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">127
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">128
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">129
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">130
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">131
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">132
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">133
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">134
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">135
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">136
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">137
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">138
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">139
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">140
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">141
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">142
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">143
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">144
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">145
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">146
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">147
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">148
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">149
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">150
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">151
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">152
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">153
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">154
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">155
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">156
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">157
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">158
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">159
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">160
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">161
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">162
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">163
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">164
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">165
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">166
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">167
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">168
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">169
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">170
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">171
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">172
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">173
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">174
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">175
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">176
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">177
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">178
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">179
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">180
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">181
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">182
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">183
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">184
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">185
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">186
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">187
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">188
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">189
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">190
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">191
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">192
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">193
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">194
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">195
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">196
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#8b949e;font-style:italic># RFMç”¨æˆ·ä»·å€¼åˆ†å±‚åˆ†æ</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>import</span> <span style=color:#ff7b72>pandas</span> <span style=color:#ff7b72>as</span> <span style=color:#ff7b72>pd</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>import</span> <span style=color:#ff7b72>numpy</span> <span style=color:#ff7b72>as</span> <span style=color:#ff7b72>np</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>from</span> <span style=color:#ff7b72>datetime</span> <span style=color:#ff7b72>import</span> datetime, timedelta
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>class</span> <span style=color:#f0883e;font-weight:700>RFMAnalysis</span>:
</span></span><span style=display:flex><span>    <span style=color:#a5d6ff>&#34;&#34;&#34;RFMç”¨æˆ·ä»·å€¼åˆ†æ&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>__init__</span>(self, transactions_df):
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;&#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>        transactions_df: åŒ…å«ç”¨æˆ·äº¤æ˜“æ•°æ®
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>        å¿…éœ€åˆ—: user_id, order_date, amount
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>        &#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>        self<span style=color:#ff7b72;font-weight:700>.</span>df <span style=color:#ff7b72;font-weight:700>=</span> transactions_df
</span></span><span style=display:flex><span>        self<span style=color:#ff7b72;font-weight:700>.</span>analysis_date <span style=color:#ff7b72;font-weight:700>=</span> datetime<span style=color:#ff7b72;font-weight:700>.</span>now()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>calculate_rfm</span>(self):
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;&#34;&#34;è®¡ç®—RFMæŒ‡æ ‡&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># è®¡ç®—æœ€è¿‘è´­ä¹°æ—¶é—´</span>
</span></span><span style=display:flex><span>        recency <span style=color:#ff7b72;font-weight:700>=</span> self<span style=color:#ff7b72;font-weight:700>.</span>df<span style=color:#ff7b72;font-weight:700>.</span>groupby(<span style=color:#a5d6ff>&#39;user_id&#39;</span>)[<span style=color:#a5d6ff>&#39;order_date&#39;</span>]<span style=color:#ff7b72;font-weight:700>.</span>max()<span style=color:#ff7b72;font-weight:700>.</span>reset_index()
</span></span><span style=display:flex><span>        recency[<span style=color:#a5d6ff>&#39;recency&#39;</span>] <span style=color:#ff7b72;font-weight:700>=</span> (
</span></span><span style=display:flex><span>            self<span style=color:#ff7b72;font-weight:700>.</span>analysis_date <span style=color:#ff7b72;font-weight:700>-</span> recency[<span style=color:#a5d6ff>&#39;order_date&#39;</span>]
</span></span><span style=display:flex><span>        )<span style=color:#ff7b72;font-weight:700>.</span>dt<span style=color:#ff7b72;font-weight:700>.</span>days
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># è®¡ç®—è´­ä¹°é¢‘ç‡</span>
</span></span><span style=display:flex><span>        frequency <span style=color:#ff7b72;font-weight:700>=</span> self<span style=color:#ff7b72;font-weight:700>.</span>df<span style=color:#ff7b72;font-weight:700>.</span>groupby(<span style=color:#a5d6ff>&#39;user_id&#39;</span>)[<span style=color:#a5d6ff>&#39;order_date&#39;</span>]<span style=color:#ff7b72;font-weight:700>.</span>count()<span style=color:#ff7b72;font-weight:700>.</span>reset_index()
</span></span><span style=display:flex><span>        frequency<span style=color:#ff7b72;font-weight:700>.</span>columns <span style=color:#ff7b72;font-weight:700>=</span> [<span style=color:#a5d6ff>&#39;user_id&#39;</span>, <span style=color:#a5d6ff>&#39;frequency&#39;</span>]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># è®¡ç®—è´­ä¹°é‡‘é¢</span>
</span></span><span style=display:flex><span>        monetary <span style=color:#ff7b72;font-weight:700>=</span> self<span style=color:#ff7b72;font-weight:700>.</span>df<span style=color:#ff7b72;font-weight:700>.</span>groupby(<span style=color:#a5d6ff>&#39;user_id&#39;</span>)[<span style=color:#a5d6ff>&#39;amount&#39;</span>]<span style=color:#ff7b72;font-weight:700>.</span>sum()<span style=color:#ff7b72;font-weight:700>.</span>reset_index()
</span></span><span style=display:flex><span>        monetary<span style=color:#ff7b72;font-weight:700>.</span>columns <span style=color:#ff7b72;font-weight:700>=</span> [<span style=color:#a5d6ff>&#39;user_id&#39;</span>, <span style=color:#a5d6ff>&#39;monetary&#39;</span>]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># åˆå¹¶RFM</span>
</span></span><span style=display:flex><span>        rfm <span style=color:#ff7b72;font-weight:700>=</span> recency<span style=color:#ff7b72;font-weight:700>.</span>merge(frequency, on<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>&#39;user_id&#39;</span>)<span style=color:#ff7b72;font-weight:700>.</span>merge(monetary, on<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>&#39;user_id&#39;</span>)
</span></span><span style=display:flex><span>        rfm <span style=color:#ff7b72;font-weight:700>=</span> rfm[[<span style=color:#a5d6ff>&#39;user_id&#39;</span>, <span style=color:#a5d6ff>&#39;recency&#39;</span>, <span style=color:#a5d6ff>&#39;frequency&#39;</span>, <span style=color:#a5d6ff>&#39;monetary&#39;</span>]]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>return</span> rfm
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>score_rfm</span>(self, rfm_df, n_quantiles<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>5</span>):
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;&#34;&#34;RFMè¯„åˆ†ï¼ˆ1-5åˆ†ï¼‰&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># Råˆ†æ•°ï¼šè¶Šå°è¶Šå¥½ï¼ˆæœ€è¿‘è´­ä¹°å¾—åˆ†é«˜ï¼‰</span>
</span></span><span style=display:flex><span>        rfm_df[<span style=color:#a5d6ff>&#39;R_score&#39;</span>] <span style=color:#ff7b72;font-weight:700>=</span> pd<span style=color:#ff7b72;font-weight:700>.</span>qcut(
</span></span><span style=display:flex><span>            rfm_df[<span style=color:#a5d6ff>&#39;recency&#39;</span>],
</span></span><span style=display:flex><span>            n_quantiles,
</span></span><span style=display:flex><span>            labels<span style=color:#ff7b72;font-weight:700>=</span>[<span style=color:#a5d6ff>5</span>, <span style=color:#a5d6ff>4</span>, <span style=color:#a5d6ff>3</span>, <span style=color:#a5d6ff>2</span>, <span style=color:#a5d6ff>1</span>],
</span></span><span style=display:flex><span>            duplicates<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>&#39;drop&#39;</span>
</span></span><span style=display:flex><span>        )<span style=color:#ff7b72;font-weight:700>.</span>astype(int)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># Fåˆ†æ•°ï¼šè¶Šå¤§è¶Šå¥½</span>
</span></span><span style=display:flex><span>        rfm_df[<span style=color:#a5d6ff>&#39;F_score&#39;</span>] <span style=color:#ff7b72;font-weight:700>=</span> pd<span style=color:#ff7b72;font-weight:700>.</span>qcut(
</span></span><span style=display:flex><span>            rfm_df[<span style=color:#a5d6ff>&#39;frequency&#39;</span>]<span style=color:#ff7b72;font-weight:700>.</span>rank(method<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>&#39;first&#39;</span>),
</span></span><span style=display:flex><span>            n_quantiles,
</span></span><span style=display:flex><span>            labels<span style=color:#ff7b72;font-weight:700>=</span>[<span style=color:#a5d6ff>1</span>, <span style=color:#a5d6ff>2</span>, <span style=color:#a5d6ff>3</span>, <span style=color:#a5d6ff>4</span>, <span style=color:#a5d6ff>5</span>],
</span></span><span style=display:flex><span>            duplicates<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>&#39;drop&#39;</span>
</span></span><span style=display:flex><span>        )<span style=color:#ff7b72;font-weight:700>.</span>astype(int)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># Måˆ†æ•°ï¼šè¶Šå¤§è¶Šå¥½</span>
</span></span><span style=display:flex><span>        rfm_df[<span style=color:#a5d6ff>&#39;M_score&#39;</span>] <span style=color:#ff7b72;font-weight:700>=</span> pd<span style=color:#ff7b72;font-weight:700>.</span>qcut(
</span></span><span style=display:flex><span>            rfm_df[<span style=color:#a5d6ff>&#39;monetary&#39;</span>]<span style=color:#ff7b72;font-weight:700>.</span>rank(method<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>&#39;first&#39;</span>),
</span></span><span style=display:flex><span>            n_quantiles,
</span></span><span style=display:flex><span>            labels<span style=color:#ff7b72;font-weight:700>=</span>[<span style=color:#a5d6ff>1</span>, <span style=color:#a5d6ff>2</span>, <span style=color:#a5d6ff>3</span>, <span style=color:#a5d6ff>4</span>, <span style=color:#a5d6ff>5</span>],
</span></span><span style=display:flex><span>            duplicates<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>&#39;drop&#39;</span>
</span></span><span style=display:flex><span>        )<span style=color:#ff7b72;font-weight:700>.</span>astype(int)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># è®¡ç®—ç»¼åˆRFMåˆ†æ•°</span>
</span></span><span style=display:flex><span>        rfm_df[<span style=color:#a5d6ff>&#39;RFM_score&#39;</span>] <span style=color:#ff7b72;font-weight:700>=</span> (
</span></span><span style=display:flex><span>            rfm_df[<span style=color:#a5d6ff>&#39;R_score&#39;</span>] <span style=color:#ff7b72;font-weight:700>*</span> <span style=color:#a5d6ff>100</span> <span style=color:#ff7b72;font-weight:700>+</span>
</span></span><span style=display:flex><span>            rfm_df[<span style=color:#a5d6ff>&#39;F_score&#39;</span>] <span style=color:#ff7b72;font-weight:700>*</span> <span style=color:#a5d6ff>10</span> <span style=color:#ff7b72;font-weight:700>+</span>
</span></span><span style=display:flex><span>            rfm_df[<span style=color:#a5d6ff>&#39;M_score&#39;</span>]
</span></span><span style=display:flex><span>        )
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>return</span> rfm_df
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>segment_users</span>(self, rfm_df):
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;&#34;&#34;ç”¨æˆ·åˆ†ç¾¤&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>assign_segment</span>(row):
</span></span><span style=display:flex><span>            R, F, M <span style=color:#ff7b72;font-weight:700>=</span> row[<span style=color:#a5d6ff>&#39;R_score&#39;</span>], row[<span style=color:#a5d6ff>&#39;F_score&#39;</span>], row[<span style=color:#a5d6ff>&#39;M_score&#39;</span>]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#8b949e;font-style:italic># é‡è¦ä»·å€¼å®¢æˆ·</span>
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>if</span> R <span style=color:#ff7b72;font-weight:700>&gt;=</span> <span style=color:#a5d6ff>4</span> <span style=color:#ff7b72;font-weight:700>and</span> F <span style=color:#ff7b72;font-weight:700>&gt;=</span> <span style=color:#a5d6ff>4</span> <span style=color:#ff7b72;font-weight:700>and</span> M <span style=color:#ff7b72;font-weight:700>&gt;=</span> <span style=color:#a5d6ff>4</span>:
</span></span><span style=display:flex><span>                <span style=color:#ff7b72>return</span> <span style=color:#a5d6ff>&#39;Champions&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#8b949e;font-style:italic># é‡è¦ä¿æŒå®¢æˆ·</span>
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>elif</span> R <span style=color:#ff7b72;font-weight:700>&gt;=</span> <span style=color:#a5d6ff>3</span> <span style=color:#ff7b72;font-weight:700>and</span> F <span style=color:#ff7b72;font-weight:700>&gt;=</span> <span style=color:#a5d6ff>3</span> <span style=color:#ff7b72;font-weight:700>and</span> M <span style=color:#ff7b72;font-weight:700>&gt;=</span> <span style=color:#a5d6ff>3</span>:
</span></span><span style=display:flex><span>                <span style=color:#ff7b72>return</span> <span style=color:#a5d6ff>&#39;Loyal Customers&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#8b949e;font-style:italic># æ½œåŠ›å®¢æˆ·</span>
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>elif</span> R <span style=color:#ff7b72;font-weight:700>&gt;=</span> <span style=color:#a5d6ff>3</span> <span style=color:#ff7b72;font-weight:700>and</span> F <span style=color:#ff7b72;font-weight:700>&lt;=</span> <span style=color:#a5d6ff>2</span> <span style=color:#ff7b72;font-weight:700>and</span> M <span style=color:#ff7b72;font-weight:700>&gt;=</span> <span style=color:#a5d6ff>3</span>:
</span></span><span style=display:flex><span>                <span style=color:#ff7b72>return</span> <span style=color:#a5d6ff>&#39;Potential Loyalist&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#8b949e;font-style:italic># é‡è¦æŒ½ç•™å®¢æˆ·</span>
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>elif</span> R <span style=color:#ff7b72;font-weight:700>&lt;=</span> <span style=color:#a5d6ff>2</span> <span style=color:#ff7b72;font-weight:700>and</span> F <span style=color:#ff7b72;font-weight:700>&gt;=</span> <span style=color:#a5d6ff>3</span> <span style=color:#ff7b72;font-weight:700>and</span> M <span style=color:#ff7b72;font-weight:700>&gt;=</span> <span style=color:#a5d6ff>3</span>:
</span></span><span style=display:flex><span>                <span style=color:#ff7b72>return</span> <span style=color:#a5d6ff>&#39;At Risk&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#8b949e;font-style:italic># æµå¤±å®¢æˆ·</span>
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>elif</span> R <span style=color:#ff7b72;font-weight:700>&lt;=</span> <span style=color:#a5d6ff>2</span> <span style=color:#ff7b72;font-weight:700>and</span> F <span style=color:#ff7b72;font-weight:700>&lt;=</span> <span style=color:#a5d6ff>2</span> <span style=color:#ff7b72;font-weight:700>and</span> M <span style=color:#ff7b72;font-weight:700>&lt;=</span> <span style=color:#a5d6ff>2</span>:
</span></span><span style=display:flex><span>                <span style=color:#ff7b72>return</span> <span style=color:#a5d6ff>&#39;Lost&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#8b949e;font-style:italic># æ–°å®¢æˆ·</span>
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>elif</span> F <span style=color:#ff7b72;font-weight:700>&lt;=</span> <span style=color:#a5d6ff>2</span> <span style=color:#ff7b72;font-weight:700>and</span> M <span style=color:#ff7b72;font-weight:700>&lt;=</span> <span style=color:#a5d6ff>2</span>:
</span></span><span style=display:flex><span>                <span style=color:#ff7b72>return</span> <span style=color:#a5d6ff>&#39;New Customers&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>else</span>:
</span></span><span style=display:flex><span>                <span style=color:#ff7b72>return</span> <span style=color:#a5d6ff>&#39;Others&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        rfm_df[<span style=color:#a5d6ff>&#39;segment&#39;</span>] <span style=color:#ff7b72;font-weight:700>=</span> rfm_df<span style=color:#ff7b72;font-weight:700>.</span>apply(assign_segment, axis<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>1</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>return</span> rfm_df
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>get_segment_insights</span>(self, rfm_df):
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;&#34;&#34;åˆ†ç¾¤æ´å¯Ÿ&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        segments <span style=color:#ff7b72;font-weight:700>=</span> rfm_df<span style=color:#ff7b72;font-weight:700>.</span>groupby(<span style=color:#a5d6ff>&#39;segment&#39;</span>)<span style=color:#ff7b72;font-weight:700>.</span>agg({
</span></span><span style=display:flex><span>            <span style=color:#a5d6ff>&#39;user_id&#39;</span>: <span style=color:#a5d6ff>&#39;count&#39;</span>,
</span></span><span style=display:flex><span>            <span style=color:#a5d6ff>&#39;recency&#39;</span>: <span style=color:#a5d6ff>&#39;mean&#39;</span>,
</span></span><span style=display:flex><span>            <span style=color:#a5d6ff>&#39;frequency&#39;</span>: <span style=color:#a5d6ff>&#39;mean&#39;</span>,
</span></span><span style=display:flex><span>            <span style=color:#a5d6ff>&#39;monetary&#39;</span>: [<span style=color:#a5d6ff>&#39;mean&#39;</span>, <span style=color:#a5d6ff>&#39;sum&#39;</span>]
</span></span><span style=display:flex><span>        })<span style=color:#ff7b72;font-weight:700>.</span>round(<span style=color:#a5d6ff>2</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        segments<span style=color:#ff7b72;font-weight:700>.</span>columns <span style=color:#ff7b72;font-weight:700>=</span> [
</span></span><span style=display:flex><span>            <span style=color:#a5d6ff>&#39;user_count&#39;</span>, <span style=color:#a5d6ff>&#39;avg_recency&#39;</span>, <span style=color:#a5d6ff>&#39;avg_frequency&#39;</span>,
</span></span><span style=display:flex><span>            <span style=color:#a5d6ff>&#39;avg_monetary&#39;</span>, <span style=color:#a5d6ff>&#39;total_monetary&#39;</span>
</span></span><span style=display:flex><span>        ]
</span></span><span style=display:flex><span>        segments <span style=color:#ff7b72;font-weight:700>=</span> segments<span style=color:#ff7b72;font-weight:700>.</span>sort_values(<span style=color:#a5d6ff>&#39;total_monetary&#39;</span>, ascending<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#79c0ff>False</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>return</span> segments
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>recommend_strategies</span>(self, segment):
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;&#34;&#34;åˆ†ç¾¤ç­–ç•¥å»ºè®®&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        strategies <span style=color:#ff7b72;font-weight:700>=</span> {
</span></span><span style=display:flex><span>            <span style=color:#a5d6ff>&#39;Champions&#39;</span>: {
</span></span><span style=display:flex><span>                <span style=color:#a5d6ff>&#39;priority&#39;</span>: <span style=color:#a5d6ff>&#39;Highest&#39;</span>,
</span></span><span style=display:flex><span>                <span style=color:#a5d6ff>&#39;strategy&#39;</span>: <span style=color:#a5d6ff>&#39;VIPæœåŠ¡&#39;</span>,
</span></span><span style=display:flex><span>                <span style=color:#a5d6ff>&#39;actions&#39;</span>: [
</span></span><span style=display:flex><span>                    <span style=color:#a5d6ff>&#39;ä¸“å±å®¢æœ&#39;</span>,
</span></span><span style=display:flex><span>                    <span style=color:#a5d6ff>&#39;ä¼˜å…ˆåŠŸèƒ½è®¿é—®&#39;</span>,
</span></span><span style=display:flex><span>                    <span style=color:#a5d6ff>&#39;ä¸“å±æŠ˜æ‰£&#39;</span>,
</span></span><span style=display:flex><span>                    <span style=color:#a5d6ff>&#39;æ¨èè®¡åˆ’é‚€è¯·&#39;</span>
</span></span><span style=display:flex><span>                ],
</span></span><span style=display:flex><span>                <span style=color:#a5d6ff>&#39;expected_impact&#39;</span>: <span style=color:#a5d6ff>&#39;ä¿æŒå¿ è¯šåº¦ï¼Œæé«˜å¤è´­&#39;</span>
</span></span><span style=display:flex><span>            },
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#a5d6ff>&#39;Loyal Customers&#39;</span>: {
</span></span><span style=display:flex><span>                <span style=color:#a5d6ff>&#39;priority&#39;</span>: <span style=color:#a5d6ff>&#39;High&#39;</span>,
</span></span><span style=display:flex><span>                <span style=color:#a5d6ff>&#39;strategy&#39;</span>: <span style=color:#a5d6ff>&#39;ä¼šå‘˜å‡çº§&#39;</span>,
</span></span><span style=display:flex><span>                <span style=color:#a5d6ff>&#39;actions&#39;</span>: [
</span></span><span style=display:flex><span>                    <span style=color:#a5d6ff>&#39;å¿ è¯šåº¦å¥–åŠ±&#39;</span>,
</span></span><span style=display:flex><span>                    <span style=color:#a5d6ff>&#39;å‡çº§ä¼˜æƒ &#39;</span>,
</span></span><span style=display:flex><span>                    <span style=color:#a5d6ff>&#39;ä¼šå‘˜ç‰¹æƒ&#39;</span>,
</span></span><span style=display:flex><span>                    <span style=color:#a5d6ff>&#39;ç”Ÿæ—¥ç¦åˆ©&#39;</span>
</span></span><span style=display:flex><span>                ],
</span></span><span style=display:flex><span>                <span style=color:#a5d6ff>&#39;expected_impact&#39;</span>: <span style=color:#a5d6ff>&#39;æå‡æ¶ˆè´¹é¢‘æ¬¡&#39;</span>
</span></span><span style=display:flex><span>            },
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#a5d6ff>&#39;At Risk&#39;</span>: {
</span></span><span style=display:flex><span>                <span style=color:#a5d6ff>&#39;priority&#39;</span>: <span style=color:#a5d6ff>&#39;High&#39;</span>,
</span></span><span style=display:flex><span>                <span style=color:#a5d6ff>&#39;strategy&#39;</span>: <span style=color:#a5d6ff>&#39;æŒ½å›æ¿€æ´»&#39;</span>,
</span></span><span style=display:flex><span>                <span style=color:#a5d6ff>&#39;actions&#39;</span>: [
</span></span><span style=display:flex><span>                    <span style=color:#a5d6ff>&#39;ä¸ªæ€§åŒ–ä¼˜æƒ &#39;</span>,
</span></span><span style=display:flex><span>                    <span style=color:#a5d6ff>&#39;äº§å“æ›´æ–°é€šçŸ¥&#39;</span>,
</span></span><span style=display:flex><span>                    <span style=color:#a5d6ff>&#39;å®¢æœå›è®¿&#39;</span>,
</span></span><span style=display:flex><span>                    <span style=color:#a5d6ff>&#39;é™æ—¶æŠ˜æ‰£&#39;</span>
</span></span><span style=display:flex><span>                ],
</span></span><span style=display:flex><span>                <span style=color:#a5d6ff>&#39;expected_impact&#39;</span>: <span style=color:#a5d6ff>&#39;é˜²æ­¢æµå¤±ï¼Œé‡æ–°æ¿€æ´»&#39;</span>
</span></span><span style=display:flex><span>            },
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#a5d6ff>&#39;Lost&#39;</span>: {
</span></span><span style=display:flex><span>                <span style=color:#a5d6ff>&#39;priority&#39;</span>: <span style=color:#a5d6ff>&#39;Medium&#39;</span>,
</span></span><span style=display:flex><span>                <span style=color:#a5d6ff>&#39;strategy&#39;</span>: <span style=color:#a5d6ff>&#39;é‡æ–°è·å®¢&#39;</span>,
</span></span><span style=display:flex><span>                <span style=color:#a5d6ff>&#39;actions&#39;</span>: [
</span></span><span style=display:flex><span>                    <span style=color:#a5d6ff>&#39;å¤§å¹…æŠ˜æ‰£&#39;</span>,
</span></span><span style=display:flex><span>                    <span style=color:#a5d6ff>&#39;æ–°äº§å“æ¨è&#39;</span>,
</span></span><span style=display:flex><span>                    <span style=color:#a5d6ff>&#39;é—®å·è°ƒæŸ¥&#39;</span>,
</span></span><span style=display:flex><span>                    <span style=color:#a5d6ff>&#39;æ”¹è¿›æ²Ÿé€š&#39;</span>
</span></span><span style=display:flex><span>                ],
</span></span><span style=display:flex><span>                <span style=color:#a5d6ff>&#39;expected_impact&#39;</span>: <span style=color:#a5d6ff>&#39;éƒ¨åˆ†æŒ½å›&#39;</span>
</span></span><span style=display:flex><span>            },
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#a5d6ff>&#39;New Customers&#39;</span>: {
</span></span><span style=display:flex><span>                <span style=color:#a5d6ff>&#39;priority&#39;</span>: <span style=color:#a5d6ff>&#39;Medium&#39;</span>,
</span></span><span style=display:flex><span>                <span style=color:#a5d6ff>&#39;strategy&#39;</span>: <span style=color:#a5d6ff>&#39;æ–°æ‰‹åŸ¹å…»&#39;</span>,
</span></span><span style=display:flex><span>                <span style=color:#a5d6ff>&#39;actions&#39;</span>: [
</span></span><span style=display:flex><span>                    <span style=color:#a5d6ff>&#39;æ–°æ‰‹å¼•å¯¼&#39;</span>,
</span></span><span style=display:flex><span>                    <span style=color:#a5d6ff>&#39;åŠŸèƒ½æ•™ç¨‹&#39;</span>,
</span></span><span style=display:flex><span>                    <span style=color:#a5d6ff>&#39;é¦–æ¬¡è´­ä¹°ä¼˜æƒ &#39;</span>,
</span></span><span style=display:flex><span>                    <span style=color:#a5d6ff>&#39;ç¤¾ç¾¤é‚€è¯·&#39;</span>
</span></span><span style=display:flex><span>                ],
</span></span><span style=display:flex><span>                <span style=color:#a5d6ff>&#39;expected_impact&#39;</span>: <span style=color:#a5d6ff>&#39;è½¬åŒ–ä¸ºæ´»è·ƒç”¨æˆ·&#39;</span>
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>return</span> strategies<span style=color:#ff7b72;font-weight:700>.</span>get(segment, {})
</span></span></code></pre></td></tr></table></div></div><h3 id=22-è¡Œä¸ºç‰¹å¾åˆ†ç¾¤>2.2 è¡Œä¸ºç‰¹å¾åˆ†ç¾¤<a hidden class=anchor aria-hidden=true href=#22-è¡Œä¸ºç‰¹å¾åˆ†ç¾¤>#</a></h3><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 56
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 57
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 58
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 59
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 60
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 61
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 62
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 63
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 64
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 65
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 66
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 67
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 68
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 69
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 70
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 71
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 72
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 73
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 74
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 75
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 76
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 77
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 78
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 79
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 80
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 81
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 82
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 83
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 84
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 85
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 86
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 87
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 88
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 89
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 90
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 91
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 92
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 93
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 94
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 95
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 96
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 97
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 98
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 99
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">100
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">101
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">102
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">103
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">104
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">105
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">106
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">107
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">108
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">109
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">110
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">111
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">112
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">113
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">114
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">115
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">116
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">117
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">118
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">119
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">120
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">121
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">122
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#8b949e;font-style:italic># åŸºäºè¡Œä¸ºçš„ç”¨æˆ·åˆ†ç¾¤</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>from</span> <span style=color:#ff7b72>sklearn.cluster</span> <span style=color:#ff7b72>import</span> KMeans
</span></span><span style=display:flex><span><span style=color:#ff7b72>from</span> <span style=color:#ff7b72>sklearn.preprocessing</span> <span style=color:#ff7b72>import</span> StandardScaler
</span></span><span style=display:flex><span><span style=color:#ff7b72>from</span> <span style=color:#ff7b72>sklearn.decomposition</span> <span style=color:#ff7b72>import</span> PCA
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>class</span> <span style=color:#f0883e;font-weight:700>BehaviorSegmentation</span>:
</span></span><span style=display:flex><span>    <span style=color:#a5d6ff>&#34;&#34;&#34;è¡Œä¸ºç‰¹å¾åˆ†ç¾¤&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>__init__</span>(self, event_data):
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;&#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>        event_data: ç”¨æˆ·è¡Œä¸ºäº‹ä»¶æ•°æ®
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>        &#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>        self<span style=color:#ff7b72;font-weight:700>.</span>events <span style=color:#ff7b72;font-weight:700>=</span> event_data
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>create_behavior_features</span>(self):
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;&#34;&#34;åˆ›å»ºè¡Œä¸ºç‰¹å¾&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># ç‰¹å¾1ï¼šæ´»è·ƒåº¦ï¼ˆäº‹ä»¶æ€»æ•°ï¼‰</span>
</span></span><span style=display:flex><span>        activity <span style=color:#ff7b72;font-weight:700>=</span> self<span style=color:#ff7b72;font-weight:700>.</span>events<span style=color:#ff7b72;font-weight:700>.</span>groupby(<span style=color:#a5d6ff>&#39;user_id&#39;</span>)<span style=color:#ff7b72;font-weight:700>.</span>size()<span style=color:#ff7b72;font-weight:700>.</span>reset_index()
</span></span><span style=display:flex><span>        activity<span style=color:#ff7b72;font-weight:700>.</span>columns <span style=color:#ff7b72;font-weight:700>=</span> [<span style=color:#a5d6ff>&#39;user_id&#39;</span>, <span style=color:#a5d6ff>&#39;total_events&#39;</span>]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># ç‰¹å¾2ï¼šä½¿ç”¨å¤©æ•°</span>
</span></span><span style=display:flex><span>        active_days <span style=color:#ff7b72;font-weight:700>=</span> self<span style=color:#ff7b72;font-weight:700>.</span>events<span style=color:#ff7b72;font-weight:700>.</span>groupby(<span style=color:#a5d6ff>&#39;user_id&#39;</span>)[<span style=color:#a5d6ff>&#39;date&#39;</span>]<span style=color:#ff7b72;font-weight:700>.</span>nunique()<span style=color:#ff7b72;font-weight:700>.</span>reset_index()
</span></span><span style=display:flex><span>        active_days<span style=color:#ff7b72;font-weight:700>.</span>columns <span style=color:#ff7b72;font-weight:700>=</span> [<span style=color:#a5d6ff>&#39;user_id&#39;</span>, <span style=color:#a5d6ff>&#39;active_days&#39;</span>]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># ç‰¹å¾3ï¼šåŠŸèƒ½ä½¿ç”¨å¹¿åº¦ï¼ˆä¸åŒäº‹ä»¶ç±»å‹æ•°ï¼‰</span>
</span></span><span style=display:flex><span>        feature_breadth <span style=color:#ff7b72;font-weight:700>=</span> self<span style=color:#ff7b72;font-weight:700>.</span>events<span style=color:#ff7b72;font-weight:700>.</span>groupby(<span style=color:#a5d6ff>&#39;user_id&#39;</span>)[<span style=color:#a5d6ff>&#39;event_name&#39;</span>]<span style=color:#ff7b72;font-weight:700>.</span>nunique()<span style=color:#ff7b72;font-weight:700>.</span>reset_index()
</span></span><span style=display:flex><span>        feature_breadth<span style=color:#ff7b72;font-weight:700>.</span>columns <span style=color:#ff7b72;font-weight:700>=</span> [<span style=color:#a5d6ff>&#39;user_id&#39;</span>, <span style=color:#a5d6ff>&#39;unique_events&#39;</span>]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># ç‰¹å¾4ï¼šä¼šè¯æ—¶é•¿</span>
</span></span><span style=display:flex><span>        session_duration <span style=color:#ff7b72;font-weight:700>=</span> self<span style=color:#ff7b72;font-weight:700>.</span>events<span style=color:#ff7b72;font-weight:700>.</span>groupby([<span style=color:#a5d6ff>&#39;user_id&#39;</span>, <span style=color:#a5d6ff>&#39;session_id&#39;</span>])<span style=color:#ff7b72;font-weight:700>.</span>agg({
</span></span><span style=display:flex><span>            <span style=color:#a5d6ff>&#39;timestamp&#39;</span>: <span style=color:#ff7b72>lambda</span> x: x<span style=color:#ff7b72;font-weight:700>.</span>max() <span style=color:#ff7b72;font-weight:700>-</span> x<span style=color:#ff7b72;font-weight:700>.</span>min()
</span></span><span style=display:flex><span>        })<span style=color:#ff7b72;font-weight:700>.</span>reset_index()
</span></span><span style=display:flex><span>        session_duration[<span style=color:#a5d6ff>&#39;duration_seconds&#39;</span>] <span style=color:#ff7b72;font-weight:700>=</span> session_duration[<span style=color:#a5d6ff>&#39;timestamp&#39;</span>]<span style=color:#ff7b72;font-weight:700>.</span>dt<span style=color:#ff7b72;font-weight:700>.</span>total_seconds()
</span></span><span style=display:flex><span>        avg_duration <span style=color:#ff7b72;font-weight:700>=</span> session_duration<span style=color:#ff7b72;font-weight:700>.</span>groupby(<span style=color:#a5d6ff>&#39;user_id&#39;</span>)[<span style=color:#a5d6ff>&#39;duration_seconds&#39;</span>]<span style=color:#ff7b72;font-weight:700>.</span>mean()<span style=color:#ff7b72;font-weight:700>.</span>reset_index()
</span></span><span style=display:flex><span>        avg_duration<span style=color:#ff7b72;font-weight:700>.</span>columns <span style=color:#ff7b72;font-weight:700>=</span> [<span style=color:#a5d6ff>&#39;user_id&#39;</span>, <span style=color:#a5d6ff>&#39;avg_session_duration&#39;</span>]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># ç‰¹å¾5ï¼šæ ¸å¿ƒåŠŸèƒ½ä½¿ç”¨ç‡</span>
</span></span><span style=display:flex><span>        core_events <span style=color:#ff7b72;font-weight:700>=</span> [<span style=color:#a5d6ff>&#39;purchase&#39;</span>, <span style=color:#a5d6ff>&#39;checkout&#39;</span>, <span style=color:#a5d6ff>&#39;add_to_cart&#39;</span>]
</span></span><span style=display:flex><span>        core_usage <span style=color:#ff7b72;font-weight:700>=</span> self<span style=color:#ff7b72;font-weight:700>.</span>events[
</span></span><span style=display:flex><span>            self<span style=color:#ff7b72;font-weight:700>.</span>events[<span style=color:#a5d6ff>&#39;event_name&#39;</span>]<span style=color:#ff7b72;font-weight:700>.</span>isin(core_events)
</span></span><span style=display:flex><span>        ]<span style=color:#ff7b72;font-weight:700>.</span>groupby(<span style=color:#a5d6ff>&#39;user_id&#39;</span>)<span style=color:#ff7b72;font-weight:700>.</span>size()<span style=color:#ff7b72;font-weight:700>.</span>reset_index()
</span></span><span style=display:flex><span>        core_usage<span style=color:#ff7b72;font-weight:700>.</span>columns <span style=color:#ff7b72;font-weight:700>=</span> [<span style=color:#a5d6ff>&#39;user_id&#39;</span>, <span style=color:#a5d6ff>&#39;core_events_count&#39;</span>]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># åˆå¹¶æ‰€æœ‰ç‰¹å¾</span>
</span></span><span style=display:flex><span>        features <span style=color:#ff7b72;font-weight:700>=</span> activity<span style=color:#ff7b72;font-weight:700>.</span>merge(active_days, on<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>&#39;user_id&#39;</span>, how<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>&#39;outer&#39;</span>) \
</span></span><span style=display:flex><span>                         <span style=color:#ff7b72;font-weight:700>.</span>merge(feature_breadth, on<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>&#39;user_id&#39;</span>, how<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>&#39;outer&#39;</span>) \
</span></span><span style=display:flex><span>                         <span style=color:#ff7b72;font-weight:700>.</span>merge(avg_duration, on<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>&#39;user_id&#39;</span>, how<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>&#39;outer&#39;</span>) \
</span></span><span style=display:flex><span>                         <span style=color:#ff7b72;font-weight:700>.</span>merge(core_usage, on<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>&#39;user_id&#39;</span>, how<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>&#39;outer&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># å¡«å……ç¼ºå¤±å€¼</span>
</span></span><span style=display:flex><span>        features <span style=color:#ff7b72;font-weight:700>=</span> features<span style=color:#ff7b72;font-weight:700>.</span>fillna(<span style=color:#a5d6ff>0</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># è®¡ç®—è¡ç”Ÿç‰¹å¾</span>
</span></span><span style=display:flex><span>        features[<span style=color:#a5d6ff>&#39;events_per_day&#39;</span>] <span style=color:#ff7b72;font-weight:700>=</span> features[<span style=color:#a5d6ff>&#39;total_events&#39;</span>] <span style=color:#ff7b72;font-weight:700>/</span> (features[<span style=color:#a5d6ff>&#39;active_days&#39;</span>] <span style=color:#ff7b72;font-weight:700>+</span> <span style=color:#a5d6ff>1</span>)
</span></span><span style=display:flex><span>        features[<span style=color:#a5d6ff>&#39;core_event_ratio&#39;</span>] <span style=color:#ff7b72;font-weight:700>=</span> features[<span style=color:#a5d6ff>&#39;core_events_count&#39;</span>] <span style=color:#ff7b72;font-weight:700>/</span> (features[<span style=color:#a5d6ff>&#39;total_events&#39;</span>] <span style=color:#ff7b72;font-weight:700>+</span> <span style=color:#a5d6ff>1</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>return</span> features
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>perform_clustering</span>(self, features_df, n_clusters<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>5</span>):
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;&#34;&#34;æ‰§è¡Œèšç±»åˆ†æ&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># å‡†å¤‡ç‰¹å¾ï¼ˆå»é™¤user_idï¼‰</span>
</span></span><span style=display:flex><span>        feature_cols <span style=color:#ff7b72;font-weight:700>=</span> [col <span style=color:#ff7b72>for</span> col <span style=color:#ff7b72;font-weight:700>in</span> features_df<span style=color:#ff7b72;font-weight:700>.</span>columns <span style=color:#ff7b72>if</span> col <span style=color:#ff7b72;font-weight:700>!=</span> <span style=color:#a5d6ff>&#39;user_id&#39;</span>]
</span></span><span style=display:flex><span>        X <span style=color:#ff7b72;font-weight:700>=</span> features_df[feature_cols]<span style=color:#ff7b72;font-weight:700>.</span>values
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># æ ‡å‡†åŒ–</span>
</span></span><span style=display:flex><span>        scaler <span style=color:#ff7b72;font-weight:700>=</span> StandardScaler()
</span></span><span style=display:flex><span>        X_scaled <span style=color:#ff7b72;font-weight:700>=</span> scaler<span style=color:#ff7b72;font-weight:700>.</span>fit_transform(X)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># èšç±»</span>
</span></span><span style=display:flex><span>        kmeans <span style=color:#ff7b72;font-weight:700>=</span> KMeans(
</span></span><span style=display:flex><span>            n_clusters<span style=color:#ff7b72;font-weight:700>=</span>n_clusters,
</span></span><span style=display:flex><span>            random_state<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>42</span>,
</span></span><span style=display:flex><span>            n_init<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>10</span>
</span></span><span style=display:flex><span>        )
</span></span><span style=display:flex><span>        clusters <span style=color:#ff7b72;font-weight:700>=</span> kmeans<span style=color:#ff7b72;font-weight:700>.</span>fit_predict(X_scaled)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># æ·»åŠ èšç±»æ ‡ç­¾</span>
</span></span><span style=display:flex><span>        result <span style=color:#ff7b72;font-weight:700>=</span> features_df<span style=color:#ff7b72;font-weight:700>.</span>copy()
</span></span><span style=display:flex><span>        result[<span style=color:#a5d6ff>&#39;cluster&#39;</span>] <span style=color:#ff7b72;font-weight:700>=</span> clusters
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># ä¿å­˜æ¨¡å‹å’Œæ ‡å‡†åŒ–å™¨</span>
</span></span><span style=display:flex><span>        self<span style=color:#ff7b72;font-weight:700>.</span>kmeans <span style=color:#ff7b72;font-weight:700>=</span> kmeans
</span></span><span style=display:flex><span>        self<span style=color:#ff7b72;font-weight:700>.</span>scaler <span style=color:#ff7b72;font-weight:700>=</span> scaler
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>return</span> result, kmeans<span style=color:#ff7b72;font-weight:700>.</span>cluster_centers_
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>interpret_clusters</span>(self, clustered_df, feature_cols):
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;&#34;&#34;è§£é‡Šèšç±»ç»“æœ&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        cluster_profiles <span style=color:#ff7b72;font-weight:700>=</span> []
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>for</span> cluster_id <span style=color:#ff7b72;font-weight:700>in</span> sorted(clustered_df[<span style=color:#a5d6ff>&#39;cluster&#39;</span>]<span style=color:#ff7b72;font-weight:700>.</span>unique()):
</span></span><span style=display:flex><span>            cluster_data <span style=color:#ff7b72;font-weight:700>=</span> clustered_df[
</span></span><span style=display:flex><span>                clustered_df[<span style=color:#a5d6ff>&#39;cluster&#39;</span>] <span style=color:#ff7b72;font-weight:700>==</span> cluster_id
</span></span><span style=display:flex><span>            ]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            profile <span style=color:#ff7b72;font-weight:700>=</span> {
</span></span><span style=display:flex><span>                <span style=color:#a5d6ff>&#39;cluster_id&#39;</span>: cluster_id,
</span></span><span style=display:flex><span>                <span style=color:#a5d6ff>&#39;size&#39;</span>: len(cluster_data),
</span></span><span style=display:flex><span>                <span style=color:#a5d6ff>&#39;percentage&#39;</span>: len(cluster_data) <span style=color:#ff7b72;font-weight:700>/</span> len(clustered_df) <span style=color:#ff7b72;font-weight:700>*</span> <span style=color:#a5d6ff>100</span>,
</span></span><span style=display:flex><span>                <span style=color:#a5d6ff>&#39;characteristics&#39;</span>: {}
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#8b949e;font-style:italic># è®¡ç®—å„ç‰¹å¾çš„å¹³å‡å€¼</span>
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>for</span> col <span style=color:#ff7b72;font-weight:700>in</span> feature_cols:
</span></span><span style=display:flex><span>                cluster_mean <span style=color:#ff7b72;font-weight:700>=</span> cluster_data[col]<span style=color:#ff7b72;font-weight:700>.</span>mean()
</span></span><span style=display:flex><span>                overall_mean <span style=color:#ff7b72;font-weight:700>=</span> clustered_df[col]<span style=color:#ff7b72;font-weight:700>.</span>mean()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>                <span style=color:#8b949e;font-style:italic># è®¡ç®—ç›¸å¯¹äºæ•´ä½“çš„å·®å¼‚</span>
</span></span><span style=display:flex><span>                diff_pct <span style=color:#ff7b72;font-weight:700>=</span> ((cluster_mean <span style=color:#ff7b72;font-weight:700>-</span> overall_mean) <span style=color:#ff7b72;font-weight:700>/</span> overall_mean) <span style=color:#ff7b72;font-weight:700>*</span> <span style=color:#a5d6ff>100</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>                profile[<span style=color:#a5d6ff>&#39;characteristics&#39;</span>][col] <span style=color:#ff7b72;font-weight:700>=</span> {
</span></span><span style=display:flex><span>                    <span style=color:#a5d6ff>&#39;cluster_mean&#39;</span>: cluster_mean,
</span></span><span style=display:flex><span>                    <span style=color:#a5d6ff>&#39;overall_mean&#39;</span>: overall_mean,
</span></span><span style=display:flex><span>                    <span style=color:#a5d6ff>&#39;difference_pct&#39;</span>: diff_pct
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            cluster_profiles<span style=color:#ff7b72;font-weight:700>.</span>append(profile)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>return</span> cluster_profiles
</span></span></code></pre></td></tr></table></div></div><h2 id=ä¸‰ç”¨æˆ·ç•™å­˜åˆ†æ>ä¸‰ã€ç”¨æˆ·ç•™å­˜åˆ†æ<a hidden class=anchor aria-hidden=true href=#ä¸‰ç”¨æˆ·ç•™å­˜åˆ†æ>#</a></h2><h3 id=31-ç•™å­˜ç‡è®¡ç®—>3.1 ç•™å­˜ç‡è®¡ç®—<a hidden class=anchor aria-hidden=true href=#31-ç•™å­˜ç‡è®¡ç®—>#</a></h3><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 56
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 57
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 58
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 59
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 60
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 61
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 62
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 63
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 64
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 65
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 66
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 67
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 68
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 69
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 70
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 71
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 72
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 73
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 74
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 75
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 76
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 77
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 78
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 79
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 80
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 81
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 82
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 83
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 84
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 85
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 86
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 87
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 88
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 89
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 90
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 91
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 92
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 93
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 94
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 95
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 96
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 97
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 98
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 99
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">100
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#8b949e;font-style:italic># ç”¨æˆ·ç•™å­˜åˆ†æ</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>import</span> <span style=color:#ff7b72>pandas</span> <span style=color:#ff7b72>as</span> <span style=color:#ff7b72>pd</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>import</span> <span style=color:#ff7b72>numpy</span> <span style=color:#ff7b72>as</span> <span style=color:#ff7b72>np</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>class</span> <span style=color:#f0883e;font-weight:700>RetentionAnalysis</span>:
</span></span><span style=display:flex><span>    <span style=color:#a5d6ff>&#34;&#34;&#34;ç”¨æˆ·ç•™å­˜åˆ†æ&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>__init__</span>(self, activity_data):
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;&#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>        activity_data: ç”¨æˆ·æ´»åŠ¨æ—¥å¿—
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>        å¿…éœ€åˆ—: user_id, activity_date
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>        &#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>        self<span style=color:#ff7b72;font-weight:700>.</span>data <span style=color:#ff7b72;font-weight:700>=</span> activity_data
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>calculate_cohort_retention</span>(self):
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;&#34;&#34;è®¡ç®—åŒæœŸç¾¤ç•™å­˜&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># æ‰¾åˆ°æ¯ä¸ªç”¨æˆ·çš„é¦–æ¬¡æ´»åŠ¨æ—¥æœŸ</span>
</span></span><span style=display:flex><span>        self<span style=color:#ff7b72;font-weight:700>.</span>data[<span style=color:#a5d6ff>&#39;activity_date&#39;</span>] <span style=color:#ff7b72;font-weight:700>=</span> pd<span style=color:#ff7b72;font-weight:700>.</span>to_datetime(self<span style=color:#ff7b72;font-weight:700>.</span>data[<span style=color:#a5d6ff>&#39;activity_date&#39;</span>])
</span></span><span style=display:flex><span>        cohort <span style=color:#ff7b72;font-weight:700>=</span> self<span style=color:#ff7b72;font-weight:700>.</span>data<span style=color:#ff7b72;font-weight:700>.</span>groupby(<span style=color:#a5d6ff>&#39;user_id&#39;</span>)[<span style=color:#a5d6ff>&#39;activity_date&#39;</span>]<span style=color:#ff7b72;font-weight:700>.</span>min()<span style=color:#ff7b72;font-weight:700>.</span>reset_index()
</span></span><span style=display:flex><span>        cohort<span style=color:#ff7b72;font-weight:700>.</span>columns <span style=color:#ff7b72;font-weight:700>=</span> [<span style=color:#a5d6ff>&#39;user_id&#39;</span>, <span style=color:#a5d6ff>&#39;cohort_date&#39;</span>]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># åˆå¹¶åŒæœŸç¾¤ä¿¡æ¯</span>
</span></span><span style=display:flex><span>        df_with_cohort <span style=color:#ff7b72;font-weight:700>=</span> self<span style=color:#ff7b72;font-weight:700>.</span>data<span style=color:#ff7b72;font-weight:700>.</span>merge(cohort, on<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>&#39;user_id&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># è®¡ç®—åŒæœŸç¾¤å‘¨æœŸï¼ˆæœˆï¼‰</span>
</span></span><span style=display:flex><span>        df_with_cohort[<span style=color:#a5d6ff>&#39;cohort_period&#39;</span>] <span style=color:#ff7b72;font-weight:700>=</span> (
</span></span><span style=display:flex><span>            df_with_cohort[<span style=color:#a5d6ff>&#39;activity_date&#39;</span>]<span style=color:#ff7b72;font-weight:700>.</span>dt<span style=color:#ff7b72;font-weight:700>.</span>to_period(<span style=color:#a5d6ff>&#39;M&#39;</span>) <span style=color:#ff7b72;font-weight:700>-</span>
</span></span><span style=display:flex><span>            df_with_cohort[<span style=color:#a5d6ff>&#39;cohort_date&#39;</span>]<span style=color:#ff7b72;font-weight:700>.</span>dt<span style=color:#ff7b72;font-weight:700>.</span>to_period(<span style=color:#a5d6ff>&#39;M&#39;</span>)
</span></span><span style=display:flex><span>        )<span style=color:#ff7b72;font-weight:700>.</span>apply(<span style=color:#ff7b72>lambda</span> x: x<span style=color:#ff7b72;font-weight:700>.</span>n)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># åˆ›å»ºåŒæœŸç¾¤é€è§†è¡¨</span>
</span></span><span style=display:flex><span>        cohort_data <span style=color:#ff7b72;font-weight:700>=</span> df_with_cohort<span style=color:#ff7b72;font-weight:700>.</span>groupby(
</span></span><span style=display:flex><span>            [<span style=color:#a5d6ff>&#39;cohort_date&#39;</span>, <span style=color:#a5d6ff>&#39;cohort_period&#39;</span>]
</span></span><span style=display:flex><span>        )[<span style=color:#a5d6ff>&#39;user_id&#39;</span>]<span style=color:#ff7b72;font-weight:700>.</span>nunique()<span style=color:#ff7b72;font-weight:700>.</span>reset_index()
</span></span><span style=display:flex><span>        cohort_pivot <span style=color:#ff7b72;font-weight:700>=</span> cohort_data<span style=color:#ff7b72;font-weight:700>.</span>pivot(
</span></span><span style=display:flex><span>            index<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>&#39;cohort_date&#39;</span>,
</span></span><span style=display:flex><span>            columns<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>&#39;cohort_period&#39;</span>,
</span></span><span style=display:flex><span>            values<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>&#39;user_id&#39;</span>
</span></span><span style=display:flex><span>        )
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># è®¡ç®—ç•™å­˜ç‡</span>
</span></span><span style=display:flex><span>        cohort_size <span style=color:#ff7b72;font-weight:700>=</span> cohort_pivot<span style=color:#ff7b72;font-weight:700>.</span>iloc[:, <span style=color:#a5d6ff>0</span>]
</span></span><span style=display:flex><span>        retention <span style=color:#ff7b72;font-weight:700>=</span> cohort_pivot<span style=color:#ff7b72;font-weight:700>.</span>divide(cohort_size, axis<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>0</span>) <span style=color:#ff7b72;font-weight:700>*</span> <span style=color:#a5d6ff>100</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>return</span> {
</span></span><span style=display:flex><span>            <span style=color:#a5d6ff>&#39;cohort_data&#39;</span>: cohort_pivot,
</span></span><span style=display:flex><span>            <span style=color:#a5d6ff>&#39;retention_rate&#39;</span>: retention<span style=color:#ff7b72;font-weight:700>.</span>round(<span style=color:#a5d6ff>2</span>),
</span></span><span style=display:flex><span>            <span style=color:#a5d6ff>&#39;cohort_size&#39;</span>: cohort_size
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>calculate_retention_metrics</span>(self, periods<span style=color:#ff7b72;font-weight:700>=</span>[<span style=color:#a5d6ff>1</span>, <span style=color:#a5d6ff>7</span>, <span style=color:#a5d6ff>30</span>]):
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;&#34;&#34;è®¡ç®—ç‰¹å®šå‘¨æœŸçš„ç•™å­˜ç‡&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># æ‰¾åˆ°æ¯ä¸ªç”¨æˆ·çš„é¦–æ¬¡æ´»åŠ¨æ—¥æœŸ</span>
</span></span><span style=display:flex><span>        first_activity <span style=color:#ff7b72;font-weight:700>=</span> self<span style=color:#ff7b72;font-weight:700>.</span>data<span style=color:#ff7b72;font-weight:700>.</span>groupby(<span style=color:#a5d6ff>&#39;user_id&#39;</span>)[<span style=color:#a5d6ff>&#39;activity_date&#39;</span>]<span style=color:#ff7b72;font-weight:700>.</span>min()<span style=color:#ff7b72;font-weight:700>.</span>reset_index()
</span></span><span style=display:flex><span>        first_activity<span style=color:#ff7b72;font-weight:700>.</span>columns <span style=color:#ff7b72;font-weight:700>=</span> [<span style=color:#a5d6ff>&#39;user_id&#39;</span>, <span style=color:#a5d6ff>&#39;first_date&#39;</span>]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># åˆå¹¶é¦–æ¬¡æ´»åŠ¨ä¿¡æ¯</span>
</span></span><span style=display:flex><span>        df_with_first <span style=color:#ff7b72;font-weight:700>=</span> self<span style=color:#ff7b72;font-weight:700>.</span>data<span style=color:#ff7b72;font-weight:700>.</span>merge(first_activity, on<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>&#39;user_id&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        retention_metrics <span style=color:#ff7b72;font-weight:700>=</span> {}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>for</span> period <span style=color:#ff7b72;font-weight:700>in</span> periods:
</span></span><span style=display:flex><span>            <span style=color:#8b949e;font-style:italic># è®¡ç®—ç‰¹å®šå‘¨æœŸçš„ç•™å­˜</span>
</span></span><span style=display:flex><span>            period_end <span style=color:#ff7b72;font-weight:700>=</span> df_with_first[<span style=color:#a5d6ff>&#39;first_date&#39;</span>] <span style=color:#ff7b72;font-weight:700>+</span> pd<span style=color:#ff7b72;font-weight:700>.</span>Timedelta(days<span style=color:#ff7b72;font-weight:700>=</span>period)
</span></span><span style=display:flex><span>            retained_users <span style=color:#ff7b72;font-weight:700>=</span> df_with_first[
</span></span><span style=display:flex><span>                df_with_first[<span style=color:#a5d6ff>&#39;activity_date&#39;</span>] <span style=color:#ff7b72;font-weight:700>&lt;=</span> period_end
</span></span><span style=display:flex><span>            ]<span style=color:#ff7b72;font-weight:700>.</span>groupby(<span style=color:#a5d6ff>&#39;user_id&#39;</span>)<span style=color:#ff7b72;font-weight:700>.</span>size()<span style=color:#ff7b72;font-weight:700>.</span>reset_index()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#8b949e;font-style:italic># æ ‡è®°ç•™å­˜ç”¨æˆ·</span>
</span></span><span style=display:flex><span>            retained_users[<span style=color:#a5d6ff>&#39;retained&#39;</span>] <span style=color:#ff7b72;font-weight:700>=</span> retained_users[<span style=color:#a5d6ff>0</span>] <span style=color:#ff7b72;font-weight:700>&gt;=</span> <span style=color:#a5d6ff>2</span>  <span style=color:#8b949e;font-style:italic># è‡³å°‘2æ¬¡æ´»åŠ¨</span>
</span></span><span style=display:flex><span>            retention_rate <span style=color:#ff7b72;font-weight:700>=</span> retained_users[<span style=color:#a5d6ff>&#39;retained&#39;</span>]<span style=color:#ff7b72;font-weight:700>.</span>mean() <span style=color:#ff7b72;font-weight:700>*</span> <span style=color:#a5d6ff>100</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            retention_metrics[<span style=color:#79c0ff>f</span><span style=color:#a5d6ff>&#39;Day_</span><span style=color:#a5d6ff>{</span>period<span style=color:#a5d6ff>}</span><span style=color:#a5d6ff>_retention&#39;</span>] <span style=color:#ff7b72;font-weight:700>=</span> retention_rate<span style=color:#ff7b72;font-weight:700>.</span>round(<span style=color:#a5d6ff>2</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>return</span> retention_metrics
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>retention_curve_analysis</span>(self):
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;&#34;&#34;ç•™å­˜æ›²çº¿åˆ†æ&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># è®¡ç®—æ¯ä¸ªç”¨æˆ·çš„ç•™å­˜å¤©æ•°</span>
</span></span><span style=display:flex><span>        user_retention <span style=color:#ff7b72;font-weight:700>=</span> self<span style=color:#ff7b72;font-weight:700>.</span>data<span style=color:#ff7b72;font-weight:700>.</span>groupby(<span style=color:#a5d6ff>&#39;user_id&#39;</span>)[<span style=color:#a5d6ff>&#39;activity_date&#39;</span>]<span style=color:#ff7b72;font-weight:700>.</span>agg([
</span></span><span style=display:flex><span>            (<span style=color:#a5d6ff>&#39;first_date&#39;</span>, <span style=color:#a5d6ff>&#39;min&#39;</span>),
</span></span><span style=display:flex><span>            (<span style=color:#a5d6ff>&#39;last_date&#39;</span>, <span style=color:#a5d6ff>&#39;max&#39;</span>),
</span></span><span style=display:flex><span>            (<span style=color:#a5d6ff>&#39;activity_days&#39;</span>, <span style=color:#ff7b72>lambda</span> x: x<span style=color:#ff7b72;font-weight:700>.</span>nunique())
</span></span><span style=display:flex><span>        ])<span style=color:#ff7b72;font-weight:700>.</span>reset_index()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        user_retention[<span style=color:#a5d6ff>&#39;lifespan_days&#39;</span>] <span style=color:#ff7b72;font-weight:700>=</span> (
</span></span><span style=display:flex><span>            user_retention[<span style=color:#a5d6ff>&#39;last_date&#39;</span>] <span style=color:#ff7b72;font-weight:700>-</span> user_retention[<span style=color:#a5d6ff>&#39;first_date&#39;</span>]
</span></span><span style=display:flex><span>        )<span style=color:#ff7b72;font-weight:700>.</span>dt<span style=color:#ff7b72;font-weight:700>.</span>days <span style=color:#ff7b72;font-weight:700>+</span> <span style=color:#a5d6ff>1</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># ç•™å­˜æ›²çº¿</span>
</span></span><span style=display:flex><span>        retention_curve <span style=color:#ff7b72;font-weight:700>=</span> user_retention<span style=color:#ff7b72;font-weight:700>.</span>groupby(<span style=color:#a5d6ff>&#39;lifespan_days&#39;</span>)<span style=color:#ff7b72;font-weight:700>.</span>size()<span style=color:#ff7b72;font-weight:700>.</span>cumsum() <span style=color:#ff7b72;font-weight:700>/</span> len(user_retention) <span style=color:#ff7b72;font-weight:700>*</span> <span style=color:#a5d6ff>100</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>return</span> {
</span></span><span style=display:flex><span>            <span style=color:#a5d6ff>&#39;retention_curve&#39;</span>: retention_curve,
</span></span><span style=display:flex><span>            <span style=color:#a5d6ff>&#39;median_lifespan&#39;</span>: user_retention[<span style=color:#a5d6ff>&#39;lifespan_days&#39;</span>]<span style=color:#ff7b72;font-weight:700>.</span>median(),
</span></span><span style=display:flex><span>            <span style=color:#a5d6ff>&#39;avg_lifespan&#39;</span>: user_retention[<span style=color:#a5d6ff>&#39;lifespan_days&#39;</span>]<span style=color:#ff7b72;font-weight:700>.</span>mean()
</span></span><span style=display:flex><span>        }
</span></span></code></pre></td></tr></table></div></div><h3 id=32-æµå¤±é¢„æµ‹>3.2 æµå¤±é¢„æµ‹<a hidden class=anchor aria-hidden=true href=#32-æµå¤±é¢„æµ‹>#</a></h3><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 56
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 57
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 58
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 59
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 60
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 61
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 62
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 63
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 64
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 65
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 66
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 67
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 68
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 69
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 70
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 71
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 72
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 73
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 74
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 75
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 76
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 77
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 78
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 79
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 80
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 81
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 82
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 83
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 84
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 85
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 86
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 87
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 88
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 89
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 90
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 91
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 92
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 93
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 94
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 95
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 96
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 97
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 98
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 99
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">100
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">101
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">102
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">103
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">104
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">105
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">106
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">107
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">108
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">109
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#8b949e;font-style:italic># ç”¨æˆ·æµå¤±é¢„æµ‹</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>from</span> <span style=color:#ff7b72>sklearn.model_selection</span> <span style=color:#ff7b72>import</span> train_test_split
</span></span><span style=display:flex><span><span style=color:#ff7b72>from</span> <span style=color:#ff7b72>sklearn.ensemble</span> <span style=color:#ff7b72>import</span> RandomForestClassifier
</span></span><span style=display:flex><span><span style=color:#ff7b72>from</span> <span style=color:#ff7b72>sklearn.metrics</span> <span style=color:#ff7b72>import</span> classification_report, roc_auc_score
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>class</span> <span style=color:#f0883e;font-weight:700>ChurnPrediction</span>:
</span></span><span style=display:flex><span>    <span style=color:#a5d6ff>&#34;&#34;&#34;ç”¨æˆ·æµå¤±é¢„æµ‹&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>__init__</span>(self, activity_data):
</span></span><span style=display:flex><span>        self<span style=color:#ff7b72;font-weight:700>.</span>data <span style=color:#ff7b72;font-weight:700>=</span> activity_data
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>create_churn_features</span>(self, churn_days<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>30</span>):
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;&#34;&#34;åˆ›å»ºæµå¤±é¢„æµ‹ç‰¹å¾&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># å®šä¹‰æµå¤±ï¼šXå¤©æ²¡æœ‰æ´»åŠ¨</span>
</span></span><span style=display:flex><span>        last_date <span style=color:#ff7b72;font-weight:700>=</span> self<span style=color:#ff7b72;font-weight:700>.</span>data[<span style=color:#a5d6ff>&#39;activity_date&#39;</span>]<span style=color:#ff7b72;font-weight:700>.</span>max()
</span></span><span style=display:flex><span>        churn_date <span style=color:#ff7b72;font-weight:700>=</span> last_date <span style=color:#ff7b72;font-weight:700>-</span> pd<span style=color:#ff7b72;font-weight:700>.</span>Timedelta(days<span style=color:#ff7b72;font-weight:700>=</span>churn_days)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># è®¡ç®—æ¯ä¸ªç”¨æˆ·çš„ç‰¹å¾</span>
</span></span><span style=display:flex><span>        features <span style=color:#ff7b72;font-weight:700>=</span> self<span style=color:#ff7b72;font-weight:700>.</span>data<span style=color:#ff7b72;font-weight:700>.</span>groupby(<span style=color:#a5d6ff>&#39;user_id&#39;</span>)<span style=color:#ff7b72;font-weight:700>.</span>agg({
</span></span><span style=display:flex><span>            <span style=color:#a5d6ff>&#39;activity_date&#39;</span>: [
</span></span><span style=display:flex><span>                (<span style=color:#a5d6ff>&#39;last_activity&#39;</span>, <span style=color:#a5d6ff>&#39;max&#39;</span>),
</span></span><span style=display:flex><span>                (<span style=color:#a5d6ff>&#39;first_activity&#39;</span>, <span style=color:#a5d6ff>&#39;min&#39;</span>),
</span></span><span style=display:flex><span>                (<span style=color:#a5d6ff>&#39;activity_count&#39;</span>, <span style=color:#a5d6ff>&#39;count&#39;</span>),
</span></span><span style=display:flex><span>                (<span style=color:#a5d6ff>&#39;unique_days&#39;</span>, <span style=color:#ff7b72>lambda</span> x: x<span style=color:#ff7b72;font-weight:700>.</span>nunique())
</span></span><span style=display:flex><span>            ]
</span></span><span style=display:flex><span>        })<span style=color:#ff7b72;font-weight:700>.</span>reset_index()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        features<span style=color:#ff7b72;font-weight:700>.</span>columns <span style=color:#ff7b72;font-weight:700>=</span> [<span style=color:#a5d6ff>&#39;user_id&#39;</span>, <span style=color:#a5d6ff>&#39;last_activity&#39;</span>, <span style=color:#a5d6ff>&#39;first_activity&#39;</span>,
</span></span><span style=display:flex><span>                          <span style=color:#a5d6ff>&#39;activity_count&#39;</span>, <span style=color:#a5d6ff>&#39;unique_days&#39;</span>]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># è®¡ç®—é¢å¤–ç‰¹å¾</span>
</span></span><span style=display:flex><span>        features[<span style=color:#a5d6ff>&#39;account_age_days&#39;</span>] <span style=color:#ff7b72;font-weight:700>=</span> (
</span></span><span style=display:flex><span>            features[<span style=color:#a5d6ff>&#39;last_activity&#39;</span>] <span style=color:#ff7b72;font-weight:700>-</span> features[<span style=color:#a5d6ff>&#39;first_activity&#39;</span>]
</span></span><span style=display:flex><span>        )<span style=color:#ff7b72;font-weight:700>.</span>dt<span style=color:#ff7b72;font-weight:700>.</span>days
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        features[<span style=color:#a5d6ff>&#39;avg_daily_activity&#39;</span>] <span style=color:#ff7b72;font-weight:700>=</span> features[<span style=color:#a5d6ff>&#39;activity_count&#39;</span>] <span style=color:#ff7b72;font-weight:700>/</span> (features[<span style=color:#a5d6ff>&#39;unique_days&#39;</span>] <span style=color:#ff7b72;font-weight:700>+</span> <span style=color:#a5d6ff>1</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        features[<span style=color:#a5d6ff>&#39;days_since_last&#39;</span>] <span style=color:#ff7b72;font-weight:700>=</span> (
</span></span><span style=display:flex><span>            last_date <span style=color:#ff7b72;font-weight:700>-</span> features[<span style=color:#a5d6ff>&#39;last_activity&#39;</span>]
</span></span><span style=display:flex><span>        )<span style=color:#ff7b72;font-weight:700>.</span>dt<span style=color:#ff7b72;font-weight:700>.</span>days
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># æ ‡è®°æµå¤±ç”¨æˆ·</span>
</span></span><span style=display:flex><span>        features[<span style=color:#a5d6ff>&#39;churned&#39;</span>] <span style=color:#ff7b72;font-weight:700>=</span> (features[<span style=color:#a5d6ff>&#39;last_activity&#39;</span>] <span style=color:#ff7b72;font-weight:700>&lt;</span> churn_date)<span style=color:#ff7b72;font-weight:700>.</span>astype(int)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># é€‰æ‹©ç‰¹å¾åˆ—</span>
</span></span><span style=display:flex><span>        feature_cols <span style=color:#ff7b72;font-weight:700>=</span> [<span style=color:#a5d6ff>&#39;activity_count&#39;</span>, <span style=color:#a5d6ff>&#39;unique_days&#39;</span>,
</span></span><span style=display:flex><span>                       <span style=color:#a5d6ff>&#39;account_age_days&#39;</span>, <span style=color:#a5d6ff>&#39;avg_daily_activity&#39;</span>,
</span></span><span style=display:flex><span>                       <span style=color:#a5d6ff>&#39;days_since_last&#39;</span>]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>return</span> features, feature_cols
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>train_churn_model</span>(self, features_df, feature_cols):
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;&#34;&#34;è®­ç»ƒæµå¤±é¢„æµ‹æ¨¡å‹&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        X <span style=color:#ff7b72;font-weight:700>=</span> features_df[feature_cols]
</span></span><span style=display:flex><span>        y <span style=color:#ff7b72;font-weight:700>=</span> features_df[<span style=color:#a5d6ff>&#39;churned&#39;</span>]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># åˆ†å‰²æ•°æ®</span>
</span></span><span style=display:flex><span>        X_train, X_test, y_train, y_test <span style=color:#ff7b72;font-weight:700>=</span> train_test_split(
</span></span><span style=display:flex><span>            X, y, test_size<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>0.2</span>, random_state<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>42</span>
</span></span><span style=display:flex><span>        )
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># è®­ç»ƒæ¨¡å‹</span>
</span></span><span style=display:flex><span>        model <span style=color:#ff7b72;font-weight:700>=</span> RandomForestClassifier(
</span></span><span style=display:flex><span>            n_estimators<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>100</span>,
</span></span><span style=display:flex><span>            max_depth<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>10</span>,
</span></span><span style=display:flex><span>            random_state<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>42</span>
</span></span><span style=display:flex><span>        )
</span></span><span style=display:flex><span>        model<span style=color:#ff7b72;font-weight:700>.</span>fit(X_train, y_train)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># é¢„æµ‹</span>
</span></span><span style=display:flex><span>        y_pred <span style=color:#ff7b72;font-weight:700>=</span> model<span style=color:#ff7b72;font-weight:700>.</span>predict(X_test)
</span></span><span style=display:flex><span>        y_prob <span style=color:#ff7b72;font-weight:700>=</span> model<span style=color:#ff7b72;font-weight:700>.</span>predict_proba(X_test)[:, <span style=color:#a5d6ff>1</span>]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># è¯„ä¼°</span>
</span></span><span style=display:flex><span>        metrics <span style=color:#ff7b72;font-weight:700>=</span> {
</span></span><span style=display:flex><span>            <span style=color:#a5d6ff>&#39;accuracy&#39;</span>: model<span style=color:#ff7b72;font-weight:700>.</span>score(X_test, y_test),
</span></span><span style=display:flex><span>            <span style=color:#a5d6ff>&#39;roc_auc&#39;</span>: roc_auc_score(y_test, y_prob),
</span></span><span style=display:flex><span>            <span style=color:#a5d6ff>&#39;classification_report&#39;</span>: classification_report(y_test, y_pred),
</span></span><span style=display:flex><span>            <span style=color:#a5d6ff>&#39;feature_importance&#39;</span>: dict(zip(feature_cols,
</span></span><span style=display:flex><span>                                          model<span style=color:#ff7b72;font-weight:700>.</span>feature_importances_))
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        self<span style=color:#ff7b72;font-weight:700>.</span>model <span style=color:#ff7b72;font-weight:700>=</span> model
</span></span><span style=display:flex><span>        self<span style=color:#ff7b72;font-weight:700>.</span>feature_cols <span style=color:#ff7b72;font-weight:700>=</span> feature_cols
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>return</span> model, metrics
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>predict_churn_risk</span>(self, user_data):
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;&#34;&#34;é¢„æµ‹ç”¨æˆ·æµå¤±é£é™©&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># ç¡®ä¿ç‰¹å¾é¡ºåºä¸€è‡´</span>
</span></span><span style=display:flex><span>        X <span style=color:#ff7b72;font-weight:700>=</span> user_data[self<span style=color:#ff7b72;font-weight:700>.</span>feature_cols]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># é¢„æµ‹</span>
</span></span><span style=display:flex><span>        churn_prob <span style=color:#ff7b72;font-weight:700>=</span> self<span style=color:#ff7b72;font-weight:700>.</span>model<span style=color:#ff7b72;font-weight:700>.</span>predict_proba(X)[:, <span style=color:#a5d6ff>1</span>]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># é£é™©åˆ†å±‚</span>
</span></span><span style=display:flex><span>        risk_levels <span style=color:#ff7b72;font-weight:700>=</span> []
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>for</span> prob <span style=color:#ff7b72;font-weight:700>in</span> churn_prob:
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>if</span> prob <span style=color:#ff7b72;font-weight:700>&gt;=</span> <span style=color:#a5d6ff>0.7</span>:
</span></span><span style=display:flex><span>                risk_levels<span style=color:#ff7b72;font-weight:700>.</span>append(<span style=color:#a5d6ff>&#39;High&#39;</span>)
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>elif</span> prob <span style=color:#ff7b72;font-weight:700>&gt;=</span> <span style=color:#a5d6ff>0.4</span>:
</span></span><span style=display:flex><span>                risk_levels<span style=color:#ff7b72;font-weight:700>.</span>append(<span style=color:#a5d6ff>&#39;Medium&#39;</span>)
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>else</span>:
</span></span><span style=display:flex><span>                risk_levels<span style=color:#ff7b72;font-weight:700>.</span>append(<span style=color:#a5d6ff>&#39;Low&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>return</span> churn_prob, risk_levels
</span></span></code></pre></td></tr></table></div></div><h2 id=å››ç”¨æˆ·æ—…ç¨‹åˆ†æ>å››ã€ç”¨æˆ·æ—…ç¨‹åˆ†æ<a hidden class=anchor aria-hidden=true href=#å››ç”¨æˆ·æ—…ç¨‹åˆ†æ>#</a></h2><h3 id=41-è·¯å¾„åˆ†æ>4.1 è·¯å¾„åˆ†æ<a hidden class=anchor aria-hidden=true href=#41-è·¯å¾„åˆ†æ>#</a></h3><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">56
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">57
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">58
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">59
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">60
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">61
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">62
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">63
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">64
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">65
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">66
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">67
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">68
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">69
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">70
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">71
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">72
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">73
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">74
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">75
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">76
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">77
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">78
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">79
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">80
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">81
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">82
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">83
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">84
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#8b949e;font-style:italic># ç”¨æˆ·è·¯å¾„åˆ†æ</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>class</span> <span style=color:#f0883e;font-weight:700>UserJourneyAnalysis</span>:
</span></span><span style=display:flex><span>    <span style=color:#a5d6ff>&#34;&#34;&#34;ç”¨æˆ·æ—…ç¨‹åˆ†æ&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>__init__</span>(self, event_data):
</span></span><span style=display:flex><span>        self<span style=color:#ff7b72;font-weight:700>.</span>data <span style=color:#ff7b72;font-weight:700>=</span> event_data
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>analyze_common_paths</span>(self, top_n<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>10</span>):
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;&#34;&#34;åˆ†æå¸¸è§ç”¨æˆ·è·¯å¾„&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># æŒ‰ç”¨æˆ·å’Œä¼šè¯åˆ†ç»„ï¼Œåˆ›å»ºäº‹ä»¶åºåˆ—</span>
</span></span><span style=display:flex><span>        user_paths <span style=color:#ff7b72;font-weight:700>=</span> self<span style=color:#ff7b72;font-weight:700>.</span>data<span style=color:#ff7b72;font-weight:700>.</span>sort_values([<span style=color:#a5d6ff>&#39;user_id&#39;</span>, <span style=color:#a5d6ff>&#39;session_id&#39;</span>, <span style=color:#a5d6ff>&#39;timestamp&#39;</span>]) \
</span></span><span style=display:flex><span>            <span style=color:#ff7b72;font-weight:700>.</span>groupby([<span style=color:#a5d6ff>&#39;user_id&#39;</span>, <span style=color:#a5d6ff>&#39;session_id&#39;</span>])[<span style=color:#a5d6ff>&#39;event_name&#39;</span>] \
</span></span><span style=display:flex><span>            <span style=color:#ff7b72;font-weight:700>.</span>apply(list)<span style=color:#ff7b72;font-weight:700>.</span>reset_index()
</span></span><span style=display:flex><span>        user_paths<span style=color:#ff7b72;font-weight:700>.</span>columns <span style=color:#ff7b72;font-weight:700>=</span> [<span style=color:#a5d6ff>&#39;user_id&#39;</span>, <span style=color:#a5d6ff>&#39;session_id&#39;</span>, <span style=color:#a5d6ff>&#39;path&#39;</span>]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># ç»Ÿè®¡è·¯å¾„é¢‘ç‡</span>
</span></span><span style=display:flex><span>        path_tuples <span style=color:#ff7b72;font-weight:700>=</span> user_paths[<span style=color:#a5d6ff>&#39;path&#39;</span>]<span style=color:#ff7b72;font-weight:700>.</span>apply(tuple)
</span></span><span style=display:flex><span>        path_counts <span style=color:#ff7b72;font-weight:700>=</span> path_tuples<span style=color:#ff7b72;font-weight:700>.</span>value_counts()<span style=color:#ff7b72;font-weight:700>.</span>head(top_n)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>return</span> path_counts
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>create_transition_matrix</span>(self):
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;&#34;&#34;åˆ›å»ºçŠ¶æ€è½¬ç§»çŸ©é˜µ&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># åˆ›å»ºäº‹ä»¶å¯¹</span>
</span></span><span style=display:flex><span>        self<span style=color:#ff7b72;font-weight:700>.</span>data <span style=color:#ff7b72;font-weight:700>=</span> self<span style=color:#ff7b72;font-weight:700>.</span>data<span style=color:#ff7b72;font-weight:700>.</span>sort_values([<span style=color:#a5d6ff>&#39;user_id&#39;</span>, <span style=color:#a5d6ff>&#39;timestamp&#39;</span>])
</span></span><span style=display:flex><span>        self<span style=color:#ff7b72;font-weight:700>.</span>data[<span style=color:#a5d6ff>&#39;next_event&#39;</span>] <span style=color:#ff7b72;font-weight:700>=</span> self<span style=color:#ff7b72;font-weight:700>.</span>data<span style=color:#ff7b72;font-weight:700>.</span>groupby(<span style=color:#a5d6ff>&#39;user_id&#39;</span>)[<span style=color:#a5d6ff>&#39;event_name&#39;</span>]<span style=color:#ff7b72;font-weight:700>.</span>shift(<span style=color:#ff7b72;font-weight:700>-</span><span style=color:#a5d6ff>1</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># è®¡ç®—è½¬ç§»æ¦‚ç‡</span>
</span></span><span style=display:flex><span>        transitions <span style=color:#ff7b72;font-weight:700>=</span> self<span style=color:#ff7b72;font-weight:700>.</span>data<span style=color:#ff7b72;font-weight:700>.</span>groupby([<span style=color:#a5d6ff>&#39;event_name&#39;</span>, <span style=color:#a5d6ff>&#39;next_event&#39;</span>])<span style=color:#ff7b72;font-weight:700>.</span>size()<span style=color:#ff7b72;font-weight:700>.</span>reset_index()
</span></span><span style=display:flex><span>        transitions<span style=color:#ff7b72;font-weight:700>.</span>columns <span style=color:#ff7b72;font-weight:700>=</span> [<span style=color:#a5d6ff>&#39;from_event&#39;</span>, <span style=color:#a5d6ff>&#39;to_event&#39;</span>, <span style=color:#a5d6ff>&#39;count&#39;</span>]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># åˆ›å»ºè½¬ç§»çŸ©é˜µ</span>
</span></span><span style=display:flex><span>        transition_matrix <span style=color:#ff7b72;font-weight:700>=</span> transitions<span style=color:#ff7b72;font-weight:700>.</span>pivot(
</span></span><span style=display:flex><span>            index<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>&#39;from_event&#39;</span>,
</span></span><span style=display:flex><span>            columns<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>&#39;to_event&#39;</span>,
</span></span><span style=display:flex><span>            values<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>&#39;count&#39;</span>
</span></span><span style=display:flex><span>        )<span style=color:#ff7b72;font-weight:700>.</span>fillna(<span style=color:#a5d6ff>0</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># å½’ä¸€åŒ–</span>
</span></span><span style=display:flex><span>        transition_matrix <span style=color:#ff7b72;font-weight:700>=</span> transition_matrix<span style=color:#ff7b72;font-weight:700>.</span>div(transition_matrix<span style=color:#ff7b72;font-weight:700>.</span>sum(axis<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>1</span>), axis<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>0</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>return</span> transition_matrix
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>find_conversion_paths</span>(self, start_event, end_event):
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;&#34;&#34;æŸ¥æ‰¾ä»èµ·å§‹åˆ°ç»“æŸçš„è·¯å¾„&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># ç­›é€‰åŒ…å«èµ·å§‹äº‹ä»¶çš„ä¼šè¯</span>
</span></span><span style=display:flex><span>        sessions_with_start <span style=color:#ff7b72;font-weight:700>=</span> self<span style=color:#ff7b72;font-weight:700>.</span>data[
</span></span><span style=display:flex><span>            self<span style=color:#ff7b72;font-weight:700>.</span>data[<span style=color:#a5d6ff>&#39;event_name&#39;</span>] <span style=color:#ff7b72;font-weight:700>==</span> start_event
</span></span><span style=display:flex><span>        ][<span style=color:#a5d6ff>&#39;session_id&#39;</span>]<span style=color:#ff7b72;font-weight:700>.</span>unique()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># åœ¨è¿™äº›ä¼šè¯ä¸­æŸ¥æ‰¾ç»“æŸäº‹ä»¶</span>
</span></span><span style=display:flex><span>        conversion_sessions <span style=color:#ff7b72;font-weight:700>=</span> self<span style=color:#ff7b72;font-weight:700>.</span>data[
</span></span><span style=display:flex><span>            (self<span style=color:#ff7b72;font-weight:700>.</span>data[<span style=color:#a5d6ff>&#39;session_id&#39;</span>]<span style=color:#ff7b72;font-weight:700>.</span>isin(sessions_with_start)) <span style=color:#ff7b72;font-weight:700>&amp;</span>
</span></span><span style=display:flex><span>            (self<span style=color:#ff7b72;font-weight:700>.</span>data[<span style=color:#a5d6ff>&#39;event_name&#39;</span>] <span style=color:#ff7b72;font-weight:700>==</span> end_event)
</span></span><span style=display:flex><span>        ][<span style=color:#a5d6ff>&#39;session_id&#39;</span>]<span style=color:#ff7b72;font-weight:700>.</span>unique()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># æå–å®Œæ•´è·¯å¾„</span>
</span></span><span style=display:flex><span>        conversion_paths <span style=color:#ff7b72;font-weight:700>=</span> self<span style=color:#ff7b72;font-weight:700>.</span>data[
</span></span><span style=display:flex><span>            self<span style=color:#ff7b72;font-weight:700>.</span>data[<span style=color:#a5d6ff>&#39;session_id&#39;</span>]<span style=color:#ff7b72;font-weight:700>.</span>isin(conversion_sessions)
</span></span><span style=display:flex><span>        ]<span style=color:#ff7b72;font-weight:700>.</span>sort_values([<span style=color:#a5d6ff>&#39;session_id&#39;</span>, <span style=color:#a5d6ff>&#39;timestamp&#39;</span>]) \
</span></span><span style=display:flex><span>         <span style=color:#ff7b72;font-weight:700>.</span>groupby(<span style=color:#a5d6ff>&#39;session_id&#39;</span>)[<span style=color:#a5d6ff>&#39;event_name&#39;</span>] \
</span></span><span style=display:flex><span>         <span style=color:#ff7b72;font-weight:700>.</span>apply(list)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># ç»Ÿè®¡è·¯å¾„</span>
</span></span><span style=display:flex><span>        path_stats <span style=color:#ff7b72;font-weight:700>=</span> {}
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>for</span> path <span style=color:#ff7b72;font-weight:700>in</span> conversion_paths:
</span></span><span style=display:flex><span>            <span style=color:#8b949e;font-style:italic># æ‰¾åˆ°start_eventå’Œend_eventä¹‹é—´çš„è·¯å¾„</span>
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>try</span>:
</span></span><span style=display:flex><span>                start_idx <span style=color:#ff7b72;font-weight:700>=</span> path<span style=color:#ff7b72;font-weight:700>.</span>index(start_event)
</span></span><span style=display:flex><span>                end_idx <span style=color:#ff7b72;font-weight:700>=</span> path<span style=color:#ff7b72;font-weight:700>.</span>index(end_event)
</span></span><span style=display:flex><span>                journey <span style=color:#ff7b72;font-weight:700>=</span> path[start_idx:end_idx <span style=color:#ff7b72;font-weight:700>+</span> <span style=color:#a5d6ff>1</span>]
</span></span><span style=display:flex><span>                journey_tuple <span style=color:#ff7b72;font-weight:700>=</span> tuple(journey)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>                path_stats[journey_tuple] <span style=color:#ff7b72;font-weight:700>=</span> path_stats<span style=color:#ff7b72;font-weight:700>.</span>get(journey_tuple, <span style=color:#a5d6ff>0</span>) <span style=color:#ff7b72;font-weight:700>+</span> <span style=color:#a5d6ff>1</span>
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>except</span> <span style=color:#f0883e;font-weight:700>ValueError</span>:
</span></span><span style=display:flex><span>                <span style=color:#ff7b72>continue</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># æ’åºå¹¶è¿”å›</span>
</span></span><span style=display:flex><span>        sorted_paths <span style=color:#ff7b72;font-weight:700>=</span> sorted(path_stats<span style=color:#ff7b72;font-weight:700>.</span>items(), key<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#ff7b72>lambda</span> x: x[<span style=color:#a5d6ff>1</span>], reverse<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#79c0ff>True</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>return</span> sorted_paths[:<span style=color:#a5d6ff>10</span>]
</span></span></code></pre></td></tr></table></div></div><h2 id=äº”äº§å“ä¼˜åŒ–å®è·µ>äº”ã€äº§å“ä¼˜åŒ–å®è·µ<a hidden class=anchor aria-hidden=true href=#äº”äº§å“ä¼˜åŒ–å®è·µ>#</a></h2><h3 id=51-abæµ‹è¯•æ¡†æ¶>5.1 A/Bæµ‹è¯•æ¡†æ¶<a hidden class=anchor aria-hidden=true href=#51-abæµ‹è¯•æ¡†æ¶>#</a></h3><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 56
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 57
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 58
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 59
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 60
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 61
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 62
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 63
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 64
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 65
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 66
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 67
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 68
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 69
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 70
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 71
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 72
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 73
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 74
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 75
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 76
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 77
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 78
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 79
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 80
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 81
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 82
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 83
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 84
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 85
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 86
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 87
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 88
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 89
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 90
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 91
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 92
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 93
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 94
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 95
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 96
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 97
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 98
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 99
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">100
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#8b949e;font-style:italic># A/Bæµ‹è¯•åˆ†æ</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>from</span> <span style=color:#ff7b72>scipy</span> <span style=color:#ff7b72>import</span> stats
</span></span><span style=display:flex><span><span style=color:#ff7b72>import</span> <span style=color:#ff7b72>pandas</span> <span style=color:#ff7b72>as</span> <span style=color:#ff7b72>pd</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>class</span> <span style=color:#f0883e;font-weight:700>ABTestAnalyzer</span>:
</span></span><span style=display:flex><span>    <span style=color:#a5d6ff>&#34;&#34;&#34;A/Bæµ‹è¯•åˆ†æå™¨&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>__init__</span>(self, experiment_data):
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;&#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>        experiment_data columns:
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>        - user_id
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>        - variant (A/B)
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>        - converted (0/1)
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>        - metric_value (å¯é€‰)
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>        &#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>        self<span style=color:#ff7b72;font-weight:700>.</span>data <span style=color:#ff7b72;font-weight:700>=</span> experiment_data
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>calculate_conversion_rate</span>(self):
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;&#34;&#34;è®¡ç®—è½¬åŒ–ç‡&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        summary <span style=color:#ff7b72;font-weight:700>=</span> self<span style=color:#ff7b72;font-weight:700>.</span>data<span style=color:#ff7b72;font-weight:700>.</span>groupby(<span style=color:#a5d6ff>&#39;variant&#39;</span>)<span style=color:#ff7b72;font-weight:700>.</span>agg({
</span></span><span style=display:flex><span>            <span style=color:#a5d6ff>&#39;user_id&#39;</span>: <span style=color:#a5d6ff>&#39;count&#39;</span>,
</span></span><span style=display:flex><span>            <span style=color:#a5d6ff>&#39;converted&#39;</span>: [<span style=color:#a5d6ff>&#39;sum&#39;</span>, <span style=color:#a5d6ff>&#39;mean&#39;</span>]
</span></span><span style=display:flex><span>        })<span style=color:#ff7b72;font-weight:700>.</span>round(<span style=color:#a5d6ff>4</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        summary<span style=color:#ff7b72;font-weight:700>.</span>columns <span style=color:#ff7b72;font-weight:700>=</span> [<span style=color:#a5d6ff>&#39;total_users&#39;</span>, <span style=color:#a5d6ff>&#39;conversions&#39;</span>, <span style=color:#a5d6ff>&#39;conversion_rate&#39;</span>]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>return</span> summary
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>statistical_test</span>(self, confidence_level<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>0.95</span>):
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;&#34;&#34;ç»Ÿè®¡æ˜¾è‘—æ€§æ£€éªŒ&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># å‡†å¤‡æ•°æ®</span>
</span></span><span style=display:flex><span>        variant_a <span style=color:#ff7b72;font-weight:700>=</span> self<span style=color:#ff7b72;font-weight:700>.</span>data[self<span style=color:#ff7b72;font-weight:700>.</span>data[<span style=color:#a5d6ff>&#39;variant&#39;</span>] <span style=color:#ff7b72;font-weight:700>==</span> <span style=color:#a5d6ff>&#39;A&#39;</span>][<span style=color:#a5d6ff>&#39;converted&#39;</span>]
</span></span><span style=display:flex><span>        variant_b <span style=color:#ff7b72;font-weight:700>=</span> self<span style=color:#ff7b72;font-weight:700>.</span>data[self<span style=color:#ff7b72;font-weight:700>.</span>data[<span style=color:#a5d6ff>&#39;variant&#39;</span>] <span style=color:#ff7b72;font-weight:700>==</span> <span style=color:#a5d6ff>&#39;B&#39;</span>][<span style=color:#a5d6ff>&#39;converted&#39;</span>]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># æ‰§è¡ŒZæ£€éªŒ</span>
</span></span><span style=display:flex><span>        count_a <span style=color:#ff7b72;font-weight:700>=</span> variant_a<span style=color:#ff7b72;font-weight:700>.</span>sum()
</span></span><span style=display:flex><span>        count_b <span style=color:#ff7b72;font-weight:700>=</span> variant_b<span style=color:#ff7b72;font-weight:700>.</span>sum()
</span></span><span style=display:flex><span>        nobs_a <span style=color:#ff7b72;font-weight:700>=</span> len(variant_a)
</span></span><span style=display:flex><span>        nobs_b <span style=color:#ff7b72;font-weight:700>=</span> len(variant_b)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        z_stat, p_value <span style=color:#ff7b72;font-weight:700>=</span> stats<span style=color:#ff7b72;font-weight:700>.</span>proportions_ztest(
</span></span><span style=display:flex><span>            [count_a, count_b],
</span></span><span style=display:flex><span>            [nobs_a, nobs_b]
</span></span><span style=display:flex><span>        )
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># è®¡ç®—ç½®ä¿¡åŒºé—´</span>
</span></span><span style=display:flex><span>        se_A <span style=color:#ff7b72;font-weight:700>=</span> np<span style=color:#ff7b72;font-weight:700>.</span>sqrt(variant_a<span style=color:#ff7b72;font-weight:700>.</span>std() <span style=color:#ff7b72;font-weight:700>/</span> nobs_a)
</span></span><span style=display:flex><span>        se_B <span style=color:#ff7b72;font-weight:700>=</span> np<span style=color:#ff7b72;font-weight:700>.</span>sqrt(variant_b<span style=color:#ff7b72;font-weight:700>.</span>std() <span style=color:#ff7b72;font-weight:700>/</span> nobs_b)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        cr_A <span style=color:#ff7b72;font-weight:700>=</span> variant_a<span style=color:#ff7b72;font-weight:700>.</span>mean()
</span></span><span style=display:flex><span>        cr_B <span style=color:#ff7b72;font-weight:700>=</span> variant_b<span style=color:#ff7b72;font-weight:700>.</span>mean()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        diff <span style=color:#ff7b72;font-weight:700>=</span> cr_B <span style=color:#ff7b72;font-weight:700>-</span> cr_A
</span></span><span style=display:flex><span>        se_diff <span style=color:#ff7b72;font-weight:700>=</span> np<span style=color:#ff7b72;font-weight:700>.</span>sqrt(se_A<span style=color:#ff7b72;font-weight:700>**</span><span style=color:#a5d6ff>2</span> <span style=color:#ff7b72;font-weight:700>+</span> se_B<span style=color:#ff7b72;font-weight:700>**</span><span style=color:#a5d6ff>2</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        ci_lower <span style=color:#ff7b72;font-weight:700>=</span> diff <span style=color:#ff7b72;font-weight:700>-</span> stats<span style=color:#ff7b72;font-weight:700>.</span>norm<span style=color:#ff7b72;font-weight:700>.</span>ppf(<span style=color:#a5d6ff>1</span> <span style=color:#ff7b72;font-weight:700>-</span> (<span style=color:#a5d6ff>1</span> <span style=color:#ff7b72;font-weight:700>-</span> confidence_level) <span style=color:#ff7b72;font-weight:700>/</span> <span style=color:#a5d6ff>2</span>) <span style=color:#ff7b72;font-weight:700>*</span> se_diff
</span></span><span style=display:flex><span>        ci_upper <span style=color:#ff7b72;font-weight:700>=</span> diff <span style=color:#ff7b72;font-weight:700>+</span> stats<span style=color:#ff7b72;font-weight:700>.</span>norm<span style=color:#ff7b72;font-weight:700>.</span>ppf(<span style=color:#a5d6ff>1</span> <span style=color:#ff7b72;font-weight:700>-</span> (<span style=color:#a5d6ff>1</span> <span style=color:#ff7b72;font-weight:700>-</span> confidence_level) <span style=color:#ff7b72;font-weight:700>/</span> <span style=color:#a5d6ff>2</span>) <span style=color:#ff7b72;font-weight:700>*</span> se_diff
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        results <span style=color:#ff7b72;font-weight:700>=</span> {
</span></span><span style=display:flex><span>            <span style=color:#a5d6ff>&#39;variant_A_cr&#39;</span>: cr_A,
</span></span><span style=display:flex><span>            <span style=color:#a5d6ff>&#39;variant_B_cr&#39;</span>: cr_B,
</span></span><span style=display:flex><span>            <span style=color:#a5d6ff>&#39;absolute_lift&#39;</span>: diff,
</span></span><span style=display:flex><span>            <span style=color:#a5d6ff>&#39;relative_lift&#39;</span>: diff <span style=color:#ff7b72;font-weight:700>/</span> cr_A <span style=color:#ff7b72>if</span> cr_A <span style=color:#ff7b72;font-weight:700>&gt;</span> <span style=color:#a5d6ff>0</span> <span style=color:#ff7b72>else</span> <span style=color:#a5d6ff>0</span>,
</span></span><span style=display:flex><span>            <span style=color:#a5d6ff>&#39;z_statistic&#39;</span>: z_stat,
</span></span><span style=display:flex><span>            <span style=color:#a5d6ff>&#39;p_value&#39;</span>: p_value,
</span></span><span style=display:flex><span>            <span style=color:#a5d6ff>&#39;is_significant&#39;</span>: p_value <span style=color:#ff7b72;font-weight:700>&lt;</span> (<span style=color:#a5d6ff>1</span> <span style=color:#ff7b72;font-weight:700>-</span> confidence_level),
</span></span><span style=display:flex><span>            <span style=color:#a5d6ff>&#39;confidence_interval&#39;</span>: (ci_lower, ci_upper),
</span></span><span style=display:flex><span>            <span style=color:#a5d6ff>&#39;confidence_level&#39;</span>: confidence_level
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>return</span> results
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>calculate_sample_size</span>(self, baseline_cr, mde, alpha<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>0.05</span>, power<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>0.8</span>):
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;&#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>        è®¡ç®—æ‰€éœ€æ ·æœ¬é‡
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>        baseline_cr: åŸºçº¿è½¬åŒ–ç‡
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>        mde: æœ€å°å¯æ£€æµ‹æ•ˆåº”
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>        alpha: æ˜¾è‘—æ€§æ°´å¹³
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>        power: ç»Ÿè®¡åŠŸæ•ˆ
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>        &#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        effect_size <span style=color:#ff7b72;font-weight:700>=</span> mde <span style=color:#ff7b72;font-weight:700>/</span> baseline_cr
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># ä½¿ç”¨Cohen&#39;s hè®¡ç®—</span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>from</span> <span style=color:#ff7b72>statsmodels.stats.proportion</span> <span style=color:#ff7b72>import</span> proportion_effectsize
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>from</span> <span style=color:#ff7b72>statsmodels.stats.power</span> <span style=color:#ff7b72>import</span> NormalIndPower
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        effect <span style=color:#ff7b72;font-weight:700>=</span> proportion_effectsize(baseline_cr, baseline_cr <span style=color:#ff7b72;font-weight:700>*</span> (<span style=color:#a5d6ff>1</span> <span style=color:#ff7b72;font-weight:700>+</span> mde))
</span></span><span style=display:flex><span>        power_analysis <span style=color:#ff7b72;font-weight:700>=</span> NormalIndPower()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        sample_size <span style=color:#ff7b72;font-weight:700>=</span> power_analysis<span style=color:#ff7b72;font-weight:700>.</span>solve_power(
</span></span><span style=display:flex><span>            effect_size<span style=color:#ff7b72;font-weight:700>=</span>effect,
</span></span><span style=display:flex><span>            alpha<span style=color:#ff7b72;font-weight:700>=</span>alpha,
</span></span><span style=display:flex><span>            power<span style=color:#ff7b72;font-weight:700>=</span>power
</span></span><span style=display:flex><span>        )
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>return</span> int(np<span style=color:#ff7b72;font-weight:700>.</span>ceil(sample_size))
</span></span></code></pre></td></tr></table></div></div><h2 id=å…­è¡Œä¸ºæ•°æ®å¯è§†åŒ–>å…­ã€è¡Œä¸ºæ•°æ®å¯è§†åŒ–<a hidden class=anchor aria-hidden=true href=#å…­è¡Œä¸ºæ•°æ®å¯è§†åŒ–>#</a></h2><h3 id=61-ç”¨æˆ·è¡Œä¸ºçƒ­åŠ›å›¾>6.1 ç”¨æˆ·è¡Œä¸ºçƒ­åŠ›å›¾<a hidden class=anchor aria-hidden=true href=#61-ç”¨æˆ·è¡Œä¸ºçƒ­åŠ›å›¾>#</a></h3><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">45
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// ç”¨æˆ·è¡Œä¸ºçƒ­åŠ›å›¾å®ç°
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span><span style=color:#ff7b72>class</span> UserBehaviorHeatmap {
</span></span><span style=display:flex><span>  constructor(container, data) {
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>this</span>.container <span style=color:#ff7b72;font-weight:700>=</span> container;
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>this</span>.data <span style=color:#ff7b72;font-weight:700>=</span> data;
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>this</span>.init();
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  init() {
</span></span><span style=display:flex><span>    <span style=color:#8b949e;font-style:italic>// åˆ›å»ºçƒ­åŠ›å›¾å›¾å±‚
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>    <span style=color:#ff7b72>this</span>.heatmap <span style=color:#ff7b72;font-weight:700>=</span> h337.createContainer({
</span></span><span style=display:flex><span>      container<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#ff7b72>this</span>.container,
</span></span><span style=display:flex><span>      radius<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#a5d6ff>25</span>,
</span></span><span style=display:flex><span>      maxOpacity<span style=color:#ff7b72;font-weight:700>:</span> .<span style=color:#a5d6ff>8</span>,
</span></span><span style=display:flex><span>      minOpacity<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#a5d6ff>0</span>,
</span></span><span style=display:flex><span>      blur<span style=color:#ff7b72;font-weight:700>:</span> .<span style=color:#a5d6ff>75</span>
</span></span><span style=display:flex><span>    });
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8b949e;font-style:italic>// æ·»åŠ æ•°æ®ç‚¹
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>    <span style=color:#ff7b72>const</span> points <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#ff7b72>this</span>.data.map(point =&gt; ({
</span></span><span style=display:flex><span>      x<span style=color:#ff7b72;font-weight:700>:</span> point.x,
</span></span><span style=display:flex><span>      y<span style=color:#ff7b72;font-weight:700>:</span> point.y,
</span></span><span style=display:flex><span>      value<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#a5d6ff>1</span>  <span style=color:#8b949e;font-style:italic>// æ¯ä¸ªç‚¹å‡»çš„æƒé‡
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>    }));
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>this</span>.heatmap.setData({
</span></span><span style=display:flex><span>      max<span style=color:#ff7b72;font-weight:700>:</span> Math.max(...<span style=color:#ff7b72>this</span>.data.map(d =&gt; d.value <span style=color:#ff7b72;font-weight:700>||</span> <span style=color:#a5d6ff>1</span>)),
</span></span><span style=display:flex><span>      data<span style=color:#ff7b72;font-weight:700>:</span> points
</span></span><span style=display:flex><span>    });
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#8b949e;font-style:italic>// æŒ‰è®¾å¤‡ç±»å‹ç­›é€‰
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>  filterByDevice(device) {
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>const</span> filtered <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#ff7b72>this</span>.data.filter(d =&gt; d.device <span style=color:#ff7b72;font-weight:700>===</span> device);
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>this</span>.heatmap.setData({ data<span style=color:#ff7b72;font-weight:700>:</span> filtered });
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#8b949e;font-style:italic>// æŒ‰æ—¥æœŸèŒƒå›´ç­›é€‰
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>  filterByDateRange(startDate, endDate) {
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>const</span> filtered <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#ff7b72>this</span>.data.filter(d =&gt;
</span></span><span style=display:flex><span>      d.timestamp <span style=color:#ff7b72;font-weight:700>&gt;=</span> startDate <span style=color:#ff7b72;font-weight:700>&amp;&amp;</span> d.timestamp <span style=color:#ff7b72;font-weight:700>&lt;=</span> endDate
</span></span><span style=display:flex><span>    );
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>this</span>.heatmap.setData({ data<span style=color:#ff7b72;font-weight:700>:</span> filtered });
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div><h2 id=æ€»ç»“>æ€»ç»“<a hidden class=anchor aria-hidden=true href=#æ€»ç»“>#</a></h2><p>ç”¨æˆ·è¡Œä¸ºåˆ†ææ˜¯äº§å“ä¼˜åŒ–çš„åŸºçŸ³ã€‚é€šè¿‡ç³»ç»Ÿçš„è¡Œä¸ºåˆ†æï¼Œæˆ‘ä»¬å¯ä»¥ï¼š</p><ol><li><strong>ç†è§£ç”¨æˆ·éœ€æ±‚</strong> - é€šè¿‡è¡Œä¸ºæ•°æ®æ´å¯Ÿç”¨æˆ·çœŸå®æ„å›¾</li><li><strong>å‘ç°äº§å“é—®é¢˜</strong> - è¯†åˆ«ç”¨æˆ·æµå¤±ç‚¹å’Œç“¶é¢ˆ</li><li><strong>ä¼˜åŒ–ç”¨æˆ·ä½“éªŒ</strong> - åŸºäºæ•°æ®åšå‡ºäº§å“å†³ç­–</li><li><strong>æå‡å…³é”®æŒ‡æ ‡</strong> - ç•™å­˜ç‡ã€è½¬åŒ–ç‡ã€ç”¨æˆ·æ»¡æ„åº¦</li></ol><p>è®°ä½ï¼Œæ•°æ®åªæ˜¯æ‰‹æ®µï¼Œæå‡ç”¨æˆ·ä½“éªŒæ‰æ˜¯ç›®çš„ã€‚å§‹ç»ˆä»¥ç”¨æˆ·ä¸ºä¸­å¿ƒï¼Œç”¨æ•°æ®é©±åŠ¨äº§å“å†³ç­–ã€‚</p><blockquote><p><strong>å®ç”¨å·¥å…·</strong></p><ul><li><a href=https://www.util.cn/tools/timestamp-convert/>æ—¶é—´æˆ³è½¬æ¢</a> - æ—¶é—´æ•°æ®å¤„ç†</li><li><a href=https://www.util.cn/tools/json-formatter/>JSONæ ¼å¼åŒ–</a> - åˆ†ææ•°æ®æ ¼å¼åŒ–</li><li><a href=https://www.util.cn/tools/regex-tester/>æ­£åˆ™è¡¨è¾¾å¼æµ‹è¯•</a> - æ•°æ®æå–è¾…åŠ©</li></ul></blockquote></div><footer class=post-footer-modern><div class=post-tags-modern><span class=tags-label>ğŸ·ï¸ æ ‡ç­¾</span><div class=tags-list><a href=/blog/tags/%E7%94%A8%E6%88%B7%E8%A1%8C%E4%B8%BA/ class=tag-pill>ç”¨æˆ·è¡Œä¸º
</a><a href=/blog/tags/%E4%BA%A7%E5%93%81%E5%88%86%E6%9E%90/ class=tag-pill>äº§å“åˆ†æ
</a><a href=/blog/tags/%E7%94%A8%E6%88%B7%E4%BD%93%E9%AA%8C/ class=tag-pill>ç”¨æˆ·ä½“éªŒ
</a><a href=/blog/tags/%E8%BD%AC%E5%8C%96%E4%BC%98%E5%8C%96/ class=tag-pill>è½¬åŒ–ä¼˜åŒ–
</a><a href=/blog/tags/%E8%A1%8C%E4%B8%BA%E5%88%86%E6%9E%90/ class=tag-pill>è¡Œä¸ºåˆ†æ</a></div></div><style>.post-footer-modern{margin-top:3rem;padding-top:2rem;border-top:1px solid var(--border,#333333)}.post-tags-modern{display:flex;align-items:center;gap:1rem;margin-bottom:2rem;flex-wrap:wrap}.tags-label{font-size:.875rem;font-weight:600;color:var(--secondary,#999999) !important;white-space:nowrap}.tags-list{display:flex;flex-wrap:wrap;gap:.5rem;flex:1}.tag-pill{display:inline-block;padding:.25rem .75rem;background:rgba(255,255,255,5%);border:1px solid var(--border,#333333);border-radius:0;color:var(--secondary,#cccccc) !important;text-decoration:none;font-size:.8rem;font-weight:500;transition:all .2s ease}.tag-pill:hover{background:var(--primary,#ffffff);color:var(--background,#000000) !important;border-color:var(--primary,#ffffff);transform:translateY(-1px)}.post-nav-modern{margin-top:2rem}.nav-grid{display:grid;grid-template-columns:1fr 1fr;gap:1rem}.nav-card{display:flex;align-items:center;gap:1rem;padding:1.25rem;background:rgba(255,255,255,2%);border:1px solid var(--border,#333333);border-radius:12px;text-decoration:none;transition:all .2s ease;min-height:80px}.nav-card:hover{background:rgba(255,255,255,5%);border-color:var(--primary,#ffffff);transform:translateY(-2px)}.nav-card.nav-prev{justify-content:flex-start}.nav-card.nav-next{justify-content:flex-end;text-align:right}.nav-card.nav-next .nav-content{text-align:right}.nav-empty{display:flex;align-items:center;justify-content:center;background:rgba(255,255,255,1%);border:1px dashed var(--border,#333333);color:var(--secondary,#666666)}.nav-arrow{font-size:1.5rem;color:var(--primary,#ffffff);font-weight:300}.nav-content{flex:1}.nav-title{font-size:.95rem;font-weight:600;color:var(--primary,#ffffff) !important;line-height:1.4;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden}[data-theme=light] .post-footer-modern{border-color:var(--border-light,#dee2e6)}[data-theme=light] .tags-label{color:var(--secondary-light,#6c757d) !important}[data-theme=light] .tag-pill{background:rgba(0,0,0,5%);border-color:var(--border-light,#dee2e6);color:var(--secondary-light,#495057) !important}[data-theme=light] .tag-pill:hover{background:var(--primary-light,#0066cc);color:var(--background-light,#ffffff) !important;border-color:var(--primary-light,#0066cc)}[data-theme=light] .nav-card{background:rgba(0,0,0,2%);border-color:var(--border-light,#dee2e6)}[data-theme=light] .nav-card:hover{background:rgba(0,102,204,5%);border-color:var(--primary-light,#0066cc)}[data-theme=light] .nav-empty{background:rgba(0,0,0,1%);border-color:var(--border-light,#dee2e6);color:var(--secondary-light,#6c757d)}[data-theme=light] .nav-arrow{color:var(--primary-light,#0066cc)}[data-theme=light] .nav-title{color:var(--primary-light,#212529) !important}@media(max-width:768px){.nav-grid{grid-template-columns:1fr;gap:.75rem}.nav-card{padding:1rem;min-height:70px}.nav-card.nav-next{text-align:left}.nav-card.nav-next .nav-content{text-align:left}.nav-title{font-size:.875rem}.post-tags-modern{flex-direction:column;gap:.75rem}}@media(max-width:480px){.nav-arrow{font-size:1.25rem}.nav-card{padding:.875rem}.nav-title{font-size:.8rem;-webkit-line-clamp:1}}</style><nav class=post-nav-modern><div class=nav-grid><a href=/blog/articles/%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90%E6%96%B9%E6%B3%95%E8%AE%BA%E4%BB%8E%E6%95%B0%E6%8D%AE%E5%88%B0%E6%B4%9E%E5%AF%9F%E7%9A%84%E5%AE%8C%E6%95%B4%E6%80%9D%E7%BB%B4%E6%A1%86%E6%9E%B6/ class="nav-card nav-prev"><div class=nav-arrow>â†</div><div class=nav-content><div class=nav-title>æ•°æ®åˆ†ææ–¹æ³•è®ºï¼šä»æ•°æ®åˆ°æ´å¯Ÿçš„å®Œæ•´æ€ç»´æ¡†æ¶</div></div></a><a href=/blog/articles/%E5%86%85%E5%AE%B9%E8%90%A5%E9%94%80%E4%B8%8Eseo%E5%AE%8C%E7%BE%8E%E7%BB%93%E5%90%88%E6%89%93%E9%80%A0%E6%B5%81%E9%87%8F%E4%B8%8E%E8%BD%AC%E5%8C%96%E7%9A%84%E5%8F%8C%E9%87%8D%E5%BC%95%E6%93%8E/ class="nav-card nav-next"><div class=nav-content><div class=nav-title>å†…å®¹è¥é”€ä¸SEOå®Œç¾ç»“åˆï¼šæ‰“é€ æµé‡ä¸è½¬åŒ–çš„åŒé‡å¼•æ“</div></div><div class=nav-arrow>â†’</div></a></div></nav></footer></main><aside class=post-sidebar><div class=sidebar-toc id=sidebar-toc><div class=toc-header><div class=toc-title>ç›®å½•</div><button class=toc-toggle id=toc-toggle aria-label="Toggle TOC">
<svg class="toc-toggle-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 6 6 18M6 6l12 12"/></svg></button></div><div class=toc-content id=toc-content><ul class=toc-list><li class="toc-item toc-h2"><a href=#h2-0 class=toc-item-link><span class=toc-item-text>å¼•è¨€</span></a></li><li class="toc-item toc-h2"><a href=#h2-1 class=toc-item-link><span class=toc-item-text>ä¸€ã€ç”¨æˆ·è¡Œä¸ºæ•°æ®é‡‡é›†</span></a></li><li class="toc-item toc-h2"><a href=#h2-2 class=toc-item-link><span class=toc-item-text>äºŒã€ç”¨æˆ·åˆ†ç¾¤åˆ†æ</span></a></li><li class="toc-item toc-h2"><a href=#h2-3 class=toc-item-link><span class=toc-item-text>ä¸‰ã€ç”¨æˆ·ç•™å­˜åˆ†æ</span></a></li><li class="toc-item toc-h2"><a href=#h2-4 class=toc-item-link><span class=toc-item-text>å››ã€ç”¨æˆ·æ—…ç¨‹åˆ†æ</span></a></li><li class="toc-item toc-h2"><a href=#h2-5 class=toc-item-link><span class=toc-item-text>äº”ã€äº§å“ä¼˜åŒ–å®è·µ</span></a></li><li class="toc-item toc-h2"><a href=#h2-6 class=toc-item-link><span class=toc-item-text>å…­ã€è¡Œä¸ºæ•°æ®å¯è§†åŒ–</span></a></li><li class="toc-item toc-h2"><a href=#h2-7 class=toc-item-link><span class=toc-item-text>æ€»ç»“</span></a></li></ul></div></div><script>document.addEventListener("DOMContentLoaded",function(){const e=document.getElementById("sidebar-toc"),t=document.getElementById("toc-toggle"),o=document.getElementById("toc-content"),i=t?.querySelector(".toc-toggle-icon");if(!e)return;let n=!1;t&&t.addEventListener("click",function(){n=!n,n?(o.style.display="none",e.style.width="auto",i.innerHTML='<path d="M9 18l6-6-6-6"/>'):(o.style.display="block",e.style.width="200px",i.innerHTML='<path d="M18 6L6 18M6 6l12 12"/>')});const s=document.querySelector(".post-content");if(s){const e=s.querySelectorAll("h1");e.forEach((e,t)=>{e.id=`h1-${t}`});const t=s.querySelectorAll("h2");t.forEach((e,t)=>{e.id=`h2-${t}`})}const a=document.querySelectorAll(".toc-item-link");a.forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();const n=this.getAttribute("href").substring(1),t=document.getElementById(n);if(t){const e=document.querySelector(".post-header-main")?.offsetHeight||0,n=t.offsetTop-e-20;window.scrollTo({top:n,behavior:"smooth"})}})})})</script><style>.sidebar-toc{position:sticky;top:2rem;width:200px;background:#fff;border:1px solid #e5e7eb;border-radius:4px;overflow:hidden;box-shadow:0 1px 3px rgba(0,0,0,.1);z-index:100}.sidebar-toc.hidden{display:none}.toc-header{padding:12px 16px;border-bottom:1px solid #e5e7eb;background:#fafbfc;display:flex;align-items:center;justify-content:space-between}.toc-title{margin:0;font-size:13px;font-weight:500;color:#374151 !important;font-family:-apple-system,BlinkMacSystemFont,segoe ui,Roboto,sans-serif;text-transform:uppercase;letter-spacing:1px}.toc-toggle{background:0 0;border:none;cursor:pointer;padding:4px;border-radius:4px;display:flex;align-items:center;justify-content:center;transition:all .2s ease;color:#6b7280}.toc-toggle:hover{background:#e5e7eb;color:#374151}.toc-toggle-icon{transition:transform .2s ease}.toc-content{padding:12px 0}.toc-list{list-style:none;margin:0;padding:0}.toc-item{margin-bottom:4px;display:block !important;visibility:visible !important}.toc-h1,.toc-h2{display:block !important}.toc-h2{margin-left:0}.toc-item-link{display:flex;align-items:center;gap:8px;padding:8px 12px;color:#374151 !important;text-decoration:none;font-size:13px;line-height:1.4;border-radius:3px;transition:all .2s ease;font-weight:400}.toc-item-link:hover{background:#f8fafc;color:#1f2937 !important}.toc-item-link.active{background:#e0f2fe;color:#01579b !important;font-weight:500}.toc-dot{width:8px;height:8px;border-radius:50%;flex-shrink:0}.dot-red{background:#ef4444}.dot-blue{background:#2196f3}.toc-item-text{color:#1f2937 !important;font-weight:400;flex:1;display:inline !important;visibility:visible !important;opacity:1 !important;font-size:13px !important;line-height:1.4 !important}.toc-item-link .toc-item-text{color:#1f2937 !important;display:inline !important;visibility:visible !important;opacity:1 !important}.toc-item.active .dot-red{background:#d32f2f}.toc-item.active .dot-blue{background:#1976d2}[data-theme=dark] .sidebar-toc{background:#1f2937;border-color:#374151;box-shadow:0 1px 3px rgba(0,0,0,.3)}[data-theme=dark] .toc-header{background:#111827;border-color:#374151}[data-theme=dark] .toc-title{color:#f3f4f6 !important}[data-theme=dark] .toc-toggle{color:#9ca3af}[data-theme=dark] .toc-toggle:hover{background:#374151;color:#f3f4f6}[data-theme=dark] .toc-item-link{color:#e5e7eb !important}[data-theme=dark] .toc-item-link:hover{background:#374151;color:#f9fafb !important}[data-theme=dark] .toc-item-link.active{background:#0d47a1;color:#fff !important}[data-theme=dark] .toc-item-text{color:#f9fafb !important;display:inline !important;visibility:visible !important;opacity:1 !important}[data-theme=dark] .toc-item-link .toc-item-text{color:#f9fafb !important;display:inline !important;visibility:visible !important;opacity:1 !important}@media(max-width:1024px){.sidebar-toc{display:none}.post-content-wrapper{grid-template-columns:1fr !important;padding:0 1rem !important}}</style><style>.post-content-wrapper{display:grid;grid-template-columns:1fr 200px;gap:2rem;padding:0 2rem;max-width:100%}.post-content-main{min-width:0}.post-sidebar{position:sticky;top:2rem;height:fit-content;min-width:0}.post-header-main{margin-bottom:2rem;padding-bottom:1rem;border-bottom:1px solid var(--border,#333333)}.post-header-main .post-title{color:var(--primary,#ffffff) !important;font-size:2.5rem;font-weight:700;line-height:1.2;margin-bottom:1rem}.post-header-main .post-description{color:var(--secondary,#cccccc) !important;font-size:1.1rem;line-height:1.6;margin-bottom:1rem}.post-header-main .post-meta{margin-bottom:0}@media(max-width:1024px){.post-content-wrapper{grid-template-columns:1fr !important;gap:1rem;padding:0 1rem !important}.post-sidebar{display:none}}@media(max-width:768px){.post-header-main .post-title{font-size:2rem}.post-header-main .post-description{font-size:1rem}}</style></aside></div></article></main><footer class=footer><span>Â© 2024-2025 æœ‰æ¡å·¥å…·æŠ€æœ¯åšå®¢</span> Â·</footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");if(menu){const e=localStorage.getItem("menu-scroll-position");e&&(menu.scrollLeft=parseInt(e,10)),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}}document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{const e=document.querySelector("html");e.dataset.theme==="dark"?(e.dataset.theme="light",localStorage.setItem("pref-theme","light")):(e.dataset.theme="dark",localStorage.setItem("pref-theme","dark"))})</script></body></html>