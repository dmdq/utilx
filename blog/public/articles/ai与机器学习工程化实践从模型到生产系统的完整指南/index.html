<!doctype html><html lang=zh-cn dir=auto data-theme=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>AIä¸æœºå™¨å­¦ä¹ å·¥ç¨‹åŒ–å®è·µï¼šä»æ¨¡å‹åˆ°ç”Ÿäº§ç³»ç»Ÿçš„å®Œæ•´æŒ‡å— | æŠ€æœ¯åšå®¢ - æœ‰æ¡å·¥å…·</title><meta name=keywords content="MLOpså®è·µ,æœºå™¨å­¦ä¹ å·¥ç¨‹åŒ–,æ¨¡å‹éƒ¨ç½²æœ€ä½³å®è·µ,ç‰¹å¾å·¥ç¨‹,æ¨¡å‹ç›‘æ§,A/Bæµ‹è¯•,AIç³»ç»Ÿæ¶æ„"><meta name=description content="æ·±å…¥æ¢è®¨AI/MLç³»ç»Ÿçš„å·¥ç¨‹åŒ–å®è·µï¼Œæ¶µç›–æ¨¡å‹éƒ¨ç½²ã€MLOpsã€ç‰¹å¾å·¥ç¨‹ã€æ¨¡å‹ç›‘æ§ã€A/Bæµ‹è¯•ç­‰æ ¸å¿ƒä¸»é¢˜ï¼Œå¸®åŠ©å·¥ç¨‹å¸ˆæ„å»ºå¯æ‰©å±•çš„ç”Ÿäº§çº§AIç³»ç»Ÿã€‚"><meta name=author content="æœ‰æ¡å·¥å…·å›¢é˜Ÿ"><link rel=canonical href=/blog/articles/ai%E4%B8%8E%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E5%B7%A5%E7%A8%8B%E5%8C%96%E5%AE%9E%E8%B7%B5%E4%BB%8E%E6%A8%A1%E5%9E%8B%E5%88%B0%E7%94%9F%E4%BA%A7%E7%B3%BB%E7%BB%9F%E7%9A%84%E5%AE%8C%E6%95%B4%E6%8C%87%E5%8D%97/><link crossorigin=anonymous href=/blog/assets/css/stylesheet.7e8505b7cdf8bb22ab2305e53c2700bb06c7e64faeb72cd3468823a9a3bd3d6e.css integrity="sha256-foUFt834uyKrIwXlPCcAuwbH5k+utyzTRogjqaO9PW4=" rel="preload stylesheet" as=style><link rel=icon href=/favicon.ico><link rel=icon type=image/png sizes=16x16 href=/blog/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=/blog/favicon-32x32.png><link rel=apple-touch-icon href=/blog/apple-touch-icon.png><link rel=mask-icon href=/blog/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate type=application/rss+xml href=/blog/articles/ai%E4%B8%8E%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E5%B7%A5%E7%A8%8B%E5%8C%96%E5%AE%9E%E8%B7%B5%E4%BB%8E%E6%A8%A1%E5%9E%8B%E5%88%B0%E7%94%9F%E4%BA%A7%E7%B3%BB%E7%BB%9F%E7%9A%84%E5%AE%8C%E6%95%B4%E6%8C%87%E5%8D%97/feed.xml title=rss><link rel=alternate hreflang=zh-cn href=/blog/articles/ai%E4%B8%8E%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E5%B7%A5%E7%A8%8B%E5%8C%96%E5%AE%9E%E8%B7%B5%E4%BB%8E%E6%A8%A1%E5%9E%8B%E5%88%B0%E7%94%9F%E4%BA%A7%E7%B3%BB%E7%BB%9F%E7%9A%84%E5%AE%8C%E6%95%B4%E6%8C%87%E5%8D%97/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51);color-scheme:dark}.list{background:var(--theme)}.toc{background:var(--entry)}}@media(prefers-color-scheme:light){.list::-webkit-scrollbar-thumb{border-color:var(--code-bg)}}</style></noscript><script>localStorage.getItem("pref-theme")==="dark"?document.querySelector("html").dataset.theme="dark":localStorage.getItem("pref-theme")==="light"?document.querySelector("html").dataset.theme="light":window.matchMedia("(prefers-color-scheme: dark)").matches?document.querySelector("html").dataset.theme="dark":document.querySelector("html").dataset.theme="light"</script><script src=/js/external-link-config.js></script><script src=/js/external-link-interceptor.js></script><link rel=stylesheet href=/blog/css/custom.css media=screen><script type=application/ld+json>{"@context":"https://schema.org","@type":"WebSite","name":"æŠ€æœ¯åšå®¢ - æœ‰æ¡å·¥å…· | å¼€å‘è€…å·¥å…·ä½¿ç”¨æ•™ç¨‹ & ç¼–ç¨‹æŠ€å·§åˆ†äº«","url":"https://www.util.cn/blog/","description":"æœ‰æ¡å·¥å…·æŠ€æœ¯åšå®¢ - åˆ†äº«å¼€å‘è€…å·¥å…·ä½¿ç”¨æ•™ç¨‹ã€ç¼–ç¨‹æŠ€å·§å’Œå®æˆ˜å¼€å‘ç»éªŒã€‚æä¾›JSONæ ¼å¼åŒ–ã€SQLä¼˜åŒ–ã€Markdownç¼–è¾‘å™¨ç­‰åœ¨çº¿å·¥å…·çš„è¯¦ç»†ä½¿ç”¨æŒ‡å—ï¼Œå¸®åŠ©å¼€å‘è€…æå‡å·¥ä½œæ•ˆç‡ã€‚","publisher":{"@type":"Organization","name":"æœ‰æ¡å·¥å…·","url":"https://www.util.cn","logo":{"@type":"ImageObject","url":"https://www.util.cn/blog/logo/logo-256.png","width":256,"height":256}},"potentialAction":[{"@type":"SearchAction","target":"https://www.util.cn/blog/search?q={search_term_string}","query-input":"required name=search_term_string"}]}</script><meta property="og:type" content="website"><meta property="og:title" content="æŠ€æœ¯åšå®¢ - æœ‰æ¡å·¥å…· | å¼€å‘è€…å·¥å…·ä½¿ç”¨æ•™ç¨‹ & ç¼–ç¨‹æŠ€å·§åˆ†äº«"><meta property="og:description" content="æœ‰æ¡å·¥å…·æŠ€æœ¯åšå®¢ - åˆ†äº«å¼€å‘è€…å·¥å…·ä½¿ç”¨æ•™ç¨‹ã€ç¼–ç¨‹æŠ€å·§å’Œå®æˆ˜å¼€å‘ç»éªŒã€‚æä¾›JSONæ ¼å¼åŒ–ã€SQLä¼˜åŒ–ã€Markdownç¼–è¾‘å™¨ç­‰åœ¨çº¿å·¥å…·çš„è¯¦ç»†ä½¿ç”¨æŒ‡å—ï¼Œå¸®åŠ©å¼€å‘è€…æå‡å·¥ä½œæ•ˆç‡ã€‚"><meta property="og:url" content="https://www.util.cn/blog/"><meta property="og:site_name" content="æœ‰æ¡å·¥å…·æŠ€æœ¯åšå®¢"><meta property="og:image" content="https://www.util.cn/blog/logo/logo-256.png"><meta property="og:image:width" content="1200"><meta property="og:image:height" content="630"><meta name=twitter:card content="summary_large_image"><meta name=twitter:title content="æŠ€æœ¯åšå®¢ - æœ‰æ¡å·¥å…· | å¼€å‘è€…å·¥å…·ä½¿ç”¨æ•™ç¨‹ & ç¼–ç¨‹æŠ€å·§åˆ†äº«"><meta name=twitter:description content="æœ‰æ¡å·¥å…·æŠ€æœ¯åšå®¢ - åˆ†äº«å¼€å‘è€…å·¥å…·ä½¿ç”¨æ•™ç¨‹ã€ç¼–ç¨‹æŠ€å·§å’Œå®æˆ˜å¼€å‘ç»éªŒã€‚"><meta name=twitter:image content="https://www.util.cn/blog/logo/logo-256.png"><meta name=baidu-site-verification content><meta name=category content="æŠ€æœ¯åšå®¢,å¼€å‘è€…å·¥å…·,ç¼–ç¨‹æ•™ç¨‹"><meta name=coverage content="Worldwide"><meta name=distribution content="Global"><meta name=rating content="General"><script id=51la_code async crossorigin=anonymous src="https://sdk.51.la/js-sdk-pro.min.js?id=3OM52V0xJAPv6ozF&hash=pro"></script><script>window.addEventListener("load",function(){setTimeout(function(){typeof la!="undefined"?console.log("51laç»Ÿè®¡å·²åŠ è½½"):(console.warn("51laç»Ÿè®¡åŠ è½½å¤±è´¥ï¼Œä½¿ç”¨å¤‡ç”¨æ–¹æ¡ˆ"),function(){var e=document.createElement("script");e.src="https://sdk.51.la/js-sdk-pro.min.js?id=3OM52V0xJAPv6ozF&hash=backup",e.async=!0,document.head.appendChild(e)}())},3e3)})</script><meta property="og:url" content="/blog/articles/ai%E4%B8%8E%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E5%B7%A5%E7%A8%8B%E5%8C%96%E5%AE%9E%E8%B7%B5%E4%BB%8E%E6%A8%A1%E5%9E%8B%E5%88%B0%E7%94%9F%E4%BA%A7%E7%B3%BB%E7%BB%9F%E7%9A%84%E5%AE%8C%E6%95%B4%E6%8C%87%E5%8D%97/"><meta property="og:site_name" content="æŠ€æœ¯åšå®¢ - æœ‰æ¡å·¥å…·"><meta property="og:title" content="AIä¸æœºå™¨å­¦ä¹ å·¥ç¨‹åŒ–å®è·µï¼šä»æ¨¡å‹åˆ°ç”Ÿäº§ç³»ç»Ÿçš„å®Œæ•´æŒ‡å—"><meta property="og:description" content="æ·±å…¥æ¢è®¨AI/MLç³»ç»Ÿçš„å·¥ç¨‹åŒ–å®è·µï¼Œæ¶µç›–æ¨¡å‹éƒ¨ç½²ã€MLOpsã€ç‰¹å¾å·¥ç¨‹ã€æ¨¡å‹ç›‘æ§ã€A/Bæµ‹è¯•ç­‰æ ¸å¿ƒä¸»é¢˜ï¼Œå¸®åŠ©å·¥ç¨‹å¸ˆæ„å»ºå¯æ‰©å±•çš„ç”Ÿäº§çº§AIç³»ç»Ÿã€‚"><meta property="og:locale" content="zh-cn"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2025-12-30T12:00:00+08:00"><meta property="article:modified_time" content="2025-12-30T12:00:00+08:00"><meta property="article:tag" content="MLOps"><meta property="article:tag" content="æ¨¡å‹éƒ¨ç½²"><meta property="article:tag" content="ç‰¹å¾å·¥ç¨‹"><meta property="article:tag" content="æ¨¡å‹ç›‘æ§"><meta property="article:tag" content="A/Bæµ‹è¯•"><meta name=twitter:card content="summary"><meta name=twitter:title content="AIä¸æœºå™¨å­¦ä¹ å·¥ç¨‹åŒ–å®è·µï¼šä»æ¨¡å‹åˆ°ç”Ÿäº§ç³»ç»Ÿçš„å®Œæ•´æŒ‡å—"><meta name=twitter:description content="æ·±å…¥æ¢è®¨AI/MLç³»ç»Ÿçš„å·¥ç¨‹åŒ–å®è·µï¼Œæ¶µç›–æ¨¡å‹éƒ¨ç½²ã€MLOpsã€ç‰¹å¾å·¥ç¨‹ã€æ¨¡å‹ç›‘æ§ã€A/Bæµ‹è¯•ç­‰æ ¸å¿ƒä¸»é¢˜ï¼Œå¸®åŠ©å·¥ç¨‹å¸ˆæ„å»ºå¯æ‰©å±•çš„ç”Ÿäº§çº§AIç³»ç»Ÿã€‚"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"æ‰€æœ‰æ–‡ç« ","item":"/blog/posts/"},{"@type":"ListItem","position":2,"name":"AIä¸æœºå™¨å­¦ä¹ å·¥ç¨‹åŒ–å®è·µï¼šä»æ¨¡å‹åˆ°ç”Ÿäº§ç³»ç»Ÿçš„å®Œæ•´æŒ‡å—","item":"/blog/articles/ai%E4%B8%8E%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E5%B7%A5%E7%A8%8B%E5%8C%96%E5%AE%9E%E8%B7%B5%E4%BB%8E%E6%A8%A1%E5%9E%8B%E5%88%B0%E7%94%9F%E4%BA%A7%E7%B3%BB%E7%BB%9F%E7%9A%84%E5%AE%8C%E6%95%B4%E6%8C%87%E5%8D%97/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"AIä¸æœºå™¨å­¦ä¹ å·¥ç¨‹åŒ–å®è·µï¼šä»æ¨¡å‹åˆ°ç”Ÿäº§ç³»ç»Ÿçš„å®Œæ•´æŒ‡å—","name":"AIä¸æœºå™¨å­¦ä¹ å·¥ç¨‹åŒ–å®è·µï¼šä»æ¨¡å‹åˆ°ç”Ÿäº§ç³»ç»Ÿçš„å®Œæ•´æŒ‡å—","description":"æ·±å…¥æ¢è®¨AI/MLç³»ç»Ÿçš„å·¥ç¨‹åŒ–å®è·µï¼Œæ¶µç›–æ¨¡å‹éƒ¨ç½²ã€MLOpsã€ç‰¹å¾å·¥ç¨‹ã€æ¨¡å‹ç›‘æ§ã€A/Bæµ‹è¯•ç­‰æ ¸å¿ƒä¸»é¢˜ï¼Œå¸®åŠ©å·¥ç¨‹å¸ˆæ„å»ºå¯æ‰©å±•çš„ç”Ÿäº§çº§AIç³»ç»Ÿã€‚","keywords":["MLOpså®è·µ","æœºå™¨å­¦ä¹ å·¥ç¨‹åŒ–","æ¨¡å‹éƒ¨ç½²æœ€ä½³å®è·µ","ç‰¹å¾å·¥ç¨‹","æ¨¡å‹ç›‘æ§","A/Bæµ‹è¯•","AIç³»ç»Ÿæ¶æ„"],"articleBody":"å¼•è¨€ å°†AI/MLæ¨¡å‹ä»ç ”ç©¶ç¯å¢ƒæ¨å‘ç”Ÿäº§ç¯å¢ƒæ˜¯ä¸€é¡¹å¤æ‚çš„å·¥ç¨‹æŒ‘æˆ˜ã€‚é™¤äº†æ¨¡å‹æœ¬èº«çš„å‡†ç¡®æ€§ï¼Œè¿˜éœ€è¦è€ƒè™‘å¯æ‰©å±•æ€§ã€å¯é æ€§ã€å¯ç»´æŠ¤æ€§ç­‰å¤šä¸ªæ–¹é¢ã€‚æœ¬æ–‡å°†æ·±å…¥æ¢è®¨AI/MLç³»ç»Ÿçš„å·¥ç¨‹åŒ–å®è·µï¼Œå¸®åŠ©å›¢é˜Ÿæ„å»ºç¨³å®šé«˜æ•ˆçš„ç”Ÿäº§çº§AIç³»ç»Ÿã€‚\nä¸€ã€MLOpsæ¦‚è¿° 1.1 MLOpsçš„æ ¸å¿ƒç»„ä»¶ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 # ========== MLOpsæ¶æ„æ¦‚è§ˆ ========== \"\"\" â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ æ•°æ®å±‚ â”‚ â”‚ - åŸå§‹æ•°æ® â”‚ â”‚ - ç‰¹å¾å­˜å‚¨ â”‚ â”‚ - è®­ç»ƒæ•°æ® â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ è®­ç»ƒå±‚ â”‚ â”‚ - ç‰¹å¾å·¥ç¨‹ â”‚ â”‚ - æ¨¡å‹è®­ç»ƒ â”‚ â”‚ - è¶…å‚æ•°è°ƒä¼˜ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ è¯„ä¼°å±‚ â”‚ â”‚ - æ¨¡å‹è¯„ä¼° â”‚ â”‚ - A/Bæµ‹è¯• â”‚ â”‚ - æ¨¡å‹éªŒè¯ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ éƒ¨ç½²å±‚ â”‚ â”‚ - æ¨¡å‹æœåŠ¡ â”‚ â”‚ - æ‰¹é‡æ¨ç† â”‚ â”‚ - è¾¹ç¼˜éƒ¨ç½² â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ ç›‘æ§å±‚ â”‚ â”‚ - æ€§èƒ½ç›‘æ§ â”‚ â”‚ - æ•°æ®æ¼‚ç§»æ£€æµ‹ â”‚ â”‚ - å‘Šè­¦ç³»ç»Ÿ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ \"\"\" # MLOpså„é˜¶æ®µçš„å…³é”®ä»»åŠ¡ MLOPS_PIPELINE = { \"data\": { \"ingestion\": \"æ•°æ®é‡‡é›†ä¸æ¸…æ´—\", \"validation\": \"æ•°æ®è´¨é‡æ£€æŸ¥\", \"feature_engineering\": \"ç‰¹å¾æå–ä¸è½¬æ¢\", \"feature_store\": \"ç‰¹å¾å­˜å‚¨ä¸ç‰ˆæœ¬ç®¡ç†\" }, \"training\": { \"experiment_tracking\": \"å®éªŒè¿½è¸ª\", \"hyperparameter_tuning\": \"è¶…å‚æ•°ä¼˜åŒ–\", \"model_training\": \"æ¨¡å‹è®­ç»ƒ\", \"model_evaluation\": \"æ¨¡å‹è¯„ä¼°\" }, \"deployment\": { \"model_serving\": \"æ¨¡å‹æœåŠ¡åŒ–\", \"canary_deployment\": \"é‡‘ä¸é›€éƒ¨ç½²\", \"model_versioning\": \"æ¨¡å‹ç‰ˆæœ¬ç®¡ç†\", \"rollback\": \"å›æ»šæœºåˆ¶\" }, \"monitoring\": { \"performance_monitoring\": \"æ€§èƒ½ç›‘æ§\", \"data_drift_detection\": \"æ•°æ®æ¼‚ç§»æ£€æµ‹\", \"model_explainability\": \"æ¨¡å‹å¯è§£é‡Šæ€§\", \"alerting\": \"å‘Šè­¦ç³»ç»Ÿ\" } } 1.2 å®éªŒç®¡ç†ä¸è¿½è¸ª 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 # ========== å®éªŒè¿½è¸ªç³»ç»Ÿ ========== import mlflow import mlflow.sklearn from datetime import datetime from typing import Any, Dict, Optional class ExperimentTracker: \"\"\"å®éªŒè¿½è¸ªå™¨\"\"\" def __init__(self, tracking_uri: str, experiment_name: str): mlflow.set_tracking_uri(tracking_uri) mlflow.set_experiment(experiment_name) self.experiment_name = experiment_name def start_run(self, run_name: Optional[str] = None): \"\"\"å¼€å§‹ä¸€æ¬¡è¿è¡Œ\"\"\" self.run = mlflow.start_run(run_name=run_name) return self.run def log_params(self, params: Dict[str, Any]): \"\"\"è®°å½•å‚æ•°\"\"\" mlflow.log_params(params) def log_metrics(self, metrics: Dict[str, float], step: Optional[int] = None): \"\"\"è®°å½•æŒ‡æ ‡\"\"\" mlflow.log_metrics(metrics, step=step) def log_model(self, model: Any, artifact_path: str = \"model\"): \"\"\"è®°å½•æ¨¡å‹\"\"\" mlflow.sklearn.log_model(model, artifact_path) def log_artifact(self, file_path: str): \"\"\"è®°å½•æ–‡ä»¶\"\"\" mlflow.log_artifact(file_path) def log_figure(self, figure, artifact_file: str): \"\"\"è®°å½•å›¾è¡¨\"\"\" mlflow.log_figure(figure, artifact_file) def end_run(self, status: str = \"FINISHED\"): \"\"\"ç»“æŸè¿è¡Œ\"\"\" mlflow.end_run(status=status) # ä½¿ç”¨ç¤ºä¾‹ def train_model_with_tracking(X_train, y_train, X_test, y_test, params): \"\"\"è®­ç»ƒæ¨¡å‹å¹¶è¿½è¸ªå®éªŒ\"\"\" tracker = ExperimentTracker( tracking_uri=\"http://mlflow-server:5000\", experiment_name=\"fraud-detection\" ) tracker.start_run(run_name=f\"experiment-{datetime.now().strftime('%Y%m%d-%H%M%S')}\") try: # è®°å½•å‚æ•° tracker.log_params(params) # è®­ç»ƒæ¨¡å‹ model = train_model(X_train, y_train, params) # è¯„ä¼°æ¨¡å‹ metrics = evaluate_model(model, X_test, y_test) tracker.log_metrics(metrics) # è®°å½•æ¨¡å‹ tracker.log_model(model) # è®°å½•å­¦ä¹ æ›²çº¿ fig = plot_learning_curve(model, X_train, y_train) tracker.log_figure(fig, \"learning_curve.png\") # è®°å½•ç‰¹å¾é‡è¦æ€§ fig = plot_feature_importance(model) tracker.log_figure(fig, \"feature_importance.png\") tracker.end_run(status=\"FINISHED\") return model, metrics except Exception as e: tracker.end_run(status=\"FAILED\") raise e # ========== è¶…å‚æ•°ä¼˜åŒ– ========== import optuna from optuna.integration.mlflow import MLflowCallback class HyperparameterOptimizer: \"\"\"è¶…å‚æ•°ä¼˜åŒ–å™¨\"\"\" def __init__(self, n_trials: int = 100, timeout: Optional[int] = None): self.n_trials = n_trials self.timeout = timeout self.study = None def objective(self, trial, X_train, y_train, X_val, y_val): \"\"\"ä¼˜åŒ–ç›®æ ‡å‡½æ•°\"\"\" # å®šä¹‰æœç´¢ç©ºé—´ params = { 'n_estimators': trial.suggest_int('n_estimators', 50, 500), 'max_depth': trial.suggest_int('max_depth', 3, 20), 'learning_rate': trial.suggest_float('learning_rate', 0.001, 0.3, log=True), 'subsample': trial.suggest_float('subsample', 0.5, 1.0), 'colsample_bytree': trial.suggest_float('colsample_bytree', 0.5, 1.0), 'min_child_weight': trial.suggest_int('min_child_weight', 1, 10), } # è®­ç»ƒæ¨¡å‹ model = train_model(X_train, y_train, params) # è¯„ä¼° predictions = model.predict(X_val) score = calculate_metric(y_val, predictions) return score def optimize(self, X_train, y_train, X_val, y_val): \"\"\"æ‰§è¡Œè¶…å‚æ•°ä¼˜åŒ–\"\"\" # åˆ›å»ºç ”ç©¶å¯¹è±¡ self.study = optuna.create_study( direction=\"maximize\", study_name=\"hyperparameter-optimization\" ) # æ·»åŠ MLflowå›è°ƒ mlflc = MLflowCallback( tracking_uri=\"http://mlflow-server:5000\", metric_name=\"validation_score\" ) # æ‰§è¡Œä¼˜åŒ– self.study.optimize( lambda trial: self.objective(trial, X_train, y_train, X_val, y_val), n_trials=self.n_trials, timeout=self.timeout, callbacks=[mlflc] ) return self.study.best_params, self.study.best_value def get_importance(self): \"\"\"è·å–è¶…å‚æ•°é‡è¦æ€§\"\"\" return optuna.importance.get_param_importances(self.study) äºŒã€ç‰¹å¾å·¥ç¨‹ä¸ç®¡ç† 2.1 ç‰¹å¾å­˜å‚¨æ¶æ„ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 174 175 176 177 178 179 180 181 182 # ========== ç‰¹å¾å­˜å‚¨ç³»ç»Ÿ ========== from abc import ABC, abstractmethod from typing import List, Dict, Any import pandas as pd from datetime import datetime, timedelta class FeatureStore(ABC): \"\"\"ç‰¹å¾å­˜å‚¨æŠ½è±¡ç±»\"\"\" @abstractmethod def get_features(self, entity_ids: List[str], feature_names: List[str]) -\u003e pd.DataFrame: \"\"\"è·å–ç‰¹å¾\"\"\" pass @abstractmethod def write_features(self, entity_id: str, features: Dict[str, Any]): \"\"\"å†™å…¥ç‰¹å¾\"\"\" pass class OfflineFeatureStore(FeatureStore): \"\"\"ç¦»çº¿ç‰¹å¾å­˜å‚¨ - ç”¨äºè®­ç»ƒ\"\"\" def __init__(self, storage_path: str): self.storage_path = storage_path def get_features(self, entity_ids: List[str], feature_names: List[str]) -\u003e pd.DataFrame: \"\"\"ä»å­˜å‚¨è·å–ç‰¹å¾\"\"\" # ä»Parquetæ–‡ä»¶è¯»å– df = pd.read_parquet(f\"{self.storage_path}/features.parquet\") # è¿‡æ»¤å®ä½“ df = df[df['entity_id'].isin(entity_ids)] # é€‰æ‹©ç‰¹å¾åˆ— return df[['entity_id'] + feature_names] def write_features(self, entity_id: str, features: Dict[str, Any]): \"\"\"å†™å…¥ç‰¹å¾åˆ°å­˜å‚¨\"\"\" # å®ç°å†™å…¥é€»è¾‘ pass def create_training_set( self, entity_ids: List[str], feature_names: List[str], label_name: str ) -\u003e pd.DataFrame: \"\"\"åˆ›å»ºè®­ç»ƒæ•°æ®é›†\"\"\" df = self.get_features(entity_ids, feature_names + [label_name]) return df class OnlineFeatureStore(FeatureStore): \"\"\"åœ¨çº¿ç‰¹å¾å­˜å‚¨ - ç”¨äºæ¨ç†\"\"\" def __init__(self, redis_client): self.redis = redis_client def get_features(self, entity_ids: List[str], feature_names: List[str]) -\u003e pd.DataFrame: \"\"\"ä»Redisè·å–å®æ—¶ç‰¹å¾\"\"\" features = [] for entity_id in entity_ids: key = f\"feature:{entity_id}\" data = self.redis.hgetall(key) feature_dict = { 'entity_id': entity_id } for feature_name in feature_names: feature_dict[feature_name] = data.get(feature_name) features.append(feature_dict) return pd.DataFrame(features) def write_features(self, entity_id: str, features: Dict[str, Any]): \"\"\"å†™å…¥ç‰¹å¾åˆ°Redis\"\"\" key = f\"feature:{entity_id}\" # æ·»åŠ æ—¶é—´æˆ³ features['updated_at'] = datetime.now().isoformat() self.redis.hset(key, mapping=features) # è®¾ç½®è¿‡æœŸæ—¶é—´ self.redis.expire(key, timedelta(days=7)) class FeatureEngineeringPipeline: \"\"\"ç‰¹å¾å·¥ç¨‹ç®¡é“\"\"\" def __init__(self, config: Dict[str, Any]): self.config = config self.transformers = {} def fit(self, df: pd.DataFrame): \"\"\"æ‹Ÿåˆå˜æ¢å™¨\"\"\" for feature_config in self.config['features']: feature_name = feature_config['name'] transform_type = feature_config['transform'] if transform_type == 'standard': from sklearn.preprocessing import StandardScaler transformer = StandardScaler() transformer.fit(df[[feature_name]]) self.transformers[feature_name] = transformer elif transform_type == 'minmax': from sklearn.preprocessing import MinMaxScaler transformer = MinMaxScaler() transformer.fit(df[[feature_name]]) self.transformers[feature_name] = transformer elif transform_type == 'label': from sklearn.preprocessing import LabelEncoder transformer = LabelEncoder() transformer.fit(df[feature_name]) self.transformers[feature_name] = transformer def transform(self, df: pd.DataFrame) -\u003e pd.DataFrame: \"\"\"å˜æ¢æ•°æ®\"\"\" result_df = df.copy() for feature_name, transformer in self.transformers.items(): if isinstance(transformer, (StandardScaler, MinMaxScaler)): result_df[feature_name] = transformer.transform(df[[feature_name]]).flatten() elif isinstance(transformer, LabelEncoder): result_df[feature_name] = transformer.transform(df[feature_name]) return result_df def fit_transform(self, df: pd.DataFrame) -\u003e pd.DataFrame: \"\"\"æ‹Ÿåˆå¹¶å˜æ¢\"\"\" self.fit(df) return self.transform(df) # ä½¿ç”¨ç¤ºä¾‹ def create_training_features(): \"\"\"åˆ›å»ºè®­ç»ƒç‰¹å¾\"\"\" # åˆå§‹åŒ–ç¦»çº¿ç‰¹å¾å­˜å‚¨ offline_store = OfflineFeatureStore('/data/features') # è·å–åŸå§‹æ•°æ® raw_data = load_raw_data() # ç‰¹å¾å·¥ç¨‹ pipeline = FeatureEngineeringPipeline({ 'features': [ {'name': 'age', 'transform': 'standard'}, {'name': 'income', 'transform': 'minmax'}, {'name': 'category', 'transform': 'label'} ] }) # æ‹Ÿåˆå¹¶å˜æ¢ features = pipeline.fit_transform(raw_data) # å†™å…¥ç‰¹å¾å­˜å‚¨ for _, row in features.iterrows(): offline_store.write_features( row['entity_id'], row.to_dict() ) return features def get_online_features(entity_id: str): \"\"\"è·å–åœ¨çº¿ç‰¹å¾\"\"\" import redis r = redis.Redis(host='localhost', port=6379) online_store = OnlineFeatureStore(r) features = online_store.get_features( [entity_id], ['age', 'income', 'category'] ) return features.iloc[0].to_dict() 2.2 ç‰¹å¾ç‰ˆæœ¬ç®¡ç† 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 # ========== ç‰¹å¾ç‰ˆæœ¬ç®¡ç† ========== class FeatureVersion: \"\"\"ç‰¹å¾ç‰ˆæœ¬\"\"\" def __init__( self, feature_name: str, version: int, computation_logic: str, created_at: datetime ): self.feature_name = feature_name self.version = version self.computation_logic = computation_logic self.created_at = created_at class FeatureRegistry: \"\"\"ç‰¹å¾æ³¨å†Œè¡¨\"\"\" def __init__(self): self.features = {} def register_feature( self, feature_name: str, computation_logic: str, description: str = \"\", owner: str = \"\" ): \"\"\"æ³¨å†Œæ–°ç‰¹å¾\"\"\" if feature_name in self.features: # åˆ›å»ºæ–°ç‰ˆæœ¬ last_version = max(self.features[feature_name].keys()) new_version = last_version + 1 else: self.features[feature_name] = {} new_version = 1 feature_version = FeatureVersion( feature_name=feature_name, version=new_version, computation_logic=computation_logic, created_at=datetime.now() ) self.features[feature_name][new_version] = feature_version return new_version def get_feature(self, feature_name: str, version: Optional[int] = None): \"\"\"è·å–ç‰¹å¾å®šä¹‰\"\"\" if feature_name not in self.features: raise ValueError(f\"Feature {feature_name} not found\") if version is None: # è·å–æœ€æ–°ç‰ˆæœ¬ version = max(self.features[feature_name].keys()) return self.features[feature_name][version] def list_features(self): \"\"\"åˆ—å‡ºæ‰€æœ‰ç‰¹å¾\"\"\" return { name: max(versions.keys()) for name, versions in self.features.items() } # ä½¿ç”¨ç¤ºä¾‹ registry = FeatureRegistry() # æ³¨å†Œç‰¹å¾ registry.register_feature( feature_name=\"user_avg_transaction_amount\", computation_logic=\"\"\" SELECT user_id, AVG(amount) as user_avg_transaction_amount FROM transactions WHERE transaction_date \u003e= DATE_SUB(CURRENT_DATE, INTERVAL 30 DAY) GROUP BY user_id \"\"\", description=\"ç”¨æˆ·è¿‡å»30å¤©å¹³å‡äº¤æ˜“é‡‘é¢\", owner=\"data-team\" ) # æ›´æ–°ç‰¹å¾é€»è¾‘ï¼ˆåˆ›å»ºæ–°ç‰ˆæœ¬ï¼‰ registry.register_feature( feature_name=\"user_avg_transaction_amount\", computation_logic=\"\"\" SELECT user_id, AVG(amount) as user_avg_transaction_amount FROM transactions WHERE transaction_date \u003e= DATE_SUB(CURRENT_DATE, INTERVAL 30 DAY) AND status = 'completed' GROUP BY user_id \"\"\", description=\"ç”¨æˆ·è¿‡å»30å¤©å·²å®Œæˆäº¤æ˜“å¹³å‡é‡‘é¢\", owner=\"data-team\" ) ä¸‰ã€æ¨¡å‹éƒ¨ç½²ä¸æœåŠ¡åŒ– 3.1 æ¨¡å‹æœåŠ¡åŒ– 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 # ========== æ¨¡å‹æœåŠ¡ ========== from fastapi import FastAPI, HTTPException from pydantic import BaseModel from typing import List import joblib import numpy as np app = FastAPI(title=\"ML Model Service\") class PredictionRequest(BaseModel): features: List[float] class PredictionResponse(BaseModel): prediction: float probability: float model_version: str timestamp: str class ModelService: \"\"\"æ¨¡å‹æœåŠ¡\"\"\" def __init__(self, model_path: str): self.model = self.load_model(model_path) self.model_version = self.get_model_version(model_path) def load_model(self, model_path: str): \"\"\"åŠ è½½æ¨¡å‹\"\"\" return joblib.load(model_path) def get_model_version(self, model_path: str) -\u003e str: \"\"\"è·å–æ¨¡å‹ç‰ˆæœ¬\"\"\" # ä»è·¯å¾„æˆ–å…ƒæ•°æ®ä¸­æå–ç‰ˆæœ¬ return model_path.split('/')[-1].replace('.pkl', '') def predict(self, features: List[float]) -\u003e dict: \"\"\"é¢„æµ‹\"\"\" X = np.array(features).reshape(1, -1) prediction = self.model.predict(X)[0] probability = self.model.predict_proba(X)[0].max() return { 'prediction': float(prediction), 'probability': float(probability) } # å…¨å±€æ¨¡å‹æœåŠ¡å®ä¾‹ model_service = ModelService(\"/models/fraud_detection_v1.pkl\") @app.post(\"/predict\", response_model=PredictionResponse) async def predict(request: PredictionRequest): \"\"\"é¢„æµ‹æ¥å£\"\"\" try: result = model_service.predict(request.features) return PredictionResponse( prediction=result['prediction'], probability=result['probability'], model_version=model_service.model_version, timestamp=datetime.now().isoformat() ) except Exception as e: raise HTTPException(status_code=500, detail=str(e)) @app.get(\"/model/info\") async def model_info(): \"\"\"æ¨¡å‹ä¿¡æ¯æ¥å£\"\"\" return { \"model_version\": model_service.model_version, \"model_type\": type(model_service.model).__name__, \"loaded_at\": datetime.now().isoformat() } @app.get(\"/health\") async def health_check(): \"\"\"å¥åº·æ£€æŸ¥\"\"\" return {\"status\": \"healthy\"} # ========== æ‰¹é‡é¢„æµ‹æœåŠ¡ ========== class BatchPredictionService: \"\"\"æ‰¹é‡é¢„æµ‹æœåŠ¡\"\"\" def __init__(self, model_path: str): self.model = joblib.load(model_path) self.batch_size = 1000 def predict_batch(self, features: List[List[float]]) -\u003e List[dict]: \"\"\"æ‰¹é‡é¢„æµ‹\"\"\" results = [] for i in range(0, len(features), self.batch_size): batch = features[i:i + self.batch_size] X = np.array(batch) predictions = self.model.predict(X) probabilities = self.model.predict_proba(X).max(axis=1) for pred, prob in zip(predictions, probabilities): results.append({ 'prediction': int(pred), 'probability': float(prob) }) return results @app.post(\"/predict/batch\") async def predict_batch(request: PredictionRequest): \"\"\"æ‰¹é‡é¢„æµ‹æ¥å£\"\"\" batch_service = BatchPredictionService(\"/models/fraud_detection_v1.pkl\") results = batch_service.predict_batch([request.features]) return {\"predictions\": results} 3.2 æ¨¡å‹ç‰ˆæœ¬ç®¡ç†ä¸å›æ»š 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 # ========== æ¨¡å‹ç‰ˆæœ¬ç®¡ç† ========== class ModelVersion: \"\"\"æ¨¡å‹ç‰ˆæœ¬\"\"\" def __init__( self, version: str, model_path: str, metrics: Dict[str, float], created_at: datetime ): self.version = version self.model_path = model_path self.metrics = metrics self.created_at = created_at class ModelRegistry: \"\"\"æ¨¡å‹æ³¨å†Œè¡¨\"\"\" def __init__(self, storage_path: str): self.storage_path = storage_path self.models = {} self.current_version = None def register_model( self, version: str, model_path: str, metrics: Dict[str, float] ): \"\"\"æ³¨å†Œæ¨¡å‹\"\"\" model_version = ModelVersion( version=version, model_path=model_path, metrics=metrics, created_at=datetime.now() ) self.models[version] = model_version return model_version def set_current_version(self, version: str): \"\"\"è®¾ç½®å½“å‰ç‰ˆæœ¬\"\"\" if version not in self.models: raise ValueError(f\"Version {version} not found\") self.current_version = version def get_current_model(self): \"\"\"è·å–å½“å‰æ¨¡å‹\"\"\" if self.current_version is None: raise ValueError(\"No current version set\") return self.models[self.current_version] def rollback(self, target_version: str): \"\"\"å›æ»šåˆ°æŒ‡å®šç‰ˆæœ¬\"\"\" if target_version not in self.models: raise ValueError(f\"Version {target_version} not found\") old_version = self.current_version self.current_version = target_version print(f\"Rollback from {old_version} to {target_version}\") def list_versions(self): \"\"\"åˆ—å‡ºæ‰€æœ‰ç‰ˆæœ¬\"\"\" return sorted( self.models.keys(), key=lambda v: self.models[v].created_at, reverse=True ) def compare_versions(self, version1: str, version2: str) -\u003e dict: \"\"\"æ¯”è¾ƒä¸¤ä¸ªç‰ˆæœ¬\"\"\" if version1 not in self.models or version2 not in self.models: raise ValueError(\"One or both versions not found\") return { 'version1': { 'version': version1, 'metrics': self.models[version1].metrics }, 'version2': { 'version': version2, 'metrics': self.models[version2].metrics }, 'improvement': { metric: self.models[version2].metrics[metric] - self.models[version1].metrics[metric] for metric in self.models[version1].metrics } } # ========== ç°åº¦å‘å¸ƒ ========== class CanaryDeployment: \"\"\"ç°åº¦éƒ¨ç½²ç®¡ç†\"\"\" def __init__(self, registry: ModelRegistry): self.registry = registry self.traffic_split = {} def set_traffic_split(self, version_percentages: Dict[str, float]): \"\"\"è®¾ç½®æµé‡åˆ†é…\"\"\" total = sum(version_percentages.values()) if abs(total - 1.0) \u003e 0.01: raise ValueError(\"Percentages must sum to 1.0\") for version in version_percentages.keys(): if version not in self.registry.models: raise ValueError(f\"Version {version} not found\") self.traffic_split = version_percentages def route_request(self) -\u003e str: \"\"\"è·¯ç”±è¯·æ±‚åˆ°æŒ‡å®šç‰ˆæœ¬\"\"\" import random rand = random.random() cumulative = 0.0 for version, percentage in self.traffic_split.items(): cumulative += percentage if rand \u003c= cumulative: return version return self.registry.current_version def gradual_rollout( self, new_version: str, steps: int = 10, duration_hours: int = 24 ): \"\"\"æ¸è¿›å¼ç°åº¦å‘å¸ƒ\"\"\" import asyncio step_duration = duration_hours * 3600 / steps async def rollout_step(step: int): percentage = (step + 1) / steps self.set_traffic_split({ new_version: percentage, self.registry.current_version: 1 - percentage }) print(f\"Step {step + 1}/{steps}: {new_version} at {percentage:.1%}\") await asyncio.sleep(step_duration) # æ‰§è¡Œæ¸è¿›å¼å‘å¸ƒ for step in range(steps): asyncio.run(rollout_step(step)) # å®Œå…¨åˆ‡æ¢åˆ°æ–°ç‰ˆæœ¬ self.registry.set_current_version(new_version) self.traffic_split = {new_version: 1.0} å››ã€æ¨¡å‹ç›‘æ§ä¸A/Bæµ‹è¯• 4.1 æ¨¡å‹æ€§èƒ½ç›‘æ§ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 # ========== æ¨¡å‹ç›‘æ§ç³»ç»Ÿ ========== from prometheus_client import Counter, Histogram, Gauge import numpy as np # å®šä¹‰ç›‘æ§æŒ‡æ ‡ prediction_count = Counter( 'ml_predictions_total', 'Total predictions made', ['model_version', 'prediction'] ) prediction_latency = Histogram( 'ml_prediction_duration_seconds', 'Prediction latency', ['model_version'] ) prediction_drift = Gauge( 'ml_prediction_distribution', 'Prediction distribution', ['model_version', 'prediction_class'] ) class ModelMonitor: \"\"\"æ¨¡å‹ç›‘æ§å™¨\"\"\" def __init__(self, model_version: str, expected_distribution: dict): self.model_version = model_version self.expected_distribution = expected_distribution self.actual_predictions = [] def log_prediction( self, prediction: int, probability: float, latency: float ): \"\"\"è®°å½•é¢„æµ‹\"\"\" prediction_count.labels( model_version=self.model_version, prediction=str(prediction) ).inc() prediction_latency.labels( model_version=self.model_version ).observe(latency) self.actual_predictions.append(prediction) def check_drift(self, threshold: float = 0.1) -\u003e bool: \"\"\"æ£€æŸ¥æ¼‚ç§»\"\"\" if len(self.actual_predictions) \u003c 100: return False # è®¡ç®—å®é™…åˆ†å¸ƒ actual_dist = {} for pred in self.actual_predictions: actual_dist[pred] = actual_dist.get(pred, 0) + 1 for key in actual_dist: actual_dist[key] /= len(self.actual_predictions) # è®¡ç®—åˆ†å¸ƒå·®å¼‚ drift_score = 0.0 for key in self.expected_distribution: expected = self.expected_distribution.get(key, 0) actual = actual_dist.get(key, 0) drift_score += abs(expected - actual) return drift_score \u003e threshold def update_distribution(self): \"\"\"æ›´æ–°æœŸæœ›åˆ†å¸ƒ\"\"\" if len(self.actual_predictions) \u003c 100: return new_dist = {} for pred in self.actual_predictions: new_dist[pred] = new_dist.get(pred, 0) + 1 for key in new_dist: new_dist[key] /= len(self.actual_predictions) self.expected_distribution = new_dist self.actual_predictions = [] class DataDriftDetector: \"\"\"æ•°æ®æ¼‚ç§»æ£€æµ‹å™¨\"\"\" def __init__(self, reference_data: np.ndarray): self.reference_data = reference_data self.reference_mean = np.mean(reference_data, axis=0) self.reference_std = np.std(reference_data, axis=0) def detect_drift( self, current_data: np.ndarray, threshold: float = 3.0 ) -\u003e dict: \"\"\"æ£€æµ‹æ•°æ®æ¼‚ç§»\"\"\" current_mean = np.mean(current_data, axis=0) current_std = np.std(current_data, axis=0) # Z-scoreæ£€æµ‹ z_scores = np.abs( (current_mean - self.reference_mean) / self.reference_std ) drifted_features = np.where(z_scores \u003e threshold)[0] return { 'drift_detected': len(drifted_features) \u003e 0, 'drifted_features': drifted_features.tolist(), 'z_scores': z_scores.tolist() } # ä½¿ç”¨ç¤ºä¾‹ def create_model_monitor(): \"\"\"åˆ›å»ºæ¨¡å‹ç›‘æ§å™¨\"\"\" # æœŸæœ›åˆ†å¸ƒï¼ˆä»è®­ç»ƒæ•°æ®è·å–ï¼‰ expected_dist = { 0: 0.95, # 95% æ­£å¸¸ 1: 0.05 # 5% æ¬ºè¯ˆ } monitor = ModelMonitor( model_version=\"v1.0\", expected_distribution=expected_dist ) return monitor async def monitor_predictions(): \"\"\"ç›‘æ§é¢„æµ‹\"\"\" monitor = create_model_monitor() while True: # è·å–é¢„æµ‹ç»“æœ predictions = await get_recent_predictions() for pred in predictions: monitor.log_prediction( prediction=pred['label'], probability=pred['probability'], latency=pred['latency'] ) # æ£€æŸ¥æ¼‚ç§» if monitor.check_drift(): send_alert(\"Prediction drift detected!\") await asyncio.sleep(60) # æ¯åˆ†é’Ÿæ£€æŸ¥ 4.2 A/Bæµ‹è¯•æ¡†æ¶ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 # ========== A/Bæµ‹è¯•æ¡†æ¶ ========== class ABTest: \"\"\"A/Bæµ‹è¯•\"\"\" def __init__( self, name: str, variants: List[str], traffic_split: Dict[str, float], metrics: List[str] ): self.name = name self.variants = variants self.traffic_split = traffic_split self.metrics = metrics self.results = {variant: {metric: [] for metric in metrics} for variant in variants} def assign_variant(self, user_id: str) -\u003e str: \"\"\"åˆ†é…ç”¨æˆ·åˆ°å˜ä½“\"\"\" import hashlib # ä½¿ç”¨ç”¨æˆ·IDçš„å“ˆå¸Œå€¼ä¿è¯ä¸€è‡´æ€§ hash_value = int(hashlib.md5(f\"{self.name}:{user_id}\".encode()).hexdigest(), 16) normalized = hash_value / (2 ** 32 - 1) cumulative = 0.0 for variant, percentage in self.traffic_split.items(): cumulative += percentage if normalized \u003c= cumulative: return variant return self.variants[-1] def record_metric(self, variant: str, metric: str, value: float): \"\"\"è®°å½•æŒ‡æ ‡\"\"\" if variant not in self.results: raise ValueError(f\"Unknown variant: {variant}\") if metric not in self.metrics: raise ValueError(f\"Unknown metric: {metric}\") self.results[variant][metric].append(value) def analyze(self) -\u003e dict: \"\"\"åˆ†æA/Bæµ‹è¯•ç»“æœ\"\"\" from scipy import stats analysis = {} for metric in self.metrics: metric_analysis = {} # è®¡ç®—æ¯ä¸ªå˜ä½“çš„ç»Ÿè®¡ä¿¡æ¯ for variant in self.variants: values = self.results[variant][metric] if len(values) == 0: continue metric_analysis[variant] = { 'mean': np.mean(values), 'std': np.std(values), 'count': len(values) } # æ¯”è¾ƒå˜ä½“ if len(self.variants) \u003e= 2: variant_a, variant_b = self.variants[0], self.variants[1] values_a = self.results[variant_a][metric] values_b = self.results[variant_b][metric] if len(values_a) \u003e 0 and len(values_b) \u003e 0: # tæ£€éªŒ t_stat, p_value = stats.ttest_ind(values_a, values_b) metric_analysis['comparison'] = { 't_statistic': t_stat, 'p_value': p_value, 'significant': p_value \u003c 0.05, 'lift': ( metric_analysis[variant_b]['mean'] - metric_analysis[variant_a]['mean'] ) / metric_analysis[variant_a]['mean'] } analysis[metric] = metric_analysis return analysis def get_winner(self) -\u003e str: \"\"\"ç¡®å®šè·èƒœå˜ä½“\"\"\" analysis = self.analyze() # ç®€å•ç­–ç•¥ï¼šé€‰æ‹©ä¸»è¦æŒ‡æ ‡æœ€é«˜çš„å˜ä½“ primary_metric = self.metrics[0] best_variant = None best_value = float('-inf') for variant in self.variants: if primary_metric in analysis: value = analysis[primary_metric].get(variant, {}).get('mean', float('-inf')) if value \u003e best_value: best_value = value best_variant = variant return best_variant # ä½¿ç”¨ç¤ºä¾‹ def run_ab_test(): \"\"\"è¿è¡ŒA/Bæµ‹è¯•\"\"\" # åˆ›å»ºA/Bæµ‹è¯• ab_test = ABTest( name=\"fraud_detection_v2\", variants=[\"control\", \"treatment\"], traffic_split={\"control\": 0.5, \"treatment\": 0.5}, metrics=[\"accuracy\", \"precision\", \"recall\", \"f1_score\"] ) # åˆ†é…ç”¨æˆ·å¹¶è®°å½•æŒ‡æ ‡ async def process_prediction(user_id: str, prediction: dict, actual: int): \"\"\"å¤„ç†é¢„æµ‹å¹¶è®°å½•æŒ‡æ ‡\"\"\" variant = ab_test.assign_variant(user_id) # ä½¿ç”¨å¯¹åº”å˜ä½“çš„æ¨¡å‹ if variant == \"control\": result = control_model.predict(prediction['features']) else: result = treatment_model.predict(prediction['features']) # è®¡ç®—æŒ‡æ ‡ accuracy = 1 if result['prediction'] == actual else 0 precision = calculate_precision(result, actual) recall = calculate_recall(result, actual) f1_score = 2 * (precision * recall) / (precision + recall) # è®°å½•æŒ‡æ ‡ ab_test.record_metric(variant, \"accuracy\", accuracy) ab_test.record_metric(variant, \"precision\", precision) ab_test.record_metric(variant, \"recall\", recall) ab_test.record_metric(variant, \"f1_score\", f1_score) # åˆ†æç»“æœ analysis = ab_test.analyze() print(\"A/B Test Analysis:\") print(analysis) # è·å–è·èƒœå˜ä½“ winner = ab_test.get_winner() print(f\"Winner: {winner}\") return analysis, winner äº”ã€ç«¯åˆ°ç«¯MLOpsæµæ°´çº¿ 5.1 CI/CDé›†æˆ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 # .github/workflows/mlops-pipeline.yml name: MLOps Pipeline on: push: branches: [main] paths: - 'models/**' - 'data/**' - 'training/**' pull_request: branches: [main] jobs: data-validation: runs-on: ubuntu-latest steps: - uses: actions/checkout@v3 - name: Set up Python uses: actions/setup-python@v4 with: python-version: '3.9' - name: Install dependencies run: | pip install -r requirements.txt - name: Validate data run: | python scripts/validate_data.py - name: Check data drift run: | python scripts/check_drift.py train-model: needs: data-validation runs-on: ubuntu-latest steps: - uses: actions/checkout@v3 - name: Set up Python uses: actions/setup-python@v4 with: python-version: '3.9' - name: Install dependencies run: | pip install -r requirements.txt - name: Train model env: MLFLOW_TRACKING_URI: ${{ secrets.MLFLOW_TRACKING_URI }} run: | python scripts/train_model.py - name: Run tests run: | pytest tests/ evaluate-model: needs: train-model runs-on: ubuntu-latest steps: - uses: actions/checkout@v3 - name: Evaluate model env: MLFLOW_TRACKING_URI: ${{ secrets.MLFLOW_TRACKING_URI }} run: | python scripts/evaluate_model.py - name: Check thresholds run: | python scripts/check_thresholds.py deploy-model: needs: evaluate-model if: github.ref == 'refs/heads/main' runs-on: ubuntu-latest steps: - uses: actions/checkout@v3 - name: Deploy to staging run: | kubectl apply -f k8s/staging/ - name: Run smoke tests run: | python scripts/smoke_test.py - name: Promote to production run: | kubectl apply -f k8s/production/ 5.2 å®Œæ•´MLOpsé¡¹ç›®ç»“æ„ mlops-project/ â”œâ”€â”€ data/ â”‚ â”œâ”€â”€ raw/ # åŸå§‹æ•°æ® â”‚ â”œâ”€â”€ processed/ # å¤„ç†åæ•°æ® â”‚ â””â”€â”€ features/ # ç‰¹å¾æ•°æ® â”œâ”€â”€ models/ â”‚ â”œâ”€â”€ training/ # è®­ç»ƒè„šæœ¬ â”‚ â”‚ â”œâ”€â”€ train.py â”‚ â”‚ â”œâ”€â”€ evaluate.py â”‚ â”‚ â””â”€â”€ tune.py â”‚ â”œâ”€â”€ inference/ # æ¨ç†ä»£ç  â”‚ â”‚ â”œâ”€â”€ predict.py â”‚ â”‚ â””â”€â”€ batch_predict.py â”‚ â””â”€â”€ monitoring/ # ç›‘æ§è„šæœ¬ â”‚ â”œâ”€â”€ drift_detector.py â”‚ â””â”€â”€ performance_monitor.py â”œâ”€â”€ features/ â”‚ â”œâ”€â”€ feature_store.py # ç‰¹å¾å­˜å‚¨ â”‚ â””â”€â”€ feature_registry.py # ç‰¹å¾æ³¨å†Œè¡¨ â”œâ”€â”€ experiments/ â”‚ â””â”€â”€ notebooks/ # å®éªŒç¬”è®°æœ¬ â”œâ”€â”€ tests/ â”‚ â”œâ”€â”€ unit/ â”‚ â”œâ”€â”€ integration/ â”‚ â””â”€â”€ performance/ â”œâ”€â”€ deployment/ â”‚ â”œâ”€â”€ k8s/ # Kubernetesé…ç½® â”‚ â”œâ”€â”€ docker/ # Dockerfile â”‚ â””â”€â”€ terraform/ # åŸºç¡€è®¾æ–½ä»£ç  â”œâ”€â”€ mlflow/ # MLflowé…ç½® â”œâ”€â”€ dvc/ # DVCé…ç½® â”œâ”€â”€ requirements.txt â””â”€â”€ README.md æ€»ç»“ AI/MLç³»ç»Ÿçš„å·¥ç¨‹åŒ–å®è·µéœ€è¦ï¼š\nå®éªŒç®¡ç†ï¼šç³»ç»ŸåŒ–è¿½è¸ªæ¨¡å‹è®­ç»ƒå®éªŒ ç‰¹å¾å·¥ç¨‹ï¼šæ„å»ºå¯å¤ç”¨çš„ç‰¹å¾å­˜å‚¨å’Œç®¡é“ æ¨¡å‹éƒ¨ç½²ï¼šå®ç°å¯é çš„æ¨¡å‹æœåŠ¡åŒ–å’Œç‰ˆæœ¬ç®¡ç† ç›‘æ§å‘Šè­¦ï¼šæŒç»­ç›‘æ§æ¨¡å‹æ€§èƒ½å’Œæ•°æ®æ¼‚ç§» A/Bæµ‹è¯•ï¼šç§‘å­¦åœ°è¯„ä¼°æ¨¡å‹æ”¹è¿›æ•ˆæœ æˆåŠŸçš„MLOpså®è·µä¸ä»…ä»…æ˜¯æŠ€æœ¯é—®é¢˜ï¼Œæ›´éœ€è¦å›¢é˜Ÿåä½œå’Œæµç¨‹ä¼˜åŒ–ã€‚\nç›¸å…³å·¥å…·æ¨è\nJSONæ ¼å¼åŒ–å·¥å…· - JSONæ•°æ®å¤„ç† æ­£åˆ™è¡¨è¾¾å¼æµ‹è¯• - æ–‡æœ¬å¤„ç† Base64ç¼–ç å·¥å…· - æ•°æ®ç¼–ç  ","wordCount":"3812","inLanguage":"zh-cn","datePublished":"2025-12-30T12:00:00+08:00","dateModified":"2025-12-30T12:00:00+08:00","author":{"@type":"Person","name":"æœ‰æ¡å·¥å…·å›¢é˜Ÿ"},"mainEntityOfPage":{"@type":"WebPage","@id":"/blog/articles/ai%E4%B8%8E%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E5%B7%A5%E7%A8%8B%E5%8C%96%E5%AE%9E%E8%B7%B5%E4%BB%8E%E6%A8%A1%E5%9E%8B%E5%88%B0%E7%94%9F%E4%BA%A7%E7%B3%BB%E7%BB%9F%E7%9A%84%E5%AE%8C%E6%95%B4%E6%8C%87%E5%8D%97/"},"publisher":{"@type":"Organization","name":"æŠ€æœ¯åšå®¢ - æœ‰æ¡å·¥å…·","logo":{"@type":"ImageObject","url":"/favicon.ico"}}}</script></head><body id=top><header class=header><nav class=nav><div class=logo><a href=/blog/ accesskey=h title="æŠ€æœ¯åšå®¢ - æœ‰æ¡å·¥å…· (Alt + H)">æŠ€æœ¯åšå®¢ - æœ‰æ¡å·¥å…·</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=/blog/posts/ title="æ‰€æœ‰æ–‡ç« åˆ—è¡¨ - æœ‰æ¡å·¥å…·æŠ€æœ¯åšå®¢ï¼šæŸ¥çœ‹æ‰€æœ‰æŠ€æœ¯æ–‡ç« å’Œæ•™ç¨‹å†…å®¹"><span>æ–‡ç« </span></a></li><li><a href=https://www.util.cn title="æœ‰æ¡å·¥å…· - å¼€å‘è€…çš„å¸¸ç”¨å·¥å…·é›†åˆï¼šæ— å¹¿å‘Š Â· æœ¬åœ°è®¡ç®— Â· å³å¼€å³ç”¨çš„åœ¨çº¿å·¥å…·å¹³å°ï¼Œæä¾›JSONæ ¼å¼åŒ–ã€SQLæ ¼å¼åŒ–ã€Markdownç¼–è¾‘å™¨ç­‰å®ç”¨å·¥å…·"><span>æœ‰æ¡å·¥å…·</span>&nbsp;
<svg fill="none" shape-rendering="geometricPrecision" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" height="12" width="12"><path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"/><path d="M15 3h6v6"/><path d="M10 14 21 3"/></svg></a></li><li><a href=/blog/categories/ title="æ–‡ç« åˆ†ç±» - æœ‰æ¡å·¥å…·æŠ€æœ¯åšå®¢ï¼šæŒ‰æŠ€æœ¯é¢†åŸŸåˆ†ç±»çš„ä¼˜è´¨æ–‡ç« ï¼ŒåŒ…æ‹¬å‰ç«¯å¼€å‘ã€å·¥å…·ä½¿ç”¨ã€ç¼–ç¨‹æŠ€å·§ç­‰"><span>åˆ†ç±»</span></a></li><li><a href=/blog/tags/ title="æ ‡ç­¾äº‘ - æœ‰æ¡å·¥å…·æŠ€æœ¯åšå®¢ï¼šé€šè¿‡æ ‡ç­¾å¿«é€Ÿæ‰¾åˆ°æ„Ÿå…´è¶£çš„æŠ€æœ¯æ–‡ç« å’Œæ•™ç¨‹å†…å®¹"><span>æ ‡ç­¾</span></a></li><li><a href=/blog/archives/ title="æ–‡ç« å½’æ¡£ - æœ‰æ¡å·¥å…·æŠ€æœ¯åšå®¢ï¼šæŒ‰æ—¶é—´æŸ¥çœ‹å†å²æ–‡ç« "><span>å½’æ¡£</span></a></li><li><a href=/blog/search/ title="æœç´¢æ–‡ç«  - æœ‰æ¡å·¥å…·æŠ€æœ¯åšå®¢ï¼šé€šè¿‡å…³é”®è¯æœç´¢æ‰¾åˆ°æ„Ÿå…´è¶£çš„æŠ€æœ¯æ–‡ç« å’Œæ•™ç¨‹å†…å®¹ï¼Œæ”¯æŒæ ‡é¢˜ã€å†…å®¹ã€åˆ†ç±»å’Œæ ‡ç­¾æœç´¢"><span>æœç´¢</span></a></li></ul></nav></header><main class=main><article class=post-single><div class=post-content-wrapper><main class=post-content-main><header class=post-header-main><h1 class="post-title entry-hint-parent">AIä¸æœºå™¨å­¦ä¹ å·¥ç¨‹åŒ–å®è·µï¼šä»æ¨¡å‹åˆ°ç”Ÿäº§ç³»ç»Ÿçš„å®Œæ•´æŒ‡å—</h1><div class=post-description>æ·±å…¥æ¢è®¨AI/MLç³»ç»Ÿçš„å·¥ç¨‹åŒ–å®è·µï¼Œæ¶µç›–æ¨¡å‹éƒ¨ç½²ã€MLOpsã€ç‰¹å¾å·¥ç¨‹ã€æ¨¡å‹ç›‘æ§ã€A/Bæµ‹è¯•ç­‰æ ¸å¿ƒä¸»é¢˜ï¼Œå¸®åŠ©å·¥ç¨‹å¸ˆæ„å»ºå¯æ‰©å±•çš„ç”Ÿäº§çº§AIç³»ç»Ÿã€‚</div><div class=post-meta><div class=post-meta-content><div class=post-categories-inline><a href=/blog/categories/ai%E5%BC%80%E5%8F%91/ class=category-link>AIå¼€å‘</a><a href=/blog/categories/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/ class=category-link>æœºå™¨å­¦ä¹ </a></div><span class=post-date>2025-12-30</span><span class=post-author>æœ‰æ¡å·¥å…·å›¢é˜Ÿ</span></div><style>.post-meta-content{display:flex;align-items:center;flex-wrap:wrap;gap:.75rem;font-family:sf mono,monaco,courier new,monospace;font-size:.875rem;color:#9ca3af !important}.post-categories-inline{display:inline-flex;align-items:center;gap:.5rem}.category-link{display:inline-flex;align-items:center;gap:.25rem;padding:.25rem .75rem;background:rgba(255,255,255,.1);color:#e5e7eb !important;text-decoration:none;font-size:.75rem;font-weight:600;text-transform:uppercase;letter-spacing:.05em;border:1px solid rgba(255,255,255,.2);border-radius:0;transition:all .3s ease;white-space:nowrap}.category-link:hover{background:rgba(255,255,255,.2);color:#fff !important;border-color:rgba(255,255,255,.3);transform:translateY(-1px)}.category-link::before{content:'ğŸ“';font-size:.7rem;opacity:.8}.post-date,.post-reading-time,.post-word-count,.post-author{color:#9ca3af !important}[data-theme=dark] .post-meta-content{color:#9ca3af !important}[data-theme=dark] .category-link{background:rgba(255,255,255,.1);color:#e5e7eb !important;border-color:rgba(255,255,255,.2)}[data-theme=dark] .category-link:hover{background:rgba(255,255,255,.2);color:#fff !important;border-color:rgba(255,255,255,.3)}[data-theme=dark] .post-date,[data-theme=dark] .post-reading-time,[data-theme=dark] .post-word-count,[data-theme=dark] .post-author{color:#9ca3af !important}[data-theme=light] .post-meta-content{color:#6c757d !important}[data-theme=light] .category-link{background:rgba(0,0,0,5%);color:#495057 !important;border-color:rgba(0,0,0,.15)}[data-theme=light] .category-link:hover{background:rgba(0,102,204,.1);color:#212529 !important;border-color:rgba(0,102,204,.3)}[data-theme=light] .post-date,[data-theme=light] .post-reading-time,[data-theme=light] .post-word-count,[data-theme=light] .post-author{color:#6c757d !important}@media(max-width:768px){.post-meta-content{gap:.5rem;font-size:.8rem}.category-link{padding:.2rem .6rem;font-size:.7rem}}</style></div></header><div class=post-content><h2 id=å¼•è¨€>å¼•è¨€<a hidden class=anchor aria-hidden=true href=#å¼•è¨€>#</a></h2><p>å°†AI/MLæ¨¡å‹ä»ç ”ç©¶ç¯å¢ƒæ¨å‘ç”Ÿäº§ç¯å¢ƒæ˜¯ä¸€é¡¹å¤æ‚çš„å·¥ç¨‹æŒ‘æˆ˜ã€‚é™¤äº†æ¨¡å‹æœ¬èº«çš„å‡†ç¡®æ€§ï¼Œè¿˜éœ€è¦è€ƒè™‘å¯æ‰©å±•æ€§ã€å¯é æ€§ã€å¯ç»´æŠ¤æ€§ç­‰å¤šä¸ªæ–¹é¢ã€‚æœ¬æ–‡å°†æ·±å…¥æ¢è®¨AI/MLç³»ç»Ÿçš„å·¥ç¨‹åŒ–å®è·µï¼Œå¸®åŠ©å›¢é˜Ÿæ„å»ºç¨³å®šé«˜æ•ˆçš„ç”Ÿäº§çº§AIç³»ç»Ÿã€‚</p><h2 id=ä¸€mlopsæ¦‚è¿°>ä¸€ã€MLOpsæ¦‚è¿°<a hidden class=anchor aria-hidden=true href=#ä¸€mlopsæ¦‚è¿°>#</a></h2><h3 id=11-mlopsçš„æ ¸å¿ƒç»„ä»¶>1.1 MLOpsçš„æ ¸å¿ƒç»„ä»¶<a hidden class=anchor aria-hidden=true href=#11-mlopsçš„æ ¸å¿ƒç»„ä»¶>#</a></h3><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">56
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">57
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">58
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">59
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">60
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">61
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">62
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">63
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">64
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">65
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#8b949e;font-style:italic># ========== MLOpsæ¶æ„æ¦‚è§ˆ ==========</span>
</span></span><span style=display:flex><span><span style=color:#a5d6ff>&#34;&#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>                    â”‚   æ•°æ®å±‚        â”‚
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>                    â”‚ - åŸå§‹æ•°æ®      â”‚
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>                    â”‚ - ç‰¹å¾å­˜å‚¨      â”‚
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>                    â”‚ - è®­ç»ƒæ•°æ®      â”‚
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>                             â”‚
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>                    â”‚   è®­ç»ƒå±‚        â”‚
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>                    â”‚ - ç‰¹å¾å·¥ç¨‹      â”‚
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>                    â”‚ - æ¨¡å‹è®­ç»ƒ      â”‚
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>                    â”‚ - è¶…å‚æ•°è°ƒä¼˜    â”‚
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>                             â”‚
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>                    â”‚   è¯„ä¼°å±‚        â”‚
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>                    â”‚ - æ¨¡å‹è¯„ä¼°      â”‚
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>                    â”‚ - A/Bæµ‹è¯•       â”‚
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>                    â”‚ - æ¨¡å‹éªŒè¯      â”‚
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>                             â”‚
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>                    â”‚   éƒ¨ç½²å±‚        â”‚
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>                    â”‚ - æ¨¡å‹æœåŠ¡      â”‚
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>                    â”‚ - æ‰¹é‡æ¨ç†      â”‚
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>                    â”‚ - è¾¹ç¼˜éƒ¨ç½²      â”‚
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>                             â”‚
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>                    â”‚   ç›‘æ§å±‚        â”‚
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>                    â”‚ - æ€§èƒ½ç›‘æ§      â”‚
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>                    â”‚ - æ•°æ®æ¼‚ç§»æ£€æµ‹  â”‚
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>                    â”‚ - å‘Šè­¦ç³»ç»Ÿ      â”‚
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic># MLOpså„é˜¶æ®µçš„å…³é”®ä»»åŠ¡</span>
</span></span><span style=display:flex><span>MLOPS_PIPELINE <span style=color:#ff7b72;font-weight:700>=</span> {
</span></span><span style=display:flex><span>    <span style=color:#a5d6ff>&#34;data&#34;</span>: {
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;ingestion&#34;</span>: <span style=color:#a5d6ff>&#34;æ•°æ®é‡‡é›†ä¸æ¸…æ´—&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;validation&#34;</span>: <span style=color:#a5d6ff>&#34;æ•°æ®è´¨é‡æ£€æŸ¥&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;feature_engineering&#34;</span>: <span style=color:#a5d6ff>&#34;ç‰¹å¾æå–ä¸è½¬æ¢&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;feature_store&#34;</span>: <span style=color:#a5d6ff>&#34;ç‰¹å¾å­˜å‚¨ä¸ç‰ˆæœ¬ç®¡ç†&#34;</span>
</span></span><span style=display:flex><span>    },
</span></span><span style=display:flex><span>    <span style=color:#a5d6ff>&#34;training&#34;</span>: {
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;experiment_tracking&#34;</span>: <span style=color:#a5d6ff>&#34;å®éªŒè¿½è¸ª&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;hyperparameter_tuning&#34;</span>: <span style=color:#a5d6ff>&#34;è¶…å‚æ•°ä¼˜åŒ–&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;model_training&#34;</span>: <span style=color:#a5d6ff>&#34;æ¨¡å‹è®­ç»ƒ&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;model_evaluation&#34;</span>: <span style=color:#a5d6ff>&#34;æ¨¡å‹è¯„ä¼°&#34;</span>
</span></span><span style=display:flex><span>    },
</span></span><span style=display:flex><span>    <span style=color:#a5d6ff>&#34;deployment&#34;</span>: {
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;model_serving&#34;</span>: <span style=color:#a5d6ff>&#34;æ¨¡å‹æœåŠ¡åŒ–&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;canary_deployment&#34;</span>: <span style=color:#a5d6ff>&#34;é‡‘ä¸é›€éƒ¨ç½²&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;model_versioning&#34;</span>: <span style=color:#a5d6ff>&#34;æ¨¡å‹ç‰ˆæœ¬ç®¡ç†&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;rollback&#34;</span>: <span style=color:#a5d6ff>&#34;å›æ»šæœºåˆ¶&#34;</span>
</span></span><span style=display:flex><span>    },
</span></span><span style=display:flex><span>    <span style=color:#a5d6ff>&#34;monitoring&#34;</span>: {
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;performance_monitoring&#34;</span>: <span style=color:#a5d6ff>&#34;æ€§èƒ½ç›‘æ§&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;data_drift_detection&#34;</span>: <span style=color:#a5d6ff>&#34;æ•°æ®æ¼‚ç§»æ£€æµ‹&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;model_explainability&#34;</span>: <span style=color:#a5d6ff>&#34;æ¨¡å‹å¯è§£é‡Šæ€§&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;alerting&#34;</span>: <span style=color:#a5d6ff>&#34;å‘Šè­¦ç³»ç»Ÿ&#34;</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div><h3 id=12-å®éªŒç®¡ç†ä¸è¿½è¸ª>1.2 å®éªŒç®¡ç†ä¸è¿½è¸ª<a hidden class=anchor aria-hidden=true href=#12-å®éªŒç®¡ç†ä¸è¿½è¸ª>#</a></h3><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 56
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 57
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 58
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 59
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 60
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 61
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 62
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 63
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 64
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 65
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 66
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 67
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 68
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 69
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 70
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 71
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 72
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 73
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 74
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 75
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 76
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 77
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 78
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 79
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 80
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 81
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 82
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 83
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 84
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 85
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 86
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 87
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 88
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 89
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 90
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 91
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 92
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 93
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 94
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 95
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 96
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 97
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 98
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 99
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">100
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">101
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">102
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">103
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">104
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">105
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">106
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">107
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">108
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">109
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">110
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">111
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">112
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">113
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">114
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">115
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">116
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">117
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">118
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">119
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">120
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">121
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">122
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">123
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">124
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">125
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">126
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">127
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">128
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">129
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">130
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">131
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">132
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">133
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">134
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">135
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">136
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">137
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">138
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">139
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">140
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">141
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">142
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">143
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">144
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">145
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">146
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">147
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">148
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#8b949e;font-style:italic># ========== å®éªŒè¿½è¸ªç³»ç»Ÿ ==========</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>import</span> <span style=color:#ff7b72>mlflow</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>import</span> <span style=color:#ff7b72>mlflow.sklearn</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>from</span> <span style=color:#ff7b72>datetime</span> <span style=color:#ff7b72>import</span> datetime
</span></span><span style=display:flex><span><span style=color:#ff7b72>from</span> <span style=color:#ff7b72>typing</span> <span style=color:#ff7b72>import</span> Any, Dict, Optional
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>class</span> <span style=color:#f0883e;font-weight:700>ExperimentTracker</span>:
</span></span><span style=display:flex><span>    <span style=color:#a5d6ff>&#34;&#34;&#34;å®éªŒè¿½è¸ªå™¨&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>__init__</span>(self, tracking_uri: str, experiment_name: str):
</span></span><span style=display:flex><span>        mlflow<span style=color:#ff7b72;font-weight:700>.</span>set_tracking_uri(tracking_uri)
</span></span><span style=display:flex><span>        mlflow<span style=color:#ff7b72;font-weight:700>.</span>set_experiment(experiment_name)
</span></span><span style=display:flex><span>        self<span style=color:#ff7b72;font-weight:700>.</span>experiment_name <span style=color:#ff7b72;font-weight:700>=</span> experiment_name
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>start_run</span>(self, run_name: Optional[str] <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#79c0ff>None</span>):
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;&#34;&#34;å¼€å§‹ä¸€æ¬¡è¿è¡Œ&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>        self<span style=color:#ff7b72;font-weight:700>.</span>run <span style=color:#ff7b72;font-weight:700>=</span> mlflow<span style=color:#ff7b72;font-weight:700>.</span>start_run(run_name<span style=color:#ff7b72;font-weight:700>=</span>run_name)
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>return</span> self<span style=color:#ff7b72;font-weight:700>.</span>run
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>log_params</span>(self, params: Dict[str, Any]):
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;&#34;&#34;è®°å½•å‚æ•°&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>        mlflow<span style=color:#ff7b72;font-weight:700>.</span>log_params(params)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>log_metrics</span>(self, metrics: Dict[str, float], step: Optional[int] <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#79c0ff>None</span>):
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;&#34;&#34;è®°å½•æŒ‡æ ‡&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>        mlflow<span style=color:#ff7b72;font-weight:700>.</span>log_metrics(metrics, step<span style=color:#ff7b72;font-weight:700>=</span>step)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>log_model</span>(self, model: Any, artifact_path: str <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>&#34;model&#34;</span>):
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;&#34;&#34;è®°å½•æ¨¡å‹&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>        mlflow<span style=color:#ff7b72;font-weight:700>.</span>sklearn<span style=color:#ff7b72;font-weight:700>.</span>log_model(model, artifact_path)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>log_artifact</span>(self, file_path: str):
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;&#34;&#34;è®°å½•æ–‡ä»¶&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>        mlflow<span style=color:#ff7b72;font-weight:700>.</span>log_artifact(file_path)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>log_figure</span>(self, figure, artifact_file: str):
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;&#34;&#34;è®°å½•å›¾è¡¨&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>        mlflow<span style=color:#ff7b72;font-weight:700>.</span>log_figure(figure, artifact_file)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>end_run</span>(self, status: str <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>&#34;FINISHED&#34;</span>):
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;&#34;&#34;ç»“æŸè¿è¡Œ&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>        mlflow<span style=color:#ff7b72;font-weight:700>.</span>end_run(status<span style=color:#ff7b72;font-weight:700>=</span>status)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic># ä½¿ç”¨ç¤ºä¾‹</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>train_model_with_tracking</span>(X_train, y_train, X_test, y_test, params):
</span></span><span style=display:flex><span>    <span style=color:#a5d6ff>&#34;&#34;&#34;è®­ç»ƒæ¨¡å‹å¹¶è¿½è¸ªå®éªŒ&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    tracker <span style=color:#ff7b72;font-weight:700>=</span> ExperimentTracker(
</span></span><span style=display:flex><span>        tracking_uri<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>&#34;http://mlflow-server:5000&#34;</span>,
</span></span><span style=display:flex><span>        experiment_name<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>&#34;fraud-detection&#34;</span>
</span></span><span style=display:flex><span>    )
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    tracker<span style=color:#ff7b72;font-weight:700>.</span>start_run(run_name<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#79c0ff>f</span><span style=color:#a5d6ff>&#34;experiment-</span><span style=color:#a5d6ff>{</span>datetime<span style=color:#ff7b72;font-weight:700>.</span>now()<span style=color:#ff7b72;font-weight:700>.</span>strftime(<span style=color:#a5d6ff>&#39;%Y%m</span><span style=color:#a5d6ff>%d</span><span style=color:#a5d6ff>-%H%M%S&#39;</span>)<span style=color:#a5d6ff>}</span><span style=color:#a5d6ff>&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>try</span>:
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># è®°å½•å‚æ•°</span>
</span></span><span style=display:flex><span>        tracker<span style=color:#ff7b72;font-weight:700>.</span>log_params(params)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># è®­ç»ƒæ¨¡å‹</span>
</span></span><span style=display:flex><span>        model <span style=color:#ff7b72;font-weight:700>=</span> train_model(X_train, y_train, params)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># è¯„ä¼°æ¨¡å‹</span>
</span></span><span style=display:flex><span>        metrics <span style=color:#ff7b72;font-weight:700>=</span> evaluate_model(model, X_test, y_test)
</span></span><span style=display:flex><span>        tracker<span style=color:#ff7b72;font-weight:700>.</span>log_metrics(metrics)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># è®°å½•æ¨¡å‹</span>
</span></span><span style=display:flex><span>        tracker<span style=color:#ff7b72;font-weight:700>.</span>log_model(model)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># è®°å½•å­¦ä¹ æ›²çº¿</span>
</span></span><span style=display:flex><span>        fig <span style=color:#ff7b72;font-weight:700>=</span> plot_learning_curve(model, X_train, y_train)
</span></span><span style=display:flex><span>        tracker<span style=color:#ff7b72;font-weight:700>.</span>log_figure(fig, <span style=color:#a5d6ff>&#34;learning_curve.png&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># è®°å½•ç‰¹å¾é‡è¦æ€§</span>
</span></span><span style=display:flex><span>        fig <span style=color:#ff7b72;font-weight:700>=</span> plot_feature_importance(model)
</span></span><span style=display:flex><span>        tracker<span style=color:#ff7b72;font-weight:700>.</span>log_figure(fig, <span style=color:#a5d6ff>&#34;feature_importance.png&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        tracker<span style=color:#ff7b72;font-weight:700>.</span>end_run(status<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>&#34;FINISHED&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>return</span> model, metrics
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>except</span> <span style=color:#f0883e;font-weight:700>Exception</span> <span style=color:#ff7b72>as</span> e:
</span></span><span style=display:flex><span>        tracker<span style=color:#ff7b72;font-weight:700>.</span>end_run(status<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>&#34;FAILED&#34;</span>)
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>raise</span> e
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic># ========== è¶…å‚æ•°ä¼˜åŒ– ==========</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>import</span> <span style=color:#ff7b72>optuna</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>from</span> <span style=color:#ff7b72>optuna.integration.mlflow</span> <span style=color:#ff7b72>import</span> MLflowCallback
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>class</span> <span style=color:#f0883e;font-weight:700>HyperparameterOptimizer</span>:
</span></span><span style=display:flex><span>    <span style=color:#a5d6ff>&#34;&#34;&#34;è¶…å‚æ•°ä¼˜åŒ–å™¨&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>__init__</span>(self, n_trials: int <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>100</span>, timeout: Optional[int] <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#79c0ff>None</span>):
</span></span><span style=display:flex><span>        self<span style=color:#ff7b72;font-weight:700>.</span>n_trials <span style=color:#ff7b72;font-weight:700>=</span> n_trials
</span></span><span style=display:flex><span>        self<span style=color:#ff7b72;font-weight:700>.</span>timeout <span style=color:#ff7b72;font-weight:700>=</span> timeout
</span></span><span style=display:flex><span>        self<span style=color:#ff7b72;font-weight:700>.</span>study <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#79c0ff>None</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>objective</span>(self, trial, X_train, y_train, X_val, y_val):
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;&#34;&#34;ä¼˜åŒ–ç›®æ ‡å‡½æ•°&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># å®šä¹‰æœç´¢ç©ºé—´</span>
</span></span><span style=display:flex><span>        params <span style=color:#ff7b72;font-weight:700>=</span> {
</span></span><span style=display:flex><span>            <span style=color:#a5d6ff>&#39;n_estimators&#39;</span>: trial<span style=color:#ff7b72;font-weight:700>.</span>suggest_int(<span style=color:#a5d6ff>&#39;n_estimators&#39;</span>, <span style=color:#a5d6ff>50</span>, <span style=color:#a5d6ff>500</span>),
</span></span><span style=display:flex><span>            <span style=color:#a5d6ff>&#39;max_depth&#39;</span>: trial<span style=color:#ff7b72;font-weight:700>.</span>suggest_int(<span style=color:#a5d6ff>&#39;max_depth&#39;</span>, <span style=color:#a5d6ff>3</span>, <span style=color:#a5d6ff>20</span>),
</span></span><span style=display:flex><span>            <span style=color:#a5d6ff>&#39;learning_rate&#39;</span>: trial<span style=color:#ff7b72;font-weight:700>.</span>suggest_float(<span style=color:#a5d6ff>&#39;learning_rate&#39;</span>, <span style=color:#a5d6ff>0.001</span>, <span style=color:#a5d6ff>0.3</span>, log<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#79c0ff>True</span>),
</span></span><span style=display:flex><span>            <span style=color:#a5d6ff>&#39;subsample&#39;</span>: trial<span style=color:#ff7b72;font-weight:700>.</span>suggest_float(<span style=color:#a5d6ff>&#39;subsample&#39;</span>, <span style=color:#a5d6ff>0.5</span>, <span style=color:#a5d6ff>1.0</span>),
</span></span><span style=display:flex><span>            <span style=color:#a5d6ff>&#39;colsample_bytree&#39;</span>: trial<span style=color:#ff7b72;font-weight:700>.</span>suggest_float(<span style=color:#a5d6ff>&#39;colsample_bytree&#39;</span>, <span style=color:#a5d6ff>0.5</span>, <span style=color:#a5d6ff>1.0</span>),
</span></span><span style=display:flex><span>            <span style=color:#a5d6ff>&#39;min_child_weight&#39;</span>: trial<span style=color:#ff7b72;font-weight:700>.</span>suggest_int(<span style=color:#a5d6ff>&#39;min_child_weight&#39;</span>, <span style=color:#a5d6ff>1</span>, <span style=color:#a5d6ff>10</span>),
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># è®­ç»ƒæ¨¡å‹</span>
</span></span><span style=display:flex><span>        model <span style=color:#ff7b72;font-weight:700>=</span> train_model(X_train, y_train, params)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># è¯„ä¼°</span>
</span></span><span style=display:flex><span>        predictions <span style=color:#ff7b72;font-weight:700>=</span> model<span style=color:#ff7b72;font-weight:700>.</span>predict(X_val)
</span></span><span style=display:flex><span>        score <span style=color:#ff7b72;font-weight:700>=</span> calculate_metric(y_val, predictions)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>return</span> score
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>optimize</span>(self, X_train, y_train, X_val, y_val):
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;&#34;&#34;æ‰§è¡Œè¶…å‚æ•°ä¼˜åŒ–&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># åˆ›å»ºç ”ç©¶å¯¹è±¡</span>
</span></span><span style=display:flex><span>        self<span style=color:#ff7b72;font-weight:700>.</span>study <span style=color:#ff7b72;font-weight:700>=</span> optuna<span style=color:#ff7b72;font-weight:700>.</span>create_study(
</span></span><span style=display:flex><span>            direction<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>&#34;maximize&#34;</span>,
</span></span><span style=display:flex><span>            study_name<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>&#34;hyperparameter-optimization&#34;</span>
</span></span><span style=display:flex><span>        )
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># æ·»åŠ MLflowå›è°ƒ</span>
</span></span><span style=display:flex><span>        mlflc <span style=color:#ff7b72;font-weight:700>=</span> MLflowCallback(
</span></span><span style=display:flex><span>            tracking_uri<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>&#34;http://mlflow-server:5000&#34;</span>,
</span></span><span style=display:flex><span>            metric_name<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>&#34;validation_score&#34;</span>
</span></span><span style=display:flex><span>        )
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># æ‰§è¡Œä¼˜åŒ–</span>
</span></span><span style=display:flex><span>        self<span style=color:#ff7b72;font-weight:700>.</span>study<span style=color:#ff7b72;font-weight:700>.</span>optimize(
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>lambda</span> trial: self<span style=color:#ff7b72;font-weight:700>.</span>objective(trial, X_train, y_train, X_val, y_val),
</span></span><span style=display:flex><span>            n_trials<span style=color:#ff7b72;font-weight:700>=</span>self<span style=color:#ff7b72;font-weight:700>.</span>n_trials,
</span></span><span style=display:flex><span>            timeout<span style=color:#ff7b72;font-weight:700>=</span>self<span style=color:#ff7b72;font-weight:700>.</span>timeout,
</span></span><span style=display:flex><span>            callbacks<span style=color:#ff7b72;font-weight:700>=</span>[mlflc]
</span></span><span style=display:flex><span>        )
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>return</span> self<span style=color:#ff7b72;font-weight:700>.</span>study<span style=color:#ff7b72;font-weight:700>.</span>best_params, self<span style=color:#ff7b72;font-weight:700>.</span>study<span style=color:#ff7b72;font-weight:700>.</span>best_value
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>get_importance</span>(self):
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;&#34;&#34;è·å–è¶…å‚æ•°é‡è¦æ€§&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>return</span> optuna<span style=color:#ff7b72;font-weight:700>.</span>importance<span style=color:#ff7b72;font-weight:700>.</span>get_param_importances(self<span style=color:#ff7b72;font-weight:700>.</span>study)
</span></span></code></pre></td></tr></table></div></div><h2 id=äºŒç‰¹å¾å·¥ç¨‹ä¸ç®¡ç†>äºŒã€ç‰¹å¾å·¥ç¨‹ä¸ç®¡ç†<a hidden class=anchor aria-hidden=true href=#äºŒç‰¹å¾å·¥ç¨‹ä¸ç®¡ç†>#</a></h2><h3 id=21-ç‰¹å¾å­˜å‚¨æ¶æ„>2.1 ç‰¹å¾å­˜å‚¨æ¶æ„<a hidden class=anchor aria-hidden=true href=#21-ç‰¹å¾å­˜å‚¨æ¶æ„>#</a></h3><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 56
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 57
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 58
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 59
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 60
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 61
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 62
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 63
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 64
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 65
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 66
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 67
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 68
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 69
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 70
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 71
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 72
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 73
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 74
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 75
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 76
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 77
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 78
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 79
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 80
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 81
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 82
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 83
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 84
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 85
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 86
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 87
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 88
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 89
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 90
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 91
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 92
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 93
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 94
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 95
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 96
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 97
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 98
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 99
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">100
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">101
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">102
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">103
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">104
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">105
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">106
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">107
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">108
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">109
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">110
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">111
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">112
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">113
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">114
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">115
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">116
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">117
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">118
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">119
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">120
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">121
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">122
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">123
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">124
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">125
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">126
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">127
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">128
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">129
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">130
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">131
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">132
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">133
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">134
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">135
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">136
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">137
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">138
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">139
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">140
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">141
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">142
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">143
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">144
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">145
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">146
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">147
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">148
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">149
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">150
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">151
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">152
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">153
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">154
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">155
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">156
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">157
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">158
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">159
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">160
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">161
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">162
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">163
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">164
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">165
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">166
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">167
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">168
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">169
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">170
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">171
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">172
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">173
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">174
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">175
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">176
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">177
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">178
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">179
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">180
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">181
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">182
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#8b949e;font-style:italic># ========== ç‰¹å¾å­˜å‚¨ç³»ç»Ÿ ==========</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>from</span> <span style=color:#ff7b72>abc</span> <span style=color:#ff7b72>import</span> ABC, abstractmethod
</span></span><span style=display:flex><span><span style=color:#ff7b72>from</span> <span style=color:#ff7b72>typing</span> <span style=color:#ff7b72>import</span> List, Dict, Any
</span></span><span style=display:flex><span><span style=color:#ff7b72>import</span> <span style=color:#ff7b72>pandas</span> <span style=color:#ff7b72>as</span> <span style=color:#ff7b72>pd</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>from</span> <span style=color:#ff7b72>datetime</span> <span style=color:#ff7b72>import</span> datetime, timedelta
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>class</span> <span style=color:#f0883e;font-weight:700>FeatureStore</span>(ABC):
</span></span><span style=display:flex><span>    <span style=color:#a5d6ff>&#34;&#34;&#34;ç‰¹å¾å­˜å‚¨æŠ½è±¡ç±»&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#d2a8ff;font-weight:700>@abstractmethod</span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>get_features</span>(self, entity_ids: List[str], feature_names: List[str]) <span style=color:#ff7b72;font-weight:700>-&gt;</span> pd<span style=color:#ff7b72;font-weight:700>.</span>DataFrame:
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;&#34;&#34;è·å–ç‰¹å¾&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>pass</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#d2a8ff;font-weight:700>@abstractmethod</span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>write_features</span>(self, entity_id: str, features: Dict[str, Any]):
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;&#34;&#34;å†™å…¥ç‰¹å¾&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>pass</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>class</span> <span style=color:#f0883e;font-weight:700>OfflineFeatureStore</span>(FeatureStore):
</span></span><span style=display:flex><span>    <span style=color:#a5d6ff>&#34;&#34;&#34;ç¦»çº¿ç‰¹å¾å­˜å‚¨ - ç”¨äºè®­ç»ƒ&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>__init__</span>(self, storage_path: str):
</span></span><span style=display:flex><span>        self<span style=color:#ff7b72;font-weight:700>.</span>storage_path <span style=color:#ff7b72;font-weight:700>=</span> storage_path
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>get_features</span>(self, entity_ids: List[str], feature_names: List[str]) <span style=color:#ff7b72;font-weight:700>-&gt;</span> pd<span style=color:#ff7b72;font-weight:700>.</span>DataFrame:
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;&#34;&#34;ä»å­˜å‚¨è·å–ç‰¹å¾&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># ä»Parquetæ–‡ä»¶è¯»å–</span>
</span></span><span style=display:flex><span>        df <span style=color:#ff7b72;font-weight:700>=</span> pd<span style=color:#ff7b72;font-weight:700>.</span>read_parquet(<span style=color:#79c0ff>f</span><span style=color:#a5d6ff>&#34;</span><span style=color:#a5d6ff>{</span>self<span style=color:#ff7b72;font-weight:700>.</span>storage_path<span style=color:#a5d6ff>}</span><span style=color:#a5d6ff>/features.parquet&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># è¿‡æ»¤å®ä½“</span>
</span></span><span style=display:flex><span>        df <span style=color:#ff7b72;font-weight:700>=</span> df[df[<span style=color:#a5d6ff>&#39;entity_id&#39;</span>]<span style=color:#ff7b72;font-weight:700>.</span>isin(entity_ids)]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># é€‰æ‹©ç‰¹å¾åˆ—</span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>return</span> df[[<span style=color:#a5d6ff>&#39;entity_id&#39;</span>] <span style=color:#ff7b72;font-weight:700>+</span> feature_names]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>write_features</span>(self, entity_id: str, features: Dict[str, Any]):
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;&#34;&#34;å†™å…¥ç‰¹å¾åˆ°å­˜å‚¨&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># å®ç°å†™å…¥é€»è¾‘</span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>pass</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>create_training_set</span>(
</span></span><span style=display:flex><span>        self,
</span></span><span style=display:flex><span>        entity_ids: List[str],
</span></span><span style=display:flex><span>        feature_names: List[str],
</span></span><span style=display:flex><span>        label_name: str
</span></span><span style=display:flex><span>    ) <span style=color:#ff7b72;font-weight:700>-&gt;</span> pd<span style=color:#ff7b72;font-weight:700>.</span>DataFrame:
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;&#34;&#34;åˆ›å»ºè®­ç»ƒæ•°æ®é›†&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>        df <span style=color:#ff7b72;font-weight:700>=</span> self<span style=color:#ff7b72;font-weight:700>.</span>get_features(entity_ids, feature_names <span style=color:#ff7b72;font-weight:700>+</span> [label_name])
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>return</span> df
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>class</span> <span style=color:#f0883e;font-weight:700>OnlineFeatureStore</span>(FeatureStore):
</span></span><span style=display:flex><span>    <span style=color:#a5d6ff>&#34;&#34;&#34;åœ¨çº¿ç‰¹å¾å­˜å‚¨ - ç”¨äºæ¨ç†&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>__init__</span>(self, redis_client):
</span></span><span style=display:flex><span>        self<span style=color:#ff7b72;font-weight:700>.</span>redis <span style=color:#ff7b72;font-weight:700>=</span> redis_client
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>get_features</span>(self, entity_ids: List[str], feature_names: List[str]) <span style=color:#ff7b72;font-weight:700>-&gt;</span> pd<span style=color:#ff7b72;font-weight:700>.</span>DataFrame:
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;&#34;&#34;ä»Redisè·å–å®æ—¶ç‰¹å¾&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>        features <span style=color:#ff7b72;font-weight:700>=</span> []
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>for</span> entity_id <span style=color:#ff7b72;font-weight:700>in</span> entity_ids:
</span></span><span style=display:flex><span>            key <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#79c0ff>f</span><span style=color:#a5d6ff>&#34;feature:</span><span style=color:#a5d6ff>{</span>entity_id<span style=color:#a5d6ff>}</span><span style=color:#a5d6ff>&#34;</span>
</span></span><span style=display:flex><span>            data <span style=color:#ff7b72;font-weight:700>=</span> self<span style=color:#ff7b72;font-weight:700>.</span>redis<span style=color:#ff7b72;font-weight:700>.</span>hgetall(key)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            feature_dict <span style=color:#ff7b72;font-weight:700>=</span> {
</span></span><span style=display:flex><span>                <span style=color:#a5d6ff>&#39;entity_id&#39;</span>: entity_id
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>for</span> feature_name <span style=color:#ff7b72;font-weight:700>in</span> feature_names:
</span></span><span style=display:flex><span>                feature_dict[feature_name] <span style=color:#ff7b72;font-weight:700>=</span> data<span style=color:#ff7b72;font-weight:700>.</span>get(feature_name)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            features<span style=color:#ff7b72;font-weight:700>.</span>append(feature_dict)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>return</span> pd<span style=color:#ff7b72;font-weight:700>.</span>DataFrame(features)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>write_features</span>(self, entity_id: str, features: Dict[str, Any]):
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;&#34;&#34;å†™å…¥ç‰¹å¾åˆ°Redis&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>        key <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#79c0ff>f</span><span style=color:#a5d6ff>&#34;feature:</span><span style=color:#a5d6ff>{</span>entity_id<span style=color:#a5d6ff>}</span><span style=color:#a5d6ff>&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># æ·»åŠ æ—¶é—´æˆ³</span>
</span></span><span style=display:flex><span>        features[<span style=color:#a5d6ff>&#39;updated_at&#39;</span>] <span style=color:#ff7b72;font-weight:700>=</span> datetime<span style=color:#ff7b72;font-weight:700>.</span>now()<span style=color:#ff7b72;font-weight:700>.</span>isoformat()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        self<span style=color:#ff7b72;font-weight:700>.</span>redis<span style=color:#ff7b72;font-weight:700>.</span>hset(key, mapping<span style=color:#ff7b72;font-weight:700>=</span>features)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># è®¾ç½®è¿‡æœŸæ—¶é—´</span>
</span></span><span style=display:flex><span>        self<span style=color:#ff7b72;font-weight:700>.</span>redis<span style=color:#ff7b72;font-weight:700>.</span>expire(key, timedelta(days<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>7</span>))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>class</span> <span style=color:#f0883e;font-weight:700>FeatureEngineeringPipeline</span>:
</span></span><span style=display:flex><span>    <span style=color:#a5d6ff>&#34;&#34;&#34;ç‰¹å¾å·¥ç¨‹ç®¡é“&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>__init__</span>(self, config: Dict[str, Any]):
</span></span><span style=display:flex><span>        self<span style=color:#ff7b72;font-weight:700>.</span>config <span style=color:#ff7b72;font-weight:700>=</span> config
</span></span><span style=display:flex><span>        self<span style=color:#ff7b72;font-weight:700>.</span>transformers <span style=color:#ff7b72;font-weight:700>=</span> {}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>fit</span>(self, df: pd<span style=color:#ff7b72;font-weight:700>.</span>DataFrame):
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;&#34;&#34;æ‹Ÿåˆå˜æ¢å™¨&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>for</span> feature_config <span style=color:#ff7b72;font-weight:700>in</span> self<span style=color:#ff7b72;font-weight:700>.</span>config[<span style=color:#a5d6ff>&#39;features&#39;</span>]:
</span></span><span style=display:flex><span>            feature_name <span style=color:#ff7b72;font-weight:700>=</span> feature_config[<span style=color:#a5d6ff>&#39;name&#39;</span>]
</span></span><span style=display:flex><span>            transform_type <span style=color:#ff7b72;font-weight:700>=</span> feature_config[<span style=color:#a5d6ff>&#39;transform&#39;</span>]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>if</span> transform_type <span style=color:#ff7b72;font-weight:700>==</span> <span style=color:#a5d6ff>&#39;standard&#39;</span>:
</span></span><span style=display:flex><span>                <span style=color:#ff7b72>from</span> <span style=color:#ff7b72>sklearn.preprocessing</span> <span style=color:#ff7b72>import</span> StandardScaler
</span></span><span style=display:flex><span>                transformer <span style=color:#ff7b72;font-weight:700>=</span> StandardScaler()
</span></span><span style=display:flex><span>                transformer<span style=color:#ff7b72;font-weight:700>.</span>fit(df[[feature_name]])
</span></span><span style=display:flex><span>                self<span style=color:#ff7b72;font-weight:700>.</span>transformers[feature_name] <span style=color:#ff7b72;font-weight:700>=</span> transformer
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>elif</span> transform_type <span style=color:#ff7b72;font-weight:700>==</span> <span style=color:#a5d6ff>&#39;minmax&#39;</span>:
</span></span><span style=display:flex><span>                <span style=color:#ff7b72>from</span> <span style=color:#ff7b72>sklearn.preprocessing</span> <span style=color:#ff7b72>import</span> MinMaxScaler
</span></span><span style=display:flex><span>                transformer <span style=color:#ff7b72;font-weight:700>=</span> MinMaxScaler()
</span></span><span style=display:flex><span>                transformer<span style=color:#ff7b72;font-weight:700>.</span>fit(df[[feature_name]])
</span></span><span style=display:flex><span>                self<span style=color:#ff7b72;font-weight:700>.</span>transformers[feature_name] <span style=color:#ff7b72;font-weight:700>=</span> transformer
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>elif</span> transform_type <span style=color:#ff7b72;font-weight:700>==</span> <span style=color:#a5d6ff>&#39;label&#39;</span>:
</span></span><span style=display:flex><span>                <span style=color:#ff7b72>from</span> <span style=color:#ff7b72>sklearn.preprocessing</span> <span style=color:#ff7b72>import</span> LabelEncoder
</span></span><span style=display:flex><span>                transformer <span style=color:#ff7b72;font-weight:700>=</span> LabelEncoder()
</span></span><span style=display:flex><span>                transformer<span style=color:#ff7b72;font-weight:700>.</span>fit(df[feature_name])
</span></span><span style=display:flex><span>                self<span style=color:#ff7b72;font-weight:700>.</span>transformers[feature_name] <span style=color:#ff7b72;font-weight:700>=</span> transformer
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>transform</span>(self, df: pd<span style=color:#ff7b72;font-weight:700>.</span>DataFrame) <span style=color:#ff7b72;font-weight:700>-&gt;</span> pd<span style=color:#ff7b72;font-weight:700>.</span>DataFrame:
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;&#34;&#34;å˜æ¢æ•°æ®&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>        result_df <span style=color:#ff7b72;font-weight:700>=</span> df<span style=color:#ff7b72;font-weight:700>.</span>copy()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>for</span> feature_name, transformer <span style=color:#ff7b72;font-weight:700>in</span> self<span style=color:#ff7b72;font-weight:700>.</span>transformers<span style=color:#ff7b72;font-weight:700>.</span>items():
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>if</span> isinstance(transformer, (StandardScaler, MinMaxScaler)):
</span></span><span style=display:flex><span>                result_df[feature_name] <span style=color:#ff7b72;font-weight:700>=</span> transformer<span style=color:#ff7b72;font-weight:700>.</span>transform(df[[feature_name]])<span style=color:#ff7b72;font-weight:700>.</span>flatten()
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>elif</span> isinstance(transformer, LabelEncoder):
</span></span><span style=display:flex><span>                result_df[feature_name] <span style=color:#ff7b72;font-weight:700>=</span> transformer<span style=color:#ff7b72;font-weight:700>.</span>transform(df[feature_name])
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>return</span> result_df
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>fit_transform</span>(self, df: pd<span style=color:#ff7b72;font-weight:700>.</span>DataFrame) <span style=color:#ff7b72;font-weight:700>-&gt;</span> pd<span style=color:#ff7b72;font-weight:700>.</span>DataFrame:
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;&#34;&#34;æ‹Ÿåˆå¹¶å˜æ¢&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>        self<span style=color:#ff7b72;font-weight:700>.</span>fit(df)
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>return</span> self<span style=color:#ff7b72;font-weight:700>.</span>transform(df)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic># ä½¿ç”¨ç¤ºä¾‹</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>create_training_features</span>():
</span></span><span style=display:flex><span>    <span style=color:#a5d6ff>&#34;&#34;&#34;åˆ›å»ºè®­ç»ƒç‰¹å¾&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8b949e;font-style:italic># åˆå§‹åŒ–ç¦»çº¿ç‰¹å¾å­˜å‚¨</span>
</span></span><span style=display:flex><span>    offline_store <span style=color:#ff7b72;font-weight:700>=</span> OfflineFeatureStore(<span style=color:#a5d6ff>&#39;/data/features&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8b949e;font-style:italic># è·å–åŸå§‹æ•°æ®</span>
</span></span><span style=display:flex><span>    raw_data <span style=color:#ff7b72;font-weight:700>=</span> load_raw_data()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8b949e;font-style:italic># ç‰¹å¾å·¥ç¨‹</span>
</span></span><span style=display:flex><span>    pipeline <span style=color:#ff7b72;font-weight:700>=</span> FeatureEngineeringPipeline({
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#39;features&#39;</span>: [
</span></span><span style=display:flex><span>            {<span style=color:#a5d6ff>&#39;name&#39;</span>: <span style=color:#a5d6ff>&#39;age&#39;</span>, <span style=color:#a5d6ff>&#39;transform&#39;</span>: <span style=color:#a5d6ff>&#39;standard&#39;</span>},
</span></span><span style=display:flex><span>            {<span style=color:#a5d6ff>&#39;name&#39;</span>: <span style=color:#a5d6ff>&#39;income&#39;</span>, <span style=color:#a5d6ff>&#39;transform&#39;</span>: <span style=color:#a5d6ff>&#39;minmax&#39;</span>},
</span></span><span style=display:flex><span>            {<span style=color:#a5d6ff>&#39;name&#39;</span>: <span style=color:#a5d6ff>&#39;category&#39;</span>, <span style=color:#a5d6ff>&#39;transform&#39;</span>: <span style=color:#a5d6ff>&#39;label&#39;</span>}
</span></span><span style=display:flex><span>        ]
</span></span><span style=display:flex><span>    })
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8b949e;font-style:italic># æ‹Ÿåˆå¹¶å˜æ¢</span>
</span></span><span style=display:flex><span>    features <span style=color:#ff7b72;font-weight:700>=</span> pipeline<span style=color:#ff7b72;font-weight:700>.</span>fit_transform(raw_data)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8b949e;font-style:italic># å†™å…¥ç‰¹å¾å­˜å‚¨</span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>for</span> _, row <span style=color:#ff7b72;font-weight:700>in</span> features<span style=color:#ff7b72;font-weight:700>.</span>iterrows():
</span></span><span style=display:flex><span>        offline_store<span style=color:#ff7b72;font-weight:700>.</span>write_features(
</span></span><span style=display:flex><span>            row[<span style=color:#a5d6ff>&#39;entity_id&#39;</span>],
</span></span><span style=display:flex><span>            row<span style=color:#ff7b72;font-weight:700>.</span>to_dict()
</span></span><span style=display:flex><span>        )
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>return</span> features
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>get_online_features</span>(entity_id: str):
</span></span><span style=display:flex><span>    <span style=color:#a5d6ff>&#34;&#34;&#34;è·å–åœ¨çº¿ç‰¹å¾&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>import</span> <span style=color:#ff7b72>redis</span>
</span></span><span style=display:flex><span>    r <span style=color:#ff7b72;font-weight:700>=</span> redis<span style=color:#ff7b72;font-weight:700>.</span>Redis(host<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>&#39;localhost&#39;</span>, port<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>6379</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    online_store <span style=color:#ff7b72;font-weight:700>=</span> OnlineFeatureStore(r)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    features <span style=color:#ff7b72;font-weight:700>=</span> online_store<span style=color:#ff7b72;font-weight:700>.</span>get_features(
</span></span><span style=display:flex><span>        [entity_id],
</span></span><span style=display:flex><span>        [<span style=color:#a5d6ff>&#39;age&#39;</span>, <span style=color:#a5d6ff>&#39;income&#39;</span>, <span style=color:#a5d6ff>&#39;category&#39;</span>]
</span></span><span style=display:flex><span>    )
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>return</span> features<span style=color:#ff7b72;font-weight:700>.</span>iloc[<span style=color:#a5d6ff>0</span>]<span style=color:#ff7b72;font-weight:700>.</span>to_dict()
</span></span></code></pre></td></tr></table></div></div><h3 id=22-ç‰¹å¾ç‰ˆæœ¬ç®¡ç†>2.2 ç‰¹å¾ç‰ˆæœ¬ç®¡ç†<a hidden class=anchor aria-hidden=true href=#22-ç‰¹å¾ç‰ˆæœ¬ç®¡ç†>#</a></h3><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 56
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 57
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 58
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 59
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 60
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 61
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 62
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 63
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 64
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 65
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 66
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 67
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 68
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 69
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 70
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 71
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 72
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 73
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 74
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 75
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 76
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 77
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 78
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 79
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 80
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 81
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 82
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 83
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 84
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 85
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 86
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 87
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 88
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 89
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 90
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 91
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 92
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 93
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 94
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 95
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 96
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 97
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 98
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 99
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">100
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">101
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">102
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">103
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#8b949e;font-style:italic># ========== ç‰¹å¾ç‰ˆæœ¬ç®¡ç† ==========</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>class</span> <span style=color:#f0883e;font-weight:700>FeatureVersion</span>:
</span></span><span style=display:flex><span>    <span style=color:#a5d6ff>&#34;&#34;&#34;ç‰¹å¾ç‰ˆæœ¬&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>__init__</span>(
</span></span><span style=display:flex><span>        self,
</span></span><span style=display:flex><span>        feature_name: str,
</span></span><span style=display:flex><span>        version: int,
</span></span><span style=display:flex><span>        computation_logic: str,
</span></span><span style=display:flex><span>        created_at: datetime
</span></span><span style=display:flex><span>    ):
</span></span><span style=display:flex><span>        self<span style=color:#ff7b72;font-weight:700>.</span>feature_name <span style=color:#ff7b72;font-weight:700>=</span> feature_name
</span></span><span style=display:flex><span>        self<span style=color:#ff7b72;font-weight:700>.</span>version <span style=color:#ff7b72;font-weight:700>=</span> version
</span></span><span style=display:flex><span>        self<span style=color:#ff7b72;font-weight:700>.</span>computation_logic <span style=color:#ff7b72;font-weight:700>=</span> computation_logic
</span></span><span style=display:flex><span>        self<span style=color:#ff7b72;font-weight:700>.</span>created_at <span style=color:#ff7b72;font-weight:700>=</span> created_at
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>class</span> <span style=color:#f0883e;font-weight:700>FeatureRegistry</span>:
</span></span><span style=display:flex><span>    <span style=color:#a5d6ff>&#34;&#34;&#34;ç‰¹å¾æ³¨å†Œè¡¨&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>__init__</span>(self):
</span></span><span style=display:flex><span>        self<span style=color:#ff7b72;font-weight:700>.</span>features <span style=color:#ff7b72;font-weight:700>=</span> {}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>register_feature</span>(
</span></span><span style=display:flex><span>        self,
</span></span><span style=display:flex><span>        feature_name: str,
</span></span><span style=display:flex><span>        computation_logic: str,
</span></span><span style=display:flex><span>        description: str <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>&#34;&#34;</span>,
</span></span><span style=display:flex><span>        owner: str <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>&#34;&#34;</span>
</span></span><span style=display:flex><span>    ):
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;&#34;&#34;æ³¨å†Œæ–°ç‰¹å¾&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>if</span> feature_name <span style=color:#ff7b72;font-weight:700>in</span> self<span style=color:#ff7b72;font-weight:700>.</span>features:
</span></span><span style=display:flex><span>            <span style=color:#8b949e;font-style:italic># åˆ›å»ºæ–°ç‰ˆæœ¬</span>
</span></span><span style=display:flex><span>            last_version <span style=color:#ff7b72;font-weight:700>=</span> max(self<span style=color:#ff7b72;font-weight:700>.</span>features[feature_name]<span style=color:#ff7b72;font-weight:700>.</span>keys())
</span></span><span style=display:flex><span>            new_version <span style=color:#ff7b72;font-weight:700>=</span> last_version <span style=color:#ff7b72;font-weight:700>+</span> <span style=color:#a5d6ff>1</span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>else</span>:
</span></span><span style=display:flex><span>            self<span style=color:#ff7b72;font-weight:700>.</span>features[feature_name] <span style=color:#ff7b72;font-weight:700>=</span> {}
</span></span><span style=display:flex><span>            new_version <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>1</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        feature_version <span style=color:#ff7b72;font-weight:700>=</span> FeatureVersion(
</span></span><span style=display:flex><span>            feature_name<span style=color:#ff7b72;font-weight:700>=</span>feature_name,
</span></span><span style=display:flex><span>            version<span style=color:#ff7b72;font-weight:700>=</span>new_version,
</span></span><span style=display:flex><span>            computation_logic<span style=color:#ff7b72;font-weight:700>=</span>computation_logic,
</span></span><span style=display:flex><span>            created_at<span style=color:#ff7b72;font-weight:700>=</span>datetime<span style=color:#ff7b72;font-weight:700>.</span>now()
</span></span><span style=display:flex><span>        )
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        self<span style=color:#ff7b72;font-weight:700>.</span>features[feature_name][new_version] <span style=color:#ff7b72;font-weight:700>=</span> feature_version
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>return</span> new_version
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>get_feature</span>(self, feature_name: str, version: Optional[int] <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#79c0ff>None</span>):
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;&#34;&#34;è·å–ç‰¹å¾å®šä¹‰&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>if</span> feature_name <span style=color:#ff7b72;font-weight:700>not</span> <span style=color:#ff7b72;font-weight:700>in</span> self<span style=color:#ff7b72;font-weight:700>.</span>features:
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>raise</span> <span style=color:#f0883e;font-weight:700>ValueError</span>(<span style=color:#79c0ff>f</span><span style=color:#a5d6ff>&#34;Feature </span><span style=color:#a5d6ff>{</span>feature_name<span style=color:#a5d6ff>}</span><span style=color:#a5d6ff> not found&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>if</span> version <span style=color:#ff7b72;font-weight:700>is</span> <span style=color:#79c0ff>None</span>:
</span></span><span style=display:flex><span>            <span style=color:#8b949e;font-style:italic># è·å–æœ€æ–°ç‰ˆæœ¬</span>
</span></span><span style=display:flex><span>            version <span style=color:#ff7b72;font-weight:700>=</span> max(self<span style=color:#ff7b72;font-weight:700>.</span>features[feature_name]<span style=color:#ff7b72;font-weight:700>.</span>keys())
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>return</span> self<span style=color:#ff7b72;font-weight:700>.</span>features[feature_name][version]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>list_features</span>(self):
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;&#34;&#34;åˆ—å‡ºæ‰€æœ‰ç‰¹å¾&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>return</span> {
</span></span><span style=display:flex><span>            name: max(versions<span style=color:#ff7b72;font-weight:700>.</span>keys())
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>for</span> name, versions <span style=color:#ff7b72;font-weight:700>in</span> self<span style=color:#ff7b72;font-weight:700>.</span>features<span style=color:#ff7b72;font-weight:700>.</span>items()
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic># ä½¿ç”¨ç¤ºä¾‹</span>
</span></span><span style=display:flex><span>registry <span style=color:#ff7b72;font-weight:700>=</span> FeatureRegistry()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic># æ³¨å†Œç‰¹å¾</span>
</span></span><span style=display:flex><span>registry<span style=color:#ff7b72;font-weight:700>.</span>register_feature(
</span></span><span style=display:flex><span>    feature_name<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>&#34;user_avg_transaction_amount&#34;</span>,
</span></span><span style=display:flex><span>    computation_logic<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>&#34;&#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>    SELECT
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>        user_id,
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>        AVG(amount) as user_avg_transaction_amount
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>    FROM transactions
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>    WHERE transaction_date &gt;= DATE_SUB(CURRENT_DATE, INTERVAL 30 DAY)
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>    GROUP BY user_id
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>    &#34;&#34;&#34;</span>,
</span></span><span style=display:flex><span>    description<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>&#34;ç”¨æˆ·è¿‡å»30å¤©å¹³å‡äº¤æ˜“é‡‘é¢&#34;</span>,
</span></span><span style=display:flex><span>    owner<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>&#34;data-team&#34;</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic># æ›´æ–°ç‰¹å¾é€»è¾‘ï¼ˆåˆ›å»ºæ–°ç‰ˆæœ¬ï¼‰</span>
</span></span><span style=display:flex><span>registry<span style=color:#ff7b72;font-weight:700>.</span>register_feature(
</span></span><span style=display:flex><span>    feature_name<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>&#34;user_avg_transaction_amount&#34;</span>,
</span></span><span style=display:flex><span>    computation_logic<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>&#34;&#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>    SELECT
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>        user_id,
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>        AVG(amount) as user_avg_transaction_amount
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>    FROM transactions
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>    WHERE
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>        transaction_date &gt;= DATE_SUB(CURRENT_DATE, INTERVAL 30 DAY)
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>        AND status = &#39;completed&#39;
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>    GROUP BY user_id
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>    &#34;&#34;&#34;</span>,
</span></span><span style=display:flex><span>    description<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>&#34;ç”¨æˆ·è¿‡å»30å¤©å·²å®Œæˆäº¤æ˜“å¹³å‡é‡‘é¢&#34;</span>,
</span></span><span style=display:flex><span>    owner<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>&#34;data-team&#34;</span>
</span></span><span style=display:flex><span>)
</span></span></code></pre></td></tr></table></div></div><h2 id=ä¸‰æ¨¡å‹éƒ¨ç½²ä¸æœåŠ¡åŒ–>ä¸‰ã€æ¨¡å‹éƒ¨ç½²ä¸æœåŠ¡åŒ–<a hidden class=anchor aria-hidden=true href=#ä¸‰æ¨¡å‹éƒ¨ç½²ä¸æœåŠ¡åŒ–>#</a></h2><h3 id=31-æ¨¡å‹æœåŠ¡åŒ–>3.1 æ¨¡å‹æœåŠ¡åŒ–<a hidden class=anchor aria-hidden=true href=#31-æ¨¡å‹æœåŠ¡åŒ–>#</a></h3><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 56
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 57
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 58
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 59
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 60
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 61
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 62
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 63
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 64
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 65
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 66
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 67
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 68
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 69
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 70
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 71
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 72
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 73
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 74
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 75
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 76
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 77
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 78
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 79
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 80
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 81
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 82
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 83
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 84
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 85
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 86
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 87
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 88
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 89
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 90
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 91
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 92
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 93
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 94
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 95
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 96
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 97
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 98
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 99
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">100
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">101
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">102
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">103
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">104
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">105
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">106
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">107
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">108
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">109
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">110
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">111
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">112
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">113
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">114
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">115
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#8b949e;font-style:italic># ========== æ¨¡å‹æœåŠ¡ ==========</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>from</span> <span style=color:#ff7b72>fastapi</span> <span style=color:#ff7b72>import</span> FastAPI, HTTPException
</span></span><span style=display:flex><span><span style=color:#ff7b72>from</span> <span style=color:#ff7b72>pydantic</span> <span style=color:#ff7b72>import</span> BaseModel
</span></span><span style=display:flex><span><span style=color:#ff7b72>from</span> <span style=color:#ff7b72>typing</span> <span style=color:#ff7b72>import</span> List
</span></span><span style=display:flex><span><span style=color:#ff7b72>import</span> <span style=color:#ff7b72>joblib</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>import</span> <span style=color:#ff7b72>numpy</span> <span style=color:#ff7b72>as</span> <span style=color:#ff7b72>np</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>app <span style=color:#ff7b72;font-weight:700>=</span> FastAPI(title<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>&#34;ML Model Service&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>class</span> <span style=color:#f0883e;font-weight:700>PredictionRequest</span>(BaseModel):
</span></span><span style=display:flex><span>    features: List[float]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>class</span> <span style=color:#f0883e;font-weight:700>PredictionResponse</span>(BaseModel):
</span></span><span style=display:flex><span>    prediction: float
</span></span><span style=display:flex><span>    probability: float
</span></span><span style=display:flex><span>    model_version: str
</span></span><span style=display:flex><span>    timestamp: str
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>class</span> <span style=color:#f0883e;font-weight:700>ModelService</span>:
</span></span><span style=display:flex><span>    <span style=color:#a5d6ff>&#34;&#34;&#34;æ¨¡å‹æœåŠ¡&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>__init__</span>(self, model_path: str):
</span></span><span style=display:flex><span>        self<span style=color:#ff7b72;font-weight:700>.</span>model <span style=color:#ff7b72;font-weight:700>=</span> self<span style=color:#ff7b72;font-weight:700>.</span>load_model(model_path)
</span></span><span style=display:flex><span>        self<span style=color:#ff7b72;font-weight:700>.</span>model_version <span style=color:#ff7b72;font-weight:700>=</span> self<span style=color:#ff7b72;font-weight:700>.</span>get_model_version(model_path)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>load_model</span>(self, model_path: str):
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;&#34;&#34;åŠ è½½æ¨¡å‹&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>return</span> joblib<span style=color:#ff7b72;font-weight:700>.</span>load(model_path)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>get_model_version</span>(self, model_path: str) <span style=color:#ff7b72;font-weight:700>-&gt;</span> str:
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;&#34;&#34;è·å–æ¨¡å‹ç‰ˆæœ¬&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># ä»è·¯å¾„æˆ–å…ƒæ•°æ®ä¸­æå–ç‰ˆæœ¬</span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>return</span> model_path<span style=color:#ff7b72;font-weight:700>.</span>split(<span style=color:#a5d6ff>&#39;/&#39;</span>)[<span style=color:#ff7b72;font-weight:700>-</span><span style=color:#a5d6ff>1</span>]<span style=color:#ff7b72;font-weight:700>.</span>replace(<span style=color:#a5d6ff>&#39;.pkl&#39;</span>, <span style=color:#a5d6ff>&#39;&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>predict</span>(self, features: List[float]) <span style=color:#ff7b72;font-weight:700>-&gt;</span> dict:
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;&#34;&#34;é¢„æµ‹&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>        X <span style=color:#ff7b72;font-weight:700>=</span> np<span style=color:#ff7b72;font-weight:700>.</span>array(features)<span style=color:#ff7b72;font-weight:700>.</span>reshape(<span style=color:#a5d6ff>1</span>, <span style=color:#ff7b72;font-weight:700>-</span><span style=color:#a5d6ff>1</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        prediction <span style=color:#ff7b72;font-weight:700>=</span> self<span style=color:#ff7b72;font-weight:700>.</span>model<span style=color:#ff7b72;font-weight:700>.</span>predict(X)[<span style=color:#a5d6ff>0</span>]
</span></span><span style=display:flex><span>        probability <span style=color:#ff7b72;font-weight:700>=</span> self<span style=color:#ff7b72;font-weight:700>.</span>model<span style=color:#ff7b72;font-weight:700>.</span>predict_proba(X)[<span style=color:#a5d6ff>0</span>]<span style=color:#ff7b72;font-weight:700>.</span>max()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>return</span> {
</span></span><span style=display:flex><span>            <span style=color:#a5d6ff>&#39;prediction&#39;</span>: float(prediction),
</span></span><span style=display:flex><span>            <span style=color:#a5d6ff>&#39;probability&#39;</span>: float(probability)
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic># å…¨å±€æ¨¡å‹æœåŠ¡å®ä¾‹</span>
</span></span><span style=display:flex><span>model_service <span style=color:#ff7b72;font-weight:700>=</span> ModelService(<span style=color:#a5d6ff>&#34;/models/fraud_detection_v1.pkl&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#d2a8ff;font-weight:700>@app.post</span>(<span style=color:#a5d6ff>&#34;/predict&#34;</span>, response_model<span style=color:#ff7b72;font-weight:700>=</span>PredictionResponse)
</span></span><span style=display:flex><span><span style=color:#ff7b72>async</span> <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>predict</span>(request: PredictionRequest):
</span></span><span style=display:flex><span>    <span style=color:#a5d6ff>&#34;&#34;&#34;é¢„æµ‹æ¥å£&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>try</span>:
</span></span><span style=display:flex><span>        result <span style=color:#ff7b72;font-weight:700>=</span> model_service<span style=color:#ff7b72;font-weight:700>.</span>predict(request<span style=color:#ff7b72;font-weight:700>.</span>features)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>return</span> PredictionResponse(
</span></span><span style=display:flex><span>            prediction<span style=color:#ff7b72;font-weight:700>=</span>result[<span style=color:#a5d6ff>&#39;prediction&#39;</span>],
</span></span><span style=display:flex><span>            probability<span style=color:#ff7b72;font-weight:700>=</span>result[<span style=color:#a5d6ff>&#39;probability&#39;</span>],
</span></span><span style=display:flex><span>            model_version<span style=color:#ff7b72;font-weight:700>=</span>model_service<span style=color:#ff7b72;font-weight:700>.</span>model_version,
</span></span><span style=display:flex><span>            timestamp<span style=color:#ff7b72;font-weight:700>=</span>datetime<span style=color:#ff7b72;font-weight:700>.</span>now()<span style=color:#ff7b72;font-weight:700>.</span>isoformat()
</span></span><span style=display:flex><span>        )
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>except</span> <span style=color:#f0883e;font-weight:700>Exception</span> <span style=color:#ff7b72>as</span> e:
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>raise</span> HTTPException(status_code<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>500</span>, detail<span style=color:#ff7b72;font-weight:700>=</span>str(e))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#d2a8ff;font-weight:700>@app.get</span>(<span style=color:#a5d6ff>&#34;/model/info&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#ff7b72>async</span> <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>model_info</span>():
</span></span><span style=display:flex><span>    <span style=color:#a5d6ff>&#34;&#34;&#34;æ¨¡å‹ä¿¡æ¯æ¥å£&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>return</span> {
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;model_version&#34;</span>: model_service<span style=color:#ff7b72;font-weight:700>.</span>model_version,
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;model_type&#34;</span>: type(model_service<span style=color:#ff7b72;font-weight:700>.</span>model)<span style=color:#ff7b72;font-weight:700>.</span><span style=color:#79c0ff>__name__</span>,
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;loaded_at&#34;</span>: datetime<span style=color:#ff7b72;font-weight:700>.</span>now()<span style=color:#ff7b72;font-weight:700>.</span>isoformat()
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#d2a8ff;font-weight:700>@app.get</span>(<span style=color:#a5d6ff>&#34;/health&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#ff7b72>async</span> <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>health_check</span>():
</span></span><span style=display:flex><span>    <span style=color:#a5d6ff>&#34;&#34;&#34;å¥åº·æ£€æŸ¥&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>return</span> {<span style=color:#a5d6ff>&#34;status&#34;</span>: <span style=color:#a5d6ff>&#34;healthy&#34;</span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic># ========== æ‰¹é‡é¢„æµ‹æœåŠ¡ ==========</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>class</span> <span style=color:#f0883e;font-weight:700>BatchPredictionService</span>:
</span></span><span style=display:flex><span>    <span style=color:#a5d6ff>&#34;&#34;&#34;æ‰¹é‡é¢„æµ‹æœåŠ¡&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>__init__</span>(self, model_path: str):
</span></span><span style=display:flex><span>        self<span style=color:#ff7b72;font-weight:700>.</span>model <span style=color:#ff7b72;font-weight:700>=</span> joblib<span style=color:#ff7b72;font-weight:700>.</span>load(model_path)
</span></span><span style=display:flex><span>        self<span style=color:#ff7b72;font-weight:700>.</span>batch_size <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>1000</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>predict_batch</span>(self, features: List[List[float]]) <span style=color:#ff7b72;font-weight:700>-&gt;</span> List[dict]:
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;&#34;&#34;æ‰¹é‡é¢„æµ‹&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        results <span style=color:#ff7b72;font-weight:700>=</span> []
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>for</span> i <span style=color:#ff7b72;font-weight:700>in</span> range(<span style=color:#a5d6ff>0</span>, len(features), self<span style=color:#ff7b72;font-weight:700>.</span>batch_size):
</span></span><span style=display:flex><span>            batch <span style=color:#ff7b72;font-weight:700>=</span> features[i:i <span style=color:#ff7b72;font-weight:700>+</span> self<span style=color:#ff7b72;font-weight:700>.</span>batch_size]
</span></span><span style=display:flex><span>            X <span style=color:#ff7b72;font-weight:700>=</span> np<span style=color:#ff7b72;font-weight:700>.</span>array(batch)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            predictions <span style=color:#ff7b72;font-weight:700>=</span> self<span style=color:#ff7b72;font-weight:700>.</span>model<span style=color:#ff7b72;font-weight:700>.</span>predict(X)
</span></span><span style=display:flex><span>            probabilities <span style=color:#ff7b72;font-weight:700>=</span> self<span style=color:#ff7b72;font-weight:700>.</span>model<span style=color:#ff7b72;font-weight:700>.</span>predict_proba(X)<span style=color:#ff7b72;font-weight:700>.</span>max(axis<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>1</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>for</span> pred, prob <span style=color:#ff7b72;font-weight:700>in</span> zip(predictions, probabilities):
</span></span><span style=display:flex><span>                results<span style=color:#ff7b72;font-weight:700>.</span>append({
</span></span><span style=display:flex><span>                    <span style=color:#a5d6ff>&#39;prediction&#39;</span>: int(pred),
</span></span><span style=display:flex><span>                    <span style=color:#a5d6ff>&#39;probability&#39;</span>: float(prob)
</span></span><span style=display:flex><span>                })
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>return</span> results
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#d2a8ff;font-weight:700>@app.post</span>(<span style=color:#a5d6ff>&#34;/predict/batch&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#ff7b72>async</span> <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>predict_batch</span>(request: PredictionRequest):
</span></span><span style=display:flex><span>    <span style=color:#a5d6ff>&#34;&#34;&#34;æ‰¹é‡é¢„æµ‹æ¥å£&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>    batch_service <span style=color:#ff7b72;font-weight:700>=</span> BatchPredictionService(<span style=color:#a5d6ff>&#34;/models/fraud_detection_v1.pkl&#34;</span>)
</span></span><span style=display:flex><span>    results <span style=color:#ff7b72;font-weight:700>=</span> batch_service<span style=color:#ff7b72;font-weight:700>.</span>predict_batch([request<span style=color:#ff7b72;font-weight:700>.</span>features])
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>return</span> {<span style=color:#a5d6ff>&#34;predictions&#34;</span>: results}
</span></span></code></pre></td></tr></table></div></div><h3 id=32-æ¨¡å‹ç‰ˆæœ¬ç®¡ç†ä¸å›æ»š>3.2 æ¨¡å‹ç‰ˆæœ¬ç®¡ç†ä¸å›æ»š<a hidden class=anchor aria-hidden=true href=#32-æ¨¡å‹ç‰ˆæœ¬ç®¡ç†ä¸å›æ»š>#</a></h3><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 56
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 57
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 58
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 59
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 60
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 61
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 62
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 63
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 64
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 65
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 66
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 67
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 68
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 69
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 70
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 71
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 72
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 73
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 74
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 75
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 76
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 77
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 78
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 79
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 80
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 81
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 82
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 83
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 84
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 85
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 86
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 87
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 88
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 89
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 90
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 91
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 92
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 93
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 94
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 95
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 96
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 97
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 98
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 99
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">100
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">101
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">102
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">103
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">104
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">105
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">106
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">107
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">108
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">109
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">110
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">111
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">112
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">113
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">114
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">115
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">116
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">117
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">118
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">119
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">120
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">121
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">122
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">123
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">124
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">125
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">126
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">127
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">128
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">129
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">130
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">131
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">132
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">133
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">134
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">135
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">136
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">137
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">138
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">139
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">140
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">141
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">142
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">143
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">144
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">145
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">146
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">147
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">148
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">149
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">150
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">151
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">152
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">153
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">154
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">155
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">156
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">157
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">158
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">159
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">160
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">161
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">162
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">163
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">164
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">165
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">166
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">167
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#8b949e;font-style:italic># ========== æ¨¡å‹ç‰ˆæœ¬ç®¡ç† ==========</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>class</span> <span style=color:#f0883e;font-weight:700>ModelVersion</span>:
</span></span><span style=display:flex><span>    <span style=color:#a5d6ff>&#34;&#34;&#34;æ¨¡å‹ç‰ˆæœ¬&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>__init__</span>(
</span></span><span style=display:flex><span>        self,
</span></span><span style=display:flex><span>        version: str,
</span></span><span style=display:flex><span>        model_path: str,
</span></span><span style=display:flex><span>        metrics: Dict[str, float],
</span></span><span style=display:flex><span>        created_at: datetime
</span></span><span style=display:flex><span>    ):
</span></span><span style=display:flex><span>        self<span style=color:#ff7b72;font-weight:700>.</span>version <span style=color:#ff7b72;font-weight:700>=</span> version
</span></span><span style=display:flex><span>        self<span style=color:#ff7b72;font-weight:700>.</span>model_path <span style=color:#ff7b72;font-weight:700>=</span> model_path
</span></span><span style=display:flex><span>        self<span style=color:#ff7b72;font-weight:700>.</span>metrics <span style=color:#ff7b72;font-weight:700>=</span> metrics
</span></span><span style=display:flex><span>        self<span style=color:#ff7b72;font-weight:700>.</span>created_at <span style=color:#ff7b72;font-weight:700>=</span> created_at
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>class</span> <span style=color:#f0883e;font-weight:700>ModelRegistry</span>:
</span></span><span style=display:flex><span>    <span style=color:#a5d6ff>&#34;&#34;&#34;æ¨¡å‹æ³¨å†Œè¡¨&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>__init__</span>(self, storage_path: str):
</span></span><span style=display:flex><span>        self<span style=color:#ff7b72;font-weight:700>.</span>storage_path <span style=color:#ff7b72;font-weight:700>=</span> storage_path
</span></span><span style=display:flex><span>        self<span style=color:#ff7b72;font-weight:700>.</span>models <span style=color:#ff7b72;font-weight:700>=</span> {}
</span></span><span style=display:flex><span>        self<span style=color:#ff7b72;font-weight:700>.</span>current_version <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#79c0ff>None</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>register_model</span>(
</span></span><span style=display:flex><span>        self,
</span></span><span style=display:flex><span>        version: str,
</span></span><span style=display:flex><span>        model_path: str,
</span></span><span style=display:flex><span>        metrics: Dict[str, float]
</span></span><span style=display:flex><span>    ):
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;&#34;&#34;æ³¨å†Œæ¨¡å‹&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        model_version <span style=color:#ff7b72;font-weight:700>=</span> ModelVersion(
</span></span><span style=display:flex><span>            version<span style=color:#ff7b72;font-weight:700>=</span>version,
</span></span><span style=display:flex><span>            model_path<span style=color:#ff7b72;font-weight:700>=</span>model_path,
</span></span><span style=display:flex><span>            metrics<span style=color:#ff7b72;font-weight:700>=</span>metrics,
</span></span><span style=display:flex><span>            created_at<span style=color:#ff7b72;font-weight:700>=</span>datetime<span style=color:#ff7b72;font-weight:700>.</span>now()
</span></span><span style=display:flex><span>        )
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        self<span style=color:#ff7b72;font-weight:700>.</span>models[version] <span style=color:#ff7b72;font-weight:700>=</span> model_version
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>return</span> model_version
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>set_current_version</span>(self, version: str):
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;&#34;&#34;è®¾ç½®å½“å‰ç‰ˆæœ¬&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>if</span> version <span style=color:#ff7b72;font-weight:700>not</span> <span style=color:#ff7b72;font-weight:700>in</span> self<span style=color:#ff7b72;font-weight:700>.</span>models:
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>raise</span> <span style=color:#f0883e;font-weight:700>ValueError</span>(<span style=color:#79c0ff>f</span><span style=color:#a5d6ff>&#34;Version </span><span style=color:#a5d6ff>{</span>version<span style=color:#a5d6ff>}</span><span style=color:#a5d6ff> not found&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        self<span style=color:#ff7b72;font-weight:700>.</span>current_version <span style=color:#ff7b72;font-weight:700>=</span> version
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>get_current_model</span>(self):
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;&#34;&#34;è·å–å½“å‰æ¨¡å‹&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>if</span> self<span style=color:#ff7b72;font-weight:700>.</span>current_version <span style=color:#ff7b72;font-weight:700>is</span> <span style=color:#79c0ff>None</span>:
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>raise</span> <span style=color:#f0883e;font-weight:700>ValueError</span>(<span style=color:#a5d6ff>&#34;No current version set&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>return</span> self<span style=color:#ff7b72;font-weight:700>.</span>models[self<span style=color:#ff7b72;font-weight:700>.</span>current_version]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>rollback</span>(self, target_version: str):
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;&#34;&#34;å›æ»šåˆ°æŒ‡å®šç‰ˆæœ¬&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>if</span> target_version <span style=color:#ff7b72;font-weight:700>not</span> <span style=color:#ff7b72;font-weight:700>in</span> self<span style=color:#ff7b72;font-weight:700>.</span>models:
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>raise</span> <span style=color:#f0883e;font-weight:700>ValueError</span>(<span style=color:#79c0ff>f</span><span style=color:#a5d6ff>&#34;Version </span><span style=color:#a5d6ff>{</span>target_version<span style=color:#a5d6ff>}</span><span style=color:#a5d6ff> not found&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        old_version <span style=color:#ff7b72;font-weight:700>=</span> self<span style=color:#ff7b72;font-weight:700>.</span>current_version
</span></span><span style=display:flex><span>        self<span style=color:#ff7b72;font-weight:700>.</span>current_version <span style=color:#ff7b72;font-weight:700>=</span> target_version
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        print(<span style=color:#79c0ff>f</span><span style=color:#a5d6ff>&#34;Rollback from </span><span style=color:#a5d6ff>{</span>old_version<span style=color:#a5d6ff>}</span><span style=color:#a5d6ff> to </span><span style=color:#a5d6ff>{</span>target_version<span style=color:#a5d6ff>}</span><span style=color:#a5d6ff>&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>list_versions</span>(self):
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;&#34;&#34;åˆ—å‡ºæ‰€æœ‰ç‰ˆæœ¬&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>return</span> sorted(
</span></span><span style=display:flex><span>            self<span style=color:#ff7b72;font-weight:700>.</span>models<span style=color:#ff7b72;font-weight:700>.</span>keys(),
</span></span><span style=display:flex><span>            key<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#ff7b72>lambda</span> v: self<span style=color:#ff7b72;font-weight:700>.</span>models[v]<span style=color:#ff7b72;font-weight:700>.</span>created_at,
</span></span><span style=display:flex><span>            reverse<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#79c0ff>True</span>
</span></span><span style=display:flex><span>        )
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>compare_versions</span>(self, version1: str, version2: str) <span style=color:#ff7b72;font-weight:700>-&gt;</span> dict:
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;&#34;&#34;æ¯”è¾ƒä¸¤ä¸ªç‰ˆæœ¬&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>if</span> version1 <span style=color:#ff7b72;font-weight:700>not</span> <span style=color:#ff7b72;font-weight:700>in</span> self<span style=color:#ff7b72;font-weight:700>.</span>models <span style=color:#ff7b72;font-weight:700>or</span> version2 <span style=color:#ff7b72;font-weight:700>not</span> <span style=color:#ff7b72;font-weight:700>in</span> self<span style=color:#ff7b72;font-weight:700>.</span>models:
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>raise</span> <span style=color:#f0883e;font-weight:700>ValueError</span>(<span style=color:#a5d6ff>&#34;One or both versions not found&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>return</span> {
</span></span><span style=display:flex><span>            <span style=color:#a5d6ff>&#39;version1&#39;</span>: {
</span></span><span style=display:flex><span>                <span style=color:#a5d6ff>&#39;version&#39;</span>: version1,
</span></span><span style=display:flex><span>                <span style=color:#a5d6ff>&#39;metrics&#39;</span>: self<span style=color:#ff7b72;font-weight:700>.</span>models[version1]<span style=color:#ff7b72;font-weight:700>.</span>metrics
</span></span><span style=display:flex><span>            },
</span></span><span style=display:flex><span>            <span style=color:#a5d6ff>&#39;version2&#39;</span>: {
</span></span><span style=display:flex><span>                <span style=color:#a5d6ff>&#39;version&#39;</span>: version2,
</span></span><span style=display:flex><span>                <span style=color:#a5d6ff>&#39;metrics&#39;</span>: self<span style=color:#ff7b72;font-weight:700>.</span>models[version2]<span style=color:#ff7b72;font-weight:700>.</span>metrics
</span></span><span style=display:flex><span>            },
</span></span><span style=display:flex><span>            <span style=color:#a5d6ff>&#39;improvement&#39;</span>: {
</span></span><span style=display:flex><span>                metric: self<span style=color:#ff7b72;font-weight:700>.</span>models[version2]<span style=color:#ff7b72;font-weight:700>.</span>metrics[metric] <span style=color:#ff7b72;font-weight:700>-</span> self<span style=color:#ff7b72;font-weight:700>.</span>models[version1]<span style=color:#ff7b72;font-weight:700>.</span>metrics[metric]
</span></span><span style=display:flex><span>                <span style=color:#ff7b72>for</span> metric <span style=color:#ff7b72;font-weight:700>in</span> self<span style=color:#ff7b72;font-weight:700>.</span>models[version1]<span style=color:#ff7b72;font-weight:700>.</span>metrics
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic># ========== ç°åº¦å‘å¸ƒ ==========</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>class</span> <span style=color:#f0883e;font-weight:700>CanaryDeployment</span>:
</span></span><span style=display:flex><span>    <span style=color:#a5d6ff>&#34;&#34;&#34;ç°åº¦éƒ¨ç½²ç®¡ç†&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>__init__</span>(self, registry: ModelRegistry):
</span></span><span style=display:flex><span>        self<span style=color:#ff7b72;font-weight:700>.</span>registry <span style=color:#ff7b72;font-weight:700>=</span> registry
</span></span><span style=display:flex><span>        self<span style=color:#ff7b72;font-weight:700>.</span>traffic_split <span style=color:#ff7b72;font-weight:700>=</span> {}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>set_traffic_split</span>(self, version_percentages: Dict[str, float]):
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;&#34;&#34;è®¾ç½®æµé‡åˆ†é…&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        total <span style=color:#ff7b72;font-weight:700>=</span> sum(version_percentages<span style=color:#ff7b72;font-weight:700>.</span>values())
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>if</span> abs(total <span style=color:#ff7b72;font-weight:700>-</span> <span style=color:#a5d6ff>1.0</span>) <span style=color:#ff7b72;font-weight:700>&gt;</span> <span style=color:#a5d6ff>0.01</span>:
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>raise</span> <span style=color:#f0883e;font-weight:700>ValueError</span>(<span style=color:#a5d6ff>&#34;Percentages must sum to 1.0&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>for</span> version <span style=color:#ff7b72;font-weight:700>in</span> version_percentages<span style=color:#ff7b72;font-weight:700>.</span>keys():
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>if</span> version <span style=color:#ff7b72;font-weight:700>not</span> <span style=color:#ff7b72;font-weight:700>in</span> self<span style=color:#ff7b72;font-weight:700>.</span>registry<span style=color:#ff7b72;font-weight:700>.</span>models:
</span></span><span style=display:flex><span>                <span style=color:#ff7b72>raise</span> <span style=color:#f0883e;font-weight:700>ValueError</span>(<span style=color:#79c0ff>f</span><span style=color:#a5d6ff>&#34;Version </span><span style=color:#a5d6ff>{</span>version<span style=color:#a5d6ff>}</span><span style=color:#a5d6ff> not found&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        self<span style=color:#ff7b72;font-weight:700>.</span>traffic_split <span style=color:#ff7b72;font-weight:700>=</span> version_percentages
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>route_request</span>(self) <span style=color:#ff7b72;font-weight:700>-&gt;</span> str:
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;&#34;&#34;è·¯ç”±è¯·æ±‚åˆ°æŒ‡å®šç‰ˆæœ¬&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>import</span> <span style=color:#ff7b72>random</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        rand <span style=color:#ff7b72;font-weight:700>=</span> random<span style=color:#ff7b72;font-weight:700>.</span>random()
</span></span><span style=display:flex><span>        cumulative <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>0.0</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>for</span> version, percentage <span style=color:#ff7b72;font-weight:700>in</span> self<span style=color:#ff7b72;font-weight:700>.</span>traffic_split<span style=color:#ff7b72;font-weight:700>.</span>items():
</span></span><span style=display:flex><span>            cumulative <span style=color:#ff7b72;font-weight:700>+=</span> percentage
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>if</span> rand <span style=color:#ff7b72;font-weight:700>&lt;=</span> cumulative:
</span></span><span style=display:flex><span>                <span style=color:#ff7b72>return</span> version
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>return</span> self<span style=color:#ff7b72;font-weight:700>.</span>registry<span style=color:#ff7b72;font-weight:700>.</span>current_version
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>gradual_rollout</span>(
</span></span><span style=display:flex><span>        self,
</span></span><span style=display:flex><span>        new_version: str,
</span></span><span style=display:flex><span>        steps: int <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>10</span>,
</span></span><span style=display:flex><span>        duration_hours: int <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>24</span>
</span></span><span style=display:flex><span>    ):
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;&#34;&#34;æ¸è¿›å¼ç°åº¦å‘å¸ƒ&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>import</span> <span style=color:#ff7b72>asyncio</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        step_duration <span style=color:#ff7b72;font-weight:700>=</span> duration_hours <span style=color:#ff7b72;font-weight:700>*</span> <span style=color:#a5d6ff>3600</span> <span style=color:#ff7b72;font-weight:700>/</span> steps
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>async</span> <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>rollout_step</span>(step: int):
</span></span><span style=display:flex><span>            percentage <span style=color:#ff7b72;font-weight:700>=</span> (step <span style=color:#ff7b72;font-weight:700>+</span> <span style=color:#a5d6ff>1</span>) <span style=color:#ff7b72;font-weight:700>/</span> steps
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            self<span style=color:#ff7b72;font-weight:700>.</span>set_traffic_split({
</span></span><span style=display:flex><span>                new_version: percentage,
</span></span><span style=display:flex><span>                self<span style=color:#ff7b72;font-weight:700>.</span>registry<span style=color:#ff7b72;font-weight:700>.</span>current_version: <span style=color:#a5d6ff>1</span> <span style=color:#ff7b72;font-weight:700>-</span> percentage
</span></span><span style=display:flex><span>            })
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            print(<span style=color:#79c0ff>f</span><span style=color:#a5d6ff>&#34;Step </span><span style=color:#a5d6ff>{</span>step <span style=color:#ff7b72;font-weight:700>+</span> <span style=color:#a5d6ff>1</span><span style=color:#a5d6ff>}</span><span style=color:#a5d6ff>/</span><span style=color:#a5d6ff>{</span>steps<span style=color:#a5d6ff>}</span><span style=color:#a5d6ff>: </span><span style=color:#a5d6ff>{</span>new_version<span style=color:#a5d6ff>}</span><span style=color:#a5d6ff> at </span><span style=color:#a5d6ff>{</span>percentage<span style=color:#a5d6ff>:</span><span style=color:#a5d6ff>.1%</span><span style=color:#a5d6ff>}</span><span style=color:#a5d6ff>&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>await</span> asyncio<span style=color:#ff7b72;font-weight:700>.</span>sleep(step_duration)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># æ‰§è¡Œæ¸è¿›å¼å‘å¸ƒ</span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>for</span> step <span style=color:#ff7b72;font-weight:700>in</span> range(steps):
</span></span><span style=display:flex><span>            asyncio<span style=color:#ff7b72;font-weight:700>.</span>run(rollout_step(step))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># å®Œå…¨åˆ‡æ¢åˆ°æ–°ç‰ˆæœ¬</span>
</span></span><span style=display:flex><span>        self<span style=color:#ff7b72;font-weight:700>.</span>registry<span style=color:#ff7b72;font-weight:700>.</span>set_current_version(new_version)
</span></span><span style=display:flex><span>        self<span style=color:#ff7b72;font-weight:700>.</span>traffic_split <span style=color:#ff7b72;font-weight:700>=</span> {new_version: <span style=color:#a5d6ff>1.0</span>}
</span></span></code></pre></td></tr></table></div></div><h2 id=å››æ¨¡å‹ç›‘æ§ä¸abæµ‹è¯•>å››ã€æ¨¡å‹ç›‘æ§ä¸A/Bæµ‹è¯•<a hidden class=anchor aria-hidden=true href=#å››æ¨¡å‹ç›‘æ§ä¸abæµ‹è¯•>#</a></h2><h3 id=41-æ¨¡å‹æ€§èƒ½ç›‘æ§>4.1 æ¨¡å‹æ€§èƒ½ç›‘æ§<a hidden class=anchor aria-hidden=true href=#41-æ¨¡å‹æ€§èƒ½ç›‘æ§>#</a></h3><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 56
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 57
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 58
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 59
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 60
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 61
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 62
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 63
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 64
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 65
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 66
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 67
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 68
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 69
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 70
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 71
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 72
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 73
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 74
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 75
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 76
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 77
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 78
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 79
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 80
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 81
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 82
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 83
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 84
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 85
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 86
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 87
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 88
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 89
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 90
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 91
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 92
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 93
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 94
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 95
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 96
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 97
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 98
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 99
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">100
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">101
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">102
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">103
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">104
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">105
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">106
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">107
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">108
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">109
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">110
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">111
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">112
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">113
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">114
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">115
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">116
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">117
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">118
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">119
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">120
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">121
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">122
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">123
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">124
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">125
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">126
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">127
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">128
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">129
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">130
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">131
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">132
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">133
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">134
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">135
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">136
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">137
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">138
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">139
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">140
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">141
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">142
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">143
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">144
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">145
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">146
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">147
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">148
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">149
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">150
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">151
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">152
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">153
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">154
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">155
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">156
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">157
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">158
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">159
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#8b949e;font-style:italic># ========== æ¨¡å‹ç›‘æ§ç³»ç»Ÿ ==========</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>from</span> <span style=color:#ff7b72>prometheus_client</span> <span style=color:#ff7b72>import</span> Counter, Histogram, Gauge
</span></span><span style=display:flex><span><span style=color:#ff7b72>import</span> <span style=color:#ff7b72>numpy</span> <span style=color:#ff7b72>as</span> <span style=color:#ff7b72>np</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic># å®šä¹‰ç›‘æ§æŒ‡æ ‡</span>
</span></span><span style=display:flex><span>prediction_count <span style=color:#ff7b72;font-weight:700>=</span> Counter(
</span></span><span style=display:flex><span>    <span style=color:#a5d6ff>&#39;ml_predictions_total&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#a5d6ff>&#39;Total predictions made&#39;</span>,
</span></span><span style=display:flex><span>    [<span style=color:#a5d6ff>&#39;model_version&#39;</span>, <span style=color:#a5d6ff>&#39;prediction&#39;</span>]
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>prediction_latency <span style=color:#ff7b72;font-weight:700>=</span> Histogram(
</span></span><span style=display:flex><span>    <span style=color:#a5d6ff>&#39;ml_prediction_duration_seconds&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#a5d6ff>&#39;Prediction latency&#39;</span>,
</span></span><span style=display:flex><span>    [<span style=color:#a5d6ff>&#39;model_version&#39;</span>]
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>prediction_drift <span style=color:#ff7b72;font-weight:700>=</span> Gauge(
</span></span><span style=display:flex><span>    <span style=color:#a5d6ff>&#39;ml_prediction_distribution&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#a5d6ff>&#39;Prediction distribution&#39;</span>,
</span></span><span style=display:flex><span>    [<span style=color:#a5d6ff>&#39;model_version&#39;</span>, <span style=color:#a5d6ff>&#39;prediction_class&#39;</span>]
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>class</span> <span style=color:#f0883e;font-weight:700>ModelMonitor</span>:
</span></span><span style=display:flex><span>    <span style=color:#a5d6ff>&#34;&#34;&#34;æ¨¡å‹ç›‘æ§å™¨&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>__init__</span>(self, model_version: str, expected_distribution: dict):
</span></span><span style=display:flex><span>        self<span style=color:#ff7b72;font-weight:700>.</span>model_version <span style=color:#ff7b72;font-weight:700>=</span> model_version
</span></span><span style=display:flex><span>        self<span style=color:#ff7b72;font-weight:700>.</span>expected_distribution <span style=color:#ff7b72;font-weight:700>=</span> expected_distribution
</span></span><span style=display:flex><span>        self<span style=color:#ff7b72;font-weight:700>.</span>actual_predictions <span style=color:#ff7b72;font-weight:700>=</span> []
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>log_prediction</span>(
</span></span><span style=display:flex><span>        self,
</span></span><span style=display:flex><span>        prediction: int,
</span></span><span style=display:flex><span>        probability: float,
</span></span><span style=display:flex><span>        latency: float
</span></span><span style=display:flex><span>    ):
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;&#34;&#34;è®°å½•é¢„æµ‹&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        prediction_count<span style=color:#ff7b72;font-weight:700>.</span>labels(
</span></span><span style=display:flex><span>            model_version<span style=color:#ff7b72;font-weight:700>=</span>self<span style=color:#ff7b72;font-weight:700>.</span>model_version,
</span></span><span style=display:flex><span>            prediction<span style=color:#ff7b72;font-weight:700>=</span>str(prediction)
</span></span><span style=display:flex><span>        )<span style=color:#ff7b72;font-weight:700>.</span>inc()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        prediction_latency<span style=color:#ff7b72;font-weight:700>.</span>labels(
</span></span><span style=display:flex><span>            model_version<span style=color:#ff7b72;font-weight:700>=</span>self<span style=color:#ff7b72;font-weight:700>.</span>model_version
</span></span><span style=display:flex><span>        )<span style=color:#ff7b72;font-weight:700>.</span>observe(latency)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        self<span style=color:#ff7b72;font-weight:700>.</span>actual_predictions<span style=color:#ff7b72;font-weight:700>.</span>append(prediction)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>check_drift</span>(self, threshold: float <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>0.1</span>) <span style=color:#ff7b72;font-weight:700>-&gt;</span> bool:
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;&#34;&#34;æ£€æŸ¥æ¼‚ç§»&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>if</span> len(self<span style=color:#ff7b72;font-weight:700>.</span>actual_predictions) <span style=color:#ff7b72;font-weight:700>&lt;</span> <span style=color:#a5d6ff>100</span>:
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>return</span> <span style=color:#79c0ff>False</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># è®¡ç®—å®é™…åˆ†å¸ƒ</span>
</span></span><span style=display:flex><span>        actual_dist <span style=color:#ff7b72;font-weight:700>=</span> {}
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>for</span> pred <span style=color:#ff7b72;font-weight:700>in</span> self<span style=color:#ff7b72;font-weight:700>.</span>actual_predictions:
</span></span><span style=display:flex><span>            actual_dist[pred] <span style=color:#ff7b72;font-weight:700>=</span> actual_dist<span style=color:#ff7b72;font-weight:700>.</span>get(pred, <span style=color:#a5d6ff>0</span>) <span style=color:#ff7b72;font-weight:700>+</span> <span style=color:#a5d6ff>1</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>for</span> key <span style=color:#ff7b72;font-weight:700>in</span> actual_dist:
</span></span><span style=display:flex><span>            actual_dist[key] <span style=color:#ff7b72;font-weight:700>/=</span> len(self<span style=color:#ff7b72;font-weight:700>.</span>actual_predictions)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># è®¡ç®—åˆ†å¸ƒå·®å¼‚</span>
</span></span><span style=display:flex><span>        drift_score <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>0.0</span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>for</span> key <span style=color:#ff7b72;font-weight:700>in</span> self<span style=color:#ff7b72;font-weight:700>.</span>expected_distribution:
</span></span><span style=display:flex><span>            expected <span style=color:#ff7b72;font-weight:700>=</span> self<span style=color:#ff7b72;font-weight:700>.</span>expected_distribution<span style=color:#ff7b72;font-weight:700>.</span>get(key, <span style=color:#a5d6ff>0</span>)
</span></span><span style=display:flex><span>            actual <span style=color:#ff7b72;font-weight:700>=</span> actual_dist<span style=color:#ff7b72;font-weight:700>.</span>get(key, <span style=color:#a5d6ff>0</span>)
</span></span><span style=display:flex><span>            drift_score <span style=color:#ff7b72;font-weight:700>+=</span> abs(expected <span style=color:#ff7b72;font-weight:700>-</span> actual)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>return</span> drift_score <span style=color:#ff7b72;font-weight:700>&gt;</span> threshold
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>update_distribution</span>(self):
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;&#34;&#34;æ›´æ–°æœŸæœ›åˆ†å¸ƒ&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>if</span> len(self<span style=color:#ff7b72;font-weight:700>.</span>actual_predictions) <span style=color:#ff7b72;font-weight:700>&lt;</span> <span style=color:#a5d6ff>100</span>:
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>return</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        new_dist <span style=color:#ff7b72;font-weight:700>=</span> {}
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>for</span> pred <span style=color:#ff7b72;font-weight:700>in</span> self<span style=color:#ff7b72;font-weight:700>.</span>actual_predictions:
</span></span><span style=display:flex><span>            new_dist[pred] <span style=color:#ff7b72;font-weight:700>=</span> new_dist<span style=color:#ff7b72;font-weight:700>.</span>get(pred, <span style=color:#a5d6ff>0</span>) <span style=color:#ff7b72;font-weight:700>+</span> <span style=color:#a5d6ff>1</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>for</span> key <span style=color:#ff7b72;font-weight:700>in</span> new_dist:
</span></span><span style=display:flex><span>            new_dist[key] <span style=color:#ff7b72;font-weight:700>/=</span> len(self<span style=color:#ff7b72;font-weight:700>.</span>actual_predictions)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        self<span style=color:#ff7b72;font-weight:700>.</span>expected_distribution <span style=color:#ff7b72;font-weight:700>=</span> new_dist
</span></span><span style=display:flex><span>        self<span style=color:#ff7b72;font-weight:700>.</span>actual_predictions <span style=color:#ff7b72;font-weight:700>=</span> []
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>class</span> <span style=color:#f0883e;font-weight:700>DataDriftDetector</span>:
</span></span><span style=display:flex><span>    <span style=color:#a5d6ff>&#34;&#34;&#34;æ•°æ®æ¼‚ç§»æ£€æµ‹å™¨&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>__init__</span>(self, reference_data: np<span style=color:#ff7b72;font-weight:700>.</span>ndarray):
</span></span><span style=display:flex><span>        self<span style=color:#ff7b72;font-weight:700>.</span>reference_data <span style=color:#ff7b72;font-weight:700>=</span> reference_data
</span></span><span style=display:flex><span>        self<span style=color:#ff7b72;font-weight:700>.</span>reference_mean <span style=color:#ff7b72;font-weight:700>=</span> np<span style=color:#ff7b72;font-weight:700>.</span>mean(reference_data, axis<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>0</span>)
</span></span><span style=display:flex><span>        self<span style=color:#ff7b72;font-weight:700>.</span>reference_std <span style=color:#ff7b72;font-weight:700>=</span> np<span style=color:#ff7b72;font-weight:700>.</span>std(reference_data, axis<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>0</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>detect_drift</span>(
</span></span><span style=display:flex><span>        self,
</span></span><span style=display:flex><span>        current_data: np<span style=color:#ff7b72;font-weight:700>.</span>ndarray,
</span></span><span style=display:flex><span>        threshold: float <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>3.0</span>
</span></span><span style=display:flex><span>    ) <span style=color:#ff7b72;font-weight:700>-&gt;</span> dict:
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;&#34;&#34;æ£€æµ‹æ•°æ®æ¼‚ç§»&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        current_mean <span style=color:#ff7b72;font-weight:700>=</span> np<span style=color:#ff7b72;font-weight:700>.</span>mean(current_data, axis<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>0</span>)
</span></span><span style=display:flex><span>        current_std <span style=color:#ff7b72;font-weight:700>=</span> np<span style=color:#ff7b72;font-weight:700>.</span>std(current_data, axis<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>0</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># Z-scoreæ£€æµ‹</span>
</span></span><span style=display:flex><span>        z_scores <span style=color:#ff7b72;font-weight:700>=</span> np<span style=color:#ff7b72;font-weight:700>.</span>abs(
</span></span><span style=display:flex><span>            (current_mean <span style=color:#ff7b72;font-weight:700>-</span> self<span style=color:#ff7b72;font-weight:700>.</span>reference_mean) <span style=color:#ff7b72;font-weight:700>/</span> self<span style=color:#ff7b72;font-weight:700>.</span>reference_std
</span></span><span style=display:flex><span>        )
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        drifted_features <span style=color:#ff7b72;font-weight:700>=</span> np<span style=color:#ff7b72;font-weight:700>.</span>where(z_scores <span style=color:#ff7b72;font-weight:700>&gt;</span> threshold)[<span style=color:#a5d6ff>0</span>]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>return</span> {
</span></span><span style=display:flex><span>            <span style=color:#a5d6ff>&#39;drift_detected&#39;</span>: len(drifted_features) <span style=color:#ff7b72;font-weight:700>&gt;</span> <span style=color:#a5d6ff>0</span>,
</span></span><span style=display:flex><span>            <span style=color:#a5d6ff>&#39;drifted_features&#39;</span>: drifted_features<span style=color:#ff7b72;font-weight:700>.</span>tolist(),
</span></span><span style=display:flex><span>            <span style=color:#a5d6ff>&#39;z_scores&#39;</span>: z_scores<span style=color:#ff7b72;font-weight:700>.</span>tolist()
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic># ä½¿ç”¨ç¤ºä¾‹</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>create_model_monitor</span>():
</span></span><span style=display:flex><span>    <span style=color:#a5d6ff>&#34;&#34;&#34;åˆ›å»ºæ¨¡å‹ç›‘æ§å™¨&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8b949e;font-style:italic># æœŸæœ›åˆ†å¸ƒï¼ˆä»è®­ç»ƒæ•°æ®è·å–ï¼‰</span>
</span></span><span style=display:flex><span>    expected_dist <span style=color:#ff7b72;font-weight:700>=</span> {
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>0</span>: <span style=color:#a5d6ff>0.95</span>,  <span style=color:#8b949e;font-style:italic># 95% æ­£å¸¸</span>
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>1</span>: <span style=color:#a5d6ff>0.05</span>   <span style=color:#8b949e;font-style:italic># 5% æ¬ºè¯ˆ</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    monitor <span style=color:#ff7b72;font-weight:700>=</span> ModelMonitor(
</span></span><span style=display:flex><span>        model_version<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>&#34;v1.0&#34;</span>,
</span></span><span style=display:flex><span>        expected_distribution<span style=color:#ff7b72;font-weight:700>=</span>expected_dist
</span></span><span style=display:flex><span>    )
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>return</span> monitor
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>async</span> <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>monitor_predictions</span>():
</span></span><span style=display:flex><span>    <span style=color:#a5d6ff>&#34;&#34;&#34;ç›‘æ§é¢„æµ‹&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    monitor <span style=color:#ff7b72;font-weight:700>=</span> create_model_monitor()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>while</span> <span style=color:#79c0ff>True</span>:
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># è·å–é¢„æµ‹ç»“æœ</span>
</span></span><span style=display:flex><span>        predictions <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#ff7b72>await</span> get_recent_predictions()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>for</span> pred <span style=color:#ff7b72;font-weight:700>in</span> predictions:
</span></span><span style=display:flex><span>            monitor<span style=color:#ff7b72;font-weight:700>.</span>log_prediction(
</span></span><span style=display:flex><span>                prediction<span style=color:#ff7b72;font-weight:700>=</span>pred[<span style=color:#a5d6ff>&#39;label&#39;</span>],
</span></span><span style=display:flex><span>                probability<span style=color:#ff7b72;font-weight:700>=</span>pred[<span style=color:#a5d6ff>&#39;probability&#39;</span>],
</span></span><span style=display:flex><span>                latency<span style=color:#ff7b72;font-weight:700>=</span>pred[<span style=color:#a5d6ff>&#39;latency&#39;</span>]
</span></span><span style=display:flex><span>            )
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># æ£€æŸ¥æ¼‚ç§»</span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>if</span> monitor<span style=color:#ff7b72;font-weight:700>.</span>check_drift():
</span></span><span style=display:flex><span>            send_alert(<span style=color:#a5d6ff>&#34;Prediction drift detected!&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>await</span> asyncio<span style=color:#ff7b72;font-weight:700>.</span>sleep(<span style=color:#a5d6ff>60</span>)  <span style=color:#8b949e;font-style:italic># æ¯åˆ†é’Ÿæ£€æŸ¥</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=42-abæµ‹è¯•æ¡†æ¶>4.2 A/Bæµ‹è¯•æ¡†æ¶<a hidden class=anchor aria-hidden=true href=#42-abæµ‹è¯•æ¡†æ¶>#</a></h3><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 56
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 57
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 58
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 59
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 60
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 61
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 62
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 63
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 64
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 65
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 66
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 67
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 68
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 69
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 70
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 71
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 72
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 73
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 74
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 75
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 76
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 77
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 78
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 79
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 80
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 81
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 82
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 83
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 84
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 85
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 86
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 87
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 88
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 89
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 90
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 91
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 92
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 93
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 94
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 95
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 96
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 97
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 98
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 99
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">100
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">101
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">102
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">103
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">104
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">105
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">106
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">107
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">108
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">109
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">110
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">111
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">112
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">113
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">114
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">115
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">116
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">117
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">118
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">119
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">120
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">121
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">122
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">123
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">124
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">125
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">126
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">127
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">128
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">129
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">130
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">131
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">132
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">133
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">134
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">135
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">136
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">137
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">138
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">139
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">140
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">141
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">142
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">143
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">144
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">145
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">146
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">147
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">148
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">149
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">150
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">151
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">152
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">153
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">154
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">155
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">156
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">157
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">158
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">159
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">160
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">161
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#8b949e;font-style:italic># ========== A/Bæµ‹è¯•æ¡†æ¶ ==========</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>class</span> <span style=color:#f0883e;font-weight:700>ABTest</span>:
</span></span><span style=display:flex><span>    <span style=color:#a5d6ff>&#34;&#34;&#34;A/Bæµ‹è¯•&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>__init__</span>(
</span></span><span style=display:flex><span>        self,
</span></span><span style=display:flex><span>        name: str,
</span></span><span style=display:flex><span>        variants: List[str],
</span></span><span style=display:flex><span>        traffic_split: Dict[str, float],
</span></span><span style=display:flex><span>        metrics: List[str]
</span></span><span style=display:flex><span>    ):
</span></span><span style=display:flex><span>        self<span style=color:#ff7b72;font-weight:700>.</span>name <span style=color:#ff7b72;font-weight:700>=</span> name
</span></span><span style=display:flex><span>        self<span style=color:#ff7b72;font-weight:700>.</span>variants <span style=color:#ff7b72;font-weight:700>=</span> variants
</span></span><span style=display:flex><span>        self<span style=color:#ff7b72;font-weight:700>.</span>traffic_split <span style=color:#ff7b72;font-weight:700>=</span> traffic_split
</span></span><span style=display:flex><span>        self<span style=color:#ff7b72;font-weight:700>.</span>metrics <span style=color:#ff7b72;font-weight:700>=</span> metrics
</span></span><span style=display:flex><span>        self<span style=color:#ff7b72;font-weight:700>.</span>results <span style=color:#ff7b72;font-weight:700>=</span> {variant: {metric: [] <span style=color:#ff7b72>for</span> metric <span style=color:#ff7b72;font-weight:700>in</span> metrics} <span style=color:#ff7b72>for</span> variant <span style=color:#ff7b72;font-weight:700>in</span> variants}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>assign_variant</span>(self, user_id: str) <span style=color:#ff7b72;font-weight:700>-&gt;</span> str:
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;&#34;&#34;åˆ†é…ç”¨æˆ·åˆ°å˜ä½“&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>import</span> <span style=color:#ff7b72>hashlib</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># ä½¿ç”¨ç”¨æˆ·IDçš„å“ˆå¸Œå€¼ä¿è¯ä¸€è‡´æ€§</span>
</span></span><span style=display:flex><span>        hash_value <span style=color:#ff7b72;font-weight:700>=</span> int(hashlib<span style=color:#ff7b72;font-weight:700>.</span>md5(<span style=color:#79c0ff>f</span><span style=color:#a5d6ff>&#34;</span><span style=color:#a5d6ff>{</span>self<span style=color:#ff7b72;font-weight:700>.</span>name<span style=color:#a5d6ff>}</span><span style=color:#a5d6ff>:</span><span style=color:#a5d6ff>{</span>user_id<span style=color:#a5d6ff>}</span><span style=color:#a5d6ff>&#34;</span><span style=color:#ff7b72;font-weight:700>.</span>encode())<span style=color:#ff7b72;font-weight:700>.</span>hexdigest(), <span style=color:#a5d6ff>16</span>)
</span></span><span style=display:flex><span>        normalized <span style=color:#ff7b72;font-weight:700>=</span> hash_value <span style=color:#ff7b72;font-weight:700>/</span> (<span style=color:#a5d6ff>2</span> <span style=color:#ff7b72;font-weight:700>**</span> <span style=color:#a5d6ff>32</span> <span style=color:#ff7b72;font-weight:700>-</span> <span style=color:#a5d6ff>1</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        cumulative <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>0.0</span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>for</span> variant, percentage <span style=color:#ff7b72;font-weight:700>in</span> self<span style=color:#ff7b72;font-weight:700>.</span>traffic_split<span style=color:#ff7b72;font-weight:700>.</span>items():
</span></span><span style=display:flex><span>            cumulative <span style=color:#ff7b72;font-weight:700>+=</span> percentage
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>if</span> normalized <span style=color:#ff7b72;font-weight:700>&lt;=</span> cumulative:
</span></span><span style=display:flex><span>                <span style=color:#ff7b72>return</span> variant
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>return</span> self<span style=color:#ff7b72;font-weight:700>.</span>variants[<span style=color:#ff7b72;font-weight:700>-</span><span style=color:#a5d6ff>1</span>]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>record_metric</span>(self, variant: str, metric: str, value: float):
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;&#34;&#34;è®°å½•æŒ‡æ ‡&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>if</span> variant <span style=color:#ff7b72;font-weight:700>not</span> <span style=color:#ff7b72;font-weight:700>in</span> self<span style=color:#ff7b72;font-weight:700>.</span>results:
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>raise</span> <span style=color:#f0883e;font-weight:700>ValueError</span>(<span style=color:#79c0ff>f</span><span style=color:#a5d6ff>&#34;Unknown variant: </span><span style=color:#a5d6ff>{</span>variant<span style=color:#a5d6ff>}</span><span style=color:#a5d6ff>&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>if</span> metric <span style=color:#ff7b72;font-weight:700>not</span> <span style=color:#ff7b72;font-weight:700>in</span> self<span style=color:#ff7b72;font-weight:700>.</span>metrics:
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>raise</span> <span style=color:#f0883e;font-weight:700>ValueError</span>(<span style=color:#79c0ff>f</span><span style=color:#a5d6ff>&#34;Unknown metric: </span><span style=color:#a5d6ff>{</span>metric<span style=color:#a5d6ff>}</span><span style=color:#a5d6ff>&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        self<span style=color:#ff7b72;font-weight:700>.</span>results[variant][metric]<span style=color:#ff7b72;font-weight:700>.</span>append(value)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>analyze</span>(self) <span style=color:#ff7b72;font-weight:700>-&gt;</span> dict:
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;&#34;&#34;åˆ†æA/Bæµ‹è¯•ç»“æœ&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>from</span> <span style=color:#ff7b72>scipy</span> <span style=color:#ff7b72>import</span> stats
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        analysis <span style=color:#ff7b72;font-weight:700>=</span> {}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>for</span> metric <span style=color:#ff7b72;font-weight:700>in</span> self<span style=color:#ff7b72;font-weight:700>.</span>metrics:
</span></span><span style=display:flex><span>            metric_analysis <span style=color:#ff7b72;font-weight:700>=</span> {}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#8b949e;font-style:italic># è®¡ç®—æ¯ä¸ªå˜ä½“çš„ç»Ÿè®¡ä¿¡æ¯</span>
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>for</span> variant <span style=color:#ff7b72;font-weight:700>in</span> self<span style=color:#ff7b72;font-weight:700>.</span>variants:
</span></span><span style=display:flex><span>                values <span style=color:#ff7b72;font-weight:700>=</span> self<span style=color:#ff7b72;font-weight:700>.</span>results[variant][metric]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>                <span style=color:#ff7b72>if</span> len(values) <span style=color:#ff7b72;font-weight:700>==</span> <span style=color:#a5d6ff>0</span>:
</span></span><span style=display:flex><span>                    <span style=color:#ff7b72>continue</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>                metric_analysis[variant] <span style=color:#ff7b72;font-weight:700>=</span> {
</span></span><span style=display:flex><span>                    <span style=color:#a5d6ff>&#39;mean&#39;</span>: np<span style=color:#ff7b72;font-weight:700>.</span>mean(values),
</span></span><span style=display:flex><span>                    <span style=color:#a5d6ff>&#39;std&#39;</span>: np<span style=color:#ff7b72;font-weight:700>.</span>std(values),
</span></span><span style=display:flex><span>                    <span style=color:#a5d6ff>&#39;count&#39;</span>: len(values)
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#8b949e;font-style:italic># æ¯”è¾ƒå˜ä½“</span>
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>if</span> len(self<span style=color:#ff7b72;font-weight:700>.</span>variants) <span style=color:#ff7b72;font-weight:700>&gt;=</span> <span style=color:#a5d6ff>2</span>:
</span></span><span style=display:flex><span>                variant_a, variant_b <span style=color:#ff7b72;font-weight:700>=</span> self<span style=color:#ff7b72;font-weight:700>.</span>variants[<span style=color:#a5d6ff>0</span>], self<span style=color:#ff7b72;font-weight:700>.</span>variants[<span style=color:#a5d6ff>1</span>]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>                values_a <span style=color:#ff7b72;font-weight:700>=</span> self<span style=color:#ff7b72;font-weight:700>.</span>results[variant_a][metric]
</span></span><span style=display:flex><span>                values_b <span style=color:#ff7b72;font-weight:700>=</span> self<span style=color:#ff7b72;font-weight:700>.</span>results[variant_b][metric]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>                <span style=color:#ff7b72>if</span> len(values_a) <span style=color:#ff7b72;font-weight:700>&gt;</span> <span style=color:#a5d6ff>0</span> <span style=color:#ff7b72;font-weight:700>and</span> len(values_b) <span style=color:#ff7b72;font-weight:700>&gt;</span> <span style=color:#a5d6ff>0</span>:
</span></span><span style=display:flex><span>                    <span style=color:#8b949e;font-style:italic># tæ£€éªŒ</span>
</span></span><span style=display:flex><span>                    t_stat, p_value <span style=color:#ff7b72;font-weight:700>=</span> stats<span style=color:#ff7b72;font-weight:700>.</span>ttest_ind(values_a, values_b)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>                    metric_analysis[<span style=color:#a5d6ff>&#39;comparison&#39;</span>] <span style=color:#ff7b72;font-weight:700>=</span> {
</span></span><span style=display:flex><span>                        <span style=color:#a5d6ff>&#39;t_statistic&#39;</span>: t_stat,
</span></span><span style=display:flex><span>                        <span style=color:#a5d6ff>&#39;p_value&#39;</span>: p_value,
</span></span><span style=display:flex><span>                        <span style=color:#a5d6ff>&#39;significant&#39;</span>: p_value <span style=color:#ff7b72;font-weight:700>&lt;</span> <span style=color:#a5d6ff>0.05</span>,
</span></span><span style=display:flex><span>                        <span style=color:#a5d6ff>&#39;lift&#39;</span>: (
</span></span><span style=display:flex><span>                            metric_analysis[variant_b][<span style=color:#a5d6ff>&#39;mean&#39;</span>] <span style=color:#ff7b72;font-weight:700>-</span>
</span></span><span style=display:flex><span>                            metric_analysis[variant_a][<span style=color:#a5d6ff>&#39;mean&#39;</span>]
</span></span><span style=display:flex><span>                        ) <span style=color:#ff7b72;font-weight:700>/</span> metric_analysis[variant_a][<span style=color:#a5d6ff>&#39;mean&#39;</span>]
</span></span><span style=display:flex><span>                    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            analysis[metric] <span style=color:#ff7b72;font-weight:700>=</span> metric_analysis
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>return</span> analysis
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>get_winner</span>(self) <span style=color:#ff7b72;font-weight:700>-&gt;</span> str:
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;&#34;&#34;ç¡®å®šè·èƒœå˜ä½“&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        analysis <span style=color:#ff7b72;font-weight:700>=</span> self<span style=color:#ff7b72;font-weight:700>.</span>analyze()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># ç®€å•ç­–ç•¥ï¼šé€‰æ‹©ä¸»è¦æŒ‡æ ‡æœ€é«˜çš„å˜ä½“</span>
</span></span><span style=display:flex><span>        primary_metric <span style=color:#ff7b72;font-weight:700>=</span> self<span style=color:#ff7b72;font-weight:700>.</span>metrics[<span style=color:#a5d6ff>0</span>]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        best_variant <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#79c0ff>None</span>
</span></span><span style=display:flex><span>        best_value <span style=color:#ff7b72;font-weight:700>=</span> float(<span style=color:#a5d6ff>&#39;-inf&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>for</span> variant <span style=color:#ff7b72;font-weight:700>in</span> self<span style=color:#ff7b72;font-weight:700>.</span>variants:
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>if</span> primary_metric <span style=color:#ff7b72;font-weight:700>in</span> analysis:
</span></span><span style=display:flex><span>                value <span style=color:#ff7b72;font-weight:700>=</span> analysis[primary_metric]<span style=color:#ff7b72;font-weight:700>.</span>get(variant, {})<span style=color:#ff7b72;font-weight:700>.</span>get(<span style=color:#a5d6ff>&#39;mean&#39;</span>, float(<span style=color:#a5d6ff>&#39;-inf&#39;</span>))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>                <span style=color:#ff7b72>if</span> value <span style=color:#ff7b72;font-weight:700>&gt;</span> best_value:
</span></span><span style=display:flex><span>                    best_value <span style=color:#ff7b72;font-weight:700>=</span> value
</span></span><span style=display:flex><span>                    best_variant <span style=color:#ff7b72;font-weight:700>=</span> variant
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>return</span> best_variant
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic># ä½¿ç”¨ç¤ºä¾‹</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>run_ab_test</span>():
</span></span><span style=display:flex><span>    <span style=color:#a5d6ff>&#34;&#34;&#34;è¿è¡ŒA/Bæµ‹è¯•&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8b949e;font-style:italic># åˆ›å»ºA/Bæµ‹è¯•</span>
</span></span><span style=display:flex><span>    ab_test <span style=color:#ff7b72;font-weight:700>=</span> ABTest(
</span></span><span style=display:flex><span>        name<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>&#34;fraud_detection_v2&#34;</span>,
</span></span><span style=display:flex><span>        variants<span style=color:#ff7b72;font-weight:700>=</span>[<span style=color:#a5d6ff>&#34;control&#34;</span>, <span style=color:#a5d6ff>&#34;treatment&#34;</span>],
</span></span><span style=display:flex><span>        traffic_split<span style=color:#ff7b72;font-weight:700>=</span>{<span style=color:#a5d6ff>&#34;control&#34;</span>: <span style=color:#a5d6ff>0.5</span>, <span style=color:#a5d6ff>&#34;treatment&#34;</span>: <span style=color:#a5d6ff>0.5</span>},
</span></span><span style=display:flex><span>        metrics<span style=color:#ff7b72;font-weight:700>=</span>[<span style=color:#a5d6ff>&#34;accuracy&#34;</span>, <span style=color:#a5d6ff>&#34;precision&#34;</span>, <span style=color:#a5d6ff>&#34;recall&#34;</span>, <span style=color:#a5d6ff>&#34;f1_score&#34;</span>]
</span></span><span style=display:flex><span>    )
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8b949e;font-style:italic># åˆ†é…ç”¨æˆ·å¹¶è®°å½•æŒ‡æ ‡</span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>async</span> <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>process_prediction</span>(user_id: str, prediction: dict, actual: int):
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;&#34;&#34;å¤„ç†é¢„æµ‹å¹¶è®°å½•æŒ‡æ ‡&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        variant <span style=color:#ff7b72;font-weight:700>=</span> ab_test<span style=color:#ff7b72;font-weight:700>.</span>assign_variant(user_id)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># ä½¿ç”¨å¯¹åº”å˜ä½“çš„æ¨¡å‹</span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>if</span> variant <span style=color:#ff7b72;font-weight:700>==</span> <span style=color:#a5d6ff>&#34;control&#34;</span>:
</span></span><span style=display:flex><span>            result <span style=color:#ff7b72;font-weight:700>=</span> control_model<span style=color:#ff7b72;font-weight:700>.</span>predict(prediction[<span style=color:#a5d6ff>&#39;features&#39;</span>])
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>else</span>:
</span></span><span style=display:flex><span>            result <span style=color:#ff7b72;font-weight:700>=</span> treatment_model<span style=color:#ff7b72;font-weight:700>.</span>predict(prediction[<span style=color:#a5d6ff>&#39;features&#39;</span>])
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># è®¡ç®—æŒ‡æ ‡</span>
</span></span><span style=display:flex><span>        accuracy <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>1</span> <span style=color:#ff7b72>if</span> result[<span style=color:#a5d6ff>&#39;prediction&#39;</span>] <span style=color:#ff7b72;font-weight:700>==</span> actual <span style=color:#ff7b72>else</span> <span style=color:#a5d6ff>0</span>
</span></span><span style=display:flex><span>        precision <span style=color:#ff7b72;font-weight:700>=</span> calculate_precision(result, actual)
</span></span><span style=display:flex><span>        recall <span style=color:#ff7b72;font-weight:700>=</span> calculate_recall(result, actual)
</span></span><span style=display:flex><span>        f1_score <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>2</span> <span style=color:#ff7b72;font-weight:700>*</span> (precision <span style=color:#ff7b72;font-weight:700>*</span> recall) <span style=color:#ff7b72;font-weight:700>/</span> (precision <span style=color:#ff7b72;font-weight:700>+</span> recall)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># è®°å½•æŒ‡æ ‡</span>
</span></span><span style=display:flex><span>        ab_test<span style=color:#ff7b72;font-weight:700>.</span>record_metric(variant, <span style=color:#a5d6ff>&#34;accuracy&#34;</span>, accuracy)
</span></span><span style=display:flex><span>        ab_test<span style=color:#ff7b72;font-weight:700>.</span>record_metric(variant, <span style=color:#a5d6ff>&#34;precision&#34;</span>, precision)
</span></span><span style=display:flex><span>        ab_test<span style=color:#ff7b72;font-weight:700>.</span>record_metric(variant, <span style=color:#a5d6ff>&#34;recall&#34;</span>, recall)
</span></span><span style=display:flex><span>        ab_test<span style=color:#ff7b72;font-weight:700>.</span>record_metric(variant, <span style=color:#a5d6ff>&#34;f1_score&#34;</span>, f1_score)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8b949e;font-style:italic># åˆ†æç»“æœ</span>
</span></span><span style=display:flex><span>    analysis <span style=color:#ff7b72;font-weight:700>=</span> ab_test<span style=color:#ff7b72;font-weight:700>.</span>analyze()
</span></span><span style=display:flex><span>    print(<span style=color:#a5d6ff>&#34;A/B Test Analysis:&#34;</span>)
</span></span><span style=display:flex><span>    print(analysis)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8b949e;font-style:italic># è·å–è·èƒœå˜ä½“</span>
</span></span><span style=display:flex><span>    winner <span style=color:#ff7b72;font-weight:700>=</span> ab_test<span style=color:#ff7b72;font-weight:700>.</span>get_winner()
</span></span><span style=display:flex><span>    print(<span style=color:#79c0ff>f</span><span style=color:#a5d6ff>&#34;Winner: </span><span style=color:#a5d6ff>{</span>winner<span style=color:#a5d6ff>}</span><span style=color:#a5d6ff>&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>return</span> analysis, winner
</span></span></code></pre></td></tr></table></div></div><h2 id=äº”ç«¯åˆ°ç«¯mlopsæµæ°´çº¿>äº”ã€ç«¯åˆ°ç«¯MLOpsæµæ°´çº¿<a hidden class=anchor aria-hidden=true href=#äº”ç«¯åˆ°ç«¯mlopsæµæ°´çº¿>#</a></h2><h3 id=51-cicdé›†æˆ>5.1 CI/CDé›†æˆ<a hidden class=anchor aria-hidden=true href=#51-cicdé›†æˆ>#</a></h3><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">56
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">57
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">58
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">59
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">60
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">61
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">62
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">63
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">64
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">65
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">66
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">67
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">68
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">69
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">70
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">71
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">72
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">73
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">74
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">75
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">76
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">77
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">78
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">79
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">80
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">81
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">82
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">83
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">84
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">85
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">86
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">87
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">88
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">89
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">90
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">91
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">92
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">93
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">94
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">95
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#8b949e;font-style:italic># .github/workflows/mlops-pipeline.yml</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681></span><span style=color:#7ee787>name</span>:<span style=color:#6e7681> </span><span style=color:#a5d6ff>MLOps Pipeline</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681></span><span style=color:#7ee787>on</span>:<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>  </span><span style=color:#7ee787>push</span>:<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span><span style=color:#7ee787>branches</span>:<span style=color:#6e7681> </span>[<span style=color:#a5d6ff>main]</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span><span style=color:#7ee787>paths</span>:<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>      </span>- <span style=color:#a5d6ff>&#39;models/**&#39;</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>      </span>- <span style=color:#a5d6ff>&#39;data/**&#39;</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>      </span>- <span style=color:#a5d6ff>&#39;training/**&#39;</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>  </span><span style=color:#7ee787>pull_request</span>:<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span><span style=color:#7ee787>branches</span>:<span style=color:#6e7681> </span>[<span style=color:#a5d6ff>main]</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681></span><span style=color:#7ee787>jobs</span>:<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>  </span><span style=color:#7ee787>data-validation</span>:<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span><span style=color:#7ee787>runs-on</span>:<span style=color:#6e7681> </span><span style=color:#a5d6ff>ubuntu-latest</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span><span style=color:#7ee787>steps</span>:<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>      </span>- <span style=color:#7ee787>uses</span>:<span style=color:#6e7681> </span><span style=color:#a5d6ff>actions/checkout@v3</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>      </span>- <span style=color:#7ee787>name</span>:<span style=color:#6e7681> </span><span style=color:#a5d6ff>Set up Python</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>        </span><span style=color:#7ee787>uses</span>:<span style=color:#6e7681> </span><span style=color:#a5d6ff>actions/setup-python@v4</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>        </span><span style=color:#7ee787>with</span>:<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>          </span><span style=color:#7ee787>python-version</span>:<span style=color:#6e7681> </span><span style=color:#a5d6ff>&#39;3.9&#39;</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>      </span>- <span style=color:#7ee787>name</span>:<span style=color:#6e7681> </span><span style=color:#a5d6ff>Install dependencies</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>        </span><span style=color:#7ee787>run</span>:<span style=color:#6e7681> </span>|<span style=color:#a5d6ff>
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>          pip install -r requirements.txt</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>      </span>- <span style=color:#7ee787>name</span>:<span style=color:#6e7681> </span><span style=color:#a5d6ff>Validate data</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>        </span><span style=color:#7ee787>run</span>:<span style=color:#6e7681> </span>|<span style=color:#a5d6ff>
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>          python scripts/validate_data.py</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>      </span>- <span style=color:#7ee787>name</span>:<span style=color:#6e7681> </span><span style=color:#a5d6ff>Check data drift</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>        </span><span style=color:#7ee787>run</span>:<span style=color:#6e7681> </span>|<span style=color:#a5d6ff>
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>          python scripts/check_drift.py</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>  </span><span style=color:#7ee787>train-model</span>:<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span><span style=color:#7ee787>needs</span>:<span style=color:#6e7681> </span><span style=color:#a5d6ff>data-validation</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span><span style=color:#7ee787>runs-on</span>:<span style=color:#6e7681> </span><span style=color:#a5d6ff>ubuntu-latest</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span><span style=color:#7ee787>steps</span>:<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>      </span>- <span style=color:#7ee787>uses</span>:<span style=color:#6e7681> </span><span style=color:#a5d6ff>actions/checkout@v3</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>      </span>- <span style=color:#7ee787>name</span>:<span style=color:#6e7681> </span><span style=color:#a5d6ff>Set up Python</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>        </span><span style=color:#7ee787>uses</span>:<span style=color:#6e7681> </span><span style=color:#a5d6ff>actions/setup-python@v4</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>        </span><span style=color:#7ee787>with</span>:<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>          </span><span style=color:#7ee787>python-version</span>:<span style=color:#6e7681> </span><span style=color:#a5d6ff>&#39;3.9&#39;</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>      </span>- <span style=color:#7ee787>name</span>:<span style=color:#6e7681> </span><span style=color:#a5d6ff>Install dependencies</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>        </span><span style=color:#7ee787>run</span>:<span style=color:#6e7681> </span>|<span style=color:#a5d6ff>
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>          pip install -r requirements.txt</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>      </span>- <span style=color:#7ee787>name</span>:<span style=color:#6e7681> </span><span style=color:#a5d6ff>Train model</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>        </span><span style=color:#7ee787>env</span>:<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>          </span><span style=color:#7ee787>MLFLOW_TRACKING_URI</span>:<span style=color:#6e7681> </span><span style=color:#a5d6ff>${{ secrets.MLFLOW_TRACKING_URI }}</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>        </span><span style=color:#7ee787>run</span>:<span style=color:#6e7681> </span>|<span style=color:#a5d6ff>
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>          python scripts/train_model.py</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>      </span>- <span style=color:#7ee787>name</span>:<span style=color:#6e7681> </span><span style=color:#a5d6ff>Run tests</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>        </span><span style=color:#7ee787>run</span>:<span style=color:#6e7681> </span>|<span style=color:#a5d6ff>
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>          pytest tests/</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>  </span><span style=color:#7ee787>evaluate-model</span>:<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span><span style=color:#7ee787>needs</span>:<span style=color:#6e7681> </span><span style=color:#a5d6ff>train-model</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span><span style=color:#7ee787>runs-on</span>:<span style=color:#6e7681> </span><span style=color:#a5d6ff>ubuntu-latest</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span><span style=color:#7ee787>steps</span>:<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>      </span>- <span style=color:#7ee787>uses</span>:<span style=color:#6e7681> </span><span style=color:#a5d6ff>actions/checkout@v3</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>      </span>- <span style=color:#7ee787>name</span>:<span style=color:#6e7681> </span><span style=color:#a5d6ff>Evaluate model</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>        </span><span style=color:#7ee787>env</span>:<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>          </span><span style=color:#7ee787>MLFLOW_TRACKING_URI</span>:<span style=color:#6e7681> </span><span style=color:#a5d6ff>${{ secrets.MLFLOW_TRACKING_URI }}</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>        </span><span style=color:#7ee787>run</span>:<span style=color:#6e7681> </span>|<span style=color:#a5d6ff>
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>          python scripts/evaluate_model.py</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>      </span>- <span style=color:#7ee787>name</span>:<span style=color:#6e7681> </span><span style=color:#a5d6ff>Check thresholds</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>        </span><span style=color:#7ee787>run</span>:<span style=color:#6e7681> </span>|<span style=color:#a5d6ff>
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>          python scripts/check_thresholds.py</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>  </span><span style=color:#7ee787>deploy-model</span>:<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span><span style=color:#7ee787>needs</span>:<span style=color:#6e7681> </span><span style=color:#a5d6ff>evaluate-model</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span><span style=color:#7ee787>if</span>:<span style=color:#6e7681> </span><span style=color:#a5d6ff>github.ref == &#39;refs/heads/main&#39;</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span><span style=color:#7ee787>runs-on</span>:<span style=color:#6e7681> </span><span style=color:#a5d6ff>ubuntu-latest</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span><span style=color:#7ee787>steps</span>:<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>      </span>- <span style=color:#7ee787>uses</span>:<span style=color:#6e7681> </span><span style=color:#a5d6ff>actions/checkout@v3</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>      </span>- <span style=color:#7ee787>name</span>:<span style=color:#6e7681> </span><span style=color:#a5d6ff>Deploy to staging</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>        </span><span style=color:#7ee787>run</span>:<span style=color:#6e7681> </span>|<span style=color:#a5d6ff>
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>          kubectl apply -f k8s/staging/</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>      </span>- <span style=color:#7ee787>name</span>:<span style=color:#6e7681> </span><span style=color:#a5d6ff>Run smoke tests</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>        </span><span style=color:#7ee787>run</span>:<span style=color:#6e7681> </span>|<span style=color:#a5d6ff>
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>          python scripts/smoke_test.py</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>      </span>- <span style=color:#7ee787>name</span>:<span style=color:#6e7681> </span><span style=color:#a5d6ff>Promote to production</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>        </span><span style=color:#7ee787>run</span>:<span style=color:#6e7681> </span>|<span style=color:#a5d6ff>
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>          kubectl apply -f k8s/production/</span><span style=color:#6e7681>
</span></span></span></code></pre></td></tr></table></div></div><h3 id=52-å®Œæ•´mlopsé¡¹ç›®ç»“æ„>5.2 å®Œæ•´MLOpsé¡¹ç›®ç»“æ„<a hidden class=anchor aria-hidden=true href=#52-å®Œæ•´mlopsé¡¹ç›®ç»“æ„>#</a></h3><pre tabindex=0><code>mlops-project/
â”œâ”€â”€ data/
â”‚   â”œâ”€â”€ raw/                  # åŸå§‹æ•°æ®
â”‚   â”œâ”€â”€ processed/            # å¤„ç†åæ•°æ®
â”‚   â””â”€â”€ features/             # ç‰¹å¾æ•°æ®
â”œâ”€â”€ models/
â”‚   â”œâ”€â”€ training/             # è®­ç»ƒè„šæœ¬
â”‚   â”‚   â”œâ”€â”€ train.py
â”‚   â”‚   â”œâ”€â”€ evaluate.py
â”‚   â”‚   â””â”€â”€ tune.py
â”‚   â”œâ”€â”€ inference/            # æ¨ç†ä»£ç 
â”‚   â”‚   â”œâ”€â”€ predict.py
â”‚   â”‚   â””â”€â”€ batch_predict.py
â”‚   â””â”€â”€ monitoring/           # ç›‘æ§è„šæœ¬
â”‚       â”œâ”€â”€ drift_detector.py
â”‚       â””â”€â”€ performance_monitor.py
â”œâ”€â”€ features/
â”‚   â”œâ”€â”€ feature_store.py      # ç‰¹å¾å­˜å‚¨
â”‚   â””â”€â”€ feature_registry.py   # ç‰¹å¾æ³¨å†Œè¡¨
â”œâ”€â”€ experiments/
â”‚   â””â”€â”€ notebooks/            # å®éªŒç¬”è®°æœ¬
â”œâ”€â”€ tests/
â”‚   â”œâ”€â”€ unit/
â”‚   â”œâ”€â”€ integration/
â”‚   â””â”€â”€ performance/
â”œâ”€â”€ deployment/
â”‚   â”œâ”€â”€ k8s/                  # Kubernetesé…ç½®
â”‚   â”œâ”€â”€ docker/               # Dockerfile
â”‚   â””â”€â”€ terraform/            # åŸºç¡€è®¾æ–½ä»£ç 
â”œâ”€â”€ mlflow/                   # MLflowé…ç½®
â”œâ”€â”€ dvc/                      # DVCé…ç½®
â”œâ”€â”€ requirements.txt
â””â”€â”€ README.md
</code></pre><h2 id=æ€»ç»“>æ€»ç»“<a hidden class=anchor aria-hidden=true href=#æ€»ç»“>#</a></h2><p>AI/MLç³»ç»Ÿçš„å·¥ç¨‹åŒ–å®è·µéœ€è¦ï¼š</p><ol><li><strong>å®éªŒç®¡ç†</strong>ï¼šç³»ç»ŸåŒ–è¿½è¸ªæ¨¡å‹è®­ç»ƒå®éªŒ</li><li><strong>ç‰¹å¾å·¥ç¨‹</strong>ï¼šæ„å»ºå¯å¤ç”¨çš„ç‰¹å¾å­˜å‚¨å’Œç®¡é“</li><li><strong>æ¨¡å‹éƒ¨ç½²</strong>ï¼šå®ç°å¯é çš„æ¨¡å‹æœåŠ¡åŒ–å’Œç‰ˆæœ¬ç®¡ç†</li><li><strong>ç›‘æ§å‘Šè­¦</strong>ï¼šæŒç»­ç›‘æ§æ¨¡å‹æ€§èƒ½å’Œæ•°æ®æ¼‚ç§»</li><li><strong>A/Bæµ‹è¯•</strong>ï¼šç§‘å­¦åœ°è¯„ä¼°æ¨¡å‹æ”¹è¿›æ•ˆæœ</li></ol><p>æˆåŠŸçš„MLOpså®è·µä¸ä»…ä»…æ˜¯æŠ€æœ¯é—®é¢˜ï¼Œæ›´éœ€è¦å›¢é˜Ÿåä½œå’Œæµç¨‹ä¼˜åŒ–ã€‚</p><blockquote><p><strong>ç›¸å…³å·¥å…·æ¨è</strong></p><ul><li><a href=https://www.util.cn/tools/json-formatter/>JSONæ ¼å¼åŒ–å·¥å…·</a> - JSONæ•°æ®å¤„ç†</li><li><a href=https://www.util.cn/tools/regex-tester/>æ­£åˆ™è¡¨è¾¾å¼æµ‹è¯•</a> - æ–‡æœ¬å¤„ç†</li><li><a href=https://www.util.cn/tools/base64-encode/>Base64ç¼–ç å·¥å…·</a> - æ•°æ®ç¼–ç </li></ul></blockquote></div><footer class=post-footer-modern><div class=post-tags-modern><span class=tags-label>ğŸ·ï¸ æ ‡ç­¾</span><div class=tags-list><a href=/blog/tags/mlops/ class=tag-pill>MLOps
</a><a href=/blog/tags/%E6%A8%A1%E5%9E%8B%E9%83%A8%E7%BD%B2/ class=tag-pill>æ¨¡å‹éƒ¨ç½²
</a><a href=/blog/tags/%E7%89%B9%E5%BE%81%E5%B7%A5%E7%A8%8B/ class=tag-pill>ç‰¹å¾å·¥ç¨‹
</a><a href=/blog/tags/%E6%A8%A1%E5%9E%8B%E7%9B%91%E6%8E%A7/ class=tag-pill>æ¨¡å‹ç›‘æ§
</a><a href=/blog/tags/a/b%E6%B5%8B%E8%AF%95/ class=tag-pill>A/Bæµ‹è¯•</a></div></div><style>.post-footer-modern{margin-top:3rem;padding-top:2rem;border-top:1px solid var(--border,#333333)}.post-tags-modern{display:flex;align-items:center;gap:1rem;margin-bottom:2rem;flex-wrap:wrap}.tags-label{font-size:.875rem;font-weight:600;color:var(--secondary,#999999) !important;white-space:nowrap}.tags-list{display:flex;flex-wrap:wrap;gap:.5rem;flex:1}.tag-pill{display:inline-block;padding:.25rem .75rem;background:rgba(255,255,255,5%);border:1px solid var(--border,#333333);border-radius:0;color:var(--secondary,#cccccc) !important;text-decoration:none;font-size:.8rem;font-weight:500;transition:all .2s ease}.tag-pill:hover{background:var(--primary,#ffffff);color:var(--background,#000000) !important;border-color:var(--primary,#ffffff);transform:translateY(-1px)}.post-nav-modern{margin-top:2rem}.nav-grid{display:grid;grid-template-columns:1fr 1fr;gap:1rem}.nav-card{display:flex;align-items:center;gap:1rem;padding:1.25rem;background:rgba(255,255,255,2%);border:1px solid var(--border,#333333);border-radius:12px;text-decoration:none;transition:all .2s ease;min-height:80px}.nav-card:hover{background:rgba(255,255,255,5%);border-color:var(--primary,#ffffff);transform:translateY(-2px)}.nav-card.nav-prev{justify-content:flex-start}.nav-card.nav-next{justify-content:flex-end;text-align:right}.nav-card.nav-next .nav-content{text-align:right}.nav-empty{display:flex;align-items:center;justify-content:center;background:rgba(255,255,255,1%);border:1px dashed var(--border,#333333);color:var(--secondary,#666666)}.nav-arrow{font-size:1.5rem;color:var(--primary,#ffffff);font-weight:300}.nav-content{flex:1}.nav-title{font-size:.95rem;font-weight:600;color:var(--primary,#ffffff) !important;line-height:1.4;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden}[data-theme=light] .post-footer-modern{border-color:var(--border-light,#dee2e6)}[data-theme=light] .tags-label{color:var(--secondary-light,#6c757d) !important}[data-theme=light] .tag-pill{background:rgba(0,0,0,5%);border-color:var(--border-light,#dee2e6);color:var(--secondary-light,#495057) !important}[data-theme=light] .tag-pill:hover{background:var(--primary-light,#0066cc);color:var(--background-light,#ffffff) !important;border-color:var(--primary-light,#0066cc)}[data-theme=light] .nav-card{background:rgba(0,0,0,2%);border-color:var(--border-light,#dee2e6)}[data-theme=light] .nav-card:hover{background:rgba(0,102,204,5%);border-color:var(--primary-light,#0066cc)}[data-theme=light] .nav-empty{background:rgba(0,0,0,1%);border-color:var(--border-light,#dee2e6);color:var(--secondary-light,#6c757d)}[data-theme=light] .nav-arrow{color:var(--primary-light,#0066cc)}[data-theme=light] .nav-title{color:var(--primary-light,#212529) !important}@media(max-width:768px){.nav-grid{grid-template-columns:1fr;gap:.75rem}.nav-card{padding:1rem;min-height:70px}.nav-card.nav-next{text-align:left}.nav-card.nav-next .nav-content{text-align:left}.nav-title{font-size:.875rem}.post-tags-modern{flex-direction:column;gap:.75rem}}@media(max-width:480px){.nav-arrow{font-size:1.25rem}.nav-card{padding:.875rem}.nav-title{font-size:.8rem;-webkit-line-clamp:1}}</style><nav class=post-nav-modern><div class=nav-grid><a href=/blog/articles/%E5%90%8E%E7%AB%AF%E7%B3%BB%E7%BB%9F%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E4%BB%8E%E5%8D%95%E4%BD%93%E5%88%B0%E5%BE%AE%E6%9C%8D%E5%8A%A1%E7%9A%84%E6%BC%94%E8%BF%9B%E4%B9%8B%E8%B7%AF/ class="nav-card nav-prev"><div class=nav-arrow>â†</div><div class=nav-content><div class=nav-title>åç«¯ç³»ç»Ÿæ¶æ„è®¾è®¡ï¼šä»å•ä½“åˆ°å¾®æœåŠ¡çš„æ¼”è¿›ä¹‹è·¯</div></div></a><a href=/blog/articles/devops%E4%B8%8Eci/cd%E5%AE%8C%E5%85%A8%E6%8C%87%E5%8D%97%E6%9E%84%E5%BB%BA%E9%AB%98%E6%95%88%E7%9A%84%E8%BD%AF%E4%BB%B6%E4%BA%A4%E4%BB%98%E6%B5%81%E6%B0%B4%E7%BA%BF/ class="nav-card nav-next"><div class=nav-content><div class=nav-title>DevOpsä¸CI/CDå®Œå…¨æŒ‡å—ï¼šæ„å»ºé«˜æ•ˆçš„è½¯ä»¶äº¤ä»˜æµæ°´çº¿</div></div><div class=nav-arrow>â†’</div></a></div></nav></footer></main><aside class=post-sidebar><div class=sidebar-toc id=sidebar-toc><div class=toc-header><div class=toc-title>ç›®å½•</div><button class=toc-toggle id=toc-toggle aria-label="Toggle TOC">
<svg class="toc-toggle-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 6 6 18M6 6l12 12"/></svg></button></div><div class=toc-content id=toc-content><ul class=toc-list><li class="toc-item toc-h2"><a href=#h2-0 class=toc-item-link><span class=toc-item-text>å¼•è¨€</span></a></li><li class="toc-item toc-h2"><a href=#h2-1 class=toc-item-link><span class=toc-item-text>ä¸€ã€MLOpsæ¦‚è¿°</span></a></li><li class="toc-item toc-h2"><a href=#h2-2 class=toc-item-link><span class=toc-item-text>äºŒã€ç‰¹å¾å·¥ç¨‹ä¸ç®¡ç†</span></a></li><li class="toc-item toc-h2"><a href=#h2-3 class=toc-item-link><span class=toc-item-text>ä¸‰ã€æ¨¡å‹éƒ¨ç½²ä¸æœåŠ¡åŒ–</span></a></li><li class="toc-item toc-h2"><a href=#h2-4 class=toc-item-link><span class=toc-item-text>å››ã€æ¨¡å‹ç›‘æ§ä¸A/Bæµ‹è¯•</span></a></li><li class="toc-item toc-h2"><a href=#h2-5 class=toc-item-link><span class=toc-item-text>äº”ã€ç«¯åˆ°ç«¯MLOpsæµæ°´çº¿</span></a></li><li class="toc-item toc-h2"><a href=#h2-6 class=toc-item-link><span class=toc-item-text>æ€»ç»“</span></a></li></ul></div></div><script>document.addEventListener("DOMContentLoaded",function(){const e=document.getElementById("sidebar-toc"),t=document.getElementById("toc-toggle"),o=document.getElementById("toc-content"),i=t?.querySelector(".toc-toggle-icon");if(!e)return;let n=!1;t&&t.addEventListener("click",function(){n=!n,n?(o.style.display="none",e.style.width="auto",i.innerHTML='<path d="M9 18l6-6-6-6"/>'):(o.style.display="block",e.style.width="200px",i.innerHTML='<path d="M18 6L6 18M6 6l12 12"/>')});const s=document.querySelector(".post-content");if(s){const e=s.querySelectorAll("h1");e.forEach((e,t)=>{e.id=`h1-${t}`});const t=s.querySelectorAll("h2");t.forEach((e,t)=>{e.id=`h2-${t}`})}const a=document.querySelectorAll(".toc-item-link");a.forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();const n=this.getAttribute("href").substring(1),t=document.getElementById(n);if(t){const e=document.querySelector(".post-header-main")?.offsetHeight||0,n=t.offsetTop-e-20;window.scrollTo({top:n,behavior:"smooth"})}})})})</script><style>.sidebar-toc{position:sticky;top:2rem;width:200px;background:#fff;border:1px solid #e5e7eb;border-radius:4px;overflow:hidden;box-shadow:0 1px 3px rgba(0,0,0,.1);z-index:100}.sidebar-toc.hidden{display:none}.toc-header{padding:12px 16px;border-bottom:1px solid #e5e7eb;background:#fafbfc;display:flex;align-items:center;justify-content:space-between}.toc-title{margin:0;font-size:13px;font-weight:500;color:#374151 !important;font-family:-apple-system,BlinkMacSystemFont,segoe ui,Roboto,sans-serif;text-transform:uppercase;letter-spacing:1px}.toc-toggle{background:0 0;border:none;cursor:pointer;padding:4px;border-radius:4px;display:flex;align-items:center;justify-content:center;transition:all .2s ease;color:#6b7280}.toc-toggle:hover{background:#e5e7eb;color:#374151}.toc-toggle-icon{transition:transform .2s ease}.toc-content{padding:12px 0}.toc-list{list-style:none;margin:0;padding:0}.toc-item{margin-bottom:4px;display:block !important;visibility:visible !important}.toc-h1,.toc-h2{display:block !important}.toc-h2{margin-left:0}.toc-item-link{display:flex;align-items:center;gap:8px;padding:8px 12px;color:#374151 !important;text-decoration:none;font-size:13px;line-height:1.4;border-radius:3px;transition:all .2s ease;font-weight:400}.toc-item-link:hover{background:#f8fafc;color:#1f2937 !important}.toc-item-link.active{background:#e0f2fe;color:#01579b !important;font-weight:500}.toc-dot{width:8px;height:8px;border-radius:50%;flex-shrink:0}.dot-red{background:#ef4444}.dot-blue{background:#2196f3}.toc-item-text{color:#1f2937 !important;font-weight:400;flex:1;display:inline !important;visibility:visible !important;opacity:1 !important;font-size:13px !important;line-height:1.4 !important}.toc-item-link .toc-item-text{color:#1f2937 !important;display:inline !important;visibility:visible !important;opacity:1 !important}.toc-item.active .dot-red{background:#d32f2f}.toc-item.active .dot-blue{background:#1976d2}[data-theme=dark] .sidebar-toc{background:#1f2937;border-color:#374151;box-shadow:0 1px 3px rgba(0,0,0,.3)}[data-theme=dark] .toc-header{background:#111827;border-color:#374151}[data-theme=dark] .toc-title{color:#f3f4f6 !important}[data-theme=dark] .toc-toggle{color:#9ca3af}[data-theme=dark] .toc-toggle:hover{background:#374151;color:#f3f4f6}[data-theme=dark] .toc-item-link{color:#e5e7eb !important}[data-theme=dark] .toc-item-link:hover{background:#374151;color:#f9fafb !important}[data-theme=dark] .toc-item-link.active{background:#0d47a1;color:#fff !important}[data-theme=dark] .toc-item-text{color:#f9fafb !important;display:inline !important;visibility:visible !important;opacity:1 !important}[data-theme=dark] .toc-item-link .toc-item-text{color:#f9fafb !important;display:inline !important;visibility:visible !important;opacity:1 !important}@media(max-width:1024px){.sidebar-toc{display:none}.post-content-wrapper{grid-template-columns:1fr !important;padding:0 1rem !important}}</style><style>.post-content-wrapper{display:grid;grid-template-columns:1fr 200px;gap:2rem;padding:0 2rem;max-width:100%}.post-content-main{min-width:0}.post-sidebar{position:sticky;top:2rem;height:fit-content;min-width:0}.post-header-main{margin-bottom:2rem;padding-bottom:1rem;border-bottom:1px solid var(--border,#333333)}.post-header-main .post-title{color:var(--primary,#ffffff) !important;font-size:2.5rem;font-weight:700;line-height:1.2;margin-bottom:1rem}.post-header-main .post-description{color:var(--secondary,#cccccc) !important;font-size:1.1rem;line-height:1.6;margin-bottom:1rem}.post-header-main .post-meta{margin-bottom:0}@media(max-width:1024px){.post-content-wrapper{grid-template-columns:1fr !important;gap:1rem;padding:0 1rem !important}.post-sidebar{display:none}}@media(max-width:768px){.post-header-main .post-title{font-size:2rem}.post-header-main .post-description{font-size:1rem}}</style></aside></div></article></main><footer class=footer><span>Â© 2024-2025 æœ‰æ¡å·¥å…·æŠ€æœ¯åšå®¢</span> Â·</footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");if(menu){const e=localStorage.getItem("menu-scroll-position");e&&(menu.scrollLeft=parseInt(e,10)),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}}document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{const e=document.querySelector("html");e.dataset.theme==="dark"?(e.dataset.theme="light",localStorage.setItem("pref-theme","light")):(e.dataset.theme="dark",localStorage.setItem("pref-theme","dark"))})</script></body></html>