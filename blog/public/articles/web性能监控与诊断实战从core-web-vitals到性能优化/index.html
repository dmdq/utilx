<!doctype html><html lang=zh-cn dir=auto data-theme=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Webæ€§èƒ½ç›‘æ§ä¸è¯Šæ–­å®æˆ˜ï¼šä»Core Web Vitalsåˆ°æ€§èƒ½ä¼˜åŒ– | æŠ€æœ¯åšå®¢ - æœ‰æ¡å·¥å…·</title><meta name=keywords content="Webæ€§èƒ½ç›‘æ§,Core Web Vitals,Performance API,LCPä¼˜åŒ–,FIDä¼˜åŒ–,CLSä¼˜åŒ–,æ€§èƒ½è¯Šæ–­"><meta name=description content="å…¨é¢ä»‹ç»Webæ€§èƒ½ç›‘æ§ä½“ç³»ï¼ŒåŒ…æ‹¬Core Web VitalsæŒ‡æ ‡ã€æ€§èƒ½APIä½¿ç”¨ã€æ€§èƒ½æ•°æ®é‡‡é›†ä¸åˆ†æã€ä»¥åŠæ€§èƒ½ä¼˜åŒ–ç­–ç•¥ï¼Œå¸®åŠ©æ„å»ºé«˜æ€§èƒ½Webåº”ç”¨ã€‚"><meta name=author content="æœ‰æ¡å·¥å…·å›¢é˜Ÿ"><link rel=canonical href=/blog/articles/web%E6%80%A7%E8%83%BD%E7%9B%91%E6%8E%A7%E4%B8%8E%E8%AF%8A%E6%96%AD%E5%AE%9E%E6%88%98%E4%BB%8Ecore-web-vitals%E5%88%B0%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/><link crossorigin=anonymous href=/blog/assets/css/stylesheet.7e8505b7cdf8bb22ab2305e53c2700bb06c7e64faeb72cd3468823a9a3bd3d6e.css integrity="sha256-foUFt834uyKrIwXlPCcAuwbH5k+utyzTRogjqaO9PW4=" rel="preload stylesheet" as=style><link rel=icon href=/favicon.ico><link rel=icon type=image/png sizes=16x16 href=/blog/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=/blog/favicon-32x32.png><link rel=apple-touch-icon href=/blog/apple-touch-icon.png><link rel=mask-icon href=/blog/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate type=application/rss+xml href=/blog/articles/web%E6%80%A7%E8%83%BD%E7%9B%91%E6%8E%A7%E4%B8%8E%E8%AF%8A%E6%96%AD%E5%AE%9E%E6%88%98%E4%BB%8Ecore-web-vitals%E5%88%B0%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/feed.xml title=rss><link rel=alternate hreflang=zh-cn href=/blog/articles/web%E6%80%A7%E8%83%BD%E7%9B%91%E6%8E%A7%E4%B8%8E%E8%AF%8A%E6%96%AD%E5%AE%9E%E6%88%98%E4%BB%8Ecore-web-vitals%E5%88%B0%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51);color-scheme:dark}.list{background:var(--theme)}.toc{background:var(--entry)}}@media(prefers-color-scheme:light){.list::-webkit-scrollbar-thumb{border-color:var(--code-bg)}}</style></noscript><script>localStorage.getItem("pref-theme")==="dark"?document.querySelector("html").dataset.theme="dark":localStorage.getItem("pref-theme")==="light"?document.querySelector("html").dataset.theme="light":window.matchMedia("(prefers-color-scheme: dark)").matches?document.querySelector("html").dataset.theme="dark":document.querySelector("html").dataset.theme="light"</script><script src=/js/external-link-config.js></script><script src=/js/external-link-interceptor.js></script><link rel=stylesheet href=/blog/css/custom.css media=screen><script type=application/ld+json>{"@context":"https://schema.org","@type":"WebSite","name":"æŠ€æœ¯åšå®¢ - æœ‰æ¡å·¥å…· | å¼€å‘è€…å·¥å…·ä½¿ç”¨æ•™ç¨‹ & ç¼–ç¨‹æŠ€å·§åˆ†äº«","url":"https://www.util.cn/blog/","description":"æœ‰æ¡å·¥å…·æŠ€æœ¯åšå®¢ - åˆ†äº«å¼€å‘è€…å·¥å…·ä½¿ç”¨æ•™ç¨‹ã€ç¼–ç¨‹æŠ€å·§å’Œå®æˆ˜å¼€å‘ç»éªŒã€‚æä¾›JSONæ ¼å¼åŒ–ã€SQLä¼˜åŒ–ã€Markdownç¼–è¾‘å™¨ç­‰åœ¨çº¿å·¥å…·çš„è¯¦ç»†ä½¿ç”¨æŒ‡å—ï¼Œå¸®åŠ©å¼€å‘è€…æå‡å·¥ä½œæ•ˆç‡ã€‚","publisher":{"@type":"Organization","name":"æœ‰æ¡å·¥å…·","url":"https://www.util.cn","logo":{"@type":"ImageObject","url":"https://www.util.cn/blog/logo/logo-256.png","width":256,"height":256}},"potentialAction":[{"@type":"SearchAction","target":"https://www.util.cn/blog/search?q={search_term_string}","query-input":"required name=search_term_string"}]}</script><meta property="og:type" content="website"><meta property="og:title" content="æŠ€æœ¯åšå®¢ - æœ‰æ¡å·¥å…· | å¼€å‘è€…å·¥å…·ä½¿ç”¨æ•™ç¨‹ & ç¼–ç¨‹æŠ€å·§åˆ†äº«"><meta property="og:description" content="æœ‰æ¡å·¥å…·æŠ€æœ¯åšå®¢ - åˆ†äº«å¼€å‘è€…å·¥å…·ä½¿ç”¨æ•™ç¨‹ã€ç¼–ç¨‹æŠ€å·§å’Œå®æˆ˜å¼€å‘ç»éªŒã€‚æä¾›JSONæ ¼å¼åŒ–ã€SQLä¼˜åŒ–ã€Markdownç¼–è¾‘å™¨ç­‰åœ¨çº¿å·¥å…·çš„è¯¦ç»†ä½¿ç”¨æŒ‡å—ï¼Œå¸®åŠ©å¼€å‘è€…æå‡å·¥ä½œæ•ˆç‡ã€‚"><meta property="og:url" content="https://www.util.cn/blog/"><meta property="og:site_name" content="æœ‰æ¡å·¥å…·æŠ€æœ¯åšå®¢"><meta property="og:image" content="https://www.util.cn/blog/logo/logo-256.png"><meta property="og:image:width" content="1200"><meta property="og:image:height" content="630"><meta name=twitter:card content="summary_large_image"><meta name=twitter:title content="æŠ€æœ¯åšå®¢ - æœ‰æ¡å·¥å…· | å¼€å‘è€…å·¥å…·ä½¿ç”¨æ•™ç¨‹ & ç¼–ç¨‹æŠ€å·§åˆ†äº«"><meta name=twitter:description content="æœ‰æ¡å·¥å…·æŠ€æœ¯åšå®¢ - åˆ†äº«å¼€å‘è€…å·¥å…·ä½¿ç”¨æ•™ç¨‹ã€ç¼–ç¨‹æŠ€å·§å’Œå®æˆ˜å¼€å‘ç»éªŒã€‚"><meta name=twitter:image content="https://www.util.cn/blog/logo/logo-256.png"><meta name=baidu-site-verification content><meta name=category content="æŠ€æœ¯åšå®¢,å¼€å‘è€…å·¥å…·,ç¼–ç¨‹æ•™ç¨‹"><meta name=coverage content="Worldwide"><meta name=distribution content="Global"><meta name=rating content="General"><script id=51la_code async crossorigin=anonymous src="https://sdk.51.la/js-sdk-pro.min.js?id=3OM52V0xJAPv6ozF&hash=pro"></script><script>window.addEventListener("load",function(){setTimeout(function(){typeof la!="undefined"?console.log("51laç»Ÿè®¡å·²åŠ è½½"):(console.warn("51laç»Ÿè®¡åŠ è½½å¤±è´¥ï¼Œä½¿ç”¨å¤‡ç”¨æ–¹æ¡ˆ"),function(){var e=document.createElement("script");e.src="https://sdk.51.la/js-sdk-pro.min.js?id=3OM52V0xJAPv6ozF&hash=backup",e.async=!0,document.head.appendChild(e)}())},3e3)})</script><meta property="og:url" content="/blog/articles/web%E6%80%A7%E8%83%BD%E7%9B%91%E6%8E%A7%E4%B8%8E%E8%AF%8A%E6%96%AD%E5%AE%9E%E6%88%98%E4%BB%8Ecore-web-vitals%E5%88%B0%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/"><meta property="og:site_name" content="æŠ€æœ¯åšå®¢ - æœ‰æ¡å·¥å…·"><meta property="og:title" content="Webæ€§èƒ½ç›‘æ§ä¸è¯Šæ–­å®æˆ˜ï¼šä»Core Web Vitalsåˆ°æ€§èƒ½ä¼˜åŒ–"><meta property="og:description" content="å…¨é¢ä»‹ç»Webæ€§èƒ½ç›‘æ§ä½“ç³»ï¼ŒåŒ…æ‹¬Core Web VitalsæŒ‡æ ‡ã€æ€§èƒ½APIä½¿ç”¨ã€æ€§èƒ½æ•°æ®é‡‡é›†ä¸åˆ†æã€ä»¥åŠæ€§èƒ½ä¼˜åŒ–ç­–ç•¥ï¼Œå¸®åŠ©æ„å»ºé«˜æ€§èƒ½Webåº”ç”¨ã€‚"><meta property="og:locale" content="zh-cn"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2025-12-24T13:00:00+08:00"><meta property="article:modified_time" content="2025-12-24T13:00:00+08:00"><meta property="article:tag" content="Webæ€§èƒ½"><meta property="article:tag" content="Core Web Vitals"><meta property="article:tag" content="æ€§èƒ½ç›‘æ§"><meta property="article:tag" content="æ€§èƒ½API"><meta property="article:tag" content="æ€§èƒ½ä¼˜åŒ–"><meta name=twitter:card content="summary"><meta name=twitter:title content="Webæ€§èƒ½ç›‘æ§ä¸è¯Šæ–­å®æˆ˜ï¼šä»Core Web Vitalsåˆ°æ€§èƒ½ä¼˜åŒ–"><meta name=twitter:description content="å…¨é¢ä»‹ç»Webæ€§èƒ½ç›‘æ§ä½“ç³»ï¼ŒåŒ…æ‹¬Core Web VitalsæŒ‡æ ‡ã€æ€§èƒ½APIä½¿ç”¨ã€æ€§èƒ½æ•°æ®é‡‡é›†ä¸åˆ†æã€ä»¥åŠæ€§èƒ½ä¼˜åŒ–ç­–ç•¥ï¼Œå¸®åŠ©æ„å»ºé«˜æ€§èƒ½Webåº”ç”¨ã€‚"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"æ‰€æœ‰æ–‡ç« ","item":"/blog/posts/"},{"@type":"ListItem","position":2,"name":"Webæ€§èƒ½ç›‘æ§ä¸è¯Šæ–­å®æˆ˜ï¼šä»Core Web Vitalsåˆ°æ€§èƒ½ä¼˜åŒ–","item":"/blog/articles/web%E6%80%A7%E8%83%BD%E7%9B%91%E6%8E%A7%E4%B8%8E%E8%AF%8A%E6%96%AD%E5%AE%9E%E6%88%98%E4%BB%8Ecore-web-vitals%E5%88%B0%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Webæ€§èƒ½ç›‘æ§ä¸è¯Šæ–­å®æˆ˜ï¼šä»Core Web Vitalsåˆ°æ€§èƒ½ä¼˜åŒ–","name":"Webæ€§èƒ½ç›‘æ§ä¸è¯Šæ–­å®æˆ˜ï¼šä»Core Web Vitalsåˆ°æ€§èƒ½ä¼˜åŒ–","description":"å…¨é¢ä»‹ç»Webæ€§èƒ½ç›‘æ§ä½“ç³»ï¼ŒåŒ…æ‹¬Core Web VitalsæŒ‡æ ‡ã€æ€§èƒ½APIä½¿ç”¨ã€æ€§èƒ½æ•°æ®é‡‡é›†ä¸åˆ†æã€ä»¥åŠæ€§èƒ½ä¼˜åŒ–ç­–ç•¥ï¼Œå¸®åŠ©æ„å»ºé«˜æ€§èƒ½Webåº”ç”¨ã€‚","keywords":["Webæ€§èƒ½ç›‘æ§","Core Web Vitals","Performance API","LCPä¼˜åŒ–","FIDä¼˜åŒ–","CLSä¼˜åŒ–","æ€§èƒ½è¯Šæ–­"],"articleBody":"å¼•è¨€ Webæ€§èƒ½ç›´æ¥å½±å“ç”¨æˆ·ä½“éªŒå’Œä¸šåŠ¡è½¬åŒ–ã€‚ç°ä»£Webæ€§èƒ½ç›‘æ§å·²ç»ä»ç®€å•çš„é¡µé¢åŠ è½½æ—¶é—´ï¼Œå‘å±•åˆ°ç²¾ç»†åŒ–çš„ç”¨æˆ·ä½“éªŒæŒ‡æ ‡ä½“ç³»ã€‚æœ¬æ–‡å°†æ·±å…¥æ¢è®¨Webæ€§èƒ½ç›‘æ§çš„å®Œæ•´ä½“ç³»ï¼Œä»æŒ‡æ ‡å®šä¹‰åˆ°é‡‡é›†åˆ†æï¼Œå†åˆ°ä¼˜åŒ–å®è·µã€‚\nä¸€ã€Core Web Vitalsè¯¦è§£ 1.1 LCPï¼ˆæœ€å¤§å†…å®¹ç»˜åˆ¶ï¼‰ å®šä¹‰ä¸æ ‡å‡†\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 // LCPæµ‹é‡é¡µé¢ä¸»è¦å†…å®¹åŠ è½½å®Œæˆçš„æ—¶é—´ // è‰¯å¥½ï¼šâ‰¤2.5ç§’ // éœ€æ”¹è¿›ï¼š2.5-4ç§’ // å·®ï¼š\u003e4ç§’ // ä½¿ç”¨Performance Observeræµ‹é‡LCP function measureLCP() { return new Promise\u003cPerformanceEntry\u003e((resolve) =\u003e { new PerformanceObserver((list) =\u003e { const entries = list.getEntries() const lastEntry = entries[entries.length - 1] resolve(lastEntry) }).observe({ entryTypes: ['largest-contentful-paint'] }) }) } // ä½¿ç”¨web-vitalsåº“ import { onLCP } from 'web-vitals' onLCP((metric) =\u003e { console.log('LCP:', metric.value) // ä¸ŠæŠ¥æ•°æ®åˆ°åˆ†æå¹³å° sendToAnalytics({ metric: 'LCP', value: metric.value, rating: metric.rating, // 'good' | 'needs-improvement' | 'poor' }) }) LCPä¼˜åŒ–ç­–ç•¥\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 // 1. ä¼˜åŒ–æœåŠ¡å™¨å“åº”æ—¶é—´ // - ä½¿ç”¨CDN // - ç¼“å­˜é™æ€èµ„æº // - é¢„è¿æ¥åˆ°æºæœåŠ¡å™¨ // 2. ä¼˜åŒ–èµ„æºåŠ è½½ \u003clink rel=\"preload\" as=\"image\" href=\"hero-image.jpg\"\u003e \u003clink rel=\"preconnect\" href=\"https://api.example.com\"\u003e // 3. ä¼˜åŒ–å…³é”®æ¸²æŸ“è·¯å¾„ // ä¼˜å…ˆåŠ è½½LCPå…ƒç´ ç›¸å…³èµ„æº // 4. å‹ç¼©å’Œä¼˜åŒ–å›¾ç‰‡ \u003cimg src=\"hero.webp\" loading=\"eager\" width=\"1200\" height=\"600\" fetchpriority=\"high\" \u003e // 5. é¿å…å®¢æˆ·ç«¯JavaScriptæ¸²æŸ“LCPå†…å®¹ // ä½¿ç”¨æœåŠ¡ç«¯æ¸²æŸ“æˆ–é™æ€ç”Ÿæˆ 1.2 INPï¼ˆäº¤äº’åˆ°ä¸‹ä¸€æ¬¡ç»˜åˆ¶ï¼‰ å®šä¹‰ä¸æ ‡å‡†\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 // INPæµ‹é‡é¡µé¢æ•´ä½“å“åº”èƒ½åŠ› // è‰¯å¥½ï¼šâ‰¤200æ¯«ç§’ // éœ€æ”¹è¿›ï¼š200-500æ¯«ç§’ // å·®ï¼š\u003e500æ¯«ç§’ import { onINP } from 'web-vitals' onINP((metric) =\u003e { console.log('INP:', metric.value) console.log('Target:', metric.entries[0].target) // äº¤äº’å…ƒç´  console.log('Type:', metric.entries[0].name) // äº‹ä»¶ç±»å‹ sendToAnalytics({ metric: 'INP', value: metric.value, target: metric.entries[0].target, eventType: metric.entries[0].name }) }) INPä¼˜åŒ–ç­–ç•¥\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 // 1. å‡å°‘JavaScriptæ‰§è¡Œæ—¶é—´ // ä½¿ç”¨ä»£ç åˆ†å‰² const heavyModule = await import('./heavy-module') // 2. ä¼˜åŒ–é•¿ä»»åŠ¡ // ä½¿ç”¨requestIdleCallback function scheduleWork(work: () =\u003e void) { if ('requestIdleCallback' in window) { requestIdleCallback(() =\u003e work()) } else { setTimeout(() =\u003e work(), 0) } } // 3. é¿å…è½®è¯¢ // âŒ ä¸å¥½çš„åšæ³• setInterval(() =\u003e { checkStatus() }, 1000) // âœ… ä½¿ç”¨äº‹ä»¶é©±åŠ¨ document.addEventListener('visibilitychange', checkStatus) // 4. ä½¿ç”¨Web Workerså¤„ç†è®¡ç®—å¯†é›†å‹ä»»åŠ¡ const worker = new Worker('worker.js') worker.postMessage({ data: heavyData }) worker.onmessage = (e) =\u003e { const result = e.data } 1.3 CLSï¼ˆç´¯ç§¯å¸ƒå±€åç§»ï¼‰ å®šä¹‰ä¸æ ‡å‡†\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 // CLSæµ‹é‡é¡µé¢è§†è§‰ç¨³å®šæ€§ // è‰¯å¥½ï¼šâ‰¤0.1 // éœ€æ”¹è¿›ï¼š0.1-0.25 // å·®ï¼š\u003e0.25 import { onCLS } from 'web-vitals' onCLS((metric) =\u003e { console.log('CLS:', metric.value) console.log('Entries:', metric.entries) sendToAnalytics({ metric: 'CLS', value: metric.value, entries: metric.entries.map(entry =\u003e ({ value: entry.value, sources: entry.sources?.map(source =\u003e ({ node: source.node?.nodeName, currentRect: source.currentRect })) })) }) }) CLSä¼˜åŒ–ç­–ç•¥\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 \u003cimg src=\"image.jpg\" width=\"800\" height=\"600\" style=\"aspect-ratio: 800/600; background: #f0f0f0\" \u003e \u003cdiv style=\"min-height: 200px\"\u003e \u003cdiv id=\"dynamic-content\"\u003e\u003c/div\u003e \u003c/div\u003e \u003cbutton onClick=\"insertAd()\"\u003eæ’å…¥å¹¿å‘Š\u003c/button\u003e \u003cdiv style=\"min-height: 250px; background: #f0f0f0\"\u003e \u003cdiv id=\"ad-placeholder\"\u003e\u003c/div\u003e \u003c/div\u003e \u003cstyle\u003e .bad { transition: height 0.3s; /* âŒ ä¼šè§¦å‘CLS */ } .good { transition: transform 0.3s; /* âœ… ä¸ä¼šè§¦å‘CLS */ transform: scaleY(0); transform-origin: top; } \u003c/style\u003e äºŒã€æ€§èƒ½APIè¯¦è§£ 2.1 Performance APIåŸºç¡€ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 // è·å–æ€§èƒ½æŒ‡æ ‡ function getPerformanceMetrics() { const perfData = performance.getEntriesByType('navigation')[0] as PerformanceNavigationTiming return { // DNSæŸ¥è¯¢ dnsLookup: perfData.domainLookupEnd - perfData.domainLookupStart, // TCPè¿æ¥ tcpConnection: perfData.connectEnd - perfData.connectStart, // è¯·æ±‚å“åº” requestTime: perfData.responseEnd - perfData.requestStart, // DOMè§£æ domParse: perfData.domComplete - perfData.domInteractive, // é¦–æ¬¡ç»˜åˆ¶ firstPaint: performance.getEntriesByName('first-paint')[0]?.startTime, // é¦–æ¬¡å†…å®¹ç»˜åˆ¶ firstContentfulPaint: performance.getEntriesByName('first-contentful-paint')[0]?.startTime, // å®Œå…¨åŠ è½½ pageLoad: perfData.loadEventEnd - perfData.navigationStart, // å†…å­˜ä½¿ç”¨ï¼ˆå¦‚æœæ”¯æŒï¼‰ memory: (performance as any).memory ? { usedJSHeapSize: (performance as any).memory.usedJSHeapSize, totalJSHeapSize: (performance as any).memory.totalJSHeapSize, jsHeapSizeLimit: (performance as any).memory.jsHeapSizeLimit } : null } } 2.2 èµ„æºåŠ è½½ç›‘æ§ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 // ç›‘æ§èµ„æºåŠ è½½æ€§èƒ½ function observeResources() { const observer = new PerformanceObserver((list) =\u003e { for (const entry of list.getEntries()) { const resource = entry as PerformanceResourceTiming console.log({ name: resource.name, duration: resource.duration, size: resource.transferSize, // æ—¶é—´åˆ†è§£ redirect: resource.redirectEnd - resource.redirectStart, dns: resource.domainLookupEnd - resource.domainLookupStart, tcp: resource.connectEnd - resource.connectStart, request: resource.responseStart - resource.requestStart, response: resource.responseEnd - resource.responseStart, }) } }) observer.observe({ entryTypes: ['resource'] }) } // è·å–æ…¢é€Ÿèµ„æº function getSlowResources(threshold = 1000) { const resources = performance.getEntriesByType('resource') as PerformanceResourceTiming[] return resources .filter(r =\u003e r.duration \u003e threshold) .map(r =\u003e ({ url: r.name, duration: Math.round(r.duration), size: Math.round(r.transferSize / 1024) + ' KB' })) .sort((a, b) =\u003e b.duration - a.duration) } 2.3 é•¿ä»»åŠ¡ç›‘æ§ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 // ç›‘æ§é˜»å¡ä¸»çº¿ç¨‹çš„é•¿ä»»åŠ¡ï¼ˆ\u003e50msï¼‰ function observeLongTasks() { if (!PerformanceObserver.supportedEntryTypes.includes('longtask')) { console.log('Long tasks not supported') return } const observer = new PerformanceObserver((list) =\u003e { for (const entry of list.getEntries()) { console.log('Long task detected:', { duration: entry.duration, startTime: entry.startTime, // æ£€æŸ¥æ˜¯å“ªä¸ªå®¹å™¨å¼•èµ·çš„ attribution: (entry as any).attribution?.map((a: any) =\u003e ({ containerType: a.containerType, containerName: a.containerName, containerSrc: a.containerSrc })) }) } }) observer.observe({ entryTypes: ['longtask'] }) } 2.4 é¦–æ¬¡è¾“å…¥å»¶è¿Ÿï¼ˆFIDï¼‰ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 // æµ‹é‡ç”¨æˆ·é¦–æ¬¡äº¤äº’åˆ°æµè§ˆå™¨å“åº”çš„æ—¶é—´ function measureFID() { return new Promise\u003cnumber\u003e((resolve) =\u003e { const observer = new PerformanceObserver((list) =\u003e { for (const entry of list.getEntries()) { if (!(entry as any).processingStart) continue const fid = (entry as any).processingStart - entry.startTime observer.disconnect() resolve(fid) } }) observer.observe({ entryTypes: ['first-input'] }) // å¦‚æœ5ç§’åæ²¡æœ‰äº¤äº’ï¼Œè¿”å›null setTimeout(() =\u003e { observer.disconnect() resolve(null) }, 5000) }) } ä¸‰ã€æ€§èƒ½æ•°æ®é‡‡é›† 3.1 å‰ç«¯åŸ‹ç‚¹ç³»ç»Ÿ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 class PerformanceTracker { private metrics: Map\u003cstring, number[]\u003e = new Map() private config: { sampleRate: number endpoint: string batchSize: number } constructor(config: { sampleRate: number; endpoint: string; batchSize?: number }) { this.config = { ...config, batchSize: config.batchSize || 10 } this.initObservers() } private initObservers() { // Core Web Vitals this.trackLCP() this.trackINP() this.trackCLS() // å…¶ä»–æŒ‡æ ‡ this.trackFCP() this.trackTTI() this.trackResources() } private trackLCP() { // ä½¿ç”¨web-vitalsåº“ import('web-vitals').then(({ onLCP }) =\u003e { onLCP((metric) =\u003e { this.record('LCP', metric.value) }) }) } private trackCLS() { import('web-vitals').then(({ onCLS }) =\u003e { onCLS((metric) =\u003e { this.record('CLS', metric.value) }) }) } private trackINP() { import('web-vitals').then(({ onINP }) =\u003e { onINP((metric) =\u003e { this.record('INP', metric.value) }) }) } private trackFCP() { new PerformanceObserver((list) =\u003e { for (const entry of list.getEntries()) { if (entry.name === 'first-contentful-paint') { this.record('FCP', entry.startTime) } } }).observe({ entryTypes: ['paint'] }) } private trackTTI() { // ä½¿ç”¨tti-polyfill import('tti-polyfill').then(({ getTTI }) =\u003e { getTTI().then((tti) =\u003e { this.record('TTI', tti) }) }) } private trackResources() { const observer = new PerformanceObserver((list) =\u003e { for (const entry of list.getEntries()) { const resource = entry as PerformanceResourceTiming this.record(`resource_${this.getResourceType(resource.name)}`, resource.duration) } }) observer.observe({ entryTypes: ['resource'] }) } private getResourceType(url: string): string { if (url.match(/\\.(js|jsx)$/)) return 'script' if (url.match(/\\.(css)$/)) return 'stylesheet' if (url.match(/\\.(png|jpg|jpeg|webp|gif|svg)$/)) return 'image' if (url.match(/\\.(woff|woff2|ttf|eot)$/)) return 'font' return 'other' } private record(metric: string, value: number) { if (!this.metrics.has(metric)) { this.metrics.set(metric, []) } this.metrics.get(metric)!.push(value) // è¾¾åˆ°æ‰¹é‡å¤§å°æ—¶å‘é€ if (this.metrics.get(metric)!.length \u003e= this.config.batchSize) { this.flush() } } private flush() { if (this.metrics.size === 0) return const data = Object.fromEntries( Array.from(this.metrics.entries()).map(([key, values]) =\u003e [ key, { count: values.length, avg: values.reduce((a, b) =\u003e a + b, 0) / values.length, min: Math.min(...values), max: Math.max(...values), p50: this.percentile(values, 50), p75: this.percentile(values, 75), p95: this.percentile(values, 95) } ]) ) fetch(this.config.endpoint, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ url: location.href, userAgent: navigator.userAgent, timestamp: Date.now(), metrics: data }), keepalive: true }) this.metrics.clear() } private percentile(values: number[], p: number): number { const sorted = values.slice().sort((a, b) =\u003e a - b) const index = Math.ceil((p / 100) * sorted.length) - 1 return sorted[index] } } // ä½¿ç”¨ const tracker = new PerformanceTracker({ sampleRate: 0.1, // 10%é‡‡æ ·ç‡ endpoint: 'https://analytics.example.com/performance', batchSize: 20 }) 3.2 ç”¨æˆ·è¡Œä¸ºåˆ†æ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 class UserBehaviorTracker { private events: Array\u003cany\u003e = [] init() { // ç‚¹å‡»äº‹ä»¶ document.addEventListener('click', (e) =\u003e { this.track('click', { target: this.getTargetSelector(e.target as HTMLElement), x: e.clientX, y: e.clientY }) }, true) // æ»šåŠ¨äº‹ä»¶ let scrollTimeout: NodeJS.Timeout document.addEventListener('scroll', () =\u003e { clearTimeout(scrollTimeout) scrollTimeout = setTimeout(() =\u003e { this.track('scroll', { scrollDepth: this.getScrollDepth() }) }, 100) }, true) // é¡µé¢å¯è§æ€§å˜åŒ– document.addEventListener('visibilitychange', () =\u003e { if (document.hidden) { this.track('pagehide', { timeOnPage: performance.now() }) this.flush() } }) } private track(type: string, data: any) { this.events.push({ type, data, timestamp: Date.now(), url: location.href }) if (this.events.length \u003e 50) { this.flush() } } private getTargetSelector(element: HTMLElement): string { if (element.id) return `#${element.id}` if (element.className) return `.${element.className.split(' ')[0]}` return element.tagName.toLowerCase() } private getScrollDepth(): number { const scrollTop = window.scrollY const docHeight = document.documentElement.scrollHeight - window.innerHeight return Math.round((scrollTop / docHeight) * 100) } private flush() { if (this.events.length === 0) return // ä½¿ç”¨sendBeaconç¡®ä¿æ•°æ®å‘é€ navigator.sendBeacon('/api/analytics', JSON.stringify(this.events)) this.events = [] } } å››ã€æ€§èƒ½è¯Šæ–­ä¸ä¼˜åŒ– 4.1 æ€§èƒ½ç“¶é¢ˆåˆ†æ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 // æ€§èƒ½è¯Šæ–­æŠ¥å‘Š class PerformanceDiagnostics { async analyze() { const report = { metrics: await this.getMetrics(), issues: this.detectIssues(), recommendations: this.getRecommendations() } return report } private async getMetrics() { const webVitals = await import('web-vitals') return Promise.all([ this.getLCP(webVitals), this.getCLS(webVitals), this.getINP(webVitals), this.getFCP(), this.getTTI() ]) } private detectIssues() { const issues: string[] = [] const resources = performance.getEntriesByType('resource') as PerformanceResourceTiming[] // æ£€æŸ¥å¤§èµ„æº const largeResources = resources.filter(r =\u003e r.transferSize \u003e 500_000) if (largeResources.length \u003e 0) { issues.push(`Found ${largeResources.length} resources larger than 500KB`) } // æ£€æŸ¥æ…¢èµ„æº const slowResources = resources.filter(r =\u003e r.duration \u003e 2000) if (slowResources.length \u003e 0) { issues.push(`Found ${slowResources.length} resources taking \u003e2s to load`) } // æ£€æŸ¥æœªå‹ç¼©èµ„æº const uncompressed = resources.filter(r =\u003e { const encoding = r.transferSize \u003c r.encodedBodySize ? 'gzip' : 'none' return encoding === 'none' \u0026\u0026 r.transferSize \u003e 10_000 }) if (uncompressed.length \u003e 0) { issues.push(`${uncompressed.length} resources not compressed`) } return issues } private getRecommendations() { return [ 'Enable Brotli compression', 'Use image optimization (WebP, responsive images)', 'Implement code splitting', 'Add resource hints (preconnect, preload)', 'Optimize critical rendering path', 'Remove unused CSS/JS', 'Implement service worker caching' ] } } 4.2 æ€§èƒ½ä¼˜åŒ–å·¥å…· 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 // å›¾ç‰‡ä¼˜åŒ–å·¥å…· class ImageOptimizer { // æ£€æµ‹æœªä¼˜åŒ–çš„å›¾ç‰‡ detectUnoptimizedImages() { const images = document.querySelectorAll('img') const issues: any[] = [] images.forEach(img =\u003e { // æ£€æŸ¥ç¼ºå°‘å°ºå¯¸å±æ€§ if (!img.width || !img.height) { issues.push({ element: img, issue: 'Missing width/height attributes', severity: 'high' }) } // æ£€æŸ¥æ˜¯å¦ä½¿ç”¨ç°ä»£æ ¼å¼ const src = img.currentSrc || img.src if (src.match(/\\.(jpg|png)$/i)) { issues.push({ element: img, issue: 'Using old image format (use WebP)', severity: 'medium' }) } // æ£€æŸ¥æ˜¯å¦å¯ä»¥æ‡’åŠ è½½ if (!img.loading \u0026\u0026 !this.isInViewport(img)) { issues.push({ element: img, issue: 'Should use lazy loading', severity: 'low' }) } }) return issues } private isInViewport(element: Element): boolean { const rect = element.getBoundingClientRect() return rect.top \u003c window.innerHeight \u0026\u0026 rect.bottom \u003e 0 } } // å­—ä½“ä¼˜åŒ–å·¥å…· class FontOptimizer { optimize() { // å­—ä½“æ˜¾ç¤ºç­–ç•¥ const style = document.createElement('style') style.textContent = ` @font-face { font-display: swap; } ` document.head.appendChild(style) // é¢„åŠ è½½å…³é”®å­—ä½“ this.preloadFont('/fonts/main.woff2', 'woff2') } private preloadFont(url: string, format: string) { const link = document.createElement('link') link.rel = 'preload' link.as = 'font' link.href = url link.type = `font/${format}` link.crossOrigin = 'anonymous' document.head.appendChild(link) } } æ€»ç»“ Webæ€§èƒ½ç›‘æ§æ˜¯ä¸€ä¸ªæŒç»­ä¼˜åŒ–çš„è¿‡ç¨‹ï¼š\nCore Web Vitals - èšç„¦ç”¨æˆ·ä½“éªŒæ ¸å¿ƒæŒ‡æ ‡ æ€§èƒ½API - å……åˆ†åˆ©ç”¨æµè§ˆå™¨æä¾›çš„ç›‘æ§èƒ½åŠ› æ•°æ®é‡‡é›† - å»ºç«‹å®Œå–„çš„æ€§èƒ½æ•°æ®æ”¶é›†ä½“ç³» è¯Šæ–­åˆ†æ - å‡†ç¡®å®šä½æ€§èƒ½ç“¶é¢ˆ æŒç»­ä¼˜åŒ– - åŸºäºæ•°æ®é©±åŠ¨æŒç»­æ”¹è¿› è‰¯å¥½çš„æ€§èƒ½ç›‘æ§ä½“ç³»èƒ½å¸®åŠ©å›¢é˜ŸåŠæ—¶å‘ç°é—®é¢˜ã€å®šä½ç“¶é¢ˆï¼Œå¹¶éªŒè¯ä¼˜åŒ–æ•ˆæœã€‚\nç›¸å…³å·¥å…·æ¨è\nJSONæ ¼å¼åŒ–å·¥å…· - JSONæ•°æ®å¤„ç† Base64ç¼–ç å·¥å…· - ç¼–ç è½¬æ¢ URLç¼–ç å·¥å…· - URLå‚æ•°å¤„ç† ","wordCount":"2166","inLanguage":"zh-cn","datePublished":"2025-12-24T13:00:00+08:00","dateModified":"2025-12-24T13:00:00+08:00","author":{"@type":"Person","name":"æœ‰æ¡å·¥å…·å›¢é˜Ÿ"},"mainEntityOfPage":{"@type":"WebPage","@id":"/blog/articles/web%E6%80%A7%E8%83%BD%E7%9B%91%E6%8E%A7%E4%B8%8E%E8%AF%8A%E6%96%AD%E5%AE%9E%E6%88%98%E4%BB%8Ecore-web-vitals%E5%88%B0%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/"},"publisher":{"@type":"Organization","name":"æŠ€æœ¯åšå®¢ - æœ‰æ¡å·¥å…·","logo":{"@type":"ImageObject","url":"/favicon.ico"}}}</script></head><body id=top><header class=header><nav class=nav><div class=logo><a href=/blog/ accesskey=h title="æŠ€æœ¯åšå®¢ - æœ‰æ¡å·¥å…· (Alt + H)">æŠ€æœ¯åšå®¢ - æœ‰æ¡å·¥å…·</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=/blog/posts/ title="æ‰€æœ‰æ–‡ç« åˆ—è¡¨ - æœ‰æ¡å·¥å…·æŠ€æœ¯åšå®¢ï¼šæŸ¥çœ‹æ‰€æœ‰æŠ€æœ¯æ–‡ç« å’Œæ•™ç¨‹å†…å®¹"><span>æ–‡ç« </span></a></li><li><a href=https://www.util.cn title="æœ‰æ¡å·¥å…· - å¼€å‘è€…çš„å¸¸ç”¨å·¥å…·é›†åˆï¼šæ— å¹¿å‘Š Â· æœ¬åœ°è®¡ç®— Â· å³å¼€å³ç”¨çš„åœ¨çº¿å·¥å…·å¹³å°ï¼Œæä¾›JSONæ ¼å¼åŒ–ã€SQLæ ¼å¼åŒ–ã€Markdownç¼–è¾‘å™¨ç­‰å®ç”¨å·¥å…·"><span>æœ‰æ¡å·¥å…·</span>&nbsp;
<svg fill="none" shape-rendering="geometricPrecision" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" height="12" width="12"><path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"/><path d="M15 3h6v6"/><path d="M10 14 21 3"/></svg></a></li><li><a href=/blog/categories/ title="æ–‡ç« åˆ†ç±» - æœ‰æ¡å·¥å…·æŠ€æœ¯åšå®¢ï¼šæŒ‰æŠ€æœ¯é¢†åŸŸåˆ†ç±»çš„ä¼˜è´¨æ–‡ç« ï¼ŒåŒ…æ‹¬å‰ç«¯å¼€å‘ã€å·¥å…·ä½¿ç”¨ã€ç¼–ç¨‹æŠ€å·§ç­‰"><span>åˆ†ç±»</span></a></li><li><a href=/blog/tags/ title="æ ‡ç­¾äº‘ - æœ‰æ¡å·¥å…·æŠ€æœ¯åšå®¢ï¼šé€šè¿‡æ ‡ç­¾å¿«é€Ÿæ‰¾åˆ°æ„Ÿå…´è¶£çš„æŠ€æœ¯æ–‡ç« å’Œæ•™ç¨‹å†…å®¹"><span>æ ‡ç­¾</span></a></li><li><a href=/blog/archives/ title="æ–‡ç« å½’æ¡£ - æœ‰æ¡å·¥å…·æŠ€æœ¯åšå®¢ï¼šæŒ‰æ—¶é—´æŸ¥çœ‹å†å²æ–‡ç« "><span>å½’æ¡£</span></a></li><li><a href=/blog/search/ title="æœç´¢æ–‡ç«  - æœ‰æ¡å·¥å…·æŠ€æœ¯åšå®¢ï¼šé€šè¿‡å…³é”®è¯æœç´¢æ‰¾åˆ°æ„Ÿå…´è¶£çš„æŠ€æœ¯æ–‡ç« å’Œæ•™ç¨‹å†…å®¹ï¼Œæ”¯æŒæ ‡é¢˜ã€å†…å®¹ã€åˆ†ç±»å’Œæ ‡ç­¾æœç´¢"><span>æœç´¢</span></a></li></ul></nav></header><main class=main><article class=post-single><div class=post-content-wrapper><main class=post-content-main><header class=post-header-main><h1 class="post-title entry-hint-parent">Webæ€§èƒ½ç›‘æ§ä¸è¯Šæ–­å®æˆ˜ï¼šä»Core Web Vitalsåˆ°æ€§èƒ½ä¼˜åŒ–</h1><div class=post-description>å…¨é¢ä»‹ç»Webæ€§èƒ½ç›‘æ§ä½“ç³»ï¼ŒåŒ…æ‹¬Core Web VitalsæŒ‡æ ‡ã€æ€§èƒ½APIä½¿ç”¨ã€æ€§èƒ½æ•°æ®é‡‡é›†ä¸åˆ†æã€ä»¥åŠæ€§èƒ½ä¼˜åŒ–ç­–ç•¥ï¼Œå¸®åŠ©æ„å»ºé«˜æ€§èƒ½Webåº”ç”¨ã€‚</div><div class=post-meta><div class=post-meta-content><div class=post-categories-inline><a href=/blog/categories/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/ class=category-link>æ€§èƒ½ä¼˜åŒ–</a><a href=/blog/categories/web%E5%BC%80%E5%8F%91/ class=category-link>Webå¼€å‘</a></div><span class=post-date>2025-12-24</span><span class=post-author>æœ‰æ¡å·¥å…·å›¢é˜Ÿ</span></div><style>.post-meta-content{display:flex;align-items:center;flex-wrap:wrap;gap:.75rem;font-family:sf mono,monaco,courier new,monospace;font-size:.875rem;color:#9ca3af !important}.post-categories-inline{display:inline-flex;align-items:center;gap:.5rem}.category-link{display:inline-flex;align-items:center;gap:.25rem;padding:.25rem .75rem;background:rgba(255,255,255,.1);color:#e5e7eb !important;text-decoration:none;font-size:.75rem;font-weight:600;text-transform:uppercase;letter-spacing:.05em;border:1px solid rgba(255,255,255,.2);border-radius:0;transition:all .3s ease;white-space:nowrap}.category-link:hover{background:rgba(255,255,255,.2);color:#fff !important;border-color:rgba(255,255,255,.3);transform:translateY(-1px)}.category-link::before{content:'ğŸ“';font-size:.7rem;opacity:.8}.post-date,.post-reading-time,.post-word-count,.post-author{color:#9ca3af !important}[data-theme=dark] .post-meta-content{color:#9ca3af !important}[data-theme=dark] .category-link{background:rgba(255,255,255,.1);color:#e5e7eb !important;border-color:rgba(255,255,255,.2)}[data-theme=dark] .category-link:hover{background:rgba(255,255,255,.2);color:#fff !important;border-color:rgba(255,255,255,.3)}[data-theme=dark] .post-date,[data-theme=dark] .post-reading-time,[data-theme=dark] .post-word-count,[data-theme=dark] .post-author{color:#9ca3af !important}[data-theme=light] .post-meta-content{color:#6c757d !important}[data-theme=light] .category-link{background:rgba(0,0,0,5%);color:#495057 !important;border-color:rgba(0,0,0,.15)}[data-theme=light] .category-link:hover{background:rgba(0,102,204,.1);color:#212529 !important;border-color:rgba(0,102,204,.3)}[data-theme=light] .post-date,[data-theme=light] .post-reading-time,[data-theme=light] .post-word-count,[data-theme=light] .post-author{color:#6c757d !important}@media(max-width:768px){.post-meta-content{gap:.5rem;font-size:.8rem}.category-link{padding:.2rem .6rem;font-size:.7rem}}</style></div></header><div class=post-content><h2 id=å¼•è¨€>å¼•è¨€<a hidden class=anchor aria-hidden=true href=#å¼•è¨€>#</a></h2><p>Webæ€§èƒ½ç›´æ¥å½±å“ç”¨æˆ·ä½“éªŒå’Œä¸šåŠ¡è½¬åŒ–ã€‚ç°ä»£Webæ€§èƒ½ç›‘æ§å·²ç»ä»ç®€å•çš„é¡µé¢åŠ è½½æ—¶é—´ï¼Œå‘å±•åˆ°ç²¾ç»†åŒ–çš„ç”¨æˆ·ä½“éªŒæŒ‡æ ‡ä½“ç³»ã€‚æœ¬æ–‡å°†æ·±å…¥æ¢è®¨Webæ€§èƒ½ç›‘æ§çš„å®Œæ•´ä½“ç³»ï¼Œä»æŒ‡æ ‡å®šä¹‰åˆ°é‡‡é›†åˆ†æï¼Œå†åˆ°ä¼˜åŒ–å®è·µã€‚</p><h2 id=ä¸€core-web-vitalsè¯¦è§£>ä¸€ã€Core Web Vitalsè¯¦è§£<a hidden class=anchor aria-hidden=true href=#ä¸€core-web-vitalsè¯¦è§£>#</a></h2><h3 id=11-lcpæœ€å¤§å†…å®¹ç»˜åˆ¶>1.1 LCPï¼ˆæœ€å¤§å†…å®¹ç»˜åˆ¶ï¼‰<a hidden class=anchor aria-hidden=true href=#11-lcpæœ€å¤§å†…å®¹ç»˜åˆ¶>#</a></h3><p><strong>å®šä¹‰ä¸æ ‡å‡†</strong></p><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">28
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// LCPæµ‹é‡é¡µé¢ä¸»è¦å†…å®¹åŠ è½½å®Œæˆçš„æ—¶é—´
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// è‰¯å¥½ï¼šâ‰¤2.5ç§’
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// éœ€æ”¹è¿›ï¼š2.5-4ç§’
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// å·®ï¼š&gt;4ç§’
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// ä½¿ç”¨Performance Observeræµ‹é‡LCP
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span><span style=color:#ff7b72>function</span> measureLCP() {
</span></span><span style=display:flex><span>  <span style=color:#ff7b72>return</span> <span style=color:#ff7b72>new</span> Promise&lt;<span style=color:#7ee787>PerformanceEntry</span>&gt;((resolve) <span style=color:#ff7b72;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>new</span> PerformanceObserver((list) <span style=color:#ff7b72;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span>      <span style=color:#ff7b72>const</span> entries <span style=color:#ff7b72;font-weight:700>=</span> list.getEntries()
</span></span><span style=display:flex><span>      <span style=color:#ff7b72>const</span> lastEntry <span style=color:#ff7b72;font-weight:700>=</span> entries[entries.length <span style=color:#ff7b72;font-weight:700>-</span> <span style=color:#a5d6ff>1</span>]
</span></span><span style=display:flex><span>      resolve(lastEntry)
</span></span><span style=display:flex><span>    }).observe({ entryTypes<span style=color:#ff7b72;font-weight:700>:</span> [<span style=color:#a5d6ff>&#39;largest-contentful-paint&#39;</span>] })
</span></span><span style=display:flex><span>  })
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// ä½¿ç”¨web-vitalsåº“
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span><span style=color:#ff7b72>import</span> { onLCP } <span style=color:#ff7b72>from</span> <span style=color:#a5d6ff>&#39;web-vitals&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>onLCP((metric) <span style=color:#ff7b72;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span>  console.log(<span style=color:#a5d6ff>&#39;LCP:&#39;</span>, metric.value)
</span></span><span style=display:flex><span>  <span style=color:#8b949e;font-style:italic>// ä¸ŠæŠ¥æ•°æ®åˆ°åˆ†æå¹³å°
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>  sendToAnalytics({
</span></span><span style=display:flex><span>    metric<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#a5d6ff>&#39;LCP&#39;</span>,
</span></span><span style=display:flex><span>    value: <span style=color:#ff7b72>metric.value</span>,
</span></span><span style=display:flex><span>    rating: <span style=color:#ff7b72>metric.rating</span>,  <span style=color:#8b949e;font-style:italic>// &#39;good&#39; | &#39;needs-improvement&#39; | &#39;poor&#39;
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>  })
</span></span><span style=display:flex><span>})
</span></span></code></pre></td></tr></table></div></div><p><strong>LCPä¼˜åŒ–ç­–ç•¥</strong></p><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">23
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// 1. ä¼˜åŒ–æœåŠ¡å™¨å“åº”æ—¶é—´
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// - ä½¿ç”¨CDN
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// - ç¼“å­˜é™æ€èµ„æº
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// - é¢„è¿æ¥åˆ°æºæœåŠ¡å™¨
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// 2. ä¼˜åŒ–èµ„æºåŠ è½½
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>&lt;<span style=color:#7ee787>link</span> rel<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>&#34;preload&#34;</span> as<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>&#34;image&#34;</span> href<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>&#34;hero-image.jpg&#34;</span>&gt;
</span></span><span style=display:flex><span>&lt;<span style=color:#7ee787>link</span> rel<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>&#34;preconnect&#34;</span> href<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>&#34;https://api.example.com&#34;</span>&gt;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// 3. ä¼˜åŒ–å…³é”®æ¸²æŸ“è·¯å¾„
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// ä¼˜å…ˆåŠ è½½LCPå…ƒç´ ç›¸å…³èµ„æº
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// 4. å‹ç¼©å’Œä¼˜åŒ–å›¾ç‰‡
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>&lt;<span style=color:#7ee787>img</span>
</span></span><span style=display:flex><span>  src<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>&#34;hero.webp&#34;</span>
</span></span><span style=display:flex><span>  loading<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>&#34;eager&#34;</span>
</span></span><span style=display:flex><span>  width<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>&#34;1200&#34;</span>
</span></span><span style=display:flex><span>  height<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>&#34;600&#34;</span>
</span></span><span style=display:flex><span>  fetchpriority<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>&#34;high&#34;</span>
</span></span><span style=display:flex><span>&gt;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// 5. é¿å…å®¢æˆ·ç«¯JavaScriptæ¸²æŸ“LCPå†…å®¹
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// ä½¿ç”¨æœåŠ¡ç«¯æ¸²æŸ“æˆ–é™æ€ç”Ÿæˆ
</span></span></span></code></pre></td></tr></table></div></div><h3 id=12-inpäº¤äº’åˆ°ä¸‹ä¸€æ¬¡ç»˜åˆ¶>1.2 INPï¼ˆäº¤äº’åˆ°ä¸‹ä¸€æ¬¡ç»˜åˆ¶ï¼‰<a hidden class=anchor aria-hidden=true href=#12-inpäº¤äº’åˆ°ä¸‹ä¸€æ¬¡ç»˜åˆ¶>#</a></h3><p><strong>å®šä¹‰ä¸æ ‡å‡†</strong></p><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">19
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// INPæµ‹é‡é¡µé¢æ•´ä½“å“åº”èƒ½åŠ›
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// è‰¯å¥½ï¼šâ‰¤200æ¯«ç§’
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// éœ€æ”¹è¿›ï¼š200-500æ¯«ç§’
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// å·®ï¼š&gt;500æ¯«ç§’
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>import</span> { onINP } <span style=color:#ff7b72>from</span> <span style=color:#a5d6ff>&#39;web-vitals&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>onINP((metric) <span style=color:#ff7b72;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span>  console.log(<span style=color:#a5d6ff>&#39;INP:&#39;</span>, metric.value)
</span></span><span style=display:flex><span>  console.log(<span style=color:#a5d6ff>&#39;Target:&#39;</span>, metric.entries[<span style=color:#a5d6ff>0</span>].target)  <span style=color:#8b949e;font-style:italic>// äº¤äº’å…ƒç´ 
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>  console.log(<span style=color:#a5d6ff>&#39;Type:&#39;</span>, metric.entries[<span style=color:#a5d6ff>0</span>].name)      <span style=color:#8b949e;font-style:italic>// äº‹ä»¶ç±»å‹
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>
</span></span><span style=display:flex><span>  sendToAnalytics({
</span></span><span style=display:flex><span>    metric<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#a5d6ff>&#39;INP&#39;</span>,
</span></span><span style=display:flex><span>    value: <span style=color:#ff7b72>metric.value</span>,
</span></span><span style=display:flex><span>    target: <span style=color:#ff7b72>metric.entries</span>[<span style=color:#a5d6ff>0</span>].target,
</span></span><span style=display:flex><span>    eventType: <span style=color:#ff7b72>metric.entries</span>[<span style=color:#a5d6ff>0</span>].name
</span></span><span style=display:flex><span>  })
</span></span><span style=display:flex><span>})
</span></span></code></pre></td></tr></table></div></div><p><strong>INPä¼˜åŒ–ç­–ç•¥</strong></p><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">29
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// 1. å‡å°‘JavaScriptæ‰§è¡Œæ—¶é—´
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// ä½¿ç”¨ä»£ç åˆ†å‰²
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span><span style=color:#ff7b72>const</span> heavyModule <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#ff7b72>await</span> <span style=color:#ff7b72>import</span>(<span style=color:#a5d6ff>&#39;./heavy-module&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// 2. ä¼˜åŒ–é•¿ä»»åŠ¡
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// ä½¿ç”¨requestIdleCallback
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span><span style=color:#ff7b72>function</span> scheduleWork(work<span style=color:#ff7b72;font-weight:700>:</span> () <span style=color:#ff7b72;font-weight:700>=&gt;</span> <span style=color:#ff7b72>void</span>) {
</span></span><span style=display:flex><span>  <span style=color:#ff7b72>if</span> (<span style=color:#a5d6ff>&#39;requestIdleCallback&#39;</span> <span style=color:#ff7b72>in</span> window) {
</span></span><span style=display:flex><span>    requestIdleCallback(() <span style=color:#ff7b72;font-weight:700>=&gt;</span> work())
</span></span><span style=display:flex><span>  } <span style=color:#ff7b72>else</span> {
</span></span><span style=display:flex><span>    setTimeout(() <span style=color:#ff7b72;font-weight:700>=&gt;</span> work(), <span style=color:#a5d6ff>0</span>)
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// 3. é¿å…è½®è¯¢
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// âŒ ä¸å¥½çš„åšæ³•
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>setInterval(() <span style=color:#ff7b72;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span>  checkStatus()
</span></span><span style=display:flex><span>}, <span style=color:#a5d6ff>1000</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// âœ… ä½¿ç”¨äº‹ä»¶é©±åŠ¨
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>document.addEventListener(<span style=color:#a5d6ff>&#39;visibilitychange&#39;</span>, checkStatus)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// 4. ä½¿ç”¨Web Workerså¤„ç†è®¡ç®—å¯†é›†å‹ä»»åŠ¡
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span><span style=color:#ff7b72>const</span> worker <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#ff7b72>new</span> Worker(<span style=color:#a5d6ff>&#39;worker.js&#39;</span>)
</span></span><span style=display:flex><span>worker.postMessage({ data: <span style=color:#ff7b72>heavyData</span> })
</span></span><span style=display:flex><span>worker.onmessage <span style=color:#ff7b72;font-weight:700>=</span> (e) <span style=color:#ff7b72;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span>  <span style=color:#ff7b72>const</span> result <span style=color:#ff7b72;font-weight:700>=</span> e.data
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div><h3 id=13-clsç´¯ç§¯å¸ƒå±€åç§»>1.3 CLSï¼ˆç´¯ç§¯å¸ƒå±€åç§»ï¼‰<a hidden class=anchor aria-hidden=true href=#13-clsç´¯ç§¯å¸ƒå±€åç§»>#</a></h3><p><strong>å®šä¹‰ä¸æ ‡å‡†</strong></p><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">23
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// CLSæµ‹é‡é¡µé¢è§†è§‰ç¨³å®šæ€§
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// è‰¯å¥½ï¼šâ‰¤0.1
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// éœ€æ”¹è¿›ï¼š0.1-0.25
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// å·®ï¼š&gt;0.25
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>import</span> { onCLS } <span style=color:#ff7b72>from</span> <span style=color:#a5d6ff>&#39;web-vitals&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>onCLS((metric) <span style=color:#ff7b72;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span>  console.log(<span style=color:#a5d6ff>&#39;CLS:&#39;</span>, metric.value)
</span></span><span style=display:flex><span>  console.log(<span style=color:#a5d6ff>&#39;Entries:&#39;</span>, metric.entries)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  sendToAnalytics({
</span></span><span style=display:flex><span>    metric<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#a5d6ff>&#39;CLS&#39;</span>,
</span></span><span style=display:flex><span>    value: <span style=color:#ff7b72>metric.value</span>,
</span></span><span style=display:flex><span>    entries: <span style=color:#ff7b72>metric.entries.map</span>(entry <span style=color:#ff7b72;font-weight:700>=&gt;</span> ({
</span></span><span style=display:flex><span>      value: <span style=color:#ff7b72>entry.value</span>,
</span></span><span style=display:flex><span>      sources: <span style=color:#ff7b72>entry.sources?.map</span>(source <span style=color:#ff7b72;font-weight:700>=&gt;</span> ({
</span></span><span style=display:flex><span>        node: <span style=color:#ff7b72>source.node?.nodeName</span>,
</span></span><span style=display:flex><span>        currentRect: <span style=color:#ff7b72>source.currentRect</span>
</span></span><span style=display:flex><span>      }))
</span></span><span style=display:flex><span>    }))
</span></span><span style=display:flex><span>  })
</span></span><span style=display:flex><span>})
</span></span></code></pre></td></tr></table></div></div><p><strong>CLSä¼˜åŒ–ç­–ç•¥</strong></p><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">34
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-html data-lang=html><span style=display:flex><span><span style=color:#8b949e;font-style:italic>&lt;!-- 1. ä¸ºå›¾ç‰‡å’Œè§†é¢‘é¢„ç•™ç©ºé—´ --&gt;</span>
</span></span><span style=display:flex><span>&lt;<span style=color:#7ee787>img</span>
</span></span><span style=display:flex><span>  src<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>&#34;image.jpg&#34;</span>
</span></span><span style=display:flex><span>  width<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>&#34;800&#34;</span>
</span></span><span style=display:flex><span>  height<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>&#34;600&#34;</span>
</span></span><span style=display:flex><span>  style<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>&#34;aspect-ratio: 800/600; background: #f0f0f0&#34;</span>
</span></span><span style=display:flex><span>&gt;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>&lt;!-- 2. ä¸ºåŠ¨æ€å†…å®¹é¢„ç•™ç©ºé—´ --&gt;</span>
</span></span><span style=display:flex><span>&lt;<span style=color:#7ee787>div</span> style<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>&#34;min-height: 200px&#34;</span>&gt;
</span></span><span style=display:flex><span>  &lt;<span style=color:#7ee787>div</span> id<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>&#34;dynamic-content&#34;</span>&gt;&lt;/<span style=color:#7ee787>div</span>&gt;
</span></span><span style=display:flex><span>&lt;/<span style=color:#7ee787>div</span>&gt;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>&lt;!-- 3. é¿å…åœ¨ç°æœ‰å†…å®¹ä¸Šæ–¹æ’å…¥å†…å®¹ --&gt;</span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>&lt;!-- âŒ ä¼šé€ æˆå¸ƒå±€åç§» --&gt;</span>
</span></span><span style=display:flex><span>&lt;<span style=color:#7ee787>button</span> onClick<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>&#34;insertAd()&#34;</span>&gt;æ’å…¥å¹¿å‘Š&lt;/<span style=color:#7ee787>button</span>&gt;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>&lt;!-- âœ… ä½¿ç”¨å ä½ç¬¦ --&gt;</span>
</span></span><span style=display:flex><span>&lt;<span style=color:#7ee787>div</span> style<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>&#34;min-height: 250px; background: #f0f0f0&#34;</span>&gt;
</span></span><span style=display:flex><span>  &lt;<span style=color:#7ee787>div</span> id<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>&#34;ad-placeholder&#34;</span>&gt;&lt;/<span style=color:#7ee787>div</span>&gt;
</span></span><span style=display:flex><span>&lt;/<span style=color:#7ee787>div</span>&gt;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>&lt;!-- 4. ä½¿ç”¨transformä»£æ›¿æ”¹å˜å°ºå¯¸çš„åŠ¨ç”» --&gt;</span>
</span></span><span style=display:flex><span>&lt;<span style=color:#7ee787>style</span>&gt;
</span></span><span style=display:flex><span>.<span style=color:#f0883e;font-weight:700>bad</span> {
</span></span><span style=display:flex><span>  <span style=color:#ff7b72>transition</span>: <span style=color:#ff7b72>height</span> <span style=color:#a5d6ff>0.3</span><span style=color:#ff7b72>s</span>;  <span style=color:#8b949e;font-style:italic>/* âŒ ä¼šè§¦å‘CLS */</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>.<span style=color:#f0883e;font-weight:700>good</span> {
</span></span><span style=display:flex><span>  <span style=color:#ff7b72>transition</span>: <span style=color:#ff7b72>transform</span> <span style=color:#a5d6ff>0.3</span><span style=color:#ff7b72>s</span>;  <span style=color:#8b949e;font-style:italic>/* âœ… ä¸ä¼šè§¦å‘CLS */</span>
</span></span><span style=display:flex><span>  <span style=color:#ff7b72>transform</span>: scaleY(<span style=color:#a5d6ff>0</span>);
</span></span><span style=display:flex><span>  <span style=color:#ff7b72>transform-origin</span>: <span style=color:#79c0ff>top</span>;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>&lt;/<span style=color:#7ee787>style</span>&gt;
</span></span></code></pre></td></tr></table></div></div><h2 id=äºŒæ€§èƒ½apiè¯¦è§£>äºŒã€æ€§èƒ½APIè¯¦è§£<a hidden class=anchor aria-hidden=true href=#äºŒæ€§èƒ½apiè¯¦è§£>#</a></h2><h3 id=21-performance-apiåŸºç¡€>2.1 Performance APIåŸºç¡€<a hidden class=anchor aria-hidden=true href=#21-performance-apiåŸºç¡€>#</a></h3><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">34
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// è·å–æ€§èƒ½æŒ‡æ ‡
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span><span style=color:#ff7b72>function</span> getPerformanceMetrics() {
</span></span><span style=display:flex><span>  <span style=color:#ff7b72>const</span> perfData <span style=color:#ff7b72;font-weight:700>=</span> performance.getEntriesByType(<span style=color:#a5d6ff>&#39;navigation&#39;</span>)[<span style=color:#a5d6ff>0</span>] <span style=color:#ff7b72>as</span> PerformanceNavigationTiming
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#ff7b72>return</span> {
</span></span><span style=display:flex><span>    <span style=color:#8b949e;font-style:italic>// DNSæŸ¥è¯¢
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>    dnsLookup: <span style=color:#ff7b72>perfData.domainLookupEnd</span> <span style=color:#ff7b72;font-weight:700>-</span> perfData.domainLookupStart,
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8b949e;font-style:italic>// TCPè¿æ¥
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>    tcpConnection: <span style=color:#ff7b72>perfData.connectEnd</span> <span style=color:#ff7b72;font-weight:700>-</span> perfData.connectStart,
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8b949e;font-style:italic>// è¯·æ±‚å“åº”
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>    requestTime: <span style=color:#ff7b72>perfData.responseEnd</span> <span style=color:#ff7b72;font-weight:700>-</span> perfData.requestStart,
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8b949e;font-style:italic>// DOMè§£æ
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>    domParse: <span style=color:#ff7b72>perfData.domComplete</span> <span style=color:#ff7b72;font-weight:700>-</span> perfData.domInteractive,
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8b949e;font-style:italic>// é¦–æ¬¡ç»˜åˆ¶
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>    firstPaint: <span style=color:#ff7b72>performance.getEntriesByName</span>(<span style=color:#a5d6ff>&#39;first-paint&#39;</span>)[<span style=color:#a5d6ff>0</span>]<span style=color:#ff7b72;font-weight:700>?</span>.startTime,
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8b949e;font-style:italic>// é¦–æ¬¡å†…å®¹ç»˜åˆ¶
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>    firstContentfulPaint: <span style=color:#ff7b72>performance.getEntriesByName</span>(<span style=color:#a5d6ff>&#39;first-contentful-paint&#39;</span>)[<span style=color:#a5d6ff>0</span>]<span style=color:#ff7b72;font-weight:700>?</span>.startTime,
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8b949e;font-style:italic>// å®Œå…¨åŠ è½½
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>    pageLoad: <span style=color:#ff7b72>perfData.loadEventEnd</span> <span style=color:#ff7b72;font-weight:700>-</span> perfData.navigationStart,
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8b949e;font-style:italic>// å†…å­˜ä½¿ç”¨ï¼ˆå¦‚æœæ”¯æŒï¼‰
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>    memory<span style=color:#ff7b72;font-weight:700>:</span> (performance <span style=color:#ff7b72>as</span> <span style=color:#ff7b72>any</span>).memory <span style=color:#ff7b72;font-weight:700>?</span> {
</span></span><span style=display:flex><span>      usedJSHeapSize<span style=color:#ff7b72;font-weight:700>:</span> (performance <span style=color:#ff7b72>as</span> <span style=color:#ff7b72>any</span>).memory.usedJSHeapSize,
</span></span><span style=display:flex><span>      totalJSHeapSize<span style=color:#ff7b72;font-weight:700>:</span> (performance <span style=color:#ff7b72>as</span> <span style=color:#ff7b72>any</span>).memory.totalJSHeapSize,
</span></span><span style=display:flex><span>      jsHeapSizeLimit<span style=color:#ff7b72;font-weight:700>:</span> (performance <span style=color:#ff7b72>as</span> <span style=color:#ff7b72>any</span>).memory.jsHeapSizeLimit
</span></span><span style=display:flex><span>    } <span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#79c0ff>null</span>
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div><h3 id=22-èµ„æºåŠ è½½ç›‘æ§>2.2 èµ„æºåŠ è½½ç›‘æ§<a hidden class=anchor aria-hidden=true href=#22-èµ„æºåŠ è½½ç›‘æ§>#</a></h3><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">36
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// ç›‘æ§èµ„æºåŠ è½½æ€§èƒ½
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span><span style=color:#ff7b72>function</span> observeResources() {
</span></span><span style=display:flex><span>  <span style=color:#ff7b72>const</span> observer <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#ff7b72>new</span> PerformanceObserver((list) <span style=color:#ff7b72;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>for</span> (<span style=color:#ff7b72>const</span> entry <span style=color:#ff7b72>of</span> list.getEntries()) {
</span></span><span style=display:flex><span>      <span style=color:#ff7b72>const</span> resource <span style=color:#ff7b72;font-weight:700>=</span> entry <span style=color:#ff7b72>as</span> PerformanceResourceTiming
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      console.log({
</span></span><span style=display:flex><span>        name: <span style=color:#ff7b72>resource.name</span>,
</span></span><span style=display:flex><span>        duration: <span style=color:#ff7b72>resource.duration</span>,
</span></span><span style=display:flex><span>        size: <span style=color:#ff7b72>resource.transferSize</span>,
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic>// æ—¶é—´åˆ†è§£
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>        redirect: <span style=color:#ff7b72>resource.redirectEnd</span> <span style=color:#ff7b72;font-weight:700>-</span> resource.redirectStart,
</span></span><span style=display:flex><span>        dns: <span style=color:#ff7b72>resource.domainLookupEnd</span> <span style=color:#ff7b72;font-weight:700>-</span> resource.domainLookupStart,
</span></span><span style=display:flex><span>        tcp: <span style=color:#ff7b72>resource.connectEnd</span> <span style=color:#ff7b72;font-weight:700>-</span> resource.connectStart,
</span></span><span style=display:flex><span>        request: <span style=color:#ff7b72>resource.responseStart</span> <span style=color:#ff7b72;font-weight:700>-</span> resource.requestStart,
</span></span><span style=display:flex><span>        response: <span style=color:#ff7b72>resource.responseEnd</span> <span style=color:#ff7b72;font-weight:700>-</span> resource.responseStart,
</span></span><span style=display:flex><span>      })
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  })
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  observer.observe({ entryTypes<span style=color:#ff7b72;font-weight:700>:</span> [<span style=color:#a5d6ff>&#39;resource&#39;</span>] })
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// è·å–æ…¢é€Ÿèµ„æº
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span><span style=color:#ff7b72>function</span> getSlowResources(threshold <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>1000</span>) {
</span></span><span style=display:flex><span>  <span style=color:#ff7b72>const</span> resources <span style=color:#ff7b72;font-weight:700>=</span> performance.getEntriesByType(<span style=color:#a5d6ff>&#39;resource&#39;</span>) <span style=color:#ff7b72>as</span> PerformanceResourceTiming[]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#ff7b72>return</span> resources
</span></span><span style=display:flex><span>    .filter(r <span style=color:#ff7b72;font-weight:700>=&gt;</span> r.duration <span style=color:#ff7b72;font-weight:700>&gt;</span> threshold)
</span></span><span style=display:flex><span>    .map(r <span style=color:#ff7b72;font-weight:700>=&gt;</span> ({
</span></span><span style=display:flex><span>      url: <span style=color:#ff7b72>r.name</span>,
</span></span><span style=display:flex><span>      duration: <span style=color:#ff7b72>Math.round</span>(r.duration),
</span></span><span style=display:flex><span>      size: <span style=color:#ff7b72>Math.round</span>(r.transferSize <span style=color:#ff7b72;font-weight:700>/</span> <span style=color:#a5d6ff>1024</span>) <span style=color:#ff7b72;font-weight:700>+</span> <span style=color:#a5d6ff>&#39; KB&#39;</span>
</span></span><span style=display:flex><span>    }))
</span></span><span style=display:flex><span>    .sort((a, b) <span style=color:#ff7b72;font-weight:700>=&gt;</span> b.duration <span style=color:#ff7b72;font-weight:700>-</span> a.duration)
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div><h3 id=23-é•¿ä»»åŠ¡ç›‘æ§>2.3 é•¿ä»»åŠ¡ç›‘æ§<a hidden class=anchor aria-hidden=true href=#23-é•¿ä»»åŠ¡ç›‘æ§>#</a></h3><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">24
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// ç›‘æ§é˜»å¡ä¸»çº¿ç¨‹çš„é•¿ä»»åŠ¡ï¼ˆ&gt;50msï¼‰
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span><span style=color:#ff7b72>function</span> observeLongTasks() {
</span></span><span style=display:flex><span>  <span style=color:#ff7b72>if</span> (<span style=color:#ff7b72;font-weight:700>!</span>PerformanceObserver.supportedEntryTypes.includes(<span style=color:#a5d6ff>&#39;longtask&#39;</span>)) {
</span></span><span style=display:flex><span>    console.log(<span style=color:#a5d6ff>&#39;Long tasks not supported&#39;</span>)
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>return</span>
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#ff7b72>const</span> observer <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#ff7b72>new</span> PerformanceObserver((list) <span style=color:#ff7b72;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>for</span> (<span style=color:#ff7b72>const</span> entry <span style=color:#ff7b72>of</span> list.getEntries()) {
</span></span><span style=display:flex><span>      console.log(<span style=color:#a5d6ff>&#39;Long task detected:&#39;</span>, {
</span></span><span style=display:flex><span>        duration: <span style=color:#ff7b72>entry.duration</span>,
</span></span><span style=display:flex><span>        startTime: <span style=color:#ff7b72>entry.startTime</span>,
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic>// æ£€æŸ¥æ˜¯å“ªä¸ªå®¹å™¨å¼•èµ·çš„
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>        attribution<span style=color:#ff7b72;font-weight:700>:</span> (entry <span style=color:#ff7b72>as</span> <span style=color:#ff7b72>any</span>).attribution<span style=color:#ff7b72;font-weight:700>?</span>.map((a: <span style=color:#ff7b72>any</span>) <span style=color:#ff7b72;font-weight:700>=&gt;</span> ({
</span></span><span style=display:flex><span>          containerType: <span style=color:#ff7b72>a.containerType</span>,
</span></span><span style=display:flex><span>          containerName: <span style=color:#ff7b72>a.containerName</span>,
</span></span><span style=display:flex><span>          containerSrc: <span style=color:#ff7b72>a.containerSrc</span>
</span></span><span style=display:flex><span>        }))
</span></span><span style=display:flex><span>      })
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  })
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  observer.observe({ entryTypes<span style=color:#ff7b72;font-weight:700>:</span> [<span style=color:#a5d6ff>&#39;longtask&#39;</span>] })
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div><h3 id=24-é¦–æ¬¡è¾“å…¥å»¶è¿Ÿfid>2.4 é¦–æ¬¡è¾“å…¥å»¶è¿Ÿï¼ˆFIDï¼‰<a hidden class=anchor aria-hidden=true href=#24-é¦–æ¬¡è¾“å…¥å»¶è¿Ÿfid>#</a></h3><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">22
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// æµ‹é‡ç”¨æˆ·é¦–æ¬¡äº¤äº’åˆ°æµè§ˆå™¨å“åº”çš„æ—¶é—´
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span><span style=color:#ff7b72>function</span> measureFID() {
</span></span><span style=display:flex><span>  <span style=color:#ff7b72>return</span> <span style=color:#ff7b72>new</span> Promise&lt;<span style=color:#7ee787>number</span>&gt;((resolve) <span style=color:#ff7b72;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>const</span> observer <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#ff7b72>new</span> PerformanceObserver((list) <span style=color:#ff7b72;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span>      <span style=color:#ff7b72>for</span> (<span style=color:#ff7b72>const</span> entry <span style=color:#ff7b72>of</span> list.getEntries()) {
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>if</span> (<span style=color:#ff7b72;font-weight:700>!</span>(entry <span style=color:#ff7b72>as</span> <span style=color:#ff7b72>any</span>).processingStart) <span style=color:#ff7b72>continue</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>const</span> fid <span style=color:#ff7b72;font-weight:700>=</span> (entry <span style=color:#ff7b72>as</span> <span style=color:#ff7b72>any</span>).processingStart <span style=color:#ff7b72;font-weight:700>-</span> entry.startTime
</span></span><span style=display:flex><span>        observer.disconnect()
</span></span><span style=display:flex><span>        resolve(fid)
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>    })
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    observer.observe({ entryTypes<span style=color:#ff7b72;font-weight:700>:</span> [<span style=color:#a5d6ff>&#39;first-input&#39;</span>] })
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8b949e;font-style:italic>// å¦‚æœ5ç§’åæ²¡æœ‰äº¤äº’ï¼Œè¿”å›null
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>    setTimeout(() <span style=color:#ff7b72;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span>      observer.disconnect()
</span></span><span style=display:flex><span>      resolve(<span style=color:#79c0ff>null</span>)
</span></span><span style=display:flex><span>    }, <span style=color:#a5d6ff>5000</span>)
</span></span><span style=display:flex><span>  })
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div><h2 id=ä¸‰æ€§èƒ½æ•°æ®é‡‡é›†>ä¸‰ã€æ€§èƒ½æ•°æ®é‡‡é›†<a hidden class=anchor aria-hidden=true href=#ä¸‰æ€§èƒ½æ•°æ®é‡‡é›†>#</a></h2><h3 id=31-å‰ç«¯åŸ‹ç‚¹ç³»ç»Ÿ>3.1 å‰ç«¯åŸ‹ç‚¹ç³»ç»Ÿ<a hidden class=anchor aria-hidden=true href=#31-å‰ç«¯åŸ‹ç‚¹ç³»ç»Ÿ>#</a></h3><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 56
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 57
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 58
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 59
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 60
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 61
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 62
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 63
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 64
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 65
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 66
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 67
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 68
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 69
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 70
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 71
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 72
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 73
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 74
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 75
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 76
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 77
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 78
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 79
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 80
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 81
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 82
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 83
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 84
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 85
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 86
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 87
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 88
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 89
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 90
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 91
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 92
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 93
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 94
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 95
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 96
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 97
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 98
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 99
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">100
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">101
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">102
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">103
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">104
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">105
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">106
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">107
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">108
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">109
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">110
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">111
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">112
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">113
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">114
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">115
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">116
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">117
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">118
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">119
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">120
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">121
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">122
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">123
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">124
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">125
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">126
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">127
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">128
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">129
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">130
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">131
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">132
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">133
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">134
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">135
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">136
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">137
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">138
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">139
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">140
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">141
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">142
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">143
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">144
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">145
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">146
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">147
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">148
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">149
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">150
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#ff7b72>class</span> PerformanceTracker {
</span></span><span style=display:flex><span>  <span style=color:#ff7b72>private</span> metrics: <span style=color:#ff7b72>Map</span>&lt;<span style=color:#7ee787>string</span>, number<span style=color:#f85149>[]</span>&gt; <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#ff7b72>new</span> Map()
</span></span><span style=display:flex><span>  <span style=color:#ff7b72>private</span> config<span style=color:#ff7b72;font-weight:700>:</span> {
</span></span><span style=display:flex><span>    sampleRate: <span style=color:#ff7b72>number</span>
</span></span><span style=display:flex><span>    endpoint: <span style=color:#ff7b72>string</span>
</span></span><span style=display:flex><span>    batchSize: <span style=color:#ff7b72>number</span>
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#ff7b72>constructor</span>(config<span style=color:#ff7b72;font-weight:700>:</span> { sampleRate: <span style=color:#ff7b72>number</span>; endpoint: <span style=color:#ff7b72>string</span>; batchSize?: <span style=color:#ff7b72>number</span> }) {
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>this</span>.config <span style=color:#ff7b72;font-weight:700>=</span> {
</span></span><span style=display:flex><span>      ...config,
</span></span><span style=display:flex><span>      batchSize: <span style=color:#ff7b72>config.batchSize</span> <span style=color:#ff7b72;font-weight:700>||</span> <span style=color:#a5d6ff>10</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>this</span>.initObservers()
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#ff7b72>private</span> initObservers() {
</span></span><span style=display:flex><span>    <span style=color:#8b949e;font-style:italic>// Core Web Vitals
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>    <span style=color:#ff7b72>this</span>.trackLCP()
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>this</span>.trackINP()
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>this</span>.trackCLS()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8b949e;font-style:italic>// å…¶ä»–æŒ‡æ ‡
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>    <span style=color:#ff7b72>this</span>.trackFCP()
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>this</span>.trackTTI()
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>this</span>.trackResources()
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#ff7b72>private</span> trackLCP() {
</span></span><span style=display:flex><span>    <span style=color:#8b949e;font-style:italic>// ä½¿ç”¨web-vitalsåº“
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>    <span style=color:#ff7b72>import</span>(<span style=color:#a5d6ff>&#39;web-vitals&#39;</span>).then(({ onLCP }) <span style=color:#ff7b72;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span>      onLCP((metric) <span style=color:#ff7b72;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>this</span>.record(<span style=color:#a5d6ff>&#39;LCP&#39;</span>, metric.value)
</span></span><span style=display:flex><span>      })
</span></span><span style=display:flex><span>    })
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#ff7b72>private</span> trackCLS() {
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>import</span>(<span style=color:#a5d6ff>&#39;web-vitals&#39;</span>).then(({ onCLS }) <span style=color:#ff7b72;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span>      onCLS((metric) <span style=color:#ff7b72;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>this</span>.record(<span style=color:#a5d6ff>&#39;CLS&#39;</span>, metric.value)
</span></span><span style=display:flex><span>      })
</span></span><span style=display:flex><span>    })
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#ff7b72>private</span> trackINP() {
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>import</span>(<span style=color:#a5d6ff>&#39;web-vitals&#39;</span>).then(({ onINP }) <span style=color:#ff7b72;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span>      onINP((metric) <span style=color:#ff7b72;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>this</span>.record(<span style=color:#a5d6ff>&#39;INP&#39;</span>, metric.value)
</span></span><span style=display:flex><span>      })
</span></span><span style=display:flex><span>    })
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#ff7b72>private</span> trackFCP() {
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>new</span> PerformanceObserver((list) <span style=color:#ff7b72;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span>      <span style=color:#ff7b72>for</span> (<span style=color:#ff7b72>const</span> entry <span style=color:#ff7b72>of</span> list.getEntries()) {
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>if</span> (entry.name <span style=color:#ff7b72;font-weight:700>===</span> <span style=color:#a5d6ff>&#39;first-contentful-paint&#39;</span>) {
</span></span><span style=display:flex><span>          <span style=color:#ff7b72>this</span>.record(<span style=color:#a5d6ff>&#39;FCP&#39;</span>, entry.startTime)
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>    }).observe({ entryTypes<span style=color:#ff7b72;font-weight:700>:</span> [<span style=color:#a5d6ff>&#39;paint&#39;</span>] })
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#ff7b72>private</span> trackTTI() {
</span></span><span style=display:flex><span>    <span style=color:#8b949e;font-style:italic>// ä½¿ç”¨tti-polyfill
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>    <span style=color:#ff7b72>import</span>(<span style=color:#a5d6ff>&#39;tti-polyfill&#39;</span>).then(({ getTTI }) <span style=color:#ff7b72;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span>      getTTI().then((tti) <span style=color:#ff7b72;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>this</span>.record(<span style=color:#a5d6ff>&#39;TTI&#39;</span>, tti)
</span></span><span style=display:flex><span>      })
</span></span><span style=display:flex><span>    })
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#ff7b72>private</span> trackResources() {
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>const</span> observer <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#ff7b72>new</span> PerformanceObserver((list) <span style=color:#ff7b72;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span>      <span style=color:#ff7b72>for</span> (<span style=color:#ff7b72>const</span> entry <span style=color:#ff7b72>of</span> list.getEntries()) {
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>const</span> resource <span style=color:#ff7b72;font-weight:700>=</span> entry <span style=color:#ff7b72>as</span> PerformanceResourceTiming
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>this</span>.record(<span style=color:#a5d6ff>`resource_</span><span style=color:#a5d6ff>${</span><span style=color:#ff7b72>this</span>.getResourceType(resource.name)<span style=color:#a5d6ff>}</span><span style=color:#a5d6ff>`</span>, resource.duration)
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>    })
</span></span><span style=display:flex><span>    observer.observe({ entryTypes<span style=color:#ff7b72;font-weight:700>:</span> [<span style=color:#a5d6ff>&#39;resource&#39;</span>] })
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#ff7b72>private</span> getResourceType(url: <span style=color:#ff7b72>string</span>)<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#ff7b72>string</span> {
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>if</span> (url.match(<span style=color:#79c0ff>/\.(js|jsx)$/</span>)) <span style=color:#ff7b72>return</span> <span style=color:#a5d6ff>&#39;script&#39;</span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>if</span> (url.match(<span style=color:#79c0ff>/\.(css)$/</span>)) <span style=color:#ff7b72>return</span> <span style=color:#a5d6ff>&#39;stylesheet&#39;</span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>if</span> (url.match(<span style=color:#79c0ff>/\.(png|jpg|jpeg|webp|gif|svg)$/</span>)) <span style=color:#ff7b72>return</span> <span style=color:#a5d6ff>&#39;image&#39;</span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>if</span> (url.match(<span style=color:#79c0ff>/\.(woff|woff2|ttf|eot)$/</span>)) <span style=color:#ff7b72>return</span> <span style=color:#a5d6ff>&#39;font&#39;</span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>return</span> <span style=color:#a5d6ff>&#39;other&#39;</span>
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#ff7b72>private</span> record(metric: <span style=color:#ff7b72>string</span>, value: <span style=color:#ff7b72>number</span>) {
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>if</span> (<span style=color:#ff7b72;font-weight:700>!</span><span style=color:#ff7b72>this</span>.metrics.has(metric)) {
</span></span><span style=display:flex><span>      <span style=color:#ff7b72>this</span>.metrics.<span style=color:#ff7b72>set</span>(metric, [])
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>this</span>.metrics.<span style=color:#ff7b72>get</span>(metric)<span style=color:#ff7b72;font-weight:700>!</span>.push(value)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8b949e;font-style:italic>// è¾¾åˆ°æ‰¹é‡å¤§å°æ—¶å‘é€
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>    <span style=color:#ff7b72>if</span> (<span style=color:#ff7b72>this</span>.metrics.<span style=color:#ff7b72>get</span>(metric)<span style=color:#ff7b72;font-weight:700>!</span>.length <span style=color:#ff7b72;font-weight:700>&gt;=</span> <span style=color:#ff7b72>this</span>.config.batchSize) {
</span></span><span style=display:flex><span>      <span style=color:#ff7b72>this</span>.flush()
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#ff7b72>private</span> flush() {
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>if</span> (<span style=color:#ff7b72>this</span>.metrics.size <span style=color:#ff7b72;font-weight:700>===</span> <span style=color:#a5d6ff>0</span>) <span style=color:#ff7b72>return</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>const</span> data <span style=color:#ff7b72;font-weight:700>=</span> Object.fromEntries(
</span></span><span style=display:flex><span>      Array.<span style=color:#ff7b72>from</span>(<span style=color:#ff7b72>this</span>.metrics.entries()).map(([key, values]) <span style=color:#ff7b72;font-weight:700>=&gt;</span> [
</span></span><span style=display:flex><span>        key,
</span></span><span style=display:flex><span>        {
</span></span><span style=display:flex><span>          count: <span style=color:#ff7b72>values.length</span>,
</span></span><span style=display:flex><span>          avg: <span style=color:#ff7b72>values.reduce</span>((a, b) <span style=color:#ff7b72;font-weight:700>=&gt;</span> a <span style=color:#ff7b72;font-weight:700>+</span> b, <span style=color:#a5d6ff>0</span>) <span style=color:#ff7b72;font-weight:700>/</span> values.length,
</span></span><span style=display:flex><span>          min: <span style=color:#ff7b72>Math.min</span>(...values),
</span></span><span style=display:flex><span>          max: <span style=color:#ff7b72>Math.max</span>(...values),
</span></span><span style=display:flex><span>          p50: <span style=color:#ff7b72>this.percentile</span>(values, <span style=color:#a5d6ff>50</span>),
</span></span><span style=display:flex><span>          p75: <span style=color:#ff7b72>this.percentile</span>(values, <span style=color:#a5d6ff>75</span>),
</span></span><span style=display:flex><span>          p95: <span style=color:#ff7b72>this.percentile</span>(values, <span style=color:#a5d6ff>95</span>)
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>      ])
</span></span><span style=display:flex><span>    )
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    fetch(<span style=color:#ff7b72>this</span>.config.endpoint, {
</span></span><span style=display:flex><span>      method<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#a5d6ff>&#39;POST&#39;</span>,
</span></span><span style=display:flex><span>      headers<span style=color:#ff7b72;font-weight:700>:</span> { <span style=color:#a5d6ff>&#39;Content-Type&#39;</span><span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#a5d6ff>&#39;application/json&#39;</span> },
</span></span><span style=display:flex><span>      body: <span style=color:#ff7b72>JSON.stringify</span>({
</span></span><span style=display:flex><span>        url: <span style=color:#ff7b72>location.href</span>,
</span></span><span style=display:flex><span>        userAgent: <span style=color:#ff7b72>navigator.userAgent</span>,
</span></span><span style=display:flex><span>        timestamp: <span style=color:#ff7b72>Date.now</span>(),
</span></span><span style=display:flex><span>        metrics: <span style=color:#ff7b72>data</span>
</span></span><span style=display:flex><span>      }),
</span></span><span style=display:flex><span>      keepalive: <span style=color:#ff7b72>true</span>
</span></span><span style=display:flex><span>    })
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>this</span>.metrics.clear()
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#ff7b72>private</span> percentile(values: <span style=color:#ff7b72>number</span>[], p: <span style=color:#ff7b72>number</span>)<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#ff7b72>number</span> {
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>const</span> sorted <span style=color:#ff7b72;font-weight:700>=</span> values.slice().sort((a, b) <span style=color:#ff7b72;font-weight:700>=&gt;</span> a <span style=color:#ff7b72;font-weight:700>-</span> b)
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>const</span> index <span style=color:#ff7b72;font-weight:700>=</span> Math.ceil((p <span style=color:#ff7b72;font-weight:700>/</span> <span style=color:#a5d6ff>100</span>) <span style=color:#ff7b72;font-weight:700>*</span> sorted.length) <span style=color:#ff7b72;font-weight:700>-</span> <span style=color:#a5d6ff>1</span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>return</span> sorted[index]
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// ä½¿ç”¨
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span><span style=color:#ff7b72>const</span> tracker <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#ff7b72>new</span> PerformanceTracker({
</span></span><span style=display:flex><span>  sampleRate: <span style=color:#ff7b72>0.1</span>,  <span style=color:#8b949e;font-style:italic>// 10%é‡‡æ ·ç‡
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>  endpoint<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#a5d6ff>&#39;https://analytics.example.com/performance&#39;</span>,
</span></span><span style=display:flex><span>  batchSize: <span style=color:#ff7b72>20</span>
</span></span><span style=display:flex><span>})
</span></span></code></pre></td></tr></table></div></div><h3 id=32-ç”¨æˆ·è¡Œä¸ºåˆ†æ>3.2 ç”¨æˆ·è¡Œä¸ºåˆ†æ<a hidden class=anchor aria-hidden=true href=#32-ç”¨æˆ·è¡Œä¸ºåˆ†æ>#</a></h3><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">56
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">57
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">58
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">59
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">60
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">61
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">62
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">63
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">64
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">65
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">66
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">67
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">68
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#ff7b72>class</span> UserBehaviorTracker {
</span></span><span style=display:flex><span>  <span style=color:#ff7b72>private</span> events: <span style=color:#ff7b72>Array</span>&lt;<span style=color:#7ee787>any</span>&gt; <span style=color:#ff7b72;font-weight:700>=</span> []
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  init() {
</span></span><span style=display:flex><span>    <span style=color:#8b949e;font-style:italic>// ç‚¹å‡»äº‹ä»¶
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>    document.addEventListener(<span style=color:#a5d6ff>&#39;click&#39;</span>, (e) <span style=color:#ff7b72;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span>      <span style=color:#ff7b72>this</span>.track(<span style=color:#a5d6ff>&#39;click&#39;</span>, {
</span></span><span style=display:flex><span>        target: <span style=color:#ff7b72>this.getTargetSelector</span>(e.target <span style=color:#ff7b72>as</span> HTMLElement),
</span></span><span style=display:flex><span>        x: <span style=color:#ff7b72>e.clientX</span>,
</span></span><span style=display:flex><span>        y: <span style=color:#ff7b72>e.clientY</span>
</span></span><span style=display:flex><span>      })
</span></span><span style=display:flex><span>    }, <span style=color:#79c0ff>true</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8b949e;font-style:italic>// æ»šåŠ¨äº‹ä»¶
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>    <span style=color:#ff7b72>let</span> scrollTimeout: <span style=color:#ff7b72>NodeJS.Timeout</span>
</span></span><span style=display:flex><span>    document.addEventListener(<span style=color:#a5d6ff>&#39;scroll&#39;</span>, () <span style=color:#ff7b72;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span>      clearTimeout(scrollTimeout)
</span></span><span style=display:flex><span>      scrollTimeout <span style=color:#ff7b72;font-weight:700>=</span> setTimeout(() <span style=color:#ff7b72;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>this</span>.track(<span style=color:#a5d6ff>&#39;scroll&#39;</span>, {
</span></span><span style=display:flex><span>          scrollDepth: <span style=color:#ff7b72>this.getScrollDepth</span>()
</span></span><span style=display:flex><span>        })
</span></span><span style=display:flex><span>      }, <span style=color:#a5d6ff>100</span>)
</span></span><span style=display:flex><span>    }, <span style=color:#79c0ff>true</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8b949e;font-style:italic>// é¡µé¢å¯è§æ€§å˜åŒ–
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>    document.addEventListener(<span style=color:#a5d6ff>&#39;visibilitychange&#39;</span>, () <span style=color:#ff7b72;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span>      <span style=color:#ff7b72>if</span> (document.hidden) {
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>this</span>.track(<span style=color:#a5d6ff>&#39;pagehide&#39;</span>, {
</span></span><span style=display:flex><span>          timeOnPage: <span style=color:#ff7b72>performance.now</span>()
</span></span><span style=display:flex><span>        })
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>this</span>.flush()
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>    })
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#ff7b72>private</span> track(<span style=color:#ff7b72>type</span><span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#ff7b72>string</span>, data: <span style=color:#ff7b72>any</span>) {
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>this</span>.events.push({
</span></span><span style=display:flex><span>      <span style=color:#ff7b72>type</span>,
</span></span><span style=display:flex><span>      data,
</span></span><span style=display:flex><span>      timestamp: <span style=color:#ff7b72>Date.now</span>(),
</span></span><span style=display:flex><span>      url: <span style=color:#ff7b72>location.href</span>
</span></span><span style=display:flex><span>    })
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>if</span> (<span style=color:#ff7b72>this</span>.events.length <span style=color:#ff7b72;font-weight:700>&gt;</span> <span style=color:#a5d6ff>50</span>) {
</span></span><span style=display:flex><span>      <span style=color:#ff7b72>this</span>.flush()
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#ff7b72>private</span> getTargetSelector(element: <span style=color:#ff7b72>HTMLElement</span>)<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#ff7b72>string</span> {
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>if</span> (element.id) <span style=color:#ff7b72>return</span> <span style=color:#a5d6ff>`#</span><span style=color:#a5d6ff>${</span>element.id<span style=color:#a5d6ff>}</span><span style=color:#a5d6ff>`</span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>if</span> (element.className) <span style=color:#ff7b72>return</span> <span style=color:#a5d6ff>`.</span><span style=color:#a5d6ff>${</span>element.className.split(<span style=color:#a5d6ff>&#39; &#39;</span>)[<span style=color:#a5d6ff>0</span>]<span style=color:#a5d6ff>}</span><span style=color:#a5d6ff>`</span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>return</span> element.tagName.toLowerCase()
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#ff7b72>private</span> getScrollDepth()<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#ff7b72>number</span> {
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>const</span> scrollTop <span style=color:#ff7b72;font-weight:700>=</span> window.scrollY
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>const</span> docHeight <span style=color:#ff7b72;font-weight:700>=</span> document.documentElement.scrollHeight <span style=color:#ff7b72;font-weight:700>-</span> window.innerHeight
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>return</span> Math.round((scrollTop <span style=color:#ff7b72;font-weight:700>/</span> docHeight) <span style=color:#ff7b72;font-weight:700>*</span> <span style=color:#a5d6ff>100</span>)
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#ff7b72>private</span> flush() {
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>if</span> (<span style=color:#ff7b72>this</span>.events.length <span style=color:#ff7b72;font-weight:700>===</span> <span style=color:#a5d6ff>0</span>) <span style=color:#ff7b72>return</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8b949e;font-style:italic>// ä½¿ç”¨sendBeaconç¡®ä¿æ•°æ®å‘é€
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>    navigator.sendBeacon(<span style=color:#a5d6ff>&#39;/api/analytics&#39;</span>, JSON.stringify(<span style=color:#ff7b72>this</span>.events))
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>this</span>.events <span style=color:#ff7b72;font-weight:700>=</span> []
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div><h2 id=å››æ€§èƒ½è¯Šæ–­ä¸ä¼˜åŒ–>å››ã€æ€§èƒ½è¯Šæ–­ä¸ä¼˜åŒ–<a hidden class=anchor aria-hidden=true href=#å››æ€§èƒ½è¯Šæ–­ä¸ä¼˜åŒ–>#</a></h2><h3 id=41-æ€§èƒ½ç“¶é¢ˆåˆ†æ>4.1 æ€§èƒ½ç“¶é¢ˆåˆ†æ<a hidden class=anchor aria-hidden=true href=#41-æ€§èƒ½ç“¶é¢ˆåˆ†æ>#</a></h3><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">56
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">57
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">58
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">59
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">60
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">61
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">62
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">63
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">64
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// æ€§èƒ½è¯Šæ–­æŠ¥å‘Š
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span><span style=color:#ff7b72>class</span> PerformanceDiagnostics {
</span></span><span style=display:flex><span>  <span style=color:#ff7b72>async</span> analyze() {
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>const</span> report <span style=color:#ff7b72;font-weight:700>=</span> {
</span></span><span style=display:flex><span>      metrics: <span style=color:#ff7b72>await</span> <span style=color:#ff7b72>this</span>.getMetrics(),
</span></span><span style=display:flex><span>      issues: <span style=color:#ff7b72>this.detectIssues</span>(),
</span></span><span style=display:flex><span>      recommendations: <span style=color:#ff7b72>this.getRecommendations</span>()
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>return</span> report
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#ff7b72>private</span> <span style=color:#ff7b72>async</span> getMetrics() {
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>const</span> webVitals <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#ff7b72>await</span> <span style=color:#ff7b72>import</span>(<span style=color:#a5d6ff>&#39;web-vitals&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>return</span> Promise.all([
</span></span><span style=display:flex><span>      <span style=color:#ff7b72>this</span>.getLCP(webVitals),
</span></span><span style=display:flex><span>      <span style=color:#ff7b72>this</span>.getCLS(webVitals),
</span></span><span style=display:flex><span>      <span style=color:#ff7b72>this</span>.getINP(webVitals),
</span></span><span style=display:flex><span>      <span style=color:#ff7b72>this</span>.getFCP(),
</span></span><span style=display:flex><span>      <span style=color:#ff7b72>this</span>.getTTI()
</span></span><span style=display:flex><span>    ])
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#ff7b72>private</span> detectIssues() {
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>const</span> issues: <span style=color:#ff7b72>string</span>[] <span style=color:#ff7b72;font-weight:700>=</span> []
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>const</span> resources <span style=color:#ff7b72;font-weight:700>=</span> performance.getEntriesByType(<span style=color:#a5d6ff>&#39;resource&#39;</span>) <span style=color:#ff7b72>as</span> PerformanceResourceTiming[]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8b949e;font-style:italic>// æ£€æŸ¥å¤§èµ„æº
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>    <span style=color:#ff7b72>const</span> largeResources <span style=color:#ff7b72;font-weight:700>=</span> resources.filter(r <span style=color:#ff7b72;font-weight:700>=&gt;</span> r.transferSize <span style=color:#ff7b72;font-weight:700>&gt;</span> <span style=color:#a5d6ff>500</span>_000)
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>if</span> (largeResources.length <span style=color:#ff7b72;font-weight:700>&gt;</span> <span style=color:#a5d6ff>0</span>) {
</span></span><span style=display:flex><span>      issues.push(<span style=color:#a5d6ff>`Found </span><span style=color:#a5d6ff>${</span>largeResources.length<span style=color:#a5d6ff>}</span><span style=color:#a5d6ff> resources larger than 500KB`</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8b949e;font-style:italic>// æ£€æŸ¥æ…¢èµ„æº
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>    <span style=color:#ff7b72>const</span> slowResources <span style=color:#ff7b72;font-weight:700>=</span> resources.filter(r <span style=color:#ff7b72;font-weight:700>=&gt;</span> r.duration <span style=color:#ff7b72;font-weight:700>&gt;</span> <span style=color:#a5d6ff>2000</span>)
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>if</span> (slowResources.length <span style=color:#ff7b72;font-weight:700>&gt;</span> <span style=color:#a5d6ff>0</span>) {
</span></span><span style=display:flex><span>      issues.push(<span style=color:#a5d6ff>`Found </span><span style=color:#a5d6ff>${</span>slowResources.length<span style=color:#a5d6ff>}</span><span style=color:#a5d6ff> resources taking &gt;2s to load`</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8b949e;font-style:italic>// æ£€æŸ¥æœªå‹ç¼©èµ„æº
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>    <span style=color:#ff7b72>const</span> uncompressed <span style=color:#ff7b72;font-weight:700>=</span> resources.filter(r <span style=color:#ff7b72;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span>      <span style=color:#ff7b72>const</span> encoding <span style=color:#ff7b72;font-weight:700>=</span> r.transferSize <span style=color:#ff7b72;font-weight:700>&lt;</span> r.encodedBodySize <span style=color:#ff7b72;font-weight:700>?</span> <span style=color:#a5d6ff>&#39;gzip&#39;</span> <span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#a5d6ff>&#39;none&#39;</span>
</span></span><span style=display:flex><span>      <span style=color:#ff7b72>return</span> encoding <span style=color:#ff7b72;font-weight:700>===</span> <span style=color:#a5d6ff>&#39;none&#39;</span> <span style=color:#ff7b72;font-weight:700>&amp;&amp;</span> r.transferSize <span style=color:#ff7b72;font-weight:700>&gt;</span> <span style=color:#a5d6ff>10</span>_000
</span></span><span style=display:flex><span>    })
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>if</span> (uncompressed.length <span style=color:#ff7b72;font-weight:700>&gt;</span> <span style=color:#a5d6ff>0</span>) {
</span></span><span style=display:flex><span>      issues.push(<span style=color:#a5d6ff>`</span><span style=color:#a5d6ff>${</span>uncompressed.length<span style=color:#a5d6ff>}</span><span style=color:#a5d6ff> resources not compressed`</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>return</span> issues
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#ff7b72>private</span> getRecommendations() {
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>return</span> [
</span></span><span style=display:flex><span>      <span style=color:#a5d6ff>&#39;Enable Brotli compression&#39;</span>,
</span></span><span style=display:flex><span>      <span style=color:#a5d6ff>&#39;Use image optimization (WebP, responsive images)&#39;</span>,
</span></span><span style=display:flex><span>      <span style=color:#a5d6ff>&#39;Implement code splitting&#39;</span>,
</span></span><span style=display:flex><span>      <span style=color:#a5d6ff>&#39;Add resource hints (preconnect, preload)&#39;</span>,
</span></span><span style=display:flex><span>      <span style=color:#a5d6ff>&#39;Optimize critical rendering path&#39;</span>,
</span></span><span style=display:flex><span>      <span style=color:#a5d6ff>&#39;Remove unused CSS/JS&#39;</span>,
</span></span><span style=display:flex><span>      <span style=color:#a5d6ff>&#39;Implement service worker caching&#39;</span>
</span></span><span style=display:flex><span>    ]
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div><h3 id=42-æ€§èƒ½ä¼˜åŒ–å·¥å…·>4.2 æ€§èƒ½ä¼˜åŒ–å·¥å…·<a hidden class=anchor aria-hidden=true href=#42-æ€§èƒ½ä¼˜åŒ–å·¥å…·>#</a></h3><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">56
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">57
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">58
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">59
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">60
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">61
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">62
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">63
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">64
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">65
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">66
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">67
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">68
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">69
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">70
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">71
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">72
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// å›¾ç‰‡ä¼˜åŒ–å·¥å…·
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span><span style=color:#ff7b72>class</span> ImageOptimizer {
</span></span><span style=display:flex><span>  <span style=color:#8b949e;font-style:italic>// æ£€æµ‹æœªä¼˜åŒ–çš„å›¾ç‰‡
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>  detectUnoptimizedImages() {
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>const</span> images <span style=color:#ff7b72;font-weight:700>=</span> document.querySelectorAll(<span style=color:#a5d6ff>&#39;img&#39;</span>)
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>const</span> issues: <span style=color:#ff7b72>any</span>[] <span style=color:#ff7b72;font-weight:700>=</span> []
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    images.forEach(img <span style=color:#ff7b72;font-weight:700>=&gt;</span> {
</span></span><span style=display:flex><span>      <span style=color:#8b949e;font-style:italic>// æ£€æŸ¥ç¼ºå°‘å°ºå¯¸å±æ€§
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>      <span style=color:#ff7b72>if</span> (<span style=color:#ff7b72;font-weight:700>!</span>img.width <span style=color:#ff7b72;font-weight:700>||</span> <span style=color:#ff7b72;font-weight:700>!</span>img.height) {
</span></span><span style=display:flex><span>        issues.push({
</span></span><span style=display:flex><span>          element: <span style=color:#ff7b72>img</span>,
</span></span><span style=display:flex><span>          issue<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#a5d6ff>&#39;Missing width/height attributes&#39;</span>,
</span></span><span style=display:flex><span>          severity<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#a5d6ff>&#39;high&#39;</span>
</span></span><span style=display:flex><span>        })
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      <span style=color:#8b949e;font-style:italic>// æ£€æŸ¥æ˜¯å¦ä½¿ç”¨ç°ä»£æ ¼å¼
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>      <span style=color:#ff7b72>const</span> src <span style=color:#ff7b72;font-weight:700>=</span> img.currentSrc <span style=color:#ff7b72;font-weight:700>||</span> img.src
</span></span><span style=display:flex><span>      <span style=color:#ff7b72>if</span> (src.match(<span style=color:#79c0ff>/\.(jpg|png)$/i</span>)) {
</span></span><span style=display:flex><span>        issues.push({
</span></span><span style=display:flex><span>          element: <span style=color:#ff7b72>img</span>,
</span></span><span style=display:flex><span>          issue<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#a5d6ff>&#39;Using old image format (use WebP)&#39;</span>,
</span></span><span style=display:flex><span>          severity<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#a5d6ff>&#39;medium&#39;</span>
</span></span><span style=display:flex><span>        })
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      <span style=color:#8b949e;font-style:italic>// æ£€æŸ¥æ˜¯å¦å¯ä»¥æ‡’åŠ è½½
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>      <span style=color:#ff7b72>if</span> (<span style=color:#ff7b72;font-weight:700>!</span>img.loading <span style=color:#ff7b72;font-weight:700>&amp;&amp;</span> <span style=color:#ff7b72;font-weight:700>!</span><span style=color:#ff7b72>this</span>.isInViewport(img)) {
</span></span><span style=display:flex><span>        issues.push({
</span></span><span style=display:flex><span>          element: <span style=color:#ff7b72>img</span>,
</span></span><span style=display:flex><span>          issue<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#a5d6ff>&#39;Should use lazy loading&#39;</span>,
</span></span><span style=display:flex><span>          severity<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#a5d6ff>&#39;low&#39;</span>
</span></span><span style=display:flex><span>        })
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>    })
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>return</span> issues
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#ff7b72>private</span> isInViewport(element: <span style=color:#ff7b72>Element</span>)<span style=color:#ff7b72;font-weight:700>:</span> <span style=color:#ff7b72>boolean</span> {
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>const</span> rect <span style=color:#ff7b72;font-weight:700>=</span> element.getBoundingClientRect()
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>return</span> rect.top <span style=color:#ff7b72;font-weight:700>&lt;</span> window.innerHeight <span style=color:#ff7b72;font-weight:700>&amp;&amp;</span> rect.bottom <span style=color:#ff7b72;font-weight:700>&gt;</span> <span style=color:#a5d6ff>0</span>
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// å­—ä½“ä¼˜åŒ–å·¥å…·
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span><span style=color:#ff7b72>class</span> FontOptimizer {
</span></span><span style=display:flex><span>  optimize() {
</span></span><span style=display:flex><span>    <span style=color:#8b949e;font-style:italic>// å­—ä½“æ˜¾ç¤ºç­–ç•¥
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>    <span style=color:#ff7b72>const</span> style <span style=color:#ff7b72;font-weight:700>=</span> document.createElement(<span style=color:#a5d6ff>&#39;style&#39;</span>)
</span></span><span style=display:flex><span>    style.textContent <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>`
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>      @font-face {
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>        font-display: swap;
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>      }
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>    `</span>
</span></span><span style=display:flex><span>    document.head.appendChild(style)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8b949e;font-style:italic>// é¢„åŠ è½½å…³é”®å­—ä½“
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>    <span style=color:#ff7b72>this</span>.preloadFont(<span style=color:#a5d6ff>&#39;/fonts/main.woff2&#39;</span>, <span style=color:#a5d6ff>&#39;woff2&#39;</span>)
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#ff7b72>private</span> preloadFont(url: <span style=color:#ff7b72>string</span>, format: <span style=color:#ff7b72>string</span>) {
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>const</span> link <span style=color:#ff7b72;font-weight:700>=</span> document.createElement(<span style=color:#a5d6ff>&#39;link&#39;</span>)
</span></span><span style=display:flex><span>    link.rel <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>&#39;preload&#39;</span>
</span></span><span style=display:flex><span>    link.<span style=color:#ff7b72>as</span> <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>&#39;font&#39;</span>
</span></span><span style=display:flex><span>    link.href <span style=color:#ff7b72;font-weight:700>=</span> url
</span></span><span style=display:flex><span>    link.<span style=color:#ff7b72>type</span> <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>`font/</span><span style=color:#a5d6ff>${</span>format<span style=color:#a5d6ff>}</span><span style=color:#a5d6ff>`</span>
</span></span><span style=display:flex><span>    link.crossOrigin <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>&#39;anonymous&#39;</span>
</span></span><span style=display:flex><span>    document.head.appendChild(link)
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div><h2 id=æ€»ç»“>æ€»ç»“<a hidden class=anchor aria-hidden=true href=#æ€»ç»“>#</a></h2><p>Webæ€§èƒ½ç›‘æ§æ˜¯ä¸€ä¸ªæŒç»­ä¼˜åŒ–çš„è¿‡ç¨‹ï¼š</p><ol><li><strong>Core Web Vitals</strong> - èšç„¦ç”¨æˆ·ä½“éªŒæ ¸å¿ƒæŒ‡æ ‡</li><li><strong>æ€§èƒ½API</strong> - å……åˆ†åˆ©ç”¨æµè§ˆå™¨æä¾›çš„ç›‘æ§èƒ½åŠ›</li><li><strong>æ•°æ®é‡‡é›†</strong> - å»ºç«‹å®Œå–„çš„æ€§èƒ½æ•°æ®æ”¶é›†ä½“ç³»</li><li><strong>è¯Šæ–­åˆ†æ</strong> - å‡†ç¡®å®šä½æ€§èƒ½ç“¶é¢ˆ</li><li><strong>æŒç»­ä¼˜åŒ–</strong> - åŸºäºæ•°æ®é©±åŠ¨æŒç»­æ”¹è¿›</li></ol><p>è‰¯å¥½çš„æ€§èƒ½ç›‘æ§ä½“ç³»èƒ½å¸®åŠ©å›¢é˜ŸåŠæ—¶å‘ç°é—®é¢˜ã€å®šä½ç“¶é¢ˆï¼Œå¹¶éªŒè¯ä¼˜åŒ–æ•ˆæœã€‚</p><blockquote><p><strong>ç›¸å…³å·¥å…·æ¨è</strong></p><ul><li><a href=https://www.util.cn/tools/json-formatter/>JSONæ ¼å¼åŒ–å·¥å…·</a> - JSONæ•°æ®å¤„ç†</li><li><a href=https://www.util.cn/tools/base64-encode/>Base64ç¼–ç å·¥å…·</a> - ç¼–ç è½¬æ¢</li><li><a href=https://www.util.cn/tools/url-encode/>URLç¼–ç å·¥å…·</a> - URLå‚æ•°å¤„ç†</li></ul></blockquote></div><footer class=post-footer-modern><div class=post-tags-modern><span class=tags-label>ğŸ·ï¸ æ ‡ç­¾</span><div class=tags-list><a href=/blog/tags/web%E6%80%A7%E8%83%BD/ class=tag-pill>Webæ€§èƒ½
</a><a href=/blog/tags/core-web-vitals/ class=tag-pill>Core Web Vitals
</a><a href=/blog/tags/%E6%80%A7%E8%83%BD%E7%9B%91%E6%8E%A7/ class=tag-pill>æ€§èƒ½ç›‘æ§
</a><a href=/blog/tags/%E6%80%A7%E8%83%BDapi/ class=tag-pill>æ€§èƒ½API
</a><a href=/blog/tags/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/ class=tag-pill>æ€§èƒ½ä¼˜åŒ–</a></div></div><style>.post-footer-modern{margin-top:3rem;padding-top:2rem;border-top:1px solid var(--border,#333333)}.post-tags-modern{display:flex;align-items:center;gap:1rem;margin-bottom:2rem;flex-wrap:wrap}.tags-label{font-size:.875rem;font-weight:600;color:var(--secondary,#999999) !important;white-space:nowrap}.tags-list{display:flex;flex-wrap:wrap;gap:.5rem;flex:1}.tag-pill{display:inline-block;padding:.25rem .75rem;background:rgba(255,255,255,5%);border:1px solid var(--border,#333333);border-radius:0;color:var(--secondary,#cccccc) !important;text-decoration:none;font-size:.8rem;font-weight:500;transition:all .2s ease}.tag-pill:hover{background:var(--primary,#ffffff);color:var(--background,#000000) !important;border-color:var(--primary,#ffffff);transform:translateY(-1px)}.post-nav-modern{margin-top:2rem}.nav-grid{display:grid;grid-template-columns:1fr 1fr;gap:1rem}.nav-card{display:flex;align-items:center;gap:1rem;padding:1.25rem;background:rgba(255,255,255,2%);border:1px solid var(--border,#333333);border-radius:12px;text-decoration:none;transition:all .2s ease;min-height:80px}.nav-card:hover{background:rgba(255,255,255,5%);border-color:var(--primary,#ffffff);transform:translateY(-2px)}.nav-card.nav-prev{justify-content:flex-start}.nav-card.nav-next{justify-content:flex-end;text-align:right}.nav-card.nav-next .nav-content{text-align:right}.nav-empty{display:flex;align-items:center;justify-content:center;background:rgba(255,255,255,1%);border:1px dashed var(--border,#333333);color:var(--secondary,#666666)}.nav-arrow{font-size:1.5rem;color:var(--primary,#ffffff);font-weight:300}.nav-content{flex:1}.nav-title{font-size:.95rem;font-weight:600;color:var(--primary,#ffffff) !important;line-height:1.4;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden}[data-theme=light] .post-footer-modern{border-color:var(--border-light,#dee2e6)}[data-theme=light] .tags-label{color:var(--secondary-light,#6c757d) !important}[data-theme=light] .tag-pill{background:rgba(0,0,0,5%);border-color:var(--border-light,#dee2e6);color:var(--secondary-light,#495057) !important}[data-theme=light] .tag-pill:hover{background:var(--primary-light,#0066cc);color:var(--background-light,#ffffff) !important;border-color:var(--primary-light,#0066cc)}[data-theme=light] .nav-card{background:rgba(0,0,0,2%);border-color:var(--border-light,#dee2e6)}[data-theme=light] .nav-card:hover{background:rgba(0,102,204,5%);border-color:var(--primary-light,#0066cc)}[data-theme=light] .nav-empty{background:rgba(0,0,0,1%);border-color:var(--border-light,#dee2e6);color:var(--secondary-light,#6c757d)}[data-theme=light] .nav-arrow{color:var(--primary-light,#0066cc)}[data-theme=light] .nav-title{color:var(--primary-light,#212529) !important}@media(max-width:768px){.nav-grid{grid-template-columns:1fr;gap:.75rem}.nav-card{padding:1rem;min-height:70px}.nav-card.nav-next{text-align:left}.nav-card.nav-next .nav-content{text-align:left}.nav-title{font-size:.875rem}.post-tags-modern{flex-direction:column;gap:.75rem}}@media(max-width:480px){.nav-arrow{font-size:1.25rem}.nav-card{padding:.875rem}.nav-title{font-size:.8rem;-webkit-line-clamp:1}}</style><nav class=post-nav-modern><div class=nav-grid><a href=/blog/articles/rust%E5%86%85%E5%AD%98%E5%AE%89%E5%85%A8%E4%B8%8E%E6%89%80%E6%9C%89%E6%9D%83%E6%9C%BA%E5%88%B6%E6%B7%B1%E5%BA%A6%E8%A7%A3%E6%9E%90%E9%9B%B6%E6%88%90%E6%9C%AC%E6%8A%BD%E8%B1%A1%E7%9A%84%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86/ class="nav-card nav-prev"><div class=nav-arrow>â†</div><div class=nav-content><div class=nav-title>Rustå†…å­˜å®‰å…¨ä¸æ‰€æœ‰æƒæœºåˆ¶æ·±åº¦è§£æï¼šé›¶æˆæœ¬æŠ½è±¡çš„å®ç°åŸç†</div></div></a><a href=/blog/articles/%E5%BE%AE%E5%89%8D%E7%AB%AF%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5%E4%BB%8E%E7%90%86%E8%AE%BA%E5%88%B0%E8%90%BD%E5%9C%B0%E7%9A%84%E5%AE%8C%E6%95%B4%E6%8C%87%E5%8D%97/ class="nav-card nav-next"><div class=nav-content><div class=nav-title>å¾®å‰ç«¯æ¶æ„è®¾è®¡æœ€ä½³å®è·µï¼šä»ç†è®ºåˆ°è½åœ°çš„å®Œæ•´æŒ‡å—</div></div><div class=nav-arrow>â†’</div></a></div></nav></footer></main><aside class=post-sidebar><div class=sidebar-toc id=sidebar-toc><div class=toc-header><div class=toc-title>ç›®å½•</div><button class=toc-toggle id=toc-toggle aria-label="Toggle TOC">
<svg class="toc-toggle-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 6 6 18M6 6l12 12"/></svg></button></div><div class=toc-content id=toc-content><ul class=toc-list><li class="toc-item toc-h2"><a href=#h2-0 class=toc-item-link><span class=toc-item-text>å¼•è¨€</span></a></li><li class="toc-item toc-h2"><a href=#h2-1 class=toc-item-link><span class=toc-item-text>ä¸€ã€Core Web Vitalsè¯¦è§£</span></a></li><li class="toc-item toc-h2"><a href=#h2-2 class=toc-item-link><span class=toc-item-text>äºŒã€æ€§èƒ½APIè¯¦è§£</span></a></li><li class="toc-item toc-h2"><a href=#h2-3 class=toc-item-link><span class=toc-item-text>ä¸‰ã€æ€§èƒ½æ•°æ®é‡‡é›†</span></a></li><li class="toc-item toc-h2"><a href=#h2-4 class=toc-item-link><span class=toc-item-text>å››ã€æ€§èƒ½è¯Šæ–­ä¸ä¼˜åŒ–</span></a></li><li class="toc-item toc-h2"><a href=#h2-5 class=toc-item-link><span class=toc-item-text>æ€»ç»“</span></a></li></ul></div></div><script>document.addEventListener("DOMContentLoaded",function(){const e=document.getElementById("sidebar-toc"),t=document.getElementById("toc-toggle"),o=document.getElementById("toc-content"),i=t?.querySelector(".toc-toggle-icon");if(!e)return;let n=!1;t&&t.addEventListener("click",function(){n=!n,n?(o.style.display="none",e.style.width="auto",i.innerHTML='<path d="M9 18l6-6-6-6"/>'):(o.style.display="block",e.style.width="200px",i.innerHTML='<path d="M18 6L6 18M6 6l12 12"/>')});const s=document.querySelector(".post-content");if(s){const e=s.querySelectorAll("h1");e.forEach((e,t)=>{e.id=`h1-${t}`});const t=s.querySelectorAll("h2");t.forEach((e,t)=>{e.id=`h2-${t}`})}const a=document.querySelectorAll(".toc-item-link");a.forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();const n=this.getAttribute("href").substring(1),t=document.getElementById(n);if(t){const e=document.querySelector(".post-header-main")?.offsetHeight||0,n=t.offsetTop-e-20;window.scrollTo({top:n,behavior:"smooth"})}})})})</script><style>.sidebar-toc{position:sticky;top:2rem;width:200px;background:#fff;border:1px solid #e5e7eb;border-radius:4px;overflow:hidden;box-shadow:0 1px 3px rgba(0,0,0,.1);z-index:100}.sidebar-toc.hidden{display:none}.toc-header{padding:12px 16px;border-bottom:1px solid #e5e7eb;background:#fafbfc;display:flex;align-items:center;justify-content:space-between}.toc-title{margin:0;font-size:13px;font-weight:500;color:#374151 !important;font-family:-apple-system,BlinkMacSystemFont,segoe ui,Roboto,sans-serif;text-transform:uppercase;letter-spacing:1px}.toc-toggle{background:0 0;border:none;cursor:pointer;padding:4px;border-radius:4px;display:flex;align-items:center;justify-content:center;transition:all .2s ease;color:#6b7280}.toc-toggle:hover{background:#e5e7eb;color:#374151}.toc-toggle-icon{transition:transform .2s ease}.toc-content{padding:12px 0}.toc-list{list-style:none;margin:0;padding:0}.toc-item{margin-bottom:4px;display:block !important;visibility:visible !important}.toc-h1,.toc-h2{display:block !important}.toc-h2{margin-left:0}.toc-item-link{display:flex;align-items:center;gap:8px;padding:8px 12px;color:#374151 !important;text-decoration:none;font-size:13px;line-height:1.4;border-radius:3px;transition:all .2s ease;font-weight:400}.toc-item-link:hover{background:#f8fafc;color:#1f2937 !important}.toc-item-link.active{background:#e0f2fe;color:#01579b !important;font-weight:500}.toc-dot{width:8px;height:8px;border-radius:50%;flex-shrink:0}.dot-red{background:#ef4444}.dot-blue{background:#2196f3}.toc-item-text{color:#1f2937 !important;font-weight:400;flex:1;display:inline !important;visibility:visible !important;opacity:1 !important;font-size:13px !important;line-height:1.4 !important}.toc-item-link .toc-item-text{color:#1f2937 !important;display:inline !important;visibility:visible !important;opacity:1 !important}.toc-item.active .dot-red{background:#d32f2f}.toc-item.active .dot-blue{background:#1976d2}[data-theme=dark] .sidebar-toc{background:#1f2937;border-color:#374151;box-shadow:0 1px 3px rgba(0,0,0,.3)}[data-theme=dark] .toc-header{background:#111827;border-color:#374151}[data-theme=dark] .toc-title{color:#f3f4f6 !important}[data-theme=dark] .toc-toggle{color:#9ca3af}[data-theme=dark] .toc-toggle:hover{background:#374151;color:#f3f4f6}[data-theme=dark] .toc-item-link{color:#e5e7eb !important}[data-theme=dark] .toc-item-link:hover{background:#374151;color:#f9fafb !important}[data-theme=dark] .toc-item-link.active{background:#0d47a1;color:#fff !important}[data-theme=dark] .toc-item-text{color:#f9fafb !important;display:inline !important;visibility:visible !important;opacity:1 !important}[data-theme=dark] .toc-item-link .toc-item-text{color:#f9fafb !important;display:inline !important;visibility:visible !important;opacity:1 !important}@media(max-width:1024px){.sidebar-toc{display:none}.post-content-wrapper{grid-template-columns:1fr !important;padding:0 1rem !important}}</style><style>.post-content-wrapper{display:grid;grid-template-columns:1fr 200px;gap:2rem;padding:0 2rem;max-width:100%}.post-content-main{min-width:0}.post-sidebar{position:sticky;top:2rem;height:fit-content;min-width:0}.post-header-main{margin-bottom:2rem;padding-bottom:1rem;border-bottom:1px solid var(--border,#333333)}.post-header-main .post-title{color:var(--primary,#ffffff) !important;font-size:2.5rem;font-weight:700;line-height:1.2;margin-bottom:1rem}.post-header-main .post-description{color:var(--secondary,#cccccc) !important;font-size:1.1rem;line-height:1.6;margin-bottom:1rem}.post-header-main .post-meta{margin-bottom:0}@media(max-width:1024px){.post-content-wrapper{grid-template-columns:1fr !important;gap:1rem;padding:0 1rem !important}.post-sidebar{display:none}}@media(max-width:768px){.post-header-main .post-title{font-size:2rem}.post-header-main .post-description{font-size:1rem}}</style></aside></div></article></main><footer class=footer><span>Â© 2024-2025 æœ‰æ¡å·¥å…·æŠ€æœ¯åšå®¢</span> Â·</footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");if(menu){const e=localStorage.getItem("menu-scroll-position");e&&(menu.scrollLeft=parseInt(e,10)),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}}document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{const e=document.querySelector("html");e.dataset.theme==="dark"?(e.dataset.theme="light",localStorage.setItem("pref-theme","light")):(e.dataset.theme="dark",localStorage.setItem("pref-theme","dark"))})</script></body></html>