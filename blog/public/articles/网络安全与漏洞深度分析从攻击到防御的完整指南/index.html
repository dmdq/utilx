<!doctype html><html lang=zh-cn dir=auto data-theme=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>ç½‘ç»œå®‰å…¨ä¸æ¼æ´æ·±åº¦åˆ†æï¼šä»æ”»å‡»åˆ°é˜²å¾¡çš„å®Œæ•´æŒ‡å— | æŠ€æœ¯åšå®¢ - æœ‰æ¡å·¥å…·</title><meta name=keywords content="ç½‘ç»œå®‰å…¨æœ€ä½³å®è·µ,Webæ¼æ´åˆ†æ,OWASP Top 10,SQLæ³¨å…¥é˜²æŠ¤,XSSæ”»å‡»é˜²æŠ¤,CSRFé˜²æŠ¤,å®‰å…¨ç¼–ç è§„èŒƒ"><meta name=description content="æ·±å…¥æ¢è®¨ç½‘ç»œå®‰å…¨é¢†åŸŸçš„æ ¸å¿ƒä¸»é¢˜ï¼Œæ¶µç›–OWASP Top 10ã€å¸¸è§Webæ¼æ´ã€æ¸—é€æµ‹è¯•æ–¹æ³•ã€å®‰å…¨ç¼–ç å®è·µç­‰ï¼Œå¸®åŠ©å¼€å‘è€…å’Œå®‰å…¨å·¥ç¨‹å¸ˆæ„å»ºæ›´å®‰å…¨çš„ç³»ç»Ÿã€‚"><meta name=author content="æœ‰æ¡å·¥å…·å›¢é˜Ÿ"><link rel=canonical href=/blog/articles/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E4%B8%8E%E6%BC%8F%E6%B4%9E%E6%B7%B1%E5%BA%A6%E5%88%86%E6%9E%90%E4%BB%8E%E6%94%BB%E5%87%BB%E5%88%B0%E9%98%B2%E5%BE%A1%E7%9A%84%E5%AE%8C%E6%95%B4%E6%8C%87%E5%8D%97/><link crossorigin=anonymous href=/blog/assets/css/stylesheet.7e8505b7cdf8bb22ab2305e53c2700bb06c7e64faeb72cd3468823a9a3bd3d6e.css integrity="sha256-foUFt834uyKrIwXlPCcAuwbH5k+utyzTRogjqaO9PW4=" rel="preload stylesheet" as=style><link rel=icon href=/favicon.ico><link rel=icon type=image/png sizes=16x16 href=/blog/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=/blog/favicon-32x32.png><link rel=apple-touch-icon href=/blog/apple-touch-icon.png><link rel=mask-icon href=/blog/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate type=application/rss+xml href=/blog/articles/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E4%B8%8E%E6%BC%8F%E6%B4%9E%E6%B7%B1%E5%BA%A6%E5%88%86%E6%9E%90%E4%BB%8E%E6%94%BB%E5%87%BB%E5%88%B0%E9%98%B2%E5%BE%A1%E7%9A%84%E5%AE%8C%E6%95%B4%E6%8C%87%E5%8D%97/feed.xml title=rss><link rel=alternate hreflang=zh-cn href=/blog/articles/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E4%B8%8E%E6%BC%8F%E6%B4%9E%E6%B7%B1%E5%BA%A6%E5%88%86%E6%9E%90%E4%BB%8E%E6%94%BB%E5%87%BB%E5%88%B0%E9%98%B2%E5%BE%A1%E7%9A%84%E5%AE%8C%E6%95%B4%E6%8C%87%E5%8D%97/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51);color-scheme:dark}.list{background:var(--theme)}.toc{background:var(--entry)}}@media(prefers-color-scheme:light){.list::-webkit-scrollbar-thumb{border-color:var(--code-bg)}}</style></noscript><script>localStorage.getItem("pref-theme")==="dark"?document.querySelector("html").dataset.theme="dark":localStorage.getItem("pref-theme")==="light"?document.querySelector("html").dataset.theme="light":window.matchMedia("(prefers-color-scheme: dark)").matches?document.querySelector("html").dataset.theme="dark":document.querySelector("html").dataset.theme="light"</script><script src=/js/external-link-config.js></script><script src=/js/external-link-interceptor.js></script><link rel=stylesheet href=/blog/css/custom.css media=screen><script type=application/ld+json>{"@context":"https://schema.org","@type":"WebSite","name":"æŠ€æœ¯åšå®¢ - æœ‰æ¡å·¥å…· | å¼€å‘è€…å·¥å…·ä½¿ç”¨æ•™ç¨‹ & ç¼–ç¨‹æŠ€å·§åˆ†äº«","url":"https://www.util.cn/blog/","description":"æœ‰æ¡å·¥å…·æŠ€æœ¯åšå®¢ - åˆ†äº«å¼€å‘è€…å·¥å…·ä½¿ç”¨æ•™ç¨‹ã€ç¼–ç¨‹æŠ€å·§å’Œå®æˆ˜å¼€å‘ç»éªŒã€‚æä¾›JSONæ ¼å¼åŒ–ã€SQLä¼˜åŒ–ã€Markdownç¼–è¾‘å™¨ç­‰åœ¨çº¿å·¥å…·çš„è¯¦ç»†ä½¿ç”¨æŒ‡å—ï¼Œå¸®åŠ©å¼€å‘è€…æå‡å·¥ä½œæ•ˆç‡ã€‚","publisher":{"@type":"Organization","name":"æœ‰æ¡å·¥å…·","url":"https://www.util.cn","logo":{"@type":"ImageObject","url":"https://www.util.cn/blog/logo/logo-256.png","width":256,"height":256}},"potentialAction":[{"@type":"SearchAction","target":"https://www.util.cn/blog/search?q={search_term_string}","query-input":"required name=search_term_string"}]}</script><meta property="og:type" content="website"><meta property="og:title" content="æŠ€æœ¯åšå®¢ - æœ‰æ¡å·¥å…· | å¼€å‘è€…å·¥å…·ä½¿ç”¨æ•™ç¨‹ & ç¼–ç¨‹æŠ€å·§åˆ†äº«"><meta property="og:description" content="æœ‰æ¡å·¥å…·æŠ€æœ¯åšå®¢ - åˆ†äº«å¼€å‘è€…å·¥å…·ä½¿ç”¨æ•™ç¨‹ã€ç¼–ç¨‹æŠ€å·§å’Œå®æˆ˜å¼€å‘ç»éªŒã€‚æä¾›JSONæ ¼å¼åŒ–ã€SQLä¼˜åŒ–ã€Markdownç¼–è¾‘å™¨ç­‰åœ¨çº¿å·¥å…·çš„è¯¦ç»†ä½¿ç”¨æŒ‡å—ï¼Œå¸®åŠ©å¼€å‘è€…æå‡å·¥ä½œæ•ˆç‡ã€‚"><meta property="og:url" content="https://www.util.cn/blog/"><meta property="og:site_name" content="æœ‰æ¡å·¥å…·æŠ€æœ¯åšå®¢"><meta property="og:image" content="https://www.util.cn/blog/logo/logo-256.png"><meta property="og:image:width" content="1200"><meta property="og:image:height" content="630"><meta name=twitter:card content="summary_large_image"><meta name=twitter:title content="æŠ€æœ¯åšå®¢ - æœ‰æ¡å·¥å…· | å¼€å‘è€…å·¥å…·ä½¿ç”¨æ•™ç¨‹ & ç¼–ç¨‹æŠ€å·§åˆ†äº«"><meta name=twitter:description content="æœ‰æ¡å·¥å…·æŠ€æœ¯åšå®¢ - åˆ†äº«å¼€å‘è€…å·¥å…·ä½¿ç”¨æ•™ç¨‹ã€ç¼–ç¨‹æŠ€å·§å’Œå®æˆ˜å¼€å‘ç»éªŒã€‚"><meta name=twitter:image content="https://www.util.cn/blog/logo/logo-256.png"><meta name=baidu-site-verification content><meta name=category content="æŠ€æœ¯åšå®¢,å¼€å‘è€…å·¥å…·,ç¼–ç¨‹æ•™ç¨‹"><meta name=coverage content="Worldwide"><meta name=distribution content="Global"><meta name=rating content="General"><script id=51la_code async crossorigin=anonymous src="https://sdk.51.la/js-sdk-pro.min.js?id=3OM52V0xJAPv6ozF&hash=pro"></script><script>window.addEventListener("load",function(){setTimeout(function(){typeof la!="undefined"?console.log("51laç»Ÿè®¡å·²åŠ è½½"):(console.warn("51laç»Ÿè®¡åŠ è½½å¤±è´¥ï¼Œä½¿ç”¨å¤‡ç”¨æ–¹æ¡ˆ"),function(){var e=document.createElement("script");e.src="https://sdk.51.la/js-sdk-pro.min.js?id=3OM52V0xJAPv6ozF&hash=backup",e.async=!0,document.head.appendChild(e)}())},3e3)})</script><meta property="og:url" content="/blog/articles/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E4%B8%8E%E6%BC%8F%E6%B4%9E%E6%B7%B1%E5%BA%A6%E5%88%86%E6%9E%90%E4%BB%8E%E6%94%BB%E5%87%BB%E5%88%B0%E9%98%B2%E5%BE%A1%E7%9A%84%E5%AE%8C%E6%95%B4%E6%8C%87%E5%8D%97/"><meta property="og:site_name" content="æŠ€æœ¯åšå®¢ - æœ‰æ¡å·¥å…·"><meta property="og:title" content="ç½‘ç»œå®‰å…¨ä¸æ¼æ´æ·±åº¦åˆ†æï¼šä»æ”»å‡»åˆ°é˜²å¾¡çš„å®Œæ•´æŒ‡å—"><meta property="og:description" content="æ·±å…¥æ¢è®¨ç½‘ç»œå®‰å…¨é¢†åŸŸçš„æ ¸å¿ƒä¸»é¢˜ï¼Œæ¶µç›–OWASP Top 10ã€å¸¸è§Webæ¼æ´ã€æ¸—é€æµ‹è¯•æ–¹æ³•ã€å®‰å…¨ç¼–ç å®è·µç­‰ï¼Œå¸®åŠ©å¼€å‘è€…å’Œå®‰å…¨å·¥ç¨‹å¸ˆæ„å»ºæ›´å®‰å…¨çš„ç³»ç»Ÿã€‚"><meta property="og:locale" content="zh-cn"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2025-12-30T14:00:00+08:00"><meta property="article:modified_time" content="2025-12-30T14:00:00+08:00"><meta property="article:tag" content="ç½‘ç»œå®‰å…¨"><meta property="article:tag" content="æ¼æ´åˆ†æ"><meta property="article:tag" content="OWASP Top 10"><meta property="article:tag" content="æ¸—é€æµ‹è¯•"><meta property="article:tag" content="å®‰å…¨ç¼–ç "><meta name=twitter:card content="summary"><meta name=twitter:title content="ç½‘ç»œå®‰å…¨ä¸æ¼æ´æ·±åº¦åˆ†æï¼šä»æ”»å‡»åˆ°é˜²å¾¡çš„å®Œæ•´æŒ‡å—"><meta name=twitter:description content="æ·±å…¥æ¢è®¨ç½‘ç»œå®‰å…¨é¢†åŸŸçš„æ ¸å¿ƒä¸»é¢˜ï¼Œæ¶µç›–OWASP Top 10ã€å¸¸è§Webæ¼æ´ã€æ¸—é€æµ‹è¯•æ–¹æ³•ã€å®‰å…¨ç¼–ç å®è·µç­‰ï¼Œå¸®åŠ©å¼€å‘è€…å’Œå®‰å…¨å·¥ç¨‹å¸ˆæ„å»ºæ›´å®‰å…¨çš„ç³»ç»Ÿã€‚"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"æ‰€æœ‰æ–‡ç« ","item":"/blog/posts/"},{"@type":"ListItem","position":2,"name":"ç½‘ç»œå®‰å…¨ä¸æ¼æ´æ·±åº¦åˆ†æï¼šä»æ”»å‡»åˆ°é˜²å¾¡çš„å®Œæ•´æŒ‡å—","item":"/blog/articles/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E4%B8%8E%E6%BC%8F%E6%B4%9E%E6%B7%B1%E5%BA%A6%E5%88%86%E6%9E%90%E4%BB%8E%E6%94%BB%E5%87%BB%E5%88%B0%E9%98%B2%E5%BE%A1%E7%9A%84%E5%AE%8C%E6%95%B4%E6%8C%87%E5%8D%97/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"ç½‘ç»œå®‰å…¨ä¸æ¼æ´æ·±åº¦åˆ†æï¼šä»æ”»å‡»åˆ°é˜²å¾¡çš„å®Œæ•´æŒ‡å—","name":"ç½‘ç»œå®‰å…¨ä¸æ¼æ´æ·±åº¦åˆ†æï¼šä»æ”»å‡»åˆ°é˜²å¾¡çš„å®Œæ•´æŒ‡å—","description":"æ·±å…¥æ¢è®¨ç½‘ç»œå®‰å…¨é¢†åŸŸçš„æ ¸å¿ƒä¸»é¢˜ï¼Œæ¶µç›–OWASP Top 10ã€å¸¸è§Webæ¼æ´ã€æ¸—é€æµ‹è¯•æ–¹æ³•ã€å®‰å…¨ç¼–ç å®è·µç­‰ï¼Œå¸®åŠ©å¼€å‘è€…å’Œå®‰å…¨å·¥ç¨‹å¸ˆæ„å»ºæ›´å®‰å…¨çš„ç³»ç»Ÿã€‚","keywords":["ç½‘ç»œå®‰å…¨æœ€ä½³å®è·µ","Webæ¼æ´åˆ†æ","OWASP Top 10","SQLæ³¨å…¥é˜²æŠ¤","XSSæ”»å‡»é˜²æŠ¤","CSRFé˜²æŠ¤","å®‰å…¨ç¼–ç è§„èŒƒ"],"articleBody":"å¼•è¨€ ç½‘ç»œå®‰å…¨æ˜¯æ•°å­—åŒ–æ—¶ä»£çš„æ ¸å¿ƒæŒ‘æˆ˜ã€‚éšç€æ”»å‡»æ‰‹æ®µçš„ä¸æ–­æ¼”è¿›ï¼Œäº†è§£å¸¸è§æ¼æ´ã€æ”»å‡»æ–¹æ³•å’Œé˜²å¾¡ç­–ç•¥å˜å¾—è‡³å…³é‡è¦ã€‚æœ¬æ–‡å°†æ·±å…¥åˆ†æç½‘ç»œå®‰å…¨é¢†åŸŸçš„æ ¸å¿ƒä¸»é¢˜ï¼Œå¸®åŠ©è¯»è€…æ„å»ºæ›´å®‰å…¨çš„ç³»ç»Ÿã€‚\nä¸€ã€OWASP Top 10æ·±åº¦è§£æ 1.1 æ³¨å…¥æ¼æ´ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 # ========== SQLæ³¨å…¥ ========== # ä¸å®‰å…¨çš„ä»£ç ç¤ºä¾‹ def get_user_by_id(user_id): \"\"\"å±é™©ï¼šç›´æ¥æ‹¼æ¥SQL\"\"\" query = f\"SELECT * FROM users WHERE id = {user_id}\" return db.execute(query) # æ”»å‡»ç¤ºä¾‹ # user_id = \"1 OR 1=1\" # å®é™…æ‰§è¡Œçš„SQL: SELECT * FROM users WHERE id = 1 OR 1=1 # ç»“æœï¼šè¿”å›æ‰€æœ‰ç”¨æˆ·æ•°æ® # å®‰å…¨çš„ä»£ç ç¤ºä¾‹ import sqlite3 from typing import Optional class UserRepository: \"\"\"å®‰å…¨çš„ç”¨æˆ·ä»“åº“\"\"\" def __init__(self, db_path: str): self.conn = sqlite3.connect(db_path) def get_user_by_id(self, user_id: int) -\u003e Optional[dict]: \"\"\"ä½¿ç”¨å‚æ•°åŒ–æŸ¥è¯¢\"\"\" cursor = self.conn.cursor() # ä½¿ç”¨?å ä½ç¬¦ï¼Œæ•°æ®åº“é©±åŠ¨ä¼šæ­£ç¡®è½¬ä¹‰å‚æ•° query = \"SELECT * FROM users WHERE id = ?\" cursor.execute(query, (user_id,)) row = cursor.fetchone() if row: return { 'id': row[0], 'username': row[1], 'email': row[2] } return None def search_users(self, keyword: str) -\u003e list: \"\"\"å®‰å…¨çš„æœç´¢åŠŸèƒ½\"\"\" cursor = self.conn.cursor() query = \"\"\" SELECT id, username, email FROM users WHERE username LIKE ? OR email LIKE ? \"\"\" # ä½¿ç”¨é€šé…ç¬¦è¿›è¡Œæ¨¡ç³Šæœç´¢ pattern = f\"%{keyword}%\" cursor.execute(query, (pattern, pattern)) return cursor.fetchall() # ========== SQLæ³¨å…¥æ£€æµ‹ä¸é˜²å¾¡ ========== class SQLInjectionDetector: \"\"\"SQLæ³¨å…¥æ£€æµ‹å™¨\"\"\" # å¸¸è§SQLæ³¨å…¥ç‰¹å¾ INJECTION_PATTERNS = [ r\"(\\%27)|(\\')\", # å•å¼•å· r\"(\\-\\-)|(#)\", # æ³¨é‡Šç¬¦ r\"(\\bor\\b|\\band\\b).*?=.*?\", # é€»è¾‘è¿ç®—ç¬¦ r\"(\\bunion\\b.*\\bselect\\b)\", # UNIONæŸ¥è¯¢ r\"(\\bselect\\b.*\\bfrom\\b)\", # SELECTæŸ¥è¯¢ r\"(\\bexec\\b|\\bexecute\\b)\", # æ‰§è¡Œå‘½ä»¤ r\"(;|\\bxp_cmdshell\\b)\", # å‘½ä»¤åˆ†éš”ç¬¦å’Œå­˜å‚¨è¿‡ç¨‹ r\"(\\bdrop\\b|\\bdelete\\b|\\btruncate\\b)\", # å±é™©æ“ä½œ ] @classmethod def detect_injection(cls, input_string: str) -\u003e bool: \"\"\"æ£€æµ‹SQLæ³¨å…¥\"\"\" import re for pattern in cls.INJECTION_PATTERNS: if re.search(pattern, input_string, re.IGNORECASE): return True return False @classmethod def sanitize_input(cls, input_string: str) -\u003e str: \"\"\"æ¸…ç†è¾“å…¥\"\"\" import re # ç§»é™¤å±é™©å­—ç¬¦ sanitized = re.sub(r\"[\\'\\\"\\;\\-\\-]\", \"\", input_string) # é™åˆ¶é•¿åº¦ max_length = 100 sanitized = sanitized[:max_length] return sanitized # ========== ORMå®‰å…¨ä½¿ç”¨ ========== from sqlalchemy import create_engine, Column, Integer, String from sqlalchemy.ext.declarative import declarative_base from sqlalchemy.orm import sessionmaker Base = declarative_base() class User(Base): \"\"\"ç”¨æˆ·æ¨¡å‹\"\"\" __tablename__ = 'users' id = Column(Integer, primary_key=True) username = Column(String(50), nullable=False) email = Column(String(100), nullable=False) class SecureUserRepository: \"\"\"ä½¿ç”¨ORMçš„å®‰å…¨ä»“åº“\"\"\" def __init__(self, database_url: str): self.engine = create_engine(database_url) Session = sessionmaker(bind=self.engine) self.session = Session() def get_user_by_id(self, user_id: int) -\u003e Optional[User]: \"\"\"ORMè‡ªåŠ¨å¤„ç†å‚æ•°åŒ–\"\"\" return self.session.query(User).filter( User.id == user_id ).first() def search_users(self, keyword: str) -\u003e list: \"\"\"å®‰å…¨çš„æœç´¢\"\"\" return self.session.query(User).filter( (User.username.like(f\"%{keyword}%\")) | (User.email.like(f\"%{keyword}%\")) ).all() 1.2 è·¨ç«™è„šæœ¬æ”»å‡»(XSS) 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 # ========== XSSæ”»å‡»ç±»å‹ ========== \"\"\" 1. åå°„å‹XSS (Reflected XSS) - æ¶æ„ä»£ç é€šè¿‡URLå‚æ•°åå°„ - ä¾‹å¦‚: http://example.com/search?q= 2. å­˜å‚¨å‹XSS (Stored XSS) - æ¶æ„ä»£ç å­˜å‚¨åœ¨æœåŠ¡å™¨ï¼Œæ¯æ¬¡è®¿é—®æ—¶æ‰§è¡Œ - ä¾‹å¦‚: è¯„è®ºã€ç”¨æˆ·èµ„æ–™ç­‰å¯å­˜å‚¨çš„å†…å®¹ 3. DOMå‹XSS (DOM-based XSS) - æ¶æ„ä»£ç é€šè¿‡DOMæ“ä½œæ‰§è¡Œ - ä¾‹å¦‚: # \"\"\" # ========== XSSé˜²å¾¡ ========== import html import re from typing import Dict, Any class XSSProtection: \"\"\"XSSé˜²æŠ¤\"\"\" @staticmethod def escape_html(text: str) -\u003e str: \"\"\"HTMLè½¬ä¹‰\"\"\" return html.escape(text, quote=True) @staticmethod def escape_js(text: str) -\u003e str: \"\"\"JavaScriptå­—ç¬¦ä¸²è½¬ä¹‰\"\"\" escape_map = { '\\\\': '\\\\\\\\', '\"': '\\\\\"', \"'\": \"\\\\'\", '\\n': '\\\\n', '\\r': '\\\\r', '\\t': '\\\\t', '\\b': '\\\\b', '\\f': '\\\\f', } for char, escaped in escape_map.items(): text = text.replace(char, escaped) return text @staticmethod def sanitize_html(content: str, allowed_tags: list = None) -\u003e str: \"\"\"HTMLå‡€åŒ–ï¼Œåªå…è®¸å®‰å…¨çš„æ ‡ç­¾\"\"\" if allowed_tags is None: allowed_tags = ['p', 'br', 'strong', 'em', 'u', 'a'] import bleach return bleach.clean( content, tags=allowed_tags, attributes={ 'a': ['href', 'title'], '*': ['class'] }, strip=True ) @staticmethod def validate_url(url: str) -\u003e bool: \"\"\"éªŒè¯URLå®‰å…¨æ€§\"\"\" import urllib.parse try: parsed = urllib.parse.urlparse(url) # æ£€æŸ¥åè®® if parsed.scheme not in ['http', 'https']: return False # æ£€æŸ¥æ˜¯å¦ä¸ºJavaScriptä¼ªåè®® if parsed.scheme.lower() == 'javascript': return False return True except Exception: return False # Webæ¡†æ¶é›†æˆç¤ºä¾‹ from flask import Flask, request, render_template_string app = Flask(__name__) # ä¸å®‰å…¨çš„ç¤ºä¾‹ @app.route('/unsafe') def unsafe_search(): query = request.args.get('q', '') # å±é™©ï¼šç›´æ¥æ¸²æŸ“ç”¨æˆ·è¾“å…¥ return render_template_string(f'æœç´¢ç»“æœ: {query}\n') # å®‰å…¨çš„ç¤ºä¾‹ @app.route('/safe') def safe_search(): query = request.args.get('q', '') # è½¬ä¹‰ç”¨æˆ·è¾“å…¥ safe_query = XSSProtection.escape_html(query) # æˆ–ä½¿ç”¨æ¨¡æ¿å¼•æ“çš„è‡ªåŠ¨è½¬ä¹‰ return render_template_string( 'æœç´¢ç»“æœ: {{ query }}\n', query=safe_query ) # Content Security Policy (CSP) @app.after_request def add_security_headers(response): \"\"\"æ·»åŠ å®‰å…¨å¤´\"\"\" csp = ( \"default-src 'self'; \" \"script-src 'self' 'unsafe-inline' https://cdn.example.com; \" \"style-src 'self' 'unsafe-inline'; \" \"img-src 'self' data: https:; \" \"font-src 'self' data:; \" \"connect-src 'self'; \" \"frame-ancestors 'none';\" ) response.headers['Content-Security-Policy'] = csp response.headers['X-Content-Type-Options'] = 'nosniff' response.headers['X-Frame-Options'] = 'DENY' response.headers['X-XSS-Protection'] = '1; mode=block' return response # ========== è¾“å…¥éªŒè¯ ========== class InputValidator: \"\"\"è¾“å…¥éªŒè¯å™¨\"\"\" @staticmethod def validate_username(username: str) -\u003e bool: \"\"\"éªŒè¯ç”¨æˆ·å\"\"\" # é•¿åº¦æ£€æŸ¥ if len(username) \u003c 3 or len(username) \u003e 20: return False # å­—ç¬¦æ£€æŸ¥ï¼šåªå…è®¸å­—æ¯ã€æ•°å­—ã€ä¸‹åˆ’çº¿ import re pattern = r'^[a-zA-Z0-9_]+$' return bool(re.match(pattern, username)) @staticmethod def validate_email(email: str) -\u003e bool: \"\"\"éªŒè¯é‚®ç®±\"\"\" import re pattern = r'^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\\.[a-zA-Z]{2,}$' return bool(re.match(pattern, email)) @staticmethod def validate_phone(phone: str) -\u003e bool: \"\"\"éªŒè¯æ‰‹æœºå·\"\"\" import re pattern = r'^1[3-9]\\d{9}$' return bool(re.match(pattern, phone)) 1.3 CSRFé˜²æŠ¤ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 # ========== CSRFæ”»å‡»åŸç† ========== \"\"\" CSRF (Cross-Site Request Forgery) è·¨ç«™è¯·æ±‚ä¼ªé€  æ”»å‡»åœºæ™¯ï¼š 1. ç”¨æˆ·ç™»å½•äº†é“¶è¡Œç½‘ç«™ bank.com 2. ç”¨æˆ·è®¿é—®äº†æ¶æ„ç½‘ç«™ evil.com 3. evil.com åŒ…å«æŒ‡å‘ bank.com çš„è¯·æ±‚ 4. æµè§ˆå™¨è‡ªåŠ¨æºå¸¦ bank.com çš„ cookie 5. é“¶è¡Œç½‘ç«™å¤„ç†è½¬è´¦è¯·æ±‚ é˜²å¾¡æªæ–½ï¼š 1. CSRF Token 2. SameSite Cookieå±æ€§ 3. éªŒè¯Referer/Originå¤´ 4. åŒé‡æäº¤Cookie \"\"\" # ========== CSRFé˜²æŠ¤å®ç° ========== import secrets from flask import Flask, request, session, render_template app = Flask(__name__) app.secret_key = secrets.token_hex(32) class CSRFProtection: \"\"\"CSRFé˜²æŠ¤\"\"\" @staticmethod def generate_token() -\u003e str: \"\"\"ç”ŸæˆCSRF Token\"\"\" return secrets.token_hex(32) @staticmethod def validate_token(token: str, stored_token: str) -\u003e bool: \"\"\"éªŒè¯Token\"\"\" return secrets.compare_digest(token, stored_token) # åœ¨Flaskä¸­ä½¿ç”¨CSRFä¿æŠ¤ @app.before_request def csrf_protect(): \"\"\"CSRFä¿æŠ¤ä¸­é—´ä»¶\"\"\" # è±å…å®‰å…¨çš„æ–¹æ³• if request.method in ['GET', 'HEAD', 'OPTIONS', 'TRACE']: return # æ£€æŸ¥CSRF Token token = request.headers.get('X-CSRF-Token') or request.form.get('csrf_token') if not token or token != session.get('csrf_token'): return 'Invalid CSRF token', 403 @app.route('/form') def show_form(): \"\"\"æ˜¾ç¤ºè¡¨å•\"\"\" # ç”Ÿæˆå¹¶å­˜å‚¨CSRF Token csrf_token = CSRFProtection.generate_token() session['csrf_token'] = csrf_token return f''' ","wordCount":"4332","inLanguage":"zh-cn","datePublished":"2025-12-30T14:00:00+08:00","dateModified":"2025-12-30T14:00:00+08:00","author":{"@type":"Person","name":"æœ‰æ¡å·¥å…·å›¢é˜Ÿ"},"mainEntityOfPage":{"@type":"WebPage","@id":"/blog/articles/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E4%B8%8E%E6%BC%8F%E6%B4%9E%E6%B7%B1%E5%BA%A6%E5%88%86%E6%9E%90%E4%BB%8E%E6%94%BB%E5%87%BB%E5%88%B0%E9%98%B2%E5%BE%A1%E7%9A%84%E5%AE%8C%E6%95%B4%E6%8C%87%E5%8D%97/"},"publisher":{"@type":"Organization","name":"æŠ€æœ¯åšå®¢ - æœ‰æ¡å·¥å…·","logo":{"@type":"ImageObject","url":"/favicon.ico"}}}</script></head><body id=top><header class=header><nav class=nav><div class=logo><a href=/blog/ accesskey=h title="æŠ€æœ¯åšå®¢ - æœ‰æ¡å·¥å…· (Alt + H)">æŠ€æœ¯åšå®¢ - æœ‰æ¡å·¥å…·</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=/blog/posts/ title="æ‰€æœ‰æ–‡ç« åˆ—è¡¨ - æœ‰æ¡å·¥å…·æŠ€æœ¯åšå®¢ï¼šæŸ¥çœ‹æ‰€æœ‰æŠ€æœ¯æ–‡ç« å’Œæ•™ç¨‹å†…å®¹"><span>æ–‡ç« </span></a></li><li><a href=https://www.util.cn title="æœ‰æ¡å·¥å…· - å¼€å‘è€…çš„å¸¸ç”¨å·¥å…·é›†åˆï¼šæ— å¹¿å‘Š Â· æœ¬åœ°è®¡ç®— Â· å³å¼€å³ç”¨çš„åœ¨çº¿å·¥å…·å¹³å°ï¼Œæä¾›JSONæ ¼å¼åŒ–ã€SQLæ ¼å¼åŒ–ã€Markdownç¼–è¾‘å™¨ç­‰å®ç”¨å·¥å…·"><span>æœ‰æ¡å·¥å…·</span>&nbsp;
<svg fill="none" shape-rendering="geometricPrecision" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" height="12" width="12"><path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"/><path d="M15 3h6v6"/><path d="M10 14 21 3"/></svg></a></li><li><a href=/blog/categories/ title="æ–‡ç« åˆ†ç±» - æœ‰æ¡å·¥å…·æŠ€æœ¯åšå®¢ï¼šæŒ‰æŠ€æœ¯é¢†åŸŸåˆ†ç±»çš„ä¼˜è´¨æ–‡ç« ï¼ŒåŒ…æ‹¬å‰ç«¯å¼€å‘ã€å·¥å…·ä½¿ç”¨ã€ç¼–ç¨‹æŠ€å·§ç­‰"><span>åˆ†ç±»</span></a></li><li><a href=/blog/tags/ title="æ ‡ç­¾äº‘ - æœ‰æ¡å·¥å…·æŠ€æœ¯åšå®¢ï¼šé€šè¿‡æ ‡ç­¾å¿«é€Ÿæ‰¾åˆ°æ„Ÿå…´è¶£çš„æŠ€æœ¯æ–‡ç« å’Œæ•™ç¨‹å†…å®¹"><span>æ ‡ç­¾</span></a></li><li><a href=/blog/archives/ title="æ–‡ç« å½’æ¡£ - æœ‰æ¡å·¥å…·æŠ€æœ¯åšå®¢ï¼šæŒ‰æ—¶é—´æŸ¥çœ‹å†å²æ–‡ç« "><span>å½’æ¡£</span></a></li><li><a href=/blog/search/ title="æœç´¢æ–‡ç«  - æœ‰æ¡å·¥å…·æŠ€æœ¯åšå®¢ï¼šé€šè¿‡å…³é”®è¯æœç´¢æ‰¾åˆ°æ„Ÿå…´è¶£çš„æŠ€æœ¯æ–‡ç« å’Œæ•™ç¨‹å†…å®¹ï¼Œæ”¯æŒæ ‡é¢˜ã€å†…å®¹ã€åˆ†ç±»å’Œæ ‡ç­¾æœç´¢"><span>æœç´¢</span></a></li></ul></nav></header><main class=main><article class=post-single><div class=post-content-wrapper><main class=post-content-main><header class=post-header-main><h1 class="post-title entry-hint-parent">ç½‘ç»œå®‰å…¨ä¸æ¼æ´æ·±åº¦åˆ†æï¼šä»æ”»å‡»åˆ°é˜²å¾¡çš„å®Œæ•´æŒ‡å—</h1><div class=post-description>æ·±å…¥æ¢è®¨ç½‘ç»œå®‰å…¨é¢†åŸŸçš„æ ¸å¿ƒä¸»é¢˜ï¼Œæ¶µç›–OWASP Top 10ã€å¸¸è§Webæ¼æ´ã€æ¸—é€æµ‹è¯•æ–¹æ³•ã€å®‰å…¨ç¼–ç å®è·µç­‰ï¼Œå¸®åŠ©å¼€å‘è€…å’Œå®‰å…¨å·¥ç¨‹å¸ˆæ„å»ºæ›´å®‰å…¨çš„ç³»ç»Ÿã€‚</div><div class=post-meta><div class=post-meta-content><div class=post-categories-inline><a href=/blog/categories/%E5%AE%89%E5%85%A8/ class=category-link>å®‰å…¨</a><a href=/blog/categories/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/ class=category-link>ç½‘ç»œå®‰å…¨</a></div><span class=post-date>2025-12-30</span><span class=post-author>æœ‰æ¡å·¥å…·å›¢é˜Ÿ</span></div><style>.post-meta-content{display:flex;align-items:center;flex-wrap:wrap;gap:.75rem;font-family:sf mono,monaco,courier new,monospace;font-size:.875rem;color:#9ca3af !important}.post-categories-inline{display:inline-flex;align-items:center;gap:.5rem}.category-link{display:inline-flex;align-items:center;gap:.25rem;padding:.25rem .75rem;background:rgba(255,255,255,.1);color:#e5e7eb !important;text-decoration:none;font-size:.75rem;font-weight:600;text-transform:uppercase;letter-spacing:.05em;border:1px solid rgba(255,255,255,.2);border-radius:0;transition:all .3s ease;white-space:nowrap}.category-link:hover{background:rgba(255,255,255,.2);color:#fff !important;border-color:rgba(255,255,255,.3);transform:translateY(-1px)}.category-link::before{content:'ğŸ“';font-size:.7rem;opacity:.8}.post-date,.post-reading-time,.post-word-count,.post-author{color:#9ca3af !important}[data-theme=dark] .post-meta-content{color:#9ca3af !important}[data-theme=dark] .category-link{background:rgba(255,255,255,.1);color:#e5e7eb !important;border-color:rgba(255,255,255,.2)}[data-theme=dark] .category-link:hover{background:rgba(255,255,255,.2);color:#fff !important;border-color:rgba(255,255,255,.3)}[data-theme=dark] .post-date,[data-theme=dark] .post-reading-time,[data-theme=dark] .post-word-count,[data-theme=dark] .post-author{color:#9ca3af !important}[data-theme=light] .post-meta-content{color:#6c757d !important}[data-theme=light] .category-link{background:rgba(0,0,0,5%);color:#495057 !important;border-color:rgba(0,0,0,.15)}[data-theme=light] .category-link:hover{background:rgba(0,102,204,.1);color:#212529 !important;border-color:rgba(0,102,204,.3)}[data-theme=light] .post-date,[data-theme=light] .post-reading-time,[data-theme=light] .post-word-count,[data-theme=light] .post-author{color:#6c757d !important}@media(max-width:768px){.post-meta-content{gap:.5rem;font-size:.8rem}.category-link{padding:.2rem .6rem;font-size:.7rem}}</style></div></header><div class=post-content><h2 id=å¼•è¨€>å¼•è¨€<a hidden class=anchor aria-hidden=true href=#å¼•è¨€>#</a></h2><p>ç½‘ç»œå®‰å…¨æ˜¯æ•°å­—åŒ–æ—¶ä»£çš„æ ¸å¿ƒæŒ‘æˆ˜ã€‚éšç€æ”»å‡»æ‰‹æ®µçš„ä¸æ–­æ¼”è¿›ï¼Œäº†è§£å¸¸è§æ¼æ´ã€æ”»å‡»æ–¹æ³•å’Œé˜²å¾¡ç­–ç•¥å˜å¾—è‡³å…³é‡è¦ã€‚æœ¬æ–‡å°†æ·±å…¥åˆ†æç½‘ç»œå®‰å…¨é¢†åŸŸçš„æ ¸å¿ƒä¸»é¢˜ï¼Œå¸®åŠ©è¯»è€…æ„å»ºæ›´å®‰å…¨çš„ç³»ç»Ÿã€‚</p><h2 id=ä¸€owasp-top-10æ·±åº¦è§£æ>ä¸€ã€OWASP Top 10æ·±åº¦è§£æ<a hidden class=anchor aria-hidden=true href=#ä¸€owasp-top-10æ·±åº¦è§£æ>#</a></h2><h3 id=11-æ³¨å…¥æ¼æ´>1.1 æ³¨å…¥æ¼æ´<a hidden class=anchor aria-hidden=true href=#11-æ³¨å…¥æ¼æ´>#</a></h3><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 56
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 57
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 58
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 59
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 60
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 61
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 62
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 63
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 64
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 65
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 66
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 67
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 68
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 69
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 70
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 71
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 72
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 73
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 74
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 75
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 76
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 77
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 78
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 79
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 80
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 81
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 82
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 83
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 84
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 85
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 86
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 87
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 88
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 89
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 90
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 91
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 92
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 93
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 94
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 95
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 96
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 97
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 98
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 99
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">100
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">101
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">102
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">103
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">104
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">105
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">106
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">107
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">108
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">109
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">110
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">111
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">112
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">113
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">114
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">115
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">116
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">117
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">118
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">119
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">120
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">121
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">122
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">123
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">124
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">125
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">126
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">127
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">128
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">129
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">130
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">131
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">132
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">133
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">134
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#8b949e;font-style:italic># ========== SQLæ³¨å…¥ ==========</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic># ä¸å®‰å…¨çš„ä»£ç ç¤ºä¾‹</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>get_user_by_id</span>(user_id):
</span></span><span style=display:flex><span>    <span style=color:#a5d6ff>&#34;&#34;&#34;å±é™©ï¼šç›´æ¥æ‹¼æ¥SQL&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>    query <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#79c0ff>f</span><span style=color:#a5d6ff>&#34;SELECT * FROM users WHERE id = </span><span style=color:#a5d6ff>{</span>user_id<span style=color:#a5d6ff>}</span><span style=color:#a5d6ff>&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>return</span> db<span style=color:#ff7b72;font-weight:700>.</span>execute(query)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic># æ”»å‡»ç¤ºä¾‹</span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic># user_id = &#34;1 OR 1=1&#34;</span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic># å®é™…æ‰§è¡Œçš„SQL: SELECT * FROM users WHERE id = 1 OR 1=1</span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic># ç»“æœï¼šè¿”å›æ‰€æœ‰ç”¨æˆ·æ•°æ®</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic># å®‰å…¨çš„ä»£ç ç¤ºä¾‹</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>import</span> <span style=color:#ff7b72>sqlite3</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>from</span> <span style=color:#ff7b72>typing</span> <span style=color:#ff7b72>import</span> Optional
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>class</span> <span style=color:#f0883e;font-weight:700>UserRepository</span>:
</span></span><span style=display:flex><span>    <span style=color:#a5d6ff>&#34;&#34;&#34;å®‰å…¨çš„ç”¨æˆ·ä»“åº“&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>__init__</span>(self, db_path: str):
</span></span><span style=display:flex><span>        self<span style=color:#ff7b72;font-weight:700>.</span>conn <span style=color:#ff7b72;font-weight:700>=</span> sqlite3<span style=color:#ff7b72;font-weight:700>.</span>connect(db_path)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>get_user_by_id</span>(self, user_id: int) <span style=color:#ff7b72;font-weight:700>-&gt;</span> Optional[dict]:
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;&#34;&#34;ä½¿ç”¨å‚æ•°åŒ–æŸ¥è¯¢&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>        cursor <span style=color:#ff7b72;font-weight:700>=</span> self<span style=color:#ff7b72;font-weight:700>.</span>conn<span style=color:#ff7b72;font-weight:700>.</span>cursor()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># ä½¿ç”¨?å ä½ç¬¦ï¼Œæ•°æ®åº“é©±åŠ¨ä¼šæ­£ç¡®è½¬ä¹‰å‚æ•°</span>
</span></span><span style=display:flex><span>        query <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>&#34;SELECT * FROM users WHERE id = ?&#34;</span>
</span></span><span style=display:flex><span>        cursor<span style=color:#ff7b72;font-weight:700>.</span>execute(query, (user_id,))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        row <span style=color:#ff7b72;font-weight:700>=</span> cursor<span style=color:#ff7b72;font-weight:700>.</span>fetchone()
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>if</span> row:
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>return</span> {
</span></span><span style=display:flex><span>                <span style=color:#a5d6ff>&#39;id&#39;</span>: row[<span style=color:#a5d6ff>0</span>],
</span></span><span style=display:flex><span>                <span style=color:#a5d6ff>&#39;username&#39;</span>: row[<span style=color:#a5d6ff>1</span>],
</span></span><span style=display:flex><span>                <span style=color:#a5d6ff>&#39;email&#39;</span>: row[<span style=color:#a5d6ff>2</span>]
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>return</span> <span style=color:#79c0ff>None</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>search_users</span>(self, keyword: str) <span style=color:#ff7b72;font-weight:700>-&gt;</span> list:
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;&#34;&#34;å®‰å…¨çš„æœç´¢åŠŸèƒ½&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>        cursor <span style=color:#ff7b72;font-weight:700>=</span> self<span style=color:#ff7b72;font-weight:700>.</span>conn<span style=color:#ff7b72;font-weight:700>.</span>cursor()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        query <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>&#34;&#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>            SELECT id, username, email
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>            FROM users
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>            WHERE username LIKE ?
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>            OR email LIKE ?
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>        &#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># ä½¿ç”¨é€šé…ç¬¦è¿›è¡Œæ¨¡ç³Šæœç´¢</span>
</span></span><span style=display:flex><span>        pattern <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#79c0ff>f</span><span style=color:#a5d6ff>&#34;%</span><span style=color:#a5d6ff>{</span>keyword<span style=color:#a5d6ff>}</span><span style=color:#a5d6ff>%&#34;</span>
</span></span><span style=display:flex><span>        cursor<span style=color:#ff7b72;font-weight:700>.</span>execute(query, (pattern, pattern))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>return</span> cursor<span style=color:#ff7b72;font-weight:700>.</span>fetchall()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic># ========== SQLæ³¨å…¥æ£€æµ‹ä¸é˜²å¾¡ ==========</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>class</span> <span style=color:#f0883e;font-weight:700>SQLInjectionDetector</span>:
</span></span><span style=display:flex><span>    <span style=color:#a5d6ff>&#34;&#34;&#34;SQLæ³¨å…¥æ£€æµ‹å™¨&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8b949e;font-style:italic># å¸¸è§SQLæ³¨å…¥ç‰¹å¾</span>
</span></span><span style=display:flex><span>    INJECTION_PATTERNS <span style=color:#ff7b72;font-weight:700>=</span> [
</span></span><span style=display:flex><span>        <span style=color:#79c0ff>r</span><span style=color:#a5d6ff>&#34;(\%27)|(\&#39;)&#34;</span>,                    <span style=color:#8b949e;font-style:italic># å•å¼•å·</span>
</span></span><span style=display:flex><span>        <span style=color:#79c0ff>r</span><span style=color:#a5d6ff>&#34;(\-\-)|(#)&#34;</span>,                     <span style=color:#8b949e;font-style:italic># æ³¨é‡Šç¬¦</span>
</span></span><span style=display:flex><span>        <span style=color:#79c0ff>r</span><span style=color:#a5d6ff>&#34;(\bor\b|\band\b).*?=.*?&#34;</span>,        <span style=color:#8b949e;font-style:italic># é€»è¾‘è¿ç®—ç¬¦</span>
</span></span><span style=display:flex><span>        <span style=color:#79c0ff>r</span><span style=color:#a5d6ff>&#34;(\bunion\b.*\bselect\b)&#34;</span>,       <span style=color:#8b949e;font-style:italic># UNIONæŸ¥è¯¢</span>
</span></span><span style=display:flex><span>        <span style=color:#79c0ff>r</span><span style=color:#a5d6ff>&#34;(\bselect\b.*\bfrom\b)&#34;</span>,         <span style=color:#8b949e;font-style:italic># SELECTæŸ¥è¯¢</span>
</span></span><span style=display:flex><span>        <span style=color:#79c0ff>r</span><span style=color:#a5d6ff>&#34;(\bexec\b|\bexecute\b)&#34;</span>,         <span style=color:#8b949e;font-style:italic># æ‰§è¡Œå‘½ä»¤</span>
</span></span><span style=display:flex><span>        <span style=color:#79c0ff>r</span><span style=color:#a5d6ff>&#34;(;|\bxp_cmdshell\b)&#34;</span>,           <span style=color:#8b949e;font-style:italic># å‘½ä»¤åˆ†éš”ç¬¦å’Œå­˜å‚¨è¿‡ç¨‹</span>
</span></span><span style=display:flex><span>        <span style=color:#79c0ff>r</span><span style=color:#a5d6ff>&#34;(\bdrop\b|\bdelete\b|\btruncate\b)&#34;</span>, <span style=color:#8b949e;font-style:italic># å±é™©æ“ä½œ</span>
</span></span><span style=display:flex><span>    ]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#d2a8ff;font-weight:700>@classmethod</span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>detect_injection</span>(cls, input_string: str) <span style=color:#ff7b72;font-weight:700>-&gt;</span> bool:
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;&#34;&#34;æ£€æµ‹SQLæ³¨å…¥&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>import</span> <span style=color:#ff7b72>re</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>for</span> pattern <span style=color:#ff7b72;font-weight:700>in</span> cls<span style=color:#ff7b72;font-weight:700>.</span>INJECTION_PATTERNS:
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>if</span> re<span style=color:#ff7b72;font-weight:700>.</span>search(pattern, input_string, re<span style=color:#ff7b72;font-weight:700>.</span>IGNORECASE):
</span></span><span style=display:flex><span>                <span style=color:#ff7b72>return</span> <span style=color:#79c0ff>True</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>return</span> <span style=color:#79c0ff>False</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#d2a8ff;font-weight:700>@classmethod</span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>sanitize_input</span>(cls, input_string: str) <span style=color:#ff7b72;font-weight:700>-&gt;</span> str:
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;&#34;&#34;æ¸…ç†è¾“å…¥&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>import</span> <span style=color:#ff7b72>re</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># ç§»é™¤å±é™©å­—ç¬¦</span>
</span></span><span style=display:flex><span>        sanitized <span style=color:#ff7b72;font-weight:700>=</span> re<span style=color:#ff7b72;font-weight:700>.</span>sub(<span style=color:#79c0ff>r</span><span style=color:#a5d6ff>&#34;[\&#39;</span><span style=color:#79c0ff>\&#34;</span><span style=color:#a5d6ff>\;\-\-]&#34;</span>, <span style=color:#a5d6ff>&#34;&#34;</span>, input_string)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># é™åˆ¶é•¿åº¦</span>
</span></span><span style=display:flex><span>        max_length <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>100</span>
</span></span><span style=display:flex><span>        sanitized <span style=color:#ff7b72;font-weight:700>=</span> sanitized[:max_length]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>return</span> sanitized
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic># ========== ORMå®‰å…¨ä½¿ç”¨ ==========</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>from</span> <span style=color:#ff7b72>sqlalchemy</span> <span style=color:#ff7b72>import</span> create_engine, Column, Integer, String
</span></span><span style=display:flex><span><span style=color:#ff7b72>from</span> <span style=color:#ff7b72>sqlalchemy.ext.declarative</span> <span style=color:#ff7b72>import</span> declarative_base
</span></span><span style=display:flex><span><span style=color:#ff7b72>from</span> <span style=color:#ff7b72>sqlalchemy.orm</span> <span style=color:#ff7b72>import</span> sessionmaker
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Base <span style=color:#ff7b72;font-weight:700>=</span> declarative_base()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>class</span> <span style=color:#f0883e;font-weight:700>User</span>(Base):
</span></span><span style=display:flex><span>    <span style=color:#a5d6ff>&#34;&#34;&#34;ç”¨æˆ·æ¨¡å‹&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>    __tablename__ <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>&#39;users&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    id <span style=color:#ff7b72;font-weight:700>=</span> Column(Integer, primary_key<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#79c0ff>True</span>)
</span></span><span style=display:flex><span>    username <span style=color:#ff7b72;font-weight:700>=</span> Column(String(<span style=color:#a5d6ff>50</span>), nullable<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#79c0ff>False</span>)
</span></span><span style=display:flex><span>    email <span style=color:#ff7b72;font-weight:700>=</span> Column(String(<span style=color:#a5d6ff>100</span>), nullable<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#79c0ff>False</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>class</span> <span style=color:#f0883e;font-weight:700>SecureUserRepository</span>:
</span></span><span style=display:flex><span>    <span style=color:#a5d6ff>&#34;&#34;&#34;ä½¿ç”¨ORMçš„å®‰å…¨ä»“åº“&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>__init__</span>(self, database_url: str):
</span></span><span style=display:flex><span>        self<span style=color:#ff7b72;font-weight:700>.</span>engine <span style=color:#ff7b72;font-weight:700>=</span> create_engine(database_url)
</span></span><span style=display:flex><span>        Session <span style=color:#ff7b72;font-weight:700>=</span> sessionmaker(bind<span style=color:#ff7b72;font-weight:700>=</span>self<span style=color:#ff7b72;font-weight:700>.</span>engine)
</span></span><span style=display:flex><span>        self<span style=color:#ff7b72;font-weight:700>.</span>session <span style=color:#ff7b72;font-weight:700>=</span> Session()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>get_user_by_id</span>(self, user_id: int) <span style=color:#ff7b72;font-weight:700>-&gt;</span> Optional[User]:
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;&#34;&#34;ORMè‡ªåŠ¨å¤„ç†å‚æ•°åŒ–&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>return</span> self<span style=color:#ff7b72;font-weight:700>.</span>session<span style=color:#ff7b72;font-weight:700>.</span>query(User)<span style=color:#ff7b72;font-weight:700>.</span>filter(
</span></span><span style=display:flex><span>            User<span style=color:#ff7b72;font-weight:700>.</span>id <span style=color:#ff7b72;font-weight:700>==</span> user_id
</span></span><span style=display:flex><span>        )<span style=color:#ff7b72;font-weight:700>.</span>first()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>search_users</span>(self, keyword: str) <span style=color:#ff7b72;font-weight:700>-&gt;</span> list:
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;&#34;&#34;å®‰å…¨çš„æœç´¢&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>return</span> self<span style=color:#ff7b72;font-weight:700>.</span>session<span style=color:#ff7b72;font-weight:700>.</span>query(User)<span style=color:#ff7b72;font-weight:700>.</span>filter(
</span></span><span style=display:flex><span>            (User<span style=color:#ff7b72;font-weight:700>.</span>username<span style=color:#ff7b72;font-weight:700>.</span>like(<span style=color:#79c0ff>f</span><span style=color:#a5d6ff>&#34;%</span><span style=color:#a5d6ff>{</span>keyword<span style=color:#a5d6ff>}</span><span style=color:#a5d6ff>%&#34;</span>)) <span style=color:#ff7b72;font-weight:700>|</span>
</span></span><span style=display:flex><span>            (User<span style=color:#ff7b72;font-weight:700>.</span>email<span style=color:#ff7b72;font-weight:700>.</span>like(<span style=color:#79c0ff>f</span><span style=color:#a5d6ff>&#34;%</span><span style=color:#a5d6ff>{</span>keyword<span style=color:#a5d6ff>}</span><span style=color:#a5d6ff>%&#34;</span>))
</span></span><span style=display:flex><span>        )<span style=color:#ff7b72;font-weight:700>.</span>all()
</span></span></code></pre></td></tr></table></div></div><h3 id=12-è·¨ç«™è„šæœ¬æ”»å‡»xss>1.2 è·¨ç«™è„šæœ¬æ”»å‡»(XSS)<a hidden class=anchor aria-hidden=true href=#12-è·¨ç«™è„šæœ¬æ”»å‡»xss>#</a></h3><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 56
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 57
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 58
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 59
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 60
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 61
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 62
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 63
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 64
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 65
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 66
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 67
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 68
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 69
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 70
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 71
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 72
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 73
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 74
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 75
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 76
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 77
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 78
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 79
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 80
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 81
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 82
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 83
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 84
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 85
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 86
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 87
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 88
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 89
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 90
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 91
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 92
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 93
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 94
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 95
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 96
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 97
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 98
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 99
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">100
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">101
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">102
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">103
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">104
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">105
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">106
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">107
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">108
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">109
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">110
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">111
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">112
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">113
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">114
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">115
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">116
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">117
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">118
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">119
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">120
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">121
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">122
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">123
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">124
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">125
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">126
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">127
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">128
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">129
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">130
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">131
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">132
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">133
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">134
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">135
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">136
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">137
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">138
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">139
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">140
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">141
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">142
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">143
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">144
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">145
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">146
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">147
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">148
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">149
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">150
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">151
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">152
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">153
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">154
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">155
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">156
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">157
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">158
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">159
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">160
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">161
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">162
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">163
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">164
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">165
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">166
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">167
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">168
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#8b949e;font-style:italic># ========== XSSæ”»å‡»ç±»å‹ ==========</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a5d6ff>&#34;&#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>1. åå°„å‹XSS (Reflected XSS)
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>   - æ¶æ„ä»£ç é€šè¿‡URLå‚æ•°åå°„
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>   - ä¾‹å¦‚: http://example.com/search?q=&lt;script&gt;alert(&#39;XSS&#39;)&lt;/script&gt;
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>2. å­˜å‚¨å‹XSS (Stored XSS)
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>   - æ¶æ„ä»£ç å­˜å‚¨åœ¨æœåŠ¡å™¨ï¼Œæ¯æ¬¡è®¿é—®æ—¶æ‰§è¡Œ
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>   - ä¾‹å¦‚: è¯„è®ºã€ç”¨æˆ·èµ„æ–™ç­‰å¯å­˜å‚¨çš„å†…å®¹
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>3. DOMå‹XSS (DOM-based XSS)
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>   - æ¶æ„ä»£ç é€šè¿‡DOMæ“ä½œæ‰§è¡Œ
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>   - ä¾‹å¦‚: #&lt;img src=x onerror=alert(&#39;XSS&#39;)&gt;
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic># ========== XSSé˜²å¾¡ ==========</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>import</span> <span style=color:#ff7b72>html</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>import</span> <span style=color:#ff7b72>re</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>from</span> <span style=color:#ff7b72>typing</span> <span style=color:#ff7b72>import</span> Dict, Any
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>class</span> <span style=color:#f0883e;font-weight:700>XSSProtection</span>:
</span></span><span style=display:flex><span>    <span style=color:#a5d6ff>&#34;&#34;&#34;XSSé˜²æŠ¤&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#d2a8ff;font-weight:700>@staticmethod</span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>escape_html</span>(text: str) <span style=color:#ff7b72;font-weight:700>-&gt;</span> str:
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;&#34;&#34;HTMLè½¬ä¹‰&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>return</span> html<span style=color:#ff7b72;font-weight:700>.</span>escape(text, quote<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#79c0ff>True</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#d2a8ff;font-weight:700>@staticmethod</span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>escape_js</span>(text: str) <span style=color:#ff7b72;font-weight:700>-&gt;</span> str:
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;&#34;&#34;JavaScriptå­—ç¬¦ä¸²è½¬ä¹‰&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>        escape_map <span style=color:#ff7b72;font-weight:700>=</span> {
</span></span><span style=display:flex><span>            <span style=color:#a5d6ff>&#39;</span><span style=color:#79c0ff>\\</span><span style=color:#a5d6ff>&#39;</span>: <span style=color:#a5d6ff>&#39;</span><span style=color:#79c0ff>\\\\</span><span style=color:#a5d6ff>&#39;</span>,
</span></span><span style=display:flex><span>            <span style=color:#a5d6ff>&#39;&#34;&#39;</span>: <span style=color:#a5d6ff>&#39;</span><span style=color:#79c0ff>\\</span><span style=color:#a5d6ff>&#34;&#39;</span>,
</span></span><span style=display:flex><span>            <span style=color:#a5d6ff>&#34;&#39;&#34;</span>: <span style=color:#a5d6ff>&#34;</span><span style=color:#79c0ff>\\</span><span style=color:#a5d6ff>&#39;&#34;</span>,
</span></span><span style=display:flex><span>            <span style=color:#a5d6ff>&#39;</span><span style=color:#79c0ff>\n</span><span style=color:#a5d6ff>&#39;</span>: <span style=color:#a5d6ff>&#39;</span><span style=color:#79c0ff>\\</span><span style=color:#a5d6ff>n&#39;</span>,
</span></span><span style=display:flex><span>            <span style=color:#a5d6ff>&#39;</span><span style=color:#79c0ff>\r</span><span style=color:#a5d6ff>&#39;</span>: <span style=color:#a5d6ff>&#39;</span><span style=color:#79c0ff>\\</span><span style=color:#a5d6ff>r&#39;</span>,
</span></span><span style=display:flex><span>            <span style=color:#a5d6ff>&#39;</span><span style=color:#79c0ff>\t</span><span style=color:#a5d6ff>&#39;</span>: <span style=color:#a5d6ff>&#39;</span><span style=color:#79c0ff>\\</span><span style=color:#a5d6ff>t&#39;</span>,
</span></span><span style=display:flex><span>            <span style=color:#a5d6ff>&#39;</span><span style=color:#79c0ff>\b</span><span style=color:#a5d6ff>&#39;</span>: <span style=color:#a5d6ff>&#39;</span><span style=color:#79c0ff>\\</span><span style=color:#a5d6ff>b&#39;</span>,
</span></span><span style=display:flex><span>            <span style=color:#a5d6ff>&#39;</span><span style=color:#79c0ff>\f</span><span style=color:#a5d6ff>&#39;</span>: <span style=color:#a5d6ff>&#39;</span><span style=color:#79c0ff>\\</span><span style=color:#a5d6ff>f&#39;</span>,
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>for</span> char, escaped <span style=color:#ff7b72;font-weight:700>in</span> escape_map<span style=color:#ff7b72;font-weight:700>.</span>items():
</span></span><span style=display:flex><span>            text <span style=color:#ff7b72;font-weight:700>=</span> text<span style=color:#ff7b72;font-weight:700>.</span>replace(char, escaped)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>return</span> text
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#d2a8ff;font-weight:700>@staticmethod</span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>sanitize_html</span>(content: str, allowed_tags: list <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#79c0ff>None</span>) <span style=color:#ff7b72;font-weight:700>-&gt;</span> str:
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;&#34;&#34;HTMLå‡€åŒ–ï¼Œåªå…è®¸å®‰å…¨çš„æ ‡ç­¾&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>if</span> allowed_tags <span style=color:#ff7b72;font-weight:700>is</span> <span style=color:#79c0ff>None</span>:
</span></span><span style=display:flex><span>            allowed_tags <span style=color:#ff7b72;font-weight:700>=</span> [<span style=color:#a5d6ff>&#39;p&#39;</span>, <span style=color:#a5d6ff>&#39;br&#39;</span>, <span style=color:#a5d6ff>&#39;strong&#39;</span>, <span style=color:#a5d6ff>&#39;em&#39;</span>, <span style=color:#a5d6ff>&#39;u&#39;</span>, <span style=color:#a5d6ff>&#39;a&#39;</span>]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>import</span> <span style=color:#ff7b72>bleach</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>return</span> bleach<span style=color:#ff7b72;font-weight:700>.</span>clean(
</span></span><span style=display:flex><span>            content,
</span></span><span style=display:flex><span>            tags<span style=color:#ff7b72;font-weight:700>=</span>allowed_tags,
</span></span><span style=display:flex><span>            attributes<span style=color:#ff7b72;font-weight:700>=</span>{
</span></span><span style=display:flex><span>                <span style=color:#a5d6ff>&#39;a&#39;</span>: [<span style=color:#a5d6ff>&#39;href&#39;</span>, <span style=color:#a5d6ff>&#39;title&#39;</span>],
</span></span><span style=display:flex><span>                <span style=color:#a5d6ff>&#39;*&#39;</span>: [<span style=color:#a5d6ff>&#39;class&#39;</span>]
</span></span><span style=display:flex><span>            },
</span></span><span style=display:flex><span>            strip<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#79c0ff>True</span>
</span></span><span style=display:flex><span>        )
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#d2a8ff;font-weight:700>@staticmethod</span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>validate_url</span>(url: str) <span style=color:#ff7b72;font-weight:700>-&gt;</span> bool:
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;&#34;&#34;éªŒè¯URLå®‰å…¨æ€§&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>import</span> <span style=color:#ff7b72>urllib.parse</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>try</span>:
</span></span><span style=display:flex><span>            parsed <span style=color:#ff7b72;font-weight:700>=</span> urllib<span style=color:#ff7b72;font-weight:700>.</span>parse<span style=color:#ff7b72;font-weight:700>.</span>urlparse(url)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#8b949e;font-style:italic># æ£€æŸ¥åè®®</span>
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>if</span> parsed<span style=color:#ff7b72;font-weight:700>.</span>scheme <span style=color:#ff7b72;font-weight:700>not</span> <span style=color:#ff7b72;font-weight:700>in</span> [<span style=color:#a5d6ff>&#39;http&#39;</span>, <span style=color:#a5d6ff>&#39;https&#39;</span>]:
</span></span><span style=display:flex><span>                <span style=color:#ff7b72>return</span> <span style=color:#79c0ff>False</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#8b949e;font-style:italic># æ£€æŸ¥æ˜¯å¦ä¸ºJavaScriptä¼ªåè®®</span>
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>if</span> parsed<span style=color:#ff7b72;font-weight:700>.</span>scheme<span style=color:#ff7b72;font-weight:700>.</span>lower() <span style=color:#ff7b72;font-weight:700>==</span> <span style=color:#a5d6ff>&#39;javascript&#39;</span>:
</span></span><span style=display:flex><span>                <span style=color:#ff7b72>return</span> <span style=color:#79c0ff>False</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>return</span> <span style=color:#79c0ff>True</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>except</span> <span style=color:#f0883e;font-weight:700>Exception</span>:
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>return</span> <span style=color:#79c0ff>False</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic># Webæ¡†æ¶é›†æˆç¤ºä¾‹</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>from</span> <span style=color:#ff7b72>flask</span> <span style=color:#ff7b72>import</span> Flask, request, render_template_string
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>app <span style=color:#ff7b72;font-weight:700>=</span> Flask(<span style=color:#79c0ff>__name__</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic># ä¸å®‰å…¨çš„ç¤ºä¾‹</span>
</span></span><span style=display:flex><span><span style=color:#d2a8ff;font-weight:700>@app.route</span>(<span style=color:#a5d6ff>&#39;/unsafe&#39;</span>)
</span></span><span style=display:flex><span><span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>unsafe_search</span>():
</span></span><span style=display:flex><span>    query <span style=color:#ff7b72;font-weight:700>=</span> request<span style=color:#ff7b72;font-weight:700>.</span>args<span style=color:#ff7b72;font-weight:700>.</span>get(<span style=color:#a5d6ff>&#39;q&#39;</span>, <span style=color:#a5d6ff>&#39;&#39;</span>)
</span></span><span style=display:flex><span>    <span style=color:#8b949e;font-style:italic># å±é™©ï¼šç›´æ¥æ¸²æŸ“ç”¨æˆ·è¾“å…¥</span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>return</span> render_template_string(<span style=color:#79c0ff>f</span><span style=color:#a5d6ff>&#39;&lt;p&gt;æœç´¢ç»“æœ: </span><span style=color:#a5d6ff>{</span>query<span style=color:#a5d6ff>}</span><span style=color:#a5d6ff>&lt;/p&gt;&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic># å®‰å…¨çš„ç¤ºä¾‹</span>
</span></span><span style=display:flex><span><span style=color:#d2a8ff;font-weight:700>@app.route</span>(<span style=color:#a5d6ff>&#39;/safe&#39;</span>)
</span></span><span style=display:flex><span><span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>safe_search</span>():
</span></span><span style=display:flex><span>    query <span style=color:#ff7b72;font-weight:700>=</span> request<span style=color:#ff7b72;font-weight:700>.</span>args<span style=color:#ff7b72;font-weight:700>.</span>get(<span style=color:#a5d6ff>&#39;q&#39;</span>, <span style=color:#a5d6ff>&#39;&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8b949e;font-style:italic># è½¬ä¹‰ç”¨æˆ·è¾“å…¥</span>
</span></span><span style=display:flex><span>    safe_query <span style=color:#ff7b72;font-weight:700>=</span> XSSProtection<span style=color:#ff7b72;font-weight:700>.</span>escape_html(query)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8b949e;font-style:italic># æˆ–ä½¿ç”¨æ¨¡æ¿å¼•æ“çš„è‡ªåŠ¨è½¬ä¹‰</span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>return</span> render_template_string(
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#39;&lt;p&gt;æœç´¢ç»“æœ: {{ query }}&lt;/p&gt;&#39;</span>,
</span></span><span style=display:flex><span>        query<span style=color:#ff7b72;font-weight:700>=</span>safe_query
</span></span><span style=display:flex><span>    )
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic># Content Security Policy (CSP)</span>
</span></span><span style=display:flex><span><span style=color:#d2a8ff;font-weight:700>@app.after_request</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>add_security_headers</span>(response):
</span></span><span style=display:flex><span>    <span style=color:#a5d6ff>&#34;&#34;&#34;æ·»åŠ å®‰å…¨å¤´&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>    csp <span style=color:#ff7b72;font-weight:700>=</span> (
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;default-src &#39;self&#39;; &#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;script-src &#39;self&#39; &#39;unsafe-inline&#39; https://cdn.example.com; &#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;style-src &#39;self&#39; &#39;unsafe-inline&#39;; &#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;img-src &#39;self&#39; data: https:; &#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;font-src &#39;self&#39; data:; &#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;connect-src &#39;self&#39;; &#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;frame-ancestors &#39;none&#39;;&#34;</span>
</span></span><span style=display:flex><span>    )
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    response<span style=color:#ff7b72;font-weight:700>.</span>headers[<span style=color:#a5d6ff>&#39;Content-Security-Policy&#39;</span>] <span style=color:#ff7b72;font-weight:700>=</span> csp
</span></span><span style=display:flex><span>    response<span style=color:#ff7b72;font-weight:700>.</span>headers[<span style=color:#a5d6ff>&#39;X-Content-Type-Options&#39;</span>] <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>&#39;nosniff&#39;</span>
</span></span><span style=display:flex><span>    response<span style=color:#ff7b72;font-weight:700>.</span>headers[<span style=color:#a5d6ff>&#39;X-Frame-Options&#39;</span>] <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>&#39;DENY&#39;</span>
</span></span><span style=display:flex><span>    response<span style=color:#ff7b72;font-weight:700>.</span>headers[<span style=color:#a5d6ff>&#39;X-XSS-Protection&#39;</span>] <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>&#39;1; mode=block&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>return</span> response
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic># ========== è¾“å…¥éªŒè¯ ==========</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>class</span> <span style=color:#f0883e;font-weight:700>InputValidator</span>:
</span></span><span style=display:flex><span>    <span style=color:#a5d6ff>&#34;&#34;&#34;è¾“å…¥éªŒè¯å™¨&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#d2a8ff;font-weight:700>@staticmethod</span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>validate_username</span>(username: str) <span style=color:#ff7b72;font-weight:700>-&gt;</span> bool:
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;&#34;&#34;éªŒè¯ç”¨æˆ·å&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># é•¿åº¦æ£€æŸ¥</span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>if</span> len(username) <span style=color:#ff7b72;font-weight:700>&lt;</span> <span style=color:#a5d6ff>3</span> <span style=color:#ff7b72;font-weight:700>or</span> len(username) <span style=color:#ff7b72;font-weight:700>&gt;</span> <span style=color:#a5d6ff>20</span>:
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>return</span> <span style=color:#79c0ff>False</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># å­—ç¬¦æ£€æŸ¥ï¼šåªå…è®¸å­—æ¯ã€æ•°å­—ã€ä¸‹åˆ’çº¿</span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>import</span> <span style=color:#ff7b72>re</span>
</span></span><span style=display:flex><span>        pattern <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#79c0ff>r</span><span style=color:#a5d6ff>&#39;^[a-zA-Z0-9_]+$&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>return</span> bool(re<span style=color:#ff7b72;font-weight:700>.</span><span style=color:#ff7b72>match</span>(pattern, username))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#d2a8ff;font-weight:700>@staticmethod</span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>validate_email</span>(email: str) <span style=color:#ff7b72;font-weight:700>-&gt;</span> bool:
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;&#34;&#34;éªŒè¯é‚®ç®±&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>import</span> <span style=color:#ff7b72>re</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        pattern <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#79c0ff>r</span><span style=color:#a5d6ff>&#39;^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$&#39;</span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>return</span> bool(re<span style=color:#ff7b72;font-weight:700>.</span><span style=color:#ff7b72>match</span>(pattern, email))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#d2a8ff;font-weight:700>@staticmethod</span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>validate_phone</span>(phone: str) <span style=color:#ff7b72;font-weight:700>-&gt;</span> bool:
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;&#34;&#34;éªŒè¯æ‰‹æœºå·&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>import</span> <span style=color:#ff7b72>re</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        pattern <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#79c0ff>r</span><span style=color:#a5d6ff>&#39;^1[3-9]\d</span><span style=color:#a5d6ff>{9}</span><span style=color:#a5d6ff>$&#39;</span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>return</span> bool(re<span style=color:#ff7b72;font-weight:700>.</span><span style=color:#ff7b72>match</span>(pattern, phone))
</span></span></code></pre></td></tr></table></div></div><h3 id=13-csrfé˜²æŠ¤>1.3 CSRFé˜²æŠ¤<a hidden class=anchor aria-hidden=true href=#13-csrfé˜²æŠ¤>#</a></h3><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 56
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 57
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 58
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 59
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 60
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 61
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 62
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 63
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 64
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 65
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 66
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 67
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 68
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 69
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 70
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 71
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 72
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 73
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 74
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 75
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 76
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 77
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 78
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 79
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 80
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 81
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 82
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 83
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 84
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 85
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 86
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 87
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 88
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 89
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 90
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 91
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 92
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 93
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 94
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 95
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 96
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 97
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 98
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 99
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">100
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">101
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">102
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">103
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">104
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">105
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">106
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">107
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">108
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">109
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">110
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">111
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">112
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">113
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">114
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">115
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">116
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">117
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">118
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">119
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">120
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">121
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">122
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">123
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">124
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">125
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">126
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">127
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">128
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">129
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">130
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">131
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">132
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">133
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#8b949e;font-style:italic># ========== CSRFæ”»å‡»åŸç† ==========</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a5d6ff>&#34;&#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>CSRF (Cross-Site Request Forgery) è·¨ç«™è¯·æ±‚ä¼ªé€ 
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>æ”»å‡»åœºæ™¯ï¼š
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>1. ç”¨æˆ·ç™»å½•äº†é“¶è¡Œç½‘ç«™ bank.com
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>2. ç”¨æˆ·è®¿é—®äº†æ¶æ„ç½‘ç«™ evil.com
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>3. evil.com åŒ…å«æŒ‡å‘ bank.com çš„è¯·æ±‚
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>   &lt;img src=&#34;http://bank.com/transfer?to=attacker&amp;amount=10000&#34;&gt;
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>4. æµè§ˆå™¨è‡ªåŠ¨æºå¸¦ bank.com çš„ cookie
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>5. é“¶è¡Œç½‘ç«™å¤„ç†è½¬è´¦è¯·æ±‚
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>é˜²å¾¡æªæ–½ï¼š
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>1. CSRF Token
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>2. SameSite Cookieå±æ€§
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>3. éªŒè¯Referer/Originå¤´
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>4. åŒé‡æäº¤Cookie
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic># ========== CSRFé˜²æŠ¤å®ç° ==========</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>import</span> <span style=color:#ff7b72>secrets</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>from</span> <span style=color:#ff7b72>flask</span> <span style=color:#ff7b72>import</span> Flask, request, session, render_template
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>app <span style=color:#ff7b72;font-weight:700>=</span> Flask(<span style=color:#79c0ff>__name__</span>)
</span></span><span style=display:flex><span>app<span style=color:#ff7b72;font-weight:700>.</span>secret_key <span style=color:#ff7b72;font-weight:700>=</span> secrets<span style=color:#ff7b72;font-weight:700>.</span>token_hex(<span style=color:#a5d6ff>32</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>class</span> <span style=color:#f0883e;font-weight:700>CSRFProtection</span>:
</span></span><span style=display:flex><span>    <span style=color:#a5d6ff>&#34;&#34;&#34;CSRFé˜²æŠ¤&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#d2a8ff;font-weight:700>@staticmethod</span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>generate_token</span>() <span style=color:#ff7b72;font-weight:700>-&gt;</span> str:
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;&#34;&#34;ç”ŸæˆCSRF Token&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>return</span> secrets<span style=color:#ff7b72;font-weight:700>.</span>token_hex(<span style=color:#a5d6ff>32</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#d2a8ff;font-weight:700>@staticmethod</span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>validate_token</span>(token: str, stored_token: str) <span style=color:#ff7b72;font-weight:700>-&gt;</span> bool:
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;&#34;&#34;éªŒè¯Token&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>return</span> secrets<span style=color:#ff7b72;font-weight:700>.</span>compare_digest(token, stored_token)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic># åœ¨Flaskä¸­ä½¿ç”¨CSRFä¿æŠ¤</span>
</span></span><span style=display:flex><span><span style=color:#d2a8ff;font-weight:700>@app.before_request</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>csrf_protect</span>():
</span></span><span style=display:flex><span>    <span style=color:#a5d6ff>&#34;&#34;&#34;CSRFä¿æŠ¤ä¸­é—´ä»¶&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8b949e;font-style:italic># è±å…å®‰å…¨çš„æ–¹æ³•</span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>if</span> request<span style=color:#ff7b72;font-weight:700>.</span>method <span style=color:#ff7b72;font-weight:700>in</span> [<span style=color:#a5d6ff>&#39;GET&#39;</span>, <span style=color:#a5d6ff>&#39;HEAD&#39;</span>, <span style=color:#a5d6ff>&#39;OPTIONS&#39;</span>, <span style=color:#a5d6ff>&#39;TRACE&#39;</span>]:
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>return</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8b949e;font-style:italic># æ£€æŸ¥CSRF Token</span>
</span></span><span style=display:flex><span>    token <span style=color:#ff7b72;font-weight:700>=</span> request<span style=color:#ff7b72;font-weight:700>.</span>headers<span style=color:#ff7b72;font-weight:700>.</span>get(<span style=color:#a5d6ff>&#39;X-CSRF-Token&#39;</span>) <span style=color:#ff7b72;font-weight:700>or</span> request<span style=color:#ff7b72;font-weight:700>.</span>form<span style=color:#ff7b72;font-weight:700>.</span>get(<span style=color:#a5d6ff>&#39;csrf_token&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>if</span> <span style=color:#ff7b72;font-weight:700>not</span> token <span style=color:#ff7b72;font-weight:700>or</span> token <span style=color:#ff7b72;font-weight:700>!=</span> session<span style=color:#ff7b72;font-weight:700>.</span>get(<span style=color:#a5d6ff>&#39;csrf_token&#39;</span>):
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>return</span> <span style=color:#a5d6ff>&#39;Invalid CSRF token&#39;</span>, <span style=color:#a5d6ff>403</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#d2a8ff;font-weight:700>@app.route</span>(<span style=color:#a5d6ff>&#39;/form&#39;</span>)
</span></span><span style=display:flex><span><span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>show_form</span>():
</span></span><span style=display:flex><span>    <span style=color:#a5d6ff>&#34;&#34;&#34;æ˜¾ç¤ºè¡¨å•&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#8b949e;font-style:italic># ç”Ÿæˆå¹¶å­˜å‚¨CSRF Token</span>
</span></span><span style=display:flex><span>    csrf_token <span style=color:#ff7b72;font-weight:700>=</span> CSRFProtection<span style=color:#ff7b72;font-weight:700>.</span>generate_token()
</span></span><span style=display:flex><span>    session[<span style=color:#a5d6ff>&#39;csrf_token&#39;</span>] <span style=color:#ff7b72;font-weight:700>=</span> csrf_token
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>return</span> <span style=color:#79c0ff>f</span><span style=color:#a5d6ff>&#39;&#39;&#39;
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>        &lt;form method=&#34;POST&#34; action=&#34;/submit&#34;&gt;
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>            &lt;input type=&#34;hidden&#34; name=&#34;csrf_token&#34; value=&#34;</span><span style=color:#a5d6ff>{</span>csrf_token<span style=color:#a5d6ff>}</span><span style=color:#a5d6ff>&#34;&gt;
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>            &lt;input type=&#34;text&#34; name=&#34;username&#34;&gt;
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>            &lt;button type=&#34;submit&#34;&gt;æäº¤&lt;/button&gt;
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>        &lt;/form&gt;
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>    &#39;&#39;&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#d2a8ff;font-weight:700>@app.route</span>(<span style=color:#a5d6ff>&#39;/submit&#39;</span>, methods<span style=color:#ff7b72;font-weight:700>=</span>[<span style=color:#a5d6ff>&#39;POST&#39;</span>])
</span></span><span style=display:flex><span><span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>handle_submit</span>():
</span></span><span style=display:flex><span>    <span style=color:#a5d6ff>&#34;&#34;&#34;å¤„ç†è¡¨å•æäº¤&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8b949e;font-style:italic># Tokenå·²åœ¨ä¸­é—´ä»¶éªŒè¯</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    username <span style=color:#ff7b72;font-weight:700>=</span> request<span style=color:#ff7b72;font-weight:700>.</span>form<span style=color:#ff7b72;font-weight:700>.</span>get(<span style=color:#a5d6ff>&#39;username&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8b949e;font-style:italic># ä¸šåŠ¡é€»è¾‘</span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>return</span> <span style=color:#79c0ff>f</span><span style=color:#a5d6ff>&#39;Hello, </span><span style=color:#a5d6ff>{</span>username<span style=color:#a5d6ff>}</span><span style=color:#a5d6ff>!&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic># ========== SameSite Cookie ==========</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#d2a8ff;font-weight:700>@app.route</span>(<span style=color:#a5d6ff>&#39;/login&#39;</span>, methods<span style=color:#ff7b72;font-weight:700>=</span>[<span style=color:#a5d6ff>&#39;POST&#39;</span>])
</span></span><span style=display:flex><span><span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>login</span>():
</span></span><span style=display:flex><span>    <span style=color:#a5d6ff>&#34;&#34;&#34;ç™»å½•&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8b949e;font-style:italic># è®¾ç½®SameSiteå±æ€§</span>
</span></span><span style=display:flex><span>    response <span style=color:#ff7b72;font-weight:700>=</span> app<span style=color:#ff7b72;font-weight:700>.</span>make_response(<span style=color:#a5d6ff>&#39;Login successful&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8b949e;font-style:italic># Strict: ä¸¥æ ¼æ¨¡å¼ï¼Œåªåœ¨åŒç«™ç‚¹è¯·æ±‚ä¸­å‘é€</span>
</span></span><span style=display:flex><span>    response<span style=color:#ff7b72;font-weight:700>.</span>set_cookie(
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#39;session_id&#39;</span>,
</span></span><span style=display:flex><span>        value<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>&#39;session_data&#39;</span>,
</span></span><span style=display:flex><span>        httponly<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#79c0ff>True</span>,
</span></span><span style=display:flex><span>        secure<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#79c0ff>True</span>,
</span></span><span style=display:flex><span>        samesite<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>&#39;Strict&#39;</span>
</span></span><span style=display:flex><span>    )
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>return</span> response
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic># ========== åŒé‡CookieéªŒè¯ ==========</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>class</span> <span style=color:#f0883e;font-weight:700>DoubleSubmitCookie</span>:
</span></span><span style=display:flex><span>    <span style=color:#a5d6ff>&#34;&#34;&#34;åŒé‡Cookie CSRFé˜²æŠ¤&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#d2a8ff;font-weight:700>@staticmethod</span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>generate_token</span>():
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;&#34;&#34;ç”ŸæˆTokenå¹¶è®¾ç½®åˆ°Cookie&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>        token <span style=color:#ff7b72;font-weight:700>=</span> secrets<span style=color:#ff7b72;font-weight:700>.</span>token_hex(<span style=color:#a5d6ff>32</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#d2a8ff;font-weight:700>@app.after_this_request</span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>add_cookie</span>(response):
</span></span><span style=display:flex><span>            response<span style=color:#ff7b72;font-weight:700>.</span>set_cookie(
</span></span><span style=display:flex><span>                <span style=color:#a5d6ff>&#39;csrf_token&#39;</span>,
</span></span><span style=display:flex><span>                token,
</span></span><span style=display:flex><span>                httponly<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#79c0ff>True</span>,
</span></span><span style=display:flex><span>                secure<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#79c0ff>True</span>,
</span></span><span style=display:flex><span>                samesite<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>&#39;Strict&#39;</span>
</span></span><span style=display:flex><span>            )
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>return</span> response
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>return</span> token
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#d2a8ff;font-weight:700>@staticmethod</span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>validate</span>(request):
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;&#34;&#34;éªŒè¯Token&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>        cookie_token <span style=color:#ff7b72;font-weight:700>=</span> request<span style=color:#ff7b72;font-weight:700>.</span>cookies<span style=color:#ff7b72;font-weight:700>.</span>get(<span style=color:#a5d6ff>&#39;csrf_token&#39;</span>)
</span></span><span style=display:flex><span>        request_token <span style=color:#ff7b72;font-weight:700>=</span> request<span style=color:#ff7b72;font-weight:700>.</span>form<span style=color:#ff7b72;font-weight:700>.</span>get(<span style=color:#a5d6ff>&#39;csrf_token&#39;</span>) <span style=color:#ff7b72;font-weight:700>or</span> \
</span></span><span style=display:flex><span>                       request<span style=color:#ff7b72;font-weight:700>.</span>headers<span style=color:#ff7b72;font-weight:700>.</span>get(<span style=color:#a5d6ff>&#39;X-CSRF-Token&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>return</span> secrets<span style=color:#ff7b72;font-weight:700>.</span>compare_digest(cookie_token, request_token)
</span></span></code></pre></td></tr></table></div></div><h2 id=äºŒå…¶ä»–å¸¸è§webæ¼æ´>äºŒã€å…¶ä»–å¸¸è§Webæ¼æ´<a hidden class=anchor aria-hidden=true href=#äºŒå…¶ä»–å¸¸è§webæ¼æ´>#</a></h2><h3 id=21-æ–‡ä»¶ä¸Šä¼ æ¼æ´>2.1 æ–‡ä»¶ä¸Šä¼ æ¼æ´<a hidden class=anchor aria-hidden=true href=#21-æ–‡ä»¶ä¸Šä¼ æ¼æ´>#</a></h3><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 56
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 57
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 58
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 59
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 60
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 61
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 62
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 63
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 64
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 65
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 66
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 67
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 68
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 69
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 70
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 71
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 72
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 73
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 74
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 75
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 76
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 77
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 78
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 79
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 80
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 81
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 82
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 83
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 84
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 85
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 86
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 87
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 88
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 89
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 90
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 91
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 92
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 93
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 94
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 95
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 96
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 97
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 98
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 99
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">100
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">101
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">102
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">103
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">104
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">105
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">106
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">107
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">108
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">109
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">110
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">111
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">112
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">113
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">114
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">115
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">116
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">117
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">118
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">119
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">120
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">121
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">122
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">123
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">124
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">125
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">126
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">127
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">128
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">129
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">130
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">131
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">132
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">133
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#8b949e;font-style:italic># ========== æ–‡ä»¶ä¸Šä¼ å®‰å…¨ ==========</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>import</span> <span style=color:#ff7b72>os</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>import</span> <span style=color:#ff7b72>magic</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>from</span> <span style=color:#ff7b72>werkzeug.utils</span> <span style=color:#ff7b72>import</span> secure_filename
</span></span><span style=display:flex><span><span style=color:#ff7b72>from</span> <span style=color:#ff7b72>typing</span> <span style=color:#ff7b72>import</span> Tuple
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>class</span> <span style=color:#f0883e;font-weight:700>SecureFileUpload</span>:
</span></span><span style=display:flex><span>    <span style=color:#a5d6ff>&#34;&#34;&#34;å®‰å…¨çš„æ–‡ä»¶ä¸Šä¼ &#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8b949e;font-style:italic># å…è®¸çš„æ–‡ä»¶ç±»å‹</span>
</span></span><span style=display:flex><span>    ALLOWED_EXTENSIONS <span style=color:#ff7b72;font-weight:700>=</span> {
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#39;image&#39;</span>: {<span style=color:#a5d6ff>&#39;jpg&#39;</span>, <span style=color:#a5d6ff>&#39;jpeg&#39;</span>, <span style=color:#a5d6ff>&#39;png&#39;</span>, <span style=color:#a5d6ff>&#39;gif&#39;</span>, <span style=color:#a5d6ff>&#39;webp&#39;</span>},
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#39;document&#39;</span>: {<span style=color:#a5d6ff>&#39;pdf&#39;</span>, <span style=color:#a5d6ff>&#39;doc&#39;</span>, <span style=color:#a5d6ff>&#39;docx&#39;</span>, <span style=color:#a5d6ff>&#39;txt&#39;</span>},
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#39;media&#39;</span>: {<span style=color:#a5d6ff>&#39;mp4&#39;</span>, <span style=color:#a5d6ff>&#39;mp3&#39;</span>, <span style=color:#a5d6ff>&#39;wav&#39;</span>}
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8b949e;font-style:italic># å…è®¸çš„MIMEç±»å‹</span>
</span></span><span style=display:flex><span>    ALLOWED_MIME_TYPES <span style=color:#ff7b72;font-weight:700>=</span> {
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#39;image/jpeg&#39;</span>, <span style=color:#a5d6ff>&#39;image/png&#39;</span>, <span style=color:#a5d6ff>&#39;image/gif&#39;</span>, <span style=color:#a5d6ff>&#39;image/webp&#39;</span>,
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#39;application/pdf&#39;</span>,
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#39;video/mp4&#39;</span>, <span style=color:#a5d6ff>&#39;audio/mpeg&#39;</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8b949e;font-style:italic># æœ€å¤§æ–‡ä»¶å¤§å° (10MB)</span>
</span></span><span style=display:flex><span>    MAX_FILE_SIZE <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>10</span> <span style=color:#ff7b72;font-weight:700>*</span> <span style=color:#a5d6ff>1024</span> <span style=color:#ff7b72;font-weight:700>*</span> <span style=color:#a5d6ff>1024</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>__init__</span>(self, upload_dir: str):
</span></span><span style=display:flex><span>        self<span style=color:#ff7b72;font-weight:700>.</span>upload_dir <span style=color:#ff7b72;font-weight:700>=</span> upload_dir
</span></span><span style=display:flex><span>        os<span style=color:#ff7b72;font-weight:700>.</span>makedirs(upload_dir, exist_ok<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#79c0ff>True</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>validate_file</span>(self, file) <span style=color:#ff7b72;font-weight:700>-&gt;</span> Tuple[bool, str]:
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;&#34;&#34;éªŒè¯æ–‡ä»¶&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># æ£€æŸ¥æ–‡ä»¶å</span>
</span></span><span style=display:flex><span>        filename <span style=color:#ff7b72;font-weight:700>=</span> secure_filename(file<span style=color:#ff7b72;font-weight:700>.</span>filename)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>if</span> <span style=color:#ff7b72;font-weight:700>not</span> filename:
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>return</span> <span style=color:#79c0ff>False</span>, <span style=color:#a5d6ff>&#34;Invalid filename&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># æ£€æŸ¥æ–‡ä»¶æ‰©å±•å</span>
</span></span><span style=display:flex><span>        ext <span style=color:#ff7b72;font-weight:700>=</span> filename<span style=color:#ff7b72;font-weight:700>.</span>rsplit(<span style=color:#a5d6ff>&#39;.&#39;</span>, <span style=color:#a5d6ff>1</span>)[<span style=color:#a5d6ff>1</span>]<span style=color:#ff7b72;font-weight:700>.</span>lower() <span style=color:#ff7b72>if</span> <span style=color:#a5d6ff>&#39;.&#39;</span> <span style=color:#ff7b72;font-weight:700>in</span> filename <span style=color:#ff7b72>else</span> <span style=color:#a5d6ff>&#39;&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>if</span> ext <span style=color:#ff7b72;font-weight:700>not</span> <span style=color:#ff7b72;font-weight:700>in</span> set()<span style=color:#ff7b72;font-weight:700>.</span>union(<span style=color:#ff7b72;font-weight:700>*</span>self<span style=color:#ff7b72;font-weight:700>.</span>ALLOWED_EXTENSIONS<span style=color:#ff7b72;font-weight:700>.</span>values()):
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>return</span> <span style=color:#79c0ff>False</span>, <span style=color:#79c0ff>f</span><span style=color:#a5d6ff>&#34;File extension &#39;</span><span style=color:#a5d6ff>{</span>ext<span style=color:#a5d6ff>}</span><span style=color:#a5d6ff>&#39; not allowed&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># æ£€æŸ¥æ–‡ä»¶å¤§å°</span>
</span></span><span style=display:flex><span>        file<span style=color:#ff7b72;font-weight:700>.</span>seek(<span style=color:#a5d6ff>0</span>, os<span style=color:#ff7b72;font-weight:700>.</span>SEEK_END)
</span></span><span style=display:flex><span>        file_size <span style=color:#ff7b72;font-weight:700>=</span> file<span style=color:#ff7b72;font-weight:700>.</span>tell()
</span></span><span style=display:flex><span>        file<span style=color:#ff7b72;font-weight:700>.</span>seek(<span style=color:#a5d6ff>0</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>if</span> file_size <span style=color:#ff7b72;font-weight:700>&gt;</span> self<span style=color:#ff7b72;font-weight:700>.</span>MAX_FILE_SIZE:
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>return</span> <span style=color:#79c0ff>False</span>, <span style=color:#79c0ff>f</span><span style=color:#a5d6ff>&#34;File size exceeds </span><span style=color:#a5d6ff>{</span>self<span style=color:#ff7b72;font-weight:700>.</span>MAX_FILE_SIZE<span style=color:#a5d6ff>}</span><span style=color:#a5d6ff> bytes&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># æ£€æŸ¥MIMEç±»å‹</span>
</span></span><span style=display:flex><span>        file_content <span style=color:#ff7b72;font-weight:700>=</span> file<span style=color:#ff7b72;font-weight:700>.</span>read()
</span></span><span style=display:flex><span>        mime_type <span style=color:#ff7b72;font-weight:700>=</span> magic<span style=color:#ff7b72;font-weight:700>.</span>from_buffer(file_content, mime<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#79c0ff>True</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>if</span> mime_type <span style=color:#ff7b72;font-weight:700>not</span> <span style=color:#ff7b72;font-weight:700>in</span> self<span style=color:#ff7b72;font-weight:700>.</span>ALLOWED_MIME_TYPES:
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>return</span> <span style=color:#79c0ff>False</span>, <span style=color:#79c0ff>f</span><span style=color:#a5d6ff>&#34;MIME type &#39;</span><span style=color:#a5d6ff>{</span>mime_type<span style=color:#a5d6ff>}</span><span style=color:#a5d6ff>&#39; not allowed&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># éªŒè¯æ‰©å±•åå’ŒMIMEç±»å‹æ˜¯å¦åŒ¹é…</span>
</span></span><span style=display:flex><span>        ext_mime_map <span style=color:#ff7b72;font-weight:700>=</span> {
</span></span><span style=display:flex><span>            <span style=color:#a5d6ff>&#39;jpg&#39;</span>: <span style=color:#a5d6ff>&#39;image/jpeg&#39;</span>,
</span></span><span style=display:flex><span>            <span style=color:#a5d6ff>&#39;jpeg&#39;</span>: <span style=color:#a5d6ff>&#39;image/jpeg&#39;</span>,
</span></span><span style=display:flex><span>            <span style=color:#a5d6ff>&#39;png&#39;</span>: <span style=color:#a5d6ff>&#39;image/png&#39;</span>,
</span></span><span style=display:flex><span>            <span style=color:#a5d6ff>&#39;gif&#39;</span>: <span style=color:#a5d6ff>&#39;image/gif&#39;</span>,
</span></span><span style=display:flex><span>            <span style=color:#a5d6ff>&#39;pdf&#39;</span>: <span style=color:#a5d6ff>&#39;application/pdf&#39;</span>
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>if</span> ext <span style=color:#ff7b72;font-weight:700>in</span> ext_mime_map <span style=color:#ff7b72;font-weight:700>and</span> ext_mime_map[ext] <span style=color:#ff7b72;font-weight:700>!=</span> mime_type:
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>return</span> <span style=color:#79c0ff>False</span>, <span style=color:#a5d6ff>&#34;File extension does not match content&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>return</span> <span style=color:#79c0ff>True</span>, <span style=color:#a5d6ff>&#34;Valid file&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>save_file</span>(self, file) <span style=color:#ff7b72;font-weight:700>-&gt;</span> Tuple[bool, str]:
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;&#34;&#34;ä¿å­˜æ–‡ä»¶&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># éªŒè¯æ–‡ä»¶</span>
</span></span><span style=display:flex><span>        is_valid, message <span style=color:#ff7b72;font-weight:700>=</span> self<span style=color:#ff7b72;font-weight:700>.</span>validate_file(file)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>if</span> <span style=color:#ff7b72;font-weight:700>not</span> is_valid:
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>return</span> <span style=color:#79c0ff>False</span>, message
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># ç”Ÿæˆå®‰å…¨çš„æ–‡ä»¶å</span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>import</span> <span style=color:#ff7b72>uuid</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        original_filename <span style=color:#ff7b72;font-weight:700>=</span> secure_filename(file<span style=color:#ff7b72;font-weight:700>.</span>filename)
</span></span><span style=display:flex><span>        ext <span style=color:#ff7b72;font-weight:700>=</span> original_filename<span style=color:#ff7b72;font-weight:700>.</span>rsplit(<span style=color:#a5d6ff>&#39;.&#39;</span>, <span style=color:#a5d6ff>1</span>)[<span style=color:#a5d6ff>1</span>]<span style=color:#ff7b72;font-weight:700>.</span>lower()
</span></span><span style=display:flex><span>        safe_filename <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#79c0ff>f</span><span style=color:#a5d6ff>&#34;</span><span style=color:#a5d6ff>{</span>uuid<span style=color:#ff7b72;font-weight:700>.</span>uuid4()<span style=color:#ff7b72;font-weight:700>.</span>hex<span style=color:#a5d6ff>}</span><span style=color:#a5d6ff>.</span><span style=color:#a5d6ff>{</span>ext<span style=color:#a5d6ff>}</span><span style=color:#a5d6ff>&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># ä¿å­˜æ–‡ä»¶</span>
</span></span><span style=display:flex><span>        filepath <span style=color:#ff7b72;font-weight:700>=</span> os<span style=color:#ff7b72;font-weight:700>.</span>path<span style=color:#ff7b72;font-weight:700>.</span>join(self<span style=color:#ff7b72;font-weight:700>.</span>upload_dir, safe_filename)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        file<span style=color:#ff7b72;font-weight:700>.</span>seek(<span style=color:#a5d6ff>0</span>)
</span></span><span style=display:flex><span>        file<span style=color:#ff7b72;font-weight:700>.</span>save(filepath)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># è®¾ç½®æ–‡ä»¶æƒé™</span>
</span></span><span style=display:flex><span>        os<span style=color:#ff7b72;font-weight:700>.</span>chmod(filepath, <span style=color:#a5d6ff>0o644</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>return</span> <span style=color:#79c0ff>True</span>, safe_filename
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic># Flaskè·¯ç”±ç¤ºä¾‹</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>from</span> <span style=color:#ff7b72>flask</span> <span style=color:#ff7b72>import</span> Flask, request, jsonify
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>app <span style=color:#ff7b72;font-weight:700>=</span> Flask(<span style=color:#79c0ff>__name__</span>)
</span></span><span style=display:flex><span>uploader <span style=color:#ff7b72;font-weight:700>=</span> SecureFileUpload(<span style=color:#a5d6ff>&#39;/var/uploads&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#d2a8ff;font-weight:700>@app.route</span>(<span style=color:#a5d6ff>&#39;/upload&#39;</span>, methods<span style=color:#ff7b72;font-weight:700>=</span>[<span style=color:#a5d6ff>&#39;POST&#39;</span>])
</span></span><span style=display:flex><span><span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>upload_file</span>():
</span></span><span style=display:flex><span>    <span style=color:#a5d6ff>&#34;&#34;&#34;æ–‡ä»¶ä¸Šä¼ æ¥å£&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>if</span> <span style=color:#a5d6ff>&#39;file&#39;</span> <span style=color:#ff7b72;font-weight:700>not</span> <span style=color:#ff7b72;font-weight:700>in</span> request<span style=color:#ff7b72;font-weight:700>.</span>files:
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>return</span> jsonify({<span style=color:#a5d6ff>&#39;error&#39;</span>: <span style=color:#a5d6ff>&#39;No file provided&#39;</span>}), <span style=color:#a5d6ff>400</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    file <span style=color:#ff7b72;font-weight:700>=</span> request<span style=color:#ff7b72;font-weight:700>.</span>files[<span style=color:#a5d6ff>&#39;file&#39;</span>]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>if</span> file<span style=color:#ff7b72;font-weight:700>.</span>filename <span style=color:#ff7b72;font-weight:700>==</span> <span style=color:#a5d6ff>&#39;&#39;</span>:
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>return</span> jsonify({<span style=color:#a5d6ff>&#39;error&#39;</span>: <span style=color:#a5d6ff>&#39;Empty filename&#39;</span>}), <span style=color:#a5d6ff>400</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8b949e;font-style:italic># ä¿å­˜æ–‡ä»¶</span>
</span></span><span style=display:flex><span>    success, message <span style=color:#ff7b72;font-weight:700>=</span> uploader<span style=color:#ff7b72;font-weight:700>.</span>save_file(file)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>if</span> success:
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>return</span> jsonify({
</span></span><span style=display:flex><span>            <span style=color:#a5d6ff>&#39;success&#39;</span>: <span style=color:#79c0ff>True</span>,
</span></span><span style=display:flex><span>            <span style=color:#a5d6ff>&#39;filename&#39;</span>: message
</span></span><span style=display:flex><span>        })
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>else</span>:
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>return</span> jsonify({
</span></span><span style=display:flex><span>            <span style=color:#a5d6ff>&#39;success&#39;</span>: <span style=color:#79c0ff>False</span>,
</span></span><span style=display:flex><span>            <span style=color:#a5d6ff>&#39;error&#39;</span>: message
</span></span><span style=display:flex><span>        }), <span style=color:#a5d6ff>400</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=22-æƒé™ç»•è¿‡>2.2 æƒé™ç»•è¿‡<a hidden class=anchor aria-hidden=true href=#22-æƒé™ç»•è¿‡>#</a></h3><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 56
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 57
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 58
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 59
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 60
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 61
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 62
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 63
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 64
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 65
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 66
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 67
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 68
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 69
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 70
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 71
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 72
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 73
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 74
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 75
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 76
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 77
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 78
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 79
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 80
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 81
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 82
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 83
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 84
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 85
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 86
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 87
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 88
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 89
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 90
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 91
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 92
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 93
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 94
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 95
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 96
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 97
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 98
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 99
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">100
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">101
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">102
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">103
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">104
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">105
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">106
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">107
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">108
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">109
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">110
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">111
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">112
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">113
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">114
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">115
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">116
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">117
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">118
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">119
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">120
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">121
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">122
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">123
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">124
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">125
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">126
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">127
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">128
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">129
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">130
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">131
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">132
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">133
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">134
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">135
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">136
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">137
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">138
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">139
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">140
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">141
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">142
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">143
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">144
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">145
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">146
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">147
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">148
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">149
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">150
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">151
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">152
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">153
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">154
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">155
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">156
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">157
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">158
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">159
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">160
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">161
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#8b949e;font-style:italic># ========== æƒé™æ§åˆ¶ ==========</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>from</span> <span style=color:#ff7b72>functools</span> <span style=color:#ff7b72>import</span> wraps
</span></span><span style=display:flex><span><span style=color:#ff7b72>from</span> <span style=color:#ff7b72>flask</span> <span style=color:#ff7b72>import</span> session, request, jsonify
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>class</span> <span style=color:#f0883e;font-weight:700>PermissionChecker</span>:
</span></span><span style=display:flex><span>    <span style=color:#a5d6ff>&#34;&#34;&#34;æƒé™æ£€æŸ¥å™¨&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8b949e;font-style:italic># æƒé™å®šä¹‰</span>
</span></span><span style=display:flex><span>    PERMISSIONS <span style=color:#ff7b72;font-weight:700>=</span> {
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#39;user:read&#39;</span>: <span style=color:#a5d6ff>&#39;æŸ¥çœ‹ç”¨æˆ·ä¿¡æ¯&#39;</span>,
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#39;user:write&#39;</span>: <span style=color:#a5d6ff>&#39;ä¿®æ”¹ç”¨æˆ·ä¿¡æ¯&#39;</span>,
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#39;user:delete&#39;</span>: <span style=color:#a5d6ff>&#39;åˆ é™¤ç”¨æˆ·&#39;</span>,
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#39;admin:panel&#39;</span>: <span style=color:#a5d6ff>&#39;è®¿é—®ç®¡ç†é¢æ¿&#39;</span>,
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#39;system:config&#39;</span>: <span style=color:#a5d6ff>&#39;ä¿®æ”¹ç³»ç»Ÿé…ç½®&#39;</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8b949e;font-style:italic># è§’è‰²æƒé™æ˜ å°„</span>
</span></span><span style=display:flex><span>    ROLE_PERMISSIONS <span style=color:#ff7b72;font-weight:700>=</span> {
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#39;guest&#39;</span>: [<span style=color:#a5d6ff>&#39;user:read&#39;</span>],
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#39;user&#39;</span>: [<span style=color:#a5d6ff>&#39;user:read&#39;</span>, <span style=color:#a5d6ff>&#39;user:write&#39;</span>],
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#39;moderator&#39;</span>: [<span style=color:#a5d6ff>&#39;user:read&#39;</span>, <span style=color:#a5d6ff>&#39;user:write&#39;</span>, <span style=color:#a5d6ff>&#39;user:delete&#39;</span>],
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#39;admin&#39;</span>: [<span style=color:#a5d6ff>&#39;admin:panel&#39;</span>, <span style=color:#a5d6ff>&#39;system:config&#39;</span>],
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#39;superadmin&#39;</span>: [<span style=color:#a5d6ff>&#39;*&#39;</span>]  <span style=color:#8b949e;font-style:italic># æ‰€æœ‰æƒé™</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#d2a8ff;font-weight:700>@classmethod</span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>has_permission</span>(cls, role: str, required_permission: str) <span style=color:#ff7b72;font-weight:700>-&gt;</span> bool:
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;&#34;&#34;æ£€æŸ¥è§’è‰²æ˜¯å¦æœ‰æƒé™&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>if</span> role <span style=color:#ff7b72;font-weight:700>not</span> <span style=color:#ff7b72;font-weight:700>in</span> cls<span style=color:#ff7b72;font-weight:700>.</span>ROLE_PERMISSIONS:
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>return</span> <span style=color:#79c0ff>False</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        permissions <span style=color:#ff7b72;font-weight:700>=</span> cls<span style=color:#ff7b72;font-weight:700>.</span>ROLE_PERMISSIONS[role]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># è¶…çº§ç®¡ç†å‘˜æ‹¥æœ‰æ‰€æœ‰æƒé™</span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>if</span> <span style=color:#a5d6ff>&#39;*&#39;</span> <span style=color:#ff7b72;font-weight:700>in</span> permissions:
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>return</span> <span style=color:#79c0ff>True</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>return</span> required_permission <span style=color:#ff7b72;font-weight:700>in</span> permissions
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic># è£…é¥°å™¨å®ç°æƒé™æ§åˆ¶</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>require_permission</span>(permission: str):
</span></span><span style=display:flex><span>    <span style=color:#a5d6ff>&#34;&#34;&#34;æƒé™æ£€æŸ¥è£…é¥°å™¨&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>decorator</span>(f):
</span></span><span style=display:flex><span>        <span style=color:#d2a8ff;font-weight:700>@wraps</span>(f)
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>decorated_function</span>(<span style=color:#ff7b72;font-weight:700>*</span>args, <span style=color:#ff7b72;font-weight:700>**</span>kwargs):
</span></span><span style=display:flex><span>            <span style=color:#8b949e;font-style:italic># ä»sessionè·å–ç”¨æˆ·è§’è‰²</span>
</span></span><span style=display:flex><span>            role <span style=color:#ff7b72;font-weight:700>=</span> session<span style=color:#ff7b72;font-weight:700>.</span>get(<span style=color:#a5d6ff>&#39;role&#39;</span>, <span style=color:#a5d6ff>&#39;guest&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#8b949e;font-style:italic># æ£€æŸ¥æƒé™</span>
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>if</span> <span style=color:#ff7b72;font-weight:700>not</span> PermissionChecker<span style=color:#ff7b72;font-weight:700>.</span>has_permission(role, permission):
</span></span><span style=display:flex><span>                <span style=color:#ff7b72>return</span> jsonify({
</span></span><span style=display:flex><span>                    <span style=color:#a5d6ff>&#39;error&#39;</span>: <span style=color:#a5d6ff>&#39;Permission denied&#39;</span>,
</span></span><span style=display:flex><span>                    <span style=color:#a5d6ff>&#39;required&#39;</span>: permission
</span></span><span style=display:flex><span>                }), <span style=color:#a5d6ff>403</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>return</span> f(<span style=color:#ff7b72;font-weight:700>*</span>args, <span style=color:#ff7b72;font-weight:700>**</span>kwargs)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>return</span> decorated_function
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>return</span> decorator
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic># èµ„æºæ‰€æœ‰è€…æ£€æŸ¥</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>require_owner_or_admin</span>(model_name: str, id_param: str <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>&#39;id&#39;</span>):
</span></span><span style=display:flex><span>    <span style=color:#a5d6ff>&#34;&#34;&#34;èµ„æºæ‰€æœ‰è€…æˆ–ç®¡ç†å‘˜æƒé™æ£€æŸ¥&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>decorator</span>(f):
</span></span><span style=display:flex><span>        <span style=color:#d2a8ff;font-weight:700>@wraps</span>(f)
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>decorated_function</span>(<span style=color:#ff7b72;font-weight:700>*</span>args, <span style=color:#ff7b72;font-weight:700>**</span>kwargs):
</span></span><span style=display:flex><span>            user_id <span style=color:#ff7b72;font-weight:700>=</span> session<span style=color:#ff7b72;font-weight:700>.</span>get(<span style=color:#a5d6ff>&#39;user_id&#39;</span>)
</span></span><span style=display:flex><span>            role <span style=color:#ff7b72;font-weight:700>=</span> session<span style=color:#ff7b72;font-weight:700>.</span>get(<span style=color:#a5d6ff>&#39;role&#39;</span>, <span style=color:#a5d6ff>&#39;guest&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#8b949e;font-style:italic># ç®¡ç†å‘˜è·³è¿‡æ£€æŸ¥</span>
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>if</span> role <span style=color:#ff7b72;font-weight:700>==</span> <span style=color:#a5d6ff>&#39;superadmin&#39;</span>:
</span></span><span style=display:flex><span>                <span style=color:#ff7b72>return</span> f(<span style=color:#ff7b72;font-weight:700>*</span>args, <span style=color:#ff7b72;font-weight:700>**</span>kwargs)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#8b949e;font-style:italic># è·å–èµ„æºID</span>
</span></span><span style=display:flex><span>            resource_id <span style=color:#ff7b72;font-weight:700>=</span> kwargs<span style=color:#ff7b72;font-weight:700>.</span>get(id_param) <span style=color:#ff7b72;font-weight:700>or</span> request<span style=color:#ff7b72;font-weight:700>.</span>view_args<span style=color:#ff7b72;font-weight:700>.</span>get(id_param)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#8b949e;font-style:italic># æ£€æŸ¥èµ„æºæ‰€æœ‰è€…</span>
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>from</span> <span style=color:#ff7b72>database</span> <span style=color:#ff7b72>import</span> get_db
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            db <span style=color:#ff7b72;font-weight:700>=</span> get_db()
</span></span><span style=display:flex><span>            resource <span style=color:#ff7b72;font-weight:700>=</span> db<span style=color:#ff7b72;font-weight:700>.</span>query(model_name)<span style=color:#ff7b72;font-weight:700>.</span>get(resource_id)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>if</span> resource <span style=color:#ff7b72;font-weight:700>and</span> resource<span style=color:#ff7b72;font-weight:700>.</span>owner_id <span style=color:#ff7b72;font-weight:700>==</span> user_id:
</span></span><span style=display:flex><span>                <span style=color:#ff7b72>return</span> f(<span style=color:#ff7b72;font-weight:700>*</span>args, <span style=color:#ff7b72;font-weight:700>**</span>kwargs)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>return</span> jsonify({<span style=color:#a5d6ff>&#39;error&#39;</span>: <span style=color:#a5d6ff>&#39;Resource access denied&#39;</span>}), <span style=color:#a5d6ff>403</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>return</span> decorated_function
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>return</span> decorator
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic># ä½¿ç”¨ç¤ºä¾‹</span>
</span></span><span style=display:flex><span><span style=color:#d2a8ff;font-weight:700>@app.route</span>(<span style=color:#a5d6ff>&#39;/users/&lt;int:id&gt;&#39;</span>, methods<span style=color:#ff7b72;font-weight:700>=</span>[<span style=color:#a5d6ff>&#39;GET&#39;</span>])
</span></span><span style=display:flex><span><span style=color:#d2a8ff;font-weight:700>@require_permission</span>(<span style=color:#a5d6ff>&#39;user:read&#39;</span>)
</span></span><span style=display:flex><span><span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>get_user</span>(id):
</span></span><span style=display:flex><span>    <span style=color:#a5d6ff>&#34;&#34;&#34;è·å–ç”¨æˆ·ä¿¡æ¯&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>return</span> jsonify({<span style=color:#a5d6ff>&#39;user&#39;</span>: <span style=color:#79c0ff>f</span><span style=color:#a5d6ff>&#39;User </span><span style=color:#a5d6ff>{</span>id<span style=color:#a5d6ff>}</span><span style=color:#a5d6ff>&#39;</span>})
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#d2a8ff;font-weight:700>@app.route</span>(<span style=color:#a5d6ff>&#39;/users/&lt;int:id&gt;&#39;</span>, methods<span style=color:#ff7b72;font-weight:700>=</span>[<span style=color:#a5d6ff>&#39;PUT&#39;</span>])
</span></span><span style=display:flex><span><span style=color:#d2a8ff;font-weight:700>@require_permission</span>(<span style=color:#a5d6ff>&#39;user:write&#39;</span>)
</span></span><span style=display:flex><span><span style=color:#d2a8ff;font-weight:700>@require_owner_or_admin</span>(<span style=color:#a5d6ff>&#39;User&#39;</span>, <span style=color:#a5d6ff>&#39;id&#39;</span>)
</span></span><span style=display:flex><span><span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>update_user</span>(id):
</span></span><span style=display:flex><span>    <span style=color:#a5d6ff>&#34;&#34;&#34;æ›´æ–°ç”¨æˆ·ä¿¡æ¯&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>return</span> jsonify({<span style=color:#a5d6ff>&#39;success&#39;</span>: <span style=color:#79c0ff>True</span>})
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#d2a8ff;font-weight:700>@app.route</span>(<span style=color:#a5d6ff>&#39;/users/&lt;int:id&gt;&#39;</span>, methods<span style=color:#ff7b72;font-weight:700>=</span>[<span style=color:#a5d6ff>&#39;DELETE&#39;</span>])
</span></span><span style=display:flex><span><span style=color:#d2a8ff;font-weight:700>@require_permission</span>(<span style=color:#a5d6ff>&#39;user:delete&#39;</span>)
</span></span><span style=display:flex><span><span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>delete_user</span>(id):
</span></span><span style=display:flex><span>    <span style=color:#a5d6ff>&#34;&#34;&#34;åˆ é™¤ç”¨æˆ·&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>return</span> jsonify({<span style=color:#a5d6ff>&#39;success&#39;</span>: <span style=color:#79c0ff>True</span>})
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic># ========== æ°´å¹³è¶Šæƒé˜²æŠ¤ ==========</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>class</span> <span style=color:#f0883e;font-weight:700>AccessControl</span>:
</span></span><span style=display:flex><span>    <span style=color:#a5d6ff>&#34;&#34;&#34;è®¿é—®æ§åˆ¶&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#d2a8ff;font-weight:700>@staticmethod</span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>check_resource_access</span>(user_id: int, resource_id: int, resource_type: str) <span style=color:#ff7b72;font-weight:700>-&gt;</span> bool:
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;&#34;&#34;æ£€æŸ¥èµ„æºè®¿é—®æƒé™&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>from</span> <span style=color:#ff7b72>database</span> <span style=color:#ff7b72>import</span> get_db
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        db <span style=color:#ff7b72;font-weight:700>=</span> get_db()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># æ£€æŸ¥èµ„æºæ˜¯å¦å­˜åœ¨</span>
</span></span><span style=display:flex><span>        resource <span style=color:#ff7b72;font-weight:700>=</span> db<span style=color:#ff7b72;font-weight:700>.</span>query(resource_type)<span style=color:#ff7b72;font-weight:700>.</span>get(resource_id)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>if</span> <span style=color:#ff7b72;font-weight:700>not</span> resource:
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>return</span> <span style=color:#79c0ff>False</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># æ£€æŸ¥èµ„æºæ‰€æœ‰è€…</span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>if</span> resource<span style=color:#ff7b72;font-weight:700>.</span>owner_id <span style=color:#ff7b72;font-weight:700>==</span> user_id:
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>return</span> <span style=color:#79c0ff>True</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># æ£€æŸ¥å…±äº«æƒé™</span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>if</span> hasattr(resource, <span style=color:#a5d6ff>&#39;shared_with&#39;</span>):
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>if</span> user_id <span style=color:#ff7b72;font-weight:700>in</span> resource<span style=color:#ff7b72;font-weight:700>.</span>shared_with:
</span></span><span style=display:flex><span>                <span style=color:#ff7b72>return</span> <span style=color:#79c0ff>True</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>return</span> <span style=color:#79c0ff>False</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#d2a8ff;font-weight:700>@staticmethod</span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>check_id_or_id_list</span>(user_input, max_length: int <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>1000</span>) <span style=color:#ff7b72;font-weight:700>-&gt;</span> bool:
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;&#34;&#34;æ£€æŸ¥IDå‚æ•°ï¼Œé˜²æ­¢IDéå†æ”»å‡»&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># å•ä¸ªID</span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>if</span> isinstance(user_input, int):
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>return</span> <span style=color:#a5d6ff>0</span> <span style=color:#ff7b72;font-weight:700>&lt;</span> user_input <span style=color:#ff7b72;font-weight:700>&lt;</span> max_length
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># IDåˆ—è¡¨</span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>if</span> isinstance(user_input, list):
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>if</span> len(user_input) <span style=color:#ff7b72;font-weight:700>&gt;</span> <span style=color:#a5d6ff>100</span>:  <span style=color:#8b949e;font-style:italic># é™åˆ¶åˆ—è¡¨é•¿åº¦</span>
</span></span><span style=display:flex><span>                <span style=color:#ff7b72>return</span> <span style=color:#79c0ff>False</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>return</span> all(
</span></span><span style=display:flex><span>                isinstance(id, int) <span style=color:#ff7b72;font-weight:700>and</span> <span style=color:#a5d6ff>0</span> <span style=color:#ff7b72;font-weight:700>&lt;</span> id <span style=color:#ff7b72;font-weight:700>&lt;</span> max_length
</span></span><span style=display:flex><span>                <span style=color:#ff7b72>for</span> id <span style=color:#ff7b72;font-weight:700>in</span> user_input
</span></span><span style=display:flex><span>            )
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>return</span> <span style=color:#79c0ff>False</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=ä¸‰æ¸—é€æµ‹è¯•ä¸æ¼æ´æŒ–æ˜>ä¸‰ã€æ¸—é€æµ‹è¯•ä¸æ¼æ´æŒ–æ˜<a hidden class=anchor aria-hidden=true href=#ä¸‰æ¸—é€æµ‹è¯•ä¸æ¼æ´æŒ–æ˜>#</a></h2><h3 id=31-ä¿¡æ¯æ”¶é›†>3.1 ä¿¡æ¯æ”¶é›†<a hidden class=anchor aria-hidden=true href=#31-ä¿¡æ¯æ”¶é›†>#</a></h3><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 56
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 57
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 58
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 59
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 60
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 61
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 62
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 63
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 64
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 65
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 66
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 67
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 68
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 69
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 70
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 71
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 72
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 73
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 74
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 75
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 76
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 77
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 78
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 79
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 80
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 81
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 82
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 83
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 84
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 85
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 86
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 87
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 88
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 89
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 90
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 91
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 92
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 93
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 94
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 95
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 96
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 97
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 98
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 99
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">100
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">101
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">102
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">103
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">104
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">105
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">106
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">107
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">108
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">109
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">110
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">111
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">112
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">113
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">114
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">115
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">116
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">117
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">118
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">119
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">120
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">121
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">122
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">123
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">124
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">125
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">126
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">127
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">128
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">129
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">130
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">131
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">132
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">133
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">134
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">135
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">136
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">137
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">138
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">139
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">140
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">141
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">142
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">143
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">144
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">145
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">146
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">147
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">148
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">149
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">150
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">151
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">152
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">153
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">154
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">155
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">156
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">157
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">158
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">159
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">160
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">161
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">162
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">163
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">164
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">165
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">166
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">167
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">168
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">169
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">170
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">171
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">172
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">173
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">174
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">175
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">176
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">177
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">178
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">179
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">180
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">181
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">182
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#8b949e;font-style:italic># ========== ä¿¡æ¯æ”¶é›†å·¥å…· ==========</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>import</span> <span style=color:#ff7b72>requests</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>import</span> <span style=color:#ff7b72>dns.resolver</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>import</span> <span style=color:#ff7b72>socket</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>from</span> <span style=color:#ff7b72>typing</span> <span style=color:#ff7b72>import</span> List, Dict, Set
</span></span><span style=display:flex><span><span style=color:#ff7b72>from</span> <span style=color:#ff7b72>urllib.parse</span> <span style=color:#ff7b72>import</span> urlparse
</span></span><span style=display:flex><span><span style=color:#ff7b72>import</span> <span style=color:#ff7b72>re</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>class</span> <span style=color:#f0883e;font-weight:700>InformationGathering</span>:
</span></span><span style=display:flex><span>    <span style=color:#a5d6ff>&#34;&#34;&#34;ä¿¡æ¯æ”¶é›†&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>__init__</span>(self, target: str):
</span></span><span style=display:flex><span>        self<span style=color:#ff7b72;font-weight:700>.</span>target <span style=color:#ff7b72;font-weight:700>=</span> target
</span></span><span style=display:flex><span>        self<span style=color:#ff7b72;font-weight:700>.</span>results <span style=color:#ff7b72;font-weight:700>=</span> {
</span></span><span style=display:flex><span>            <span style=color:#a5d6ff>&#39;subdomains&#39;</span>: set(),
</span></span><span style=display:flex><span>            <span style=color:#a5d6ff>&#39;open_ports&#39;</span>: [],
</span></span><span style=display:flex><span>            <span style=color:#a5d6ff>&#39;technologies&#39;</span>: [],
</span></span><span style=display:flex><span>            <span style=color:#a5d6ff>&#39;sensitive_files&#39;</span>: [],
</span></span><span style=display:flex><span>            <span style=color:#a5d6ff>&#39;emails&#39;</span>: set(),
</span></span><span style=display:flex><span>            <span style=color:#a5d6ff>&#39;social_accounts&#39;</span>: set()
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>enumerate_subdomains</span>(self) <span style=color:#ff7b72;font-weight:700>-&gt;</span> Set[str]:
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;&#34;&#34;å­åŸŸåæšä¸¾&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        wordlist <span style=color:#ff7b72;font-weight:700>=</span> [
</span></span><span style=display:flex><span>            <span style=color:#a5d6ff>&#39;www&#39;</span>, <span style=color:#a5d6ff>&#39;mail&#39;</span>, <span style=color:#a5d6ff>&#39;ftp&#39;</span>, <span style=color:#a5d6ff>&#39;admin&#39;</span>, <span style=color:#a5d6ff>&#39;blog&#39;</span>, <span style=color:#a5d6ff>&#39;api&#39;</span>,
</span></span><span style=display:flex><span>            <span style=color:#a5d6ff>&#39;dev&#39;</span>, <span style=color:#a5d6ff>&#39;staging&#39;</span>, <span style=color:#a5d6ff>&#39;test&#39;</span>, <span style=color:#a5d6ff>&#39;app&#39;</span>, <span style=color:#a5d6ff>&#39;mobile&#39;</span>
</span></span><span style=display:flex><span>        ]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>for</span> subdomain <span style=color:#ff7b72;font-weight:700>in</span> wordlist:
</span></span><span style=display:flex><span>            domain <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#79c0ff>f</span><span style=color:#a5d6ff>&#34;</span><span style=color:#a5d6ff>{</span>subdomain<span style=color:#a5d6ff>}</span><span style=color:#a5d6ff>.</span><span style=color:#a5d6ff>{</span>self<span style=color:#ff7b72;font-weight:700>.</span>target<span style=color:#a5d6ff>}</span><span style=color:#a5d6ff>&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>try</span>:
</span></span><span style=display:flex><span>                <span style=color:#8b949e;font-style:italic># DNSæŸ¥è¯¢</span>
</span></span><span style=display:flex><span>                dns<span style=color:#ff7b72;font-weight:700>.</span>resolver<span style=color:#ff7b72;font-weight:700>.</span>resolve(domain, <span style=color:#a5d6ff>&#39;A&#39;</span>)
</span></span><span style=display:flex><span>                self<span style=color:#ff7b72;font-weight:700>.</span>results[<span style=color:#a5d6ff>&#39;subdomains&#39;</span>]<span style=color:#ff7b72;font-weight:700>.</span>add(domain)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>except</span> (dns<span style=color:#ff7b72;font-weight:700>.</span>resolver<span style=color:#ff7b72;font-weight:700>.</span>NXDOMAIN, dns<span style=color:#ff7b72;font-weight:700>.</span>resolver<span style=color:#ff7b72;font-weight:700>.</span>NoAnswer):
</span></span><span style=display:flex><span>                <span style=color:#ff7b72>continue</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>return</span> self<span style=color:#ff7b72;font-weight:700>.</span>results[<span style=color:#a5d6ff>&#39;subdomains&#39;</span>]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>scan_ports</span>(self, ports: List[int] <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#79c0ff>None</span>) <span style=color:#ff7b72;font-weight:700>-&gt;</span> List[int]:
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;&#34;&#34;ç«¯å£æ‰«æ&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>if</span> ports <span style=color:#ff7b72;font-weight:700>is</span> <span style=color:#79c0ff>None</span>:
</span></span><span style=display:flex><span>            ports <span style=color:#ff7b72;font-weight:700>=</span> [<span style=color:#a5d6ff>21</span>, <span style=color:#a5d6ff>22</span>, <span style=color:#a5d6ff>23</span>, <span style=color:#a5d6ff>25</span>, <span style=color:#a5d6ff>53</span>, <span style=color:#a5d6ff>80</span>, <span style=color:#a5d6ff>110</span>, <span style=color:#a5d6ff>443</span>, <span style=color:#a5d6ff>445</span>, <span style=color:#a5d6ff>3306</span>, <span style=color:#a5d6ff>3389</span>, <span style=color:#a5d6ff>8080</span>]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        open_ports <span style=color:#ff7b72;font-weight:700>=</span> []
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>for</span> port <span style=color:#ff7b72;font-weight:700>in</span> ports:
</span></span><span style=display:flex><span>            sock <span style=color:#ff7b72;font-weight:700>=</span> socket<span style=color:#ff7b72;font-weight:700>.</span>socket(socket<span style=color:#ff7b72;font-weight:700>.</span>AF_INET, socket<span style=color:#ff7b72;font-weight:700>.</span>SOCK_STREAM)
</span></span><span style=display:flex><span>            sock<span style=color:#ff7b72;font-weight:700>.</span>settimeout(<span style=color:#a5d6ff>1</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>try</span>:
</span></span><span style=display:flex><span>                sock<span style=color:#ff7b72;font-weight:700>.</span>connect((self<span style=color:#ff7b72;font-weight:700>.</span>target, port))
</span></span><span style=display:flex><span>                open_ports<span style=color:#ff7b72;font-weight:700>.</span>append(port)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>except</span> socket<span style=color:#ff7b72;font-weight:700>.</span>error:
</span></span><span style=display:flex><span>                <span style=color:#ff7b72>pass</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>finally</span>:
</span></span><span style=display:flex><span>                sock<span style=color:#ff7b72;font-weight:700>.</span>close()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        self<span style=color:#ff7b72;font-weight:700>.</span>results[<span style=color:#a5d6ff>&#39;open_ports&#39;</span>] <span style=color:#ff7b72;font-weight:700>=</span> open_ports
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>return</span> open_ports
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>identify_technologies</span>(self) <span style=color:#ff7b72;font-weight:700>-&gt;</span> List[str]:
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;&#34;&#34;æŠ€æœ¯æ ˆè¯†åˆ«&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        url <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#79c0ff>f</span><span style=color:#a5d6ff>&#34;http://</span><span style=color:#a5d6ff>{</span>self<span style=color:#ff7b72;font-weight:700>.</span>target<span style=color:#a5d6ff>}</span><span style=color:#a5d6ff>&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>try</span>:
</span></span><span style=display:flex><span>            response <span style=color:#ff7b72;font-weight:700>=</span> requests<span style=color:#ff7b72;font-weight:700>.</span>get(url, timeout<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>10</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#8b949e;font-style:italic># æ£€æŸ¥å“åº”å¤´</span>
</span></span><span style=display:flex><span>            headers <span style=color:#ff7b72;font-weight:700>=</span> response<span style=color:#ff7b72;font-weight:700>.</span>headers
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            technologies <span style=color:#ff7b72;font-weight:700>=</span> []
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#8b949e;font-style:italic># Serverå¤´</span>
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>if</span> <span style=color:#a5d6ff>&#39;Server&#39;</span> <span style=color:#ff7b72;font-weight:700>in</span> headers:
</span></span><span style=display:flex><span>                technologies<span style=color:#ff7b72;font-weight:700>.</span>append(<span style=color:#79c0ff>f</span><span style=color:#a5d6ff>&#34;Server: </span><span style=color:#a5d6ff>{</span>headers[<span style=color:#a5d6ff>&#39;Server&#39;</span>]<span style=color:#a5d6ff>}</span><span style=color:#a5d6ff>&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#8b949e;font-style:italic># X-Powered-Byå¤´</span>
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>if</span> <span style=color:#a5d6ff>&#39;X-Powered-By&#39;</span> <span style=color:#ff7b72;font-weight:700>in</span> headers:
</span></span><span style=display:flex><span>                technologies<span style=color:#ff7b72;font-weight:700>.</span>append(<span style=color:#79c0ff>f</span><span style=color:#a5d6ff>&#34;PoweredBy: </span><span style=color:#a5d6ff>{</span>headers[<span style=color:#a5d6ff>&#39;X-Powered-By&#39;</span>]<span style=color:#a5d6ff>}</span><span style=color:#a5d6ff>&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#8b949e;font-style:italic># æ£€æŸ¥HTMLä¸­çš„æŠ€æœ¯ç‰¹å¾</span>
</span></span><span style=display:flex><span>            content <span style=color:#ff7b72;font-weight:700>=</span> response<span style=color:#ff7b72;font-weight:700>.</span>text
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#8b949e;font-style:italic># WordPress</span>
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>if</span> <span style=color:#a5d6ff>&#39;wp-content&#39;</span> <span style=color:#ff7b72;font-weight:700>in</span> content:
</span></span><span style=display:flex><span>                technologies<span style=color:#ff7b72;font-weight:700>.</span>append(<span style=color:#a5d6ff>&#34;WordPress&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#8b949e;font-style:italic># jQuery</span>
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>if</span> <span style=color:#a5d6ff>&#39;jquery&#39;</span> <span style=color:#ff7b72;font-weight:700>in</span> content<span style=color:#ff7b72;font-weight:700>.</span>lower():
</span></span><span style=display:flex><span>                technologies<span style=color:#ff7b72;font-weight:700>.</span>append(<span style=color:#a5d6ff>&#34;jQuery&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#8b949e;font-style:italic># React</span>
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>if</span> <span style=color:#a5d6ff>&#39;react&#39;</span> <span style=color:#ff7b72;font-weight:700>in</span> content<span style=color:#ff7b72;font-weight:700>.</span>lower():
</span></span><span style=display:flex><span>                technologies<span style=color:#ff7b72;font-weight:700>.</span>append(<span style=color:#a5d6ff>&#34;React&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#8b949e;font-style:italic># Vue</span>
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>if</span> <span style=color:#a5d6ff>&#39;vue&#39;</span> <span style=color:#ff7b72;font-weight:700>in</span> content<span style=color:#ff7b72;font-weight:700>.</span>lower():
</span></span><span style=display:flex><span>                technologies<span style=color:#ff7b72;font-weight:700>.</span>append(<span style=color:#a5d6ff>&#34;Vue&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            self<span style=color:#ff7b72;font-weight:700>.</span>results[<span style=color:#a5d6ff>&#39;technologies&#39;</span>] <span style=color:#ff7b72;font-weight:700>=</span> technologies
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>except</span> requests<span style=color:#ff7b72;font-weight:700>.</span>RequestException:
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>pass</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>return</span> self<span style=color:#ff7b72;font-weight:700>.</span>results[<span style=color:#a5d6ff>&#39;technologies&#39;</span>]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>find_sensitive_files</span>(self) <span style=color:#ff7b72;font-weight:700>-&gt;</span> List[str]:
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;&#34;&#34;æ•æ„Ÿæ–‡ä»¶æ‰«æ&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        sensitive_paths <span style=color:#ff7b72;font-weight:700>=</span> [
</span></span><span style=display:flex><span>            <span style=color:#a5d6ff>&#39;/robots.txt&#39;</span>,
</span></span><span style=display:flex><span>            <span style=color:#a5d6ff>&#39;/.git/config&#39;</span>,
</span></span><span style=display:flex><span>            <span style=color:#a5d6ff>&#39;/.env&#39;</span>,
</span></span><span style=display:flex><span>            <span style=color:#a5d6ff>&#39;/wp-config.php&#39;</span>,
</span></span><span style=display:flex><span>            <span style=color:#a5d6ff>&#39;/web.config&#39;</span>,
</span></span><span style=display:flex><span>            <span style=color:#a5d6ff>&#39;/.htaccess&#39;</span>,
</span></span><span style=display:flex><span>            <span style=color:#a5d6ff>&#39;/admin&#39;</span>,
</span></span><span style=display:flex><span>            <span style=color:#a5d6ff>&#39;/phpmyadmin&#39;</span>,
</span></span><span style=display:flex><span>            <span style=color:#a5d6ff>&#39;/backup.zip&#39;</span>,
</span></span><span style=display:flex><span>            <span style=color:#a5d6ff>&#39;/database.sql&#39;</span>
</span></span><span style=display:flex><span>        ]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        found_files <span style=color:#ff7b72;font-weight:700>=</span> []
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>for</span> path <span style=color:#ff7b72;font-weight:700>in</span> sensitive_paths:
</span></span><span style=display:flex><span>            url <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#79c0ff>f</span><span style=color:#a5d6ff>&#34;http://</span><span style=color:#a5d6ff>{</span>self<span style=color:#ff7b72;font-weight:700>.</span>target<span style=color:#a5d6ff>}{</span>path<span style=color:#a5d6ff>}</span><span style=color:#a5d6ff>&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>try</span>:
</span></span><span style=display:flex><span>                response <span style=color:#ff7b72;font-weight:700>=</span> requests<span style=color:#ff7b72;font-weight:700>.</span>get(url, timeout<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>5</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>                <span style=color:#ff7b72>if</span> response<span style=color:#ff7b72;font-weight:700>.</span>status_code <span style=color:#ff7b72;font-weight:700>in</span> [<span style=color:#a5d6ff>200</span>, <span style=color:#a5d6ff>301</span>, <span style=color:#a5d6ff>302</span>]:
</span></span><span style=display:flex><span>                    found_files<span style=color:#ff7b72;font-weight:700>.</span>append(path)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>except</span> requests<span style=color:#ff7b72;font-weight:700>.</span>RequestException:
</span></span><span style=display:flex><span>                <span style=color:#ff7b72>continue</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        self<span style=color:#ff7b72;font-weight:700>.</span>results[<span style=color:#a5d6ff>&#39;sensitive_files&#39;</span>] <span style=color:#ff7b72;font-weight:700>=</span> found_files
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>return</span> found_files
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>extract_emails</span>(self) <span style=color:#ff7b72;font-weight:700>-&gt;</span> Set[str]:
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;&#34;&#34;æå–é‚®ç®±åœ°å€&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        url <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#79c0ff>f</span><span style=color:#a5d6ff>&#34;http://</span><span style=color:#a5d6ff>{</span>self<span style=color:#ff7b72;font-weight:700>.</span>target<span style=color:#a5d6ff>}</span><span style=color:#a5d6ff>&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>try</span>:
</span></span><span style=display:flex><span>            response <span style=color:#ff7b72;font-weight:700>=</span> requests<span style=color:#ff7b72;font-weight:700>.</span>get(url, timeout<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>10</span>)
</span></span><span style=display:flex><span>            content <span style=color:#ff7b72;font-weight:700>=</span> response<span style=color:#ff7b72;font-weight:700>.</span>text
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#8b949e;font-style:italic># é‚®ç®±æ­£åˆ™</span>
</span></span><span style=display:flex><span>            email_pattern <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#79c0ff>r</span><span style=color:#a5d6ff>&#39;\b[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Z|a-z]{2,}\b&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            emails <span style=color:#ff7b72;font-weight:700>=</span> set(re<span style=color:#ff7b72;font-weight:700>.</span>findall(email_pattern, content, re<span style=color:#ff7b72;font-weight:700>.</span>IGNORECASE))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            self<span style=color:#ff7b72;font-weight:700>.</span>results[<span style=color:#a5d6ff>&#39;emails&#39;</span>] <span style=color:#ff7b72;font-weight:700>=</span> emails
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>except</span> requests<span style=color:#ff7b72;font-weight:700>.</span>RequestException:
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>pass</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>return</span> self<span style=color:#ff7b72;font-weight:700>.</span>results[<span style=color:#a5d6ff>&#39;emails&#39;</span>]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>generate_report</span>(self) <span style=color:#ff7b72;font-weight:700>-&gt;</span> Dict:
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;&#34;&#34;ç”ŸæˆæŠ¥å‘Š&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>return</span> {
</span></span><span style=display:flex><span>            <span style=color:#a5d6ff>&#39;target&#39;</span>: self<span style=color:#ff7b72;font-weight:700>.</span>target,
</span></span><span style=display:flex><span>            <span style=color:#a5d6ff>&#39;subdomains&#39;</span>: list(self<span style=color:#ff7b72;font-weight:700>.</span>results[<span style=color:#a5d6ff>&#39;subdomains&#39;</span>]),
</span></span><span style=display:flex><span>            <span style=color:#a5d6ff>&#39;open_ports&#39;</span>: self<span style=color:#ff7b72;font-weight:700>.</span>results[<span style=color:#a5d6ff>&#39;open_ports&#39;</span>],
</span></span><span style=display:flex><span>            <span style=color:#a5d6ff>&#39;technologies&#39;</span>: self<span style=color:#ff7b72;font-weight:700>.</span>results[<span style=color:#a5d6ff>&#39;technologies&#39;</span>],
</span></span><span style=display:flex><span>            <span style=color:#a5d6ff>&#39;sensitive_files&#39;</span>: self<span style=color:#ff7b72;font-weight:700>.</span>results[<span style=color:#a5d6ff>&#39;sensitive_files&#39;</span>],
</span></span><span style=display:flex><span>            <span style=color:#a5d6ff>&#39;emails&#39;</span>: list(self<span style=color:#ff7b72;font-weight:700>.</span>results[<span style=color:#a5d6ff>&#39;emails&#39;</span>]),
</span></span><span style=display:flex><span>            <span style=color:#a5d6ff>&#39;social_accounts&#39;</span>: list(self<span style=color:#ff7b72;font-weight:700>.</span>results[<span style=color:#a5d6ff>&#39;social_accounts&#39;</span>])
</span></span><span style=display:flex><span>        }
</span></span></code></pre></td></tr></table></div></div><h3 id=32-æ¼æ´æ‰«æ>3.2 æ¼æ´æ‰«æ<a hidden class=anchor aria-hidden=true href=#32-æ¼æ´æ‰«æ>#</a></h3><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 56
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 57
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 58
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 59
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 60
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 61
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 62
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 63
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 64
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 65
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 66
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 67
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 68
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 69
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 70
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 71
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 72
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 73
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 74
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 75
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 76
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 77
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 78
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 79
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 80
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 81
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 82
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 83
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 84
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 85
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 86
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 87
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 88
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 89
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 90
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 91
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 92
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 93
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 94
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 95
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 96
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 97
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 98
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 99
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">100
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">101
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">102
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">103
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">104
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">105
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">106
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">107
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">108
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">109
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">110
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">111
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">112
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">113
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">114
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">115
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">116
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">117
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">118
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">119
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">120
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">121
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">122
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">123
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">124
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">125
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">126
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">127
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">128
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">129
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">130
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">131
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">132
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">133
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">134
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">135
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">136
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">137
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">138
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">139
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">140
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">141
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">142
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">143
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">144
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">145
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">146
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">147
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">148
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">149
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">150
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">151
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">152
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">153
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">154
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">155
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">156
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">157
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">158
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">159
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">160
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">161
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">162
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">163
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">164
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">165
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">166
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">167
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">168
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">169
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">170
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">171
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">172
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">173
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">174
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">175
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">176
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">177
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">178
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">179
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">180
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">181
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">182
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">183
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">184
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">185
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">186
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">187
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">188
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">189
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">190
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">191
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">192
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">193
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">194
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#8b949e;font-style:italic># ========== æ¼æ´æ‰«æå™¨ ==========</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>import</span> <span style=color:#ff7b72>requests</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>from</span> <span style=color:#ff7b72>typing</span> <span style=color:#ff7b72>import</span> Dict, List
</span></span><span style=display:flex><span><span style=color:#ff7b72>import</span> <span style=color:#ff7b72>re</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>class</span> <span style=color:#f0883e;font-weight:700>VulnerabilityScanner</span>:
</span></span><span style=display:flex><span>    <span style=color:#a5d6ff>&#34;&#34;&#34;æ¼æ´æ‰«æå™¨&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>__init__</span>(self, target: str):
</span></span><span style=display:flex><span>        self<span style=color:#ff7b72;font-weight:700>.</span>target <span style=color:#ff7b72;font-weight:700>=</span> target
</span></span><span style=display:flex><span>        self<span style=color:#ff7b72;font-weight:700>.</span>vulnerabilities <span style=color:#ff7b72;font-weight:700>=</span> []
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>scan_sql_injection</span>(self, urls: List[str]) <span style=color:#ff7b72;font-weight:700>-&gt;</span> List[Dict]:
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;&#34;&#34;SQLæ³¨å…¥æ‰«æ&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        payloads <span style=color:#ff7b72;font-weight:700>=</span> [
</span></span><span style=display:flex><span>            <span style=color:#a5d6ff>&#34;&#39;&#34;</span>,
</span></span><span style=display:flex><span>            <span style=color:#a5d6ff>&#34;&#39; OR &#39;1&#39;=&#39;1&#34;</span>,
</span></span><span style=display:flex><span>            <span style=color:#a5d6ff>&#34;&#39; OR &#39;1&#39;=&#39;1&#39;--&#34;</span>,
</span></span><span style=display:flex><span>            <span style=color:#a5d6ff>&#34;admin&#39;--&#34;</span>,
</span></span><span style=display:flex><span>            <span style=color:#a5d6ff>&#34;1&#39; ORDER BY 1--&#34;</span>,
</span></span><span style=display:flex><span>            <span style=color:#a5d6ff>&#34;1&#39; UNION SELECT NULL--&#34;</span>
</span></span><span style=display:flex><span>        ]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        found <span style=color:#ff7b72;font-weight:700>=</span> []
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>for</span> url <span style=color:#ff7b72;font-weight:700>in</span> urls:
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>for</span> payload <span style=color:#ff7b72;font-weight:700>in</span> payloads:
</span></span><span style=display:flex><span>                <span style=color:#ff7b72>try</span>:
</span></span><span style=display:flex><span>                    <span style=color:#8b949e;font-style:italic># æµ‹è¯•GETå‚æ•°</span>
</span></span><span style=display:flex><span>                    <span style=color:#ff7b72>if</span> <span style=color:#a5d6ff>&#39;?&#39;</span> <span style=color:#ff7b72;font-weight:700>in</span> url:
</span></span><span style=display:flex><span>                        test_url <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#79c0ff>f</span><span style=color:#a5d6ff>&#34;</span><span style=color:#a5d6ff>{</span>url<span style=color:#a5d6ff>}{</span>payload<span style=color:#a5d6ff>}</span><span style=color:#a5d6ff>&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>                        response <span style=color:#ff7b72;font-weight:700>=</span> requests<span style=color:#ff7b72;font-weight:700>.</span>get(test_url, timeout<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>5</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>                        <span style=color:#8b949e;font-style:italic># æ£€æŸ¥SQLé”™è¯¯ç‰¹å¾</span>
</span></span><span style=display:flex><span>                        sql_errors <span style=color:#ff7b72;font-weight:700>=</span> [
</span></span><span style=display:flex><span>                            <span style=color:#a5d6ff>&#34;You have an error in your SQL syntax&#34;</span>,
</span></span><span style=display:flex><span>                            <span style=color:#a5d6ff>&#34;Warning: mysql_fetch_array()&#34;</span>,
</span></span><span style=display:flex><span>                            <span style=color:#a5d6ff>&#34;ORA-01756: quoted string not properly terminated&#34;</span>,
</span></span><span style=display:flex><span>                            <span style=color:#a5d6ff>&#34;Unclosed quotation mark after the character string&#34;</span>
</span></span><span style=display:flex><span>                        ]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>                        <span style=color:#ff7b72>if</span> any(error <span style=color:#ff7b72;font-weight:700>in</span> response<span style=color:#ff7b72;font-weight:700>.</span>text <span style=color:#ff7b72>for</span> error <span style=color:#ff7b72;font-weight:700>in</span> sql_errors):
</span></span><span style=display:flex><span>                            found<span style=color:#ff7b72;font-weight:700>.</span>append({
</span></span><span style=display:flex><span>                                <span style=color:#a5d6ff>&#39;type&#39;</span>: <span style=color:#a5d6ff>&#39;SQL Injection&#39;</span>,
</span></span><span style=display:flex><span>                                <span style=color:#a5d6ff>&#39;url&#39;</span>: url,
</span></span><span style=display:flex><span>                                <span style=color:#a5d6ff>&#39;payload&#39;</span>: payload,
</span></span><span style=display:flex><span>                                <span style=color:#a5d6ff>&#39;severity&#39;</span>: <span style=color:#a5d6ff>&#39;High&#39;</span>
</span></span><span style=display:flex><span>                            })
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>                <span style=color:#ff7b72>except</span> requests<span style=color:#ff7b72;font-weight:700>.</span>RequestException:
</span></span><span style=display:flex><span>                    <span style=color:#ff7b72>continue</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        self<span style=color:#ff7b72;font-weight:700>.</span>vulnerabilities<span style=color:#ff7b72;font-weight:700>.</span>extend(found)
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>return</span> found
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>scan_xss</span>(self, urls: List[str]) <span style=color:#ff7b72;font-weight:700>-&gt;</span> List[Dict]:
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;&#34;&#34;XSSæ‰«æ&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        payloads <span style=color:#ff7b72;font-weight:700>=</span> [
</span></span><span style=display:flex><span>            <span style=color:#a5d6ff>&#34;&lt;script&gt;alert(&#39;XSS&#39;)&lt;/script&gt;&#34;</span>,
</span></span><span style=display:flex><span>            <span style=color:#a5d6ff>&#34;&lt;img src=x onerror=alert(&#39;XSS&#39;)&gt;&#34;</span>,
</span></span><span style=display:flex><span>            <span style=color:#a5d6ff>&#34;&lt;svg onload=alert(&#39;XSS&#39;)&gt;&#34;</span>,
</span></span><span style=display:flex><span>            <span style=color:#a5d6ff>&#34;javascript:alert(&#39;XSS&#39;)&#34;</span>,
</span></span><span style=display:flex><span>            <span style=color:#a5d6ff>&#34;&#39;&gt;&lt;script&gt;alert(&#39;XSS&#39;)&lt;/script&gt;&#34;</span>
</span></span><span style=display:flex><span>        ]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        found <span style=color:#ff7b72;font-weight:700>=</span> []
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>for</span> url <span style=color:#ff7b72;font-weight:700>in</span> urls:
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>for</span> payload <span style=color:#ff7b72;font-weight:700>in</span> payloads:
</span></span><span style=display:flex><span>                <span style=color:#ff7b72>try</span>:
</span></span><span style=display:flex><span>                    <span style=color:#8b949e;font-style:italic># URLç¼–ç payload</span>
</span></span><span style=display:flex><span>                    <span style=color:#ff7b72>import</span> <span style=color:#ff7b72>urllib.parse</span>
</span></span><span style=display:flex><span>                    encoded_payload <span style=color:#ff7b72;font-weight:700>=</span> urllib<span style=color:#ff7b72;font-weight:700>.</span>parse<span style=color:#ff7b72;font-weight:700>.</span>quote(payload)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>                    test_url <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#79c0ff>f</span><span style=color:#a5d6ff>&#34;</span><span style=color:#a5d6ff>{</span>url<span style=color:#a5d6ff>}{</span>encoded_payload<span style=color:#a5d6ff>}</span><span style=color:#a5d6ff>&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>                    response <span style=color:#ff7b72;font-weight:700>=</span> requests<span style=color:#ff7b72;font-weight:700>.</span>get(test_url, timeout<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>5</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>                    <span style=color:#8b949e;font-style:italic># æ£€æŸ¥payloadæ˜¯å¦è¢«åå°„</span>
</span></span><span style=display:flex><span>                    <span style=color:#ff7b72>if</span> payload <span style=color:#ff7b72;font-weight:700>in</span> response<span style=color:#ff7b72;font-weight:700>.</span>text <span style=color:#ff7b72;font-weight:700>or</span> encoded_payload <span style=color:#ff7b72;font-weight:700>in</span> response<span style=color:#ff7b72;font-weight:700>.</span>text:
</span></span><span style=display:flex><span>                        found<span style=color:#ff7b72;font-weight:700>.</span>append({
</span></span><span style=display:flex><span>                            <span style=color:#a5d6ff>&#39;type&#39;</span>: <span style=color:#a5d6ff>&#39;XSS&#39;</span>,
</span></span><span style=display:flex><span>                            <span style=color:#a5d6ff>&#39;url&#39;</span>: url,
</span></span><span style=display:flex><span>                            <span style=color:#a5d6ff>&#39;payload&#39;</span>: payload,
</span></span><span style=display:flex><span>                            <span style=color:#a5d6ff>&#39;severity&#39;</span>: <span style=color:#a5d6ff>&#39;High&#39;</span>
</span></span><span style=display:flex><span>                        })
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>                <span style=color:#ff7b72>except</span> requests<span style=color:#ff7b72;font-weight:700>.</span>RequestException:
</span></span><span style=display:flex><span>                    <span style=color:#ff7b72>continue</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        self<span style=color:#ff7b72;font-weight:700>.</span>vulnerabilities<span style=color:#ff7b72;font-weight:700>.</span>extend(found)
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>return</span> found
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>check_security_headers</span>(self, url: str) <span style=color:#ff7b72;font-weight:700>-&gt;</span> Dict:
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;&#34;&#34;å®‰å…¨å¤´æ£€æŸ¥&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>try</span>:
</span></span><span style=display:flex><span>            response <span style=color:#ff7b72;font-weight:700>=</span> requests<span style=color:#ff7b72;font-weight:700>.</span>get(url, timeout<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>10</span>)
</span></span><span style=display:flex><span>            headers <span style=color:#ff7b72;font-weight:700>=</span> response<span style=color:#ff7b72;font-weight:700>.</span>headers
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            missing_headers <span style=color:#ff7b72;font-weight:700>=</span> []
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#8b949e;font-style:italic># æ£€æŸ¥å¿…è¦çš„å®‰å…¨å¤´</span>
</span></span><span style=display:flex><span>            security_headers <span style=color:#ff7b72;font-weight:700>=</span> {
</span></span><span style=display:flex><span>                <span style=color:#a5d6ff>&#39;X-Frame-Options&#39;</span>: <span style=color:#a5d6ff>&#39;é˜²æ­¢ç‚¹å‡»åŠ«æŒ&#39;</span>,
</span></span><span style=display:flex><span>                <span style=color:#a5d6ff>&#39;X-Content-Type-Options&#39;</span>: <span style=color:#a5d6ff>&#39;é˜²æ­¢MIMEç±»å‹å—…æ¢&#39;</span>,
</span></span><span style=display:flex><span>                <span style=color:#a5d6ff>&#39;X-XSS-Protection&#39;</span>: <span style=color:#a5d6ff>&#39;XSSè¿‡æ»¤&#39;</span>,
</span></span><span style=display:flex><span>                <span style=color:#a5d6ff>&#39;Content-Security-Policy&#39;</span>: <span style=color:#a5d6ff>&#39;å†…å®¹å®‰å…¨ç­–ç•¥&#39;</span>,
</span></span><span style=display:flex><span>                <span style=color:#a5d6ff>&#39;Strict-Transport-Security&#39;</span>: <span style=color:#a5d6ff>&#39;å¼ºåˆ¶HTTPS&#39;</span>
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>for</span> header, description <span style=color:#ff7b72;font-weight:700>in</span> security_headers<span style=color:#ff7b72;font-weight:700>.</span>items():
</span></span><span style=display:flex><span>                <span style=color:#ff7b72>if</span> header <span style=color:#ff7b72;font-weight:700>not</span> <span style=color:#ff7b72;font-weight:700>in</span> headers:
</span></span><span style=display:flex><span>                    missing_headers<span style=color:#ff7b72;font-weight:700>.</span>append({
</span></span><span style=display:flex><span>                        <span style=color:#a5d6ff>&#39;header&#39;</span>: header,
</span></span><span style=display:flex><span>                        <span style=color:#a5d6ff>&#39;description&#39;</span>: description
</span></span><span style=display:flex><span>                    })
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>return</span> {
</span></span><span style=display:flex><span>                <span style=color:#a5d6ff>&#39;url&#39;</span>: url,
</span></span><span style=display:flex><span>                <span style=color:#a5d6ff>&#39;missing_headers&#39;</span>: missing_headers,
</span></span><span style=display:flex><span>                <span style=color:#a5d6ff>&#39;severity&#39;</span>: <span style=color:#a5d6ff>&#39;Medium&#39;</span> <span style=color:#ff7b72>if</span> missing_headers <span style=color:#ff7b72>else</span> <span style=color:#a5d6ff>&#39;Low&#39;</span>
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>except</span> requests<span style=color:#ff7b72;font-weight:700>.</span>RequestException:
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>return</span> {<span style=color:#a5d6ff>&#39;error&#39;</span>: <span style=color:#a5d6ff>&#39;Failed to check headers&#39;</span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>scan_directory_traversal</span>(self, base_url: str) <span style=color:#ff7b72;font-weight:700>-&gt;</span> List[Dict]:
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;&#34;&#34;ç›®å½•éå†æ‰«æ&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        payloads <span style=color:#ff7b72;font-weight:700>=</span> [
</span></span><span style=display:flex><span>            <span style=color:#a5d6ff>&#39;../../../etc/passwd&#39;</span>,
</span></span><span style=display:flex><span>            <span style=color:#a5d6ff>&#39;..</span><span style=color:#79c0ff>\\</span><span style=color:#a5d6ff>..</span><span style=color:#79c0ff>\\</span><span style=color:#a5d6ff>..</span><span style=color:#79c0ff>\\</span><span style=color:#a5d6ff>windows</span><span style=color:#79c0ff>\\</span><span style=color:#a5d6ff>win.ini&#39;</span>,
</span></span><span style=display:flex><span>            <span style=color:#a5d6ff>&#39;....//....//....//etc/passwd&#39;</span>,
</span></span><span style=display:flex><span>            <span style=color:#a5d6ff>&#39;</span><span style=color:#a5d6ff>%2e%2e%2f%2e%2e%2f%2e%2e%2f</span><span style=color:#a5d6ff>etc</span><span style=color:#a5d6ff>%2f</span><span style=color:#a5d6ff>passwd&#39;</span>
</span></span><span style=display:flex><span>        ]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        found <span style=color:#ff7b72;font-weight:700>=</span> []
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># å¸¸è§çš„å¯æµ‹è¯•ç«¯ç‚¹</span>
</span></span><span style=display:flex><span>        test_paths <span style=color:#ff7b72;font-weight:700>=</span> [
</span></span><span style=display:flex><span>            <span style=color:#a5d6ff>&#39;/download&#39;</span>,
</span></span><span style=display:flex><span>            <span style=color:#a5d6ff>&#39;/file&#39;</span>,
</span></span><span style=display:flex><span>            <span style=color:#a5d6ff>&#39;/image&#39;</span>,
</span></span><span style=display:flex><span>            <span style=color:#a5d6ff>&#39;/document&#39;</span>
</span></span><span style=display:flex><span>        ]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>for</span> path <span style=color:#ff7b72;font-weight:700>in</span> test_paths:
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>for</span> payload <span style=color:#ff7b72;font-weight:700>in</span> payloads:
</span></span><span style=display:flex><span>                <span style=color:#ff7b72>try</span>:
</span></span><span style=display:flex><span>                    test_url <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#79c0ff>f</span><span style=color:#a5d6ff>&#34;</span><span style=color:#a5d6ff>{</span>base_url<span style=color:#a5d6ff>}{</span>path<span style=color:#a5d6ff>}</span><span style=color:#a5d6ff>?file=</span><span style=color:#a5d6ff>{</span>payload<span style=color:#a5d6ff>}</span><span style=color:#a5d6ff>&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>                    response <span style=color:#ff7b72;font-weight:700>=</span> requests<span style=color:#ff7b72;font-weight:700>.</span>get(test_url, timeout<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>5</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>                    <span style=color:#8b949e;font-style:italic># æ£€æŸ¥å“åº”å†…å®¹</span>
</span></span><span style=display:flex><span>                    <span style=color:#ff7b72>if</span> <span style=color:#a5d6ff>&#39;root:&#39;</span> <span style=color:#ff7b72;font-weight:700>in</span> response<span style=color:#ff7b72;font-weight:700>.</span>text <span style=color:#ff7b72;font-weight:700>or</span> <span style=color:#a5d6ff>&#39;[extensions]&#39;</span> <span style=color:#ff7b72;font-weight:700>in</span> response<span style=color:#ff7b72;font-weight:700>.</span>text:
</span></span><span style=display:flex><span>                        found<span style=color:#ff7b72;font-weight:700>.</span>append({
</span></span><span style=display:flex><span>                            <span style=color:#a5d6ff>&#39;type&#39;</span>: <span style=color:#a5d6ff>&#39;Directory Traversal&#39;</span>,
</span></span><span style=display:flex><span>                            <span style=color:#a5d6ff>&#39;url&#39;</span>: test_url,
</span></span><span style=display:flex><span>                            <span style=color:#a5d6ff>&#39;payload&#39;</span>: payload,
</span></span><span style=display:flex><span>                            <span style=color:#a5d6ff>&#39;severity&#39;</span>: <span style=color:#a5d6ff>&#39;High&#39;</span>
</span></span><span style=display:flex><span>                        })
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>                <span style=color:#ff7b72>except</span> requests<span style=color:#ff7b72;font-weight:700>.</span>RequestException:
</span></span><span style=display:flex><span>                    <span style=color:#ff7b72>continue</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        self<span style=color:#ff7b72;font-weight:700>.</span>vulnerabilities<span style=color:#ff7b72;font-weight:700>.</span>extend(found)
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>return</span> found
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>generate_report</span>(self) <span style=color:#ff7b72;font-weight:700>-&gt;</span> Dict:
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;&#34;&#34;ç”Ÿæˆæ‰«ææŠ¥å‘Š&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># ç»Ÿè®¡æ¼æ´</span>
</span></span><span style=display:flex><span>        vuln_count <span style=color:#ff7b72;font-weight:700>=</span> {
</span></span><span style=display:flex><span>            <span style=color:#a5d6ff>&#39;Critical&#39;</span>: <span style=color:#a5d6ff>0</span>,
</span></span><span style=display:flex><span>            <span style=color:#a5d6ff>&#39;High&#39;</span>: <span style=color:#a5d6ff>0</span>,
</span></span><span style=display:flex><span>            <span style=color:#a5d6ff>&#39;Medium&#39;</span>: <span style=color:#a5d6ff>0</span>,
</span></span><span style=display:flex><span>            <span style=color:#a5d6ff>&#39;Low&#39;</span>: <span style=color:#a5d6ff>0</span>
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>for</span> vuln <span style=color:#ff7b72;font-weight:700>in</span> self<span style=color:#ff7b72;font-weight:700>.</span>vulnerabilities:
</span></span><span style=display:flex><span>            severity <span style=color:#ff7b72;font-weight:700>=</span> vuln<span style=color:#ff7b72;font-weight:700>.</span>get(<span style=color:#a5d6ff>&#39;severity&#39;</span>, <span style=color:#a5d6ff>&#39;Low&#39;</span>)
</span></span><span style=display:flex><span>            vuln_count[severity] <span style=color:#ff7b72;font-weight:700>=</span> vuln_count<span style=color:#ff7b72;font-weight:700>.</span>get(severity, <span style=color:#a5d6ff>0</span>) <span style=color:#ff7b72;font-weight:700>+</span> <span style=color:#a5d6ff>1</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>return</span> {
</span></span><span style=display:flex><span>            <span style=color:#a5d6ff>&#39;target&#39;</span>: self<span style=color:#ff7b72;font-weight:700>.</span>target,
</span></span><span style=display:flex><span>            <span style=color:#a5d6ff>&#39;total_vulnerabilities&#39;</span>: len(self<span style=color:#ff7b72;font-weight:700>.</span>vulnerabilities),
</span></span><span style=display:flex><span>            <span style=color:#a5d6ff>&#39;by_severity&#39;</span>: vuln_count,
</span></span><span style=display:flex><span>            <span style=color:#a5d6ff>&#39;vulnerabilities&#39;</span>: self<span style=color:#ff7b72;font-weight:700>.</span>vulnerabilities
</span></span><span style=display:flex><span>        }
</span></span></code></pre></td></tr></table></div></div><h2 id=å››å®‰å…¨ç¼–ç æœ€ä½³å®è·µ>å››ã€å®‰å…¨ç¼–ç æœ€ä½³å®è·µ<a hidden class=anchor aria-hidden=true href=#å››å®‰å…¨ç¼–ç æœ€ä½³å®è·µ>#</a></h2><h3 id=41-å¯†ç å®‰å…¨>4.1 å¯†ç å®‰å…¨<a hidden class=anchor aria-hidden=true href=#41-å¯†ç å®‰å…¨>#</a></h3><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 56
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 57
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 58
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 59
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 60
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 61
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 62
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 63
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 64
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 65
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 66
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 67
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 68
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 69
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 70
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 71
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 72
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 73
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 74
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 75
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 76
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 77
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 78
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 79
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 80
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 81
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 82
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 83
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 84
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 85
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 86
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 87
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 88
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 89
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 90
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 91
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 92
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 93
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 94
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 95
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 96
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 97
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 98
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 99
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">100
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">101
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">102
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">103
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">104
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">105
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">106
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">107
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">108
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">109
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">110
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">111
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">112
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">113
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">114
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">115
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">116
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">117
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">118
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">119
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">120
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">121
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">122
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">123
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">124
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">125
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">126
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">127
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">128
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">129
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">130
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">131
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">132
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">133
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">134
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">135
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">136
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">137
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">138
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">139
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">140
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">141
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">142
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">143
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">144
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">145
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">146
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">147
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#8b949e;font-style:italic># ========== å¯†ç å“ˆå¸Œä¸éªŒè¯ ==========</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>import</span> <span style=color:#ff7b72>bcrypt</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>import</span> <span style=color:#ff7b72>secrets</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>import</span> <span style=color:#ff7b72>hashlib</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>from</span> <span style=color:#ff7b72>typing</span> <span style=color:#ff7b72>import</span> Tuple
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>class</span> <span style=color:#f0883e;font-weight:700>PasswordSecurity</span>:
</span></span><span style=display:flex><span>    <span style=color:#a5d6ff>&#34;&#34;&#34;å¯†ç å®‰å…¨&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#d2a8ff;font-weight:700>@staticmethod</span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>hash_password</span>(password: str) <span style=color:#ff7b72;font-weight:700>-&gt;</span> str:
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;&#34;&#34;å“ˆå¸Œå¯†ç &#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># ç”Ÿæˆç›å€¼</span>
</span></span><span style=display:flex><span>        salt <span style=color:#ff7b72;font-weight:700>=</span> bcrypt<span style=color:#ff7b72;font-weight:700>.</span>gensalt(rounds<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>12</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># å“ˆå¸Œå¯†ç </span>
</span></span><span style=display:flex><span>        hashed <span style=color:#ff7b72;font-weight:700>=</span> bcrypt<span style=color:#ff7b72;font-weight:700>.</span>hashpw(password<span style=color:#ff7b72;font-weight:700>.</span>encode(<span style=color:#a5d6ff>&#39;utf-8&#39;</span>), salt)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>return</span> hashed<span style=color:#ff7b72;font-weight:700>.</span>decode(<span style=color:#a5d6ff>&#39;utf-8&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#d2a8ff;font-weight:700>@staticmethod</span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>verify_password</span>(password: str, hashed: str) <span style=color:#ff7b72;font-weight:700>-&gt;</span> bool:
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;&#34;&#34;éªŒè¯å¯†ç &#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>try</span>:
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>return</span> bcrypt<span style=color:#ff7b72;font-weight:700>.</span>checkpw(
</span></span><span style=display:flex><span>                password<span style=color:#ff7b72;font-weight:700>.</span>encode(<span style=color:#a5d6ff>&#39;utf-8&#39;</span>),
</span></span><span style=display:flex><span>                hashed<span style=color:#ff7b72;font-weight:700>.</span>encode(<span style=color:#a5d6ff>&#39;utf-8&#39;</span>)
</span></span><span style=display:flex><span>            )
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>except</span> <span style=color:#f0883e;font-weight:700>Exception</span>:
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>return</span> <span style=color:#79c0ff>False</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#d2a8ff;font-weight:700>@staticmethod</span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>validate_password_strength</span>(password: str) <span style=color:#ff7b72;font-weight:700>-&gt;</span> Tuple[bool, list]:
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;&#34;&#34;éªŒè¯å¯†ç å¼ºåº¦&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        errors <span style=color:#ff7b72;font-weight:700>=</span> []
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># é•¿åº¦æ£€æŸ¥</span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>if</span> len(password) <span style=color:#ff7b72;font-weight:700>&lt;</span> <span style=color:#a5d6ff>8</span>:
</span></span><span style=display:flex><span>            errors<span style=color:#ff7b72;font-weight:700>.</span>append(<span style=color:#a5d6ff>&#34;å¯†ç é•¿åº¦è‡³å°‘8ä½&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>if</span> len(password) <span style=color:#ff7b72;font-weight:700>&gt;</span> <span style=color:#a5d6ff>128</span>:
</span></span><span style=display:flex><span>            errors<span style=color:#ff7b72;font-weight:700>.</span>append(<span style=color:#a5d6ff>&#34;å¯†ç é•¿åº¦ä¸è¶…è¿‡128ä½&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># å¤æ‚åº¦æ£€æŸ¥</span>
</span></span><span style=display:flex><span>        has_upper <span style=color:#ff7b72;font-weight:700>=</span> any(c<span style=color:#ff7b72;font-weight:700>.</span>isupper() <span style=color:#ff7b72>for</span> c <span style=color:#ff7b72;font-weight:700>in</span> password)
</span></span><span style=display:flex><span>        has_lower <span style=color:#ff7b72;font-weight:700>=</span> any(c<span style=color:#ff7b72;font-weight:700>.</span>islower() <span style=color:#ff7b72>for</span> c <span style=color:#ff7b72;font-weight:700>in</span> password)
</span></span><span style=display:flex><span>        has_digit <span style=color:#ff7b72;font-weight:700>=</span> any(c<span style=color:#ff7b72;font-weight:700>.</span>isdigit() <span style=color:#ff7b72>for</span> c <span style=color:#ff7b72;font-weight:700>in</span> password)
</span></span><span style=display:flex><span>        has_special <span style=color:#ff7b72;font-weight:700>=</span> any(c <span style=color:#ff7b72;font-weight:700>in</span> <span style=color:#a5d6ff>&#34;!@#$%^&amp;*()_+-=[]</span><span style=color:#a5d6ff>{}</span><span style=color:#a5d6ff>|;:,.&lt;&gt;?&#34;</span> <span style=color:#ff7b72>for</span> c <span style=color:#ff7b72;font-weight:700>in</span> password)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>if</span> <span style=color:#ff7b72;font-weight:700>not</span> (has_upper <span style=color:#ff7b72;font-weight:700>and</span> has_lower):
</span></span><span style=display:flex><span>            errors<span style=color:#ff7b72;font-weight:700>.</span>append(<span style=color:#a5d6ff>&#34;å¯†ç å¿…é¡»åŒ…å«å¤§å°å†™å­—æ¯&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>if</span> <span style=color:#ff7b72;font-weight:700>not</span> has_digit:
</span></span><span style=display:flex><span>            errors<span style=color:#ff7b72;font-weight:700>.</span>append(<span style=color:#a5d6ff>&#34;å¯†ç å¿…é¡»åŒ…å«æ•°å­—&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>if</span> <span style=color:#ff7b72;font-weight:700>not</span> has_special:
</span></span><span style=display:flex><span>            errors<span style=color:#ff7b72;font-weight:700>.</span>append(<span style=color:#a5d6ff>&#34;å¯†ç å¿…é¡»åŒ…å«ç‰¹æ®Šå­—ç¬¦&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># å¸¸è§å¼±å¯†ç æ£€æŸ¥</span>
</span></span><span style=display:flex><span>        common_passwords <span style=color:#ff7b72;font-weight:700>=</span> [
</span></span><span style=display:flex><span>            <span style=color:#a5d6ff>&#39;password&#39;</span>, <span style=color:#a5d6ff>&#39;12345678&#39;</span>, <span style=color:#a5d6ff>&#39;qwerty&#39;</span>, <span style=color:#a5d6ff>&#39;abc123&#39;</span>,
</span></span><span style=display:flex><span>            <span style=color:#a5d6ff>&#39;admin&#39;</span>, <span style=color:#a5d6ff>&#39;welcome&#39;</span>, <span style=color:#a5d6ff>&#39;password123&#39;</span>
</span></span><span style=display:flex><span>        ]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>if</span> password<span style=color:#ff7b72;font-weight:700>.</span>lower() <span style=color:#ff7b72;font-weight:700>in</span> common_passwords:
</span></span><span style=display:flex><span>            errors<span style=color:#ff7b72;font-weight:700>.</span>append(<span style=color:#a5d6ff>&#34;å¯†ç è¿‡äºå¸¸è§&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>return</span> len(errors) <span style=color:#ff7b72;font-weight:700>==</span> <span style=color:#a5d6ff>0</span>, errors
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#d2a8ff;font-weight:700>@staticmethod</span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>generate_reset_token</span>() <span style=color:#ff7b72;font-weight:700>-&gt;</span> str:
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;&#34;&#34;ç”Ÿæˆå¯†ç é‡ç½®ä»¤ç‰Œ&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>return</span> secrets<span style=color:#ff7b72;font-weight:700>.</span>token_urlsafe(<span style=color:#a5d6ff>32</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#d2a8ff;font-weight:700>@staticmethod</span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>hash_reset_token</span>(token: str) <span style=color:#ff7b72;font-weight:700>-&gt;</span> str:
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;&#34;&#34;å“ˆå¸Œé‡ç½®ä»¤ç‰Œç”¨äºå­˜å‚¨&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>return</span> hashlib<span style=color:#ff7b72;font-weight:700>.</span>sha256(token<span style=color:#ff7b72;font-weight:700>.</span>encode())<span style=color:#ff7b72;font-weight:700>.</span>hexdigest()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic># ========== å¯†ç ç­–ç•¥ ==========</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>class</span> <span style=color:#f0883e;font-weight:700>PasswordPolicy</span>:
</span></span><span style=display:flex><span>    <span style=color:#a5d6ff>&#34;&#34;&#34;å¯†ç ç­–ç•¥&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>__init__</span>(
</span></span><span style=display:flex><span>        self,
</span></span><span style=display:flex><span>        min_length: int <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>8</span>,
</span></span><span style=display:flex><span>        max_length: int <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>128</span>,
</span></span><span style=display:flex><span>        require_uppercase: bool <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#79c0ff>True</span>,
</span></span><span style=display:flex><span>        require_lowercase: bool <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#79c0ff>True</span>,
</span></span><span style=display:flex><span>        require_digit: bool <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#79c0ff>True</span>,
</span></span><span style=display:flex><span>        require_special: bool <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#79c0ff>True</span>,
</span></span><span style=display:flex><span>        expire_days: int <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>90</span>,
</span></span><span style=display:flex><span>        prevent_reuse: int <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>5</span>
</span></span><span style=display:flex><span>    ):
</span></span><span style=display:flex><span>        self<span style=color:#ff7b72;font-weight:700>.</span>min_length <span style=color:#ff7b72;font-weight:700>=</span> min_length
</span></span><span style=display:flex><span>        self<span style=color:#ff7b72;font-weight:700>.</span>max_length <span style=color:#ff7b72;font-weight:700>=</span> max_length
</span></span><span style=display:flex><span>        self<span style=color:#ff7b72;font-weight:700>.</span>require_uppercase <span style=color:#ff7b72;font-weight:700>=</span> require_uppercase
</span></span><span style=display:flex><span>        self<span style=color:#ff7b72;font-weight:700>.</span>require_lowercase <span style=color:#ff7b72;font-weight:700>=</span> require_lowercase
</span></span><span style=display:flex><span>        self<span style=color:#ff7b72;font-weight:700>.</span>require_digit <span style=color:#ff7b72;font-weight:700>=</span> require_digit
</span></span><span style=display:flex><span>        self<span style=color:#ff7b72;font-weight:700>.</span>require_special <span style=color:#ff7b72;font-weight:700>=</span> require_special
</span></span><span style=display:flex><span>        self<span style=color:#ff7b72;font-weight:700>.</span>expire_days <span style=color:#ff7b72;font-weight:700>=</span> expire_days
</span></span><span style=display:flex><span>        self<span style=color:#ff7b72;font-weight:700>.</span>prevent_reuse <span style=color:#ff7b72;font-weight:700>=</span> prevent_reuse
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>validate</span>(self, password: str, user_history: list <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#79c0ff>None</span>) <span style=color:#ff7b72;font-weight:700>-&gt;</span> Tuple[bool, list]:
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;&#34;&#34;éªŒè¯å¯†ç &#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        errors <span style=color:#ff7b72;font-weight:700>=</span> []
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># é•¿åº¦</span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>if</span> len(password) <span style=color:#ff7b72;font-weight:700>&lt;</span> self<span style=color:#ff7b72;font-weight:700>.</span>min_length:
</span></span><span style=display:flex><span>            errors<span style=color:#ff7b72;font-weight:700>.</span>append(<span style=color:#79c0ff>f</span><span style=color:#a5d6ff>&#34;å¯†ç é•¿åº¦è‡³å°‘</span><span style=color:#a5d6ff>{</span>self<span style=color:#ff7b72;font-weight:700>.</span>min_length<span style=color:#a5d6ff>}</span><span style=color:#a5d6ff>ä½&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>if</span> len(password) <span style=color:#ff7b72;font-weight:700>&gt;</span> self<span style=color:#ff7b72;font-weight:700>.</span>max_length:
</span></span><span style=display:flex><span>            errors<span style=color:#ff7b72;font-weight:700>.</span>append(<span style=color:#79c0ff>f</span><span style=color:#a5d6ff>&#34;å¯†ç é•¿åº¦ä¸è¶…è¿‡</span><span style=color:#a5d6ff>{</span>self<span style=color:#ff7b72;font-weight:700>.</span>max_length<span style=color:#a5d6ff>}</span><span style=color:#a5d6ff>ä½&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># å¤æ‚åº¦</span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>if</span> self<span style=color:#ff7b72;font-weight:700>.</span>require_uppercase <span style=color:#ff7b72;font-weight:700>and</span> <span style=color:#ff7b72;font-weight:700>not</span> any(c<span style=color:#ff7b72;font-weight:700>.</span>isupper() <span style=color:#ff7b72>for</span> c <span style=color:#ff7b72;font-weight:700>in</span> password):
</span></span><span style=display:flex><span>            errors<span style=color:#ff7b72;font-weight:700>.</span>append(<span style=color:#a5d6ff>&#34;å¯†ç å¿…é¡»åŒ…å«å¤§å†™å­—æ¯&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>if</span> self<span style=color:#ff7b72;font-weight:700>.</span>require_lowercase <span style=color:#ff7b72;font-weight:700>and</span> <span style=color:#ff7b72;font-weight:700>not</span> any(c<span style=color:#ff7b72;font-weight:700>.</span>islower() <span style=color:#ff7b72>for</span> c <span style=color:#ff7b72;font-weight:700>in</span> password):
</span></span><span style=display:flex><span>            errors<span style=color:#ff7b72;font-weight:700>.</span>append(<span style=color:#a5d6ff>&#34;å¯†ç å¿…é¡»åŒ…å«å°å†™å­—æ¯&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>if</span> self<span style=color:#ff7b72;font-weight:700>.</span>require_digit <span style=color:#ff7b72;font-weight:700>and</span> <span style=color:#ff7b72;font-weight:700>not</span> any(c<span style=color:#ff7b72;font-weight:700>.</span>isdigit() <span style=color:#ff7b72>for</span> c <span style=color:#ff7b72;font-weight:700>in</span> password):
</span></span><span style=display:flex><span>            errors<span style=color:#ff7b72;font-weight:700>.</span>append(<span style=color:#a5d6ff>&#34;å¯†ç å¿…é¡»åŒ…å«æ•°å­—&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>if</span> self<span style=color:#ff7b72;font-weight:700>.</span>require_special <span style=color:#ff7b72;font-weight:700>and</span> <span style=color:#ff7b72;font-weight:700>not</span> any(
</span></span><span style=display:flex><span>            c <span style=color:#ff7b72;font-weight:700>in</span> <span style=color:#a5d6ff>&#34;!@#$%^&amp;*()_+-=[]</span><span style=color:#a5d6ff>{}</span><span style=color:#a5d6ff>|;:,.&lt;&gt;?&#34;</span> <span style=color:#ff7b72>for</span> c <span style=color:#ff7b72;font-weight:700>in</span> password
</span></span><span style=display:flex><span>        ):
</span></span><span style=display:flex><span>            errors<span style=color:#ff7b72;font-weight:700>.</span>append(<span style=color:#a5d6ff>&#34;å¯†ç å¿…é¡»åŒ…å«ç‰¹æ®Šå­—ç¬¦&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># å†å²å¯†ç æ£€æŸ¥</span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>if</span> user_history <span style=color:#ff7b72;font-weight:700>and</span> self<span style=color:#ff7b72;font-weight:700>.</span>prevent_reuse:
</span></span><span style=display:flex><span>            recent_passwords <span style=color:#ff7b72;font-weight:700>=</span> user_history[:self<span style=color:#ff7b72;font-weight:700>.</span>prevent_reuse]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>for</span> old_hashed <span style=color:#ff7b72;font-weight:700>in</span> recent_passwords:
</span></span><span style=display:flex><span>                <span style=color:#ff7b72>if</span> PasswordSecurity<span style=color:#ff7b72;font-weight:700>.</span>verify_password(password, old_hashed):
</span></span><span style=display:flex><span>                    errors<span style=color:#ff7b72;font-weight:700>.</span>append(<span style=color:#79c0ff>f</span><span style=color:#a5d6ff>&#34;ä¸èƒ½ä½¿ç”¨æœ€è¿‘</span><span style=color:#a5d6ff>{</span>self<span style=color:#ff7b72;font-weight:700>.</span>prevent_reuse<span style=color:#a5d6ff>}</span><span style=color:#a5d6ff>æ¬¡ä½¿ç”¨è¿‡çš„å¯†ç &#34;</span>)
</span></span><span style=display:flex><span>                    <span style=color:#ff7b72>break</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>return</span> len(errors) <span style=color:#ff7b72;font-weight:700>==</span> <span style=color:#a5d6ff>0</span>, errors
</span></span></code></pre></td></tr></table></div></div><h3 id=42-æ•æ„Ÿæ•°æ®ä¿æŠ¤>4.2 æ•æ„Ÿæ•°æ®ä¿æŠ¤<a hidden class=anchor aria-hidden=true href=#42-æ•æ„Ÿæ•°æ®ä¿æŠ¤>#</a></h3><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">  9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 56
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 57
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 58
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 59
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 60
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 61
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 62
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 63
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 64
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 65
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 66
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 67
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 68
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 69
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 70
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 71
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 72
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 73
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 74
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 75
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 76
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 77
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 78
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 79
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 80
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 81
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 82
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 83
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 84
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 85
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 86
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 87
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 88
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 89
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 90
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 91
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 92
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 93
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 94
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 95
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 96
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 97
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 98
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 99
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">100
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">101
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">102
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">103
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">104
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">105
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">106
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">107
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">108
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">109
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">110
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">111
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">112
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">113
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">114
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">115
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">116
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">117
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">118
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">119
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">120
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">121
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">122
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">123
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">124
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">125
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">126
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">127
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">128
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">129
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">130
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">131
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">132
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">133
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">134
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">135
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">136
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">137
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">138
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">139
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">140
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">141
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">142
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">143
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">144
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">145
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">146
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">147
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">148
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">149
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">150
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">151
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#8b949e;font-style:italic># ========== æ•æ„Ÿæ•°æ®åŠ å¯† ==========</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>from</span> <span style=color:#ff7b72>cryptography.fernet</span> <span style=color:#ff7b72>import</span> Fernet
</span></span><span style=display:flex><span><span style=color:#ff7b72>from</span> <span style=color:#ff7b72>cryptography.hazmat.primitives</span> <span style=color:#ff7b72>import</span> hashes
</span></span><span style=display:flex><span><span style=color:#ff7b72>from</span> <span style=color:#ff7b72>cryptography.hazmat.primitives.kdf.pbkdf2</span> <span style=color:#ff7b72>import</span> PBKDF2
</span></span><span style=display:flex><span><span style=color:#ff7b72>import</span> <span style=color:#ff7b72>os</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>import</span> <span style=color:#ff7b72>base64</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>from</span> <span style=color:#ff7b72>typing</span> <span style=color:#ff7b72>import</span> Any
</span></span><span style=display:flex><span><span style=color:#ff7b72>import</span> <span style=color:#ff7b72>json</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>class</span> <span style=color:#f0883e;font-weight:700>DataEncryption</span>:
</span></span><span style=display:flex><span>    <span style=color:#a5d6ff>&#34;&#34;&#34;æ•°æ®åŠ å¯†&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#d2a8ff;font-weight:700>@staticmethod</span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>generate_key</span>() <span style=color:#ff7b72;font-weight:700>-&gt;</span> bytes:
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;&#34;&#34;ç”ŸæˆåŠ å¯†å¯†é’¥&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>return</span> Fernet<span style=color:#ff7b72;font-weight:700>.</span>generate_key()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#d2a8ff;font-weight:700>@staticmethod</span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>encrypt_data</span>(data: str, key: bytes) <span style=color:#ff7b72;font-weight:700>-&gt;</span> str:
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;&#34;&#34;åŠ å¯†æ•°æ®&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>        f <span style=color:#ff7b72;font-weight:700>=</span> Fernet(key)
</span></span><span style=display:flex><span>        encrypted <span style=color:#ff7b72;font-weight:700>=</span> f<span style=color:#ff7b72;font-weight:700>.</span>encrypt(data<span style=color:#ff7b72;font-weight:700>.</span>encode())
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>return</span> base64<span style=color:#ff7b72;font-weight:700>.</span>b64encode(encrypted)<span style=color:#ff7b72;font-weight:700>.</span>decode()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#d2a8ff;font-weight:700>@staticmethod</span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>decrypt_data</span>(encrypted_data: str, key: bytes) <span style=color:#ff7b72;font-weight:700>-&gt;</span> str:
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;&#34;&#34;è§£å¯†æ•°æ®&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>        f <span style=color:#ff7b72;font-weight:700>=</span> Fernet(key)
</span></span><span style=display:flex><span>        encrypted <span style=color:#ff7b72;font-weight:700>=</span> base64<span style=color:#ff7b72;font-weight:700>.</span>b64decode(encrypted_data<span style=color:#ff7b72;font-weight:700>.</span>encode())
</span></span><span style=display:flex><span>        decrypted <span style=color:#ff7b72;font-weight:700>=</span> f<span style=color:#ff7b72;font-weight:700>.</span>decrypt(encrypted)
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>return</span> decrypted<span style=color:#ff7b72;font-weight:700>.</span>decode()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#d2a8ff;font-weight:700>@staticmethod</span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>encrypt_dict</span>(data: dict, key: bytes) <span style=color:#ff7b72;font-weight:700>-&gt;</span> str:
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;&#34;&#34;åŠ å¯†å­—å…¸æ•°æ®&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>        json_str <span style=color:#ff7b72;font-weight:700>=</span> json<span style=color:#ff7b72;font-weight:700>.</span>dumps(data)
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>return</span> DataEncryption<span style=color:#ff7b72;font-weight:700>.</span>encrypt_data(json_str, key)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#d2a8ff;font-weight:700>@staticmethod</span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>decrypt_dict</span>(encrypted_data: str, key: bytes) <span style=color:#ff7b72;font-weight:700>-&gt;</span> dict:
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;&#34;&#34;è§£å¯†å­—å…¸æ•°æ®&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>        json_str <span style=color:#ff7b72;font-weight:700>=</span> DataEncryption<span style=color:#ff7b72;font-weight:700>.</span>decrypt_data(encrypted_data, key)
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>return</span> json<span style=color:#ff7b72;font-weight:700>.</span>loads(json_str)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>class</span> <span style=color:#f0883e;font-weight:700>SecureStorage</span>:
</span></span><span style=display:flex><span>    <span style=color:#a5d6ff>&#34;&#34;&#34;å®‰å…¨å­˜å‚¨&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>__init__</span>(self, encryption_key: bytes):
</span></span><span style=display:flex><span>        self<span style=color:#ff7b72;font-weight:700>.</span>encryption_key <span style=color:#ff7b72;font-weight:700>=</span> encryption_key
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>store_sensitive_data</span>(self, key: str, data: Any):
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;&#34;&#34;å­˜å‚¨æ•æ„Ÿæ•°æ®&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># åºåˆ—åŒ–æ•°æ®</span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>if</span> isinstance(data, dict):
</span></span><span style=display:flex><span>            encrypted <span style=color:#ff7b72;font-weight:700>=</span> DataEncryption<span style=color:#ff7b72;font-weight:700>.</span>encrypt_dict(data, self<span style=color:#ff7b72;font-weight:700>.</span>encryption_key)
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>else</span>:
</span></span><span style=display:flex><span>            encrypted <span style=color:#ff7b72;font-weight:700>=</span> DataEncryption<span style=color:#ff7b72;font-weight:700>.</span>encrypt_data(str(data), self<span style=color:#ff7b72;font-weight:700>.</span>encryption_key)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># å­˜å‚¨åˆ°æ•°æ®åº“æˆ–æ–‡ä»¶</span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># è¿™é‡Œç®€åŒ–ä¸ºå†…å­˜å­˜å‚¨</span>
</span></span><span style=display:flex><span>        self<span style=color:#ff7b72;font-weight:700>.</span>storage[key] <span style=color:#ff7b72;font-weight:700>=</span> encrypted
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>retrieve_sensitive_data</span>(self, key: str) <span style=color:#ff7b72;font-weight:700>-&gt;</span> Any:
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;&#34;&#34;æ£€ç´¢æ•æ„Ÿæ•°æ®&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        encrypted <span style=color:#ff7b72;font-weight:700>=</span> self<span style=color:#ff7b72;font-weight:700>.</span>storage<span style=color:#ff7b72;font-weight:700>.</span>get(key)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>if</span> <span style=color:#ff7b72;font-weight:700>not</span> encrypted:
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>return</span> <span style=color:#79c0ff>None</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic># å°è¯•è§£å¯†ä¸ºå­—å…¸</span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>try</span>:
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>return</span> DataEncryption<span style=color:#ff7b72;font-weight:700>.</span>decrypt_dict(encrypted, self<span style=color:#ff7b72;font-weight:700>.</span>encryption_key)
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>except</span>:
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>return</span> DataEncryption<span style=color:#ff7b72;font-weight:700>.</span>decrypt_data(encrypted, self<span style=color:#ff7b72;font-weight:700>.</span>encryption_key)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic># ========== æ—¥å¿—è„±æ• ==========</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>import</span> <span style=color:#ff7b72>re</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>class</span> <span style=color:#f0883e;font-weight:700>LogSanitizer</span>:
</span></span><span style=display:flex><span>    <span style=color:#a5d6ff>&#34;&#34;&#34;æ—¥å¿—è„±æ•&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8b949e;font-style:italic># æ•æ„Ÿä¿¡æ¯æ­£åˆ™æ¨¡å¼</span>
</span></span><span style=display:flex><span>    PATTERNS <span style=color:#ff7b72;font-weight:700>=</span> {
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#39;email&#39;</span>: <span style=color:#79c0ff>r</span><span style=color:#a5d6ff>&#39;\b[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Z|a-z]{2,}\b&#39;</span>,
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#39;phone&#39;</span>: <span style=color:#79c0ff>r</span><span style=color:#a5d6ff>&#39;\b1[3-9]\d</span><span style=color:#a5d6ff>{9}</span><span style=color:#a5d6ff>\b&#39;</span>,
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#39;id_card&#39;</span>: <span style=color:#79c0ff>r</span><span style=color:#a5d6ff>&#39;\b\d</span><span style=color:#a5d6ff>{17}</span><span style=color:#a5d6ff>[\dXx]\b&#39;</span>,
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#39;credit_card&#39;</span>: <span style=color:#79c0ff>r</span><span style=color:#a5d6ff>&#39;\b\d</span><span style=color:#a5d6ff>{4}</span><span style=color:#a5d6ff>[\s-]?\d</span><span style=color:#a5d6ff>{4}</span><span style=color:#a5d6ff>[\s-]?\d</span><span style=color:#a5d6ff>{4}</span><span style=color:#a5d6ff>[\s-]?\d</span><span style=color:#a5d6ff>{4}</span><span style=color:#a5d6ff>\b&#39;</span>,
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#39;password&#39;</span>: <span style=color:#79c0ff>r</span><span style=color:#a5d6ff>&#39;(password|pwd|passwd)\s*[=:]\s*\S+&#39;</span>,
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#39;token&#39;</span>: <span style=color:#79c0ff>r</span><span style=color:#a5d6ff>&#39;(token|api_key|secret)\s*[=:]\s*\S+&#39;</span>,
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#39;ip&#39;</span>: <span style=color:#79c0ff>r</span><span style=color:#a5d6ff>&#39;\b\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}\b&#39;</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#d2a8ff;font-weight:700>@classmethod</span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>sanitize</span>(cls, log_message: str) <span style=color:#ff7b72;font-weight:700>-&gt;</span> str:
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;&#34;&#34;è„±æ•æ—¥å¿—&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        sanitized <span style=color:#ff7b72;font-weight:700>=</span> log_message
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>for</span> pattern_type, pattern <span style=color:#ff7b72;font-weight:700>in</span> cls<span style=color:#ff7b72;font-weight:700>.</span>PATTERNS<span style=color:#ff7b72;font-weight:700>.</span>items():
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>if</span> pattern_type <span style=color:#ff7b72;font-weight:700>==</span> <span style=color:#a5d6ff>&#39;email&#39;</span>:
</span></span><span style=display:flex><span>                sanitized <span style=color:#ff7b72;font-weight:700>=</span> re<span style=color:#ff7b72;font-weight:700>.</span>sub(
</span></span><span style=display:flex><span>                    pattern,
</span></span><span style=display:flex><span>                    <span style=color:#ff7b72>lambda</span> m: <span style=color:#79c0ff>f</span><span style=color:#a5d6ff>&#34;</span><span style=color:#a5d6ff>{</span>m<span style=color:#ff7b72;font-weight:700>.</span>group(<span style=color:#a5d6ff>0</span>)[<span style=color:#a5d6ff>0</span>]<span style=color:#a5d6ff>}</span><span style=color:#a5d6ff>***@</span><span style=color:#a5d6ff>{</span>m<span style=color:#ff7b72;font-weight:700>.</span>group(<span style=color:#a5d6ff>0</span>)<span style=color:#ff7b72;font-weight:700>.</span>split(<span style=color:#a5d6ff>&#39;@&#39;</span>)[<span style=color:#a5d6ff>1</span>]<span style=color:#a5d6ff>}</span><span style=color:#a5d6ff>&#34;</span>,
</span></span><span style=display:flex><span>                    sanitized
</span></span><span style=display:flex><span>                )
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>elif</span> pattern_type <span style=color:#ff7b72;font-weight:700>==</span> <span style=color:#a5d6ff>&#39;phone&#39;</span>:
</span></span><span style=display:flex><span>                sanitized <span style=color:#ff7b72;font-weight:700>=</span> re<span style=color:#ff7b72;font-weight:700>.</span>sub(
</span></span><span style=display:flex><span>                    pattern,
</span></span><span style=display:flex><span>                    <span style=color:#ff7b72>lambda</span> m: <span style=color:#79c0ff>f</span><span style=color:#a5d6ff>&#34;</span><span style=color:#a5d6ff>{</span>m<span style=color:#ff7b72;font-weight:700>.</span>group(<span style=color:#a5d6ff>0</span>)[:<span style=color:#a5d6ff>3</span>]<span style=color:#a5d6ff>}</span><span style=color:#a5d6ff>****</span><span style=color:#a5d6ff>{</span>m<span style=color:#ff7b72;font-weight:700>.</span>group(<span style=color:#a5d6ff>0</span>)[<span style=color:#a5d6ff>7</span>:]<span style=color:#a5d6ff>}</span><span style=color:#a5d6ff>&#34;</span>,
</span></span><span style=display:flex><span>                    sanitized
</span></span><span style=display:flex><span>                )
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>elif</span> pattern_type <span style=color:#ff7b72;font-weight:700>==</span> <span style=color:#a5d6ff>&#39;id_card&#39;</span>:
</span></span><span style=display:flex><span>                sanitized <span style=color:#ff7b72;font-weight:700>=</span> re<span style=color:#ff7b72;font-weight:700>.</span>sub(
</span></span><span style=display:flex><span>                    pattern,
</span></span><span style=display:flex><span>                    <span style=color:#ff7b72>lambda</span> m: <span style=color:#79c0ff>f</span><span style=color:#a5d6ff>&#34;</span><span style=color:#a5d6ff>{</span>m<span style=color:#ff7b72;font-weight:700>.</span>group(<span style=color:#a5d6ff>0</span>)[:<span style=color:#a5d6ff>6</span>]<span style=color:#a5d6ff>}</span><span style=color:#a5d6ff>********</span><span style=color:#a5d6ff>{</span>m<span style=color:#ff7b72;font-weight:700>.</span>group(<span style=color:#a5d6ff>0</span>)[<span style=color:#a5d6ff>14</span>:]<span style=color:#a5d6ff>}</span><span style=color:#a5d6ff>&#34;</span>,
</span></span><span style=display:flex><span>                    sanitized
</span></span><span style=display:flex><span>                )
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>elif</span> pattern_type <span style=color:#ff7b72;font-weight:700>in</span> [<span style=color:#a5d6ff>&#39;password&#39;</span>, <span style=color:#a5d6ff>&#39;token&#39;</span>, <span style=color:#a5d6ff>&#39;credit_card&#39;</span>]:
</span></span><span style=display:flex><span>                sanitized <span style=color:#ff7b72;font-weight:700>=</span> re<span style=color:#ff7b72;font-weight:700>.</span>sub(
</span></span><span style=display:flex><span>                    pattern,
</span></span><span style=display:flex><span>                    <span style=color:#ff7b72>lambda</span> m: <span style=color:#79c0ff>f</span><span style=color:#a5d6ff>&#34;</span><span style=color:#a5d6ff>{</span>m<span style=color:#ff7b72;font-weight:700>.</span>group(<span style=color:#a5d6ff>0</span>)<span style=color:#ff7b72;font-weight:700>.</span>split(<span style=color:#a5d6ff>&#39;=&#39;</span>)[<span style=color:#a5d6ff>0</span>]<span style=color:#ff7b72;font-weight:700>.</span>split(<span style=color:#a5d6ff>&#39;:&#39;</span>)[<span style=color:#a5d6ff>0</span>]<span style=color:#a5d6ff>}</span><span style=color:#a5d6ff>=***&#34;</span>,
</span></span><span style=display:flex><span>                    sanitized
</span></span><span style=display:flex><span>                )
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>elif</span> pattern_type <span style=color:#ff7b72;font-weight:700>==</span> <span style=color:#a5d6ff>&#39;ip&#39;</span>:
</span></span><span style=display:flex><span>                sanitized <span style=color:#ff7b72;font-weight:700>=</span> re<span style=color:#ff7b72;font-weight:700>.</span>sub(
</span></span><span style=display:flex><span>                    pattern,
</span></span><span style=display:flex><span>                    <span style=color:#ff7b72>lambda</span> m: <span style=color:#79c0ff>f</span><span style=color:#a5d6ff>&#34;</span><span style=color:#a5d6ff>{</span>m<span style=color:#ff7b72;font-weight:700>.</span>group(<span style=color:#a5d6ff>0</span>)<span style=color:#ff7b72;font-weight:700>.</span>rsplit(<span style=color:#a5d6ff>&#39;.&#39;</span>, <span style=color:#a5d6ff>1</span>)[<span style=color:#a5d6ff>0</span>]<span style=color:#a5d6ff>}</span><span style=color:#a5d6ff>.*&#34;</span>,
</span></span><span style=display:flex><span>                    sanitized
</span></span><span style=display:flex><span>                )
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>return</span> sanitized
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#d2a8ff;font-weight:700>@classmethod</span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>sanitize_dict</span>(cls, data: dict) <span style=color:#ff7b72;font-weight:700>-&gt;</span> dict:
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;&#34;&#34;è„±æ•å­—å…¸æ•°æ®&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        sanitized <span style=color:#ff7b72;font-weight:700>=</span> {}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>for</span> key, value <span style=color:#ff7b72;font-weight:700>in</span> data<span style=color:#ff7b72;font-weight:700>.</span>items():
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>if</span> isinstance(value, str):
</span></span><span style=display:flex><span>                sanitized[key] <span style=color:#ff7b72;font-weight:700>=</span> cls<span style=color:#ff7b72;font-weight:700>.</span>sanitize(value)
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>elif</span> isinstance(value, dict):
</span></span><span style=display:flex><span>                sanitized[key] <span style=color:#ff7b72;font-weight:700>=</span> cls<span style=color:#ff7b72;font-weight:700>.</span>sanitize_dict(value)
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>else</span>:
</span></span><span style=display:flex><span>                sanitized[key] <span style=color:#ff7b72;font-weight:700>=</span> value
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>return</span> sanitized
</span></span></code></pre></td></tr></table></div></div><h2 id=æ€»ç»“>æ€»ç»“<a hidden class=anchor aria-hidden=true href=#æ€»ç»“>#</a></h2><p>ç½‘ç»œå®‰å…¨æ˜¯ä¸€ä¸ªæŒç»­çš„è¿‡ç¨‹ï¼Œéœ€è¦ï¼š</p><ol><li><strong>å®‰å…¨ç¼–ç </strong>ï¼šéµå¾ªå®‰å…¨ç¼–ç è§„èŒƒï¼Œä»æºå¤´å‡å°‘æ¼æ´</li><li><strong>å®šæœŸæµ‹è¯•</strong>ï¼šè¿›è¡Œæ¸—é€æµ‹è¯•å’Œæ¼æ´æ‰«æ</li><li><strong>å¤šå±‚é˜²å¾¡</strong>ï¼šå®æ–½çºµæ·±é˜²å¾¡ç­–ç•¥</li><li><strong>æŒç»­ç›‘æ§</strong>ï¼šå»ºç«‹å®‰å…¨ç›‘æ§å’Œå“åº”æœºåˆ¶</li><li><strong>å®‰å…¨åŸ¹è®­</strong>ï¼šæé«˜å›¢é˜Ÿå®‰å…¨æ„è¯†</li></ol><blockquote><p><strong>ç›¸å…³å·¥å…·æ¨è</strong></p><ul><li><a href=https://www.util.cn/tools/regex-tester/>æ­£åˆ™è¡¨è¾¾å¼æµ‹è¯•</a> - æ­£åˆ™æµ‹è¯•ä¸è°ƒè¯•</li><li><a href=https://www.util.cn/tools/base64-encode/>Base64ç¼–ç å·¥å…·</a> - ç¼–ç è½¬æ¢</li><li><a href=https://www.util.cn/tools/url-encode/>URLç¼–ç å·¥å…·</a> - URLå‚æ•°å¤„ç†</li></ul></blockquote></div><footer class=post-footer-modern><div class=post-tags-modern><span class=tags-label>ğŸ·ï¸ æ ‡ç­¾</span><div class=tags-list><a href=/blog/tags/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/ class=tag-pill>ç½‘ç»œå®‰å…¨
</a><a href=/blog/tags/%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/ class=tag-pill>æ¼æ´åˆ†æ
</a><a href=/blog/tags/owasp-top-10/ class=tag-pill>OWASP Top 10
</a><a href=/blog/tags/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/ class=tag-pill>æ¸—é€æµ‹è¯•
</a><a href=/blog/tags/%E5%AE%89%E5%85%A8%E7%BC%96%E7%A0%81/ class=tag-pill>å®‰å…¨ç¼–ç </a></div></div><style>.post-footer-modern{margin-top:3rem;padding-top:2rem;border-top:1px solid var(--border,#333333)}.post-tags-modern{display:flex;align-items:center;gap:1rem;margin-bottom:2rem;flex-wrap:wrap}.tags-label{font-size:.875rem;font-weight:600;color:var(--secondary,#999999) !important;white-space:nowrap}.tags-list{display:flex;flex-wrap:wrap;gap:.5rem;flex:1}.tag-pill{display:inline-block;padding:.25rem .75rem;background:rgba(255,255,255,5%);border:1px solid var(--border,#333333);border-radius:0;color:var(--secondary,#cccccc) !important;text-decoration:none;font-size:.8rem;font-weight:500;transition:all .2s ease}.tag-pill:hover{background:var(--primary,#ffffff);color:var(--background,#000000) !important;border-color:var(--primary,#ffffff);transform:translateY(-1px)}.post-nav-modern{margin-top:2rem}.nav-grid{display:grid;grid-template-columns:1fr 1fr;gap:1rem}.nav-card{display:flex;align-items:center;gap:1rem;padding:1.25rem;background:rgba(255,255,255,2%);border:1px solid var(--border,#333333);border-radius:12px;text-decoration:none;transition:all .2s ease;min-height:80px}.nav-card:hover{background:rgba(255,255,255,5%);border-color:var(--primary,#ffffff);transform:translateY(-2px)}.nav-card.nav-prev{justify-content:flex-start}.nav-card.nav-next{justify-content:flex-end;text-align:right}.nav-card.nav-next .nav-content{text-align:right}.nav-empty{display:flex;align-items:center;justify-content:center;background:rgba(255,255,255,1%);border:1px dashed var(--border,#333333);color:var(--secondary,#666666)}.nav-arrow{font-size:1.5rem;color:var(--primary,#ffffff);font-weight:300}.nav-content{flex:1}.nav-title{font-size:.95rem;font-weight:600;color:var(--primary,#ffffff) !important;line-height:1.4;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden}[data-theme=light] .post-footer-modern{border-color:var(--border-light,#dee2e6)}[data-theme=light] .tags-label{color:var(--secondary-light,#6c757d) !important}[data-theme=light] .tag-pill{background:rgba(0,0,0,5%);border-color:var(--border-light,#dee2e6);color:var(--secondary-light,#495057) !important}[data-theme=light] .tag-pill:hover{background:var(--primary-light,#0066cc);color:var(--background-light,#ffffff) !important;border-color:var(--primary-light,#0066cc)}[data-theme=light] .nav-card{background:rgba(0,0,0,2%);border-color:var(--border-light,#dee2e6)}[data-theme=light] .nav-card:hover{background:rgba(0,102,204,5%);border-color:var(--primary-light,#0066cc)}[data-theme=light] .nav-empty{background:rgba(0,0,0,1%);border-color:var(--border-light,#dee2e6);color:var(--secondary-light,#6c757d)}[data-theme=light] .nav-arrow{color:var(--primary-light,#0066cc)}[data-theme=light] .nav-title{color:var(--primary-light,#212529) !important}@media(max-width:768px){.nav-grid{grid-template-columns:1fr;gap:.75rem}.nav-card{padding:1rem;min-height:70px}.nav-card.nav-next{text-align:left}.nav-card.nav-next .nav-content{text-align:left}.nav-title{font-size:.875rem}.post-tags-modern{flex-direction:column;gap:.75rem}}@media(max-width:480px){.nav-arrow{font-size:1.25rem}.nav-card{padding:.875rem}.nav-title{font-size:.8rem;-webkit-line-clamp:1}}</style><nav class=post-nav-modern><div class=nav-grid><a href=/blog/articles/devops%E4%B8%8Eci/cd%E5%AE%8C%E5%85%A8%E6%8C%87%E5%8D%97%E6%9E%84%E5%BB%BA%E9%AB%98%E6%95%88%E7%9A%84%E8%BD%AF%E4%BB%B6%E4%BA%A4%E4%BB%98%E6%B5%81%E6%B0%B4%E7%BA%BF/ class="nav-card nav-prev"><div class=nav-arrow>â†</div><div class=nav-content><div class=nav-title>DevOpsä¸CI/CDå®Œå…¨æŒ‡å—ï¼šæ„å»ºé«˜æ•ˆçš„è½¯ä»¶äº¤ä»˜æµæ°´çº¿</div></div></a><a href=/blog/articles/%E6%95%B0%E6%8D%AE%E5%BA%93%E4%BC%98%E5%8C%96%E4%B8%8E%E5%88%86%E5%B8%83%E5%BC%8F%E5%AD%98%E5%82%A8%E6%9E%84%E5%BB%BA%E9%AB%98%E6%80%A7%E8%83%BD%E6%95%B0%E6%8D%AE%E6%9E%B6%E6%9E%84/ class="nav-card nav-next"><div class=nav-content><div class=nav-title>æ•°æ®åº“ä¼˜åŒ–ä¸åˆ†å¸ƒå¼å­˜å‚¨ï¼šæ„å»ºé«˜æ€§èƒ½æ•°æ®æ¶æ„</div></div><div class=nav-arrow>â†’</div></a></div></nav></footer></main><aside class=post-sidebar><div class=sidebar-toc id=sidebar-toc><div class=toc-header><div class=toc-title>ç›®å½•</div><button class=toc-toggle id=toc-toggle aria-label="Toggle TOC">
<svg class="toc-toggle-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 6 6 18M6 6l12 12"/></svg></button></div><div class=toc-content id=toc-content><ul class=toc-list><li class="toc-item toc-h2"><a href=#h2-0 class=toc-item-link><span class=toc-item-text>å¼•è¨€</span></a></li><li class="toc-item toc-h2"><a href=#h2-1 class=toc-item-link><span class=toc-item-text>ä¸€ã€OWASP Top 10æ·±åº¦è§£æ</span></a></li><li class="toc-item toc-h2"><a href=#h2-2 class=toc-item-link><span class=toc-item-text>äºŒã€å…¶ä»–å¸¸è§Webæ¼æ´</span></a></li><li class="toc-item toc-h2"><a href=#h2-3 class=toc-item-link><span class=toc-item-text>ä¸‰ã€æ¸—é€æµ‹è¯•ä¸æ¼æ´æŒ–æ˜</span></a></li><li class="toc-item toc-h2"><a href=#h2-4 class=toc-item-link><span class=toc-item-text>å››ã€å®‰å…¨ç¼–ç æœ€ä½³å®è·µ</span></a></li><li class="toc-item toc-h2"><a href=#h2-5 class=toc-item-link><span class=toc-item-text>æ€»ç»“</span></a></li></ul></div></div><script>document.addEventListener("DOMContentLoaded",function(){const e=document.getElementById("sidebar-toc"),t=document.getElementById("toc-toggle"),o=document.getElementById("toc-content"),i=t?.querySelector(".toc-toggle-icon");if(!e)return;let n=!1;t&&t.addEventListener("click",function(){n=!n,n?(o.style.display="none",e.style.width="auto",i.innerHTML='<path d="M9 18l6-6-6-6"/>'):(o.style.display="block",e.style.width="200px",i.innerHTML='<path d="M18 6L6 18M6 6l12 12"/>')});const s=document.querySelector(".post-content");if(s){const e=s.querySelectorAll("h1");e.forEach((e,t)=>{e.id=`h1-${t}`});const t=s.querySelectorAll("h2");t.forEach((e,t)=>{e.id=`h2-${t}`})}const a=document.querySelectorAll(".toc-item-link");a.forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();const n=this.getAttribute("href").substring(1),t=document.getElementById(n);if(t){const e=document.querySelector(".post-header-main")?.offsetHeight||0,n=t.offsetTop-e-20;window.scrollTo({top:n,behavior:"smooth"})}})})})</script><style>.sidebar-toc{position:sticky;top:2rem;width:200px;background:#fff;border:1px solid #e5e7eb;border-radius:4px;overflow:hidden;box-shadow:0 1px 3px rgba(0,0,0,.1);z-index:100}.sidebar-toc.hidden{display:none}.toc-header{padding:12px 16px;border-bottom:1px solid #e5e7eb;background:#fafbfc;display:flex;align-items:center;justify-content:space-between}.toc-title{margin:0;font-size:13px;font-weight:500;color:#374151 !important;font-family:-apple-system,BlinkMacSystemFont,segoe ui,Roboto,sans-serif;text-transform:uppercase;letter-spacing:1px}.toc-toggle{background:0 0;border:none;cursor:pointer;padding:4px;border-radius:4px;display:flex;align-items:center;justify-content:center;transition:all .2s ease;color:#6b7280}.toc-toggle:hover{background:#e5e7eb;color:#374151}.toc-toggle-icon{transition:transform .2s ease}.toc-content{padding:12px 0}.toc-list{list-style:none;margin:0;padding:0}.toc-item{margin-bottom:4px;display:block !important;visibility:visible !important}.toc-h1,.toc-h2{display:block !important}.toc-h2{margin-left:0}.toc-item-link{display:flex;align-items:center;gap:8px;padding:8px 12px;color:#374151 !important;text-decoration:none;font-size:13px;line-height:1.4;border-radius:3px;transition:all .2s ease;font-weight:400}.toc-item-link:hover{background:#f8fafc;color:#1f2937 !important}.toc-item-link.active{background:#e0f2fe;color:#01579b !important;font-weight:500}.toc-dot{width:8px;height:8px;border-radius:50%;flex-shrink:0}.dot-red{background:#ef4444}.dot-blue{background:#2196f3}.toc-item-text{color:#1f2937 !important;font-weight:400;flex:1;display:inline !important;visibility:visible !important;opacity:1 !important;font-size:13px !important;line-height:1.4 !important}.toc-item-link .toc-item-text{color:#1f2937 !important;display:inline !important;visibility:visible !important;opacity:1 !important}.toc-item.active .dot-red{background:#d32f2f}.toc-item.active .dot-blue{background:#1976d2}[data-theme=dark] .sidebar-toc{background:#1f2937;border-color:#374151;box-shadow:0 1px 3px rgba(0,0,0,.3)}[data-theme=dark] .toc-header{background:#111827;border-color:#374151}[data-theme=dark] .toc-title{color:#f3f4f6 !important}[data-theme=dark] .toc-toggle{color:#9ca3af}[data-theme=dark] .toc-toggle:hover{background:#374151;color:#f3f4f6}[data-theme=dark] .toc-item-link{color:#e5e7eb !important}[data-theme=dark] .toc-item-link:hover{background:#374151;color:#f9fafb !important}[data-theme=dark] .toc-item-link.active{background:#0d47a1;color:#fff !important}[data-theme=dark] .toc-item-text{color:#f9fafb !important;display:inline !important;visibility:visible !important;opacity:1 !important}[data-theme=dark] .toc-item-link .toc-item-text{color:#f9fafb !important;display:inline !important;visibility:visible !important;opacity:1 !important}@media(max-width:1024px){.sidebar-toc{display:none}.post-content-wrapper{grid-template-columns:1fr !important;padding:0 1rem !important}}</style><style>.post-content-wrapper{display:grid;grid-template-columns:1fr 200px;gap:2rem;padding:0 2rem;max-width:100%}.post-content-main{min-width:0}.post-sidebar{position:sticky;top:2rem;height:fit-content;min-width:0}.post-header-main{margin-bottom:2rem;padding-bottom:1rem;border-bottom:1px solid var(--border,#333333)}.post-header-main .post-title{color:var(--primary,#ffffff) !important;font-size:2.5rem;font-weight:700;line-height:1.2;margin-bottom:1rem}.post-header-main .post-description{color:var(--secondary,#cccccc) !important;font-size:1.1rem;line-height:1.6;margin-bottom:1rem}.post-header-main .post-meta{margin-bottom:0}@media(max-width:1024px){.post-content-wrapper{grid-template-columns:1fr !important;gap:1rem;padding:0 1rem !important}.post-sidebar{display:none}}@media(max-width:768px){.post-header-main .post-title{font-size:2rem}.post-header-main .post-description{font-size:1rem}}</style></aside></div></article></main><footer class=footer><span>Â© 2024-2025 æœ‰æ¡å·¥å…·æŠ€æœ¯åšå®¢</span> Â·</footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");if(menu){const e=localStorage.getItem("menu-scroll-position");e&&(menu.scrollLeft=parseInt(e,10)),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}}document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{const e=document.querySelector("html");e.dataset.theme==="dark"?(e.dataset.theme="light",localStorage.setItem("pref-theme","light")):(e.dataset.theme="dark",localStorage.setItem("pref-theme","dark"))})</script></body></html>