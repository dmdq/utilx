[{"content":"å‰ç«¯å¼€å‘è°ƒè¯•æ˜¯æ¯ä¸ªå¼€å‘è€…å¿…å¤‡çš„æ ¸å¿ƒæŠ€èƒ½ã€‚éšç€ç°ä»£Webåº”ç”¨çš„å¤æ‚æ€§ä¸æ–­å¢åŠ ï¼ŒæŒæ¡é«˜æ•ˆçš„è°ƒè¯•æŠ€å·§å˜å¾—è¶Šæ¥è¶Šé‡è¦ã€‚æœ¬æ–‡å°†å¸¦ä½ å…¨é¢äº†è§£ç°ä»£å‰ç«¯è°ƒè¯•çš„å„ç§æ–¹æ³•å’Œæœ€ä½³å®è·µã€‚\næµè§ˆå™¨å¼€å‘è€…å·¥å…·åŸºç¡€ Consoleé¢æ¿è¿›é˜¶æŠ€å·§ Consoleé¢æ¿ä¸ä»…ä»…æ˜¯console.log()çš„è¾“å‡ºçª—å£ï¼Œå®ƒè¿˜æä¾›äº†å¼ºå¤§çš„è°ƒè¯•åŠŸèƒ½ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 // æ¡ä»¶æ–­ç‚¹ console.debug(\u0026#39;Debug info\u0026#39;, data); // åˆ†ç»„è¾“å‡º console.group(\u0026#39;API Request\u0026#39;); console.log(\u0026#39;URL:\u0026#39;, url); console.log(\u0026#39;Method:\u0026#39;, method); console.groupEnd(); // æ€§èƒ½è®¡æ—¶ console.time(\u0026#39;API Call\u0026#39;); // ... ä»£ç æ‰§è¡Œ console.timeEnd(\u0026#39;API Call\u0026#39;); // è¡¨æ ¼åŒ–è¾“å‡º console.table(users, [\u0026#39;id\u0026#39;, \u0026#39;name\u0026#39;, \u0026#39;email\u0026#39;]); // æ–­è¨€è°ƒè¯• console.assert(condition, \u0026#39;Error message when condition is false\u0026#39;); Elementsé¢æ¿å®ç”¨åŠŸèƒ½ Elementsé¢æ¿æä¾›äº†ä¸°å¯Œçš„DOMæ“ä½œå’Œæ ·å¼æ£€æŸ¥åŠŸèƒ½ï¼š\nDOMæ–­ç‚¹ï¼šåœ¨DOMå˜åŒ–æ—¶è‡ªåŠ¨æš‚åœæ‰§è¡Œ æ ·å¼è¿½è¸ªï¼šå®æ—¶æŸ¥çœ‹CSSè®¡ç®—å€¼å’Œç»§æ‰¿å…³ç³» ç›’æ¨¡å‹å¯è§†åŒ–ï¼šç›´è§‚ç†è§£å…ƒç´ çš„å¸ƒå±€ç»“æ„ é«˜çº§è°ƒè¯•æŠ€å·§ Source Mapé…ç½®ä¸ä½¿ç”¨ æ­£ç¡®é…ç½®Source Mapå¯¹äºè°ƒè¯•ç”Ÿäº§ç¯å¢ƒçš„ä»£ç è‡³å…³é‡è¦ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 // webpack.config.js module.exports = { devtool: process.env.NODE_ENV === \u0026#39;production\u0026#39; ? \u0026#39;source-map\u0026#39; : \u0026#39;eval-source-map\u0026#39;, optimization: { minimize: true, minimizer: [ new TerserPlugin({ sourceMap: true, }), ], }, }; å¼‚æ­¥ä»£ç è°ƒè¯• å¤„ç†Promiseã€async/awaitç­‰å¼‚æ­¥ä»£ç æ—¶çš„è°ƒè¯•ç­–ç•¥ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 // ä½¿ç”¨console.assertéªŒè¯å¼‚æ­¥æ“ä½œ async function fetchData() { try { const response = await fetch(\u0026#39;/api/data\u0026#39;); const data = await response.json(); console.assert(data.success, \u0026#39;APIè¯·æ±‚å¤±è´¥:\u0026#39;, data); return data; } catch (error) { console.error(\u0026#39;å¼‚æ­¥æ“ä½œå‡ºé”™:\u0026#39;, error); throw error; } } // åœ¨DevToolsä¸­ä½¿ç”¨asyncæ–­ç‚¹è°ƒè¯• debugger; // è®¾ç½®æ–­ç‚¹ const result = await fetchData(); æ€§èƒ½è°ƒè¯•ä¸åˆ†æ Performanceé¢æ¿æ·±å…¥ä½¿ç”¨ Performanceé¢æ¿å¯ä»¥å¸®åŠ©æˆ‘ä»¬åˆ†æé¡µé¢æ€§èƒ½ç“¶é¢ˆï¼š\nå½•åˆ¶åˆ†æï¼šè®°å½•é¡µé¢åŠ è½½å’Œäº¤äº’è¿‡ç¨‹ ç«ç„°å›¾è§£è¯»ï¼šè¯†åˆ«CPUå¯†é›†å‹æ“ä½œ å†…å­˜æ³„æ¼æ£€æµ‹ï¼šç›‘æ§å†…å­˜ä½¿ç”¨æƒ…å†µ 1 2 3 4 5 6 7 8 9 10 // ä½¿ç”¨Performance APIè¿›è¡Œè‡ªå®šä¹‰æ€§èƒ½æ ‡è®° performance.mark(\u0026#39;fetchStart\u0026#39;); fetch(\u0026#39;/api/data\u0026#39;) .then(response =\u0026gt; response.json()) .then(data =\u0026gt; { performance.mark(\u0026#39;fetchEnd\u0026#39;); performance.measure(\u0026#39;fetchDuration\u0026#39;, \u0026#39;fetchStart\u0026#39;, \u0026#39;fetchEnd\u0026#39;); const measures = performance.getEntriesByName(\u0026#39;fetchDuration\u0026#39;); console.log(\u0026#39;Fetch duration:\u0026#39;, measures[0].duration); }); Networké¢æ¿ä¼˜åŒ–åˆ†æ Networké¢æ¿æä¾›äº†å…¨é¢çš„ç½‘ç»œè¯·æ±‚åˆ†æåŠŸèƒ½ï¼š\n1 2 3 4 5 6 7 8 // ä½¿ç”¨Resource Timing API const resources = performance.getEntriesByType(\u0026#39;resource\u0026#39;); resources.forEach(resource =\u0026gt; { console.log(`${resource.name}: ${resource.duration}ms`); console.log(\u0026#39;DNS lookup:\u0026#39;, resource.domainLookupEnd - resource.domainLookupStart); console.log(\u0026#39;TCP connection:\u0026#39;, resource.connectEnd - resource.connectStart); console.log(\u0026#39;Server response:\u0026#39;, resource.responseEnd - resource.requestStart); }); ç§»åŠ¨ç«¯è°ƒè¯• è¿œç¨‹è°ƒè¯•è®¾ç½® Androidå’ŒiOSè®¾å¤‡çš„è¿œç¨‹è°ƒè¯•é…ç½®ï¼š\nAndroidè°ƒè¯•ï¼šChrome DevTools + USBè°ƒè¯• iOSè°ƒè¯•ï¼šSafariå¼€å‘è€…å·¥å…· + USBè¿æ¥ æ¨¡æ‹Ÿå™¨è°ƒè¯•ï¼šä½¿ç”¨æµè§ˆå™¨è®¾å¤‡æ¨¡æ‹ŸåŠŸèƒ½ ç§»åŠ¨ç«¯ç‰¹æœ‰é—®é¢˜è°ƒè¯• ç§»åŠ¨è®¾å¤‡ä¸Šçš„å¸¸è§é—®é¢˜åŠè§£å†³æ–¹æ¡ˆï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 // æ£€æµ‹è®¾å¤‡ç‰¹æ€§ const isMobile = /Android|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent); // è§¦æ‘¸äº‹ä»¶è°ƒè¯• document.addEventListener(\u0026#39;touchstart\u0026#39;, (e) =\u0026gt; { console.log(\u0026#39;Touch start:\u0026#39;, e.touches); }, { passive: true }); // è§†å£å˜åŒ–ç›‘å¬ window.addEventListener(\u0026#39;resize\u0026#39;, () =\u0026gt; { console.log(\u0026#39;Viewport:\u0026#39;, { width: window.innerWidth, height: window.innerHeight, devicePixelRatio: window.devicePixelRatio }); }); æ¡†æ¶ç‰¹å®šè°ƒè¯• Reactè°ƒè¯•æŠ€å·§ Reactåº”ç”¨çš„ç‰¹æ®Šè°ƒè¯•æ–¹æ³•ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 // React DevToolsä½¿ç”¨ import { Profiler } from \u0026#39;react\u0026#39;; function onRenderCallback(id, phase, actualDuration) { console.log(\u0026#39;Component render:\u0026#39;, { id, phase, actualDuration }); } \u0026lt;Profiler id=\u0026#34;App\u0026#34; onRender={onRenderCallback}\u0026gt; \u0026lt;App /\u0026gt; \u0026lt;/Profiler\u0026gt; // ä½¿ç”¨Reacté”™è¯¯è¾¹ç•Œ class ErrorBoundary extends React.Component { constructor(props) { super(props); this.state = { hasError: false }; } static getDerivedStateFromError(error) { console.error(\u0026#39;React error boundary:\u0026#39;, error); return { hasError: true }; } } Vueè°ƒè¯•æŠ€å·§ Vueåº”ç”¨çš„è°ƒè¯•ç­–ç•¥ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 // Vue DevToolsé…ç½® Vue.config.devtools = process.env.NODE_ENV !== \u0026#39;production\u0026#39;; // å…¨å±€é”™è¯¯å¤„ç† Vue.config.errorHandler = (err, vm, info) =\u0026gt; { console.error(\u0026#39;Vue error:\u0026#39;, err); console.error(\u0026#39;Component:\u0026#39;, vm); console.error(\u0026#39;Info:\u0026#39;, info); }; // æ€§èƒ½è¿½è¸ª Vue.config.performance = true; è‡ªåŠ¨åŒ–è°ƒè¯•æµç¨‹ å•å…ƒæµ‹è¯•ä¸­çš„è°ƒè¯• å°†è°ƒè¯•é›†æˆåˆ°æµ‹è¯•æµç¨‹ä¸­ï¼š\n1 2 3 4 5 6 7 8 9 // Jestæµ‹è¯•ä¸­çš„è°ƒè¯• describe(\u0026#39;User component\u0026#39;, () =\u0026gt; { it(\u0026#39;should render correctly\u0026#39;, () =\u0026gt; { const wrapper = mount(UserComponent); console.log(\u0026#39;Component state:\u0026#39;, wrapper.state()); console.log(\u0026#39;Component props:\u0026#39;, wrapper.props()); expect(wrapper).toMatchSnapshot(); }); }); CI/CDä¸­çš„è°ƒè¯• æŒç»­é›†æˆç¯å¢ƒä¸‹çš„è°ƒè¯•ç­–ç•¥ï¼š\n1 2 3 4 5 6 7 8 9 // ä½¿ç”¨debugæ¨¡å— const debug = require(\u0026#39;debug\u0026#39;)(\u0026#39;app:api\u0026#39;); app.get(\u0026#39;/api/users\u0026#39;, (req, res) =\u0026gt; { debug(\u0026#39;Received request:\u0026#39;, req.query); // å¤„ç†é€»è¾‘ debug(\u0026#39;Sending response:\u0026#39;, users); res.json(users); }); è°ƒè¯•æœ€ä½³å®è·µ æ—¥å¿—ç®¡ç† å»ºç«‹æœ‰æ•ˆçš„æ—¥å¿—ç®¡ç†ä½“ç³»ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 // åˆ›å»ºè‡ªå®šä¹‰æ—¥å¿—å·¥å…· class Logger { static log(level, message, data) { const timestamp = new Date().toISOString(); const logEntry = { timestamp, level, message, data, url: window.location.href, userAgent: navigator.userAgent }; // å¼€å‘ç¯å¢ƒè¾“å‡ºåˆ°console if (process.env.NODE_ENV === \u0026#39;development\u0026#39;) { console[level](message, data); } // ç”Ÿäº§ç¯å¢ƒå‘é€åˆ°æ—¥å¿—æœåŠ¡ if (process.env.NODE_ENV === \u0026#39;production\u0026#39; \u0026amp;\u0026amp; level === \u0026#39;error\u0026#39;) { this.sendToLogService(logEntry); } } static error(message, error) { this.log(\u0026#39;error\u0026#39;, message, { stack: error.stack, name: error.name }); } } é”™è¯¯ç›‘æ§ å®ç°å…¨é¢çš„é”™è¯¯ç›‘æ§ä½“ç³»ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 // å…¨å±€é”™è¯¯æ•è· window.addEventListener(\u0026#39;error\u0026#39;, (event) =\u0026gt; { console.error(\u0026#39;Global error:\u0026#39;, { message: event.message, filename: event.filename, lineno: event.lineno, colno: event.colno, stack: event.error?.stack }); }); // Promiseé”™è¯¯æ•è· window.addEventListener(\u0026#39;unhandledrejection\u0026#39;, (event) =\u0026gt; { console.error(\u0026#39;Unhandled promise rejection:\u0026#39;, { reason: event.reason, stack: event.reason?.stack }); }); æ€»ç»“ ç°ä»£å‰ç«¯å¼€å‘è°ƒè¯•æ˜¯ä¸€ä¸ªç³»ç»Ÿæ€§å·¥ç¨‹ï¼Œéœ€è¦ç»“åˆå¤šç§å·¥å…·å’ŒæŠ€å·§ã€‚é€šè¿‡æŒæ¡è¿™äº›è°ƒè¯•æ–¹æ³•ï¼Œä½ å¯ä»¥ï¼š\næé«˜å¼€å‘æ•ˆç‡ï¼šå¿«é€Ÿå®šä½å’Œè§£å†³é—®é¢˜ ä¼˜åŒ–åº”ç”¨æ€§èƒ½ï¼šè¯†åˆ«å’Œæ¶ˆé™¤æ€§èƒ½ç“¶é¢ˆ æå‡ç”¨æˆ·ä½“éªŒï¼šç¡®ä¿åº”ç”¨åœ¨å„ç§è®¾å¤‡ä¸Šç¨³å®šè¿è¡Œ ç®€åŒ–ç»´æŠ¤å·¥ä½œï¼šå»ºç«‹æœ‰æ•ˆçš„é”™è¯¯ç›‘æ§å’Œæ—¥å¿—ä½“ç³» è®°ä½ï¼Œè°ƒè¯•ä¸ä»…ä»…æ˜¯æ‰¾é”™çš„è¿‡ç¨‹ï¼Œæ›´æ˜¯ç†è§£åº”ç”¨è¿è¡Œæœºåˆ¶çš„é‡è¦é€”å¾„ã€‚æŒç»­å­¦ä¹ å’Œå®è·µè¿™äº›æŠ€å·§ï¼Œå°†è®©ä½ æˆä¸ºä¸€ä¸ªæ›´åŠ é«˜æ•ˆçš„å‰ç«¯å¼€å‘è€…ã€‚\n","permalink":"/blog/articles/%E7%8E%B0%E4%BB%A3%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91%E8%B0%83%E8%AF%95%E6%8A%80%E5%B7%A7%E4%BB%8Econsole%E5%88%B0devtools%E7%9A%84%E5%AE%8C%E6%95%B4%E6%8C%87%E5%8D%97/","summary":"æ·±å…¥æ¢è®¨ç°ä»£å‰ç«¯å¼€å‘ä¸­çš„è°ƒè¯•æŠ€å·§ï¼ŒåŒ…æ‹¬æµè§ˆå™¨DevToolsé«˜çº§åŠŸèƒ½ã€Source Mapé…ç½®ã€æ–­ç‚¹è°ƒè¯•ã€æ€§èƒ½åˆ†æå’Œå¸¸è§é—®é¢˜æ’æŸ¥æ–¹æ³•ã€‚","title":"ç°ä»£å‰ç«¯å¼€å‘è°ƒè¯•æŠ€å·§ï¼šä»Consoleåˆ°DevToolsçš„å®Œæ•´æŒ‡å—"},{"content":"å¼•è¨€ Webæ— éšœç¢ï¼ˆAccessibilityï¼Œç®€ç§°A11yï¼‰ç¡®ä¿æ‰€æœ‰äººï¼Œæ— è®ºæ˜¯å¦æœ‰æ®‹ç–¾ï¼Œéƒ½èƒ½å¹³ç­‰è®¿é—®å’Œä½¿ç”¨Webå†…å®¹ã€‚æ®ä¸–ç•Œå«ç”Ÿç»„ç»‡ç»Ÿè®¡ï¼Œå…¨çƒè¶…è¿‡10äº¿äººæ‚£æœ‰æŸç§å½¢å¼çš„æ®‹ç–¾ã€‚ä½œä¸ºå¼€å‘è€…ï¼Œæˆ‘ä»¬æœ‰è´£ä»»åˆ›å»ºåŒ…å®¹æ€§åº”ç”¨ã€‚æœ¬æ–‡å°†æ·±å…¥æ¢è®¨Webæ— éšœç¢çš„å®ç°æ–¹æ³•ï¼Œè®©ä½ çš„åº”ç”¨æƒ åŠæ›´å¤šç”¨æˆ·ã€‚\nWCAGåŸåˆ™æ¦‚è¿° WCAGï¼ˆWeb Content Accessibility Guidelinesï¼‰æå‡ºäº†å››ä¸ªæ ¸å¿ƒåŸåˆ™ï¼Œç®€ç§°POURï¼š\n1. å¯æ„ŸçŸ¥ï¼ˆPerceivableï¼‰ ä¿¡æ¯å¿…é¡»ä»¥ç”¨æˆ·èƒ½å¤Ÿæ„ŸçŸ¥çš„æ–¹å¼å‘ˆç°ã€‚\n2. å¯æ“ä½œï¼ˆOperableï¼‰ ç•Œé¢ç»„ä»¶å¿…é¡»æ˜¯å¯æ“ä½œçš„ã€‚\n3. å¯ç†è§£ï¼ˆUnderstandableï¼‰ ä¿¡æ¯å’ŒUIæ“ä½œå¿…é¡»æ˜¯å¯ç†è§£çš„ã€‚\n4. ç¨³å¥ï¼ˆRobustï¼‰ å†…å®¹å¿…é¡»è¶³å¤Ÿå¥å£®ï¼Œèƒ½å¤Ÿè¢«å„ç§ç”¨æˆ·ä»£ç†ï¼ˆåŒ…æ‹¬è¾…åŠ©æŠ€æœ¯ï¼‰å¯é åœ°è§£æã€‚\nè¯­ä¹‰åŒ–HTMLåŸºç¡€ ä½¿ç”¨æ­£ç¡®çš„HTMLå…ƒç´  1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 \u0026lt;!-- âŒ ä¸å¥½çš„å®è·µ --\u0026gt; \u0026lt;div class=\u0026#34;header\u0026#34;\u0026gt; \u0026lt;div class=\u0026#34;nav-item\u0026#34;\u0026gt;é¦–é¡µ\u0026lt;/div\u0026gt; \u0026lt;div class=\u0026#34;nav-item\u0026#34;\u0026gt;å…³äº\u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;div class=\u0026#34;article\u0026#34;\u0026gt; \u0026lt;div class=\u0026#34;title\u0026#34;\u0026gt;æ–‡ç« æ ‡é¢˜\u0026lt;/div\u0026gt; \u0026lt;div class=\u0026#34;content\u0026#34;\u0026gt;æ–‡ç« å†…å®¹...\u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;!-- âœ… å¥½çš„å®è·µ --\u0026gt; \u0026lt;header\u0026gt; \u0026lt;nav\u0026gt; \u0026lt;a href=\u0026#34;/\u0026#34;\u0026gt;é¦–é¡µ\u0026lt;/a\u0026gt; \u0026lt;a href=\u0026#34;/about\u0026#34;\u0026gt;å…³äº\u0026lt;/a\u0026gt; \u0026lt;/nav\u0026gt; \u0026lt;/header\u0026gt; \u0026lt;main\u0026gt; \u0026lt;article\u0026gt; \u0026lt;h1\u0026gt;æ–‡ç« æ ‡é¢˜\u0026lt;/h1\u0026gt; \u0026lt;p\u0026gt;æ–‡ç« å†…å®¹...\u0026lt;/p\u0026gt; \u0026lt;/article\u0026gt; \u0026lt;/main\u0026gt; è¡¨å•è¯­ä¹‰åŒ– 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 \u0026lt;form method=\u0026#34;post\u0026#34; action=\u0026#34;/submit\u0026#34;\u0026gt; \u0026lt;fieldset\u0026gt; \u0026lt;legend\u0026gt;ç”¨æˆ·ä¿¡æ¯\u0026lt;/legend\u0026gt; \u0026lt;div class=\u0026#34;form-group\u0026#34;\u0026gt; \u0026lt;label for=\u0026#34;name\u0026#34;\u0026gt; å§“å \u0026lt;span class=\u0026#34;required\u0026#34; aria-label=\u0026#34;å¿…å¡«\u0026#34;\u0026gt;*\u0026lt;/span\u0026gt; \u0026lt;/label\u0026gt; \u0026lt;input type=\u0026#34;text\u0026#34; id=\u0026#34;name\u0026#34; name=\u0026#34;name\u0026#34; required aria-describedby=\u0026#34;name-help\u0026#34; autocomplete=\u0026#34;name\u0026#34; \u0026gt; \u0026lt;div id=\u0026#34;name-help\u0026#34; class=\u0026#34;help-text\u0026#34;\u0026gt; è¯·è¾“å…¥æ‚¨çš„çœŸå®å§“å \u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;div class=\u0026#34;form-group\u0026#34;\u0026gt; \u0026lt;label for=\u0026#34;email\u0026#34;\u0026gt;ç”µå­é‚®ç®±\u0026lt;/label\u0026gt; \u0026lt;input type=\u0026#34;email\u0026#34; id=\u0026#34;email\u0026#34; name=\u0026#34;email\u0026#34; required aria-invalid=\u0026#34;false\u0026#34; aria-describedby=\u0026#34;email-error\u0026#34; \u0026gt; \u0026lt;div id=\u0026#34;email-error\u0026#34; class=\u0026#34;error-text\u0026#34; role=\u0026#34;alert\u0026#34; hidden\u0026gt; è¯·è¾“å…¥æœ‰æ•ˆçš„é‚®ç®±åœ°å€ \u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;div class=\u0026#34;form-group\u0026#34;\u0026gt; \u0026lt;label for=\u0026#34;message\u0026#34;\u0026gt;ç•™è¨€\u0026lt;/label\u0026gt; \u0026lt;textarea id=\u0026#34;message\u0026#34; name=\u0026#34;message\u0026#34; rows=\u0026#34;4\u0026#34; aria-describedby=\u0026#34;message-counter\u0026#34; \u0026gt;\u0026lt;/textarea\u0026gt; \u0026lt;div id=\u0026#34;message-counter\u0026#34; aria-live=\u0026#34;polite\u0026#34;\u0026gt; è¿˜å¯ä»¥è¾“å…¥ \u0026lt;span id=\u0026#34;count\u0026#34;\u0026gt;200\u0026lt;/span\u0026gt; ä¸ªå­—ç¬¦ \u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/fieldset\u0026gt; \u0026lt;button type=\u0026#34;submit\u0026#34;\u0026gt;æäº¤\u0026lt;/button\u0026gt; \u0026lt;/form\u0026gt; è·³è¿‡é“¾æ¥ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 \u0026lt;!-- ä¸ºé”®ç›˜ç”¨æˆ·æä¾›å¿«é€Ÿå¯¼èˆª --\u0026gt; \u0026lt;a href=\u0026#34;#main-content\u0026#34; class=\u0026#34;skip-link\u0026#34;\u0026gt; è·³åˆ°ä¸»å†…å®¹ \u0026lt;/a\u0026gt; \u0026lt;a href=\u0026#34;#navigation\u0026#34; class=\u0026#34;skip-link\u0026#34;\u0026gt; è·³åˆ°å¯¼èˆª \u0026lt;/a\u0026gt; \u0026lt;!-- CSSæ ·å¼ --\u0026gt; \u0026lt;style\u0026gt; .skip-link { position: absolute; top: -40px; left: 6px; background: #000; color: #fff; padding: 8px; text-decoration: none; z-index: 1000; } .skip-link:focus { top: 6px; } \u0026lt;/style\u0026gt; ARIAå±æ€§åº”ç”¨ ARIAè§’è‰²ï¼ˆRolesï¼‰ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 \u0026lt;!-- å®šä¹‰ä¸»è¦åŒºåŸŸè§’è‰² --\u0026gt; \u0026lt;header role=\u0026#34;banner\u0026#34;\u0026gt; \u0026lt;h1\u0026gt;ç½‘ç«™æ ‡é¢˜\u0026lt;/h1\u0026gt; \u0026lt;/header\u0026gt; \u0026lt;nav role=\u0026#34;navigation\u0026#34; aria-label=\u0026#34;ä¸»å¯¼èˆª\u0026#34;\u0026gt; \u0026lt;ul\u0026gt; \u0026lt;li\u0026gt;\u0026lt;a href=\u0026#34;/\u0026#34; aria-current=\u0026#34;page\u0026#34;\u0026gt;é¦–é¡µ\u0026lt;/a\u0026gt;\u0026lt;/li\u0026gt; \u0026lt;li\u0026gt;\u0026lt;a href=\u0026#34;/products\u0026#34;\u0026gt;äº§å“\u0026lt;/a\u0026gt;\u0026lt;/li\u0026gt; \u0026lt;li\u0026gt;\u0026lt;a href=\u0026#34;/contact\u0026#34;\u0026gt;è”ç³»æˆ‘ä»¬\u0026lt;/a\u0026gt;\u0026lt;/li\u0026gt; \u0026lt;/ul\u0026gt; \u0026lt;/nav\u0026gt; \u0026lt;main role=\u0026#34;main\u0026#34; id=\u0026#34;main-content\u0026#34;\u0026gt; \u0026lt;h2\u0026gt;ä¸»è¦å†…å®¹\u0026lt;/h2\u0026gt; \u0026lt;/main\u0026gt; \u0026lt;aside role=\u0026#34;complementary\u0026#34; aria-label=\u0026#34;ä¾§è¾¹æ \u0026#34;\u0026gt; \u0026lt;h3\u0026gt;ç›¸å…³é“¾æ¥\u0026lt;/h3\u0026gt; \u0026lt;/aside\u0026gt; \u0026lt;footer role=\u0026#34;contentinfo\u0026#34;\u0026gt; \u0026lt;p\u0026gt;\u0026amp;copy; 2024 å…¬å¸åç§°\u0026lt;/p\u0026gt; \u0026lt;/footer\u0026gt; \u0026lt;!-- è‡ªå®šä¹‰ç»„ä»¶ä½¿ç”¨ARIA --\u0026gt; \u0026lt;div role=\u0026#34;tablist\u0026#34; aria-label=\u0026#34;è®¾ç½®é€‰é¡¹\u0026#34;\u0026gt; \u0026lt;button role=\u0026#34;tab\u0026#34; aria-selected=\u0026#34;true\u0026#34; aria-controls=\u0026#34;general-panel\u0026#34; id=\u0026#34;general-tab\u0026#34; \u0026gt; å¸¸è§„è®¾ç½® \u0026lt;/button\u0026gt; \u0026lt;button role=\u0026#34;tab\u0026#34; aria-selected=\u0026#34;false\u0026#34; aria-controls=\u0026#34;advanced-panel\u0026#34; id=\u0026#34;advanced-tab\u0026#34; \u0026gt; é«˜çº§è®¾ç½® \u0026lt;/button\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;div role=\u0026#34;tabpanel\u0026#34; id=\u0026#34;general-panel\u0026#34; aria-labelledby=\u0026#34;general-tab\u0026#34; \u0026gt; å¸¸è§„è®¾ç½®å†…å®¹ \u0026lt;/div\u0026gt; \u0026lt;div role=\u0026#34;tabpanel\u0026#34; id=\u0026#34;advanced-panel\u0026#34; aria-labelledby=\u0026#34;advanced-tab\u0026#34; hidden \u0026gt; é«˜çº§è®¾ç½®å†…å®¹ \u0026lt;/div\u0026gt; åŠ¨æ€å†…å®¹æ›´æ–° 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 \u0026lt;div class=\u0026#34;search-container\u0026#34;\u0026gt; \u0026lt;label for=\u0026#34;search\u0026#34;\u0026gt;æœç´¢\u0026lt;/label\u0026gt; \u0026lt;input type=\u0026#34;search\u0026#34; id=\u0026#34;search\u0026#34; aria-describedby=\u0026#34;search-results-count\u0026#34; \u0026gt; \u0026lt;div id=\u0026#34;search-results\u0026#34; role=\u0026#34;region\u0026#34; aria-live=\u0026#34;polite\u0026#34; aria-label=\u0026#34;æœç´¢ç»“æœ\u0026#34; \u0026gt; \u0026lt;!-- åŠ¨æ€åŠ è½½æœç´¢ç»“æœ --\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;div id=\u0026#34;search-results-count\u0026#34; aria-live=\u0026#34;polite\u0026#34; class=\u0026#34;sr-only\u0026#34;\u0026gt; æ‰¾åˆ° 0 ä¸ªç»“æœ \u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;script\u0026gt; // æœç´¢ç»“æœæ›´æ–°æ—¶ function updateSearchResults(results) { const resultsContainer = document.getElementById(\u0026#39;search-results\u0026#39;) const resultsCount = document.getElementById(\u0026#39;search-results-count\u0026#39;) resultsContainer.innerHTML = results.map(item =\u0026gt; ` \u0026lt;div role=\u0026#34;option\u0026#34;\u0026gt;${item.title}\u0026lt;/div\u0026gt; `).join(\u0026#39;\u0026#39;) resultsCount.textContent = `æ‰¾åˆ° ${results.length} ä¸ªç»“æœ` } \u0026lt;/script\u0026gt; åŠ è½½çŠ¶æ€åé¦ˆ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 \u0026lt;button id=\u0026#34;save-button\u0026#34; onclick=\u0026#34;saveData()\u0026#34;\u0026gt; ä¿å­˜æ•°æ® \u0026lt;/button\u0026gt; \u0026lt;div id=\u0026#34;saving-status\u0026#34; role=\u0026#34;status\u0026#34; aria-live=\u0026#34;polite\u0026#34; class=\u0026#34;sr-only\u0026#34;\u0026gt;\u0026lt;/div\u0026gt; \u0026lt;script\u0026gt; async function saveData() { const button = document.getElementById(\u0026#39;save-button\u0026#39;) const status = document.getElementById(\u0026#39;saving-status\u0026#39;) // ç¦ç”¨æŒ‰é’®å¹¶æ˜¾ç¤ºåŠ è½½çŠ¶æ€ button.disabled = true button.setAttribute(\u0026#39;aria-busy\u0026#39;, \u0026#39;true\u0026#39;) status.textContent = \u0026#39;æ­£åœ¨ä¿å­˜...\u0026#39; try { await performSave() status.textContent = \u0026#39;ä¿å­˜æˆåŠŸ\u0026#39; // 3ç§’åæ¸…é™¤çŠ¶æ€ setTimeout(() =\u0026gt; { status.textContent = \u0026#39;\u0026#39; }, 3000) } catch (error) { status.textContent = \u0026#39;ä¿å­˜å¤±è´¥ï¼Œè¯·é‡è¯•\u0026#39; } finally { button.disabled = false button.removeAttribute(\u0026#39;aria-busy\u0026#39;) } } \u0026lt;/script\u0026gt; é”®ç›˜å¯¼èˆª ç„¦ç‚¹ç®¡ç† 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 /* å¯è§ç„¦ç‚¹æŒ‡ç¤ºå™¨ */ :focus { outline: 3px solid #005fcc; outline-offset: 2px; } /* ä¸ºé¼ æ ‡ç”¨æˆ·ç§»é™¤è½®å»“ */ :focus:not(:focus-visible) { outline: none; } /* æ”¯æŒfocus-visibleçš„æµè§ˆå™¨ */ :focus-visible { outline: 3px solid #005fcc; outline-offset: 2px; } /* è·³è¿‡é“¾æ¥æ ·å¼ */ .skip-link:focus { position: absolute; top: 6px; left: 6px; z-index: 1000; } 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 // æ¨¡æ€æ¡†ç„¦ç‚¹ç®¡ç† class ModalManager { constructor(modalElement) { this.modal = modalElement this.previousFocus = null this.focusableElements = null } open() { // ä¿å­˜å½“å‰ç„¦ç‚¹å…ƒç´  this.previousFocus = document.activeElement // æ˜¾ç¤ºæ¨¡æ€æ¡† this.modal.style.display = \u0026#39;block\u0026#39; this.modal.setAttribute(\u0026#39;aria-hidden\u0026#39;, \u0026#39;false\u0026#39;) // è·å–å¯èšç„¦å…ƒç´  this.focusableElements = this.modal.querySelectorAll( \u0026#39;button, [href], input, select, textarea, [tabindex]:not([tabindex=\u0026#34;-1\u0026#34;])\u0026#39; ) // è®¾ç½®ç„¦ç‚¹åˆ°ç¬¬ä¸€ä¸ªå…ƒç´  if (this.focusableElements.length \u0026gt; 0) { this.focusableElements[0].focus() } // é™åˆ¶Tabåœ¨æ¨¡æ€æ¡†å†… this.trapFocus() } close() { this.modal.style.display = \u0026#39;none\u0026#39; this.modal.setAttribute(\u0026#39;aria-hidden\u0026#39;, \u0026#39;true\u0026#39;) // æ¢å¤ä¹‹å‰çš„ç„¦ç‚¹ if (this.previousFocus) { this.previousFocus.focus() } // ç§»é™¤ç„¦ç‚¹é™·é˜± this.removeFocusTrap() } trapFocus() { this.handleKeyDown = (e) =\u0026gt; { if (e.key === \u0026#39;Tab\u0026#39;) { const firstElement = this.focusableElements[0] const lastElement = this.focusableElements[this.focusableElements.length - 1] if (e.shiftKey) { if (document.activeElement === firstElement) { lastElement.focus() e.preventDefault() } } else { if (document.activeElement === lastElement) { firstElement.focus() e.preventDefault() } } } } document.addEventListener(\u0026#39;keydown\u0026#39;, this.handleKeyDown) } removeFocusTrap() { if (this.handleKeyDown) { document.removeEventListener(\u0026#39;keydown\u0026#39;, this.handleKeyDown) } } } // ä½¿ç”¨ç¤ºä¾‹ const modal = new ModalManager(document.getElementById(\u0026#39;my-modal\u0026#39;)) document.getElementById(\u0026#39;open-modal\u0026#39;).addEventListener(\u0026#39;click\u0026#39;, () =\u0026gt; modal.open()) document.getElementById(\u0026#39;close-modal\u0026#39;).addEventListener(\u0026#39;click\u0026#39;, () =\u0026gt; modal.close()) è‡ªå®šä¹‰ç»„ä»¶é”®ç›˜æ”¯æŒ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 // å¯è®¿é—®çš„ä¸‹æ‹‰èœå• class AccessibleDropdown { constructor(trigger, menu) { this.trigger = trigger this.menu = menu this.isOpen = false this.currentFocus = -1 this.items = menu.querySelectorAll(\u0026#39;[role=\u0026#34;menuitem\u0026#34;]\u0026#39;) this.init() } init() { // è®¾ç½®ARIAå±æ€§ this.trigger.setAttribute(\u0026#39;aria-haspopup\u0026#39;, \u0026#39;true\u0026#39;) this.trigger.setAttribute(\u0026#39;aria-expanded\u0026#39;, \u0026#39;false\u0026#39;) this.menu.setAttribute(\u0026#39;role\u0026#39;, \u0026#39;menu\u0026#39;) this.items.forEach((item, index) =\u0026gt; { item.setAttribute(\u0026#39;role\u0026#39;, \u0026#39;menuitem\u0026#39;) item.setAttribute(\u0026#39;tabindex\u0026#39;, \u0026#39;-1\u0026#39;) }) // äº‹ä»¶ç›‘å¬ this.trigger.addEventListener(\u0026#39;click\u0026#39;, () =\u0026gt; this.toggle()) this.trigger.addEventListener(\u0026#39;keydown\u0026#39;, (e) =\u0026gt; this.handleTriggerKeydown(e)) this.menu.addEventListener(\u0026#39;keydown\u0026#39;, (e) =\u0026gt; this.handleMenuKeydown(e)) // ç‚¹å‡»å¤–éƒ¨å…³é—­ document.addEventListener(\u0026#39;click\u0026#39;, (e) =\u0026gt; { if (!this.trigger.contains(e.target) \u0026amp;\u0026amp; !this.menu.contains(e.target)) { this.close() } }) } toggle() { this.isOpen ? this.close() : this.open() } open() { this.isOpen = true this.menu.style.display = \u0026#39;block\u0026#39; this.trigger.setAttribute(\u0026#39;aria-expanded\u0026#39;, \u0026#39;true\u0026#39;) this.items[0].focus() this.currentFocus = 0 } close() { this.isOpen = false this.menu.style.display = \u0026#39;none\u0026#39; this.trigger.setAttribute(\u0026#39;aria-expanded\u0026#39;, \u0026#39;false\u0026#39;) this.trigger.focus() this.currentFocus = -1 } handleTriggerKeydown(e) { if (e.key === \u0026#39;ArrowDown\u0026#39; || e.key === \u0026#39;Enter\u0026#39; || e.key === \u0026#39; \u0026#39;) { e.preventDefault() this.open() } } handleMenuKeydown(e) { switch (e.key) { case \u0026#39;ArrowDown\u0026#39;: e.preventDefault() this.focusNext() break case \u0026#39;ArrowUp\u0026#39;: e.preventDefault() this.focusPrevious() break case \u0026#39;Escape\u0026#39;: e.preventDefault() this.close() break case \u0026#39;Enter\u0026#39;: case \u0026#39; \u0026#39;: e.preventDefault() this.selectCurrent() break } } focusNext() { this.currentFocus = (this.currentFocus + 1) % this.items.length this.items[this.currentFocus].focus() } focusPrevious() { this.currentFocus = (this.currentFocus - 1 + this.items.length) % this.items.length this.items[this.currentFocus].focus() } selectCurrent() { this.items[this.currentFocus].click() this.close() } } é¢œè‰²å’Œå¯¹æ¯”åº¦ å¯¹æ¯”åº¦æ£€æŸ¥å·¥å…·é›†æˆ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 // å¯¹æ¯”åº¦è®¡ç®—å‡½æ•° function getContrastRatio(color1, color2) { const luminance = (c) =\u0026gt; { const rgb = c.replace(\u0026#39;#\u0026#39;, \u0026#39;\u0026#39;).match(/.{2}/g).map(x =\u0026gt; { const val = parseInt(x, 16) / 255 return val \u0026lt;= 0.03928 ? val / 12.92 : Math.pow((val + 0.055) / 1.055, 2.4) }) return 0.2126 * rgb[0] + 0.7152 * rgb[1] + 0.0722 * rgb[2] } const lum1 = luminance(color1) const lum2 = luminance(color2) return (Math.max(lum1, lum2) + 0.05) / (Math.min(lum1, lum2) + 0.05) } // æ£€æŸ¥æ˜¯å¦æ»¡è¶³WCAGæ ‡å‡† function checkContrastRatio(foreground, background) { const ratio = getContrastRatio(foreground, background) return { ratio: ratio.toFixed(2), aa_normal: ratio \u0026gt;= 4.5, aa_large: ratio \u0026gt;= 3.0, aaa_normal: ratio \u0026gt;= 7.0, aaa_large: ratio \u0026gt;= 4.5 } } // ä½¿ç”¨ç¤ºä¾‹ const result = checkContrastRatio(\u0026#39;#000000\u0026#39;, \u0026#39;#ffffff\u0026#39;) console.log(`å¯¹æ¯”åº¦: ${result.ratio}:1`) console.log(`AAæ ‡å‡†: ${result.aa_normal ? \u0026#39;é€šè¿‡\u0026#39; : \u0026#39;å¤±è´¥\u0026#39;}`) ä¸ä»…ä»…æ˜¯é¢œè‰²çš„è®¾è®¡ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 /* ä¸è¦ä»…ä¾èµ–é¢œè‰²ä¼ é€’ä¿¡æ¯ */ .error { color: #d32f2f; border: 2px solid #d32f2f; } .success { color: #388e3c; border: 2px solid #388e3c; } /* æ·»åŠ å›¾æ ‡æˆ–æ–‡æœ¬ */ .error::before { content: \u0026#34;âŒ \u0026#34;; margin-right: 0.5em; } .success::before { content: \u0026#34;âœ… \u0026#34;; margin-right: 0.5em; } /* çŠ¶æ€æŒ‡ç¤º */ .status-indicator { position: relative; } .status-indicator::after { content: \u0026#34;\u0026#34;; position: absolute; top: 0; right: -10px; width: 8px; height: 8px; border-radius: 50%; } .status-indicator.online::after { background-color: #388e3c; } .status-indicator.offline::after { background-color: #d32f2f; animation: pulse 2s infinite; } @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.5; } 100% { opacity: 1; } } å¤šåª’ä½“æ— éšœç¢ å›¾ç‰‡æ›¿ä»£æ–‡æœ¬ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 \u0026lt;!-- æœ‰æ„ä¹‰çš„å›¾ç‰‡ --\u0026gt; \u0026lt;img src=\u0026#34;team-photo.jpg\u0026#34; alt=\u0026#34;å¼€å‘å›¢é˜Ÿåœ¨åŠå…¬å®¤çš„åˆå½±ï¼Œå…±5äººæ­£åœ¨è®¨è®ºé¡¹ç›®\u0026#34;\u0026gt; \u0026lt;!-- è£…é¥°æ€§å›¾ç‰‡ --\u0026gt; \u0026lt;img src=\u0026#34;decorative-border.png\u0026#34; alt=\u0026#34;\u0026#34; role=\u0026#34;presentation\u0026#34;\u0026gt; \u0026lt;!-- æˆ–ä½¿ç”¨CSSèƒŒæ™¯å›¾ç‰‡ --\u0026gt; \u0026lt;div class=\u0026#34;decorative-border\u0026#34;\u0026gt;\u0026lt;/div\u0026gt; \u0026lt;style\u0026gt; .decorative-border { background-image: url(\u0026#39;decorative-border.png\u0026#39;); background-repeat: no-repeat; width: 100px; height: 20px; } \u0026lt;/style\u0026gt; \u0026lt;!-- åŠŸèƒ½æ€§å›¾ç‰‡ --\u0026gt; \u0026lt;img src=\u0026#34;pdf-icon.png\u0026#34; alt=\u0026#34;ä¸‹è½½PDFæ–‡ä»¶\u0026#34;\u0026gt; \u0026lt;!-- å¤æ‚å›¾ç‰‡æä¾›è¯¦ç»†æè¿° --\u0026gt; \u0026lt;img src=\u0026#34;chart.png\u0026#34; alt=\u0026#34;2024å¹´é”€å”®è¶‹åŠ¿å›¾è¡¨ï¼Œæ˜¾ç¤ºç¬¬äºŒå­£åº¦å¢é•¿æ˜¾è‘—\u0026#34; longdesc=\u0026#34;chart-details.html\u0026#34;\u0026gt; \u0026lt;!-- å›¾è¡¨æ•°æ®è¡¨ --\u0026gt; \u0026lt;div role=\u0026#34;img\u0026#34; aria-labelledby=\u0026#34;chart-title\u0026#34;\u0026gt; \u0026lt;h2 id=\u0026#34;chart-title\u0026#34;\u0026gt;æœˆåº¦é”€å”®æ•°æ®\u0026lt;/h2\u0026gt; \u0026lt;canvas id=\u0026#34;sales-chart\u0026#34; aria-hidden=\u0026#34;true\u0026#34;\u0026gt;\u0026lt;/canvas\u0026gt; \u0026lt;!-- ä¸ºå±å¹•é˜…è¯»å™¨æä¾›æ•°æ®è¡¨ --\u0026gt; \u0026lt;table class=\u0026#34;sr-only\u0026#34;\u0026gt; \u0026lt;caption\u0026gt;æœˆåº¦é”€å”®æ•°æ®è¡¨\u0026lt;/caption\u0026gt; \u0026lt;thead\u0026gt; \u0026lt;tr\u0026gt; \u0026lt;th\u0026gt;æœˆä»½\u0026lt;/th\u0026gt; \u0026lt;th\u0026gt;é”€å”®é¢ï¼ˆä¸‡å…ƒï¼‰\u0026lt;/th\u0026gt; \u0026lt;th\u0026gt;å¢é•¿ç‡\u0026lt;/th\u0026gt; \u0026lt;/tr\u0026gt; \u0026lt;/thead\u0026gt; \u0026lt;tbody\u0026gt; \u0026lt;tr\u0026gt; \u0026lt;td\u0026gt;1æœˆ\u0026lt;/td\u0026gt; \u0026lt;td\u0026gt;120\u0026lt;/td\u0026gt; \u0026lt;td\u0026gt;-\u0026lt;/td\u0026gt; \u0026lt;/tr\u0026gt; \u0026lt;tr\u0026gt; \u0026lt;td\u0026gt;2æœˆ\u0026lt;/td\u0026gt; \u0026lt;td\u0026gt;135\u0026lt;/td\u0026gt; \u0026lt;td\u0026gt;12.5%\u0026lt;/td\u0026gt; \u0026lt;/tr\u0026gt; \u0026lt;!-- æ›´å¤šæ•°æ®è¡Œ --\u0026gt; \u0026lt;/tbody\u0026gt; \u0026lt;/table\u0026gt; \u0026lt;/div\u0026gt; è§†é¢‘å’ŒéŸ³é¢‘ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 \u0026lt;!-- å¸¦å­—å¹•çš„è§†é¢‘ --\u0026gt; \u0026lt;video controls\u0026gt; \u0026lt;source src=\u0026#34;video.mp4\u0026#34; type=\u0026#34;video/mp4\u0026#34;\u0026gt; \u0026lt;source src=\u0026#34;video.webm\u0026#34; type=\u0026#34;video/webm\u0026#34;\u0026gt; \u0026lt;!-- å­—å¹• --\u0026gt; \u0026lt;track kind=\u0026#34;subtitles\u0026#34; src=\u0026#34;subtitles-zh.vtt\u0026#34; srclang=\u0026#34;zh\u0026#34; label=\u0026#34;ä¸­æ–‡å­—å¹•\u0026#34; \u0026gt; \u0026lt;track kind=\u0026#34;subtitles\u0026#34; src=\u0026#34;subtitles-en.vtt\u0026#34; srclang=\u0026#34;en\u0026#34; label=\u0026#34;English Subtitles\u0026#34; \u0026gt; \u0026lt;!-- å­—å¹•ï¼ˆé’ˆå¯¹å¬éšœç”¨æˆ·ï¼‰ --\u0026gt; \u0026lt;track kind=\u0026#34;captions\u0026#34; src=\u0026#34;captions-zh.vtt\u0026#34; srclang=\u0026#34;zh\u0026#34; label=\u0026#34;ä¸­æ–‡å­—å¹•ï¼ˆåŒ…å«å£°éŸ³æè¿°ï¼‰\u0026#34; \u0026gt; \u0026lt;!-- éŸ³é¢‘æè¿° --\u0026gt; \u0026lt;track kind=\u0026#34;descriptions\u0026#34; src=\u0026#34;descriptions-zh.vtt\u0026#34; srclang=\u0026#34;zh\u0026#34; label=\u0026#34;éŸ³é¢‘æè¿°\u0026#34; \u0026gt; \u0026lt;!-- é™çº§å†…å®¹ --\u0026gt; \u0026lt;p\u0026gt; æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒè§†é¢‘æ’­æ”¾ã€‚ \u0026lt;a href=\u0026#34;video.mp4\u0026#34;\u0026gt;ä¸‹è½½è§†é¢‘æ–‡ä»¶\u0026lt;/a\u0026gt; \u0026lt;/p\u0026gt; \u0026lt;/video\u0026gt; \u0026lt;!-- éŸ³é¢‘æä¾›è½¬å½•æ–‡æœ¬ --\u0026gt; \u0026lt;audio controls\u0026gt; \u0026lt;source src=\u0026#34;podcast.mp3\u0026#34; type=\u0026#34;audio/mpeg\u0026#34;\u0026gt; \u0026lt;!-- æä¾›å®Œæ•´è½¬å½• --\u0026gt; \u0026lt;details\u0026gt; \u0026lt;summary\u0026gt;éŸ³é¢‘è½¬å½•\u0026lt;/summary\u0026gt; \u0026lt;div class=\u0026#34;transcript\u0026#34;\u0026gt; \u0026lt;p\u0026gt;ä¸»æŒäººï¼šå¤§å®¶å¥½ï¼Œæ¬¢è¿æ”¶å¬æœ¬æœŸèŠ‚ç›®...\u0026lt;/p\u0026gt; \u0026lt;!-- å®Œæ•´è½¬å½•å†…å®¹ --\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/details\u0026gt; \u0026lt;/audio\u0026gt; ç§»åŠ¨ç«¯æ— éšœç¢ å“åº”å¼è®¾è®¡è€ƒè™‘ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 /* ç¡®ä¿è§¦æ‘¸ç›®æ ‡è¶³å¤Ÿå¤§ */ button, a, input, select, textarea { min-height: 44px; min-width: 44px; } /* å°å±å¹•è°ƒæ•´ */ @media (max-width: 768px) { .button { padding: 12px 24px; font-size: 16px; } /* é¿å…å…ƒç´ è¿‡è¿‘ */ .nav-item { margin-right: 10px; } } /* æ¨ªå±æ¨¡å¼è°ƒæ•´ */ @media (orientation: landscape) and (max-height: 500px) { .modal { max-height: 90vh; overflow-y: auto; } } æ‰‹åŠ¿æ›¿ä»£æ–¹æ¡ˆ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 // ä¸ºæ»‘åŠ¨æ‰‹åŠ¿æ·»åŠ æŒ‰é’®æ§åˆ¶ class AccessibleSlider { constructor(slider) { this.slider = slider this.slides = slider.querySelectorAll(\u0026#39;.slide\u0026#39;) this.currentIndex = 0 this.createControls() this.initKeyboardSupport() this.initTouchSupport() } createControls() { const controls = document.createElement(\u0026#39;div\u0026#39;) controls.className = \u0026#39;slider-controls\u0026#39; controls.setAttribute(\u0026#39;role\u0026#39;, \u0026#39;group\u0026#39;) controls.setAttribute(\u0026#39;aria-label\u0026#39;, \u0026#39;å¹»ç¯ç‰‡æ§åˆ¶\u0026#39;) const prevButton = document.createElement(\u0026#39;button\u0026#39;) prevButton.textContent = \u0026#39;ä¸Šä¸€å¼ \u0026#39; prevButton.setAttribute(\u0026#39;aria-label\u0026#39;, \u0026#39;æŸ¥çœ‹ä¸Šä¸€å¼ å¹»ç¯ç‰‡\u0026#39;) prevButton.addEventListener(\u0026#39;click\u0026#39;, () =\u0026gt; this.prev()) const nextButton = document.createElement(\u0026#39;button\u0026#39;) nextButton.textContent = \u0026#39;ä¸‹ä¸€å¼ \u0026#39; nextButton.setAttribute(\u0026#39;aria-label\u0026#39;, \u0026#39;æŸ¥çœ‹ä¸‹ä¸€å¼ å¹»ç¯ç‰‡\u0026#39;) nextButton.addEventListener(\u0026#39;click\u0026#39;, () =\u0026gt; this.next()) const indicators = document.createElement(\u0026#39;div\u0026#39;) indicators.className = \u0026#39;slide-indicators\u0026#39; indicators.setAttribute(\u0026#39;role\u0026#39;, \u0026#39;tablist\u0026#39;) this.slides.forEach((slide, index) =\u0026gt; { const indicator = document.createElement(\u0026#39;button\u0026#39;) indicator.setAttribute(\u0026#39;role\u0026#39;, \u0026#39;tab\u0026#39;) indicator.setAttribute(\u0026#39;aria-label\u0026#39;, `å¹»ç¯ç‰‡ ${index + 1}`) indicator.setAttribute(\u0026#39;aria-selected\u0026#39;, index === 0 ? \u0026#39;true\u0026#39; : \u0026#39;false\u0026#39;) indicator.addEventListener(\u0026#39;click\u0026#39;, () =\u0026gt; this.goTo(index)) if (index === 0) { indicator.classList.add(\u0026#39;active\u0026#39;) } indicators.appendChild(indicator) }) controls.appendChild(prevButton) controls.appendChild(indicators) controls.appendChild(nextButton) this.slider.parentNode.insertBefore(controls, this.slider) this.controls = { prevButton, nextButton, indicators } } initKeyboardSupport() { this.slider.setAttribute(\u0026#39;tabindex\u0026#39;, \u0026#39;0\u0026#39;) this.slider.addEventListener(\u0026#39;keydown\u0026#39;, (e) =\u0026gt; { switch (e.key) { case \u0026#39;ArrowLeft\u0026#39;: e.preventDefault() this.prev() break case \u0026#39;ArrowRight\u0026#39;: e.preventDefault() this.next() break case \u0026#39;Home\u0026#39;: e.preventDefault() this.goTo(0) break case \u0026#39;End\u0026#39;: e.preventDefault() this.goTo(this.slides.length - 1) break } }) } initTouchSupport() { let startX = 0 let currentX = 0 this.slider.addEventListener(\u0026#39;touchstart\u0026#39;, (e) =\u0026gt; { startX = e.touches[0].clientX }) this.slider.addEventListener(\u0026#39;touchmove\u0026#39;, (e) =\u0026gt; { currentX = e.touches[0].clientX }) this.slider.addEventListener(\u0026#39;touchend\u0026#39;, () =\u0026gt; { const diff = startX - currentX if (Math.abs(diff) \u0026gt; 50) { if (diff \u0026gt; 0) { this.next() } else { this.prev() } } }) } updateIndicators() { const indicators = this.controls.indicators.querySelectorAll(\u0026#39;[role=\u0026#34;tab\u0026#34;]\u0026#39;) indicators.forEach((indicator, index) =\u0026gt; { indicator.setAttribute(\u0026#39;aria-selected\u0026#39;, index === this.currentIndex ? \u0026#39;true\u0026#39; : \u0026#39;false\u0026#39;) indicator.classList.toggle(\u0026#39;active\u0026#39;, index === this.currentIndex) }) } goTo(index) { this.currentIndex = index this.updateSlider() this.updateIndicators() } next() { this.currentIndex = (this.currentIndex + 1) % this.slides.length this.updateSlider() this.updateIndicators() } prev() { this.currentIndex = (this.currentIndex - 1 + this.slides.length) % this.slides.length this.updateSlider() this.updateIndicators() } updateSlider() { const offset = -this.currentIndex * 100 this.slider.style.transform = `translateX(${offset}%)` // æ›´æ–°ARIAæ ‡ç­¾ this.slider.setAttribute(\u0026#39;aria-label\u0026#39;, `å½“å‰æ˜¾ç¤ºç¬¬ ${this.currentIndex + 1} å¼ å¹»ç¯ç‰‡`) } } æµ‹è¯•å·¥å…·å’Œè‡ªåŠ¨åŒ– è‡ªåŠ¨åŒ–æµ‹è¯•é›†æˆ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 // ä½¿ç”¨axe-coreè¿›è¡Œæ— éšœç¢æµ‹è¯• const { injectAxe, checkA11y } = require(\u0026#39;axe-playwright\u0026#39;) // Playwrightæµ‹è¯•ç¤ºä¾‹ const { test, expect } = require(\u0026#39;@playwright/test\u0026#39;) test.describe(\u0026#39;Accessibility Tests\u0026#39;, () =\u0026gt; { test.beforeEach(async ({ page }) =\u0026gt; { await injectAxe(page) }) test(\u0026#39;Home page should be accessible\u0026#39;, async ({ page }) =\u0026gt; { await page.goto(\u0026#39;/\u0026#39;) await checkA11y(page) }) test(\u0026#39;Form should be accessible\u0026#39;, async ({ page }) =\u0026gt; { await page.goto(\u0026#39;/contact\u0026#39;) await checkA11y(page, null, { detailedReport: true, detailedReportOptions: { html: true } }) }) test(\u0026#39;Dynamic content should be accessible\u0026#39;, async ({ page }) =\u0026gt; { await page.goto(\u0026#39;/search\u0026#39;) // è¾“å…¥æœç´¢å¹¶ç­‰å¾…ç»“æœ await page.fill(\u0026#39;#search\u0026#39;, \u0026#39;test\u0026#39;) await page.waitForSelector(\u0026#39;#search-results\u0026#39;) // ä»…æµ‹è¯•æ–°çš„åŠ¨æ€å†…å®¹ await checkA11y(page, \u0026#39;#search-results\u0026#39;, { includedImpacts: [\u0026#39;minor\u0026#39;, \u0026#39;moderate\u0026#39;, \u0026#39;serious\u0026#39;, \u0026#39;critical\u0026#39;] }) }) }) æŒç»­é›†æˆé…ç½® 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 # .github/workflows/accessibility.yml name: Accessibility Tests on: push: branches: [ main ] pull_request: branches: [ main ] jobs: accessibility: runs-on: ubuntu-latest steps: - uses: actions/checkout@v3 - name: Setup Node.js uses: actions/setup-node@v3 with: node-version: \u0026#39;18\u0026#39; cache: \u0026#39;npm\u0026#39; - name: Install dependencies run: npm ci - name: Build application run: npm run build - name: Run accessibility tests run: npm run test:a11y - name: Upload accessibility report uses: actions/upload-artifact@v3 if: failure() with: name: accessibility-report path: a11y-report.html å®æ—¶æ— éšœç¢æ£€æŸ¥ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 // å¼€å‘ç¯å¢ƒå®æ—¶æ£€æŸ¥ if (process.env.NODE_ENV === \u0026#39;development\u0026#39;) { import(\u0026#39;axe-core\u0026#39;).then(axe =\u0026gt; { axe.default.run(document, (err, results) =\u0026gt; { if (err) throw err const violations = results.violations if (violations.length \u0026gt; 0) { console.group(\u0026#39;ğŸš¨ Accessibility Violations Found\u0026#39;) violations.forEach(violation =\u0026gt; { console.error(`âŒ ${violation.impact}: ${violation.description}`) console.error(\u0026#39; Affected elements:\u0026#39;, violation.nodes.length) }) console.groupEnd() } }) }) } æ€»ç»“ Webæ— éšœç¢æ˜¯æ¯ä¸ªå¼€å‘è€…çš„è´£ä»»ï¼Œé€šè¿‡å®æ–½è¿™äº›æœ€ä½³å®è·µï¼š\næ ¸å¿ƒåŸåˆ™ï¼š\néµå¾ªWCAG 2.1 AAæ ‡å‡† ä½¿ç”¨è¯­ä¹‰åŒ–HTML ç¡®ä¿é”®ç›˜å¯è®¿é—® æä¾›å¤šç§ä¿¡æ¯ä¼ é€’æ–¹å¼ æŠ€æœ¯å®ç°ï¼š\næ­£ç¡®ä½¿ç”¨ARIAå±æ€§ ç®¡ç†ç„¦ç‚¹çŠ¶æ€ ä¿æŒè¶³å¤Ÿå¯¹æ¯”åº¦ æä¾›æ›¿ä»£æ–‡æœ¬ æµ‹è¯•éªŒè¯ï¼š\nä½¿ç”¨è‡ªåŠ¨åŒ–æµ‹è¯•å·¥å…· æ‰‹åŠ¨é”®ç›˜æµ‹è¯• å±å¹•é˜…è¯»å™¨æµ‹è¯• æŒç»­é›†æˆæ£€æŸ¥ è®°ä½ï¼Œæ— éšœç¢ä¸æ˜¯é¢å¤–è´Ÿæ‹…ï¼Œè€Œæ˜¯æ„å»ºé«˜è´¨é‡Webåº”ç”¨çš„åŸºç¡€ã€‚é€šè¿‡è¿™äº›å®è·µï¼Œæˆ‘ä»¬å°†åˆ›é€ ä¸€ä¸ªæ›´åŠ åŒ…å®¹çš„ç½‘ç»œä¸–ç•Œã€‚\nç›¸å…³èµ„æºï¼š\nWCAG 2.1æŒ‡å— ARIAæœ€ä½³å®è·µ axe-coreæµ‹è¯•å·¥å…· WebAIMæ— éšœç¢æ£€æŸ¥å™¨ ","permalink":"/blog/articles/web-accessibility-guide/","summary":"å…¨é¢äº†è§£Webæ— éšœç¢å¼€å‘å®è·µï¼Œä¸ºæ‰€æœ‰ç”¨æˆ·åˆ›é€ å¹³ç­‰è®¿é—®çš„ç½‘ç»œä½“éªŒã€‚","title":"Webæ— éšœç¢å®è·µæŒ‡å—ï¼šæ„å»ºåŒ…å®¹æ€§ç½‘ç»œåº”ç”¨"},{"content":"å¼•è¨€ éšç€Node.jsåœ¨åç«¯å¼€å‘ä¸­çš„å¹¿æ³›åº”ç”¨ï¼Œå®‰å…¨é—®é¢˜å˜å¾—è¶Šæ¥è¶Šé‡è¦ã€‚ä¸€ä¸ªå®‰å…¨æ¼æ´å¯èƒ½å¯¼è‡´æ•°æ®æ³„éœ²ã€æœåŠ¡ä¸­æ–­ç”šè‡³ä¼ä¸šå£°èª‰å—æŸã€‚æœ¬æ–‡å°†æ·±å…¥æ¢è®¨Node.jså®‰å…¨å¼€å‘çš„æœ€ä½³å®è·µï¼Œå¸®åŠ©ä½ æ„å»ºå®‰å…¨ã€å¯é çš„Webåº”ç”¨ã€‚\nOWASP Top 10é˜²æŠ¤ 1. æ³¨å…¥æ”»å‡»é˜²æŠ¤ SQLæ³¨å…¥é˜²æŠ¤ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 // âŒ ä¸å®‰å…¨çš„æŸ¥è¯¢ const query = `SELECT * FROM users WHERE email = \u0026#39;${email}\u0026#39;` db.query(query) // âœ… ä½¿ç”¨å‚æ•°åŒ–æŸ¥è¯¢ const mysql = require(\u0026#39;mysql2/promise\u0026#39;) async function getUser(email) { const connection = await mysql.createConnection({ host: \u0026#39;localhost\u0026#39;, user: \u0026#39;root\u0026#39;, password: \u0026#39;password\u0026#39;, database: \u0026#39;myapp\u0026#39; }) const [rows] = await connection.execute( \u0026#39;SELECT * FROM users WHERE email = ?\u0026#39;, [email] ) await connection.end() return rows[0] } // ä½¿ç”¨ORM const { Sequelize, DataTypes } = require(\u0026#39;sequelize\u0026#39;) const sequelize = new Sequelize(\u0026#39;database\u0026#39;, \u0026#39;username\u0026#39;, \u0026#39;password\u0026#39;, { host: \u0026#39;localhost\u0026#39;, dialect: \u0026#39;mysql\u0026#39; }) const User = sequelize.define(\u0026#39;User\u0026#39;, { email: DataTypes.STRING, password: DataTypes.STRING }) // å®‰å…¨æŸ¥è¯¢ const user = await User.findOne({ where: { email } }) NoSQLæ³¨å…¥é˜²æŠ¤ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 // âŒ ä¸å®‰å…¨çš„MongoDBæŸ¥è¯¢ const query = { email: req.body.email } db.users.findOne(query) // âœ… ä½¿ç”¨ç±»å‹æ£€æŸ¥å’Œè¿‡æ»¤ const { ObjectId } = require(\u0026#39;mongodb\u0026#39;) const { body, validationResult } = require(\u0026#39;express-validator\u0026#39;) async function findUser(req, res) { const errors = validationResult(req) if (!errors.isEmpty()) { return res.status(400).json({ errors: errors.array() }) } const { email } = req.body // éªŒè¯é‚®ç®±æ ¼å¼ if (!validator.isEmail(email)) { return res.status(400).json({ error: \u0026#39;Invalid email format\u0026#39; }) } const user = await db.users.findOne({ email }) res.json(user) } 2. èº«ä»½éªŒè¯å’Œæˆæƒ JWTå®ç° 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 const jwt = require(\u0026#39;jsonwebtoken\u0026#39;) const bcrypt = require(\u0026#39;bcrypt\u0026#39;) const { promisify } = require(\u0026#39;util\u0026#39;) const signToken = promisify(jwt.sign) const verifyToken = promisify(jwt.verify) // JWTé…ç½® const JWT_SECRET = process.env.JWT_SECRET || \u0026#39;your-secret-key\u0026#39; const JWT_EXPIRES_IN = process.env.JWT_EXPIRES_IN || \u0026#39;7d\u0026#39; // ç”ŸæˆToken async function generateToken(payload) { return await signToken(payload, JWT_SECRET, { expiresIn: JWT_EXPIRES_IN, issuer: \u0026#39;your-app\u0026#39;, audience: \u0026#39;your-users\u0026#39; }) } // éªŒè¯Tokenä¸­é—´ä»¶ async function authenticateToken(req, res, next) { try { const authHeader = req.headers[\u0026#39;authorization\u0026#39;] const token = authHeader \u0026amp;\u0026amp; authHeader.split(\u0026#39; \u0026#39;)[1] if (!token) { return res.status(401).json({ error: \u0026#39;Access token required\u0026#39; }) } const decoded = await verifyToken(token, JWT_SECRET) req.user = decoded next() } catch (error) { return res.status(403).json({ error: \u0026#39;Invalid or expired token\u0026#39; }) } } // è§’è‰²æˆæƒä¸­é—´ä»¶ function authorize(roles) { return (req, res, next) =\u0026gt; { if (!req.user) { return res.status(401).json({ error: \u0026#39;Authentication required\u0026#39; }) } if (!roles.includes(req.user.role)) { return res.status(403).json({ error: \u0026#39;Insufficient permissions\u0026#39; }) } next() } } // ä½¿ç”¨ç¤ºä¾‹ app.get(\u0026#39;/admin/users\u0026#39;, authenticateToken, authorize([\u0026#39;admin\u0026#39;]), async (req, res) =\u0026gt; { // ç®¡ç†å‘˜åŠŸèƒ½ } ) å¯†ç å®‰å…¨å¤„ç† 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 const bcrypt = require(\u0026#39;bcrypt\u0026#39;) const crypto = require(\u0026#39;crypto\u0026#39;) // å¯†ç å“ˆå¸Œ async function hashPassword(password) { const saltRounds = 12 return await bcrypt.hash(password, saltRounds) } // éªŒè¯å¯†ç  async function verifyPassword(password, hash) { return await bcrypt.compare(password, hash) } // å¯†ç é‡ç½®Token function generateResetToken() { return crypto.randomBytes(32).toString(\u0026#39;hex\u0026#39;) } // å¯†ç éªŒè¯è§„åˆ™ const passwordPolicy = { minLength: 8, requireUppercase: true, requireLowercase: true, requireNumbers: true, requireSpecialChars: true } function validatePassword(password) { const errors = [] if (password.length \u0026lt; passwordPolicy.minLength) { errors.push(`Password must be at least ${passwordPolicy.minLength} characters`) } if (passwordPolicy.requireUppercase \u0026amp;\u0026amp; !/[A-Z]/.test(password)) { errors.push(\u0026#39;Password must contain uppercase letters\u0026#39;) } if (passwordPolicy.requireLowercase \u0026amp;\u0026amp; !/[a-z]/.test(password)) { errors.push(\u0026#39;Password must contain lowercase letters\u0026#39;) } if (passwordPolicy.requireNumbers \u0026amp;\u0026amp; !/\\d/.test(password)) { errors.push(\u0026#39;Password must contain numbers\u0026#39;) } if (passwordPolicy.requireSpecialChars \u0026amp;\u0026amp; !/[!@#$%^\u0026amp;*]/.test(password)) { errors.push(\u0026#39;Password must contain special characters\u0026#39;) } return errors } 3. æ•°æ®åŠ å¯† æ•æ„Ÿæ•°æ®åŠ å¯† 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 const crypto = require(\u0026#39;crypto\u0026#39;) class EncryptionService { constructor(algorithm = \u0026#39;aes-256-gcm\u0026#39;, secretKey = process.env.ENCRYPTION_KEY) { this.algorithm = algorithm this.secretKey = Buffer.from(secretKey, \u0026#39;hex\u0026#39;) this.ivLength = 16 this.tagLength = 16 } encrypt(text) { const iv = crypto.randomBytes(this.ivLength) const cipher = crypto.createCipher(this.algorithm, this.secretKey) cipher.setAAD(Buffer.from(\u0026#39;additional-data\u0026#39;)) let encrypted = cipher.update(text, \u0026#39;utf8\u0026#39;, \u0026#39;hex\u0026#39;) encrypted += cipher.final(\u0026#39;hex\u0026#39;) const tag = cipher.getAuthTag() return { iv: iv.toString(\u0026#39;hex\u0026#39;), encryptedData: encrypted, tag: tag.toString(\u0026#39;hex\u0026#39;) } } decrypt(encryptedData) { const decipher = crypto.createDecipher(this.algorithm, this.secretKey) decipher.setAAD(Buffer.from(\u0026#39;additional-data\u0026#39;)) decipher.setAuthTag(Buffer.from(encryptedData.tag, \u0026#39;hex\u0026#39;)) let decrypted = decipher.update(encryptedData.encryptedData, \u0026#39;hex\u0026#39;, \u0026#39;utf8\u0026#39;) decrypted += decipher.final(\u0026#39;utf8\u0026#39;) return decrypted } } // ä½¿ç”¨ç¤ºä¾‹ const encryption = new EncryptionService() // åŠ å¯†ç”¨æˆ·æ•æ„Ÿä¿¡æ¯ const userData = { name: \u0026#39;John Doe\u0026#39;, email: \u0026#39;john@example.com\u0026#39;, ssn: encryption.encrypt(\u0026#39;123-45-6789\u0026#39;) } // è§£å¯† const decryptedSSN = encryption.decrypt(userData.ssn) HTTPSé…ç½® 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 const https = require(\u0026#39;https\u0026#39;) const fs = require(\u0026#39;fs\u0026#39;) // HTTPSæœåŠ¡å™¨é…ç½® const httpsOptions = { key: fs.readFileSync(\u0026#39;/path/to/private.key\u0026#39;), cert: fs.readFileSync(\u0026#39;/path/to/certificate.crt\u0026#39;), ca: fs.readFileSync(\u0026#39;/path/to/ca_bundle.crt\u0026#39;), minVersion: \u0026#39;TLSv1.2\u0026#39;, ciphers: [ \u0026#39;ECDHE-ECDSA-AES256-GCM-SHA384\u0026#39;, \u0026#39;ECDHE-RSA-AES256-GCM-SHA384\u0026#39;, \u0026#39;ECDHE-ECDSA-CHACHA20-POLY1305\u0026#39;, \u0026#39;ECDHE-RSA-CHACHA20-POLY1305\u0026#39;, \u0026#39;ECDHE-ECDSA-AES128-GCM-SHA256\u0026#39;, \u0026#39;ECDHE-RSA-AES128-GCM-SHA256\u0026#39; ].join(\u0026#39;:\u0026#39;), honorCipherOrder: true } const app = express() const server = https.createServer(httpsOptions, app) // HSTSä¸­é—´ä»¶ app.use((req, res, next) =\u0026gt; { res.setHeader( \u0026#39;Strict-Transport-Security\u0026#39;, \u0026#39;max-age=31536000; includeSubDomains; preload\u0026#39; ) next() }) 4. å®‰å…¨å¤´éƒ¨é…ç½® 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 const helmet = require(\u0026#39;helmet\u0026#39;) // åŸºç¡€å®‰å…¨å¤´éƒ¨ app.use(helmet()) // è‡ªå®šä¹‰å®‰å…¨å¤´éƒ¨ app.use(helmet({ contentSecurityPolicy: { directives: { defaultSrc: [\u0026#34;\u0026#39;self\u0026#39;\u0026#34;], styleSrc: [\u0026#34;\u0026#39;self\u0026#39;\u0026#34;, \u0026#34;\u0026#39;unsafe-inline\u0026#39;\u0026#34;, \u0026#34;https://fonts.googleapis.com\u0026#34;], scriptSrc: [\u0026#34;\u0026#39;self\u0026#39;\u0026#34;, \u0026#34;\u0026#39;unsafe-inline\u0026#39;\u0026#34;, \u0026#34;https://cdn.trusted.com\u0026#34;], imgSrc: [\u0026#34;\u0026#39;self\u0026#39;\u0026#34;, \u0026#34;data:\u0026#34;, \u0026#34;https:\u0026#34;], connectSrc: [\u0026#34;\u0026#39;self\u0026#39;\u0026#34;, \u0026#34;https://api.example.com\u0026#34;], fontSrc: [\u0026#34;\u0026#39;self\u0026#39;\u0026#34;, \u0026#34;https://fonts.gstatic.com\u0026#34;], objectSrc: [\u0026#34;\u0026#39;none\u0026#39;\u0026#34;], mediaSrc: [\u0026#34;\u0026#39;self\u0026#39;\u0026#34;], frameSrc: [\u0026#34;\u0026#39;none\u0026#39;\u0026#34;], manifestSrc: [\u0026#34;\u0026#39;self\u0026#39;\u0026#34;], workerSrc: [\u0026#34;\u0026#39;self\u0026#39;\u0026#34;] } }, crossOriginEmbedderPolicy: false, hsts: { maxAge: 31536000, includeSubDomains: true, preload: true } })) // CORSé…ç½® const cors = require(\u0026#39;cors\u0026#39;) const corsOptions = { origin: function (origin, callback) { const allowedOrigins = [ \u0026#39;https://example.com\u0026#39;, \u0026#39;https://app.example.com\u0026#39; ] if (!origin || allowedOrigins.includes(origin)) { callback(null, true) } else { callback(new Error(\u0026#39;Not allowed by CORS\u0026#39;)) } }, credentials: true, optionsSuccessStatus: 200 } app.use(cors(corsOptions)) è¾“å…¥éªŒè¯å’Œæ¸…ç† Express-validatoré›†æˆ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 const { body, param, query, validationResult } = require(\u0026#39;express-validator\u0026#39;) const { sanitizeBody } = require(\u0026#39;express-validator\u0026#39;) // ç”¨æˆ·æ³¨å†ŒéªŒè¯ const validateUserRegistration = [ body(\u0026#39;email\u0026#39;) .isEmail() .normalizeEmail() .withMessage(\u0026#39;Valid email required\u0026#39;), body(\u0026#39;password\u0026#39;) .isLength({ min: 8 }) .withMessage(\u0026#39;Password must be at least 8 characters\u0026#39;) .matches(/^(?=.*[a-z])(?=.*[A-Z])(?=.*\\d)(?=.*[@$!%*?\u0026amp;])[A-Za-z\\d@$!%*?\u0026amp;]/) .withMessage(\u0026#39;Password must include uppercase, lowercase, number and special character\u0026#39;), body(\u0026#39;name\u0026#39;) .trim() .isLength({ min: 2, max: 50 }) .escape() .withMessage(\u0026#39;Name must be between 2 and 50 characters\u0026#39;), body(\u0026#39;age\u0026#39;) .optional() .isInt({ min: 13, max: 120 }) .withMessage(\u0026#39;Age must be between 13 and 120\u0026#39;) ] // æ¸…ç†è¾“å…¥æ•°æ® const sanitizeInput = [ sanitizeBody(\u0026#39;bio\u0026#39;).escape(), sanitizeBody(\u0026#39;website\u0026#39;).escape(), sanitizeBody(\u0026#39;location\u0026#39;).escape() ] // éªŒè¯ç»“æœå¤„ç†ä¸­é—´ä»¶ function handleValidationErrors(req, res, next) { const errors = validationResult(req) if (!errors.isEmpty()) { return res.status(400).json({ error: \u0026#39;Validation failed\u0026#39;, details: errors.array() }) } next() } // ä½¿ç”¨ç¤ºä¾‹ app.post(\u0026#39;/api/users\u0026#39;, validateUserRegistration, sanitizeInput, handleValidationErrors, async (req, res) =\u0026gt; { // å¤„ç†ç”¨æˆ·æ³¨å†Œ } ) XSSé˜²æŠ¤ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 const xss = require(\u0026#39;xss\u0026#39;) const validator = require(\u0026#39;validator\u0026#39;) // XSSè¿‡æ»¤å™¨é…ç½® const xssOptions = { whiteList: { a: [\u0026#39;href\u0026#39;, \u0026#39;title\u0026#39;, \u0026#39;target\u0026#39;], b: [], br: [], em: [], strong: [], i: [], li: [], ol: [], p: [], ul: [] }, stripIgnoreTag: true, stripIgnoreTagBody: [\u0026#39;script\u0026#39;] } // æ¸…ç†ç”¨æˆ·è¾“å…¥ function sanitizeInput(input) { if (typeof input === \u0026#39;string\u0026#39;) { return xss(validator.escape(input), xssOptions) } if (typeof input === \u0026#39;object\u0026#39; \u0026amp;\u0026amp; input !== null) { const sanitized = {} for (const [key, value] of Object.entries(input)) { sanitized[key] = sanitizeInput(value) } return sanitized } return input } // ä¸­é—´ä»¶ function sanitizeRequest(req, res, next) { req.body = sanitizeInput(req.body) req.query = sanitizeInput(req.query) req.params = sanitizeInput(req.params) next() } app.use(sanitizeRequest) æ–‡ä»¶ä¸Šä¼ å®‰å…¨ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 const multer = require(\u0026#39;multer\u0026#39;) const path = require(\u0026#39;path\u0026#39;) const fs = require(\u0026#39;fs\u0026#39;) // æ–‡ä»¶è¿‡æ»¤å™¨ const fileFilter = (req, file, cb) =\u0026gt; { const allowedTypes = [\u0026#39;image/jpeg\u0026#39;, \u0026#39;image/png\u0026#39;, \u0026#39;image/gif\u0026#39;, \u0026#39;application/pdf\u0026#39;] if (allowedTypes.includes(file.mimetype)) { cb(null, true) } else { cb(new Error(\u0026#39;Invalid file type\u0026#39;), false) } } // å­˜å‚¨é…ç½® const storage = multer.diskStorage({ destination: (req, file, cb) =\u0026gt; { const uploadDir = \u0026#39;uploads/\u0026#39; if (!fs.existsSync(uploadDir)) { fs.mkdirSync(uploadDir, { recursive: true }) } cb(null, uploadDir) }, filename: (req, file, cb) =\u0026gt; { // ç”Ÿæˆå”¯ä¸€æ–‡ä»¶å const uniqueSuffix = Date.now() + \u0026#39;-\u0026#39; + Math.round(Math.random() * 1E9) cb(null, uniqueSuffix + path.extname(file.originalname)) } }) const upload = multer({ storage, fileFilter, limits: { fileSize: 5 * 1024 * 1024, // 5MB files: 1 } }) // ç—…æ¯’æ‰«æé›†æˆ const ClamScan = require(\u0026#39;clamscan\u0026#39;) async function scanFile(filePath) { try { const clamscan = await new ClamScan().init() const scanResult = await clamscan.scanFile(filePath) return scanResult.isInfected } catch (error) { console.error(\u0026#39;Virus scan error:\u0026#39;, error) return true // ä¿å®ˆå¤„ç†ï¼Œè®¤ä¸ºå¯èƒ½æ„ŸæŸ“ } } // æ–‡ä»¶ä¸Šä¼ è·¯ç”± app.post(\u0026#39;/upload\u0026#39;, upload.single(\u0026#39;file\u0026#39;), async (req, res) =\u0026gt; { try { if (!req.file) { return res.status(400).json({ error: \u0026#39;No file uploaded\u0026#39; }) } // ç—…æ¯’æ‰«æ const isInfected = await scanFile(req.file.path) if (isInfected) { fs.unlinkSync(req.file.path) return res.status(400).json({ error: \u0026#39;File contains virus\u0026#39; }) } res.json({ message: \u0026#39;File uploaded successfully\u0026#39;, file: { filename: req.file.filename, originalName: req.file.originalname, size: req.file.size } }) } catch (error) { if (req.file) { fs.unlinkSync(req.file.path) } res.status(500).json({ error: \u0026#39;Upload failed\u0026#39; }) } }) ä¾èµ–å®‰å…¨ ä¾èµ–æ¼æ´æ‰«æ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 // ä½¿ç”¨npm audit { \u0026#34;scripts\u0026#34;: { \u0026#34;audit\u0026#34;: \u0026#34;npm audit\u0026#34;, \u0026#34;audit:fix\u0026#34;: \u0026#34;npm audit fix\u0026#34;, \u0026#34;security-check\u0026#34;: \u0026#34;npm audit --audit-level moderate\u0026#34; } } // ä½¿ç”¨Snykè¿›è¡Œå®‰å…¨æ‰«æ const snyk = require(\u0026#39;snyk\u0026#39;) async function checkVulnerabilities() { try { await snyk.test() console.log(\u0026#39;No vulnerabilities found\u0026#39;) } catch (error) { console.error(\u0026#39;Vulnerabilities detected:\u0026#39;, error) process.exit(1) } } // CI/CDé›†æˆ if (process.env.CI) { checkVulnerabilities() } å®‰å…¨çš„ä¾èµ–ç®¡ç† 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 # package.jsoné…ç½® { \u0026#34;engines\u0026#34;: { \u0026#34;node\u0026#34;: \u0026#34;\u0026gt;=14.0.0\u0026#34;, \u0026#34;npm\u0026#34;: \u0026#34;\u0026gt;=6.0.0\u0026#34; }, \u0026#34;dependencies\u0026#34;: { \u0026#34;express\u0026#34;: \u0026#34;4.17.1\u0026#34;, // é”å®šç‰ˆæœ¬ \u0026#34;lodash\u0026#34;: \u0026#34;^4.17.20\u0026#34; // å…è®¸è¡¥ä¸æ›´æ–° }, \u0026#34;overrides\u0026#34;: { \u0026#34;lodash\u0026#34;: { \u0026#34;node\u0026#34;: \u0026#34;^14.17.0\u0026#34; // è¦†ç›–å­ä¾èµ– } } } 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 // è¿è¡Œæ—¶ä¾èµ–éªŒè¯ const { execSync } = require(\u0026#39;child_process\u0026#39;) const semver = require(\u0026#39;semver\u0026#39;) function checkNodeVersion() { const nodeVersion = process.version const minVersion = require(\u0026#39;../package.json\u0026#39;).engines.node.replace(\u0026#39;\u0026gt;=\u0026#39;, \u0026#39;\u0026#39;) if (!semver.satisfies(nodeVersion, minVersion)) { console.error(`Node.js version ${nodeVersion} is not supported. Please use ${minVersion}`) process.exit(1) } } function checkDependencies() { try { const output = execSync(\u0026#39;npm ls --depth=0\u0026#39;, { encoding: \u0026#39;utf8\u0026#39; }) const lines = output.split(\u0026#39;\\n\u0026#39;) for (const line of lines) { if (line.includes(\u0026#39;UNMET DEPENDENCY\u0026#39;)) { throw new Error(\u0026#39;Unmet dependencies detected\u0026#39;) } } } catch (error) { console.error(\u0026#39;Dependency check failed:\u0026#39;, error.message) process.exit(1) } } // åº”ç”¨å¯åŠ¨æ—¶æ£€æŸ¥ checkNodeVersion() checkDependencies() é”™è¯¯å¤„ç†å’Œæ—¥å¿— å®‰å…¨çš„é”™è¯¯å¤„ç† 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 // ç»Ÿä¸€é”™è¯¯å¤„ç†ä¸­é—´ä»¶ function errorHandler(err, req, res, next) { // è®°å½•é”™è¯¯ï¼ˆä¸æš´éœ²æ•æ„Ÿä¿¡æ¯ï¼‰ console.error(\u0026#39;Error:\u0026#39;, { message: err.message, stack: process.env.NODE_ENV === \u0026#39;development\u0026#39; ? err.stack : undefined, timestamp: new Date().toISOString(), requestId: req.id, path: req.path, method: req.method }) // ä¸æš´éœ²å†…éƒ¨é”™è¯¯è¯¦æƒ… let statusCode = 500 let message = \u0026#39;Internal Server Error\u0026#39; if (err.name === \u0026#39;ValidationError\u0026#39;) { statusCode = 400 message = err.message } else if (err.name === \u0026#39;UnauthorizedError\u0026#39;) { statusCode = 401 message = \u0026#39;Unauthorized\u0026#39; } else if (err.name === \u0026#39;ForbiddenError\u0026#39;) { statusCode = 403 message = \u0026#39;Forbidden\u0026#39; } else if (err.name === \u0026#39;NotFoundError\u0026#39;) { statusCode = 404 message = \u0026#39;Resource not found\u0026#39; } res.status(statusCode).json({ error: message, requestId: req.id, timestamp: new Date().toISOString() }) } app.use(errorHandler) å®‰å…¨æ—¥å¿—è®°å½• 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 const winston = require(\u0026#39;winston\u0026#39;) const { requestId } = require(\u0026#39;./middleware/requestId\u0026#39;) // æ—¥å¿—é…ç½® const logger = winston.createLogger({ level: \u0026#39;info\u0026#39;, format: winston.format.combine( winston.format.timestamp(), winston.format.errors({ stack: true }), winston.format.json() ), defaultMeta: { service: \u0026#39;api-service\u0026#39; }, transports: [ new winston.transports.File({ filename: \u0026#39;logs/error.log\u0026#39;, level: \u0026#39;error\u0026#39; }), new winston.transports.File({ filename: \u0026#39;logs/combined.log\u0026#39; }) ] }) if (process.env.NODE_ENV !== \u0026#39;production\u0026#39;) { logger.add(new winston.transports.Console({ format: winston.format.simple() })) } // å®‰å…¨äº‹ä»¶æ—¥å¿— function logSecurityEvent(event, req, details = {}) { logger.warn(\u0026#39;Security Event\u0026#39;, { event, ip: req.ip, userAgent: req.get(\u0026#39;User-Agent\u0026#39;), requestId: req.id, timestamp: new Date().toISOString(), ...details }) } // ä½¿ç”¨ç¤ºä¾‹ app.use((req, res, next) =\u0026gt; { req.id = Math.random().toString(36).substr(2, 9) // è®°å½•æ•æ„Ÿæ“ä½œ if (req.path.includes(\u0026#39;/admin\u0026#39;) || req.path.includes(\u0026#39;/auth\u0026#39;)) { logSecurityEvent(\u0026#39;Sensitive Access\u0026#39;, req, { path: req.path, method: req.method }) } next() }) ä¼šè¯å’ŒCookieå®‰å…¨ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 const session = require(\u0026#39;express-session\u0026#39;) const cookieParser = require(\u0026#39;cookie-parser\u0026#39;) const MongoStore = require(\u0026#39;connect-mongo\u0026#39;)(session) // ä¼šè¯é…ç½® const sessionConfig = { name: \u0026#39;sessionId\u0026#39;, // é¿å…é»˜è®¤åç§° secret: process.env.SESSION_SECRET, resave: false, saveUninitialized: false, store: new MongoStore({ url: process.env.MONGODB_URI, collection: \u0026#39;sessions\u0026#39; }), cookie: { httpOnly: true, // é˜²æ­¢XSS secure: process.env.NODE_ENV === \u0026#39;production\u0026#39;, // HTTPS only sameSite: \u0026#39;strict\u0026#39;, // CSRFé˜²æŠ¤ maxAge: 24 * 60 * 60 * 1000 // 24å°æ—¶ } } app.use(session(sessionConfig)) // é€Ÿç‡é™åˆ¶ const rateLimit = require(\u0026#39;express-rate-limit\u0026#39;) const loginLimiter = rateLimit({ windowMs: 15 * 60 * 1000, // 15åˆ†é’Ÿ max: 5, // é™åˆ¶5æ¬¡å°è¯• skipSuccessfulRequests: true, handler: (req, res) =\u0026gt; { logSecurityEvent(\u0026#39;Rate Limit Exceeded\u0026#39;, req, { endpoint: \u0026#39;/login\u0026#39;, attempts: 5 }) res.status(429).json({ error: \u0026#39;Too many login attempts\u0026#39; }) } }) app.post(\u0026#39;/login\u0026#39;, loginLimiter, async (req, res) =\u0026gt; { // ç™»å½•é€»è¾‘ }) æ€»ç»“ Node.jsåº”ç”¨å®‰å…¨éœ€è¦å¤šå±‚æ¬¡çš„é˜²æŠ¤ç­–ç•¥ï¼š\nåŸºç¡€é˜²æŠ¤ï¼š\nè¾“å…¥éªŒè¯å’Œæ¸…ç† è¾“å‡ºç¼–ç å’ŒXSSé˜²æŠ¤ SQL/NoSQLæ³¨å…¥é˜²æŠ¤ æ–‡ä»¶ä¸Šä¼ å®‰å…¨ è®¤è¯å’Œæˆæƒï¼š\nå¼ºå¯†ç ç­–ç•¥ å®‰å…¨çš„ä¼šè¯ç®¡ç† JWTä»¤ç‰Œå®‰å…¨ è§’è‰²æƒé™æ§åˆ¶ æ•°æ®ä¿æŠ¤ï¼š\nHTTPSåŠ å¯†ä¼ è¾“ æ•æ„Ÿæ•°æ®åŠ å¯†å­˜å‚¨ å®‰å…¨å¤´éƒ¨é…ç½® ä¾èµ–æ¼æ´ç®¡ç† ç›‘æ§å’Œå“åº”ï¼š\nå®‰å…¨äº‹ä»¶æ—¥å¿— é”™è¯¯å¤„ç†æœºåˆ¶ é€Ÿç‡é™åˆ¶ å®‰å…¨å®¡è®¡ éµå¾ªè¿™äº›æœ€ä½³å®è·µï¼Œå¯ä»¥å¤§å¤§æé«˜Node.jsåº”ç”¨çš„å®‰å…¨æ€§ï¼Œä¿æŠ¤åº”ç”¨å’Œç”¨æˆ·æ•°æ®å…å—æ”»å‡»ã€‚\nç›¸å…³èµ„æºï¼š\nOWASP Top 10 Node.js Security Checklist Express Security Best Practices Snyk Vulnerability Database ","permalink":"/blog/articles/nodejs-security-best-practices/","summary":"å…¨é¢æŒæ¡Node.jså®‰å…¨å¼€å‘çš„æœ€ä½³å®è·µï¼Œæ„å»ºå®‰å…¨ã€å¯é çš„Webåº”ç”¨ã€‚","title":"Node.jså®‰å…¨æœ€ä½³å®è·µï¼šæ„å»ºå®‰å…¨çš„åç«¯åº”ç”¨"},{"content":"å¼•è¨€ Gitä½œä¸ºæœ€æµè¡Œçš„åˆ†å¸ƒå¼ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿï¼Œä¸ä»…ä»…æ˜¯ä¸€ä¸ªä»£ç ç®¡ç†å·¥å…·ï¼Œæ›´æ˜¯ä¸€é—¨è‰ºæœ¯ã€‚æŒæ¡Gitçš„é«˜çº§æŠ€å·§ï¼Œèƒ½å¤Ÿè®©ä½ åœ¨ç‰ˆæœ¬æ§åˆ¶ä¸­æ¸¸åˆƒæœ‰ä½™ï¼Œä¼˜é›…åœ°å¤„ç†å„ç§å¤æ‚çš„å¼€å‘åœºæ™¯ã€‚æœ¬æ–‡å°†å¸¦ä½ æ·±å…¥Gitçš„é«˜çº§ä¸–ç•Œï¼Œæ¢ç´¢é‚£äº›è®©ä½ å¹ä¸ºè§‚æ­¢çš„å¼ºå¤§åŠŸèƒ½ã€‚\nåˆ†æ”¯ç­–ç•¥ä¸ç®¡ç† Git Flowå·¥ä½œæµ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 # ä¸»åˆ†æ”¯ git checkout -b develop main # åˆ›å»ºå¹¶åˆ‡æ¢åˆ°developåˆ†æ”¯ # åŠŸèƒ½å¼€å‘ git checkout -b feature/user-auth develop # å¼€å‘å®Œæˆååˆå¹¶åˆ°develop git checkout develop git merge --no-ff feature/user-auth # å‘å¸ƒå‡†å¤‡ git checkout -b release/1.0.0 develop # ä¿®å¤bugã€æ›´æ–°ç‰ˆæœ¬å· git checkout main git merge --no-ff release/1.0.0 git tag -a v1.0.0 -m \u0026#34;Release version 1.0.0\u0026#34; # ç´§æ€¥ä¿®å¤ git checkout -b hotfix/critical-bug main # ä¿®å¤ååˆå¹¶åˆ°mainå’Œdevelop GitHub Flowç®€åŒ–å·¥ä½œæµ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 # 1. ä»mainåˆ›å»ºåˆ†æ”¯ git checkout main git pull origin main git checkout -b feature-new-functionality # 2. å¼€å‘å¹¶æäº¤ git add . git commit -m \u0026#34;Add new functionality\u0026#34; # 3. æ¨é€å¹¶åˆ›å»ºPull Request git push origin feature-new-functionality # 4. ä»£ç å®¡æŸ¥ååˆå¹¶ # é€šè¿‡GitHub UIæˆ–å‘½ä»¤è¡Œåˆå¹¶ gh pr merge --squash # 5. åˆ é™¤åˆ†æ”¯ git checkout main git pull origin main git branch -d feature-new-functionality åˆ†æ”¯ä¿æŠ¤è§„åˆ™ 1 2 3 4 5 6 7 8 9 10 11 12 13 # è®¾ç½®åˆ†æ”¯ä¿æŠ¤ï¼ˆé€šè¿‡GitHub UIæˆ–APIï¼‰ # 1. ç¦æ­¢ç›´æ¥æ¨é€ # 2. è¦æ±‚Pull Request # 3. è¦æ±‚ä»£ç å®¡æŸ¥ # 4. è¦æ±‚çŠ¶æ€æ£€æŸ¥é€šè¿‡ # æˆ–ä½¿ç”¨GitHub CLI gh api repos/:owner/:repo/branches/:branch/protection \\ --method PUT \\ --field required_status_checks=\u0026#39;{\u0026#34;strict\u0026#34;:true,\u0026#34;contexts\u0026#34;:[\u0026#34;ci/travis\u0026#34;]}\u0026#39; \\ --field enforce_admins=true \\ --field required_pull_request_reviews=\u0026#39;{\u0026#34;required_approving_review_count\u0026#34;:2}\u0026#39; \\ --field restrictions=null å˜åŸºï¼ˆRebaseï¼‰çš„è‰ºæœ¯ åŸºç¡€å˜åŸºæ“ä½œ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 # å°†featureåˆ†æ”¯å˜åŸºåˆ°mainåˆ†æ”¯ git checkout feature git rebase main # äº¤äº’å¼å˜åŸº - æœ€è¿‘3ä¸ªæäº¤ git rebase -i HEAD~3 # å˜åŸºè¿‡ç¨‹ä¸­å¯é€‰çš„æ“ä½œï¼š # pick: ä½¿ç”¨æäº¤ # reword: ä¿®æ”¹æäº¤ä¿¡æ¯ # edit: ä¿®æ”¹æäº¤ # squash: åˆå¹¶æäº¤ # fixup: ç±»ä¼¼squashä½†ä¸¢å¼ƒæäº¤ä¿¡æ¯ # exec: æ‰§è¡Œå‘½ä»¤ # drop: åˆ é™¤æäº¤ äº¤äº’å¼å˜åŸºå®æˆ˜ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 # æŸ¥çœ‹æäº¤å†å² git log --oneline --graph # å¼€å§‹äº¤äº’å¼å˜åŸº git rebase -i HEAD~5 # ç¤ºä¾‹ç¼–è¾‘æ–‡ä»¶ï¼š pick 1a2b3c4 Add initial implementation fixup 5d6e7f8 Fix bug in initial implementation squash 9a0b1c2 Add tests for feature reword c3d4e5f6 Update documentation edit 7f8e9g0h Performance improvements # åœ¨rewordé˜¶æ®µä¿®æ”¹æäº¤ä¿¡æ¯ # åœ¨edité˜¶æ®µå¯ä»¥ä¿®æ”¹æäº¤å†…å®¹ git add . git commit --amend git rebase --continue å˜åŸºè§£å†³å†²çª 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 # å˜åŸºè¿‡ç¨‹ä¸­é‡åˆ°å†²çªæ—¶çš„å¤„ç†æµç¨‹ git rebase main # 1. æŸ¥çœ‹å†²çªæ–‡ä»¶ git status # 2. æ‰‹åŠ¨è§£å†³å†²çª # ç¼–è¾‘å†²çªæ–‡ä»¶ï¼Œä¿ç•™éœ€è¦çš„ä»£ç  # 3. æ ‡è®°ä¸ºå·²è§£å†³ git add \u0026lt;conflicted-file\u0026gt; # 4. ç»§ç»­å˜åŸº git rebase --continue # 5. å¦‚æœè¦æ”¾å¼ƒå˜åŸº git rebase --abort æ ‘å˜åŸºï¼ˆRebase Treeï¼‰ 1 2 3 4 5 6 # å°†å¤šä¸ªåˆ†æ”¯å˜åŸºåˆ°æ–°çš„åŸºç¡€ git rebase --onto new-base old-base branch # ç¤ºä¾‹ï¼šå°†feature-1å’Œfeature-2ä»æ—§çš„developå˜åŸºåˆ°æ–°çš„develop git rebase --onto new-develop old-develop feature-1 git rebase --onto new-develop old-develop feature-2 Cherry-pickæŠ€å·§ é€‰æ‹©æ€§åˆå¹¶æäº¤ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 # ä»å…¶ä»–åˆ†æ”¯æŒ‘é€‰å•ä¸ªæäº¤ git cherry-pick \u0026lt;commit-hash\u0026gt; # æŒ‘é€‰å¤šä¸ªæäº¤ git cherry-pick \u0026lt;commit1\u0026gt; \u0026lt;commit2\u0026gt; \u0026lt;commit3\u0026gt; # æŒ‘é€‰æäº¤èŒƒå›´ï¼ˆä¸åŒ…æ‹¬start-commitï¼‰ git cherry-pick start-commit..end-commit # æŒ‘é€‰æäº¤èŒƒå›´ï¼ˆåŒ…æ‹¬end-commitï¼‰ git cherry-pick start-commit^..end-commit # ä¸æäº¤ï¼Œåªåº”ç”¨æ›´æ”¹ git cherry-pick --no-commit \u0026lt;commit-hash\u0026gt; # ç¼–è¾‘æäº¤ä¿¡æ¯ git cherry-pick --edit \u0026lt;commit-hash\u0026gt; Cherry-pické«˜çº§åº”ç”¨ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 # ä»ä¸åŒä»“åº“æŒ‘é€‰æäº¤ git remote add upstream https://github.com/original/repo.git git fetch upstream git cherry-pick upstream/main^..upstream/main # æŒ‘é€‰å¹¶ä¿®æ”¹æäº¤ git cherry-pick -x \u0026lt;commit-hash\u0026gt; # æ·»åŠ åŸæäº¤ä¿¡æ¯ git cherry-pick -e \u0026lt;commit-hash\u0026gt; # ç¼–è¾‘æäº¤ä¿¡æ¯ git cherry-pick -s \u0026lt;commit-hash\u0026gt; # ç­¾åæäº¤ # è§£å†³å†²çªåç»§ç»­ git cherry-pick --continue # æ”¾å¼ƒcherry-pick git cherry-pick --abort Reflogï¼šæ—¶å…‰æœº æŸ¥çœ‹å’Œæ¢å¤ä¸¢å¤±çš„æäº¤ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 # æŸ¥çœ‹reflog git reflog # æŸ¥çœ‹ç‰¹å®šåˆ†æ”¯çš„reflog git reflog main # æŸ¥çœ‹è¯¦ç»†çš„reflog git reflog --show-signature # æ¢å¤ä¸¢å¤±çš„æäº¤ git reset --hard HEAD@{2} git checkout -b recovered-branch HEAD@{5} # æŸ¥çœ‹ç‰¹å®šæ—¶é—´ä¹‹åçš„æ“ä½œ git reflog --since=\u0026#34;2 weeks ago\u0026#34; # æŸ¥æ‰¾ä¸¢å¤±çš„æäº¤ git fsck --lost-found git log --walk-reflogs --show-signature --pretty=fuller Reflogå®é™…åº”ç”¨åœºæ™¯ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 # åœºæ™¯1ï¼šæ„å¤–é‡ç½®åæ¢å¤ git reset --hard HEAD~5 # æ„å¤–é‡ç½® # æ¢å¤ git reset --hard HEAD@{1} # åœºæ™¯2ï¼šåˆ é™¤åˆ†æ”¯åæ¢å¤ git branch -D feature-branch # æ¢å¤ git checkout -b feature-branch HEAD@{3} # åœºæ™¯3ï¼šå˜åŸºå¤±è´¥åæ¢å¤ git rebase main # å˜åŸºå‡ºç°é—®é¢˜ # æ¢å¤åˆ°å˜åŸºå‰çš„çŠ¶æ€ git reset --hard ORIG_HEAD git reset --hard HEAD@{1} Stashé«˜çº§ç”¨æ³• çµæ´»ä½¿ç”¨Stash 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 # åŸºç¡€stash git stash # å¸¦æ¶ˆæ¯çš„stash git stash save \u0026#34;Work in progress on feature X\u0026#34; # åŒ…æ‹¬æœªè·Ÿè¸ªæ–‡ä»¶ git stash -u git stash --include-untracked # åªstashæš‚å­˜çš„æ–‡ä»¶ git stash --keep-index # æŸ¥çœ‹stashåˆ—è¡¨ git stash list # æŸ¥çœ‹stashå†…å®¹ git stash show stash@{0} git stash show -p stash@{0} # æŸ¥çœ‹è¯¦ç»†å·®å¼‚ # åº”ç”¨stash git stash apply stash@{0} git stash pop # åº”ç”¨å¹¶åˆ é™¤ # åˆ›å»ºåˆ†æ”¯ä»stash git stash branch new-branch stash@{0} Stashé«˜çº§æ“ä½œ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 # äº¤äº’å¼stash git stash -p # å¯ä»¥é€‰æ‹©æ€§åœ°stashéƒ¨åˆ†æ›´æ”¹ # Stashç‰¹å®šæ–‡ä»¶ git stash push -m \u0026#34;Partial stash\u0026#34; -- file1.js file2.js # æ¸…ç†stash git stash clear # æ¸…ç©ºæ‰€æœ‰stash git stash drop stash@{0} # åˆ é™¤ç‰¹å®šstash # è¿½è¸ªstashçš„æ¥æº git log --oneline --graph --decorate stash@{0}^2 # ä»å…¶ä»–åˆ†æ”¯åº”ç”¨stash git stash branch test-branch stash@{1} Bisectè°ƒè¯• äºŒåˆ†æŸ¥æ‰¾é—®é¢˜æäº¤ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 # å¼€å§‹bisect git bisect start # æ ‡è®°å½“å‰ç‰ˆæœ¬ä¸ºåçš„ git bisect bad # æ ‡è®°å·²çŸ¥å¥½çš„ç‰ˆæœ¬ git bisect good v2.0.0 # Gitä¼šåˆ‡æ¢åˆ°ä¸­é—´ç‰ˆæœ¬ï¼Œæµ‹è¯•åæ ‡è®° git bisect bad # æˆ– git bisect good # ç»§ç»­æµ‹è¯•ç›´åˆ°æ‰¾åˆ°é—®é¢˜æäº¤ git bisect reset # ç»“æŸbisectï¼Œè¿”å›åŸå§‹åˆ†æ”¯ # è‡ªåŠ¨åŒ–bisectï¼ˆéœ€è¦æµ‹è¯•è„šæœ¬ï¼‰ git bisect run npm test Bisecté«˜çº§æŠ€å·§ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 # ä½¿ç”¨ç‰¹å®šçš„èŒƒå›´ git bisect start HEAD v1.0.0 # è·³è¿‡æŸäº›æäº¤ git bisect skip # æŸ¥çœ‹bisectæ—¥å¿— git bisect log # åœ¨ç‰¹å®šåˆ†æ”¯bisect git bisect start main feature-branch # ä½¿ç”¨å¯è§†åŒ–å·¥å…· git bisect visualize # æˆ– gitk --bisect # é‡ç½®åˆ°æŸä¸ªçŠ¶æ€ git bisect reset HEAD Submoduleç®¡ç† æ·»åŠ å’Œç®¡ç†å­æ¨¡å— 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 # æ·»åŠ å­æ¨¡å— git submodule add https://github.com/user/repo.git path/to/submodule # å…‹éš†åŒ…å«å­æ¨¡å—çš„ä»“åº“ git clone --recursive https://github.com/user/main-repo.git # åˆå§‹åŒ–å¹¶æ›´æ–°å­æ¨¡å— git submodule init git submodule update # ä¸€é”®å…‹éš†å’Œåˆå§‹åŒ– git clone --recursive https://github.com/user/main-repo.git git submodule update --init --recursive # æŸ¥çœ‹å­æ¨¡å—çŠ¶æ€ git submodule status å­æ¨¡å—é«˜çº§æ“ä½œ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 # æ›´æ–°æ‰€æœ‰å­æ¨¡å—åˆ°æœ€æ–° git submodule foreach git pull origin main # æ›´æ–°åˆ°æŒ‡å®šçš„commit cd path/to/submodule git checkout \u0026lt;commit-hash\u0026gt; cd ../.. git add path/to/submodule git commit -m \u0026#34;Update submodule to specific commit\u0026#34; # åˆ é™¤å­æ¨¡å— git submodule deinit path/to/submodule git rm path/to/submodule rm -rf .git/modules/path/to/submodule # åŒæ­¥å­æ¨¡å—URL git submodule sync # æ‰¹é‡æ“ä½œå­æ¨¡å— git submodule foreach \u0026#39;git checkout stable \u0026amp;\u0026amp; git pull\u0026#39; é«˜çº§é…ç½®ä¸ä¼˜åŒ– Gitæ€§èƒ½ä¼˜åŒ– 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 # å¯ç”¨æ–‡ä»¶ç³»ç»Ÿç›‘æ§ git config core.fsmonitor true # å¯ç”¨å¹¶è¡Œç´¢å¼• git config index.threads true # ä¼˜åŒ–å¤§ä»“åº“æ€§èƒ½ git config core.preloadindex true git config core.fscache true git config gc.auto 256 # å‹ç¼©å†å²è®°å½• git gc --aggressive --prune=now # ä½¿ç”¨Git LFSå¤„ç†å¤§æ–‡ä»¶ git lfs install git lfs track \u0026#34;*.psd\u0026#34; git add .gitattributes git add file.psd git commit -m \u0026#34;Add design file\u0026#34; è‡ªå®šä¹‰Gitåˆ«å 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 # å¸¸ç”¨åˆ«åé…ç½® git config --global alias.st status git config --global alias.co checkout git config --global alias.br branch git config --global alias.ci commit git config --global alias.unstage \u0026#39;reset HEAD --\u0026#39; git config --global alias.last \u0026#39;log -1 HEAD\u0026#39; git config --global alias.visual \u0026#39;!gitk\u0026#39; git config --global alias.graph \u0026#39;log --oneline --graph --decorate --all\u0026#39; git config --global alias.amend \u0026#39;commit --amend --no-edit\u0026#39; git config --global alias.undo \u0026#39;reset --soft HEAD~1\u0026#39; git config --global alias.wip \u0026#39;commit -m \u0026#34;WIP\u0026#34;\u0026#39; # é«˜çº§åˆ«å git config --global alias.publish \u0026#39;!f() { git push -u origin $(git rev-parse --abbrev-ref HEAD); }; f\u0026#39; git config --global alias.delete-merged \u0026#39;!git branch --merged | grep -v \u0026#34;\\*\u0026#34; | xargs -n 1 git branch -d\u0026#39; git config --global alias.clean-branches \u0026#39;!git branch -r | awk \u0026#34;{print \\$1}\u0026#34; | egrep -v -f /dev/fd/0 \u0026lt;(git branch -vv | grep origin) | awk \u0026#34;{print \\$1}\u0026#34; | xargs git branch -d\u0026#39; Hooksè‡ªåŠ¨åŒ– 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 # Pre-commit hookç¤ºä¾‹ #!/bin/sh # .git/hooks/pre-commit # è¿è¡Œlinting npm run lint # è¿è¡Œtests npm test # æ£€æŸ¥å¤§æ–‡ä»¶ MAX_FILE_SIZE=$(git config hooks.maxfilesize) if [ -z \u0026#34;$MAX_FILE_SIZE\u0026#34; ]; then MAX_FILE_SIZE=5242880 # 5MB fi large_files=$(git diff --cached --name-only | xargs -I{} find {} -type f -size +$MAX_FILE_SIZE 2\u0026gt;/dev/null) if [ -n \u0026#34;$large_files\u0026#34; ]; then echo \u0026#34;Error: Large files detected in commit:\u0026#34; echo \u0026#34;$large_files\u0026#34; exit 1 fi # Pre-push hookç¤ºä¾‹ #!/bin/sh # .git/hooks/pre-push # è¿è¡Œå®Œæ•´çš„æµ‹è¯•å¥—ä»¶ npm run test:coverage # æ£€æŸ¥åˆ†æ”¯æ˜¯å¦è¿‡æ—¶ current_branch=$(git rev-parse --abbrev-ref HEAD) git fetch origin if [ \u0026#34;$(git rev-parse $current_branch)\u0026#34; != \u0026#34;$(git rev-parse origin/$current_branch)\u0026#34; ]; then echo \u0026#34;Warning: Branch is behind origin/$current_branch\u0026#34; fi å·¥ä½œæ ‘ï¼ˆWorktreeï¼‰ å¤šå·¥ä½œç›®å½•ç®¡ç† 1 2 3 4 5 6 7 8 9 10 11 12 13 14 # åˆ›å»ºæ–°çš„å·¥ä½œæ ‘ git worktree add ../feature-branch feature-branch # åˆ›å»ºå¹¶æ£€å‡ºæ–°çš„å·¥ä½œæ ‘ git worktree add ../bugfix hotfix/bug-123 # æŸ¥çœ‹æ‰€æœ‰å·¥ä½œæ ‘ git worktree list # åˆ é™¤å·¥ä½œæ ‘ git worktree remove ../feature-branch # æ¸…ç†å·¥ä½œæ ‘ git worktree prune Worktreeå®æˆ˜åœºæ™¯ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 # åœºæ™¯1ï¼šåŒæ—¶å¤„ç†å¤šä¸ªåŠŸèƒ½ git worktree add ../feature-auth feature/auth git worktree add ../feature-payment feature/payment git worktree add ../hotfix-bug hotfix/critical-bug # åœºæ™¯2ï¼šä»£ç å®¡æŸ¥ git worktree add ../review-pr-123 pr-123 cd ../review-pr-123 # æŸ¥çœ‹PRä»£ç ï¼Œä¸æ±¡æŸ“ä¸»å·¥ä½œç›®å½• # åœºæ™¯3ï¼šå‘å¸ƒç‰ˆæœ¬ git worktree add ../release-v2.0.0 --detach v2.0.0 cd ../release-v2.0.0 # è¿›è¡Œå‘å¸ƒå‡†å¤‡å·¥ä½œ é«˜çº§åˆå¹¶æŠ€å·§ åˆå¹¶ç­–ç•¥é€‰æ‹© 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 # é»˜è®¤åˆå¹¶ï¼ˆå¿«è¿›æˆ–ä¸‰è·¯åˆå¹¶ï¼‰ git merge feature-branch # ç¦ç”¨å¿«è¿›åˆå¹¶ï¼ˆä¿ç•™åˆ†æ”¯å†å²ï¼‰ git merge --no-ff feature-branch # å‹ç¼©åˆå¹¶ï¼ˆå•ä¸ªæäº¤ï¼‰ git merge --squash feature-branch # ä»…åˆå¹¶ä¸æäº¤ git merge --no-commit feature-branch # é€‰æ‹©åˆå¹¶ç­–ç•¥ git merge -s recursive -X theirs feature-branch git merge -s ours feature-branch git merge -s subtree feature-branch è§£å†³å¤æ‚åˆå¹¶å†²çª 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 # ä½¿ç”¨åˆå¹¶å·¥å…· git mergetool # æŸ¥çœ‹å†²çªè¯¦æƒ… git diff git diff --ours git diff --theirs git diff --base # æ ‡è®°å†²çªå·²è§£å†³ git add \u0026lt;file\u0026gt; git commit # ä½¿ç”¨ours/theirsç­–ç•¥ git checkout --ours \u0026lt;file\u0026gt; git checkout --theirs \u0026lt;file\u0026gt; # é‡æ–°å¼€å§‹åˆå¹¶ git merge --abort æ€»ç»“ Gitçš„é«˜çº§æŠ€å·§æå¤§åœ°æå‡äº†ç‰ˆæœ¬æ§åˆ¶çš„çµæ´»æ€§å’Œæ•ˆç‡ï¼š\næ ¸å¿ƒæŠ€èƒ½ï¼š\næŒæ¡åˆ†æ”¯ç­–ç•¥å’Œå·¥ä½œæµ ç†Ÿç»ƒä½¿ç”¨å˜åŸºå’Œæ‹£é€‰ åˆ©ç”¨reflogå’Œstashç®¡ç†ä»£ç çŠ¶æ€ ä½¿ç”¨bisectå¿«é€Ÿå®šä½é—®é¢˜ é«˜çº§ç‰¹æ€§ï¼š\nå­æ¨¡å—ç®¡ç†å¤æ‚ä¾èµ– å·¥ä½œæ ‘å¤šç›®å½•å¼€å‘ Hooksè‡ªåŠ¨åŒ–æµç¨‹ æ€§èƒ½ä¼˜åŒ–é…ç½® æœ€ä½³å®è·µï¼š\nä¿æŒæäº¤å†å²æ¸…æ™° åˆç†ä½¿ç”¨åˆ†æ”¯ç­–ç•¥ å®šæœŸæ¸…ç†å’Œç»´æŠ¤ å›¢é˜Ÿåä½œè§„èŒƒ æŒæ¡è¿™äº›Gité«˜çº§æŠ€å·§ï¼Œå°†è®©ä½ åœ¨ç‰ˆæœ¬æ§åˆ¶ä¸­å¦‚é±¼å¾—æ°´ï¼Œå¤§å¹…æå‡å¼€å‘æ•ˆç‡ã€‚\nç›¸å…³èµ„æºï¼š\nPro Gitä¹¦ç± Gitå®˜æ–¹æ–‡æ¡£ GitHubå®˜æ–¹æŒ‡å— Git cheat sheet ","permalink":"/blog/articles/git-advanced-techniques/","summary":"æ·±å…¥Gitçš„é«˜çº§ç‰¹æ€§ï¼ŒæŒæ¡å¼ºå¤§çš„ç‰ˆæœ¬æ§åˆ¶æŠ€å·§ï¼Œæå‡å¼€å‘æ•ˆç‡å’Œå›¢é˜Ÿåä½œèƒ½åŠ›ã€‚","title":"Gité«˜çº§æŠ€å·§ï¼šæŒæ¡ç‰ˆæœ¬æ§åˆ¶çš„ç²¾é«“"},{"content":"å¼•è¨€ åœ¨å½“ä»Šçš„Webåº”ç”¨ä¸­ï¼Œæ€§èƒ½ä¼˜åŒ–å·²ç»æˆä¸ºæå‡ç”¨æˆ·ä½“éªŒçš„å…³é”®å› ç´ ã€‚ç ”ç©¶è¡¨æ˜ï¼ŒåŠ è½½æ—¶é—´æ¯å¢åŠ 1ç§’ï¼Œç”¨æˆ·æµå¤±ç‡å°±ä¼šæ˜¾è‘—ä¸Šå‡ã€‚æœ¬æ–‡å°†ä»å¤šä¸ªç»´åº¦æ·±å…¥æ¢è®¨å‰ç«¯æ€§èƒ½ä¼˜åŒ–ç­–ç•¥ï¼Œå¸®åŠ©ä½ æ„å»ºå‡ºå“åº”è¿…é€Ÿã€è¿è¡Œæµç•…çš„Webåº”ç”¨ã€‚\næ€§èƒ½æŒ‡æ ‡ä¸æµ‹é‡ Core Web Vitals LCPï¼ˆLargest Contentful Paintï¼‰ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 // æµ‹é‡LCP import { getCLS, getFID, getFCP, getLCP, getTTFB } from \u0026#39;web-vitals\u0026#39; getLCP(console.log) getFID(console.log) getCLS(console.log) // ä½¿ç”¨Performance Observer const observer = new PerformanceObserver((list) =\u0026gt; { const entries = list.getEntries() const lastEntry = entries[entries.length - 1] console.log(\u0026#39;LCP:\u0026#39;, lastEntry.startTime) }) observer.observe({ entryTypes: [\u0026#39;largest-contentful-paint\u0026#39;] }) FIDï¼ˆFirst Input Delayï¼‰ 1 2 3 4 5 6 7 8 // ç›‘å¬FID const fidObserver = new PerformanceObserver((list) =\u0026gt; { for (const entry of list.getEntries()) { console.log(\u0026#39;FID:\u0026#39;, entry.processingStart - entry.startTime) } }) fidObserver.observe({ entryTypes: [\u0026#39;first-input\u0026#39;] }) CLSï¼ˆCumulative Layout Shiftï¼‰ 1 2 3 4 5 6 7 8 9 10 11 12 // ç›‘å¬CLS let clsValue = 0 const clsObserver = new PerformanceObserver((list) =\u0026gt; { for (const entry of list.getEntries()) { if (!entry.hadRecentInput) { clsValue += entry.value } } console.log(\u0026#39;CLS:\u0026#39;, clsValue) }) clsObserver.observe({ entryTypes: [\u0026#39;layout-shift\u0026#39;] }) æ€§èƒ½ç›‘æ§å·¥å…· Lighthouseè‡ªåŠ¨åŒ–æµ‹è¯• 1 2 3 4 5 6 7 8 9 10 11 12 13 // ä½¿ç”¨Lighthouse CI const lighthouse = require(\u0026#39;lighthouse\u0026#39;) const chromeLauncher = require(\u0026#39;chrome-launcher\u0026#39;) async function runLighthouse(url) { const chrome = await chromeLauncher.launch({ chromeFlags: [\u0026#39;--headless\u0026#39;] }) const options = { logLevel: \u0026#39;info\u0026#39;, output: \u0026#39;json\u0026#39;, port: chrome.port } const runnerResult = await lighthouse(url, options) await chrome.kill() return runnerResult.lhr } è‡ªå®šä¹‰æ€§èƒ½ç›‘æ§ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 class PerformanceMonitor { constructor() { this.metrics = {} this.observers = [] } startTiming(name) { performance.mark(`${name}-start`) } endTiming(name) { performance.mark(`${name}-end`) performance.measure(name, `${name}-start`, `${name}-end`) const measure = performance.getEntriesByName(name)[0] this.metrics[name] = measure.duration return measure.duration } observeResourceTiming() { const observer = new PerformanceObserver((list) =\u0026gt; { for (const entry of list.getEntries()) { console.log(`${entry.name}: ${entry.duration}ms`) } }) observer.observe({ entryTypes: [\u0026#39;resource\u0026#39;] }) this.observers.push(observer) } } èµ„æºåŠ è½½ä¼˜åŒ– å›¾ç‰‡ä¼˜åŒ– WebPæ ¼å¼æ”¯æŒ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 // Pictureå…ƒç´ å®ç°å“åº”å¼å›¾ç‰‡ \u0026lt;picture\u0026gt; \u0026lt;source srcset=\u0026#34;image.webp\u0026#34; type=\u0026#34;image/webp\u0026#34;\u0026gt; \u0026lt;source srcset=\u0026#34;image.jpg\u0026#34; type=\u0026#34;image/jpeg\u0026#34;\u0026gt; \u0026lt;img src=\u0026#34;image.jpg\u0026#34; alt=\u0026#34;æè¿°\u0026#34; loading=\u0026#34;lazy\u0026#34;\u0026gt; \u0026lt;/picture\u0026gt; // åŠ¨æ€æ£€æµ‹WebPæ”¯æŒ function supportsWebP() { return new Promise(resolve =\u0026gt; { const webP = new Image() webP.onload = webP.onerror = () =\u0026gt; { resolve(webP.height === 2) } webP.src = \u0026#39;data:image/webp;base64,UklGRjoAAABXRUJQVlA4IC4AAACyAgCdASoCAAIALmk0mk0iIiIiIgBoSygABc6WWgAA/veff/0PP8bA//LwYAAA\u0026#39; }) } å›¾ç‰‡æ‡’åŠ è½½ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 // Intersection Observerå®ç°æ‡’åŠ è½½ class LazyLoader { constructor() { this.observer = new IntersectionObserver( this.handleIntersection.bind(this), { rootMargin: \u0026#39;50px\u0026#39; } ) } observe(element) { this.observer.observe(element) } handleIntersection(entries) { entries.forEach(entry =\u0026gt; { if (entry.isIntersecting) { const img = entry.target img.src = img.dataset.src img.srcset = img.dataset.srcset this.observer.unobserve(img) } }) } } // ä½¿ç”¨ const lazyLoader = new LazyLoader() document.querySelectorAll(\u0026#39;img[data-src]\u0026#39;).forEach(img =\u0026gt; { lazyLoader.observe(img) }) è„šæœ¬åŠ è½½ä¼˜åŒ– éé˜»å¡è„šæœ¬åŠ è½½ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 \u0026lt;!-- å¼‚æ­¥åŠ è½½ --\u0026gt; \u0026lt;script src=\u0026#34;app.js\u0026#34; async\u0026gt;\u0026lt;/script\u0026gt; \u0026lt;!-- å»¶è¿ŸåŠ è½½ --\u0026gt; \u0026lt;script src=\u0026#34;analytics.js\u0026#34; defer\u0026gt;\u0026lt;/script\u0026gt; \u0026lt;!-- åŠ¨æ€åŠ è½½ --\u0026gt; \u0026lt;script\u0026gt; function loadScript(src, async = true, defer = false) { const script = document.createElement(\u0026#39;script\u0026#39;) script.src = src script.async = async script.defer = defer return new Promise((resolve, reject) =\u0026gt; { script.onload = resolve script.onerror = reject document.head.appendChild(script) }) } // æŒ‰éœ€åŠ è½½ document.addEventListener(\u0026#39;DOMContentLoaded\u0026#39;, () =\u0026gt; { loadScript(\u0026#39;/js/analytics.js\u0026#39;, true, true) }) \u0026lt;/script\u0026gt; æ¨¡å—é¢„åŠ è½½ 1 2 3 4 5 6 7 \u0026lt;!-- é¢„åŠ è½½å…³é”®èµ„æº --\u0026gt; \u0026lt;link rel=\u0026#34;preload\u0026#34; href=\u0026#34;/fonts/main.woff2\u0026#34; as=\u0026#34;font\u0026#34; type=\u0026#34;font/woff2\u0026#34; crossorigin\u0026gt; \u0026lt;link rel=\u0026#34;preload\u0026#34; href=\u0026#34;/js/critical.js\u0026#34; as=\u0026#34;script\u0026#34;\u0026gt; \u0026lt;!-- é¢„å–å¯èƒ½éœ€è¦çš„èµ„æº --\u0026gt; \u0026lt;link rel=\u0026#34;prefetch\u0026#34; href=\u0026#34;/js/next-page.js\u0026#34;\u0026gt; \u0026lt;link rel=\u0026#34;dns-prefetch\u0026#34; href=\u0026#34;//api.example.com\u0026#34;\u0026gt; CSSä¼˜åŒ– å…³é”®CSSå†…è” 1 2 3 4 5 6 7 8 9 10 // æå–å…³é”®CSS const criticalCSS = ` body { margin: 0; font-family: -apple-system, BlinkMacSystemFont, sans-serif; } .header { background: #fff; padding: 1rem; } ` // å†…è”åˆ°HTML document.head.insertAdjacentHTML(\u0026#39;beforeend\u0026#39;, `\u0026lt;style\u0026gt;${criticalCSS}\u0026lt;/style\u0026gt;` ) CSSå¼‚æ­¥åŠ è½½ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 \u0026lt;!-- é˜²é˜»å¡æ€§CSSåŠ è½½ --\u0026gt; \u0026lt;link rel=\u0026#34;preload\u0026#34; href=\u0026#34;styles.css\u0026#34; as=\u0026#34;style\u0026#34; onload=\u0026#34;this.onload=null;this.rel=\u0026#39;stylesheet\u0026#39;\u0026#34;\u0026gt; \u0026lt;noscript\u0026gt;\u0026lt;link rel=\u0026#34;stylesheet\u0026#34; href=\u0026#34;styles.css\u0026#34;\u0026gt;\u0026lt;/noscript\u0026gt; \u0026lt;!-- æˆ–è€…ä½¿ç”¨JavaScript --\u0026gt; \u0026lt;script\u0026gt; function loadCSS(href) { const link = document.createElement(\u0026#39;link\u0026#39;) link.rel = \u0026#39;stylesheet\u0026#39; link.href = href document.head.appendChild(link) } // åœ¨äº¤äº’ååŠ è½½éå…³é”®CSS window.addEventListener(\u0026#39;load\u0026#39;, () =\u0026gt; { loadCSS(\u0026#39;/styles/non-critical.css\u0026#39;) }) \u0026lt;/script\u0026gt; ä»£ç ä¼˜åŒ– JavaScriptä¼˜åŒ– é˜²æŠ–ä¸èŠ‚æµ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 // é˜²æŠ– function debounce(func, wait) { let timeout return function executedFunction(...args) { const later = () =\u0026gt; { clearTimeout(timeout) func(...args) } clearTimeout(timeout) timeout = setTimeout(later, wait) } } // èŠ‚æµ function throttle(func, limit) { let inThrottle return function(...args) { if (!inThrottle) { func.apply(this, args) inThrottle = true setTimeout(() =\u0026gt; inThrottle = false, limit) } } } // ä½¿ç”¨ç¤ºä¾‹ const searchInput = document.getElementById(\u0026#39;search\u0026#39;) searchInput.addEventListener(\u0026#39;input\u0026#39;, debounce(handleSearch, 300)) window.addEventListener(\u0026#39;scroll\u0026#39;, throttle(handleScroll, 100)) è™šæ‹Ÿæ»šåŠ¨ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 class VirtualList { constructor(container, itemHeight, renderItem) { this.container = container this.itemHeight = itemHeight this.renderItem = renderItem this.visibleItems = [] this.startIndex = 0 this.endIndex = 0 this.init() } init() { this.container.style.overflowY = \u0026#39;auto\u0026#39; this.container.style.height = \u0026#39;400px\u0026#39; // åˆ›å»ºå ä½å…ƒç´  this.placeholder = document.createElement(\u0026#39;div\u0026#39;) this.container.appendChild(this.placeholder) this.container.addEventListener(\u0026#39;scroll\u0026#39;, this.handleScroll.bind(this) ) } handleScroll() { const scrollTop = this.container.scrollTop const containerHeight = this.container.clientHeight this.startIndex = Math.floor(scrollTop / this.itemHeight) this.endIndex = Math.min( this.startIndex + Math.ceil(containerHeight / this.itemHeight) + 1, this.items.length - 1 ) this.renderVisibleItems() } renderVisibleItems() { // æ¸…ç†æ—§å…ƒç´  this.visibleItems.forEach(el =\u0026gt; el.remove()) this.visibleItems = [] // æ¸²æŸ“å¯è§é¡¹ for (let i = this.startIndex; i \u0026lt;= this.endIndex; i++) { const item = this.renderItem(this.items[i], i) item.style.position = \u0026#39;absolute\u0026#39; item.style.top = `${i * this.itemHeight}px` this.container.appendChild(item) this.visibleItems.push(item) } // æ›´æ–°å ä½å…ƒç´ é«˜åº¦ this.placeholder.style.height = `${this.items.length * this.itemHeight}px` } setItems(items) { this.items = items this.handleScroll() } } å†…å­˜ç®¡ç† é¿å…å†…å­˜æ³„æ¼ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 class ComponentManager { constructor() { this.components = new Map() this.observers = [] } addComponent(id, component) { this.components.set(id, component) // æ·»åŠ æ¸…ç†å‡½æ•° component.cleanup = () =\u0026gt; { // æ¸…ç†äº‹ä»¶ç›‘å¬å™¨ component.element?.removeEventListener() // æ¸…ç†å®šæ—¶å™¨ if (component.timer) { clearInterval(component.timer) } // æ¸…ç†è§‚å¯Ÿè€… component.observer?.disconnect() } } removeComponent(id) { const component = this.components.get(id) if (component \u0026amp;\u0026amp; typeof component.cleanup === \u0026#39;function\u0026#39;) { component.cleanup() } this.components.delete(id) } cleanup() { this.components.forEach((_, id) =\u0026gt; { this.removeComponent(id) }) this.observers.forEach(observer =\u0026gt; observer.disconnect()) } } // é¡µé¢å¸è½½æ—¶æ¸…ç† window.addEventListener(\u0026#39;beforeunload\u0026#39;, () =\u0026gt; { componentManager.cleanup() }) ç¼“å­˜ç­–ç•¥ HTTPç¼“å­˜ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 // Service Workerç¼“å­˜ const CACHE_NAME = \u0026#39;app-v1\u0026#39; const urlsToCache = [ \u0026#39;/\u0026#39;, \u0026#39;/js/main.js\u0026#39;, \u0026#39;/css/main.css\u0026#39;, \u0026#39;/images/logo.png\u0026#39; ] self.addEventListener(\u0026#39;install\u0026#39;, (event) =\u0026gt; { event.waitUntil( caches.open(CACHE_NAME) .then((cache) =\u0026gt; cache.addAll(urlsToCache)) ) }) self.addEventListener(\u0026#39;fetch\u0026#39;, (event) =\u0026gt; { event.respondWith( caches.match(event.request) .then((response) =\u0026gt; { // ç¼“å­˜å‘½ä¸­ if (response) { return response } // ç½‘ç»œè¯·æ±‚ return fetch(event.request) .then((response) =\u0026gt; { // æ£€æŸ¥æ˜¯å¦æœ‰æ•ˆå“åº” if (!response || response.status !== 200 || response.type !== \u0026#39;basic\u0026#39;) { return response } // å…‹éš†å“åº” const responseToCache = response.clone() caches.open(CACHE_NAME) .then((cache) =\u0026gt; { cache.put(event.request, responseToCache) }) return response }) }) ) }) æµè§ˆå™¨ç¼“å­˜ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 // IndexedDBç¼“å­˜å¤§æ•°æ® class DataCache { constructor(dbName = \u0026#39;AppCache\u0026#39;, storeName = \u0026#39;data\u0026#39;) { this.dbName = dbName this.storeName = storeName } async init() { return new Promise((resolve, reject) =\u0026gt; { const request = indexedDB.open(this.dbName, 1) request.onerror = () =\u0026gt; reject(request.error) request.onsuccess = () =\u0026gt; { this.db = request.result resolve() } request.onupgradeneeded = (event) =\u0026gt; { const db = event.target.result if (!db.objectStoreNames.contains(this.storeName)) { db.createObjectStore(this.storeName, { keyPath: \u0026#39;key\u0026#39; }) } } }) } async set(key, data, ttl = 3600000) { // é»˜è®¤1å°æ—¶ const transaction = this.db.transaction([this.storeName], \u0026#39;readwrite\u0026#39;) const store = transaction.objectStore(this.storeName) const item = { key, data, timestamp: Date.now(), ttl } return new Promise((resolve, reject) =\u0026gt; { const request = store.put(item) request.onsuccess = () =\u0026gt; resolve() request.onerror = () =\u0026gt; reject(request.error) }) } async get(key) { const transaction = this.db.transaction([this.storeName], \u0026#39;readonly\u0026#39;) const store = transaction.objectStore(this.storeName) return new Promise((resolve, reject) =\u0026gt; { const request = store.get(key) request.onsuccess = () =\u0026gt; { const item = request.result if (!item) { resolve(null) return } // æ£€æŸ¥æ˜¯å¦è¿‡æœŸ if (Date.now() - item.timestamp \u0026gt; item.ttl) { this.delete(key) resolve(null) return } resolve(item.data) } request.onerror = () =\u0026gt; reject(request.error) }) } async delete(key) { const transaction = this.db.transaction([this.storeName], \u0026#39;readwrite\u0026#39;) const store = transaction.objectStore(this.storeName) return new Promise((resolve, reject) =\u0026gt; { const request = store.delete(key) request.onsuccess = () =\u0026gt; resolve() request.onerror = () =\u0026gt; reject(request.error) }) } } æ¸²æŸ“ä¼˜åŒ– å‡å°‘é‡ç»˜å’Œé‡æ’ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 // æ‰¹é‡DOMæ“ä½œ class BatchDOMUpdate { constructor() { this.pendingUpdates = [] this.isScheduled = false } add(update) { this.pendingUpdates.push(update) this.schedule() } schedule() { if (this.isScheduled) return this.isScheduled = true requestAnimationFrame(() =\u0026gt; { this.flush() this.isScheduled = false }) } flush() { // ä½¿ç”¨DocumentFragmentæ‰¹é‡æ›´æ–° const fragment = document.createDocumentFragment() this.pendingUpdates.forEach(update =\u0026gt; { if (typeof update === \u0026#39;function\u0026#39;) { update(fragment) } }) if (fragment.children.length \u0026gt; 0) { document.body.appendChild(fragment) } this.pendingUpdates = [] } } // ä½¿ç”¨ç¤ºä¾‹ const batchUpdate = new BatchDOMUpdate() // æ‰¹é‡æ·»åŠ å…ƒç´  for (let i = 0; i \u0026lt; 1000; i++) { batchUpdate.add((fragment) =\u0026gt; { const div = document.createElement(\u0026#39;div\u0026#39;) div.textContent = `Item ${i}` fragment.appendChild(div) }) } CSSåŠ¨ç”»ä¼˜åŒ– 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 /* ä½¿ç”¨transformå’Œopacity */ .optimized-animation { will-change: transform, opacity; transform: translateZ(0); /* è§¦å‘ç¡¬ä»¶åŠ é€Ÿ */ backface-visibility: hidden; } /* é¿å…å¸ƒå±€æŠ–åŠ¨ */ .layout-stable { position: absolute; width: 100px; height: 100px; transform: translateX(0); transition: transform 0.3s ease-out; } .layout-stable.move { transform: translateX(100px); } Web Workersä¼˜åŒ– 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 // ä¸»çº¿ç¨‹ class WorkerPool { constructor(workerScript, poolSize = 4) { this.workers = [] this.taskQueue = [] this.poolSize = poolSize this.initWorkers(workerScript) } initWorkers(workerScript) { for (let i = 0; i \u0026lt; this.poolSize; i++) { const worker = new Worker(workerScript) worker.addEventListener(\u0026#39;message\u0026#39;, this.handleWorkerMessage.bind(this)) this.workers.push({ worker, busy: false }) } } execute(data) { return new Promise((resolve, reject) =\u0026gt; { this.taskQueue.push({ data, resolve, reject }) this.processQueue() }) } processQueue() { if (this.taskQueue.length === 0) return const availableWorker = this.workers.find(w =\u0026gt; !w.busy) if (!availableWorker) return const task = this.taskQueue.shift() availableWorker.busy = true availableWorker.currentTask = task availableWorker.worker.postMessage(task.data) } handleWorkerMessage(event) { const worker = this.workers.find(w =\u0026gt; w.worker === event.target) if (worker \u0026amp;\u0026amp; worker.busy) { const { resolve } = worker.currentTask resolve(event.data) worker.busy = false worker.currentTask = null this.processQueue() } } } // Workerè„šæœ¬ (worker.js) self.addEventListener(\u0026#39;message\u0026#39;, (event) =\u0026gt; { const { data } = event // æ‰§è¡Œé‡è®¡ç®—ä»»åŠ¡ const result = heavyComputation(data) // è¿”å›ç»“æœ self.postMessage(result) }) function heavyComputation(data) { // CPUå¯†é›†å‹è®¡ç®— return data.reduce((acc, item) =\u0026gt; acc + item * item, 0) } ç½‘ç»œä¼˜åŒ– HTTP/2å’ŒHTTP/3 1 2 3 4 5 6 7 8 9 10 11 12 13 // æœåŠ¡å™¨æ¨é€å…³é”®èµ„æº // åœ¨æœåŠ¡å™¨é…ç½®ä¸­ res.push(\u0026#39;/css/critical.css\u0026#39;) res.push(\u0026#39;/js/main.js\u0026#39;) // ä½¿ç”¨è¿æ¥å¤ç”¨ const fetchWithHttp2 = async (url) =\u0026gt; { const response = await fetch(url, { // HTTP/2è‡ªåŠ¨å¤ç”¨è¿æ¥ keepalive: true }) return response.json() } æ•°æ®å‹ç¼© 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 // å¯ç”¨Brotliå‹ç¼© // .htaccessé…ç½® \u0026lt;IfModule mod_brotli.c\u0026gt; AddOutputFilterByType DEFLATE application/json AddOutputFilterByType DEFLATE application/javascript AddOutputFilterByType DEFLATE text/css AddOutputFilterByType DEFLATE text/html \u0026lt;/IfModule\u0026gt; // å‰ç«¯å‹ç¼©æ•°æ® function compressData(data) { const jsonString = JSON.stringify(data) // å¦‚æœæµè§ˆå™¨æ”¯æŒCompressionStream if (\u0026#39;CompressionStream\u0026#39; in window) { const stream = new CompressionStream(\u0026#39;gzip\u0026#39;) const writer = stream.writable.getWriter() const reader = stream.readable.getReader() writer.write(new TextEncoder().encode(jsonString)) writer.close() return new Response(stream.readable).arrayBuffer() } return new TextEncoder().encode(jsonString) } æ€§èƒ½ç›‘æ§ä¸å‘Šè­¦ Real User Monitoring (RUM) 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 class RUMMonitor { constructor(apiEndpoint) { this.apiEndpoint = apiEndpoint this.metrics = {} this.init() } init() { // ç›‘æ§é¡µé¢åŠ è½½ window.addEventListener(\u0026#39;load\u0026#39;, () =\u0026gt; { this.collectPageMetrics() }) // ç›‘æ§ç”¨æˆ·äº¤äº’ this.monitorUserInteractions() // ç›‘æ§èµ„æºåŠ è½½ this.monitorResourceLoading() } collectPageMetrics() { const navigation = performance.getEntriesByType(\u0026#39;navigation\u0026#39;)[0] this.metrics = { dns: navigation.domainLookupEnd - navigation.domainLookupStart, tcp: navigation.connectEnd - navigation.connectStart, ssl: navigation.secureConnectionStart \u0026gt; 0 ? navigation.connectEnd - navigation.secureConnectionStart : 0, ttfb: navigation.responseStart - navigation.requestStart, download: navigation.responseEnd - navigation.responseStart, domParse: navigation.domContentLoadedEventStart - navigation.responseEnd, domReady: navigation.domContentLoadedEventEnd - navigation.domContentLoadedEventStart, loadComplete: navigation.loadEventEnd - navigation.loadEventStart } this.sendMetrics() } monitorUserInteractions() { [\u0026#39;click\u0026#39;, \u0026#39;touchstart\u0026#39;].forEach(eventType =\u0026gt; { document.addEventListener(eventType, (event) =\u0026gt; { const startTime = performance.now() requestAnimationFrame(() =\u0026gt; { const responseTime = performance.now() - startTime if (responseTime \u0026gt; 100) { // è¶…è¿‡100msçš„äº¤äº’ this.recordSlowInteraction({ type: eventType, target: event.target.tagName, responseTime }) } }) }) }) } monitorResourceLoading() { const observer = new PerformanceObserver((list) =\u0026gt; { for (const entry of list.getEntries()) { if (entry.duration \u0026gt; 1000) { // è¶…è¿‡1ç§’çš„èµ„æº this.recordSlowResource({ name: entry.name, duration: entry.duration, size: entry.transferSize }) } } }) observer.observe({ entryTypes: [\u0026#39;resource\u0026#39;] }) } async sendMetrics() { try { await fetch(this.apiEndpoint, { method: \u0026#39;POST\u0026#39;, headers: { \u0026#39;Content-Type\u0026#39;: \u0026#39;application/json\u0026#39; }, body: JSON.stringify({ url: window.location.href, userAgent: navigator.userAgent, timestamp: Date.now(), metrics: this.metrics }) }) } catch (error) { console.error(\u0026#39;Failed to send metrics:\u0026#39;, error) } } recordSlowInteraction(data) { this.sendMetrics({ type: \u0026#39;slow_interaction\u0026#39;, ...data }) } recordSlowResource(data) { this.sendMetrics({ type: \u0026#39;slow_resource\u0026#39;, ...data }) } } // åˆå§‹åŒ–ç›‘æ§ const rumMonitor = new RUMMonitor(\u0026#39;/api/analytics/performance\u0026#39;) æ€»ç»“ å‰ç«¯æ€§èƒ½ä¼˜åŒ–æ˜¯ä¸€ä¸ªæŒç»­çš„è¿‡ç¨‹ï¼Œéœ€è¦ä»å¤šä¸ªç»´åº¦è¿›è¡Œè€ƒè™‘ï¼š\nåŠ è½½æ€§èƒ½ä¼˜åŒ–ï¼š\nå›¾ç‰‡ä¼˜åŒ–å’Œæ‡’åŠ è½½ èµ„æºé¢„åŠ è½½å’Œé¢„å– ä»£ç åˆ†å‰²å’ŒæŒ‰éœ€åŠ è½½ ç¼“å­˜ç­–ç•¥ä¼˜åŒ– è¿è¡Œæ—¶æ€§èƒ½ä¼˜åŒ–ï¼š\nå‡å°‘é‡ç»˜å’Œé‡æ’ ä¼˜åŒ–JavaScriptæ‰§è¡Œ ä½¿ç”¨Web Workerså¤„ç†é‡ä»»åŠ¡ å®ç°è™šæ‹Ÿæ»šåŠ¨ç­‰ä¼˜åŒ–æŠ€æœ¯ ç½‘ç»œä¼˜åŒ–ï¼š\nå¯ç”¨HTTP/2å’Œå‹ç¼© CDNåŠ é€Ÿ èµ„æºåˆå¹¶å’Œå‹ç¼© å‡å°‘HTTPè¯·æ±‚æ•° ç›‘æ§ä¸æµ‹é‡ï¼š\nCore Web Vitalsç›‘æ§ Real User Monitoring æ€§èƒ½å‘Šè­¦æœºåˆ¶ æŒç»­æ€§èƒ½ä¼˜åŒ– é€šè¿‡ç³»ç»Ÿæ€§çš„æ€§èƒ½ä¼˜åŒ–ï¼Œæˆ‘ä»¬å¯ä»¥æ˜¾è‘—æå‡ç”¨æˆ·ä½“éªŒï¼Œè®©ç½‘ç«™çœŸæ­£å®ç°\u0026quot;å¿«å¦‚é—ªç”µ\u0026quot;çš„åŠ è½½é€Ÿåº¦ã€‚\nç›¸å…³èµ„æºï¼š\nWeb.devæ€§èƒ½æŒ‡å— Core Web Vitals Lighthouseæ€§èƒ½åˆ†æ Web Performance API ","permalink":"/blog/articles/frontend-performance-optimization/","summary":"å…¨é¢æŒæ¡å‰ç«¯æ€§èƒ½ä¼˜åŒ–æŠ€å·§ï¼Œä»åŠ è½½é€Ÿåº¦åˆ°è¿è¡Œæ—¶æ€§èƒ½ï¼Œæ‰“é€ æé€Ÿç”¨æˆ·ä½“éªŒã€‚","title":"å‰ç«¯æ€§èƒ½ä¼˜åŒ–å®Œå…¨æŒ‡å—ï¼šè®©ä½ çš„ç½‘ç«™å¿«å¦‚é—ªç”µ"},{"content":"å¼•è¨€ RESTï¼ˆRepresentational State Transferï¼‰å·²æˆä¸ºWeb APIè®¾è®¡çš„äº‹å®æ ‡å‡†ã€‚ä¸€ä¸ªå¥½çš„RESTful APIä¸ä»…åŠŸèƒ½å®Œå–„ï¼Œè¿˜åº”è¯¥å…·å¤‡è‰¯å¥½çš„å¯è¯»æ€§ã€ä¸€è‡´æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚æœ¬æ–‡å°†æ·±å…¥æ¢è®¨RESTful APIçš„è®¾è®¡åŸåˆ™ï¼Œé€šè¿‡å®ä¾‹å±•ç¤ºå¦‚ä½•æ„å»ºä¼˜é›…çš„APIæ¥å£ã€‚\nRESTæ¶æ„åŸåˆ™ 1. å®¢æˆ·ç«¯-æœåŠ¡å™¨æ¶æ„ï¼ˆClient-Serverï¼‰ å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨åˆ†ç¦»ï¼Œå„è‡ªç‹¬ç«‹æ¼”è¿›ï¼š\nå®¢æˆ·ç«¯ \u0026lt;----------\u0026gt; API \u0026lt;----------\u0026gt; æœåŠ¡å™¨ 2. æ— çŠ¶æ€ï¼ˆStatelessï¼‰ æ¯ä¸ªè¯·æ±‚éƒ½åŒ…å«å¤„ç†è¯·æ±‚æ‰€éœ€çš„æ‰€æœ‰ä¿¡æ¯ï¼š\n1 2 3 4 5 6 7 // âœ… æ¯æ¬¡è¯·æ±‚éƒ½æºå¸¦è®¤è¯ä¿¡æ¯ GET /api/users/123 Authorization: Bearer \u0026lt;token\u0026gt; // âŒ ä¾èµ–æœåŠ¡å™¨çŠ¶æ€ GET /api/users/123 // æœåŠ¡å™¨éœ€è¦è®°ä½ä¹‹å‰çš„ç™»å½•çŠ¶æ€ 3. å¯ç¼“å­˜ï¼ˆCacheableï¼‰ å“åº”åº”è¯¥æ˜ç¡®æ ‡è¯†æ˜¯å¦å¯ç¼“å­˜ï¼š\n1 2 3 4 5 6 7 8 // å¯ç¼“å­˜çš„å“åº” GET /api/users/123 Cache-Control: max-age=3600, public ETag: \u0026#34;abc123\u0026#34; // ä¸å¯ç¼“å­˜çš„å“åº” POST /api/users Cache-Control: no-cache, no-store 4. ç»Ÿä¸€æ¥å£ï¼ˆUniform Interfaceï¼‰ ä½¿ç”¨ç»Ÿä¸€çš„èµ„æºæ ‡è¯†å’Œæ ‡å‡†HTTPæ–¹æ³•ã€‚\nURLè®¾è®¡åŸåˆ™ ä½¿ç”¨åè¯è€ŒéåŠ¨è¯ 1 2 3 4 5 6 7 8 9 10 11 // âœ… ä½¿ç”¨åè¯ GET /api/users GET /api/users/123 POST /api/users PUT /api/users/123 DELETE /api/users/123 // âŒ ä½¿ç”¨åŠ¨è¯ GET /api/getAllUsers GET /api/getUserById/123 POST /api/createUser ä½¿ç”¨å¤æ•°å½¢å¼ 1 2 3 4 5 6 7 8 // âœ… ä½¿ç”¨å¤æ•° GET /api/users GET /api/products GET /api/orders // âœ… ä¸€è‡´æ€§ GET /api/users/123/orders GET /api/users/123/orders/456 åˆç†çš„èµ„æºåµŒå¥— 1 2 3 4 5 6 7 8 9 // âœ… åˆç†çš„åµŒå¥—å±‚çº§ GET /api/users/123/orders GET /api/orders/456/items // âŒ è¿‡æ·±çš„åµŒå¥— GET /api/users/123/orders/456/items/789/reviews/901 // âœ… ä½¿ç”¨æŸ¥è¯¢å‚æ•°ä»£æ›¿æ·±å±‚åµŒå¥— GET /api/reviews?user=123\u0026amp;order=456 ä½¿ç”¨è¿å­—ç¬¦åˆ†éš”ç¬¦ 1 2 3 4 5 6 // âœ… ä½¿ç”¨è¿å­—ç¬¦ GET /api/user-profiles GET /api/order-items // âœ… é¿å…ä½¿ç”¨é©¼å³° // GET /api/userProfiles HTTPæ–¹æ³•ä½¿ç”¨æŒ‡å— GET - è·å–èµ„æº 1 2 3 4 5 6 7 8 // è·å–æ‰€æœ‰ç”¨æˆ· GET /api/users // è·å–ç‰¹å®šç”¨æˆ· GET /api/users/123 // åˆ†é¡µæŸ¥è¯¢ GET /api/users?page=1\u0026amp;limit=20\u0026amp;sort=name POST - åˆ›å»ºèµ„æº 1 2 3 4 5 6 7 8 9 // åˆ›å»ºæ–°ç”¨æˆ· POST /api/users Content-Type: application/json { \u0026#34;name\u0026#34;: \u0026#34;John Doe\u0026#34;, \u0026#34;email\u0026#34;: \u0026#34;john@example.com\u0026#34;, \u0026#34;age\u0026#34;: 30 } å“åº”ï¼š\n1 2 3 4 5 6 7 8 9 10 11 HTTP/1.1 201 Created Location: /api/users/456 Content-Type: application/json { \u0026#34;id\u0026#34;: 456, \u0026#34;name\u0026#34;: \u0026#34;John Doe\u0026#34;, \u0026#34;email\u0026#34;: \u0026#34;john@example.com\u0026#34;, \u0026#34;age\u0026#34;: 30, \u0026#34;createdAt\u0026#34;: \u0026#34;2024-01-15T10:00:00Z\u0026#34; } PUT - æ›´æ–°æ•´ä¸ªèµ„æº 1 2 3 4 5 6 7 8 9 PUT /api/users/123 Content-Type: application/json { \u0026#34;id\u0026#34;: 123, \u0026#34;name\u0026#34;: \u0026#34;John Smith\u0026#34;, \u0026#34;email\u0026#34;: \u0026#34;johnsmith@example.com\u0026#34;, \u0026#34;age\u0026#34;: 31 } PATCH - éƒ¨åˆ†æ›´æ–° 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 PATCH /api/users/123 Content-Type: application/json-patch+json [ { \u0026#34;op\u0026#34;: \u0026#34;replace\u0026#34;, \u0026#34;path\u0026#34;: \u0026#34;/email\u0026#34;, \u0026#34;value\u0026#34;: \u0026#34;newemail@example.com\u0026#34; }, { \u0026#34;op\u0026#34;: \u0026#34;replace\u0026#34;, \u0026#34;path\u0026#34;: \u0026#34;/age\u0026#34;, \u0026#34;value\u0026#34;: 32 } } // æˆ–è€…ä½¿ç”¨éƒ¨åˆ†æ›´æ–°æ ¼å¼ PATCH /api/users/123 Content-Type: application/merge-patch+json { \u0026#34;email\u0026#34;: \u0026#34;newemail@example.com\u0026#34;, \u0026#34;age\u0026#34;: 32 } DELETE - åˆ é™¤èµ„æº 1 2 3 4 5 6 7 8 9 10 11 12 13 14 DELETE /api/users/123 // å“åº” HTTP/1.1 204 No Content // æˆ–è¿”å›åˆ é™¤çš„èµ„æº HTTP/1.1 200 OK Content-Type: application/json { \u0026#34;id\u0026#34;: 123, \u0026#34;deleted\u0026#34;: true, \u0026#34;deletedAt\u0026#34;: \u0026#34;2024-01-15T10:00:00Z\u0026#34; } çŠ¶æ€ç æœ€ä½³å®è·µ æˆåŠŸå“åº” 1 2 3 4 5 6 7 8 9 10 11 // 200 OK - è¯·æ±‚æˆåŠŸ GET /api/users/123 // 201 Created - èµ„æºåˆ›å»ºæˆåŠŸ POST /api/users // 202 Accepted - è¯·æ±‚å·²æ¥å—ï¼Œæ­£åœ¨å¤„ç†ä¸­ POST /api/reports/generate // 204 No Content - è¯·æ±‚æˆåŠŸï¼Œæ— è¿”å›å†…å®¹ DELETE /api/users/123 é‡å®šå‘ 1 2 3 4 5 6 // 301 Moved Permanently - æ°¸ä¹…é‡å®šå‘ GET /old-api/users -\u0026gt; /api/users // 304 Not Modified - èµ„æºæœªä¿®æ”¹ GET /api/users/123 If-None-Match: \u0026#34;abc123\u0026#34; å®¢æˆ·ç«¯é”™è¯¯ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 // 400 Bad Request - è¯·æ±‚å‚æ•°é”™è¯¯ POST /api/users { \u0026#34;email\u0026#34;: \u0026#34;invalid-email\u0026#34; // é‚®ç®±æ ¼å¼é”™è¯¯ } // å“åº” { \u0026#34;error\u0026#34;: \u0026#34;Validation Error\u0026#34;, \u0026#34;message\u0026#34;: \u0026#34;Invalid email format\u0026#34;, \u0026#34;code\u0026#34;: \u0026#34;INVALID_EMAIL\u0026#34;, \u0026#34;details\u0026#34;: { \u0026#34;field\u0026#34;: \u0026#34;email\u0026#34;, \u0026#34;value\u0026#34;: \u0026#34;invalid-email\u0026#34; } } // 401 Unauthorized - æœªè®¤è¯ GET /api/users // å“åº” { \u0026#34;error\u0026#34;: \u0026#34;Authentication Required\u0026#34;, \u0026#34;message\u0026#34;: \u0026#34;Please provide valid credentials\u0026#34; } // 403 Forbidden - æ— æƒé™ DELETE /api/admin/users/123 // å“åº” { \u0026#34;error\u0026#34;: \u0026#34;Access Denied\u0026#34;, \u0026#34;message\u0026#34;: \u0026#34;You don\u0026#39;t have permission to delete users\u0026#34; } // 404 Not Found - èµ„æºä¸å­˜åœ¨ GET /api/users/99999 // å“åº” { \u0026#34;error\u0026#34;: \u0026#34;Not Found\u0026#34;, \u0026#34;message\u0026#34;: \u0026#34;User with ID 99999 does not exist\u0026#34; } // 409 Conflict - èµ„æºå†²çª POST /api/users { \u0026#34;email\u0026#34;: \u0026#34;existing@example.com\u0026#34; // é‚®ç®±å·²å­˜åœ¨ } æœåŠ¡å™¨é”™è¯¯ 1 2 3 4 5 6 7 8 9 10 11 12 // 500 Internal Server Error - æœåŠ¡å™¨å†…éƒ¨é”™è¯¯ { \u0026#34;error\u0026#34;: \u0026#34;Internal Server Error\u0026#34;, \u0026#34;message\u0026#34;: \u0026#34;An unexpected error occurred\u0026#34;, \u0026#34;requestId\u0026#34;: \u0026#34;req-123456\u0026#34; } // 503 Service Unavailable - æœåŠ¡ä¸å¯ç”¨ { \u0026#34;error\u0026#34;: \u0026#34;Service Unavailable\u0026#34;, \u0026#34;message\u0026#34;: \u0026#34;The service is temporarily down for maintenance\u0026#34; } æŸ¥è¯¢å‚æ•°è®¾è®¡ åˆ†é¡µå‚æ•° 1 2 3 4 5 6 7 8 9 10 11 12 13 14 GET /api/users?page=1\u0026amp;limit=20\u0026amp;offset=0 // å“åº” { \u0026#34;data\u0026#34;: [...], \u0026#34;pagination\u0026#34;: { \u0026#34;page\u0026#34;: 1, \u0026#34;limit\u0026#34;: 20, \u0026#34;total\u0026#34;: 100, \u0026#34;totalPages\u0026#34;: 5, \u0026#34;next\u0026#34;: \u0026#34;/api/users?page=2\u0026#34;, \u0026#34;prev\u0026#34;: null } } è¿‡æ»¤å‚æ•° 1 2 3 4 5 6 7 8 // å¤šæ¡ä»¶è¿‡æ»¤ GET /api/users?status=active\u0026amp;role=admin\u0026amp;createdAfter=2024-01-01 // èŒƒå›´æŸ¥è¯¢ GET /api/products?price[min]=100\u0026amp;price[max]=500 // æœç´¢ GET /api/users?q=john\u0026amp;fields=name,email æ’åºå‚æ•° 1 2 3 4 5 6 7 8 // å•å­—æ®µæ’åº GET /api/users?sort=createdAt // å¤šå­—æ®µæ’åº GET /api/users?sort=createdAt,desc\u0026amp;name,asc // æŒ‡å®šæ’åºå­—æ®µ GET /api/users?sort=+createdAt,-name å­—æ®µé€‰æ‹© 1 2 3 4 5 6 7 8 // æŒ‡å®šè¿”å›å­—æ®µ GET /api/users/123?fields=id,name,email // æ’é™¤å­—æ®µ GET /api/users/123?exclude=password,createdAt // åµŒå¥—èµ„æºå­—æ®µ GET /api/users/123?fields=id,name,orders(id,amount) ç‰ˆæœ¬æ§åˆ¶ç­–ç•¥ URLè·¯å¾„ç‰ˆæœ¬æ§åˆ¶ 1 2 3 4 5 6 7 8 9 // v1 GET /api/v1/users // v2 GET /api/v2/users // ä¼˜ç¼ºç‚¹ // âœ… æ˜ç¡®ã€ç›´è§‚ // âŒ URLä¼šå˜åŒ–ï¼Œå½±å“ç¼“å­˜ è¯·æ±‚å¤´ç‰ˆæœ¬æ§åˆ¶ 1 2 3 4 5 6 7 GET /api/users Accept: application/vnd.myapi.v1+json Accept: application/vnd.myapi.v2+json // ä¼˜ç¼ºç‚¹ // âœ… URLä¿æŒä¸å˜ // âŒ ä¸å¤Ÿç›´è§‚ï¼Œè°ƒè¯•å›°éš¾ æŸ¥è¯¢å‚æ•°ç‰ˆæœ¬æ§åˆ¶ 1 2 3 4 5 6 GET /api/users?version=v1 GET /api/users?version=v2 // ä¼˜ç¼ºç‚¹ // âœ… ç®€å•å®ç° // âŒ å®¹æ˜“è¢«å¿½ç•¥ è®¤è¯ä¸æˆæƒ JWTè®¤è¯ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 // è·å–Token POST /api/auth/login Content-Type: application/json { \u0026#34;email\u0026#34;: \u0026#34;user@example.com\u0026#34;, \u0026#34;password\u0026#34;: \u0026#34;password123\u0026#34; } // å“åº” { \u0026#34;token\u0026#34;: \u0026#34;eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...\u0026#34;, \u0026#34;refreshToken\u0026#34;: \u0026#34;refresh_token_here\u0026#34;, \u0026#34;expiresIn\u0026#34;: 3600 } // ä½¿ç”¨Token GET /api/users Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9... API Keyè®¤è¯ 1 2 3 4 5 GET /api/users X-API-Key: api_key_here // æˆ–åœ¨æŸ¥è¯¢å‚æ•°ä¸­ GET /api/users?api_key=api_key_here OAuth 2.0 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 // æˆæƒæµç¨‹ GET /api/oauth/authorize? response_type=code\u0026amp; client_id=client_id\u0026amp; redirect_uri=http://example.com/callback\u0026amp; scope=read write\u0026amp; state=random_string // è·å–è®¿é—®ä»¤ç‰Œ POST /api/oauth/token Content-Type: application/x-www-form-urlencoded grant_type=authorization_code\u0026amp; code=authorization_code\u0026amp; client_id=client_id\u0026amp; client_secret=client_secret\u0026amp; redirect_uri=http://example.com/callback APIæ–‡æ¡£è§„èŒƒ OpenAPI 3.0ç¤ºä¾‹ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 openapi: 3.0.3 info: title: User Management API version: 1.0.0 description: API for managing users paths: /api/users: get: summary: Get all users parameters: - name: page in: query schema: type: integer default: 1 - name: limit in: query schema: type: integer default: 20 responses: \u0026#39;200\u0026#39;: description: List of users content: application/json: schema: type: object properties: data: type: array items: $ref: \u0026#39;#/components/schemas/User\u0026#39; pagination: $ref: \u0026#39;#/components/schemas/Pagination\u0026#39; post: summary: Create a new user requestBody: required: true content: application/json: schema: $ref: \u0026#39;#/components/schemas/CreateUser\u0026#39; responses: \u0026#39;201\u0026#39;: description: User created content: application/json: schema: $ref: \u0026#39;#/components/schemas/User\u0026#39; components: schemas: User: type: object properties: id: type: integer format: int64 name: type: string email: type: string format: email createdAt: type: string format: date-time æ€§èƒ½ä¼˜åŒ–ç­–ç•¥ åˆ†é¡µå’Œé™æµ 1 2 3 4 5 6 7 // åˆ†é¡µ GET /api/users?page=1\u0026amp;limit=100 // é™æµå“åº”å¤´ X-RateLimit-Limit: 1000 X-RateLimit-Remaining: 999 X-RateLimit-Reset: 1640995200 ç¼“å­˜ç­–ç•¥ 1 2 3 4 5 6 7 8 9 10 // å¼ºç¼“å­˜ GET /api/users/123 Cache-Control: max-age=3600, public // åå•†ç¼“å­˜ GET /api/users/123 Cache-Control: no-cache ETag: \u0026#34;abc123\u0026#34; If-None-Match: \u0026#34;abc123\u0026#34; // å®¢æˆ·ç«¯è¯·æ±‚ æ•°æ®å‹ç¼© 1 2 3 4 5 6 7 // è¯·æ±‚å‹ç¼© POST /api/users Content-Encoding: gzip Content-Type: application/json // å“åº”å‹ç¼© Accept-Encoding: gzip, deflate é”™è¯¯å¤„ç†è®¾è®¡ ç»Ÿä¸€çš„é”™è¯¯å“åº”æ ¼å¼ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 { \u0026#34;error\u0026#34;: { \u0026#34;code\u0026#34;: \u0026#34;VALIDATION_ERROR\u0026#34;, \u0026#34;message\u0026#34;: \u0026#34;Invalid input data\u0026#34;, \u0026#34;details\u0026#34;: [ { \u0026#34;field\u0026#34;: \u0026#34;email\u0026#34;, \u0026#34;message\u0026#34;: \u0026#34;Invalid email format\u0026#34; }, { \u0026#34;field\u0026#34;: \u0026#34;age\u0026#34;, \u0026#34;message\u0026#34;: \u0026#34;Age must be between 0 and 150\u0026#34; } ], \u0026#34;timestamp\u0026#34;: \u0026#34;2024-01-15T10:00:00Z\u0026#34;, \u0026#34;path\u0026#34;: \u0026#34;/api/users\u0026#34;, \u0026#34;requestId\u0026#34;: \u0026#34;req-123456\u0026#34; } } å…¨å±€é”™è¯¯å¤„ç†ç¤ºä¾‹ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 // Express.js ç¤ºä¾‹ function errorHandler(err, req, res, next) { const error = { code: err.code || \u0026#39;INTERNAL_ERROR\u0026#39;, message: err.message || \u0026#39;An unexpected error occurred\u0026#39;, timestamp: new Date().toISOString(), path: req.path, requestId: req.id } if (process.env.NODE_ENV === \u0026#39;development\u0026#39;) { error.stack = err.stack } res.status(err.status || 500).json({ error }) } å®‰å…¨æœ€ä½³å®è·µ è¾“å…¥éªŒè¯ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 // ä½¿ç”¨JoiéªŒè¯ const schema = Joi.object({ name: Joi.string().min(2).max(50).required(), email: Joi.string().email().required(), age: Joi.number().integer().min(0).max(150) }) // éªŒè¯è¾“å…¥ const { error } = schema.validate(req.body) if (error) { return res.status(400).json({ error: { code: \u0026#39;VALIDATION_ERROR\u0026#39;, message: \u0026#39;Invalid input data\u0026#39;, details: error.details } }) } HTTPSå’ŒCORS 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 // å¼ºåˆ¶HTTPS app.use((req, res, next) =\u0026gt; { if (req.protocol !== \u0026#39;https\u0026#39;) { return res.redirect(301, `https://${req.headers.host}${req.url}`) } next() }) // CORSé…ç½® app.use(cors({ origin: [\u0026#39;https://example.com\u0026#39;, \u0026#39;https://app.example.com\u0026#39;], methods: [\u0026#39;GET\u0026#39;, \u0026#39;POST\u0026#39;, \u0026#39;PUT\u0026#39;, \u0026#39;DELETE\u0026#39;], allowedHeaders: [\u0026#39;Content-Type\u0026#39;, \u0026#39;Authorization\u0026#39;], credentials: true })) é˜²æ­¢å¸¸è§æ”»å‡» 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 // SQLæ³¨å…¥é˜²æŠ¤ // ä½¿ç”¨å‚æ•°åŒ–æŸ¥è¯¢ const query = \u0026#39;SELECT * FROM users WHERE email = ?\u0026#39; const [users] = await db.query(query, [email]) // XSSé˜²æŠ¤ const escapeHtml = (text) =\u0026gt; { const map = { \u0026#39;\u0026amp;\u0026#39;: \u0026#39;\u0026amp;amp;\u0026#39;, \u0026#39;\u0026lt;\u0026#39;: \u0026#39;\u0026amp;lt;\u0026#39;, \u0026#39;\u0026gt;\u0026#39;: \u0026#39;\u0026amp;gt;\u0026#39;, \u0026#39;\u0026#34;\u0026#39;: \u0026#39;\u0026amp;quot;\u0026#39;, \u0026#34;\u0026#39;\u0026#34;: \u0026#39;\u0026amp;#039;\u0026#39; } return text.replace(/[\u0026amp;\u0026lt;\u0026gt;\u0026#34;\u0026#39;]/g, (m) =\u0026gt; map[m]) } æ€»ç»“ è®¾è®¡ä¼˜ç§€çš„RESTful APIéœ€è¦è€ƒè™‘å¤šä¸ªæ–¹é¢ï¼š\næ ¸å¿ƒåŸåˆ™ï¼š\néµå¾ªRESTæ¶æ„åŸåˆ™ ä½¿ç”¨ç»Ÿä¸€çš„èµ„æºå‘½åè§„èŒƒ æ­£ç¡®ä½¿ç”¨HTTPæ–¹æ³•å’ŒçŠ¶æ€ç  å®æ–½åˆç†çš„ç‰ˆæœ¬æ§åˆ¶ç­–ç•¥ å®ç”¨æŠ€å·§ï¼š\nè®¾è®¡çµæ´»çš„æŸ¥è¯¢å‚æ•° å®ç°å®Œå–„çš„è®¤è¯æˆæƒæœºåˆ¶ æä¾›æ¸…æ™°çš„APIæ–‡æ¡£ ä¼˜åŒ–æ€§èƒ½å’Œç¼“å­˜ç­–ç•¥ å®‰å…¨è€ƒè™‘ï¼š\nä¸¥æ ¼çš„è¾“å…¥éªŒè¯ ä½¿ç”¨HTTPSä¼ è¾“ å®æ–½è®¿é—®æ§åˆ¶ é˜²èŒƒå¸¸è§å®‰å…¨å¨èƒ éµå¾ªè¿™äº›åŸåˆ™å’Œæœ€ä½³å®è·µï¼Œä½ å°†èƒ½å¤Ÿæ„å»ºå‡ºæ—¢å¼ºå¤§åˆä¼˜é›…çš„RESTful APIã€‚\nç›¸å…³èµ„æºï¼š\nREST APIè®¾è®¡æŒ‡å— OpenAPIè§„èŒƒ HTTPçŠ¶æ€ç å‚è€ƒ APIå®‰å…¨æœ€ä½³å®è·µ ","permalink":"/blog/articles/restful-api-design-best-practices/","summary":"æ·±å…¥æ¢è®¨RESTful APIçš„è®¾è®¡åŸåˆ™å’Œæœ€ä½³å®è·µï¼Œå¸®åŠ©ä½ æ„å»ºæ¸…æ™°ã€ä¸€è‡´ã€æ˜“ç”¨çš„APIæ¥å£ã€‚","title":"RESTful APIè®¾è®¡åŸåˆ™ï¼šæ„å»ºä¼˜é›…çš„WebæœåŠ¡æ¥å£"},{"content":"å¼•è¨€ Dockerå·²ç»æˆä¸ºç°ä»£è½¯ä»¶å¼€å‘å’Œéƒ¨ç½²çš„æ ‡å‡†å·¥å…·ã€‚é€šè¿‡å®¹å™¨åŒ–ï¼Œæˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€è‡´çš„å¼€å‘ç¯å¢ƒã€ç®€åŒ–éƒ¨ç½²æµç¨‹ã€æé«˜èµ„æºåˆ©ç”¨ç‡ã€‚æœ¬æ–‡å°†ä»Dockerçš„åŸºç¡€æ¦‚å¿µå¼€å§‹ï¼Œé€æ­¥æ·±å…¥åˆ°ç”Ÿäº§ç¯å¢ƒçš„æœ€ä½³å®è·µï¼Œå¸®åŠ©ä½ å…¨é¢æŒæ¡DockeræŠ€æœ¯ã€‚\nDockeræ ¸å¿ƒæ¦‚å¿µ 1. é•œåƒï¼ˆImageï¼‰ Dockeré•œåƒæ˜¯åˆ›å»ºå®¹å™¨çš„åŸºç¡€ï¼Œæ˜¯ä¸€ä¸ªåªè¯»çš„æ¨¡æ¿ï¼š\n1 2 3 4 5 6 7 8 9 # æ‹‰å–å®˜æ–¹é•œåƒ docker pull nginx:latest docker pull node:18-alpine # æŸ¥çœ‹æœ¬åœ°é•œåƒ docker images # åˆ é™¤é•œåƒ docker rmi nginx:latest 2. å®¹å™¨ï¼ˆContainerï¼‰ å®¹å™¨æ˜¯é•œåƒçš„è¿è¡Œå®ä¾‹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 # è¿è¡Œå®¹å™¨ docker run -d --name my-nginx -p 8080:80 nginx # æŸ¥çœ‹è¿è¡Œä¸­çš„å®¹å™¨ docker ps # æŸ¥çœ‹æ‰€æœ‰å®¹å™¨ï¼ˆåŒ…æ‹¬åœæ­¢çš„ï¼‰ docker ps -a # åœæ­¢å®¹å™¨ docker stop my-nginx # å¯åŠ¨å®¹å™¨ docker start my-nginx # åˆ é™¤å®¹å™¨ docker rm my-nginx 3. ä»“åº“ï¼ˆRepositoryï¼‰ Dockerä»“åº“æ˜¯å­˜å‚¨å’Œåˆ†å‘é•œåƒçš„åœ°æ–¹ï¼š\n1 2 3 4 5 6 7 8 # ç™»å½•Docker Hub docker login # æ¨é€é•œåƒ docker push username/my-app:1.0 # æ‹‰å–ç§æœ‰é•œåƒ docker pull private-registry/my-app:latest Dockerfileæœ€ä½³å®è·µ åŸºç¡€é•œåƒé€‰æ‹© 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 # âœ… ä½¿ç”¨å®˜æ–¹åŸºç¡€é•œåƒ FROM node:18-alpine # âœ… ä½¿ç”¨å¤šé˜¶æ®µæ„å»º FROM node:18-alpine AS builder WORKDIR /app COPY package*.json ./ RUN npm ci --only=production \u0026amp;\u0026amp; npm cache clean --force FROM node:18-alpine AS runtime WORKDIR /app COPY --from=builder /app/node_modules ./node_modules COPY . . EXPOSE 3000 CMD [\u0026#34;node\u0026#34;, \u0026#34;server.js\u0026#34;] ä¼˜åŒ–Dockerfile 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 # âŒ ä¸å¥½çš„å®è·µ FROM node:18 # å¤šä¸ªRUNæŒ‡ä»¤åˆ›å»ºå¤šä¸ªå±‚ RUN apt-get update RUN apt-get install -y python RUN npm install # ä½¿ç”¨COPY . . å¯¼è‡´ç¼“å­˜å¤±æ•ˆ COPY . . RUN npm install # âœ… å¥½çš„å®è·µ FROM node:18-alpine # åˆå¹¶RUNæŒ‡ä»¤ï¼Œå‡å°‘å±‚æ•° RUN apk add --no-cache python3 make g++ \u0026amp;\u0026amp; \\ npm install -g nodemon \u0026amp;\u0026amp; \\ npm cache clean --force # ä¼˜åŒ–COPYé¡ºåºï¼Œå…ˆå¤åˆ¶ä¾èµ–æ–‡ä»¶ COPY package*.json ./ RUN npm ci --only=production # æœ€åå¤åˆ¶æºä»£ç  COPY . . # érootç”¨æˆ·è¿è¡Œ RUN addgroup -g 1001 -S nodejs RUN adduser -S nextjs -u 1001 USER nextjs EXPOSE 3000 CMD [\u0026#34;npm\u0026#34;, \u0026#34;start\u0026#34;] å¤šé˜¶æ®µæ„å»ºç¤ºä¾‹ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 # æ„å»ºé˜¶æ®µ FROM node:18-alpine AS builder WORKDIR /app # å®‰è£…ä¾èµ– COPY package*.json ./ RUN npm ci # æ„å»ºåº”ç”¨ COPY . . RUN npm run build # ç”Ÿäº§é˜¶æ®µ FROM nginx:alpine AS production # å¤åˆ¶æ„å»ºäº§ç‰© COPY --from=builder /app/dist /usr/share/nginx/html # å¤åˆ¶nginxé…ç½® COPY nginx.conf /etc/nginx/nginx.conf EXPOSE 80 CMD [\u0026#34;nginx\u0026#34;, \u0026#34;-g\u0026#34;, \u0026#34;daemon off;\u0026#34;] Docker Compose åŸºç¡€é…ç½® 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 # docker-compose.yml version: \u0026#39;3.8\u0026#39; services: app: build: . ports: - \u0026#34;3000:3000\u0026#34; environment: - NODE_ENV=production - DB_HOST=database - REDIS_HOST=redis depends_on: - database - redis volumes: - ./logs:/app/logs restart: unless-stopped database: image: postgres:15-alpine environment: POSTGRES_DB: myapp POSTGRES_USER: user POSTGRES_PASSWORD: password volumes: - postgres_data:/var/lib/postgresql/data ports: - \u0026#34;5432:5432\u0026#34; restart: unless-stopped redis: image: redis:7-alpine ports: - \u0026#34;6379:6379\u0026#34; volumes: - redis_data:/data restart: unless-stopped volumes: postgres_data: redis_data: å¼€å‘ç¯å¢ƒé…ç½® 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 # docker-compose.dev.yml version: \u0026#39;3.8\u0026#39; services: app: build: context: . dockerfile: Dockerfile.dev ports: - \u0026#34;3000:3000\u0026#34; - \u0026#34;9229:9229\u0026#34; # Debugç«¯å£ environment: - NODE_ENV=development - CHOKIDAR_USEPOLLING=true volumes: - .:/app - /app/node_modules command: npm run dev ç”Ÿäº§ç¯å¢ƒé…ç½® 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 # docker-compose.prod.yml version: \u0026#39;3.8\u0026#39; services: app: image: myapp:latest deploy: replicas: 3 resources: limits: cpus: \u0026#39;0.5\u0026#39; memory: 512M environment: - NODE_ENV=production healthcheck: test: [\u0026#34;CMD\u0026#34;, \u0026#34;curl\u0026#34;, \u0026#34;-f\u0026#34;, \u0026#34;http://localhost:3000/health\u0026#34;] interval: 30s timeout: 10s retries: 3 nginx: image: nginx:alpine ports: - \u0026#34;80:80\u0026#34; - \u0026#34;443:443\u0026#34; volumes: - ./nginx.conf:/etc/nginx/nginx.conf - ./ssl:/etc/nginx/ssl depends_on: - app å¸¸ç”¨Dockerå‘½ä»¤ é•œåƒç®¡ç† 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 # æ„å»ºé•œåƒ docker build -t myapp:1.0 . docker build -t myapp:latest -f Dockerfile.prod . # æŸ¥çœ‹é•œåƒå†å² docker history myapp:1.0 # å¯¼å‡ºé•œåƒ docker save -o myapp.tar myapp:1.0 # å¯¼å…¥é•œåƒ docker load -i myapp.tar # æ ‡è®°é•œåƒ docker tag myapp:1.0 username/myapp:1.0 å®¹å™¨ç®¡ç† 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 # è¿è¡Œå®¹å™¨ docker run -d \\ --name myapp \\ -p 3000:3000 \\ -e NODE_ENV=production \\ -v /app/logs:/app/logs \\ --restart unless-stopped \\ myapp:1.0 # è¿›å…¥å®¹å™¨ docker exec -it myapp sh # æŸ¥çœ‹å®¹å™¨æ—¥å¿— docker logs myapp docker logs -f myapp # å®æ—¶æ—¥å¿— # æŸ¥çœ‹å®¹å™¨èµ„æºä½¿ç”¨ docker stats docker stats myapp # å¤åˆ¶æ–‡ä»¶ docker cp myapp:/app/logs ./logs docker cp ./config myapp:/app/config ç½‘ç»œç®¡ç† 1 2 3 4 5 6 7 8 9 # åˆ›å»ºç½‘ç»œ docker network create myapp-network # è¿æ¥å®¹å™¨åˆ°ç½‘ç»œ docker network connect myapp-network myapp # æŸ¥çœ‹ç½‘ç»œ docker network ls docker network inspect myapp-network æ•°æ®æŒä¹…åŒ– æ•°æ®å· 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 # åˆ›å»ºæ•°æ®å· docker volume create app-data # æŒ‚è½½æ•°æ®å· docker run -v app-data:/app/data myapp # æŸ¥çœ‹æ•°æ®å· docker volume ls docker volume inspect app-data # å¤‡ä»½æ•°æ®å· docker run --rm -v app-data:/data -v $(pwd):/backup \\ alpine tar czf /backup/backup.tar.gz -C /data . # æ¢å¤æ•°æ®å· docker run --rm -v app-data:/data -v $(pwd):/backup \\ alpine tar xzf /backup/backup.tar.gz -C /data ç»‘å®šæŒ‚è½½ 1 2 3 4 5 6 7 8 # æŒ‚è½½æœ¬åœ°ç›®å½• docker run -v $(pwd)/logs:/app/logs myapp # åªè¯»æŒ‚è½½ docker run -v $(pwd)/config:/app/config:ro myapp # ä¸´æ—¶æ–‡ä»¶ç³»ç»Ÿ docker run --tmpfs /app/temp myapp æ€§èƒ½ä¼˜åŒ– é•œåƒå¤§å°ä¼˜åŒ– 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 # âœ… ä½¿ç”¨alpineç‰ˆæœ¬ FROM node:18-alpine # âœ… ä½¿ç”¨.npmrcå‡å°‘ä¾èµ–å¤§å° RUN echo \u0026#39;package-lock=false\u0026#39; \u0026gt; .npmrc \u0026amp;\u0026amp; \\ echo \u0026#39;audit=false\u0026#39; \u0026gt;\u0026gt; .npmrc # âœ… å¤šé˜¶æ®µæ„å»ºå‡å°‘æœ€ç»ˆé•œåƒ FROM node:18-alpine AS builder # æ„å»ºæ­¥éª¤... FROM node:18-alpine AS runtime # åªå¤åˆ¶å¿…è¦æ–‡ä»¶ COPY --from=builder /app/dist ./dist COPY --from=builder /app/node_modules ./node_modules æ„å»ºç¼“å­˜ä¼˜åŒ– 1 2 3 4 5 6 7 8 9 10 11 # âœ… ä¼˜åŒ–COPYé¡ºåº COPY package*.json ./ RUN npm ci COPY . . RUN npm run build # âœ… ä½¿ç”¨BuildKitç¼“å­˜æŒ‚è½½ # docker build --mount=type=cache,target=/root/.npm -t myapp . RUN --mount=type=cache,target=/root/.npm \\ npm ci è¿è¡Œæ—¶ä¼˜åŒ– 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 # docker-compose.yml version: \u0026#39;3.8\u0026#39; services: app: image: myapp:1.0 # èµ„æºé™åˆ¶ deploy: resources: limits: cpus: \u0026#39;1.0\u0026#39; memory: 1G reservations: cpus: \u0026#39;0.5\u0026#39; memory: 512M # å¥åº·æ£€æŸ¥ healthcheck: test: [\u0026#34;CMD\u0026#34;, \u0026#34;curl\u0026#34;, \u0026#34;-f\u0026#34;, \u0026#34;http://localhost:3000/health\u0026#34;] interval: 30s timeout: 10s retries: 3 start_period: 40s å®‰å…¨æœ€ä½³å®è·µ é•œåƒå®‰å…¨ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 # âœ… ä½¿ç”¨érootç”¨æˆ· FROM node:18-alpine RUN addgroup -g 1001 -S nodejs RUN adduser -S nextjs -u 1001 USER nextjs # âœ… ä½¿ç”¨å¤šé˜¶æ®µæ„å»º FROM node:18-alpine AS builder # æ„å»ºæ­¥éª¤... FROM node:18-alpine AS runtime # ç”Ÿäº§é˜¶æ®µ... # âœ… æœ€å°åŒ–å®‰è£… RUN apk add --no-cache dumb-init è¿è¡Œæ—¶å®‰å…¨ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 # âœ… åªå¼€æ”¾å¿…è¦ç«¯å£ docker run -p 3000:3000 myapp # âœ… åªè¯»æ–‡ä»¶ç³»ç»Ÿ docker run --read-only --tmpfs /tmp myapp # âœ… é™åˆ¶ç‰¹æƒ docker run --user 1001:1001 --cap-drop ALL myapp # âœ… å®‰å…¨æ‰«æ docker scan myapp:1.0 # âœ… ä½¿ç”¨AppArmor/SELinux docker run --security-opt apparmor:myapp-profile myapp ç½‘ç»œå®‰å…¨ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 # docker-compose.yml version: \u0026#39;3.8\u0026#39; services: app: image: myapp:1.0 networks: - frontend - backend # ä¸æš´éœ²ç«¯å£åˆ°ä¸»æœº database: image: postgres:15 networks: - backend # åªæœ‰appå¯ä»¥è®¿é—®æ•°æ®åº“ networks: frontend: driver: bridge backend: driver: bridge internal: true # å†…éƒ¨ç½‘ç»œï¼Œä¸èƒ½è®¿é—®å¤–ç½‘ CI/CDé›†æˆ GitHub Actionsç¤ºä¾‹ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 # .github/workflows/docker.yml name: Build and Push Docker Image on: push: branches: [ main ] pull_request: branches: [ main ] jobs: build: runs-on: ubuntu-latest steps: - uses: actions/checkout@v3 - name: Set up Docker Buildx uses: docker/setup-buildx-action@v2 - name: Login to Docker Hub uses: docker/login-action@v2 with: username: ${{ secrets.DOCKER_USERNAME }} password: ${{ secrets.DOCKER_PASSWORD }} - name: Build and push uses: docker/build-push-action@v4 with: context: . push: true tags: | username/myapp:latest username/myapp:${{ github.sha }} cache-from: type=gha cache-to: type=gha,mode=max GitLab CIç¤ºä¾‹ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 # .gitlab-ci.yml stages: - build - deploy variables: DOCKER_DRIVER: overlay2 DOCKER_TLS_CERTDIR: \u0026#34;/certs\u0026#34; build: stage: build image: docker:20.10 services: - docker:20.10-dind script: - docker build -t $CI_REGISTRY_IMAGE:$CI_COMMIT_SHA . - docker push $CI_REGISTRY_IMAGE:$CI_COMMIT_SHA only: - main deploy: stage: deploy image: alpine:latest before_script: - apk add --no-cache openssh-client - eval $(ssh-agent -s) - echo \u0026#34;$SSH_PRIVATE_KEY\u0026#34; | tr -d \u0026#39;\\r\u0026#39; | ssh-add - - mkdir -p ~/.ssh - chmod 700 ~/.ssh - echo \u0026#34;$SSH_KNOWN_HOSTS\u0026#34; \u0026gt;\u0026gt; ~/.ssh/known_hosts - chmod 644 ~/.ssh/known_hosts script: - ssh deploy@server \u0026#34;cd /app \u0026amp;\u0026amp; docker-compose pull \u0026amp;\u0026amp; docker-compose up -d\u0026#34; only: - main ç›‘æ§å’Œæ—¥å¿— æ—¥å¿—ç®¡ç† 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 # docker-compose.yml version: \u0026#39;3.8\u0026#39; services: app: image: myapp:1.0 logging: driver: \u0026#34;json-file\u0026#34; options: max-size: \u0026#34;10m\u0026#34; max-file: \u0026#34;3\u0026#34; labels: - \u0026#34;logging=promtail\u0026#34; loki: image: grafana/loki:2.8 ports: - \u0026#34;3100:3100\u0026#34; volumes: - ./loki-config.yml:/etc/loki/local-config.yaml promtail: image: grafana/promtail:2.8 volumes: - /var/log:/var/log - ./promtail-config.yml:/etc/promtail/config.yml command: -config.file=/etc/promtail/config.yml ç›‘æ§é›†æˆ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 # monitoring.yml version: \u0026#39;3.8\u0026#39; services: prometheus: image: prom/prometheus:latest ports: - \u0026#34;9090:9090\u0026#34; volumes: - ./prometheus.yml:/etc/prometheus/prometheus.yml grafana: image: grafana/grafana:latest ports: - \u0026#34;3001:3000\u0026#34; environment: - GF_SECURITY_ADMIN_PASSWORD=admin volumes: - grafana-storage:/var/lib/grafana node-exporter: image: prom/node-exporter:latest ports: - \u0026#34;9100:9100\u0026#34; volumes: - /proc:/host/proc:ro - /sys:/host/sys:ro - /:/rootfs:ro volumes: grafana-storage: æ•…éšœæ’æŸ¥ å¸¸è§é—®é¢˜ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 # æŸ¥çœ‹å®¹å™¨è¯¦ç»†ä¿¡æ¯ docker inspect myapp # æŸ¥çœ‹å®¹å™¨å†…è¿›ç¨‹ docker exec myapp ps aux # æŸ¥çœ‹ç«¯å£å ç”¨ docker port myapp # è¿›å…¥è°ƒè¯•æ¨¡å¼ docker run -it --entrypoint sh myapp # æŸ¥çœ‹èµ„æºä½¿ç”¨ docker stats --no-stream myapp # æ¸…ç†æœªä½¿ç”¨çš„èµ„æº docker system prune -a docker volume prune docker network prune æ€§èƒ½åˆ†æ 1 2 3 4 5 6 7 8 9 # ä½¿ç”¨cAdvisor docker run -d \\ --name=cadvisor \\ -p 8080:8080 \\ -v /:/rootfs:ro \\ -v /var/run:/var/run:rw \\ -v /sys:/sys:ro \\ -v /var/lib/docker/:/var/lib/docker:ro \\ gcr.io/cadvisor/cadvisor:latest æ€»ç»“ Dockerå®¹å™¨åŒ–æŠ€æœ¯çš„æ ¸å¿ƒè¦ç‚¹ï¼š\nåŸºç¡€æ¦‚å¿µï¼š\nç†è§£é•œåƒã€å®¹å™¨ã€ä»“åº“çš„å…³ç³» æŒæ¡Dockerfileç¼–å†™æŠ€å·§ å­¦ä¼šä½¿ç”¨Docker Composeç¼–æ’å¤šå®¹å™¨åº”ç”¨ æœ€ä½³å®è·µï¼š\nä½¿ç”¨å¤šé˜¶æ®µæ„å»ºä¼˜åŒ–é•œåƒå¤§å° å®æ–½æ•°æ®æŒä¹…åŒ–ç­–ç•¥ éµå¾ªå®‰å…¨æœ€ä½³å®è·µ å»ºç«‹ç›‘æ§å’Œæ—¥å¿—ç³»ç»Ÿ ç”Ÿäº§éƒ¨ç½²ï¼š\né›†æˆCI/CDæµæ°´çº¿ å®æ–½å¥åº·æ£€æŸ¥ é…ç½®èµ„æºé™åˆ¶ å»ºç«‹å¤‡ä»½å’Œæ¢å¤ç­–ç•¥ æŒæ¡Dockerå°†å¤§å¤§ç®€åŒ–ä½ çš„å¼€å‘å’Œéƒ¨ç½²æµç¨‹ï¼Œæé«˜åº”ç”¨çš„å¯ç§»æ¤æ€§å’Œå¯æ‰©å±•æ€§ã€‚\nç›¸å…³èµ„æºï¼š\nDockerå®˜æ–¹æ–‡æ¡£ Docker Composeæ–‡æ¡£ Dockeræœ€ä½³å®è·µ Dockerå®‰å…¨æŒ‡å— ","permalink":"/blog/articles/docker-containerization-guide/","summary":"å…¨é¢æŒæ¡Dockerå®¹å™¨åŒ–æŠ€æœ¯ï¼Œä»åŸºç¡€æ¦‚å¿µåˆ°ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²çš„æœ€ä½³å®è·µã€‚","title":"Dockerå®¹å™¨åŒ–å®Œå…¨æŒ‡å—ï¼šä»å…¥é—¨åˆ°ç”Ÿäº§å®è·µ"},{"content":"å¼•è¨€ TypeScriptçš„ç±»å‹ç³»ç»Ÿæ˜¯å…¶æœ€å¼ºå¤§çš„ç‰¹æ€§ä¹‹ä¸€ï¼Œå®ƒä¸ä»…ä»…èƒ½æä¾›ç±»å‹å®‰å…¨ï¼Œè¿˜èƒ½åƒç¼–ç¨‹ä¸€æ ·æ“ä½œç±»å‹ã€‚é€šè¿‡æ³›å‹ã€æ¡ä»¶ç±»å‹ã€æ˜ å°„ç±»å‹ç­‰é«˜çº§ç‰¹æ€§ï¼Œæˆ‘ä»¬å¯ä»¥åˆ›å»ºå‡ºæ—¢çµæ´»åˆç±»å‹å®‰å…¨çš„ä»£ç ã€‚æœ¬æ–‡å°†å¸¦ä½ æ·±å…¥TypeScriptçš„ç±»å‹ä¸–ç•Œï¼ŒæŒæ¡è¿™äº›é«˜çº§æŠ€å·§ã€‚\næ³›å‹åŸºç¡€ æ³›å‹å‡½æ•° 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 // åŸºç¡€æ³›å‹å‡½æ•° function identity\u0026lt;T\u0026gt;(arg: T): T { return arg } // ä½¿ç”¨ const num = identity(10) // ç±»å‹æ˜¯ number const str = identity(\u0026#39;hello\u0026#39;) // ç±»å‹æ˜¯ string // æ³›å‹çº¦æŸ function logLength\u0026lt;T extends { length: number }\u0026gt;(arg: T) { console.log(arg.length) } logLength(\u0026#39;hello\u0026#39;) // OK logLength([1, 2, 3]) // OK // logLength(10) // Error: number æ²¡æœ‰ length å±æ€§ æ³›å‹æ¥å£ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 interface Repository\u0026lt;T\u0026gt; { findById(id: string): Promise\u0026lt;T | null\u0026gt; save(entity: T): Promise\u0026lt;T\u0026gt; delete(id: string): Promise\u0026lt;void\u0026gt; } interface User { id: string name: string email: string } class UserRepository implements Repository\u0026lt;User\u0026gt; { async findById(id: string): Promise\u0026lt;User | null\u0026gt; { // å®ç° return null } async save(user: User): Promise\u0026lt;User\u0026gt; { // å®ç° return user } async delete(id: string): Promise\u0026lt;void\u0026gt; { // å®ç° } } æ³›å‹ç±» 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 class Box\u0026lt;T\u0026gt; { private content: T constructor(value: T) { this.content = value } getValue(): T { return this.content } setValue(value: T): void { this.content = value } } const numberBox = new Box(123) const stringBox = new Box(\u0026#39;hello\u0026#39;) // æ³›å‹ç±»ç»§æ‰¿ class NumberBox extends Box\u0026lt;number\u0026gt; { add(num: number): void { this.setValue(this.getValue() + num) } } é«˜çº§æ³›å‹æŠ€å·§ 1. å¤šä¸ªæ³›å‹å‚æ•° 1 2 3 4 5 6 7 8 9 10 11 function pair\u0026lt;T, U\u0026gt;(first: T, second: U): [T, U] { return [first, second] } function map\u0026lt;T, U\u0026gt;(array: T[], fn: (item: T) =\u0026gt; U): U[] { return array.map(fn) } // ä½¿ç”¨ const [a, b] = pair(\u0026#39;hello\u0026#39;, 123) const lengths = map([\u0026#39;a\u0026#39;, \u0026#39;bb\u0026#39;, \u0026#39;ccc\u0026#39;], s =\u0026gt; s.length) 2. é»˜è®¤æ³›å‹å‚æ•° 1 2 3 4 5 6 7 8 9 10 11 12 13 interface ApiResponse\u0026lt;T = any\u0026gt; { data: T status: number message: string } interface UserResponse extends ApiResponse\u0026lt;User\u0026gt; { // ç»§æ‰¿å¹¶æŒ‡å®šå…·ä½“ç±»å‹ } interface GenericResponse extends ApiResponse { // ä½¿ç”¨é»˜è®¤ç±»å‹ T = any } 3. æ³›å‹å·¥å‚å‡½æ•° 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 function createRepository\u0026lt;T\u0026gt;(): Repository\u0026lt;T\u0026gt; { return new (class implements Repository\u0026lt;T\u0026gt; { async findById(id: string): Promise\u0026lt;T | null\u0026gt; { throw new Error(\u0026#39;Not implemented\u0026#39;) } async save(entity: T): Promise\u0026lt;T\u0026gt; { throw new Error(\u0026#39;Not implemented\u0026#39;) } async delete(id: string): Promise\u0026lt;void\u0026gt; { throw new Error(\u0026#39;Not implemented\u0026#39;) } })() } const userRepo = createRepository\u0026lt;User\u0026gt;() æ¡ä»¶ç±»å‹ åŸºç¡€æ¡ä»¶ç±»å‹ 1 2 3 4 5 6 7 8 9 10 11 // åŸºç¡€è¯­æ³• type IsString\u0026lt;T\u0026gt; = T extends string ? true : false type Test1 = IsString\u0026lt;string\u0026gt; // true type Test2 = IsString\u0026lt;number\u0026gt; // false // å®é™…åº”ç”¨ type NonNullable\u0026lt;T\u0026gt; = T extends null | undefined ? never : T type Test3 = NonNullable\u0026lt;string | null\u0026gt; // string type Test4 = NonNullable\u0026lt;number\u0026gt; // number åˆ†å¸ƒå¼æ¡ä»¶ç±»å‹ 1 2 3 4 5 6 7 8 9 // è”åˆç±»å‹ä¼šè¢«åˆ†å¸ƒå¤„ç† type ToArray\u0026lt;T\u0026gt; = T extends any ? T[] : never type Test5 = ToArray\u0026lt;string | number\u0026gt; // string[] | number[] // è¿‡æ»¤è”åˆç±»å‹ type FilterString\u0026lt;T\u0026gt; = T extends string ? T : never type Test6 = FilterString\u0026lt;string | number | boolean\u0026gt; // string æ¨æ–­å…³é”®å­— infer 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 // æå–å‡½æ•°è¿”å›ç±»å‹ type ReturnType\u0026lt;T\u0026gt; = T extends (...args: any[]) =\u0026gt; infer R ? R : never function getString(): string { return \u0026#39;hello\u0026#39; } type Test7 = ReturnType\u0026lt;typeof getString\u0026gt; // string // æå–æ•°ç»„å…ƒç´ ç±»å‹ type ElementOf\u0026lt;T\u0026gt; = T extends (infer E)[] ? E : never type Test8 = ElementOf\u0026lt;string[]\u0026gt; // string // æå–Promiseçš„å€¼ç±»å‹ type UnboxPromise\u0026lt;T\u0026gt; = T extends Promise\u0026lt;infer U\u0026gt; ? U : never type Test9 = UnboxPromise\u0026lt;string\u0026gt; // string type Test10 = UnboxPromise\u0026lt;string\u0026gt; | number // string | number æ˜ å°„ç±»å‹ åŸºç¡€æ˜ å°„ç±»å‹ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 // å°†æ‰€æœ‰å±æ€§å˜ä¸ºå¯é€‰ type Partial\u0026lt;T\u0026gt; = { [P in keyof T]?: T[P] } // å°†æ‰€æœ‰å±æ€§å˜ä¸ºå¿…éœ€ type Required\u0026lt;T\u0026gt; = { [P in keyof T]-?: T[P] } // åªè¯»æ˜ å°„ type Readonly\u0026lt;T\u0026gt; = { readonly [P in keyof T]: T[P] } è‡ªå®šä¹‰æ˜ å°„ç±»å‹ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 // é€‰æ‹©ç‰¹å®šå±æ€§ type Pick\u0026lt;T, K extends keyof T\u0026gt; = { [P in K]: T[P] } // æ’é™¤ç‰¹å®šå±æ€§ type Omit\u0026lt;T, K extends keyof T\u0026gt; = Pick\u0026lt;T, Exclude\u0026lt;keyof T, K\u0026gt;\u0026gt; // å°†æ‰€æœ‰å±æ€§è½¬æ¢ä¸ºå¦ä¸€ç§ç±»å‹ type StringifyProperties\u0026lt;T\u0026gt; = { [K in keyof T]: T[K] extends string ? T[K] : string } interface User { id: number name: string age: number } type Test11 = StringifyProperties\u0026lt;User\u0026gt; // { // id: string // name: string // age: string // } æ¡ä»¶æ˜ å°„ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 // æ ¹æ®ç±»å‹æ¡ä»¶è¿›è¡Œä¸åŒçš„æ˜ å°„ type ConditionalMap\u0026lt;T\u0026gt; = { [K in keyof T]: T[K] extends string ? string : T[K] extends number ? number : never } // æ·»åŠ æˆ–ä¿®æ”¹å±æ€§ type WithDefaults\u0026lt;T\u0026gt; = T \u0026amp; { id: string createdAt: Date } // åˆ é™¤æŸäº›å±æ€§ type DeleteProperties\u0026lt;T, K extends keyof T\u0026gt; = Omit\u0026lt;T, K\u0026gt; å®ç”¨çš„é«˜çº§ç±»å‹ 1. æ·±åº¦åªè¯» 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 type DeepReadonly\u0026lt;T\u0026gt; = { readonly [P in keyof T]: T[P] extends object ? DeepReadonly\u0026lt;T[P]\u0026gt; : T[P] } interface Nested { a: { b: { c: number } } } type Test12 = DeepReadonly\u0026lt;Nested\u0026gt; // æ‰€æœ‰åµŒå¥—å±æ€§éƒ½å˜ä¸ºåªè¯» 2. å‡½æ•°å‚æ•°æå– 1 2 3 4 5 6 7 8 9 10 11 12 type FirstParameter\u0026lt;T\u0026gt; = T extends (arg1: infer U, ...args: any[]) =\u0026gt; any ? U : never type AllParameters\u0026lt;T\u0026gt; = T extends (...args: infer U) =\u0026gt; any ? U : never function example(a: number, b: string, c: boolean): void {} type Test13 = FirstParameter\u0026lt;typeof example\u0026gt; // number type Test14 = AllParameters\u0026lt;typeof example\u0026gt; // [number, string, boolean] 3. è”åˆç±»å‹è½¬äº¤å‰ç±»å‹ 1 2 3 4 5 6 7 8 type UnionToIntersection\u0026lt;U\u0026gt; = (U extends any ? (k: U) =\u0026gt; void : never) extends (k: infer I) =\u0026gt; void ? I : never type Test15 = UnionToIntersection\u0026lt;{ a: string } | { b: number }\u0026gt; // { a: string } \u0026amp; { b: number } 4. è·å–å¯¹è±¡å€¼çš„ç±»å‹ 1 2 3 4 5 6 7 8 9 type ValueOf\u0026lt;T\u0026gt; = T[keyof T] interface Config { apiUrl: string timeout: number retries: number } type Test16 = ValueOf\u0026lt;Config\u0026gt; // string | number ç±»å‹å®ˆå«å’Œè°“è¯ ç±»å‹è°“è¯ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 function isString(value: unknown): value is string { return typeof value === \u0026#39;string\u0026#39; } function processValue(value: unknown) { if (isString(value)) { // è¿™é‡Œ value çš„ç±»å‹è¢«æ”¶çª„ä¸º string console.log(value.toUpperCase()) } } // æ›´å¤æ‚çš„ç±»å‹è°“è¯ function isUser(obj: any): obj is User { return ( obj \u0026amp;\u0026amp; typeof obj === \u0026#39;object\u0026#39; \u0026amp;\u0026amp; \u0026#39;id\u0026#39; in obj \u0026amp;\u0026amp; \u0026#39;name\u0026#39; in obj \u0026amp;\u0026amp; \u0026#39;email\u0026#39; in obj ) } è‡ªå®šä¹‰ç±»å‹å®ˆå« 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 interface Cat { type: \u0026#39;cat\u0026#39; meow(): void } interface Dog { type: \u0026#39;dog\u0026#39; bark(): void } type Animal = Cat | Dog function isCat(animal: Animal): animal is Cat { return animal.type === \u0026#39;cat\u0026#39; } function handleAnimal(animal: Animal) { if (isCat(animal)) { animal.meow() // TypeScript çŸ¥é“è¿™æ˜¯ Cat } else { animal.bark() // TypeScript çŸ¥é“è¿™æ˜¯ Dog } } æ¨¡æ¿å­—é¢é‡ç±»å‹ åŸºç¡€ç”¨æ³• 1 2 3 4 5 6 7 8 type EventName = `on${Capitalize\u0026lt;string\u0026gt;}` type Test17 = EventName // \u0026#34;onUppercase\u0026lt;string\u0026gt;\u0026#34; ä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„ // å®é™…åº”ç”¨ type ButtonEvent = `on${\u0026#39;click\u0026#39; | \u0026#39;hover\u0026#39; | \u0026#39;focus\u0026#39;}` type Test18 = ButtonEvent // \u0026#34;onclick\u0026#34; | \u0026#34;onhover\u0026#34; | \u0026#34;onfocus\u0026#34; å®ç”¨å·¥å…·ç±»å‹ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 // é¦–å­—æ¯å¤§å†™ type Capitalize\u0026lt;T extends string\u0026gt; = T extends `${infer F}${infer R}` ? `${Uppercase\u0026lt;F\u0026gt;}${R}` : T type Test19 = Capitalize\u0026lt;\u0026#39;hello\u0026#39;\u0026gt; // \u0026#34;Hello\u0026#34; // é©¼å³°å‘½åè½¬æ¢ type CamelCase\u0026lt;S extends string\u0026gt; = S extends `${infer P1}_${infer P2}${infer P3}` ? `${P1}${Uppercase\u0026lt;P2\u0026gt;}${CamelCase\u0026lt;P3\u0026gt;}` : S type Test20 = CamelCase\u0026lt;\u0026#39;hello_world_test\u0026#39;\u0026gt; // \u0026#34;helloWorldTest\u0026#34; å®æˆ˜åº”ç”¨ 1. APIç±»å‹ç”Ÿæˆ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 // åŸºäºç«¯ç‚¹ç”Ÿæˆç±»å‹ type ApiMethod = \u0026#39;GET\u0026#39; | \u0026#39;POST\u0026#39; | \u0026#39;PUT\u0026#39; | \u0026#39;DELETE\u0026#39; interface ApiEndpoint { method: ApiMethod path: string response: any request?: any } type EndpointTypes\u0026lt;T extends ApiEndpoint\u0026gt; = { [K in keyof T]: T[K] extends { method: infer M; path: infer P; response: infer R } ? M extends \u0026#39;GET\u0026#39; ? (params?: Record\u0026lt;string, any\u0026gt;) =\u0026gt; Promise\u0026lt;R\u0026gt; : (data: T[K][\u0026#39;request\u0026#39;], params?: Record\u0026lt;string, any\u0026gt;) =\u0026gt; Promise\u0026lt;R\u0026gt; : never } // ä½¿ç”¨ç¤ºä¾‹ type Api = { getUser: ApiEndpoint \u0026amp; { method: \u0026#39;GET\u0026#39; path: \u0026#39;/users/:id\u0026#39; response: User } createUser: ApiEndpoint \u0026amp; { method: \u0026#39;POST\u0026#39; path: \u0026#39;/users\u0026#39; request: Omit\u0026lt;User, \u0026#39;id\u0026#39;\u0026gt; response: User } } type ApiMethods = EndpointTypes\u0026lt;Api\u0026gt; /* { getUser: (params?: Record\u0026lt;string, any\u0026gt;) =\u0026gt; Promise\u0026lt;User\u0026gt; createUser: (data: Omit\u0026lt;User, \u0026#39;id\u0026#39;\u0026gt;, params?: Record\u0026lt;string, any\u0026gt;) =\u0026gt; Promise\u0026lt;User\u0026gt; } */ 2. çŠ¶æ€ç®¡ç†ç±»å‹ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 // çŠ¶æ€æœºç±»å‹ type State = \u0026#39;idle\u0026#39; | \u0026#39;loading\u0026#39; | \u0026#39;success\u0026#39; | \u0026#39;error\u0026#39; type StateActions\u0026lt;T\u0026gt; = { [K in keyof T]: (payload: T[K]) =\u0026gt; void } type StateMachine\u0026lt;S extends State, A extends Record\u0026lt;string, any\u0026gt;\u0026gt; = { state: S dispatch: \u0026lt;K extends keyof A\u0026gt;(action: K, payload: A[K]) =\u0026gt; void } // ä½¿ç”¨ç¤ºä¾‹ type UserState = StateMachine\u0026lt; \u0026#39;loading\u0026#39; | \u0026#39;success\u0026#39; | \u0026#39;error\u0026#39;, { setUser: User setError: string } \u0026gt; 3. è¡¨å•éªŒè¯ç±»å‹ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 type ValidationRule\u0026lt;T\u0026gt; = { required?: boolean minLength?: number maxLength?: number pattern?: RegExp custom?: (value: T) =\u0026gt; boolean | string } type ValidationSchema\u0026lt;T extends Record\u0026lt;string, any\u0026gt;\u0026gt; = { [K in keyof T]: ValidationRule\u0026lt;T[K]\u0026gt; } type ValidationResult\u0026lt;T\u0026gt; = { [K in keyof T]?: string } // ä½¿ç”¨ç¤ºä¾‹ interface LoginForm { email: string password: string } const loginSchema: ValidationSchema\u0026lt;LoginForm\u0026gt; = { email: { required: true, pattern: /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/ }, password: { required: true, minLength: 8 } } æ€§èƒ½è€ƒè™‘ é¿å…è¿‡æ·±çš„é€’å½’ 1 2 3 4 5 6 7 8 9 10 11 12 // âŒ å¯èƒ½å¯¼è‡´æ€§èƒ½é—®é¢˜ type DeepNested\u0026lt;T\u0026gt; = T extends object ? { [K in keyof T]: DeepNested\u0026lt;T[K]\u0026gt; } : T // âœ… é™åˆ¶é€’å½’æ·±åº¦ type DeepNestedLimited\u0026lt;T, Depth extends number = 0\u0026gt; = Depth extends 5 ? T : T extends object ? { [K in keyof T]: DeepNestedLimited\u0026lt;T[K], Depth | 0\u0026gt; } : T ä½¿ç”¨ç±»å‹åˆ«åä¼˜åŒ– 1 2 3 4 5 6 // âŒ é‡å¤è®¡ç®—å¤æ‚ç±»å‹ type ComplexType\u0026lt;T\u0026gt; = Exclude\u0026lt;keyof T, \u0026#39;id\u0026#39; | \u0026#39;createdAt\u0026#39; | \u0026#39;updatedAt\u0026#39;\u0026gt; // âœ… ä½¿ç”¨ä¸­é—´ç±»å‹ type BaseModelKeys = \u0026#39;id\u0026#39; | \u0026#39;createdAt\u0026#39; | \u0026#39;updatedAt\u0026#39; type ComplexType\u0026lt;T\u0026gt; = Exclude\u0026lt;keyof T, BaseModelKeys\u0026gt; æ€»ç»“ TypeScriptçš„é«˜çº§ç±»å‹ç‰¹æ€§ä¸ºæˆ‘ä»¬æä¾›äº†å¼ºå¤§çš„å·¥å…·ï¼š\næ ¸å¿ƒæ¦‚å¿µï¼š\næ³›å‹ï¼šåˆ›å»ºå¯å¤ç”¨çš„ç±»å‹å®‰å…¨ä»£ç  æ¡ä»¶ç±»å‹ï¼šåŸºäºç±»å‹çš„æ¡ä»¶é€»è¾‘ æ˜ å°„ç±»å‹ï¼šè½¬æ¢ç°æœ‰ç±»å‹ ç±»å‹å®ˆå«ï¼šè¿è¡Œæ—¶ç±»å‹æ£€æŸ¥ æœ€ä½³å®è·µï¼š\nåˆç†ä½¿ç”¨æ³›å‹çº¦æŸ åˆ©ç”¨ç±»å‹æ¨å¯¼ç®€åŒ–ä»£ç  åˆ›å»ºå¯å¤ç”¨çš„å·¥å…·ç±»å‹ æ³¨æ„ç±»å‹ç³»ç»Ÿçš„æ€§èƒ½é™åˆ¶ æŒæ¡è¿™äº›é«˜çº§ç±»å‹æŠ€å·§ï¼Œå°†è®©ä½ èƒ½å¤Ÿæ„å»ºæ›´å®‰å…¨ã€æ›´çµæ´»çš„TypeScriptåº”ç”¨ã€‚\nç›¸å…³èµ„æºï¼š\nTypeScriptå®˜æ–¹æ–‡æ¡£ TypeScriptç±»å‹ä½“æ“æŒ‘æˆ˜ TypeScriptå®ç”¨ç±»å‹ ","permalink":"/blog/articles/typescript-type-gymnastics/","summary":"æ·±å…¥TypeScripté«˜çº§ç±»å‹ç³»ç»Ÿï¼ŒæŒæ¡æ³›å‹ç¼–ç¨‹å’Œç±»å‹æ“ä½œçš„ç²¾é«“ï¼Œå†™å‡ºç±»å‹å®‰å…¨çš„ä»£ç ã€‚","title":"TypeScriptç±»å‹ä½“æ“ï¼šæŒæ¡é«˜çº§æ³›å‹å’Œç±»å‹æ“ä½œæŠ€å·§"},{"content":"å¼•è¨€ JavaScriptä½œä¸ºå•çº¿ç¨‹è¯­è¨€ï¼Œå¼‚æ­¥ç¼–ç¨‹æ˜¯å…¶æ ¸å¿ƒç‰¹æ€§ä¹‹ä¸€ã€‚ä»æœ€åˆçš„å›è°ƒå‡½æ•°åˆ°Promiseï¼Œå†åˆ°ç°ä»£çš„async/awaitè¯­æ³•ï¼ŒJavaScriptçš„å¼‚æ­¥ç¼–ç¨‹æ¨¡å¼ä¸æ–­æ¼”è¿›ã€‚æœ¬æ–‡å°†å¸¦ä½ æ·±å…¥äº†è§£å¼‚æ­¥ç¼–ç¨‹çš„å„ä¸ªé˜¶æ®µï¼ŒæŒæ¡æœ€ä½³å®è·µï¼Œå†™å‡ºæ›´ä¼˜é›…ã€æ›´é«˜æ•ˆçš„å¼‚æ­¥ä»£ç ã€‚\nå¼‚æ­¥ç¼–ç¨‹çš„æ¼”è¿›å†ç¨‹ 1. å›è°ƒå‡½æ•°æ—¶ä»£ 1 2 3 4 5 6 7 8 9 10 11 12 // ä¼ ç»Ÿçš„å›è°ƒæ–¹å¼ function fetchData(callback) { setTimeout(() =\u0026gt; { const data = { id: 1, name: \u0026#39;John\u0026#39; } callback(data) }, 1000) } fetchData((data) =\u0026gt; { console.log(\u0026#39;è·å–åˆ°æ•°æ®:\u0026#39;, data) // ç»§ç»­ä¸‹ä¸€æ­¥æ“ä½œ... }) å›è°ƒåœ°ç‹±é—®é¢˜ï¼š\n1 2 3 4 5 6 7 8 9 10 // éš¾ä»¥ç»´æŠ¤çš„å›è°ƒåµŒå¥— loadUser(userId, (user) =\u0026gt; { loadPosts(user.id, (posts) =\u0026gt; { loadComments(posts[0].id, (comments) =\u0026gt; { loadAuthor(comments[0].authorId, (author) =\u0026gt; { console.log(\u0026#39;æœ€ç»ˆç»“æœ:\u0026#39;, author) }) }) }) }) 2. Promiseçš„é©å‘½ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 // ä½¿ç”¨Promiseæ”¹å†™ function fetchData() { return new Promise((resolve, reject) =\u0026gt; { setTimeout(() =\u0026gt; { const data = { id: 1, name: \u0026#39;John\u0026#39; } resolve(data) }, 1000) }) } // é“¾å¼è°ƒç”¨ fetchData() .then(data =\u0026gt; { console.log(\u0026#39;è·å–åˆ°æ•°æ®:\u0026#39;, data) return loadPosts(data.id) }) .then(posts =\u0026gt; { console.log(\u0026#39;è·å–åˆ°æ–‡ç« :\u0026#39;, posts) return loadComments(posts[0].id) }) .then(comments =\u0026gt; { console.log(\u0026#39;è·å–åˆ°è¯„è®º:\u0026#39;, comments) }) .catch(error =\u0026gt; { console.error(\u0026#39;å‘ç”Ÿé”™è¯¯:\u0026#39;, error) }) 3. async/awaitçš„ä¼˜é›… 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 // ä½¿ç”¨async/awaitï¼Œä»£ç æ›´æ¸…æ™° async function loadAllData() { try { const user = await fetchData() console.log(\u0026#39;è·å–åˆ°æ•°æ®:\u0026#39;, user) const posts = await loadPosts(user.id) console.log(\u0026#39;è·å–åˆ°æ–‡ç« :\u0026#39;, posts) const comments = await loadComments(posts[0].id) console.log(\u0026#39;è·å–åˆ°è¯„è®º:\u0026#39;, comments) } catch (error) { console.error(\u0026#39;å‘ç”Ÿé”™è¯¯:\u0026#39;, error) } } Promiseæ·±å…¥ç†è§£ Promiseçš„ä¸‰ç§çŠ¶æ€ 1 2 3 4 5 6 7 const promise = new Promise((resolve, reject) =\u0026gt; { // pending -\u0026gt; fulfilled // pending -\u0026gt; rejected // ä¸€æ—¦çŠ¶æ€æ”¹å˜å°±ä¸å¯é€† }) console.log(promise) // Promise { \u0026lt;pending\u0026gt; } Promiseçš„é™æ€æ–¹æ³• Promise.all() 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 // å¹¶è¡Œæ‰§è¡Œå¤šä¸ªPromise async function fetchAllData() { try { const [users, posts, comments] = await Promise.all([ fetchUsers(), fetchPosts(), fetchComments() ]) console.log(\u0026#39;æ‰€æœ‰æ•°æ®åŠ è½½å®Œæˆ\u0026#39;) return { users, posts, comments } } catch (error) { console.error(\u0026#39;æŸä¸ªè¯·æ±‚å¤±è´¥:\u0026#39;, error) } } // å¤„ç†éƒ¨åˆ†å¤±è´¥çš„æƒ…å†µ const results = await Promise.allSettled([ fetchUsers(), fetchPosts(), fetchComments() ]) results.forEach(result =\u0026gt; { if (result.status === \u0026#39;fulfilled\u0026#39;) { console.log(\u0026#39;æˆåŠŸ:\u0026#39;, result.value) } else { console.log(\u0026#39;å¤±è´¥:\u0026#39;, result.reason) } }) Promise.race() 1 2 3 4 5 6 7 8 9 // è¿”å›æœ€å¿«å®Œæˆçš„Promiseç»“æœ const timeout = new Promise((_, reject) =\u0026gt; setTimeout(() =\u0026gt; reject(new Error(\u0026#39;è¶…æ—¶\u0026#39;)), 5000) ) const result = await Promise.race([ fetchData(), timeout ]) Promise.any() 1 2 3 4 5 6 7 8 9 10 11 // è¿”å›ç¬¬ä¸€ä¸ªæˆåŠŸçš„Promise try { const result = await Promise.any([ fetchFromPrimary(), fetchFromSecondary(), fetchFromCache() ]) console.log(\u0026#39;æˆåŠŸè·å–æ•°æ®:\u0026#39;, result) } catch (error) { console.error(\u0026#39;æ‰€æœ‰æ•°æ®æºéƒ½å¤±è´¥äº†:\u0026#39;, error) } async/awaitæœ€ä½³å®è·µ 1. é”™è¯¯å¤„ç†ç­–ç•¥ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 // ç»Ÿä¸€é”™è¯¯å¤„ç†ä¸­é—´ä»¶ async function withErrorHandling(fn) { try { return await fn() } catch (error) { console.error(\u0026#39;æ“ä½œå¤±è´¥:\u0026#39;, error) // å¯ä»¥æ·»åŠ é”™è¯¯ä¸ŠæŠ¥é€»è¾‘ throw error // é‡æ–°æŠ›å‡ºæˆ–è¿”å›é»˜è®¤å€¼ } } // ä½¿ç”¨é«˜é˜¶å‡½æ•°åŒ…è£… const safeFetchData = () =\u0026gt; withErrorHandling(async () =\u0026gt; { const response = await fetch(\u0026#39;/api/data\u0026#39;) return response.json() }) 2. ä¼˜é›…çš„é‡è¯•æœºåˆ¶ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 async function retry(fn, maxAttempts = 3, delay = 1000) { let lastError for (let attempt = 1; attempt \u0026lt;= maxAttempts; attempt++) { try { return await fn() } catch (error) { lastError = error if (attempt === maxAttempts) { throw lastError } // æŒ‡æ•°é€€é¿ const waitTime = delay * Math.pow(2, attempt - 1) await new Promise(resolve =\u0026gt; setTimeout(resolve, waitTime)) } } } // ä½¿ç”¨ç¤ºä¾‹ const data = await retry(async () =\u0026gt; { const response = await fetch(\u0026#39;/api/unstable\u0026#39;) if (!response.ok) throw new Error(\u0026#39;è¯·æ±‚å¤±è´¥\u0026#39;) return response.json() }, 5, 500) 3. å¹¶å‘æ§åˆ¶ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 // é™åˆ¶å¹¶å‘æ•°é‡çš„é€šç”¨å‡½æ•° async function limitConcurrency(tasks, limit = 3) { const results = [] const executing = [] for (const task of tasks) { const promise = task().then(result =\u0026gt; { executing.splice(executing.indexOf(promise), 1) return result }) results.push(promise) executing.push(promise) if (executing.length \u0026gt;= limit) { await Promise.race(executing) } } return Promise.all(results) } // ä½¿ç”¨ç¤ºä¾‹ const urls = Array(100).fill(\u0026#39;/api/data\u0026#39;) const fetchTasks = urls.map(url =\u0026gt; () =\u0026gt; fetch(url)) const responses = await limitConcurrency(fetchTasks, 10) 4. è¶…æ—¶å¤„ç† 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 async function withTimeout(promise, timeoutMs) { const timeoutPromise = new Promise((_, reject) =\u0026gt; { setTimeout(() =\u0026gt; reject(new Error(\u0026#39;æ“ä½œè¶…æ—¶\u0026#39;)), timeoutMs) }) return Promise.race([promise, timeoutPromise]) } // ä½¿ç”¨ç¤ºä¾‹ try { const data = await withTimeout(fetch(\u0026#39;/api/slow\u0026#39;), 5000) console.log(\u0026#39;è·å–æ•°æ®æˆåŠŸ:\u0026#39;, data) } catch (error) { if (error.message === \u0026#39;æ“ä½œè¶…æ—¶\u0026#39;) { console.log(\u0026#39;è¯·æ±‚è¶…æ—¶ï¼Œä½¿ç”¨ç¼“å­˜æ•°æ®\u0026#39;) // å›é€€é€»è¾‘ } } å®æˆ˜åœºæ™¯åº”ç”¨ 1. æ•°æ®ç¼“å­˜ç­–ç•¥ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 class DataCache { constructor() { this.cache = new Map() this.pending = new Map() } async get(key, fetcher, ttl = 60000) { // æ£€æŸ¥ç¼“å­˜ if (this.cache.has(key)) { const { data, timestamp } = this.cache.get(key) if (Date.now() - timestamp \u0026lt; ttl) { return data } } // æ£€æŸ¥æ˜¯å¦æœ‰æ­£åœ¨è¿›è¡Œçš„è¯·æ±‚ if (this.pending.has(key)) { return this.pending.get(key) } // å‘èµ·æ–°è¯·æ±‚ const promise = fetcher() .then(data =\u0026gt; { this.cache.set(key, { data, timestamp: Date.now() }) this.pending.delete(key) return data }) .catch(error =\u0026gt; { this.pending.delete(key) throw error }) this.pending.set(key, promise) return promise } } // ä½¿ç”¨ç¤ºä¾‹ const cache = new DataCache() async function getUserProfile(userId) { return cache.get( `user:${userId}`, async () =\u0026gt; { const response = await fetch(`/api/users/${userId}`) return response.json() } ) } 2. æ‰¹é‡è¯·æ±‚ä¼˜åŒ– 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 // è¯·æ±‚åˆå¹¶å™¨ class RequestBatcher { constructor(batchSize = 10, delay = 100) { this.batchSize = batchSize this.delay = delay this.queue = [] this.timer = null } add(request) { return new Promise((resolve, reject) =\u0026gt; { this.queue.push({ request, resolve, reject }) if (this.queue.length \u0026gt;= this.batchSize) { this.flush() } else if (!this.timer) { this.timer = setTimeout(() =\u0026gt; this.flush(), this.delay) } }) } async flush() { if (this.timer) { clearTimeout(this.timer) this.timer = null } if (this.queue.length === 0) return const batch = this.queue.splice(0, this.batchSize) const requests = batch.map(item =\u0026gt; item.request) try { const results = await Promise.all(requests) batch.forEach((item, index) =\u0026gt; { item.resolve(results[index]) }) } catch (error) { batch.forEach(item =\u0026gt; { item.reject(error) }) } } } // ä½¿ç”¨ç¤ºä¾‹ const batcher = new RequestBatcher() async function fetchUser(userId) { return batcher.add(() =\u0026gt; fetch(`/api/users/${userId}`).then(res =\u0026gt; res.json()) ) } // å¤šä¸ªè°ƒç”¨ä¼šè¢«åˆå¹¶ const users = await Promise.all([ fetchUser(1), fetchUser(2), fetchUser(3), // ... ]) 3. æµå¼æ•°æ®å¤„ç† 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 // å¤„ç†å¤§é‡æ•°æ®çš„æµå¼æ–¹æ¡ˆ async function processLargeData(dataStream, processor) { const results = [] for await (const chunk of dataStream) { const processedChunk = await processor(chunk) results.push(processedChunk) // è®©å‡ºæ§åˆ¶æƒï¼Œé¿å…é˜»å¡ await new Promise(resolve =\u0026gt; setTimeout(resolve, 0)) } return results } // æ¨¡æ‹Ÿæ•°æ®æµ async function* dataGenerator(items) { for (const item of items) { yield item await new Promise(resolve =\u0026gt; setTimeout(resolve, 100)) } } // ä½¿ç”¨ç¤ºä¾‹ const items = Array(1000).fill(0).map((_, i) =\u0026gt; i) const stream = dataGenerator(items) const processedData = await processLargeData( stream, async (item) =\u0026gt; { // å¤„ç†æ¯ä¸ªæ•°æ®é¡¹ return item * 2 } ) æ€§èƒ½ä¼˜åŒ–æŠ€å·§ 1. é¿å…ä¸å¿…è¦çš„await 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 // âŒ ä¸å¥½çš„å®è·µ async function processItems(items) { const results = [] for (const item of items) { const result = await processItem(item) results.push(result) } return results } // âœ… å¥½çš„å®è·µ - å¹¶è¡Œå¤„ç† async function processItems(items) { return Promise.all(items.map(item =\u0026gt; processItem(item))) } // âœ… æ›´å¥½çš„å®è·µ - é™åˆ¶å¹¶å‘ async function processItems(items) { return limitConcurrency(items.map(item =\u0026gt; () =\u0026gt; processItem(item)), 10) } 2. ç¼“å­˜Promiseå¯¹è±¡ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 class PromiseCache { constructor() { this.cache = new Map() } async get(key, factory) { // å¦‚æœå·²æœ‰Promiseï¼Œå¤ç”¨å®ƒ if (this.cache.has(key)) { return this.cache.get(key) } // åˆ›å»ºæ–°çš„Promiseå¹¶ç¼“å­˜ const promise = factory() this.cache.set(key, promise) // æ— è®ºæˆåŠŸå¤±è´¥ï¼Œæœ€ç»ˆæ¸…ç†ç¼“å­˜ promise.finally(() =\u0026gt; { this.cache.delete(key) }) return promise } } // ä½¿ç”¨ç¤ºä¾‹ const promiseCache = new PromiseCache() async function getConfig() { return promiseCache.get(\u0026#39;config\u0026#39;, async () =\u0026gt; { const response = await fetch(\u0026#39;/api/config\u0026#39;) return response.json() }) } 3. ä½¿ç”¨Web Workerså¤„ç†é‡ä»»åŠ¡ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 // ä¸»çº¿ç¨‹ async function heavyComputation(data) { return new Promise((resolve, reject) =\u0026gt; { const worker = new Worker(\u0026#39;computation-worker.js\u0026#39;) worker.postMessage(data) worker.onmessage = (event) =\u0026gt; { resolve(event.data) worker.terminate() } worker.onerror = (error) =\u0026gt; { reject(error) worker.terminate() } // è¶…æ—¶å¤„ç† setTimeout(() =\u0026gt; { worker.terminate() reject(new Error(\u0026#39;è®¡ç®—è¶…æ—¶\u0026#39;)) }, 30000) }) } // computation-worker.js self.onmessage = function(event) { const data = event.data // æ‰§è¡Œé‡è®¡ç®—ä»»åŠ¡ const result = performHeavyCalculation(data) self.postMessage(result) } å¸¸è§é™·é˜±ä¸è§£å†³æ–¹æ¡ˆ 1. å¾ªç¯ä¸­çš„å¼‚æ­¥æ“ä½œ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 // âŒ é”™è¯¯ï¼šæ²¡æœ‰ç­‰å¾…æ‰€æœ‰å¼‚æ­¥æ“ä½œå®Œæˆ async function processItems(items) { items.forEach(async item =\u0026gt; { await processItem(item) }) console.log(\u0026#39;å¤„ç†å®Œæˆ\u0026#39;) // å®é™…ä¸Šè¿˜æ²¡å®Œæˆ } // âœ… æ­£ç¡®ï¼šä½¿ç”¨for...of async function processItems(items) { for (const item of items) { await processItem(item) } console.log(\u0026#39;å¤„ç†å®Œæˆ\u0026#39;) } // âœ… å¹¶è¡Œå¤„ç† async function processItems(items) { await Promise.all(items.map(item =\u0026gt; processItem(item))) console.log(\u0026#39;å¤„ç†å®Œæˆ\u0026#39;) } 2. å¼‚æ­¥å‡½æ•°ä¸­çš„æ¡ä»¶è¯­å¥ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 // âŒ å¯èƒ½å¯¼è‡´æ„å¤–è¡Œä¸º async function getUserData(userId) { let user if (userId) { user = await fetchUser(userId) } // user å¯èƒ½æ˜¯ undefined return user } // âœ… æ˜ç¡®å¤„ç†æ‰€æœ‰æƒ…å†µ async function getUserData(userId) { if (!userId) { return null } const user = await fetchUser(userId) return user || null } 3. é”™è¯¯å¤„ç†çš„æœ€ä½³å®è·µ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 // âŒ å¿½ç•¥é”™è¯¯ async function unsafeOperation() { const result = await riskyOperation() // æ²¡æœ‰é”™è¯¯å¤„ç† } // âœ… é€‚å½“çš„é”™è¯¯å¤„ç† async function safeOperation() { try { const result = await riskyOperation() return result } catch (error) { console.error(\u0026#39;æ“ä½œå¤±è´¥:\u0026#39;, error) // å¯ä»¥è¿”å›é»˜è®¤å€¼æˆ–é‡æ–°æŠ›å‡º return null } } // âœ… ä½¿ç”¨ä¸“é—¨çš„é”™è¯¯å¤„ç†å‡½æ•° async function withFallback(operation, fallback) { try { return await operation() } catch (error) { console.warn(\u0026#39;æ“ä½œå¤±è´¥ï¼Œä½¿ç”¨å¤‡ç”¨æ–¹æ¡ˆ:\u0026#39;, error.message) return fallback ? fallback() : null } } æ€»ç»“ JavaScriptå¼‚æ­¥ç¼–ç¨‹çš„æœ€ä½³å®è·µï¼š\næ ¸å¿ƒåŸåˆ™ï¼š\nä¼˜å…ˆä½¿ç”¨async/awaitï¼Œä»£ç æ›´æ˜“è¯» åˆç†ä½¿ç”¨Promise.allå¤„ç†å¹¶å‘ å®ç°é€‚å½“çš„é”™è¯¯å¤„ç†æœºåˆ¶ é¿å…ä¸å¿…è¦çš„ä¸²è¡Œç­‰å¾… æ€§èƒ½ä¼˜åŒ–ï¼š\nå¹¶è¡Œå¤„ç†ç‹¬ç«‹ä»»åŠ¡ ä½¿ç”¨ç¼“å­˜å‡å°‘é‡å¤è¯·æ±‚ å®ç°è¯·æ±‚åˆå¹¶å’Œæ‰¹é‡å¤„ç† è€ƒè™‘ä½¿ç”¨Web Workerså¤„ç†é‡ä»»åŠ¡ ä»£ç è´¨é‡ï¼š\nä¿æŒå¼‚æ­¥æ“ä½œçš„å¯è¿½è¸ªæ€§ å®ç°é‡è¯•å’Œè¶…æ—¶æœºåˆ¶ é¿å…å›è°ƒåœ°ç‹± æä¾›æ¸…æ™°çš„é”™è¯¯ä¿¡æ¯ æŒæ¡è¿™äº›å¼‚æ­¥ç¼–ç¨‹æŠ€å·§ï¼Œå°†å¸®åŠ©ä½ æ„å»ºæ›´å¥å£®ã€æ›´é«˜æ•ˆçš„JavaScriptåº”ç”¨ã€‚\nç›¸å…³èµ„æºï¼š\nMDN Promiseæ–‡æ¡£ Async/awaitæœ€ä½³å®è·µ JavaScriptå¹¶å‘æ¨¡å¼ ","permalink":"/blog/articles/javascript-async-programming-best-practices/","summary":"æ·±å…¥æ¢è®¨JavaScriptå¼‚æ­¥ç¼–ç¨‹çš„æ¼”è¿›å†ç¨‹ï¼ŒæŒæ¡Promiseå’Œasync/awaitçš„æœ€ä½³å®è·µã€‚","title":"JavaScriptå¼‚æ­¥ç¼–ç¨‹æœ€ä½³å®è·µï¼šä»å›è°ƒåˆ°async/await"},{"content":"å¼•è¨€ CSSå¸ƒå±€æŠ€æœ¯åœ¨è¿‡å»å‡ å¹´å‘ç”Ÿäº†é©å‘½æ€§çš„å˜åŒ–ã€‚Flexboxå’ŒGridçš„å‡ºç°ï¼Œè®©æˆ‘ä»¬èƒ½å¤Ÿç”¨æ›´å°‘çš„ä»£ç å®ç°æ›´å¤æ‚çš„å¸ƒå±€æ•ˆæœã€‚æœ¬æ–‡å°†æ·±å…¥æ¢è®¨è¿™ä¸¤ç§ç°ä»£å¸ƒå±€æŠ€æœ¯ï¼Œå¸®åŠ©ä½ æŒæ¡å®ƒä»¬çš„ç²¾é«“å¹¶çµæ´»è¿ç”¨äºå®é™…é¡¹ç›®ä¸­ã€‚\nFlexboxï¼šä¸€ç»´å¸ƒå±€çš„åˆ©å™¨ Flexbox åŸºç¡€æ¦‚å¿µ Flexboxï¼ˆå¼¹æ€§ç›’å­ï¼‰æ˜¯ç”¨äºä¸€ç»´å¸ƒå±€çš„å¼ºå¤§å·¥å…·ï¼Œç‰¹åˆ«é€‚åˆå¤„ç†è¡Œæˆ–åˆ—çš„å¸ƒå±€ï¼š\n1 2 3 4 5 6 7 8 9 10 11 .container { display: flex; /* ä¸»è½´æ–¹å‘ */ flex-direction: row; /* row | row-reverse | column | column-reverse */ /* æ¢è¡Œè®¾ç½® */ flex-wrap: nowrap; /* nowrap | wrap | wrap-reverse */ /* ç®€å†™å±æ€§ */ flex-flow: row nowrap; } ä¸»è½´ä¸äº¤å‰è½´å¯¹é½ 1 2 3 4 5 6 7 8 9 10 .container { /* ä¸»è½´å¯¹é½ */ justify-content: flex-start; /* flex-start | flex-end | center | space-between | space-around | space-evenly */ /* äº¤å‰è½´å¯¹é½ */ align-items: stretch; /* stretch | flex-start | flex-end | center | baseline */ /* å¤šè¡Œå¯¹é½ */ align-content: stretch; /* stretch | flex-start | flex-end | center | space-between | space-around */ } Flex é¡¹ç›®çš„å±æ€§ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 .item { /* æ‰©å±•æ¯”ä¾‹ */ flex-grow: 0; /* æ”¶ç¼©æ¯”ä¾‹ */ flex-shrink: 1; /* åŸºç¡€å¤§å° */ flex-basis: auto; /* ç®€å†™å±æ€§ */ flex: 0 1 auto; /* å•ç‹¬å¯¹é½ */ align-self: auto; /* auto | flex-start | flex-end | center | baseline | stretch */ /* æ’åº */ order: 0; } å®é™…åº”ç”¨ç¤ºä¾‹ 1. å‚ç›´å±…ä¸­çš„ä¸‡èƒ½æ–¹æ¡ˆ 1 2 3 4 5 6 .center-container { display: flex; justify-content: center; align-items: center; min-height: 100vh; } 2. å¯¼èˆªæ å¸ƒå±€ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 .navbar { display: flex; justify-content: space-between; align-items: center; padding: 1rem; } .nav-brand { flex: 0 0 auto; } .nav-links { display: flex; gap: 1rem; } .nav-actions { display: flex; gap: 0.5rem; } 3. ç­‰é«˜å¡ç‰‡å¸ƒå±€ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 .card-container { display: flex; gap: 1rem; } .card { flex: 1; display: flex; flex-direction: column; } .card-content { flex: 1; /* è®©æ‰€æœ‰å¡ç‰‡é«˜åº¦ä¸€è‡´ */ } 4. åœ£æ¯å¸ƒå±€ 1 2 3 4 5 6 7 \u0026lt;div class=\u0026#34;holy-grail\u0026#34;\u0026gt; \u0026lt;header\u0026gt;Header\u0026lt;/header\u0026gt; \u0026lt;main\u0026gt;Main Content\u0026lt;/main\u0026gt; \u0026lt;nav\u0026gt;Navigation\u0026lt;/nav\u0026gt; \u0026lt;aside\u0026gt;Sidebar\u0026lt;/aside\u0026gt; \u0026lt;footer\u0026gt;Footer\u0026lt;/footer\u0026gt; \u0026lt;/div\u0026gt; 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 .holy-grail { display: flex; flex-direction: column; min-height: 100vh; } header, footer { flex: 0 0 auto; } .holy-grail-body { display: flex; flex: 1; } main { flex: 1; order: 2; } nav { flex: 0 0 200px; order: 1; } aside { flex: 0 0 200px; order: 3; } CSS Gridï¼šäºŒç»´å¸ƒå±€çš„é©å‘½ Grid åŸºç¡€æ¦‚å¿µ Gridå¸ƒå±€æ˜¯ä¸“é—¨ä¸ºäºŒç»´å¸ƒå±€è®¾è®¡çš„ï¼Œå¯ä»¥åŒæ—¶æ§åˆ¶è¡Œå’Œåˆ—ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 .grid-container { display: grid; /* å®šä¹‰åˆ—å’Œè¡Œ */ grid-template-columns: 1fr 1fr 1fr; grid-template-rows: 100px 200px; /* ç®€å†™ */ grid-template: \u0026#34;header header header\u0026#34; 60px \u0026#34;nav main aside\u0026#34; 1fr \u0026#34;footer footer footer\u0026#34; 60px / 200px 1fr 200px; /* é—´è· */ gap: 20px; /* row-gap column-gap */ } ç½‘æ ¼çº¿å‘½å 1 2 3 4 5 6 7 8 9 10 11 .grid { display: grid; grid-template-columns: [left-start] 200px [left-end main-start] 1fr [main-end right-start] 200px [right-end]; grid-template-rows: [header-start] 60px [header-end content-start] 1fr [content-end footer-start] 60px [footer-end]; } .item { /* ä½¿ç”¨å‘½åçº¿ */ grid-column: main-start / main-end; grid-row: content-start / content-end; } Grid åŒºåŸŸå‘½å 1 2 3 4 5 6 7 8 9 10 11 12 13 .grid { display: grid; grid-template-areas: \u0026#34;header header header\u0026#34; \u0026#34;nav main aside\u0026#34; \u0026#34;footer footer footer\u0026#34;; } .header { grid-area: header; } .nav { grid-area: nav; } .main { grid-area: main; } .aside { grid-area: aside; } .footer { grid-area: footer; } è‡ªåŠ¨å¸ƒå±€ 1 2 3 4 5 6 7 8 9 10 .grid { display: grid; /* è‡ªåŠ¨å¡«å…… */ grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); /* æˆ–è‡ªåŠ¨é€‚åº” */ grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); /* å¯†é›†å¡«å…… */ grid-auto-flow: row dense; /* row | column | row dense | column dense */ } å®é™…åº”ç”¨ç¤ºä¾‹ 1. å“åº”å¼ç½‘æ ¼ç³»ç»Ÿ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 .responsive-grid { display: grid; gap: 20px; grid-template-columns: repeat(12, 1fr); } .col-1 { grid-column: span 1; } .col-2 { grid-column: span 2; } .col-3 { grid-column: span 3; } .col-4 { grid-column: span 4; } .col-6 { grid-column: span 6; } .col-12 { grid-column: span 12; } @media (max-width: 768px) { .col-6, .col-4, .col-3, .col-2 { grid-column: span 12; } } 2. å›¾ç‰‡ç”»å»Š 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 .gallery { display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 20px; } .gallery-item { aspect-ratio: 1; object-fit: cover; } /* Masonry é£æ ¼ */ .masonry { display: grid; grid-template-columns: repeat(3, 1fr); grid-auto-rows: 20px; gap: 20px; } .masonry-item { grid-row: span var(--row-span); } 3. å¤æ‚çš„ä»ªè¡¨æ¿å¸ƒå±€ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 .dashboard { display: grid; grid-template-columns: 250px 1fr 300px; grid-template-rows: 60px 1fr 40px; grid-template-areas: \u0026#34;header header header\u0026#34; \u0026#34;sidebar main aside\u0026#34; \u0026#34;footer footer footer\u0026#34;; min-height: 100vh; gap: 20px; } .header { grid-area: header; } .sidebar { grid-area: sidebar; } .main { grid-area: main; display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px; } .aside { grid-area: aside; } .footer { grid-area: footer; } /* å“åº”å¼è°ƒæ•´ */ @media (max-width: 1024px) { .dashboard { grid-template-columns: 1fr; grid-template-areas: \u0026#34;header\u0026#34; \u0026#34;main\u0026#34; \u0026#34;aside\u0026#34; \u0026#34;sidebar\u0026#34; \u0026#34;footer\u0026#34;; } .main { grid-template-columns: 1fr; } } Grid ä¸ Flexbox çš„ç»“åˆä½¿ç”¨ å…¸å‹ç»„åˆåœºæ™¯ 1 2 3 4 5 6 7 8 9 \u0026lt;div class=\u0026#34;app\u0026#34;\u0026gt; \u0026lt;header class=\u0026#34;header\u0026#34;\u0026gt;\u0026lt;/header\u0026gt; \u0026lt;div class=\u0026#34;main\u0026#34;\u0026gt; \u0026lt;nav class=\u0026#34;nav\u0026#34;\u0026gt;\u0026lt;/nav\u0026gt; \u0026lt;main class=\u0026#34;content\u0026#34;\u0026gt;\u0026lt;/main\u0026gt; \u0026lt;aside class=\u0026#34;aside\u0026#34;\u0026gt;\u0026lt;/aside\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;footer class=\u0026#34;footer\u0026#34;\u0026gt;\u0026lt;/footer\u0026gt; \u0026lt;/div\u0026gt; 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 .app { display: flex; flex-direction: column; min-height: 100vh; } .header, .footer { flex: 0 0 auto; } .main { flex: 1; display: grid; grid-template-columns: 200px 1fr 250px; gap: 20px; } .content { /* å†…éƒ¨ä½¿ç”¨ Flexbox */ display: flex; flex-direction: column; gap: 20px; } å®æˆ˜æ¡ˆä¾‹ï¼šäº§å“å±•ç¤ºé¡µé¢ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 \u0026lt;div class=\u0026#34;product-page\u0026#34;\u0026gt; \u0026lt;header class=\u0026#34;page-header\u0026#34;\u0026gt; \u0026lt;div class=\u0026#34;header-content\u0026#34;\u0026gt; \u0026lt;h1\u0026gt;äº§å“å±•ç¤º\u0026lt;/h1\u0026gt; \u0026lt;div class=\u0026#34;filters\u0026#34;\u0026gt; \u0026lt;!-- ç­›é€‰æŒ‰é’®ç»„ä½¿ç”¨ Flexbox --\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/header\u0026gt; \u0026lt;div class=\u0026#34;page-main\u0026#34;\u0026gt; \u0026lt;aside class=\u0026#34;sidebar\u0026#34;\u0026gt; \u0026lt;!-- ä¾§è¾¹æ ä½¿ç”¨ Grid --\u0026gt; \u0026lt;/aside\u0026gt; \u0026lt;main class=\u0026#34;product-grid\u0026#34;\u0026gt; \u0026lt;!-- äº§å“ç½‘æ ¼ä½¿ç”¨ Grid --\u0026gt; \u0026lt;/main\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 .product-page { display: flex; flex-direction: column; min-height: 100vh; } .page-header { flex: 0 0 auto; padding: 1rem 0; border-bottom: 1px solid #eee; } .header-content { max-width: 1200px; margin: 0 auto; padding: 0 1rem; display: flex; justify-content: space-between; align-items: center; } .filters { display: flex; gap: 1rem; } .page-main { flex: 1; display: grid; grid-template-columns: 250px 1fr; max-width: 1200px; margin: 0 auto; padding: 2rem 1rem; gap: 2rem; } .product-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 2rem; } @media (max-width: 768px) { .page-main { grid-template-columns: 1fr; } .header-content { flex-direction: column; gap: 1rem; align-items: flex-start; } .filters { flex-wrap: wrap; } } é«˜çº§å¸ƒå±€æŠ€å·§ 1. ä½¿ç”¨ Container Queries 1 2 3 4 5 6 7 8 9 10 11 .card-container { container-type: inline-size; } @container (min-width: 400px) { .card { display: grid; grid-template-columns: 1fr 2fr; gap: 1rem; } } 2. Subgrid å­ç½‘æ ¼ 1 2 3 4 5 6 7 8 9 10 11 .parent-grid { display: grid; grid-template-columns: 200px 1fr; gap: 20px; } .child-grid { display: grid; grid-template-columns: subgrid; /* ç»§æ‰¿çˆ¶ç½‘æ ¼çš„åˆ—å®šä¹‰ */ } 3. åŠ¨æ€ç½‘æ ¼å¸ƒå±€ 1 2 3 4 5 6 7 8 9 .dynamic-grid { display: grid; gap: 20px; /* æ ¹æ®å®¹å™¨å®½åº¦è‡ªåŠ¨è°ƒæ•´åˆ—æ•° */ grid-template-columns: repeat( auto-fit, minmax(min(100%, 300px), 1fr) ); } 4. å±‚å å¸ƒå±€ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 .stack-layout { display: grid; /* åˆ›å»ºå¤šä¸ªå±‚ */ grid-template-areas: \u0026#34;layer1\u0026#34; \u0026#34;layer2\u0026#34; \u0026#34;layer3\u0026#34;; } .layer1 { grid-area: layer1; } .layer2 { grid-area: layer2; } .layer3 { grid-area: layer3; } /* ä½¿ç”¨ z-index æ§åˆ¶å±‚å é¡ºåº */ .layer3 { z-index: 3; } .layer2 { z-index: 2; } .layer1 { z-index: 1; } æ€§èƒ½ä¼˜åŒ–å»ºè®® 1. é¿å…è¿‡åº¦ä½¿ç”¨ Grid 1 2 3 4 5 6 7 8 9 10 11 12 /* âœ… ç®€å•å¸ƒå±€ä½¿ç”¨ Flexbox */ .simple-flex { display: flex; align-items: center; gap: 10px; } /* âŒ ä¸å¿…è¦çš„å¤æ‚ Grid */ .unnecessary-grid { display: grid; grid-template-columns: auto 1fr; } 2. åˆç†ä½¿ç”¨ gap å±æ€§ 1 2 3 4 5 6 7 8 /* âœ… ä½¿ç”¨ gap ä»£æ›¿ margin */ .grid-item { /* ä¸éœ€è¦ margin */ } .grid-container { gap: 20px; /* ç»Ÿä¸€é—´è· */ } 3. ä¼˜åŒ–é‡ç»˜å’Œé‡æ’ 1 2 3 4 5 6 .optimized-grid { display: grid; /* ä½¿ç”¨ transform ä»£æ›¿ top/left */ transform: translateX(100px); will-change: transform; /* æç¤ºæµè§ˆå™¨ä¼˜åŒ– */ } å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ é—®é¢˜ 1ï¼šå†…å®¹æº¢å‡º 1 2 3 4 5 6 7 8 9 10 .grid { display: grid; grid-template-columns: 300px 1fr; min-width: 0; /* é˜²æ­¢ç½‘æ ¼é¡¹æº¢å‡º */ } .grid-item { min-width: 0; overflow: auto; } é—®é¢˜ 2ï¼šç­‰é«˜å¸ƒå±€ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 /* Flexbox æ–¹æ¡ˆ */ .flex-equal-height { display: flex; gap: 20px; } .flex-item { flex: 1; } /* Grid æ–¹æ¡ˆ */ .grid-equal-height { display: grid; grid-auto-rows: 1fr; /* è‡ªåŠ¨ç­‰é«˜ */ gap: 20px; } é—®é¢˜ 3ï¼šå“åº”å¼å›¾ç‰‡ 1 2 3 4 5 6 7 8 9 10 11 .image-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 10px; } .image-grid img { width: 100%; height: 100%; object-fit: cover; } æ€»ç»“ ç°ä»£CSSå¸ƒå±€æŠ€æœ¯è®©æˆ‘ä»¬èƒ½å¤Ÿç”¨æ›´ç®€æ´ã€æ›´è¯­ä¹‰åŒ–çš„æ–¹å¼åˆ›å»ºå¤æ‚å¸ƒå±€ï¼š\nFlexbox é€‚åˆçš„åœºæ™¯ï¼š\nä¸€ç»´å¸ƒå±€ï¼ˆè¡Œæˆ–åˆ—ï¼‰ ç»„ä»¶å†…éƒ¨å¸ƒå±€ å‚ç›´å±…ä¸­ ç­‰é—´è·åˆ†å¸ƒ Grid é€‚åˆçš„åœºæ™¯ï¼š\näºŒç»´å¸ƒå±€ï¼ˆè¡Œå’Œåˆ—ï¼‰ é¡µé¢æ•´ä½“å¸ƒå±€ å¤æ‚çš„å¯¹é½éœ€æ±‚ å“åº”å¼ç½‘æ ¼ç³»ç»Ÿ æœ€ä½³å®è·µï¼š\nå…ˆè€ƒè™‘æ•´ä½“å¸ƒå±€æ˜¯å¦éœ€è¦Grid ç»„ä»¶å†…éƒ¨ä¼˜å…ˆä½¿ç”¨Flexbox å–„ç”¨auto-fillå’Œauto-fitåˆ›å»ºå“åº”å¼å¸ƒå±€ ä½¿ç”¨gapå±æ€§ç®¡ç†é—´è· åˆç†ç»“åˆä¸¤ç§å¸ƒå±€æŠ€æœ¯ æŒæ¡è¿™äº›ç°ä»£å¸ƒå±€æŠ€æœ¯ï¼Œå°†å¤§å¤§æå‡ä½ çš„CSSå¼€å‘æ•ˆç‡ï¼Œè®©ä½ èƒ½å¤Ÿè½»æ¾åº”å¯¹å„ç§å¤æ‚çš„å¸ƒå±€éœ€æ±‚ã€‚\nç›¸å…³èµ„æºï¼š\nCSS Grid Guide - MDN Flexbox Guide - MDN CSS Grid Playground Flexbox Froggy ","permalink":"/blog/articles/modern-css-layout-techniques/","summary":"æ·±å…¥è§£æCSS Gridå’ŒFlexboxå¸ƒå±€æŠ€æœ¯ï¼Œå¸®åŠ©ä½ è½»æ¾æ„å»ºå¤æ‚è€Œçµæ´»çš„ç½‘é¡µå¸ƒå±€ã€‚","title":"ç°ä»£CSSå¸ƒå±€æŠ€æœ¯ï¼šGridä¸Flexboxå®Œå…¨æŒ‡å—"},{"content":"å‰è¨€ Vue 3.5 å¸¦æ¥äº†è®¸å¤šä»¤äººå…´å¥‹çš„æ–°ç‰¹æ€§å’Œæ€§èƒ½ä¼˜åŒ–ï¼Œå…¶ä¸­ Composition API å·²ç»æˆä¸º Vue å¼€å‘çš„é¦–é€‰æ–¹å¼ã€‚å®ƒæä¾›äº†æ›´çµæ´»çš„ä»£ç ç»„ç»‡æ–¹å¼ã€æ›´å¥½çš„ TypeScript æ”¯æŒä»¥åŠæ›´å¼ºå¤§çš„é€»è¾‘å¤ç”¨èƒ½åŠ›ã€‚æœ¬æ–‡å°†å¸¦ä½ æ·±å…¥ç†è§£ Composition API çš„æ ¸å¿ƒæ¦‚å¿µå’Œé«˜çº§ç”¨æ³•ã€‚\nå“åº”å¼åŸºç¡€ï¼šref ä¸ reactive refï¼šåŸºç¡€å“åº”å¼å¼•ç”¨ ref æ˜¯ Composition API ä¸­æœ€åŸºæœ¬çš„å“åº”å¼ APIï¼Œé€‚ç”¨äºä»»ä½•ç±»å‹çš„å€¼ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 import { ref } from \u0026#39;vue\u0026#39; // åŸºç¡€ç”¨æ³• const count = ref(0) const message = ref(\u0026#39;Hello Vue\u0026#39;) const isVisible = ref(false) // åœ¨æ¨¡æ¿ä¸­ä½¿ç”¨æ—¶ä¼šè‡ªåŠ¨è§£åŒ… // \u0026lt;template\u0026gt;{{ count }}\u0026lt;/template\u0026gt; // åœ¨ JavaScript ä¸­è®¿é—®éœ€è¦ .value console.log(count.value) // 0 count.value = 1 æœ€ä½³å®è·µï¼šref çš„å‘½åè§„èŒƒ 1 2 3 4 5 6 7 8 // âœ… å¥½çš„å‘½å const isLoading = ref(false) const errorMessage = ref(\u0026#39;\u0026#39;) const userCount = ref(0) // âŒ é¿å…çš„å‘½å const data = ref(null) // å¤ªé€šç”¨ const flag = ref(true) // ä¸å¤Ÿæ˜ç¡® reactiveï¼šå¯¹è±¡å“åº”å¼ä»£ç† å¯¹äºå¯¹è±¡ç±»å‹çš„æ•°æ®ï¼Œreactive æä¾›äº†æ›´è‡ªç„¶çš„è®¿é—®æ–¹å¼ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 import { reactive } from \u0026#39;vue\u0026#39; const state = reactive({ user: { name: \u0026#39;John\u0026#39;, email: \u0026#39;john@example.com\u0026#39; }, settings: { theme: \u0026#39;dark\u0026#39;, language: \u0026#39;zh-CN\u0026#39; } }) // ç›´æ¥è®¿é—®ï¼Œæ— éœ€ .value console.log(state.user.name) state.settings.theme = \u0026#39;light\u0026#39; reactive çš„æ³¨æ„äº‹é¡¹ 1 2 3 4 5 6 7 8 9 10 11 12 13 // âœ… æ¨èï¼šå§‹ç»ˆä½¿ç”¨å“åº”å¼å¯¹è±¡ const form = reactive({ username: \u0026#39;\u0026#39;, password: \u0026#39;\u0026#39;, email: \u0026#39;\u0026#39; }) // âŒ é¿å…ï¼šè§£æ„ä¼šä¸¢å¤±å“åº”æ€§ const { username } = form // username ä¸å†æ˜¯å“åº”å¼çš„ // âœ… æ­£ç¡®çš„è§£æ„æ–¹å¼ import { toRefs } from \u0026#39;vue\u0026#39; const { username, password, email } = toRefs(form) è®¡ç®—å±æ€§ï¼šcomputed çš„å¼ºå¤§åŠŸèƒ½ åŸºç¡€è®¡ç®—å±æ€§ 1 2 3 4 5 6 import { ref, computed } from \u0026#39;vue\u0026#39; const firstName = ref(\u0026#39;John\u0026#39;) const lastName = ref(\u0026#39;Doe\u0026#39;) const fullName = computed(() =\u0026gt; `${firstName.value} ${lastName.value}`) å¯å†™çš„è®¡ç®—å±æ€§ 1 2 3 4 5 6 7 8 9 10 11 12 13 const fullName = computed({ get() { return `${firstName.value} ${lastName.value}` }, set(newValue) { const [first, last] = newValue.split(\u0026#39; \u0026#39;) firstName.value = first lastName.value = last } }) // å¯ä»¥ç›´æ¥èµ‹å€¼ fullName.value = \u0026#39;Jane Smith\u0026#39; è®¡ç®—å±æ€§çš„ç¼“å­˜ä¸æ€§èƒ½ 1 2 3 4 5 6 7 8 9 10 11 12 // expensiveCalculation åªåœ¨ä¾èµ–é¡¹å˜åŒ–æ—¶æ‰§è¡Œ const expensiveResult = computed(() =\u0026gt; { console.log(\u0026#39;æ‰§è¡Œå¤æ‚è®¡ç®—...\u0026#39;) return heavyCalculation(data.value) }) // é¿å…åœ¨è®¡ç®—å±æ€§ä¸­è¿›è¡Œå‰¯ä½œç”¨æ“ä½œ const badExample = computed(() =\u0026gt; { // âŒ ä¸è¦åœ¨ computed ä¸­ä¿®æ”¹å…¶ä»–å“åº”å¼æ•°æ® otherValue.value = processData(data.value) return processedData }) ä¾¦å¬å™¨ï¼šwatch ä¸ watchEffect watchï¼šç²¾ç¡®çš„å“åº”å¼ä¾¦å¬ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 import { ref, watch } from \u0026#39;vue\u0026#39; const searchQuery = ref(\u0026#39;\u0026#39;) const results = ref([]) // åŸºç¡€ç”¨æ³• watch(searchQuery, (newQuery, oldQuery) =\u0026gt; { console.log(`æŸ¥è¯¢ä» \u0026#34;${oldQuery}\u0026#34; å˜ä¸º \u0026#34;${newQuery}\u0026#34;`) fetchResults(newQuery) }) // ä¾¦å¬å¤šä¸ªæº watch([searchQuery, filterType], ([newQuery, newFilter], [oldQuery, oldFilter]) =\u0026gt; { fetchFilteredResults(newQuery, newFilter) }) watch çš„é…ç½®é€‰é¡¹ 1 2 3 4 5 6 7 8 9 10 11 watch( source, (newValue, oldValue) =\u0026gt; { // å›è°ƒå‡½æ•° }, { immediate: true, // ç«‹å³æ‰§è¡Œä¸€æ¬¡ deep: true, // æ·±åº¦ä¾¦å¬ flush: \u0026#39;post\u0026#39; // \u0026#39;pre\u0026#39; | \u0026#39;post\u0026#39; | \u0026#39;sync\u0026#39; } ) watchEffectï¼šè‡ªåŠ¨è¿½è¸ªä¾èµ– 1 2 3 4 5 6 7 8 9 10 11 12 import { watchEffect, ref } from \u0026#39;vue\u0026#39; const userId = ref(1) const userData = ref(null) // è‡ªåŠ¨è¿½è¸ªå›è°ƒä¸­ä½¿ç”¨çš„å“åº”å¼æ•°æ® watchEffect(async () =\u0026gt; { console.log(`è·å–ç”¨æˆ· ${userId.value} çš„æ•°æ®`) userData.value = await fetchUser(userId.value) }) // å½“ userId å˜åŒ–æ—¶ï¼Œeffect ä¼šè‡ªåŠ¨é‡æ–°è¿è¡Œ æ¸…ç†å‰¯ä½œç”¨ 1 2 3 4 5 6 7 8 9 10 watchEffect((onCleanup) =\u0026gt; { const timer = setInterval(() =\u0026gt; { updateData() }, 1000) // æ³¨å†Œæ¸…ç†å‡½æ•° onCleanup(() =\u0026gt; { clearInterval(timer) }) }) ç»„åˆå¼å‡½æ•°ï¼šé€»è¾‘å¤ç”¨çš„è‰ºæœ¯ åˆ›å»ºå¯å¤ç”¨çš„ç»„åˆå¼å‡½æ•° 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 // composables/useCounter.js import { ref, computed } from \u0026#39;vue\u0026#39; export function useCounter(initialValue = 0) { const count = ref(initialValue) const doubled = computed(() =\u0026gt; count.value * 2) const isEven = computed(() =\u0026gt; count.value % 2 === 0) const increment = (step = 1) =\u0026gt; { count.value += step } const decrement = (step = 1) =\u0026gt; { count.value -= step } const reset = () =\u0026gt; { count.value = initialValue } return { count, doubled, isEven, increment, decrement, reset } } åœ¨ç»„ä»¶ä¸­ä½¿ç”¨ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 \u0026lt;template\u0026gt; \u0026lt;div\u0026gt; \u0026lt;p\u0026gt;è®¡æ•°: {{ count }}\u0026lt;/p\u0026gt; \u0026lt;p\u0026gt;åŒå€: {{ doubled }}\u0026lt;/p\u0026gt; \u0026lt;p\u0026gt;å¶æ•°: {{ isEven ? \u0026#39;æ˜¯\u0026#39; : \u0026#39;å¦\u0026#39; }}\u0026lt;/p\u0026gt; \u0026lt;button @click=\u0026#34;increment()\u0026#34;\u0026gt;å¢åŠ \u0026lt;/button\u0026gt; \u0026lt;button @click=\u0026#34;decrement()\u0026#34;\u0026gt;å‡å°‘\u0026lt;/button\u0026gt; \u0026lt;button @click=\u0026#34;reset()\u0026#34;\u0026gt;é‡ç½®\u0026lt;/button\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/template\u0026gt; \u0026lt;script setup\u0026gt; import { useCounter } from \u0026#39;@/composables/useCounter\u0026#39; const { count, doubled, isEven, increment, decrement, reset } = useCounter(10) \u0026lt;/script\u0026gt; é«˜çº§ç»„åˆå¼å‡½æ•°ç¤ºä¾‹ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 // composables/useFetch.js import { ref, watchEffect } from \u0026#39;vue\u0026#39; export function useFetch(url, options = {}) { const data = ref(null) const error = ref(null) const loading = ref(false) const execute = async () =\u0026gt; { loading.value = true error.value = null try { const response = await fetch(url.value || url, options) if (!response.ok) { throw new Error(`HTTP error! status: ${response.status}`) } data.value = await response.json() } catch (err) { error.value = err.message } finally { loading.value = false } } // å¦‚æœ url æ˜¯å“åº”å¼çš„ï¼Œè‡ªåŠ¨é‡æ–°è·å– if (typeof url === \u0026#39;object\u0026#39;) { watchEffect(execute) } else { execute() } return { data, error, loading, execute } } Vue 3.5 æ–°ç‰¹æ€§æ¢ç´¢ defineModel ç®€åŒ–åŒå‘ç»‘å®š 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 \u0026lt;!-- Vue 3.5 ä¹‹å‰ --\u0026gt; \u0026lt;script setup\u0026gt; const props = defineProps([\u0026#39;modelValue\u0026#39;]) const emit = defineEmits([\u0026#39;update:modelValue\u0026#39;]) const updateValue = (event) =\u0026gt; { emit(\u0026#39;update:modelValue\u0026#39;, event.target.value) } \u0026lt;/script\u0026gt; \u0026lt;!-- Vue 3.5 æ–°è¯­æ³• --\u0026gt; \u0026lt;script setup\u0026gt; const modelValue = defineModel() \u0026lt;/script\u0026gt; \u0026lt;template\u0026gt; \u0026lt;input v-model=\u0026#34;modelValue\u0026#34; /\u0026gt; \u0026lt;/template\u0026gt; Teleport çš„å¢å¼ºç”¨æ³• 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 \u0026lt;template\u0026gt; \u0026lt;div\u0026gt; \u0026lt;button @click=\u0026#34;showModal = true\u0026#34;\u0026gt;æ‰“å¼€æ¨¡æ€æ¡†\u0026lt;/button\u0026gt; \u0026lt;Teleport to=\u0026#34;body\u0026#34;\u0026gt; \u0026lt;div v-if=\u0026#34;showModal\u0026#34; class=\u0026#34;modal\u0026#34;\u0026gt; \u0026lt;div class=\u0026#34;modal-content\u0026#34;\u0026gt; \u0026lt;h2\u0026gt;æ¨¡æ€æ¡†æ ‡é¢˜\u0026lt;/h2\u0026gt; \u0026lt;p\u0026gt;å†…å®¹è¢«ä¼ é€åˆ° body å…ƒç´ ä¸‹\u0026lt;/p\u0026gt; \u0026lt;button @click=\u0026#34;showModal = false\u0026#34;\u0026gt;å…³é—­\u0026lt;/button\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/Teleport\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/template\u0026gt; \u0026lt;style\u0026gt; .modal { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0, 0, 0, 0.5); display: flex; align-items: center; justify-content: center; } .modal-content { background: white; padding: 20px; border-radius: 8px; max-width: 500px; } \u0026lt;/style\u0026gt; æ€§èƒ½ä¼˜åŒ–æŠ€å·§ ä½¿ç”¨ shallowRef å’Œ shallowReactive 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 import { shallowRef, shallowReactive, triggerRef } from \u0026#39;vue\u0026#39; // å¯¹äºå¤§å‹å¯¹è±¡ï¼Œé¿å…æ·±åº¦å“åº”å¼ const largeData = shallowRef({ // å¤§é‡åµŒå¥—æ•°æ® }) // ä¿®æ”¹æ·±å±‚å±æ€§éœ€è¦æ‰‹åŠ¨è§¦å‘ largeData.value.deep.property = \u0026#39;new value\u0026#39; triggerRef(largeData) // æˆ–è€…ä½¿ç”¨ markRaw æ ‡è®°ä¸éœ€è¦å“åº”å¼çš„å¯¹è±¡ import { markRaw } from \u0026#39;vue\u0026#39; const staticConfig = markRaw({ // é™æ€é…ç½®ï¼Œä¸éœ€è¦å“åº”å¼ }) ä½¿ç”¨ readonly ä¿æŠ¤æ•°æ® 1 2 3 4 5 6 7 8 9 10 11 import { reactive, readonly } from \u0026#39;vue\u0026#39; const state = reactive({ count: 0, name: \u0026#39;Vue\u0026#39; }) // æä¾›åªè¯»ç‰ˆæœ¬ç»™å­ç»„ä»¶ const readonlyState = readonly(state) // å­ç»„ä»¶æ— æ³•ä¿®æ”¹ï¼Œç¡®ä¿æ•°æ®æµå‘æ¸…æ™° å¸¸è§é™·é˜±ä¸è§£å†³æ–¹æ¡ˆ é™·é˜± 1ï¼šè§£æ„å¤±å»å“åº”æ€§ 1 2 3 4 5 6 7 8 9 10 11 const state = reactive({ count: 0 }) // âŒ é”™è¯¯ï¼šcount ä¸å†æ˜¯å“åº”å¼çš„ const { count } = state // âœ… è§£å†³æ–¹æ¡ˆ 1ï¼šä½¿ç”¨ toRefs import { toRefs } from \u0026#39;vue\u0026#39; const { count } = toRefs(state) // âœ… è§£å†³æ–¹æ¡ˆ 2ï¼šç›´æ¥ä½¿ç”¨ state.count // åœ¨æ¨¡æ¿ä¸­ï¼š{{ state.count }} é™·é˜± 2ï¼šåœ¨ watch ä¸­æ— é™å¾ªç¯ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 const data = ref(0) // âŒ å¯èƒ½å¯¼è‡´æ— é™å¾ªç¯ watch(data, () =\u0026gt; { data.value = data.value + 1 }) // âœ… ä½¿ç”¨ nextTick æˆ–æ¡ä»¶åˆ¤æ–­ watch(data, async () =\u0026gt; { await nextTick() if (someCondition) { data.value = data.value + 1 } }) é™·é˜± 3ï¼šå¼‚æ­¥æ“ä½œçš„ç«æ€æ¡ä»¶ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 const data = ref(null) // âŒ å¤šä¸ªè¯·æ±‚å¯èƒ½å¯¼è‡´ç«æ€ watch(searchQuery, async () =\u0026gt; { data.value = await fetchResults(searchQuery.value) }) // âœ… ä½¿ç”¨å–æ¶ˆä»¤ç‰Œæˆ– AbortController watch(searchQuery, async (newQuery, oldQuery, onCleanup) =\u0026gt; { const controller = new AbortController() onCleanup(() =\u0026gt; { controller.abort() }) data.value = await fetchResults(newQuery, { signal: controller.signal }) }) æ€»ç»“ Vue 3.5 çš„ Composition API ä¸ºæˆ‘ä»¬æä¾›äº†å¼ºå¤§çš„å·¥å…·æ¥æ„å»ºå¯ç»´æŠ¤ã€å¯å¤ç”¨çš„å‰ç«¯åº”ç”¨ã€‚é€šè¿‡åˆç†ä½¿ç”¨ refã€reactiveã€computedã€watch ç­‰æ ¸å¿ƒ APIï¼Œæˆ‘ä»¬å¯ä»¥å†™å‡ºæ›´åŠ æ¸…æ™°å’Œé«˜æ•ˆçš„ä»£ç ã€‚\nå…³é”®è¦ç‚¹ï¼š\nç†è§£ ref å’Œ reactive çš„ä½¿ç”¨åœºæ™¯å’ŒåŒºåˆ« å–„ç”¨ computed è¿›è¡Œæ•°æ®æ´¾ç”Ÿå’Œç¼“å­˜ åˆç†ä½¿ç”¨ watch å’Œ watchEffect å¤„ç†å‰¯ä½œç”¨ é€šè¿‡ç»„åˆå¼å‡½æ•°å®ç°é€»è¾‘å¤ç”¨ æ³¨æ„å¸¸è§çš„æ€§èƒ½é™·é˜±å’Œä¼˜åŒ–æŠ€å·§ æŒæ¡ Composition API ä¸ä»…èƒ½æå‡ä½ çš„ Vue å¼€å‘æŠ€èƒ½ï¼Œæ›´èƒ½è®©ä½ åœ¨æ„å»ºå¤§å‹åº”ç”¨æ—¶æ¸¸åˆƒæœ‰ä½™ã€‚\nç›¸å…³èµ„æºï¼š\nVue 3 å®˜æ–¹æ–‡æ¡£ Composition API å¸¸è§é—®é¢˜ Vue 3.5 å‘å¸ƒè¯´æ˜ ","permalink":"/blog/articles/vue-3-5-composition-api-deep-dive/","summary":"æ·±å…¥æ¢ç´¢Vue 3.5 Composition APIçš„æ ¸å¿ƒæ¦‚å¿µå’Œé«˜çº§ç”¨æ³•ï¼Œå¸®åŠ©ä½ æŒæ¡å“åº”å¼ç¼–ç¨‹çš„ç²¾é«“ã€‚","title":"Vue 3.5 Composition API æ·±åº¦è§£æï¼šæŒæ¡å“åº”å¼ç¼–ç¨‹çš„è‰ºæœ¯"},{"content":"å¼•è¨€ åœ¨æ—¥å¸¸å¼€å‘å·¥ä½œä¸­ï¼Œæˆ‘ä»¬ç»å¸¸éœ€è¦å¤„ç†å„ç§é‡å¤æ€§ä»»åŠ¡ï¼šæ•°æ®æ ¼å¼è½¬æ¢ã€APIæµ‹è¯•ã€é…ç½®ç”Ÿæˆç­‰ã€‚è™½ç„¶å¸‚é¢ä¸Šæœ‰å¾ˆå¤šç°æˆçš„å·¥å…·ï¼Œä½†å¾€å¾€æ— æ³•å®Œå…¨æ»¡è¶³æˆ‘ä»¬çš„ç‰¹å®šéœ€æ±‚ã€‚è¿™æ—¶å€™ï¼Œå¼€å‘ä¸€æ¬¾é€‚åˆè‡ªå·±å›¢é˜Ÿçš„å®ç”¨å·¥å…·å°±æ˜¾å¾—å°¤ä¸ºé‡è¦ã€‚\næœ€è¿‘ï¼Œæˆ‘ä»¬çš„å·¥å…·åº“æ–°å¢äº†ä¸€ç³»åˆ—å®ç”¨çš„å¼€å‘å·¥å…·ï¼ŒåŒ…æ‹¬é‡‘èè®¡ç®—å™¨ã€æ•°æ®åŠ å¯†å·¥å…·ã€ä»¥åŠSpineåŠ¨ç”»ç¼–è¾‘å™¨ç­‰ã€‚ä»Šå¤©å°±æƒ³å’Œå¤§å®¶åˆ†äº«ä¸€ä¸‹ï¼Œå¦‚ä½•ä»é›¶å¼€å§‹æ„å»ºä¸€æ¬¾å®ç”¨çš„Webå¼€å‘å·¥å…·ã€‚\néœ€æ±‚åˆ†æï¼šæ‰¾åˆ°çœŸæ­£çš„ç—›ç‚¹ è¯†åˆ«ç”¨æˆ·éœ€æ±‚ ä¸€ä¸ªæˆåŠŸçš„å·¥å…·é¦–å…ˆè¦è§£å†³ç”¨æˆ·çš„å®é™…é—®é¢˜ã€‚æˆ‘ä»¬åœ¨è§„åˆ’æ–°å·¥å…·æ—¶ï¼Œé€šå¸¸ä¼šä»ä»¥ä¸‹å‡ ä¸ªç»´åº¦æ€è€ƒï¼š\næ•ˆç‡æå‡ï¼šè¿™ä¸ªå·¥å…·èƒ½å¦æ˜¾è‘—æé«˜å·¥ä½œæ•ˆç‡ï¼Ÿ ä½¿ç”¨é¢‘ç‡ï¼šç”¨æˆ·æ˜¯å¦ç»å¸¸éœ€è¦ç”¨åˆ°è¿™ä¸ªåŠŸèƒ½ï¼Ÿ ç°æœ‰æ–¹æ¡ˆä¸è¶³ï¼šç°æœ‰å·¥å…·å­˜åœ¨å“ªäº›ç—›ç‚¹ï¼Ÿ ç›®æ ‡ç”¨æˆ·ï¼šä¸»è¦é¢å‘å“ªäº›ç”¨æˆ·ç¾¤ä½“ï¼Ÿ ä¾‹å¦‚ï¼Œæˆ‘ä»¬çš„æŠ•èµ„ROIè®¡ç®—å™¨å°±æ˜¯å›¢é˜Ÿåœ¨åšé¡¹ç›®è¯„ä¼°æ—¶ï¼Œç»å¸¸éœ€è¦å¿«é€Ÿè®¡ç®—æŠ•èµ„å›æŠ¥ç‡ï¼Œè€ŒExcelæ“ä½œè¿‡äºç¹çï¼Œäºæ˜¯å†³å®šå¼€å‘ä¸€ä¸ªä¸“é—¨çš„å°å·¥å…·ã€‚\nåŠŸèƒ½èŒƒå›´å®šä¹‰ ç¡®å®šæ ¸å¿ƒåŠŸèƒ½ï¼Œé¿å…åŠŸèƒ½è¿‡åº¦è†¨èƒ€ã€‚éµå¾ª\u0026quot;æœ€å°å¯è¡Œäº§å“\u0026quot;ï¼ˆMVPï¼‰åŸåˆ™ï¼š\næ ¸å¿ƒåŠŸèƒ½ï¼šå·¥å…·å¿…é¡»å…·å¤‡çš„åŸºæœ¬åŠŸèƒ½ å¢å¼ºåŠŸèƒ½ï¼šæå‡ç”¨æˆ·ä½“éªŒçš„é™„åŠ åŠŸèƒ½ æœªæ¥æ‰©å±•ï¼šå¯ä»¥è€ƒè™‘çš„æ½œåœ¨åŠŸèƒ½ ä»¥æˆ‘ä»¬çš„MD5ç”Ÿæˆå™¨ä¸ºä¾‹ï¼š\næ ¸å¿ƒåŠŸèƒ½ï¼šæ–‡æœ¬è¾“å…¥ã€MD5ç”Ÿæˆ å¢å¼ºåŠŸèƒ½ï¼šæ‰¹é‡å¤„ç†ã€ç»“æœå¤åˆ¶ã€å†å²è®°å½• æœªæ¥æ‰©å±•ï¼šæ”¯æŒå…¶ä»–å“ˆå¸Œç®—æ³•ã€æ–‡ä»¶å¤„ç† æŠ€æœ¯é€‰å‹ï¼šé€‰æ‹©åˆé€‚çš„æŠ€æœ¯æ ˆ å‰ç«¯æ¡†æ¶é€‰æ‹© è€ƒè™‘åˆ°å·¥å…·çš„å¤æ‚åº¦å’Œå›¢é˜ŸæŠ€æœ¯æ ˆï¼Œæˆ‘ä»¬é€‰æ‹©äº†Vue 3 + Nuxt.jsçš„ç»„åˆï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 \u0026lt;template\u0026gt; \u0026lt;div class=\u0026#34;tool-container\u0026#34;\u0026gt; \u0026lt;div class=\u0026#34;input-section\u0026#34;\u0026gt; \u0026lt;label for=\u0026#34;input-text\u0026#34;\u0026gt;è¾“å…¥æ–‡æœ¬\u0026lt;/label\u0026gt; \u0026lt;textarea id=\u0026#34;input-text\u0026#34; v-model=\u0026#34;inputText\u0026#34; @input=\u0026#34;generateHash\u0026#34; placeholder=\u0026#34;è¯·è¾“å…¥è¦ç”ŸæˆMD5çš„æ–‡æœ¬\u0026#34; /\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;div class=\u0026#34;output-section\u0026#34;\u0026gt; \u0026lt;label\u0026gt;MD5 ç»“æœ\u0026lt;/label\u0026gt; \u0026lt;div class=\u0026#34;result-box\u0026#34;\u0026gt; \u0026lt;code\u0026gt;{{ md5Result }}\u0026lt;/code\u0026gt; \u0026lt;button @click=\u0026#34;copyToClipboard\u0026#34; :disabled=\u0026#34;!md5Result\u0026#34; class=\u0026#34;copy-btn\u0026#34; \u0026gt; å¤åˆ¶ \u0026lt;/button\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/template\u0026gt; \u0026lt;script setup\u0026gt; import { ref, watch } from \u0026#39;vue\u0026#39; import md5 from \u0026#39;md5\u0026#39; const inputText = ref(\u0026#39;\u0026#39;) const md5Result = ref(\u0026#39;\u0026#39;) const generateHash = () =\u0026gt; { if (inputText.value) { md5Result.value = md5(inputText.value) } else { md5Result.value = \u0026#39;\u0026#39; } } const copyToClipboard = async () =\u0026gt; { try { await navigator.clipboard.writeText(md5Result.value) // æ˜¾ç¤ºå¤åˆ¶æˆåŠŸæç¤º } catch (err) { console.error(\u0026#39;å¤åˆ¶å¤±è´¥:\u0026#39;, err) } } \u0026lt;/script\u0026gt; çŠ¶æ€ç®¡ç†ç­–ç•¥ å¯¹äºç®€å•å·¥å…·ï¼Œä½¿ç”¨Vue 3çš„Composition API + ref/reactiveå°±è¶³å¤Ÿäº†ã€‚ä½†å¦‚æœå·¥å…·æ¶‰åŠå¤æ‚çš„çŠ¶æ€ç®¡ç†ï¼Œå¯ä»¥è€ƒè™‘Piniaï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 // stores/calculator.js import { defineStore } from \u0026#39;pinia\u0026#39; export const useCalculatorStore = defineStore(\u0026#39;calculator\u0026#39;, { state: () =\u0026gt; ({ principal: 0, rate: 0, time: 0, result: 0, history: [] }), getters: { monthlyReturn: (state) =\u0026gt; { return (state.principal * state.rate / 100 / 12).toFixed(2) } }, actions: { calculate() { this.result = this.principal * (1 + this.rate / 100) ** this.time this.history.push({ timestamp: Date.now(), input: { principal: this.principal, rate: this.rate, time: this.time }, result: this.result }) } } }) UI/UXè®¾è®¡ï¼šæ³¨é‡ç”¨æˆ·ä½“éªŒ å“åº”å¼è®¾è®¡ å·¥å…·éœ€è¦åœ¨å„ç§è®¾å¤‡ä¸Šéƒ½èƒ½è‰¯å¥½è¿è¡Œï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 .tool-container { max-width: 1200px; margin: 0 auto; padding: 20px; } @media (max-width: 768px) { .tool-container { padding: 10px; } .input-section, .output-section { width: 100%; margin-bottom: 15px; } } .grid-layout { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; } äº¤äº’åé¦ˆ æä¾›å³æ—¶çš„ç”¨æˆ·åé¦ˆï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 \u0026lt;template\u0026gt; \u0026lt;button @click=\u0026#34;handleSubmit\u0026#34; :class=\u0026#34;{ \u0026#39;loading\u0026#39;: isLoading }\u0026#34; :disabled=\u0026#34;isLoading\u0026#34; \u0026gt; \u0026lt;span v-if=\u0026#34;isLoading\u0026#34;\u0026gt;å¤„ç†ä¸­...\u0026lt;/span\u0026gt; \u0026lt;span v-else\u0026gt;ç”Ÿæˆç»“æœ\u0026lt;/span\u0026gt; \u0026lt;/button\u0026gt; \u0026lt;Transition name=\u0026#34;fade\u0026#34;\u0026gt; \u0026lt;div v-if=\u0026#34;showSuccess\u0026#34; class=\u0026#34;success-message\u0026#34;\u0026gt; æ“ä½œæˆåŠŸï¼ \u0026lt;/div\u0026gt; \u0026lt;/Transition\u0026gt; \u0026lt;/template\u0026gt; \u0026lt;style\u0026gt; .fade-enter-active, .fade-leave-active { transition: opacity 0.3s ease; } .fade-enter-from, .fade-leave-to { opacity: 0; } .success-message { position: fixed; top: 20px; right: 20px; background: #4caf50; color: white; padding: 12px 24px; border-radius: 4px; box-shadow: 0 2px 12px rgba(0, 0, 0, 0.1); } \u0026lt;/style\u0026gt; æ€§èƒ½ä¼˜åŒ–ï¼šæå‡ç”¨æˆ·ä½“éªŒ ä»£ç åˆ†å‰² ä½¿ç”¨åŠ¨æ€å¯¼å…¥å‡å°‘åˆå§‹åŠ è½½æ—¶é—´ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 // å¯¹äºå¤§å‹åº“ï¼Œä½¿ç”¨åŠ¨æ€å¯¼å…¥ const loadLibrary = async () =\u0026gt; { if (!libraryLoaded.value) { const module = await import(\u0026#39;some-heavy-library\u0026#39;) library.value = module.default libraryLoaded.value = true } return library.value } // åœ¨ç»„ä»¶ä¸­ä½¿ç”¨ const handleCompute = async () =\u0026gt; { const lib = await loadLibrary() // ä½¿ç”¨åº“è¿›è¡Œè®¡ç®— } é˜²æŠ–å¤„ç† å¯¹äºè¾“å…¥ç±»å·¥å…·ï¼Œä½¿ç”¨é˜²æŠ–é¿å…é¢‘ç¹è®¡ç®—ï¼š\n1 2 3 4 5 6 7 8 9 10 11 import { debounce } from \u0026#39;lodash-es\u0026#39; const debouncedCalculate = debounce((value) =\u0026gt; { // æ‰§è¡Œè®¡ç®— performCalculation(value) }, 300) // åœ¨æ¨¡æ¿ä¸­ä½¿ç”¨ watch(inputValue, (newValue) =\u0026gt; { debouncedCalculate(newValue) }) å®æˆ˜æ¡ˆä¾‹ï¼šæ„å»ºæŠ•èµ„è®¡ç®—å™¨ è®©æˆ‘ä»¬é€šè¿‡ä¸€ä¸ªå®é™…ä¾‹å­â€”â€”æŠ•èµ„ROIè®¡ç®—å™¨ï¼Œæ¥æ•´åˆä¸Šè¿°æ‰€æœ‰æ¦‚å¿µã€‚\nåŠŸèƒ½è§„åˆ’ æ ¸å¿ƒåŠŸèƒ½\næŠ•èµ„æœ¬é‡‘è¾“å…¥ å¹´åŒ–æ”¶ç›Šç‡è®¾ç½® æŠ•èµ„æœŸé™è®¡ç®— å®æ—¶ç»“æœå±•ç¤º å¢å¼ºåŠŸèƒ½\nå¤åˆ©/å•åˆ©åˆ‡æ¢ å®šæŠ•æ¨¡æ‹Ÿ ç»“æœå›¾è¡¨å±•ç¤º å†å²è®°å½•ä¿å­˜ ç»„ä»¶ç»“æ„ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 174 175 176 177 178 179 180 181 182 183 184 185 186 187 188 189 190 191 192 193 194 195 196 197 198 199 200 201 202 203 204 205 206 207 208 209 210 211 212 213 214 215 216 217 218 219 220 221 222 223 224 225 226 227 228 229 230 231 232 233 234 235 236 237 238 239 240 241 242 243 244 245 246 247 248 249 250 251 252 253 254 255 256 257 258 259 260 261 262 263 264 265 266 267 268 269 270 271 272 273 274 275 276 277 278 279 280 281 282 283 284 285 286 287 288 289 290 \u0026lt;template\u0026gt; \u0026lt;div class=\u0026#34;roi-calculator\u0026#34;\u0026gt; \u0026lt;h1\u0026gt;æŠ•èµ„å›æŠ¥ç‡è®¡ç®—å™¨\u0026lt;/h1\u0026gt; \u0026lt;div class=\u0026#34;calculator-form\u0026#34;\u0026gt; \u0026lt;div class=\u0026#34;form-group\u0026#34;\u0026gt; \u0026lt;label\u0026gt;åˆå§‹æŠ•èµ„é‡‘é¢ï¼ˆå…ƒï¼‰\u0026lt;/label\u0026gt; \u0026lt;input type=\u0026#34;number\u0026#34; v-model.number=\u0026#34;form.principal\u0026#34; @input=\u0026#34;calculate\u0026#34; \u0026gt; \u0026lt;/div\u0026gt; \u0026lt;div class=\u0026#34;form-group\u0026#34;\u0026gt; \u0026lt;label\u0026gt;å¹´åŒ–æ”¶ç›Šç‡ï¼ˆ%ï¼‰\u0026lt;/label\u0026gt; \u0026lt;input type=\u0026#34;number\u0026#34; v-model.number=\u0026#34;form.rate\u0026#34; step=\u0026#34;0.1\u0026#34; @input=\u0026#34;calculate\u0026#34; \u0026gt; \u0026lt;/div\u0026gt; \u0026lt;div class=\u0026#34;form-group\u0026#34;\u0026gt; \u0026lt;label\u0026gt;æŠ•èµ„æœŸé™ï¼ˆå¹´ï¼‰\u0026lt;/label\u0026gt; \u0026lt;input type=\u0026#34;number\u0026#34; v-model.number=\u0026#34;form.years\u0026#34; @input=\u0026#34;calculate\u0026#34; \u0026gt; \u0026lt;/div\u0026gt; \u0026lt;div class=\u0026#34;form-group\u0026#34;\u0026gt; \u0026lt;label\u0026gt;è®¡ç®—æ–¹å¼\u0026lt;/label\u0026gt; \u0026lt;select v-model=\u0026#34;form.method\u0026#34; @change=\u0026#34;calculate\u0026#34;\u0026gt; \u0026lt;option value=\u0026#34;compound\u0026#34;\u0026gt;å¤åˆ©\u0026lt;/option\u0026gt; \u0026lt;option value=\u0026#34;simple\u0026#34;\u0026gt;å•åˆ©\u0026lt;/option\u0026gt; \u0026lt;/select\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;div class=\u0026#34;result-section\u0026#34; v-if=\u0026#34;result.totalAmount \u0026gt; 0\u0026#34;\u0026gt; \u0026lt;h2\u0026gt;è®¡ç®—ç»“æœ\u0026lt;/h2\u0026gt; \u0026lt;div class=\u0026#34;result-grid\u0026#34;\u0026gt; \u0026lt;div class=\u0026#34;result-item\u0026#34;\u0026gt; \u0026lt;span class=\u0026#34;label\u0026#34;\u0026gt;æœ€ç»ˆé‡‘é¢\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026#34;value\u0026#34;\u0026gt;Â¥{{ formatCurrency(result.totalAmount) }}\u0026lt;/span\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;div class=\u0026#34;result-item\u0026#34;\u0026gt; \u0026lt;span class=\u0026#34;label\u0026#34;\u0026gt;æ€»æ”¶ç›Š\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026#34;value profit\u0026#34;\u0026gt;Â¥{{ formatCurrency(result.profit) }}\u0026lt;/span\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;div class=\u0026#34;result-item\u0026#34;\u0026gt; \u0026lt;span class=\u0026#34;label\u0026#34;\u0026gt;æ”¶ç›Šç‡\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026#34;value\u0026#34;\u0026gt;{{ result.profitRate.toFixed(2) }}%\u0026lt;/span\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;div class=\u0026#34;chart-container\u0026#34;\u0026gt; \u0026lt;canvas ref=\u0026#34;chartCanvas\u0026#34;\u0026gt;\u0026lt;/canvas\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/template\u0026gt; \u0026lt;script setup\u0026gt; import { ref, reactive, computed, nextTick, onMounted } from \u0026#39;vue\u0026#39; import { Chart } from \u0026#39;chart.js\u0026#39; // å“åº”å¼æ•°æ® const form = reactive({ principal: 10000, rate: 5, years: 1, method: \u0026#39;compound\u0026#39; }) const result = reactive({ totalAmount: 0, profit: 0, profitRate: 0 }) const chartCanvas = ref(null) let chartInstance = null // è®¡ç®—é€»è¾‘ const calculate = () =\u0026gt; { const { principal, rate, years, method } = form if (!principal || !rate || !years) { resetResult() return } let totalAmount if (method === \u0026#39;compound\u0026#39;) { // å¤åˆ©è®¡ç®— totalAmount = principal * Math.pow(1 + rate / 100, years) } else { // å•åˆ©è®¡ç®— totalAmount = principal * (1 + rate / 100 * years) } const profit = totalAmount - principal const profitRate = (profit / principal) * 100 Object.assign(result, { totalAmount, profit, profitRate }) // æ›´æ–°å›¾è¡¨ updateChart() } const resetResult = () =\u0026gt; { Object.assign(result, { totalAmount: 0, profit: 0, profitRate: 0 }) } // æ ¼å¼åŒ–è´§å¸ const formatCurrency = (value) =\u0026gt; { return new Intl.NumberFormat(\u0026#39;zh-CN\u0026#39;, { minimumFractionDigits: 2, maximumFractionDigits: 2 }).format(value) } // å›¾è¡¨æ›´æ–° const updateChart = async () =\u0026gt; { if (!chartCanvas.value) return await nextTick() const chartData = generateChartData() if (chartInstance) { chartInstance.data = chartData chartInstance.update() } else { chartInstance = new Chart(chartCanvas.value, { type: \u0026#39;line\u0026#39;, data: chartData, options: { responsive: true, plugins: { title: { display: true, text: \u0026#39;æŠ•èµ„å¢é•¿æ›²çº¿\u0026#39; } }, scales: { y: { beginAtZero: true, ticks: { callback: (value) =\u0026gt; \u0026#39;Â¥\u0026#39; + formatCurrency(value) } } } } }) } } // ç”Ÿæˆå›¾è¡¨æ•°æ® const generateChartData = () =\u0026gt; { const years = [] const amounts = [] for (let i = 0; i \u0026lt;= form.years; i++) { years.push(`ç¬¬${i}å¹´`) let amount if (form.method === \u0026#39;compound\u0026#39;) { amount = form.principal * Math.pow(1 + form.rate / 100, i) } else { amount = form.principal * (1 + form.rate / 100 * i) } amounts.push(amount) } return { labels: years, datasets: [{ label: \u0026#39;æŠ•èµ„é‡‘é¢\u0026#39;, data: amounts, borderColor: \u0026#39;rgb(75, 192, 192)\u0026#39;, backgroundColor: \u0026#39;rgba(75, 192, 192, 0.2)\u0026#39;, tension: 0.1 }] } } // ç”Ÿå‘½å‘¨æœŸ onMounted(() =\u0026gt; { calculate() }) \u0026lt;/script\u0026gt; \u0026lt;style scoped\u0026gt; .roi-calculator { max-width: 800px; margin: 0 auto; padding: 20px; } .calculator-form { background: #f5f5f5; padding: 20px; border-radius: 8px; margin-bottom: 30px; } .form-group { margin-bottom: 15px; } .form-group label { display: block; margin-bottom: 5px; font-weight: 500; } .form-group input, .form-group select { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px; font-size: 16px; } .result-section { background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1); } .result-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 30px; } .result-item { text-align: center; padding: 15px; background: #f9f9f9; border-radius: 8px; } .result-item .label { display: block; font-size: 14px; color: #666; margin-bottom: 5px; } .result-item .value { display: block; font-size: 24px; font-weight: bold; color: #333; } .result-item .profit { color: #4caf50; } .chart-container { position: relative; height: 300px; } @media (max-width: 768px) { .result-grid { grid-template-columns: 1fr; } } \u0026lt;/style\u0026gt; éƒ¨ç½²ä¸ä¼˜åŒ– æ„å»ºä¼˜åŒ– åœ¨ nuxt.config.ts ä¸­é…ç½®ä¼˜åŒ–é€‰é¡¹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 export default defineNuxtConfig({ nitro: { minify: true, sourceMap: false }, build: { transpile: [\u0026#39;chart.js\u0026#39;] }, css: [\u0026#39;~/assets/css/main.css\u0026#39;], head: { title: \u0026#39;Utilå·¥å…·ç®± - å®ç”¨å¼€å‘å·¥å…·é›†åˆ\u0026#39;, meta: [ { name: \u0026#39;description\u0026#39;, content: \u0026#39;æä¾›å„ç§å®ç”¨å¼€å‘å·¥å…·ï¼Œæå‡å¼€å‘æ•ˆç‡\u0026#39; }, { name: \u0026#39;keywords\u0026#39;, content: \u0026#39;å¼€å‘å·¥å…·,åœ¨çº¿å·¥å…·,æ•ˆç‡å·¥å…·\u0026#39; } ] } }) SEOä¼˜åŒ– ä¸ºæ¯ä¸ªå·¥å…·é¡µé¢æ·»åŠ åˆé€‚çš„metaä¿¡æ¯ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 \u0026lt;script setup\u0026gt; // è®¾ç½®é¡µé¢metaä¿¡æ¯ useHead({ title: \u0026#39;æŠ•èµ„ROIè®¡ç®—å™¨ - Utilå·¥å…·ç®±\u0026#39;, meta: [ { name: \u0026#39;description\u0026#39;, content: \u0026#39;åœ¨çº¿æŠ•èµ„å›æŠ¥ç‡è®¡ç®—å™¨ï¼Œæ”¯æŒå¤åˆ©å’Œå•åˆ©è®¡ç®—ï¼Œå¸®åŠ©æ‚¨å¿«é€Ÿè¯„ä¼°æŠ•èµ„æ”¶ç›Šã€‚\u0026#39; }, { name: \u0026#39;keywords\u0026#39;, content: \u0026#39;ROIè®¡ç®—å™¨,æŠ•èµ„å›æŠ¥ç‡,å¤åˆ©è®¡ç®—,ç†è´¢å·¥å…·\u0026#39; } ], link: [ { rel: \u0026#39;canonical\u0026#39;, href: \u0026#39;https://util.ink/tools/investment-calculator\u0026#39; } ] }) \u0026lt;/script\u0026gt; æ€»ç»“ æ„å»ºå®ç”¨çš„Webå¼€å‘å·¥å…·éœ€è¦è€ƒè™‘å¤šä¸ªæ–¹é¢ï¼š\néœ€æ±‚é©±åŠ¨ï¼šä»å®é™…ç—›ç‚¹å‡ºå‘ï¼Œè§£å†³çœŸå®é—®é¢˜ æŠ€æœ¯é€‰å‹ï¼šé€‰æ‹©åˆé€‚çš„æŠ€æœ¯æ ˆï¼Œå¹³è¡¡å¼€å‘æ•ˆç‡å’Œæ€§èƒ½ ç”¨æˆ·ä½“éªŒï¼šæ³¨é‡UI/UXè®¾è®¡ï¼Œæä¾›æµç•…çš„äº¤äº’ä½“éªŒ æ€§èƒ½ä¼˜åŒ–ï¼šé€šè¿‡ä»£ç åˆ†å‰²ã€é˜²æŠ–ç­‰æ‰‹æ®µæå‡æ€§èƒ½ SEOå‹å¥½ï¼šè‰¯å¥½çš„SEOè®¾ç½®è®©å·¥å…·æ›´å®¹æ˜“è¢«å‘ç° è®°ä½ï¼Œæœ€å¥½çš„å·¥å…·å¾€å¾€æ˜¯é‚£äº›ç®€å•ç›´æ¥ã€æ˜“äºä½¿ç”¨çš„äº§å“ã€‚åœ¨å¼€å‘è¿‡ç¨‹ä¸­ï¼Œå§‹ç»ˆä¿æŒç”¨æˆ·éœ€æ±‚ä¸ºä¸­å¿ƒï¼Œä¸æ–­è¿­ä»£ä¼˜åŒ–ï¼Œæ‰èƒ½æ‰“é€ å‡ºçœŸæ­£æœ‰ä»·å€¼çš„å¼€å‘å·¥å…·ã€‚\nå¸Œæœ›æœ¬æ–‡çš„åˆ†äº«å¯¹å¤§å®¶æœ‰æ‰€å¸®åŠ©ï¼å¦‚æœæ‚¨æœ‰ä»»ä½•æƒ³æ³•æˆ–å»ºè®®ï¼Œæ¬¢è¿åœ¨è¯„è®ºåŒºç•™è¨€äº¤æµã€‚\nç›¸å…³èµ„æºï¼š\nVue 3 å®˜æ–¹æ–‡æ¡£ Nuxt.js å¼€å‘æŒ‡å— Chart.js å›¾è¡¨åº“ Utilå·¥å…·ç®± - æŸ¥çœ‹å®Œæ•´å·¥å…·é›†åˆ ","permalink":"/blog/articles/building-practical-web-dev-tools-guide/","summary":"æ¢è®¨å¦‚ä½•ä»å®é™…éœ€æ±‚å‡ºå‘ï¼Œä¸€æ­¥æ­¥æ„å»ºå®ç”¨çš„Webå¼€å‘å·¥å…·ï¼Œæ¶µç›–è®¾è®¡æ€è·¯ã€æŠ€æœ¯é€‰å‹å’Œæœ€ä½³å®è·µã€‚","title":"æ„å»ºå®ç”¨å‹Webå¼€å‘å·¥å…·ï¼šä»éœ€æ±‚åˆ°å®ç°çš„å®Œæ•´æŒ‡å—"},{"content":"å¼•è¨€ ç‹¬ç«‹æ¸¸æˆå¼€å‘æ—¢æ˜¯æŒ‘æˆ˜ä¹Ÿæ˜¯æœºé‡ã€‚åœ¨2024å¹´ï¼Œå…¨çƒç‹¬ç«‹æ¸¸æˆå¸‚åœºè§„æ¨¡è¾¾åˆ°50äº¿ç¾å…ƒï¼Œè¶Šæ¥è¶Šå¤šçš„å¼€å‘è€…é€‰æ‹©èµ°ä¸Šç‹¬ç«‹å¼€å‘ä¹‹è·¯ã€‚ä½†æˆåŠŸçš„ç‹¬ç«‹æ¸¸æˆä¸ä»…éœ€è¦ä¼˜ç§€çš„åˆ›æ„å’ŒæŠ€æœ¯ï¼Œè¿˜éœ€è¦æ­£ç¡®çš„å•†ä¸šæ€ç»´å’Œå‘è¡Œç­–ç•¥ã€‚æœ¬æ–‡å°†ä¸ºç‹¬ç«‹æ¸¸æˆå¼€å‘è€…æä¾›ä»0åˆ°1çš„å®Œæ•´æŒ‡å—ã€‚\næ¸¸æˆåˆ›æ„ä¸ç­–åˆ’ åˆ›æ„æ¥æºä¸éªŒè¯ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 // åˆ›æ„è¯„ä¼°ç³»ç»Ÿ class GameConceptEvaluator { constructor() { this.evaluationCriteria = { innovation: { weight: 0.3, description: \u0026#39;åˆ›æ„åˆ›æ–°æ€§\u0026#39;, indicators: [\u0026#39;ç‹¬ç‰¹æ€§\u0026#39;, \u0026#39;åŸåˆ›æ€§\u0026#39;, \u0026#39;å·®å¼‚åŒ–\u0026#39;] }, feasibility: { weight: 0.25, description: \u0026#39;æŠ€æœ¯å¯è¡Œæ€§\u0026#39;, indicators: [\u0026#39;æŠ€æœ¯å¤æ‚åº¦\u0026#39;, \u0026#39;å¼€å‘å‘¨æœŸ\u0026#39;, \u0026#39;å›¢é˜Ÿèƒ½åŠ›\u0026#39;] }, market: { target: 0.25, description: \u0026#39;å¸‚åœºæ½œåŠ›\u0026#39;, indicators: [\u0026#39;å¸‚åœºå®¹é‡\u0026#39;, \u0026#39;ç”¨æˆ·éœ€æ±‚\u0026#39;, \u0026#39;ç«äº‰ç¨‹åº¦\u0026#39;] }, passion: { weight: 0.2, description: \u0026#39;å¼€å‘çƒ­æƒ…\u0026#39;, indicators: [\u0026#39;å›¢é˜Ÿå…´è¶£\u0026#39;, \u0026#39;é¡¹ç›®æ„¿æ™¯\u0026#39;, \u0026#39;åšæŒèƒ½åŠ›\u0026#39;] } }; this.scoreThreshold = { minimum: 3.5, recommended: 4.0 }; } // è¯„ä¼°æ¸¸æˆåˆ›æ„ evaluateGameConcept(gameConcept) { const evaluation = { innovation: this.evaluateInnovation(gameConcept), feasibility: this.evaluateFeasibility(gameConcept), market: this.evaluateMarket(gameConcept), passion: this.evaluatePassion(gameConcept) }; const totalScore = this.calculateTotalScore(evaluation); const recommendation = this.generateRecommendation(totalScore, evaluation); return { score: totalScore, evaluation, recommendation, risks: this.identifyRisks(evaluation), opportunities: this.identifyOpportunities(evaluation) }; } // åˆ›æ–°æ€§è¯„ä¼° evaluateInnovation(concept) { const innovationFactors = { uniqueness: this.checkUniqueness(concept), originality: this.checkOriginality(concept), differentiation: this.checkDifferentiation(concept), gameplayInnovation: this.checkGameplayInnovation(concept) }; return { score: this.scoreInnovation(innovationFactors), details: innovationFactors, strengths: innovationFactors.filter(f =\u0026gt; f.score \u0026gt;= 0.8), weaknesses: innovationFactors.filter(f =\u0026gt; f.score \u0026lt; 0.6) }; } // å¯è¡Œæ€§è¯„ä¼° evaluateFeasibility(concept) { const feasibilityFactors = { technicalComplexity: this.estimateTechnicalComplexity(concept), developmentTime: this.estimateDevelopmentTime(concept), teamSkills: this.assessTeamSkills(concept), resourceRequirements: this.assessResourceRequirements(concept), riskLevel: this.assessRiskLevel(concept) }; return { score: this.scoreFeasibility(feasibilityFactors), details: feasibilityFactors, budgetEstimate: this.estimateBudget(feasibilityFactors), timeline: this.createTimeline(feasibilityFactors) }; } // å¸‚åœºåˆ†æ evaluateMarket(concept) { return new Promise(async (resolve) =\u0026gt; { const marketData = await this.fetchMarketData(concept); const analysis = { marketSize: marketData.marketSize, growthRate: marketData.growthRate, competition: marketData.competition, targetAudience: marketData.targetAudience, trends: marketData.trends, barriers: marketData.barriers }; resolve({ score: this.scoreMarket(analysis), details: analysis, marketFit: this.assessMarketFit(concept, analysis), positioning: this.recommendPositioning(concept, analysis) }); }); } // åˆ›æ„éªŒè¯æµ‹è¯• validateConcept(concept) { return { prototypeRequirements: this.generatePrototypeRequirements(concept), testPlan: this.createTestPlan(concept), successMetrics: this.defineSuccessMetrics(concept), minimumMVP: this.defineMinimumMVP(concept) }; } } æ¸¸æˆè®¾è®¡æ–‡æ¡£ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 174 175 176 177 178 179 180 181 182 183 184 185 186 187 188 189 190 191 192 193 194 195 196 197 198 // æ¸¸æˆè®¾è®¡æ–‡æ¡£æ¨¡æ¿ class GameDesignDocument { constructor() { this.sections = { overview: { gameTitle: \u0026#39;\u0026#39;, highConcept: \u0026#39;\u0026#39;, targetAudience: \u0026#39;\u0026#39;, platform: \u0026#39;\u0026#39;, genre: \u0026#39;\u0026#39;, artStyle: \u0026#39;\u0026#39; }, coreMechanics: { gameplay: { mainLoop: \u0026#39;\u0026#39;, playerActions: [], gameRules: [], progression: \u0026#39;\u0026#39;, balance: \u0026#39;\u0026#39; }, uniqueFeatures: [], innovationPoints: [] }, storyAndWorld: { narrative: { storySummary: \u0026#39;\u0026#39;, mainCharacters: [], plotOutline: [], worldBuilding: \u0026#39;\u0026#39; }, lore: { background: \u0026#39;\u0026#39;, history: \u0026#39;\u0026#39;, culture: \u0026#39;\u0026#39; } }, artAndSound: { visualStyle: { artDirection: \u0026#39;\u0026#39;, colorPalette: [], characterDesign: \u0026#39;\u0026#39;, environmentDesign: \u0026#39;\u0026#39; }, audioDesign: { music: \u0026#39;\u0026#39;, soundEffects: \u0026#39;\u0026#39;, voiceOver: \u0026#39;\u0026#39; } }, technicalSpecs: { engine: { primary: \u0026#39;\u0026#39;, reasons: \u0026#39;\u0026#39;, alternatives: [] }, platforms: [], requirements: { performance: \u0026#39;\u0026#39;, storage: \u0026#39;\u0026#39;, connectivity: \u0026#39;\u0026#39; } }, monetization: { primary: [], secondary: [], pricePoint: 0, rationale: \u0026#39;\u0026#39;, projections: [] }, schedule: { phases: [], milestones: [], deliverables: [], timeline: \u0026#39;\u0026#39; }, team: { coreMembers: [], roles: [], skills: [], recruitmentPlan: [] } }; } // åˆ›å»ºæ¸¸æˆè®¾è®¡æ–‡æ¡£ createDocument(gameData) { return { ...this.sections, // åŸºç¡€ä¿¡æ¯ overview: { gameTitle: gameData.title, highConcept: gameData.concept, targetAudience: gameData.audience, platform: gameData.platforms.join(\u0026#39;, \u0026#39;), genre: gameData.genre, artStyle: gameData.artStyle }, // æ ¸å¿ƒæœºåˆ¶ coreMechanics: { gameplay: { mainLoop: gameData.gameplay.mainLoop, playerActions: gameData.gameplay.actions, gameRules: gameData.gameplay.rules, progression: gameData.gameplay.progression, balance: gameData.gameplay.balance }, uniqueFeatures: gameData.uniqueFeatures || [], innovationPoints: gameData.innovationPoints || [] }, // æ•…äº‹ä¸–ç•Œè§‚ storyAndWorld: { narrative: gameData.story || {}, lore: gameData.lore || {} }, // ç¾æœ¯å’ŒéŸ³æ•ˆ artAndSound: { visualStyle: gameData.art || {}, audioDesign: gameData.audio || {} }, // æŠ€æœ¯è§„æ ¼ technicalSpecs: { engine: this.selectEngine(gameData), platforms: gameData.platforms || [], requirements: gameData.requirements || {} }, // å•†ä¸šæ¨¡å¼ monetization: { primary: gameData.monetization?.primary || [], secondary: gameData.monetization?.secondary || [], pricePoint: gameData.monetization?.price || 0, rationale: gameData.monetization?.rationale || \u0026#39;\u0026#39;, projections: gameData.monetization?.projections || [] }, // é¡¹ç›®è®¡åˆ’ schedule: this.createSchedule(gameData), // å›¢é˜Ÿ team: { coreMembers: gameData.team || [], roles: gameData.roles || [], skills: gameData.skills || [], recruitmentPlan: gameData.recruitment || [] } }; } // é€‰æ‹©æ¸¸æˆå¼•æ“ selectEngine(gameData) { const engineOptions = { unity: { name: \u0026#39;Unity\u0026#39;, strengths: [\u0026#39;è·¨å¹³å°\u0026#39;, \u0026#39;èµ„æºä¸°å¯Œ\u0026#39;, \u0026#39;ç¤¾åŒºæ´»è·ƒ\u0026#39;, \u0026#39;å­¦ä¹ æˆæœ¬ä½\u0026#39;], weaknesses: [\u0026#39;éœ€è¦ä¼˜åŒ–\u0026#39;, \u0026#39;å†…å­˜å ç”¨å¤§\u0026#39;], bestFor: [\u0026#39;ç‹¬ç«‹æ¸¸æˆ\u0026#39;, \u0026#39;å¿«é€ŸåŸå‹\u0026#39;, \u0026#39;2Dæ¸¸æˆ\u0026#39;, \u0026#39;ç§»åŠ¨æ¸¸æˆ\u0026#39;] }, unreal: { name: \u0026#39;Unreal Engine\u0026#39;, strengths: [\u0026#39;ç”»é¢ç²¾ç¾\u0026#39;, \u0026#39;Blueprintå¯è§†åŒ–ç¼–ç¨‹\u0026#39;, \u0026#39;AAAçº§æ”¯æŒ\u0026#39;], weaknesses: [\u0026#39;å­¦ä¹ æ›²çº¿é™¡\u0026#39;, \u0026#39;å¼€å‘å‘¨æœŸé•¿\u0026#39;], bestFor: [\u0026#39;3Dæ¸¸æˆ\u0026#39;, \u0026#39;è§†è§‰éœ‡æ’¼\u0026#39;, \u0026#39;å¤§å‹é¡¹ç›®\u0026#39;] }, godot: { name: \u0026#39;Godot\u0026#39;, strengths: [\u0026#39;å¼€æºå…è´¹\u0026#39;, \u0026#39;è½»é‡çº§\u0026#39;, \u0026#39;2Då‹å¥½\u0026#39;, \u0026#39;ç¤¾åŒºæ´»è·ƒ\u0026#39;], weaknesses: [\u0026#39;3DåŠŸèƒ½æœ‰é™\u0026#39;, \u0026#39;å•†ä¸šåŒ–ç¨‹åº¦ä½\u0026#39;], bestFor: [\u0026#39;2Dæ¸¸æˆ\u0026#39;, \u0026#39;å°å›¢é˜Ÿ\u0026#39;, \u0026#39;æˆæœ¬æ•æ„Ÿé¡¹ç›®\u0026#39;] }, custom: { name: \u0026#39;è‡ªç ”å¼•æ“\u0026#39;, \u0026#39;strengths\u0026#39;: [\u0026#39;å®Œå…¨æ§åˆ¶\u0026#39;, \u0026#39;é’ˆå¯¹æ€§ä¼˜åŒ–\u0026#39;], \u0026#39;weaknesses\u0026#39;: [\u0026#39;å¼€å‘æˆæœ¬é«˜\u0026#39;, \u0026#39;æŠ€æœ¯é£é™©å¤§\u0026#39;], \u0026#39;bestFor\u0026#39;: [\u0026#39;ç‰¹æ®Šéœ€æ±‚\u0026#39;, \u0026#39;æŠ€æœ¯å›¢é˜Ÿå¼ºå¤§\u0026#39;] } }; const recommended = this.recommendEngine(engineOptions, gameData); return { primary: recommended, alternatives: engineOptions.filter(e =\u0026gt; e.name !== recommended.name), rationale: this.getEngineRationale(recommended, gameData) }; } } æŠ€æœ¯å®ç°ç­–ç•¥ å¼•æ“é€‰æ‹©ä¸ä¼˜åŒ– 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 174 175 176 177 178 179 180 181 182 183 184 185 186 // æ¸¸æˆå¼•æ“ä¼˜åŒ–å™¨ class GameEngineOptimizer { constructor() { this.optimizations = { unity: { rendering: { \u0026#39;çƒ˜ç„™å…‰ç…§\u0026#39;: \u0026#39;é¢„è®¡ç®—é™æ€å…‰ç…§\u0026#39;, \u0026#39;é®æŒ¡å‰”é™¤\u0026#39;: \u0026#39;å‡å°‘æ¸²æŸ“è´Ÿè½½\u0026#39;, \u0026#39;LODç³»ç»Ÿ\u0026#39;: \u0026#39;ç»†èŠ‚å±‚æ¬¡ä¼˜åŒ–\u0026#39;, \u0026#39;å¯¹è±¡æ± \u0026#39;: \u0026#39;é¿å…é¢‘ç¹åˆ›å»ºé”€æ¯\u0026#39; }, performance: { \u0026#39;å¼‚æ­¥åŠ è½½\u0026#39;: \u0026#39;é¿å…ä¸»çº¿ç¨‹é˜»å¡\u0026#39;, \u0026#39;èµ„æºå‹ç¼©\u0026#39;: \u0026#39;å‡å°åŒ…ä½“ç§¯\u0026#39;, \u0026#39;å†…å­˜ç®¡ç†\u0026#39;: \u0026#39;åŠæ—¶é‡Šæ”¾èµ„æº\u0026#39;, \u0026#39;çƒ­æ›´æ–°\u0026#39;: \u0026#39;å®ç°æ— ç¼æ›´æ–°\u0026#39; }, profiling: { \u0026#39;Unity Profiler\u0026#39;: \u0026#39;æ€§èƒ½åˆ†æ\u0026#39;, \u0026#39;Memory Profiler\u0026#39;: \u0026#39;å†…å­˜ç›‘æ§\u0026#39;, \u0026#39;Frame Debugger\u0026#39;: \u0026#39;å¸§ç‡æ£€æŸ¥\u0026#39;, \u0026#39;Shader Optimizer\u0026#39;: \u0026#39;ç€è‰²å™¨ä¼˜åŒ–\u0026#39; } }, unreal: { rendering: { \u0026#39;Nanite\u0026#39;: \u0026#39;è™šæ‹Ÿå‡ ä½•ä½“\u0026#39;, \u0026#39;Level Streaming\u0026#39;: \u0026#39;åœºæ™¯æµå¼åŠ è½½\u0026#39;, \u0026#39;Screen Space Reflections\u0026#39;: \u0026#39;å®æ—¶åå°„\u0026#39;, \u0026#39;Distance Field Shadows\u0026#39;: \u0026#39;é«˜è´¨é‡é˜´å½±\u0026#39; }, performance: { \u0026#39;Blueprint C++\u0026#39;: \u0026#39;æ€§èƒ½å…³é”®ä»£ç \u0026#39;, \u0026#39;Asset Compression\u0026#39;: \u0026#39;èµ„æºå‹ç¼©\u0026#39;, \u0026#39;Cooking\u0026#39;: \u0026#39;é¢„è®¡ç®—è¿‡ç¨‹\u0026#39;, \u0026#39;Texture Streaming\u0026#39;: \u0026#39;çº¹ç†æµå¼åŠ è½½\u0026#39; }, profiling: { \u0026#39;Session Frontend\u0026#39;: \u0026#39;å®æ—¶åˆ†æ\u0026#39;, \u0026#39;Gameplay Insights\u0026#39;: \u0026#39;æ¸¸æˆåˆ†æ\u0026#39;, \u0026#39;Stats Viewer\u0026#39;: \u0026#39;ç»Ÿè®¡æŸ¥çœ‹å™¨\u0026#39;, \u0026#39;GPU Visualizer\u0026#39;: \u0026#39;GPUå¯è§†åŒ–\u0026#39; } } }; } // Unityä¼˜åŒ–å®ç° implementUnityOptimizations(project) { return { // æ¸²æŸ“ä¼˜åŒ– rendering: { lighting: { settings: { realtimeLighting: { maxRealtimeLights: 8, optimizeShadow: \u0026#39;auto\u0026#39; }, bakedLighting: { bakeQuality: \u0026#39;high\u0026#39;, compressionLevel: \u0026#39;medium\u0026#39; }, reflections: { reflectionProbes: 128, reflectionCacheSize: 128 } } }, lod: { lodSettings: { enabled: true, distances: [10, 25, 50, 100], patchGridSize: 32 } } }, // æ€§èƒ½ä¼˜åŒ– performance: { objectPooling: { poolTypes: [\u0026#39;bullets\u0026#39;, \u0026#39;enemies\u0026#39;, \u0026#39;effects\u0026#39;], initialSize: 100, maxSize: 1000 }, asyncLoading: { sceneLoading: \u0026#39;UnityWebRequest\u0026#39;, resourceLoading: \u0026#39;Addressables\u0026#39;, assetBundles: \u0026#39;AssetBundleManager\u0026#39; }, memory: { pooling: true, garbageCollection: \u0026#39;Incremental\u0026#39;, textureCompression: \u0026#39;ASTC\u0026#39; } }, // ä»£ç ä¼˜åŒ– code: { patterns: [\u0026#39;ObjectPool\u0026#39;, \u0026#39;Singleton\u0026#39;, \u0026#39;State Machine\u0026#39;], optimization: { burstMode: false, multithreading: \u0026#39;Unity Job System\u0026#39;, profiling: \u0026#39;Enable Profiler\u0026#39; } } }; } // Unrealä¼˜åŒ–å®ç° implementUnrealOptimizations(project) { return { // æ¸²æŸ“ä¼˜åŒ– rendering: { settings: { forward: { shadingModel: \u0026#39;Mobile\u0026#39;, shadingQuality: 2, maxDrawDistance: 200 }, global: { rhi: \u0026#39;Mobile\u0026#39;, lumen: \u0026#39;Level_2\u0026#39;, shadowQuality: 2 } } }, // æ€§èƒ½ä¼˜åŒ– performance: { assets: { compression: [ \u0026#39;texture: ASTC\u0026#39;, \u0026#39;audio: OGG\u0026#39;, \u0026#39;mesh: \u0026#39;custom\u0026#39; ] }, streaming: { worldPartitioning: \u0026#39;grid_2x2\u0026#39;, levelStreaming: true, textureStreaming: true } }, // ä»£ç ä¼˜åŒ– code: { blueprints: { criticalCode: \u0026#39;C++\u0026#39;, complexity: \u0026#39;simple\u0026#39;, classStructure: \u0026#39;flat\u0026#39; } } }; } // æ€§èƒ½ç›‘æ§å·¥å…· setupPerformanceMonitoring() { return { realTime: { fps: \u0026#39;å®æ—¶å¸§ç‡ç›‘æ§\u0026#39;, memory: \u0026#39;å†…å­˜ä½¿ç”¨ç›‘æ§\u0026#39;, cpu: \u0026#39;CPUä½¿ç”¨ç‡ç›‘æ§\u0026#39;, network: \u0026#39;ç½‘ç»œå»¶è¿Ÿç›‘æ§\u0026#39; }, periodic: { profiling: \u0026#39;å®šæœŸæ€§èƒ½åˆ†æ\u0026#39;, leakDetection: \u0026#39;å†…å­˜æ³„æ¼æ£€æµ‹\u0026#39;, optimizationSuggestions: \u0026#39;ä¼˜åŒ–å»ºè®®ç”Ÿæˆ\u0026#39; }, alerts: { thresholds: { fps: 30, memory: \u0026#39;80%\u0026#39;, cpu: \u0026#39;90%\u0026#39;, network: \u0026#39;300ms\u0026#39; } } }; } } å¼€å‘å·¥å…·é“¾æ­å»º 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 // å¼€å‘å·¥å…·é“¾é…ç½® class DevToolchain { constructor() { this.tools = { versionControl: \u0026#39;Git\u0026#39;, projectManagement: \u0026#39;Jira\u0026#39;, collaboration: \u0026#39;Slack\u0026#39;, communication: \u0026#39;Discord\u0026#39;, documentation: \u0026#39;Confluence\u0026#39;, ci: \u0026#39;GitHub Actions\u0026#39;, build: \u0026#39;Unity Cloud Build/Unreal Cloud Build\u0026#39;, distribution: \u0026#39;SteamDirect/App Store Connect\u0026#39;, analytics: \u0026#39;Firebase/Game Analytics\u0026#39; } }; this.automations = { build: \u0026#39;è‡ªåŠ¨åŒ–æ„å»º\u0026#39;, testing: \u0026#39;è‡ªåŠ¨åŒ–æµ‹è¯•\u0026#39;, deployment: \u0026#39;è‡ªåŠ¨åŒ–éƒ¨ç½²\u0026#39;, backup: \u0026#39;è‡ªåŠ¨åŒ–å¤‡ä»½\u0026#39;, monitoring: \u0026#39;è‡ªåŠ¨åŒ–ç›‘æ§\u0026#39; }; } // é…ç½®CI/CDæµæ°´çº¿ setupCICD(projectType, platform) { const ciConfig = { triggers: [ \u0026#39;ä»£ç æäº¤\u0026#39;, \u0026#39;PRåˆ›å»º\u0026#39;, \u0026#39;å®šæ—¶æ‰§è¡Œ\u0026#39;, \u0026#39;æ‰‹åŠ¨è§¦å‘\u0026#39; ], stages: { checkout: \u0026#39;æ£€å‡ºä»£ç \u0026#39;, \u0026#39;build\u0026#39;: \u0026#39;æ„å»ºé¡¹ç›®\u0026#39;, \u0026#39;test\u0026#39;: \u0026#39;è¿è¡Œæµ‹è¯•\u0026#39;, \u0026#39;package\u0026#39;: \u0026#39;æ‰“åŒ…åº”ç”¨\u0026#39;, \u0026#39;deploy\u0026#39;: \u0026#39;å‘å¸ƒåˆ°å¹³å°\u0026#39;, \u0026#39;notify\u0026#39;: \u0026#39;é€šçŸ¥ç»“æœ\u0026#39; }, platforms: { unity: { build: \u0026#39;Unity Cloud Build\u0026#39;, platforms: [\u0026#39;Windows\u0026#39;, \u0026#39;macOS\u0026#39;, \u0026#39;iOS\u0026#39;, \u0026#39;Android\u0026#39;], output: \u0026#39;å¤šç§å¹³å°åŒ…\u0026#39; }, unreal: { build: \u0026#39;Unreal Cloud Build\u0026#39;, platforms: [\u0026#39;Windows\u0026#39;, \u0026#39;macOS\u0026#39;, \u0026#39;Linux\u0026#39;], output: \u0026#39;å¯æ‰§è¡Œæ–‡ä»¶\u0026#39; } } }; return { yamlConfig: this.generateYAMLConfig(ciConfig, projectType, platform), githubActions: this.setupGitHubActions(ciConfig), monitoring: this.setupCIMonitoring() }; } // ç‰ˆæœ¬æ§åˆ¶ç­–ç•¥ setupVersionControl() { return { strategy: { branching: { main: \u0026#39;mainåˆ†æ”¯\u0026#39;, develop: \u0026#39;developåˆ†æ”¯\u0026#39;, feature: \u0026#39;åŠŸèƒ½åˆ†æ”¯\u0026#39;, hotfix: \u0026#39;ä¿®å¤åˆ†æ”¯\u0026#39; }, commits: { naming: \u0026#39;åŠŸèƒ½æè¿°æ€§å‘½å\u0026#39;, formatting: \u0026#39;è§„èŒƒæ ¼å¼åŒ–\u0026#39;, size: \u0026#39;å•æ¬¡æäº¤å¤§å°æ§åˆ¶\u0026#39; }, tagging: { pattern: \u0026#39;vX.Y.Z\u0026#39;, taggingStrategy: \u0026#39;è‡ªåŠ¨æ ‡è®°\u0026#39;, releaseNotes: \u0026#39;è‡ªåŠ¨åŒ–ç”Ÿæˆ\u0026#39; } }, workflows: { featureBranch: { steps: [ \u0026#39;åˆ›å»ºåŠŸèƒ½åˆ†æ”¯\u0026#39;, \u0026#39;å¼€å‘åŠŸèƒ½\u0026#39;, \u0026#39;æäº¤PR\u0026#39;, \u0026#39;ä»£ç å®¡æŸ¥\u0026#39;, \u0026#39;åˆå¹¶åˆ°develop\u0026#39;, \u0026#39;åˆ é™¤åˆ†æ”¯\u0026#39; ] }, release: { steps: [ \u0026#39;å‡†å¤‡å‘å¸ƒ\u0026#39;, \u0026#39;åˆ›å»ºå‘å¸ƒåˆ†æ”¯\u0026#39;, \u0026#39;æœ€ç»ˆæµ‹è¯•\u0026#39;, \u0026#39;ç‰ˆæœ¬å·æ›´æ–°\u0026#39;, \u0026#39;å‘å¸ƒåˆ°å¹³å°\u0026#39;, \u0026#39;åˆ›å»ºæ ‡ç­¾\u0026#39; ] } } }; } } å›¢é˜Ÿç®¡ç†ä¸åä½œ å›¢é˜Ÿç»“æ„è®¾è®¡ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 174 175 176 177 178 179 180 181 182 183 184 185 186 187 188 189 190 191 192 193 194 195 196 197 198 199 200 201 202 203 204 205 // å›¢é˜Ÿç»“æ„ç®¡ç† class TeamStructureManager { constructor() { this.teamRoles = { leadership: { producer: { title: \u0026#39;åˆ¶ä½œäºº\u0026#39;, responsibilities: [ \u0026#39;é¡¹ç›®æ•´ä½“æŠŠæ§\u0026#39;, \u0026#39;å›¢é˜Ÿåè°ƒç®¡ç†\u0026#39;, \u0026#39;é¢„ç®—ç®¡ç†\u0026#39;, \u0026#39;å‘è¡Œç­–ç•¥\u0026#39;, \u0026#39;å•†åŠ¡åˆä½œ\u0026#39; ], skills: [\u0026#39;é¡¹ç›®ç®¡ç†\u0026#39;, \u0026#39;æ²Ÿé€šåè°ƒ\u0026#39;, \u0026#39;å•†ä¸šæ´å¯Ÿ\u0026#39;] }, director: { title: \u0026#39;æ€»ç›‘\u0026#39;, responsibilities: [ \u0026#39;åˆ›æ„æ–¹å‘æŠŠæ§\u0026#39;, \u0026#39;å›¢é˜ŸæŒ‡å¯¼\u0026#39;, \u0026#39;è´¨é‡ç®¡ç†\u0026#39;, \u0026#39;å†³ç­–åˆ¶å®š\u0026#39; ], skills: [\u0026#39;åˆ›æ„ç­–åˆ’\u0026#39;, \u0026#39;å›¢é˜Ÿç®¡ç†\u0026#39;, \u0026#39;è´¨é‡æ§åˆ¶\u0026#39;] } }, production: { designer: { title: \u0026#39;ç¾æœ¯è®¾è®¡å¸ˆ\u0026#39;, responsibilities: [ \u0026#39;è§†è§‰è®¾è®¡\u0026#39;, \u0026#39;UI/UXè®¾è®¡\u0026#39;, \u0026#39;ç¾æœ¯èµ„æºåˆ›å»º\u0026#39;, \u0026#39;è§†è§‰ä¸€è‡´æ€§ç»´æŠ¤\u0026#39; ], specializations: [\u0026#39;2Dç¾æœ¯\u0026#39;, \u0026#39;3Dç¾æœ¯\u0026#39;, \u0026#39;UI/UX\u0026#39;, \u0026#39;åŠ¨ç”»\u0026#39;, \u0026#39;ç‰¹æ•ˆ\u0026#39;] }, programmer: { title: \u0026#39;ç¨‹åºå‘˜\u0026#39;, responsibilities: [ \u0026#39;ä»£ç ç¼–å†™\u0026#39;, \u0026#39;åŠŸèƒ½å®ç°\u0026#39;, \u0026#39;æŠ€æœ¯æ¶æ„è®¾è®¡\u0026#39;, \u0026#39;æ€§èƒ½ä¼˜åŒ–\u0026#39; ], specializations: [\u0026#39;å‰ç«¯å¼€å‘\u0026#39;, \u0026#39;åç«¯å¼€å‘\u0026#39;, \u0026#39;AI\u0026#39;, \u0026#39;ç‰©ç†å¼•æ“\u0026#39;, \u0026#39;ç½‘ç»œ\u0026#39;] } }, support: { qa: { title: \u0026#39;è´¨é‡ä¿è¯\u0026#39;, \u0026#39;responsibilities\u0026#39;: [ \u0026#39;æµ‹è¯•ç”¨ä¾‹ç¼–å†™\u0026#39;, \u0026#39;æ‰§è¡Œæµ‹è¯•\u0026#39;, \u0026#39;ç¼ºé™·æŠ¥å‘Š\u0026#39;, \u0026#39;è´¨é‡ç›‘æ§\u0026#39; ], skills: [\u0026#39;æµ‹è¯•è®¾è®¡\u0026#39;, \u0026#39;è‡ªåŠ¨åŒ–æµ‹è¯•\u0026#39;, \u0026#39;ç¼ºé™·ç®¡ç†\u0026#39;] }, devops: { title: \u0026#39;å¼€å‘è¿ç»´\u0026#39;, \u0026#39;responsibilities\u0026#39;: [ \u0026#39;å¼€å‘ç¯å¢ƒç»´æŠ¤\u0026#39;, \u0026#39;æ„å»ºç³»ç»Ÿé…ç½®\u0026#39;, \u0026#39;è‡ªåŠ¨åŒ–æµç¨‹\u0026#39;, \u0026#39;å‘å¸ƒéƒ¨ç½²\u0026#39; ], skills: [\u0026#39;CI/CD\u0026#39;, \u0026#39;äº‘æœåŠ¡\u0026#39;, \u0026#39;è‡ªåŠ¨åŒ–\u0026#39;, \u0026#39;ç›‘æ§\u0026#39;] } } }; } // è§’è‰²èŒè´£å®šä¹‰ defineRoleExpectations() { return { producer: { essential: \u0026#39;é¡¹ç›®ç®¡ç†å’Œå†³ç­–\u0026#39;, expectations: [ \u0026#39;å…·æœ‰é¡¹ç›®ç®¡ç†ç»éªŒ\u0026#39;, \u0026#39;è‰¯å¥½çš„æ²Ÿé€šåè°ƒèƒ½åŠ›\u0026#39;, \u0026#39;å•†ä¸šæ„è¯†å¼º\u0026#39;, \u0026#39;èƒ½å¤Ÿæ‰¿å—å‹åŠ›\u0026#39;, \u0026#39;é¢„ç®—ç®¡ç†èƒ½åŠ›\u0026#39; ] }, designer: { essential: \u0026#39;ç¾æœ¯åˆ›ä½œèƒ½åŠ›\u0026#39;, expectations: [ \u0026#39;æ‰å®çš„ç¾æœ¯åŸºç¡€\u0026#39;, \u0026#39;ç†Ÿç»ƒä½¿ç”¨è®¾è®¡å·¥å…·\u0026#39;, \u0026#39;åˆ›æ„æ€ç»´æ´»è·ƒ\u0026#39;, \u0026#39;å›¢é˜Ÿåä½œè‰¯å¥½\u0026#39;, \u0026#39;æ—¶é—´ç®¡ç†èƒ½åŠ›å¼º\u0026#39; ] }, programmer: { essential: \u0026#39;ç¨‹åºå¼€å‘èƒ½åŠ›\u0026#39;, expectations: [ \u0026#39;ç†Ÿç»ƒæŒæ¡å¼€å‘è¯­è¨€\u0026#39;, \u0026#39;ç†è§£æ¸¸æˆå¼€å‘æµç¨‹\u0026#39;, \u0026#39;è§£å†³é—®é¢˜èƒ½åŠ›å¼º\u0026#39;, \u0026#39;ä»£ç è´¨é‡è‰¯å¥½\u0026#39;, \u0026#39;æŒç»­å­¦ä¹ èƒ½åŠ›\u0026#39; ] } }; } // å›¢é˜Ÿæ‹›è˜ç­–ç•¥ createRecruitmentPlan(teamNeeds) { return { hiringTimeline: this.calculateHiringTimeline(teamNeeds), recruitmentChannels: { \u0026#39;online\u0026#39;: [ \u0026#39;æ¸¸æˆå¼€å‘ç¤¾åŒº\u0026#39;, \u0026#39;ä¸“ä¸šæ‹›è˜ç½‘ç«™\u0026#39;, \u0026#39;ç¤¾äº¤åª’ä½“\u0026#39;, \u0026#39;å¼€å‘è€…è®ºå›\u0026#39; ], \u0026#39;offline\u0026#39;: [ \u0026#39;æ¸¸æˆå±•ä¼š\u0026#39;, \u0026#39;æŠ€æœ¯ä¼šè®®\u0026#39;, \u0026#39;è¡Œä¸šæ´»åŠ¨\u0026#39;, \u0026#39;æ ¡å›­æ‹›è˜\u0026#39; ], \u0026#39;referral\u0026#39;: [ \u0026#39;å†…éƒ¨æ¨è\u0026#39;, \u0026#39;ä¸šç•Œæ¨è\u0026#39;, \u0026#39;ç¤¾åŒºæ¨è\u0026#39; ] }, interview: { technical: { \u0026#39;ç¼–ç¨‹æµ‹è¯•\u0026#39;, \u0026#39;é¡¹ç›®ä½œå“è¯„ä¼°\u0026#39;, \u0026#39;æŠ€æœ¯é—®ç­”\u0026#39; }, \u0026#39;cultural\u0026#39;: [ \u0026#39;å›¢é˜Ÿå¥‘åˆåº¦\u0026#39;, \u0026#39;æ²Ÿé€šæ–¹å¼\u0026#39;, \u0026#39;åä½œé£æ ¼\u0026#39; }, \u0026#39;practical\u0026#39;: [ \u0026#39;å°é¡¹ç›®æµ‹è¯•\u0026#39;, \u0026#39;å›¢é˜Ÿåä½œæ¨¡æ‹Ÿ\u0026#39;, \u0026#39;å‹åŠ›æµ‹è¯•\u0026#39; ] }, onboarding: { process: \u0026#39;30-60å¤©å¿«é€Ÿèå…¥\u0026#39;, mentorship: \u0026#39;ä¸€å¯¹ä¸€å¯¼å¸ˆåˆ¶åº¦\u0026#39;, training: \u0026#39;æŠ€èƒ½åŸ¹è®­è®¡åˆ’\u0026#39;, evaluation: \u0026#39;3ä¸ªæœˆç»©æ•ˆè¯„ä¼°\u0026#39; } }; } // å›¢é˜Ÿåä½œå·¥å…· setupCollaborationTools() { return { communication: { instant: \u0026#39;Slack/Discord\u0026#39;, asynchronous: \u0026#39;ç”µå­é‚®ä»¶\u0026#39;, scheduled: \u0026#39;æ¯å‘¨ä¾‹ä¼š\u0026#39;, emergency: \u0026#39;ç´§æ€¥è”ç³»æœºåˆ¶\u0026#39; }, projectManagement: { tasks: \u0026#39;Jira/Trello\u0026#39;, æ–‡æ¡£: \u0026#39;Confluence/Notion\u0026#39;, timeline: \u0026#39;GitHub Projects\u0026#39;, planning: \u0026#39;Google Calendar\u0026#39; }, design: { \u0026#39;2D\u0026#39;: \u0026#39;Photoshop/Illustrator\u0026#39;, \u0026#39;3D\u0026#39;: \u0026#39;Blender/3ds Max\u0026#39;, \u0026#39;UI/UX\u0026#39;: \u0026#39;Figma/Sketch\u0026#39;, \u0026#39;ç‰ˆæœ¬æ§åˆ¶\u0026#39;: \u0026#39;Git LFS\u0026#39; }, development: { \u0026#39;IDE\u0026#39;: \u0026#39;Visual Studio/Visual Studio Code\u0026#39;, \u0026#39;versionControl\u0026#39;: \u0026#39;Git/GitLab\u0026#39;, \u0026#39;CI/CD\u0026#39;: \u0026#39;GitHub Actions\u0026#39;, \u0026#39;testing\u0026#39;: \u0026#39;Unity Test Runner/Unreal Test\u0026#39; }, assets: { \u0026#39;storage\u0026#39;: \u0026#39;Google Drive/Dropbox\u0026#39;, \u0026#39;versionControl\u0026#39;: \u0026#39;Git LFS\u0026#39;, \u0026#39;backup\u0026#39;: \u0026#39;è‡ªåŠ¨åŒ–å¤‡ä»½\u0026#39; } }; } } èµ„é‡‘è§„åˆ’ä¸ç®¡ç† å¼€å‘æˆæœ¬ä¼°ç®— 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 174 175 176 177 178 179 180 181 182 183 184 185 186 187 188 189 190 191 // æˆæœ¬ä¼°ç®—ç³»ç»Ÿ class CostEstimator { constructor() { this.costFactors = { personnel: { rates: { producer: 8000, // æœˆè–ª director: 10000, designer: 6000, programmer: 8000, qa: 5000, devops: 7000 }, hours: { fulltime: 176, // æ¯æœˆ parttime: 88 } }, development: { duration: { \u0026#39;ç®€å•æ¸¸æˆ\u0026#39;: 3, // æœˆ \u0026#39;ä¸­ç­‰æ¸¸æˆ\u0026#39;: 6, \u0026#39;å¤æ‚æ¸¸æˆ\u0026#39;: 12 }, overhead: { management: 0.2, communication: 0.1, training: 0.05 } }, assets: { \u0026#39;2D art\u0026#39;: { \u0026#39;character\u0026#39;: { \u0026#39;sprite\u0026#39;: 50, \u0026#39;animation\u0026#39;: 100, \u0026#39;ui\u0026#39;: 30 }, \u0026#39;background\u0026#39;: { \u0026#39;scene\u0026#39;: 100, \u0026#39;tileset\u0026#39;: 50 } }, \u0026#39;3D art\u0026#39;: { \u0026#39;character\u0026#39;: { \u0026#39;modeling\u0026#39;: 500, \u0026#39;rigging\u0026#39;: 300, \u0026#39;animation\u0026#39;: 400 }, \u0026#39;environment\u0026#39;: { \u0026#39;modeling\u0026#39;: 800, \u0026#39;texturing\u0026#39;: 200 } }, \u0026#39;audio\u0026#39;: { \u0026#39;music\u0026#39;: { \u0026#39;composition\u0026#39;: 300, \u0026#39;production\u0026#39;: 500 }, \u0026#39;sfx\u0026#39;: { \u0026#39;creation\u0026#39;: 50, \u0026#39;mixing\u0026#39;: 100 } } }, tools: { \u0026#39;development\u0026#39;: { \u0026#39;unity\u0026#39;: \u0026#39;ä¸ªäººç‰ˆå…è´¹ï¼ŒProç‰ˆ$150/æœˆ\u0026#39;, \u0026#39;unreal\u0026#39;: \u0026#39;ä¸ªäººç‰ˆå…è´¹ï¼Œå•†ä¸šç‰ˆ$35/æœˆ\u0026#39; }, \u0026#39;design\u0026#39;: { \u0026#39;adobe\u0026#39;: \u0026#39;Creative Cloud $50/æœˆ\u0026#39;, \u0026#39;sketch\u0026#39;: \u0026#39;Proç‰ˆ $12/æœˆ\u0026#39;, \u0026#39;figma\u0026#39;: \u0026#39;Proç‰ˆ $12/æœˆ\u0026#39; }, \u0026#39;collaboration\u0026#39;: { \u0026#39;slack\u0026#39;: \u0026#39;$8/user/month\u0026#39;, \u0026#39;jira\u0026#39;: \u0026#39;$10/user/month\u0026#39;, \u0026#39;confluence\u0026#39;: \u0026#39;$5/user/month\u0026#39; }, \u0026#39;analytics\u0026#39;: { \u0026#39;firebase\u0026#39;: \u0026#39;å…è´¹+\u0026#39;, \u0026#39;gameanalytics\u0026#39;: \u0026#39;åŸºç¡€å…è´¹\u0026#39; } }, marketing: { \u0026#39;asos\u0026#39;: \u0026#39;å…è´¹ï¼Œæ¨å¹¿$1000+\u0026#39;, \u0026#39;ads\u0026#39;: \u0026#39;CPC $1-10+\u0026#39;, \u0026#39;influencer\u0026#39;: \u0026#39;$100-10000/post\u0026#39;, \u0026#39;press\u0026#39;: \u0026#39;$500-5000/å‘å¸ƒ\u0026#39; }, platform: { \u0026#39;steam\u0026#39;: \u0026#39;$100/æ¸¸æˆ\u0026#39;, \u0026#39;appstore\u0026#39;: \u0026#39;$99/å¹´\u0026#39;, \u0026#39;google_play\u0026#39;: \u0026#39;$25/æ¬¡\u0026#39;, \u0026#39;apple_store\u0026#39;: \u0026#39;$99/å¹´\u0026#39; } }; } // å¼€å‘æˆæœ¬ä¼°ç®— estimateDevelopmentCosts(gameSpec) { const personnelCost = this.calculatePersonnelCost(gameSpec); const assetCost = this.calculateAssetCost(gameSpec); const toolCost = this.calculateToolCost(gameSpec); const overheadCost = this.calculateOverheadCost(personnelCost, gameSpec); return { total: personnelCost + assetCost + toolCost + overheadCost, breakdown: { personnel: personnelCost, assets: assetCost, tools: toolCost, overhead: overheadCost } }; } // äººå‘˜æˆæœ¬è®¡ç®— calculatePersonnelCost(gameSpec) { const cost = { producer: 0, director: 0, designers: 0, programmers: 0, qa: 0, devops: 0 }; // åˆ¶ä½œäººï¼ˆ1ä¸ªï¼Œè´¯ç©¿å§‹ç»ˆï¼‰ cost.producer = this.costFactors.personnel.rates.producer * this.costFactors.personnel.hours.fulltime * this.getDevelopmentDuration(gameSpec); // å¯¼æ¼”ï¼ˆ1ä¸ªï¼Œè´¯ç©¿å§‹ç»ˆï¼‰ cost.director = this.costFactors.personnel.rates.director * this.costFactors.personnel.hours.fulltime * this.getDevelopmentDuration(gameSpec); // è®¾è®¡å¸ˆï¼ˆ2-3äººï¼Œä¸»åŠ›å¼€å‘æœŸï¼‰ const designerCount = gameSpec.artStyle === \u0026#39;3D\u0026#39; ? 3 : 2; cost.designers = this.costFactors.personnel.rates.designer * designerCount * this.getMainDevelopmentDuration(gameSpec); // ç¨‹åºå‘˜ï¼ˆ2-4äººï¼Œä¸»åŠ›å¼€å‘æœŸï¼‰ const programmerCount = this.getProgrammerCount(gameSpec); cost.programmers = this.costFactors.personnel.rates.programmer * programmerCount * this.getMainDevelopmentDuration(gameSpec); // QAï¼ˆ1äººï¼ŒåæœŸå¼•å…¥ï¼‰ cost.qa = this.costFactors.personnel.rates.qa * this.costFactors.personnel.hours.fulltime * this.getTestingDuration(gameSpec); // DevOpsï¼ˆ0.5äººï¼ŒåæœŸå¼•å…¥ï¼‰ cost.devops = this.costFactors.personnel.rates.devops * this.costFactors.personnel.hours.partime * this.getMainDevelopmentDuration(gameSpec); return cost.producer + cost.director + cost.designers + cost.programmers + cost.qa + cost.devops; } // å¼€å‘å‘¨æœŸè®¡ç®— getDevelopmentDuration(gameSpec) { const baseDuration = this.costFactors.development.duration[gameSpec.complexity] || 6; const complexityMultiplier = this.getComplexityMultiplier(gameSpec); return baseDuration * complexityMultiplier; } getMainDevelopmentDuration(gameSpec) { return this.getDevelopmentDuration(gameSpec) * 0.8; } getTestingDuration(gameSpec) { return this.getDevelopmentDuration(gameSpec) * 0.15; } getProgrammerCount(gameSpec) { if (gameSpec.isMultiplayer) return 4; if (gameSpec.hasOnline) return 3; return 2; } } èµ„é‡‘ç­¹é›†ç­–ç•¥ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 174 175 176 177 178 179 180 181 // ç­¹èµ„ç­–ç•¥ç³»ç»Ÿ class FundingStrategy { bootstrapping: { personalFunding: { sources: [\u0026#39;ä¸ªäººå‚¨è“„\u0026#39;, \u0026#39;ä¿¡ç”¨å¡\u0026#39;, \u0026#39;å®¶åº­æ”¯æŒ\u0026#39;], pros: [\u0026#39;å®Œå…¨æ§åˆ¶\u0026#39;, \u0026#39;å¿«é€Ÿè·å¾—\u0026#39;], cons: [\u0026#39;èµ„é‡‘æœ‰é™\u0026#39;, \u0026#39;ä¸ªäººé£é™©å¤§\u0026#39;] }, friendsAndFamily: { sources: [\u0026#39;æœ‹å‹\u0026#39;, \u0026#39;å®¶äºº\u0026#39;, \u0026#39;æœ‹å‹åœˆ\u0026#39;], \u0026#39;strategies\u0026#39;: [ { name: \u0026#39;å°é¢è´·æ¬¾\u0026#39;, description: \u0026#39;å‘äº²å‹å€Ÿæ¬¾ï¼Œçº¦å®šè¿˜æ¬¾è®¡åˆ’\u0026#39;, amount: 50000 }, { name: \u0026#39;è‚¡æƒæŠ•èµ„\u0026#39;, description: \u0026#39;å‡ºè®©è‚¡æƒæ¢å–èµ„é‡‘ï¼Œåˆ†äº«æ”¶ç›Š\u0026#39;, amount: 100000 } ], pros: [\u0026#39;ä¿¡ä»»åŸºç¡€\u0026#39;, \u0026#39;åˆ©ç‡ä½\u0026#39;, \u0026#39;çµæ´»æ€§å¼º\u0026#39;], cons: [\u0026#39;æ¶‰åŠå…³ç³»\u0026#39;, \u0026#39;è§„æ¨¡æœ‰é™\u0026#39;] }, crowdfunding: { platforms: [\u0026#39;Kickstarter\u0026#39;, \u0026#39;IndieGoGo\u0026#39;, \u0026#39;æ‘©ç‚¹ä¼—ç­¹\u0026#39;], strategies: [ { name: \u0026#39;æ—©æœŸä¼—ç­¹\u0026#39;, description: \u0026#39;åˆ›æ„é˜¶æ®µå°é¢ä¼—ç­¹\u0026#39;, amount: 10000 }, { alpha: \u0026#39;betaæµ‹è¯•\u0026#39;, : description: \u0026#39;æµ‹è¯•é˜¶æ®µä¼—ç­¹\u0026#39;, amount: 50000 }, { launch: \u0026#39;æ¸¸æˆå‘å¸ƒä¼—ç­¹\u0026#39;, description: \u0026#39;æ­£å¼å‘å¸ƒæ—¶ä¼—ç­¹\u0026#39;, campaign: \u0026#39;å…¨é¢æ¨å¹¿\u0026#39; } ], tips: [ \u0026#39;å‡†å¤‡æ¼”ç¤ºè§†é¢‘\u0026#39;, \u0026#39;è®¾ç½®åˆç†ç›®æ ‡\u0026#39;, \u0026#39;ä¸°å¯Œå¥–åŠ±å±‚æ¬¡\u0026#39;, \u0026#39;æŒç»­æ›´æ–°è¿›åº¦\u0026#39; ] } }, angelInvestment: { sources: [\u0026#39;å¤©ä½¿æŠ•èµ„äºº\u0026#39;, \u0026#39;æ¸¸æˆäº§ä¸šæŠ•èµ„äºº\u0026#39;, \u0026#39;é£é™©æŠ•èµ„æœºæ„\u0026#39;], strategy: { pitchFocus: [ \u0026#39;å¸‚åœºè§„æ¨¡å’Œæ½œåŠ›\u0026#39;, \u0026#39;å›¢é˜ŸèƒŒæ™¯å’Œç»éªŒ\u0026#39;, \u0026#39;äº§å“åŸå‹æ¼”ç¤º\u0026#39;, \u0026#39;å•†ä¸šè®¡åˆ’ä¹¦\u0026#39;, \u0026#39;è´¢åŠ¡é¢„æµ‹\u0026#39; ], valuations: [ \u0026#39;ç§å­è½®\u0026#39;: 500000, \u0026#39;å¤©ä½¿è½®\u0026#39;: 2000000, \u0026#39;preSeries\u0026#39;: 5000000 ] } }, publishers: { traditional: { types: [\u0026#39;å¤§å‹å‘è¡Œå•†\u0026#39;, \u0026#39;ç‹¬ç«‹å‘è¡Œå•†\u0026#39;], deals: [\u0026#39;é¢„ä»˜æ¬¾ + åˆ†æˆæ”¶å…¥\u0026#39;, \u0026#39;çº¯ç²¹åˆ†æˆæ”¶å…¥\u0026#39;, \u0026#39;æˆæƒ+åˆ†æˆæ”¶å…¥\u0026#39;], pros: [\u0026#39;èµ„é‡‘æ”¯æŒ\u0026#39;, \u0026#39;è¥é”€æ¸ é“\u0026#39;, \u0026#39;å¹³å°åˆ†å‘\u0026#39;], cons: [\u0026#39;åˆ†æˆæ¯”ä¾‹é«˜\u0026#39;, \u0026#39;æ§åˆ¶æƒå—é™\u0026#39;] }, digital: { types: [\u0026#39;SteamDirect\u0026#39;, \u0026#39;App Store\u0026#39;, \u0026#39;Google Play\u0026#39;], deal: \u0026#39;çº¯åˆ†æˆï¼Œæ— é¢„ä»˜æ¬¾\u0026#39;, pros: [\u0026#39;æ§åˆ¶æƒå®Œæ•´\u0026#39;, \u0026#39;ç›´æ¥è§¦è¾¾ç”¨æˆ·\u0026#39;, \u0026#39;åˆ†æˆç‡é«˜\u0026#39;], cons: [\u0026#39;éœ€è¦è‡ªå»ºè¥é”€\u0026#39;, \u0026#39;è´¨é‡è¦æ±‚é«˜\u0026#39;] } } }; // èèµ„è®¡åˆ’åˆ¶å®š createFundingPlan(gameSpec, developmentCosts) { return { phases: { preProduction: { funding: \u0026#39;50,000-100,000\u0026#39;, timeframe: \u0026#39;3-6ä¸ªæœˆ\u0026#39;, milestones: [ \u0026#39;åŸå‹å¼€å‘å®Œæˆ\u0026#39;, \u0026#39;æ ¸å¿ƒç©æ³•éªŒè¯\u0026#39;, \u0026#39;å›¢é˜Ÿç»„å»ºå®Œæˆ\u0026#39; ] }, production: { funding: \u0026#39;100,000-300,000\u0026#39;, timeframe: \u0026#39;6-12ä¸ªæœˆ\u0026#39;, milestones: [ \u0026#39;Alphaç‰ˆæœ¬\u0026#39;, \u0026#39;Betaç‰ˆæœ¬\u0026#39;, \u0026#39;å‡†å¤‡å‘å¸ƒ\u0026#39; ] }, launch: { funding: \u0026#39;50,000-200,000\u0026#39;, timeframe: \u0026#39;1-3ä¸ªæœˆ\u0026#39;, milestones: [ \u0026#39;æ­£å¼å‘å¸ƒ\u0026#39;, \u0026#39;åˆæœŸæ¨å¹¿\u0026#39;, \u0026#39;å¸‚åœºéªŒè¯\u0026#39; ] } }, totalBudget: this.calculateTotalBudget(developmentCosts), fundingSources: this.recommendFundingSources(200000, gameSpec), financialProjections: this.projectRevenue(100000, gameSpec), riskMitigation: this.identifyRisks() }; } // è¥é”€æ”¶å…¥é¢„æµ‹ projectRevenue(totalInvestment, gameSpec) { const scenarios = { conservative: { \u0026#39;conversionRate\u0026#39;: 0.1, \u0026#39;averagePrice\u0026#39;: 20, \u0026#39;marketSize\u0026#39;: 10000 }, realistic: { \u0026#39;conversionRate\u0026#39;: 0.15, \u0026#39;averagePrice\u0026#39;: 25, \u0026#39;marketSize\u0026#39;: 20000 }, optimistic: { \u0026#39;contributorRate\u0026#39;: 0.25, \u0026#39;averagePrice: 30, \u0026#39;marketSize\u0026#39;: 50000 } }; return { conservative: this.calculateRevenue(scenarios.conservative, gameSpec, totalInvestment), realistic: this.calculateRevenue(scenarios.realistic, gameSpec, totalInvestment), optimistic: this.calculateRevenue(scenarios.optimistic, gameSpec, totalInvestment), breakEvenAnalysis: { conservative: this.calculateBreakEven(scenarios.conservative.revenue, totalInvestment), realistic: this.calculateBreakEven(scenarios.realistic.revenue, totalInvestment), optimistic: this.calculateBreakEven(scenarios.optimistic.revenue, totalInvestment) } }; } calculateRevenue(scenario, gameSpec, totalInvestment) { const monthlyRevenue = scenario.averagePrice * scenario.marketSize * scenario.conversionRate; const yearlyRevenue = monthlyRevenue * 12; const yearToBreakEven = totalInvestment / yearlyRevenue; return { monthlyRevenue, yearlyRevenue, yearToBreakEven, fiveYearRevenue: yearlyRevenue * 5, roi: ((yearlyRevenue * 5 - totalInvestment) / totalInvestment) * 100 }; } } æ€»ç»“ ç‹¬ç«‹æ¸¸æˆå¼€å‘çš„æ ¸å¿ƒæˆåŠŸè¦ç´ ï¼š\nåˆ›æ„ä¸ç­–åˆ’ï¼š\nç‹¬ç‰¹ä¸”æœ‰å¸å¼•åŠ›çš„æ¸¸æˆæ¦‚å¿µ å¯è¡Œçš„æŠ€æœ¯å®ç°æ–¹æ¡ˆ æ˜ç¡®çš„ç›®æ ‡ç”¨æˆ·å®šä½ åˆç†çš„å•†ä¸šæ¨¡å¼ æŠ€æœ¯å®ç°ï¼š\né€‰æ‹©åˆé€‚çš„æ¸¸æˆå¼•æ“ ä¼˜åŒ–æ€§èƒ½å’Œå†…å­˜ä½¿ç”¨ å»ºç«‹å®Œå–„çš„å·¥ä½œæµç¨‹ ä½¿ç”¨è‡ªåŠ¨åŒ–å·¥å…·æå‡æ•ˆç‡ å›¢é˜Ÿç®¡ç†ï¼š\nè§’è‰²æ¸…æ™°ï¼ŒèŒè´£æ˜ç¡® å»ºç«‹è‰¯å¥½çš„æ²Ÿé€šæœºåˆ¶ ä¿æŒå›¢é˜Ÿå‡èšåŠ› æŒç»­å­¦ä¹ å’Œæˆé•¿ èµ„é‡‘è§„åˆ’ï¼š\nå¤šå…ƒåŒ–çš„èµ„é‡‘æ¥æº åˆç†çš„æˆæœ¬æ§åˆ¶ æ¸…æ™°çš„å•†ä¸šé¢„æœŸ æŒç»­çš„è´¢åŠ¡è§„åˆ’ å‘è¡Œè¥é”€ï¼š\né€‰æ‹©åˆé€‚çš„å‘è¡Œæ¸ é“ æœ‰æ•ˆçš„å¸‚åœºæ¨å¹¿ æŒç»­çš„æ•°æ®åˆ†æ çµæ´»è°ƒæ•´ç­–ç•¥ é€šè¿‡ç³»ç»ŸåŒ–çš„è§„åˆ’å’Œæ‰§è¡Œï¼Œç‹¬ç«‹å¼€å‘è€…å¯ä»¥å°†åˆ›æ„æˆåŠŸè½¬åŒ–ä¸ºå•†ä¸šä»·å€¼ï¼Œå®ç°ä»0åˆ°1çš„è·¨è¶Šã€‚\nç›¸å…³èµ„æºï¼š\nUnityå¼€å‘è€…æ–‡æ¡£ Unreal Engineå®˜æ–¹æ–‡æ¡£ SteamDirectæŒ‡å— ç‹¬ç«‹æ¸¸æˆå¼€å‘è€…æŒ‡å— ","permalink":"/blog/articles/indie-game-development-guide/","summary":"æ·±å…¥å‰–æç‹¬ç«‹æ¸¸æˆå¼€å‘çš„å…¨è¿‡ç¨‹ï¼Œä»åˆ›æ„æ„æ€åˆ°å¸‚åœºå‘è¡Œçš„å®æˆ˜ç»éªŒåˆ†äº«ã€‚","title":"ç‹¬ç«‹æ¸¸æˆå¼€å‘å®Œå…¨æŒ‡å—ï¼šä»åˆ›æ„åˆ°å‘å¸ƒçš„æˆåŠŸä¹‹è·¯"},{"content":"å¼•è¨€ åœ¨ç§»åŠ¨äº’è”ç½‘ç«äº‰æ¿€çƒˆçš„ä»Šå¤©ï¼Œä»…ä»…æ‹¥æœ‰ä¼˜ç§€çš„äº§å“æ˜¯ä¸å¤Ÿçš„ã€‚å¦‚ä½•ä»0åˆ°100ä¸‡ç”¨æˆ·ï¼Œå¦‚ä½•è®©åº”ç”¨æŒç»­å¢é•¿ï¼Œè¿™æ˜¯æ¯ä¸ªåº”ç”¨å¼€å‘è€…å’Œè¿è¥è€…éƒ½éœ€è¦é¢å¯¹çš„æŒ‘æˆ˜ã€‚æœ¬æ–‡å°†æ·±å…¥æ¢è®¨ç§»åŠ¨åº”ç”¨çš„è¥é”€å¢é•¿ç­–ç•¥ï¼Œæä¾›ä»è·å®¢åˆ°å˜ç°çš„å…¨é“¾è·¯è§£å†³æ–¹æ¡ˆã€‚\nç”¨æˆ·å¢é•¿é£è½®æ¨¡å‹ å¢é•¿é£è½®æ¶æ„ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 // å¢é•¿é£è½®æ¨¡å‹ const GrowthFlywheel = { // æ ¸å¿ƒæŒ‡æ ‡ coreMetrics: { acquisition: \u0026#39;è·å®¢\u0026#39;, activation: \u0026#39;æ¿€æ´»\u0026#39;, retention: \u0026#39;ç•™å­˜\u0026#39;, revenue: \u0026#39;æ”¶å…¥\u0026#39;, referral: \u0026#39;æ¨è\u0026#39; }, // è·å®¢æ¸ é“ acquisitionChannels: { organic: { app_store: \u0026#39;åº”ç”¨å•†åº—\u0026#39;, search: \u0026#39;æœç´¢æµé‡\u0026#39;, social: \u0026#39;ç¤¾äº¤åª’ä½“\u0026#39;, word_of_mouth: \u0026#39;å£ç¢‘ä¼ æ’­\u0026#39; }, paid: { search_ads: \u0026#39;æœç´¢å¹¿å‘Š\u0026#39;, social_ads: \u0026#39;ç¤¾äº¤å¹¿å‘Š\u0026#39;, influencer: \u0026#39;KOLæŠ•æ”¾\u0026#39;, network: \u0026#39;å¹¿å‘Šç½‘ç»œ\u0026#39; }, owned: { website: \u0026#39;å®˜ç½‘å¼•æµ\u0026#39;, content: \u0026#39;å†…å®¹è¥é”€\u0026#39;, email: \u0026#39;é‚®ä»¶è¥é”€\u0026#39;, community: \u0026#39;ç¤¾ç¾¤è¿è¥\u0026#39; } }, // å¢é•¿ç­–ç•¥ growthStrategies: { viral: { name: \u0026#39;ç—…æ¯’ä¼ æ’­\u0026#39;, coefficient: 1.2, tactics: [\u0026#39;é‚€è¯·å¥–åŠ±\u0026#39;, \u0026#39;ç¤¾äº¤åˆ†äº«\u0026#39;, \u0026#39;å†…å®¹ä¼ æ’­\u0026#39;] }, sticky: { name: \u0026#39;ç”¨æˆ·ç²˜æ€§\u0026#39;, retention: 0.6, tactics: [\u0026#39;ä¸ªæ€§åŒ–æ¨è\u0026#39;, \u0026#39;ç¤¾åŒºå»ºè®¾\u0026#39;, \u0026#39;ä¼šå‘˜ä½“ç³»\u0026#39;] }, paid: { name: \u0026#39;ä»˜è´¹å¢é•¿\u0026#39;, cac: 20, ltv: 120, tactics: [\u0026#39;ç²¾å‡†æŠ•æ”¾\u0026#39;, \u0026#39;A/Bæµ‹è¯•\u0026#39;, \u0026#39;ROIä¼˜åŒ–\u0026#39;] } } }; // å¢é•¿é£è½®è®¡ç®—å™¨ class GrowthFlywheelCalculator { constructor(initialUsers = 1000) { this.initialUsers = initialUsers; this.currentUsers = initialUsers; this.monthlyGrowthRate = 0; this.viralCoefficient = 1.2; this.churnRate = 0.1; this.newUsersPerMonth = 0; } // è®¡ç®—æœˆå¢é•¿ calculateMonthlyGrowth(metrics) { const { newUsers, retainedUsers, referredUsers, churnedUsers } = metrics; const growthRate = (newUsers - churnedUsers) / this.currentUsers; this.monthlyGrowthRate = growthRate; this.currentUsers += newUsers - churnedUsers; this.newUsersPerMonth = newUsers; return { growthRate, currentUsers: this.currentUsers, timeToNextMilestone: this.calculateTimeToNextMilestone() }; } // é¢„æµ‹æœªæ¥å¢é•¿ predictGrowth(months = 12) { const projections = []; let users = this.currentUsers; for (let month = 1; month \u0026lt;= months; month++) { // è€ƒè™‘è‡ªç„¶å¢é•¿ã€ç—…æ¯’ä¼ æ’­å’Œæµå¤± const naturalGrowth = users * 0.05; const viralGrowth = users * (this.viralCoefficient - 1) * 0.1; const churn = users * this.churnRate; users += naturalGrowth + viralGrowth - churn; projections.push({ month, users: Math.max(0, Math.floor(users)), growth: users - (projections[month - 1]?.users || this.initialUsers) }); } return projections; } // è®¡ç®—è¾¾åˆ°ç‰¹å®šç”¨æˆ·æ•°æ‰€éœ€æ—¶é—´ calculateTimeToTarget(targetUsers) { let currentUsers = this.currentUsers; let months = 0; while (currentUsers \u0026lt; targetUsers \u0026amp;\u0026amp; months \u0026lt; 60) { // æœ€å¤š5å¹´ const growth = currentUsers * 0.15; // å‡è®¾15%æœˆå¢é•¿ currentUsers += growth; months++; } return { months, years: months / 12, achievable: currentUsers \u0026gt;= targetUsers }; } // è®¡ç®—åˆ°ä¸‹ä¸€ä¸ªé‡Œç¨‹ç¢‘çš„æ—¶é—´ calculateTimeToNextMilestone() { const milestones = [10000, 50000, 100000, 500000, 1000000]; const currentMilestone = milestones.find(m =\u0026gt; m \u0026gt; this.currentUsers); if (!currentMilestone) { return \u0026#39;å·²ç»è¾¾åˆ°100ä¸‡ç”¨æˆ·ï¼\u0026#39;; } const result = this.calculateTimeToTarget(currentMilestone); return `é¢„è®¡${result.years.toFixed(1)}å¹´è¾¾åˆ°${currentMilestone.toLocaleString()}ç”¨æˆ·`; } } ASOä¼˜åŒ–ç­–ç•¥ åº”ç”¨å•†åº—ä¼˜åŒ– 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 174 175 176 177 178 179 180 181 182 183 184 185 186 187 188 189 190 191 192 193 194 195 196 197 198 199 200 201 202 203 204 205 206 207 208 209 210 211 212 213 214 215 216 217 218 219 220 221 222 223 224 225 226 227 228 229 230 231 232 233 234 235 236 237 238 239 // ASOä¼˜åŒ–ç®¡ç†ç³»ç»Ÿ class ASOOptimizer { constructor() { this.appMetadata = { title: \u0026#39;\u0026#39;, subtitle: \u0026#39;\u0026#39;, description: \u0026#39;\u0026#39;, keywords: [], category: \u0026#39;\u0026#39;, icon: \u0026#39;\u0026#39;, screenshots: [], video: \u0026#39;\u0026#39;, developer: \u0026#39;\u0026#39;, privacyPolicy: \u0026#39;\u0026#39;, supportUrl: \u0026#39;\u0026#39; }; this.rankingFactors = { keyword_density: 0.03, title_length: 30, description_length: 4000, review_count: 100, rating_average: 4.0, download_velocity: 1000, engagement_rate: 0.3 }; } // å…³é”®è¯ç ”ç©¶ async researchKeywords(appCategory, competitorApps = []) { const keywordData = await Promise.all([ this.getAppStoreKeywords(appCategory), this.getCompetitorKeywords(competitorApps), this.getTrendingKeywords(), this.getLongTailKeywords() ]); const allKeywords = this.mergeKeywordData(keywordData); // åˆ†æå…³é”®è¯ç«äº‰åº¦ const keywordAnalysis = this.analyzeKeywordCompetition(allKeywords); return { highVolume: keywordAnalysis.highVolume, // é«˜æœç´¢é‡ lowCompetition: keywordAnalysis.lowCompetition, // ä½ç«äº‰åº¦ longTail: keywordAnalysis.longTail, // é•¿å°¾å…³é”®è¯ branded: keywordAnalysis.branded, // å“ç‰Œå…³é”®è¯ category: keywordAnalysis.category // åˆ†ç±»å…³é”®è¯ }; } // ç”Ÿæˆåº”ç”¨æ ‡é¢˜ generateTitle(basicTitle, keywords, brandName) { const templates = [ \u0026#39;{brand} - {title}\u0026#39;, \u0026#39;{title} - {brand}\u0026#39;, \u0026#39;{brand}: {keyword} {title}\u0026#39;, \u0026#39;{title} {keyword} - {brand}\u0026#39;, \u0026#39;{brand} | {title} {keyword}\u0026#39; ]; const bestKeyword = keywords.find(k =\u0026gt; k.competition \u0026lt; 0.3 \u0026amp;\u0026amp; k.volume \u0026gt; 1000); if (bestKeyword) { const template = templates[Math.floor(Math.random() * templates.length)]; return template .replace(\u0026#39;{brand}\u0026#39;, brandName) .replace(\u0026#39;{title}\u0026#39;, basicTitle) .replace(\u0026#39;{keyword}\u0026#39;, bestKeyword.keyword); } return basicTitle; } // ä¼˜åŒ–æè¿° optimizeDescription(baseDescription, keywords) { // å°†å…³é”®è¯è‡ªç„¶åœ°èå…¥æè¿°ä¸­ const keywordPhrases = keywords .slice(0, 5) .map(k =\u0026gt; k.keyword) .join(\u0026#39;ã€\u0026#39;); const enhancedDescription = `${baseDescription}\\n\\nä¸»è¦åŠŸèƒ½åŒ…æ‹¬ï¼š${keywordPhrases}ã€‚æˆ‘ä»¬è‡´åŠ›äºæä¾›æœ€ä¼˜è´¨çš„ç”¨æˆ·ä½“éªŒï¼Œ${keywords[0]?.keyword || \u0026#39;æ ¸å¿ƒåŠŸèƒ½\u0026#39;}æ˜¯æˆ‘ä»¬çš„æ˜æ˜ŸåŠŸèƒ½ï¼Œå—åˆ°å¹¿å¤§ç”¨æˆ·çš„ä¸€è‡´å¥½è¯„ã€‚${keywords[1]?.keyword || \u0026#39;ç‰¹è‰²åŠŸèƒ½\u0026#39;}è®©æ‚¨çš„ä½¿ç”¨æ›´åŠ ä¾¿æ·é«˜æ•ˆã€‚`; return { shortDescription: enhancedDescription.substring(0, 160), fullDescription: enhancedDescription.substring(0, 4000) }; } // æˆªå›¾ä¼˜åŒ– optimizeScreenshots(screenshots) { return { firstScreenshots: { hero: { purpose: \u0026#39;é¦–å±å¸å¼•\u0026#39;, elements: [\u0026#39;æ ¸å¿ƒåŠŸèƒ½å±•ç¤º\u0026#39;, \u0026#39;å“ç‰Œæ ‡è¯†\u0026#39;, \u0026#39;ä»·å€¼ä¸»å¼ \u0026#39;], design: \u0026#39;é«˜å†²å‡»åŠ›è®¾è®¡\u0026#39; }, keyFeatures: { purpose: \u0026#39;åŠŸèƒ½å±•ç¤º\u0026#39;, elements: [\u0026#39;ä¸»è¦åŠŸèƒ½æ¼”ç¤º\u0026#39;, \u0026#39;æ“ä½œæµç¨‹\u0026#39;], design: \u0026#39;æ¸…æ™°æ˜äº†\u0026#39; }, socialProof: { purpose: \u0026#39;ä¿¡ä»»å»ºç«‹\u0026#39;, elements: [\u0026#39;ç”¨æˆ·è¯„ä»·\u0026#39;, \u0026#39;ä¸‹è½½é‡\u0026#39;, \u0026#39;è¯„åˆ†\u0026#39;], design: \u0026#39;å¯ä¿¡è®¾è®¡\u0026#39; } }, optimization: { size: \u0026#39;1242x2208 (iPhone)\u0026#39;, format: \u0026#39;PNGæˆ–JPEG\u0026#39;, quality: \u0026#39;é«˜è´¨é‡ä½†ä¸å½±å“åŠ è½½é€Ÿåº¦\u0026#39;, naming: \u0026#39;åŒ…å«å…³é”®è¯çš„æ–‡ä»¶å\u0026#39; } }; } // è¯„ä»·ç®¡ç† manageReviews() { return { acquisition: { // åº”ç”¨å†…è¯„ä»·æ—¶æœº triggers: [ \u0026#39;é¦–æ¬¡ä½¿ç”¨7å¤©å\u0026#39;, \u0026#39;å®Œæˆé‡è¦æ“ä½œå\u0026#39;, \u0026#39;è¿ç»­ä½¿ç”¨30å¤©å\u0026#39;, \u0026#39;è¾¾åˆ°é‡è¦é‡Œç¨‹ç¢‘æ—¶\u0026#39; ], messaging: { polite: \u0026#39;æ‚¨è§‰å¾—æˆ‘ä»¬çš„åº”ç”¨æ€ä¹ˆæ ·ï¼Ÿæ‚¨çš„è¯„ä»·å¯¹æˆ‘ä»¬å¾ˆé‡è¦\u0026#39;, incentivized: \u0026#39;è¯„ä»·åå¯è·å¾—100ç§¯åˆ†å¥–åŠ±\u0026#39;, contextual: \u0026#39;æ‚¨åˆšåˆšå®Œæˆäº†è®¢å•ï¼Œæ„¿æ„åˆ†äº«æ‚¨çš„ä½“éªŒå—ï¼Ÿ\u0026#39; } }, response: { // å›å¤è¯„ä»·çš„ç­–ç•¥ positive: { tone: \u0026#39;æ„Ÿæ©+é¼“åŠ±\u0026#39;, template: \u0026#39;æ„Ÿè°¢æ‚¨çš„è¯„ä»·ï¼æˆ‘ä»¬ä¼šç»§ç»­åŠªåŠ›æä¾›æ›´å¥½çš„æœåŠ¡ã€‚\u0026#39;, timing: \u0026#39;24å°æ—¶å†…\u0026#39; }, negative: { tone: \u0026#39;ç†è§£+è§£å†³\u0026#39;, template: \u0026#39;å¾ˆæŠ±æ­‰ç»™æ‚¨å¸¦æ¥äº†ä¸ä¾¿ï¼Œæˆ‘ä»¬è¯¥å¦‚ä½•æ”¹è¿›ï¼Ÿ\u0026#39;, timing: \u0026#39;12å°æ—¶å†…\u0026#39; }, neutral: { tone: \u0026#39;æ„Ÿè°¢+å¼•å¯¼\u0026#39;, template: \u0026#39;æ„Ÿè°¢æ‚¨çš„åé¦ˆï¼Œæœ‰ä»€ä¹ˆå»ºè®®å¯ä»¥å‘Šè¯‰æˆ‘ä»¬å—ï¼Ÿ\u0026#39;, timing: \u0026#39;18å°æ—¶å†…\u0026#39; } } }; } // A/Bæµ‹è¯•ä¼˜åŒ– setupABTest() { return { testCases: [ { name: \u0026#39;title_variations\u0026#39;, variants: [ \u0026#39;ç‰ˆæœ¬A: å“ç‰Œä¼˜å…ˆ\u0026#39;, \u0026#39;ç‰ˆæœ¬B: åŠŸèƒ½ä¼˜å…ˆ\u0026#39;, \u0026#39;ç‰ˆæœ¬C: æƒ…æ„Ÿä¼˜å…ˆ\u0026#39; ], metric: \u0026#39;conversion_rate\u0026#39; }, { name: \u0026#39;icon_variations\u0026#39;, variants: [ \u0026#39;ç‰ˆæœ¬A: å½©è‰²å›¾æ ‡\u0026#39;, \u0026#39;ç‰ˆæœ¬B: å•è‰²å›¾æ ‡\u0026#39;, \u0026#39;ç‰ˆæœ¬C: æ¸å˜å›¾æ ‡\u0026#39; ], metric: \u0026#39;download_rate\u0026#39; }, { name: \u0026#39;screenshot_order\u0026#39;, variants: [ \u0026#39;ç‰ˆæœ¬A: æ ¸å¿ƒåŠŸèƒ½ä¼˜å…ˆ\u0026#39;, \u0026#39;ç‰ˆæœ¬B: ç¤¾äº¤è¯æ˜ä¼˜å…ˆ\u0026#39;, \u0026#39;ç‰ˆæœ¬C: ä½¿ç”¨æ•™ç¨‹ä¼˜å…ˆ\u0026#39; ], metric: \u0026#39;conversion_rate\u0026#39; } ], configuration: { trafficSplit: 0.5, testDuration: 14, // å¤© confidenceLevel: 0.95, minimumSampleSize: 1000 } }; } // ç›‘æ§å’Œåˆ†æ setupMonitoring() { return { tracking: { keywordRanking: { frequency: \u0026#39;daily\u0026#39;, keywords: this.targetKeywords }, downloadMetrics: { frequency: \u0026#39;real-time\u0026#39;, metrics: [\u0026#39;downloads\u0026#39;, \u0026#39;rank\u0026#39;, \u0026#39;visibility\u0026#39;] }, conversionMetrics: { frequency: \u0026#39;daily\u0026#39;, metrics: [\u0026#39;conversion_rate\u0026#39;, \u0026#39;conversion_value\u0026#39;] }, competitorMetrics: { frequency: \u0026#39;weekly\u0026#39;, metrics: [\u0026#39;competitor_ranking\u0026#39;, \u0026#39;market_share\u0026#39;] } }, alerts: { rankingDrop: { threshold: -10, action: \u0026#39;æ£€æŸ¥ASOæŒ‡æ ‡\u0026#39; }, downloadDecline: { threshold: -0.2, action: \u0026#39;æ£€æŸ¥è¥é”€æ´»åŠ¨\u0026#39; }, reviewDrop: { threshold: 0.1, action: \u0026#39;æ£€æŸ¥ç”¨æˆ·ä½“éªŒ\u0026#39; } } }; } } åº”ç”¨å†…è½¬åŒ–ä¼˜åŒ– 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 174 175 176 177 178 179 180 181 182 183 184 185 186 187 188 189 190 191 192 193 194 195 196 197 198 199 200 201 202 203 204 205 206 207 208 209 210 211 212 213 214 215 216 217 218 219 220 221 222 223 224 225 226 227 228 229 230 231 232 233 234 235 236 237 238 239 240 241 242 243 244 245 246 247 248 249 250 251 252 253 254 255 256 257 258 259 260 261 262 263 264 265 266 267 268 269 270 271 // åº”ç”¨å†…è½¬åŒ–ä¼˜åŒ–ç³»ç»Ÿ class InAppConversionOptimizer { constructor() { this.conversionFunnel = { // è½¬åŒ–æ¼æ–— stages: [ { name: \u0026#39;launch\u0026#39;, action: \u0026#39;æ‰“å¼€åº”ç”¨\u0026#39;, weight: 100 }, { name: \u0026#39;landing\u0026#39;, action: \u0026#39;æµè§ˆé¦–é¡µ\u0026#39;, weight: 80 }, { name: \u0026#39;explore\u0026#39;, action: \u0026#39;æ¢ç´¢åŠŸèƒ½\u0026#39;, weight: 60 }, { name: \u0026#39;engage\u0026#39;, action: \u0026#39;æ·±å…¥ä½¿ç”¨\u0026#39;, weight: 40 }, { name: \u0026#39;convert\u0026#39;, action: \u0026#39;ç›®æ ‡è¡Œä¸º\u0026#39;, weight: 20 } ], // è½¬åŒ–ç›®æ ‡ objectives: { registration: \u0026#39;ç”¨æˆ·æ³¨å†Œ\u0026#39;, purchase: \u0026#39;è´­ä¹°å•†å“\u0026#39;, subscription: \u0026#39;è®¢é˜…æœåŠ¡\u0026#39;, sharing: \u0026#39;ç¤¾äº¤åˆ†äº«\u0026#39;, engagement: \u0026#39;æ·±åº¦äº’åŠ¨\u0026#39; } }; this.optimizationStrategies = { // æ¿€æ´»ç‡ä¼˜åŒ– activation: { onboarding: { type: \u0026#39;progressive_onboarding\u0026#39;, steps: [ { title: \u0026#39;æ¬¢è¿ä½¿ç”¨\u0026#39;, content: \u0026#39;è®©æˆ‘ä»¬å¿«é€Ÿäº†è§£åº”ç”¨çš„æ ¸å¿ƒåŠŸèƒ½\u0026#39;, type: \u0026#39;intro\u0026#39; }, { title: \u0026#39;æ ¸å¿ƒåŠŸèƒ½\u0026#39;, content: \u0026#39;è¿™æ˜¯æœ€é‡è¦çš„åŠŸèƒ½æ¨¡å—\u0026#39;, type: \u0026#39;feature_highlight\u0026#39; }, { title: \u0026#39;å¼€å§‹ä½¿ç”¨\u0026#39;, content: \u0026#39;ç°åœ¨å¼€å§‹æ‚¨çš„ç²¾å½©ä½“éªŒå§ï¼\u0026#39;, type: \u0026#39;call_to_action\u0026#39; } ] }, firstRunExperience: { personalisedContent: true, contextualTips: true, progressIndicators: true, skipOptions: true } }, // ç•™å­˜ç‡ä¼˜åŒ– retention: { pushNotifications: { personalized: true, timely: true, valuable: true, frequency: \u0026#39;adaptive\u0026#39; }, gamification: { points: { type: \u0026#39;experience\u0026#39;, achievements: [ { name: \u0026#39;æ–°æ‰‹ä¸Šè·¯\u0026#39;, points: 100 }, { name: \u0026#39;æ´»è·ƒç”¨æˆ·\u0026#39;, points: 500 }, { name: \u0026#39;èµ„æ·±ç”¨æˆ·\u0026#39;, points: 1000 } ] }, badges: { collectible: true, social: true, progression: true }, challenges: { daily: \u0026#39;æ—¥å¸¸ä»»åŠ¡\u0026#39;, weekly: \u0026#39;æ¯å‘¨æŒ‘æˆ˜\u0026#39;, special: \u0026#39;é™æ—¶æ´»åŠ¨\u0026#39; } } }, // è½¬åŒ–ç‡ä¼˜åŒ– conversion: { socialProof: { testimonials: \u0026#39;çœŸå®ç”¨æˆ·è¯„ä»·\u0026#39;, ratings: \u0026#39;ç”¨æˆ·è¯„åˆ†å±•ç¤º\u0026#39;, statistics: \u0026#39;ä½¿ç”¨æ•°æ®å±•ç¤º\u0026#39; }, urgency: { scarcity: \u0026#39;é™æ—¶ä¼˜æƒ \u0026#39;, exclusivity: \u0026#39;ä¼šå‘˜ä¸“äº«\u0026#39;, timeLimited: \u0026#39;å€’è®¡æ—¶\u0026#39; }, trust: { security: \u0026#39;å®‰å…¨è®¤è¯\u0026#39;, privacy: \u0026#39;éšç§ä¿æŠ¤\u0026#39;, support: \u0026#39;å®¢æˆ·æœåŠ¡\u0026#39; } } }; } // è½¬åŒ–æ¼æ–—åˆ†æ analyzeConversionFunnel(userSessions) { const funnelAnalysis = { stageMetrics: {}, dropOffAnalysis: {}, optimizationOpportunities: [] }; // åˆ†ææ¯ä¸ªé˜¶æ®µçš„è½¬åŒ–ç‡ Object.keys(this.conversionFunnel.stages).forEach(stageName =\u0026gt; { const stage = this.conversionFunnel.stages[stageName]; const usersInStage = this.countUsersInStage(userSessions, stageName); const usersInPreviousStage = this.getUsersInPreviousStage(userSessions, stageName); const conversionRate = usersInPreviousStage \u0026gt; 0 ? usersInStage / usersInPreviousStage : 0; funnelAnalysis.stageMetrics[stageName] = { users: usersInStage, conversionRate: conversionRate, dropOffRate: 1 - conversionRate }; }); // åˆ†ææµå¤±ç‚¹ for (let i = 0; i \u0026lt; this.conversionFunnel.stages.length - 1; i++) { const currentStage = this.conversionFunnel.stages[i]; const nextStage = this.conversionFunnel.stages[i + 1]; const dropOffRate = funnelAnalysis.stageMetrics[currentStage.name].dropOffRate; if (dropOffRate \u0026gt; 0.3) { // è¶…è¿‡30%çš„æµå¤± funnelAnalysis.dropOffAnalysis[`${currentStage.name}_to_${nextStage.name}`] = { dropOffRate, affectedUsers: funnelAnalysis.stageMetrics[currentStage.name].users * dropOffRate, severity: dropOffRate \u0026gt; 0.5 ? \u0026#39;high\u0026#39; : \u0026#39;medium\u0026#39; }; // ç”Ÿæˆä¼˜åŒ–å»ºè®® funnelAnalysis.optimizationOpportunities.push({ stage: currentStage.name, issue: `ä»${currentStage.name}åˆ°${nextStage.name}çš„æµå¤±ç‡è¿‡é«˜ (${(dropOffRate * 100).toFixed(1)}%)`, suggestions: this.generateOptimizationSuggestions(currentStage, nextStage), priority: dropOffRate \u0026gt; 0.5 ? \u0026#39;high\u0026#39; : \u0026#39;medium\u0026#39; }); } } return funnelAnalysis; } // A/Bæµ‹è¯•è½¬åŒ–ä¼˜åŒ– setupConversionABTest(testType) { const testConfigs = { onboarding: { variantA: \u0026#39;standard_onboarding\u0026#39;, variantB: \u0026#39;progressive_onboarding\u0026#39;, variantC: \u0026#39;interactive_onboarding\u0026#39;, metric: \u0026#39;day7_retention\u0026#39; }, pricing: { variantA: \u0026#39;current_pricing\u0026#39;, variantB: \u0026#39;discount_pricing\u0026#39;, variantC: \u0026#39;freemium_pricing\u0026#39;, metric: \u0026#39;conversion_rate\u0026#39; }, cta: { variantA: \u0026#39;standard_cta\u0026#39;, variantB: \u0026#39;personalized_cta\u0026#39;, variantC: \u0026#39;social_proof_cta\u0026#39;, metric: \u0026#39;click_through_rate\u0026#39; }, layout: { variantA: \u0026#39;current_layout\u0026#39;, variantB: \u0026#39;simplified_layout\u0026#39;, variantC: \u0026#39;enhanced_layout\u0026#39;, metric: \u0026#39;conversion_rate\u0026#39; } }; return { testType, variants: testConfigs[testType], duration: 14, // å¤© sampleSize: 1000, significance: 0.95 }; } // ä¸ªæ€§åŒ–æ¨è personalizeContent(userId, userBehavior) { const userProfile = this.createUserProfile(userId, userBehavior); const personalizationEngine = new PersonalizationEngine(userProfile); return { content: { homepage: { hero: personalizationEngine.getRecommendedHero(), features: personalizationEngine.getRecommendedFeatures(), socialProof: personalizationEngine.getSocialProof() }, product: { recommendations: personalizationEngine.getRecommendedProducts(), pricing: personalizationEngine.getOptimalPricing(), messaging: personalizationEngine.getPersonalizedMessaging() }, navigation: { quickActions: personalizationEngine.getQuickActions(), suggested: personalizationEngine.getSuggestedPages() } }, timing: { notifications: personalizationEngine.getOptimalSendTimes(), popups: personalizationEngine.getTriggerConditions(), prompts: personalizationEngine.getInteractionPrompts() } }; } // ç”¨æˆ·ç”»åƒåˆ›å»º createUserProfile(userId, behavior) { return { demographics: behavior.demographics || {}, preferences: { categories: behavior.categoryPreferences || [], contentTypes: behavior.contentTypes || [], interactions: behavior.interactionTypes || [] }, behavior: { sessionFrequency: behavior.sessionFrequency || 0, averageSessionDuration: behavior.averageSessionDuration || 0, preferredTimes: behavior.preferredTimes || [], devices: behavior.devices || [] }, lifecycle: { stage: this.determineUserStage(behavior), registrationDate: behavior.registrationDate, lastActivity: behavior.lastActivity }, commercial: { purchaseHistory: behavior.purchases || [], priceSensitivity: this.calculatePriceSensitivity(behavior.purchases || []), preferredCategories: behavior.purchasedCategories || [] } }; } // å®æ—¶è½¬åŒ–ä¼˜åŒ– optimizeInRealTime(userAction, userContext) { const optimizationEngine = new RealTimeOptimization(); return { immediate: optimizationEngine.getImmediateOptimizations(userAction, userContext), session: optimizationEngine.getSessionOptimizations(userAction, userContext), é•¿æœŸ: optimizationEngine.getLongTermOptimizations(userAction, userContext) }; } } ç¤¾äº¤ä¼ æ’­ç­–ç•¥ ç—…æ¯’è¥é”€ç³»ç»Ÿ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 174 175 176 177 178 179 180 181 182 183 184 185 186 187 188 189 190 191 192 193 194 195 196 197 198 199 200 201 202 203 204 205 206 207 208 209 210 211 212 213 214 215 216 217 218 219 220 221 222 223 224 225 226 227 228 229 230 231 232 233 234 235 236 237 238 239 240 241 242 243 244 245 246 247 248 249 250 251 252 253 254 255 256 257 258 259 260 261 262 263 264 265 266 267 268 269 270 271 272 273 274 275 276 277 278 279 280 281 282 283 284 285 286 287 288 289 290 291 292 293 294 295 296 297 298 299 300 301 302 303 304 305 306 307 308 309 310 311 312 313 314 315 316 317 318 319 320 321 322 323 324 325 326 327 328 329 330 331 332 333 334 335 336 337 338 339 340 341 342 343 344 345 346 347 348 349 350 351 352 353 354 355 356 357 358 359 360 361 362 363 364 365 366 367 368 369 370 371 372 373 374 375 376 377 378 379 380 381 382 383 384 385 386 387 388 389 390 391 392 393 394 395 396 397 398 399 400 401 402 403 404 405 406 407 408 409 410 411 412 413 414 415 416 417 418 419 420 421 422 423 424 425 426 427 428 429 430 431 432 433 434 435 436 437 438 439 440 441 442 443 444 445 446 447 448 449 450 451 452 453 454 455 456 457 458 459 460 461 462 463 464 465 466 467 468 469 470 471 472 473 474 475 476 477 478 479 480 481 482 483 // ç—…æ¯’è¥é”€ç³»ç»Ÿ class ViralMarketingSystem { constructor() { this.viralLoops = { // åŸºç¡€å¾ªç¯ basic: { trigger: \u0026#39;ç”¨æˆ·å®Œæˆå…³é”®è¡Œä¸º\u0026#39;, action: \u0026#39;åˆ†äº«åˆ°ç¤¾äº¤å¹³å°\u0026#39;, reward: \u0026#39;ç§¯åˆ†æˆ–ä¼˜æƒ åˆ¸\u0026#39;, multiplier: 1.2 }, // é«˜çº§å¾ªç¯ advanced: { trigger: \u0026#39;é‚€è¯·å¥½å‹ä½¿ç”¨\u0026#39;, action: \u0026#39;å¥½å‹æ³¨å†Œå’Œä½¿ç”¨\u0026#39;, reward: \u0026#39;åŒæ–¹è·å¾—å¥–åŠ±\u0026#39;, multiplier: 1.5 }, // è¶…çº§å¾ªç¯ legendary: { trigger: \u0026#39;ç”¨æˆ·æ¨å¹¿æ´»åŠ¨\u0026#39;, action: \u0026#39;å½¢æˆä¼ æ’­ç½‘ç»œ\u0026#39;, reward: \u0026#39;ä½£é‡‘å’Œæ¨å¹¿åˆ†æˆ\u0026#39;, multiplier: 2.0 } }; this.viralMetrics = { kFactor: 1.2, // ç—…æ¯’ç³»æ•° sharingRate: 0.08, conversionRate: 0.15, participationRate: 0.25 }; } // åˆ›å»ºåˆ†äº«å†…å®¹ createShareContent(contentType, userData, customizationOptions = {}) { const contentTemplates = { product: { text: \u0026#39;æˆ‘å‘ç°äº†è¿™ä¸ªè¶…èµçš„äº§å“ï¼Œ{product_name}ï¼Œ{discount}æŠ˜ä¼˜æƒ ï¼å¿«æ¥ä¸€èµ·çœ‹çœ‹å§ï¼\u0026#39;, image: userData.productImage, url: `https://yourapp.com/product/${userData.productId}?ref=${userData.userId}`, description: \u0026#39;å¥½ç‰©åˆ†äº«ï¼Œä¸€èµ·äº«å—ä¼˜æƒ \u0026#39; }, achievement: { text: \u0026#39;æˆ‘åœ¨{app_name}ä¸­è·å¾—äº†{achievement}ï¼å¿«æ¥æŒ‘æˆ˜çœ‹çœ‹ä½ èƒ½è¾¾åˆ°ä»€ä¹ˆæ°´å¹³ï¼\u0026#39;, image: userData.achievementImage, url: `https://yourapp.com/achievement/${userData.achievementId}?ref=${userData.userId}`, description: \u0026#39;æˆå°±åˆ†äº«ï¼Œé‚€è¯·å¥½å‹ä¸€èµ·æ¥ç©\u0026#39; }, milestone: { text: \u0026#39;åœ¨{app_name}ä¸­ä½¿ç”¨{milestone}å¤©äº†ï¼Œæ„Ÿè§‰éå¸¸æ£’ï¼æ¨èç»™å¤§å®¶ï¼\u0026#39;, image: userData.milestoneImage, url: `https://yourapp.com/referral?code=${userData.referralCode}`, description: \u0026#39;é‡Œç¨‹ç¢‘åˆ†äº«ï¼Œé‚€è¯·ä¸€èµ·æˆé•¿\u0026#39; }, challenge: { text: \u0026#39;æˆ‘å‚ä¸äº†{challenge_name}ï¼Œéœ€è¦ä½ çš„æ”¯æŒï¼å¿«æ¥å¸®æˆ‘{action}\u0026#39;, image: userData.challengeImage, url: userData.challengeUrl, description: \u0026#39;æ´»åŠ¨åˆ†äº«ï¼Œé‚€è¯·å¥½å‹å‚ä¸\u0026#39; }, review: { text: \u0026#39;æˆ‘ç»™{app_name}æ‰“äº†{rating}æ˜Ÿï¼{reason}ï¼Œå¼ºçƒˆæ¨èç»™å¤§å®¶ï¼\u0026#39;, image: userData.appIcon, url: `https://yourapp.com/referral?review=${userData.userId}`, description: \u0026#39;è¯„ä»·åˆ†äº«ï¼Œå¸®åŠ©åº”ç”¨è·å¾—æ›´å¤šç”¨æˆ·\u0026#39; } }; const template = contentTemplates[contentType] || contentTemplates[\u0026#39;product\u0026#39;]; const personalizedContent = this.personalizeContent(template, userData, customizationOptions); return { ...personalizedContent, trackableUrl: this.addTrackingParams(personalizedContent.url, userData), socialMetrics: { generatedAt: Date.now(), expectedShares: this.estimateShareCount(contentType, userData), expectedConversions: this.estimateConversions(contentType, userData) } }; } // åˆ†äº«æ¿€åŠ±æœºåˆ¶ createIncentiveStructure(userSegment) { const structures = { new_user: { firstShare: { points: 50, probability: 0.8 }, friendRegister: { points: 200, probability: 0.1 }, friendPurchase: { points: 500, probability: 0.05 } }, active_user: { dailyShare: { points: 20, limit: 3 }, contentShare: { points: 30, probability: 0.6 }, achievementShare: { points: 100, probability: 0.3 } }, vip_user: { bonusPoints: 1.5, // 1.5å€ç§¯åˆ† exclusiveRewards: [\u0026#39;VIPå¾½ç« \u0026#39;, \u0026#39;ä¸“å±åŠŸèƒ½\u0026#39;, \u0026#39;ç”Ÿæ—¥ç¤¼åŒ…\u0026#39;], referralBonus: { points: 300, extraRewards: [\u0026#39;ä¸“å±é‚€è¯·ç \u0026#39;] } } }; return structures[userSegment] || structures[\u0026#39;new_user\u0026#39;]; } // ç—…æ¯’ä¼ æ’­åˆ†æ analyzeViralLoop(campaignId, timeRange) { return new Promise(async (resolve) =\u0026gt; { const data = await this.fetchViralData(campaignId, timeRange); const analysis = { overview: { totalShares: data.totalShares, totalClicks: data.totalClicks, totalConversions: data.totalConversions, viralCoefficient: this.calculateViralCoefficient(data), shareRate: data.totalShares / data.totalUsers }, propagation: { depth: this.calculatePropagationDepth(data), breadth: this.calculatePropagationBreadth(data), speed: this.calculatePropagationSpeed(data), patterns: this.identifyPropagationPatterns(data) }, channels: { wechat: { shares: data.shares.wechat || 0, conversions: data.conversions.wechat || 0, averageValue: data.conversions.wechat / data.shares.wechat || 0 }, moments: { shares: data.shares.moments || 0, conversions: data.conversions.moments || 0, averageValue: data.conversions.moments / data.shares.moments || 0 }, other: { shares: data.shares.other || 0, conversions: data.conversions.other || 0, averageValue: data.conversions.other / data.shares.other || 0 } }, optimization: { bestPerformingTime: this.findBestPerformingTime(data), bestPerformingChannel: this.findBestPerformingChannel(data), bestPerformingContent: this.findBestPerformingContent(data), suggestions: this.generateViralOptimizationSuggestions(data) }, prediction: { potentialReach: this.predictPotentialReach(data), viralPotential: this.predictViralPotential(data), nextOptimalAction: this.predictNextOptimalAction(data) } }; resolve(analysis); }); } // KOLè¥é”€ç³»ç»Ÿ setupKOLCampaign(kolData) { return { influencer: { selection: { criteria: [ \u0026#39;follower_count: \u0026gt;10000\u0026#39;, \u0026#39;engagement_rate: \u0026gt;3%\u0026#39;, \u0026#39;audience_match: \u0026gt;80%\u0026#39;, \u0026#39;content_quality: \u0026gt;4æ˜Ÿ\u0026#39; ], tiers: { micro: \u0026#39;10k-50k\u0026#39;, macro: \u0026#39;50k-500k\u0026#39;, celebrity: \u0026#39;\u0026gt;500k\u0026#39; } }, compensation: { cpa: { \u0026#39;micro\u0026#39;: 10, \u0026#39;macro\u0026#39;: 30, \u0026#39;celebrity\u0026#39;: 100 }, cpm: { \u0026#39;micro\u0026#39;: 20, \u0026#39;macro\u0026#39;: 50, \u0026#39;celebrity\u0026#39;: 200 }, revenueShare: { \u0026#39;long_term\u0026#39;: 0.05, \u0026#39;limited_time\u0026#39;: 0.15 } } }, campaign: { contentStrategy: { video: \u0026#39;çŸ­è§†é¢‘å±•ç¤º\u0026#39;, images: \u0026#39;äº§å“æ¼”ç¤º\u0026#39;, tutorials: \u0026#39;ä½¿ç”¨æ•™ç¨‹\u0026#39;, reviews: \u0026#39;çœŸå®è¯„ä»·\u0026#39; }, timeline: { preLaunch: 3, // å¤© main: 7, // å¤© followUp: 3 // å¤© }, tracking: { uniqueCodes: true, trackConversions: true, analyzeDemographics: true } }, measurement: { metrics: [ \u0026#39;views\u0026#39;, \u0026#39;engagement\u0026#39;, \u0026#39;clicks\u0026#39;, \u0026#39;conversions\u0026#39;, \u0026#39;CAC\u0026#39;, \u0026#39;LTV\u0026#39;, \u0026#39;ROI\u0026#39; ], attribution: { firstClick: true, viewThrough: true, postView: 7 // å¤© } } }; } } // ç¤¾åŒºè¿è¥ç³»ç»Ÿ class CommunityManager { constructor() { this.communityTypes = { user: \u0026#39;ç”¨æˆ·ç¤¾ç¾¤\u0026#39;, product: \u0026#39;äº§å“ç¤¾ç¾¤\u0026#39;, interest: \u0026#39;å…´è¶£ç¤¾ç¾¤\u0026#39;, regional: \u0026#39;åœ°åŸŸç¤¾ç¾¤\u0026#39; }; this.engagementMetrics = { activeMembers: 0, postCount: 0, commentCount: 0, likeCount: 0, shareCount: 0, averageSessionTime: 0 }; } // åˆ›å»ºç¤¾ç¾¤ createCommunity(communityData) { return { id: this.generateCommunityId(), name: communityData.name, type: communityData.type, description: communityData.description, rules: communityData.rules || this.getDefaultRules(communityData.type), moderators: communityData.moderators || [], members: [communityData.creatorId], channels: this.createCommunityChannels(communityData.type), activities: this.createCommunityActivities(communityData.type), governance: this.createGovernanceStructure(communityData.type), monetization: this.createMonetizationOptions(communityData.type) }; } // ç¤¾ç¾¤æ´»åŠ¨ç®¡ç† createCommunityActivities(communityType) { const activities = { user: [ { name: \u0026#39;æ¯æ—¥ç­¾åˆ°\u0026#39;, type: \u0026#39;check_in\u0026#39;, frequency: \u0026#39;daily\u0026#39;, points: 10, rewards: [\u0026#39;ç§¯åˆ†\u0026#39;, \u0026#39;å¾½ç« \u0026#39;] }, { name: \u0026#39;è¯é¢˜è®¨è®º\u0026#39;, type: \u0026#39;discussion\u0026#39;, frequency: \u0026#39;weekly\u0026#39;, points: 20, rewards: [\u0026#39;ç§¯åˆ†\u0026#39;, \u0026#39;ç²¾åå¸–\u0026#39;] }, { name: \u0026#39;å¥½ç‰©åˆ†äº«\u0026#39;, type: \u0026#39;sharing\u0026#39;, frequency: \u0026#39;weekly\u0026#39;, points: 30, rewards: [\u0026#39;ä¼˜æƒ åˆ¸\u0026#39;, \u0026#39;ä½£é‡‘\u0026#39;] } ], product: [ { name: \u0026#39;ä½¿ç”¨æŠ€å·§\u0026#39;, type: \u0026#39;tutorial\u0026#39;, frequency: \u0026#39;weekly\u0026#39;, points: 25, rewards: [\u0026#39;ç§¯åˆ†\u0026#39;, \u0026#39;ä¸“å±ä¼˜æƒ \u0026#39;] }, { name: \u0026#39;é—®é¢˜åé¦ˆ\u0026#39;, type: \u0026#39;feedback\u0026#39;, frequency: \u0026#39;ongoing\u0026#39;, points: 15, rewards: [\u0026#39;ç§¯åˆ†\u0026#39;, \u0026#39;æ”¹è¿›å»ºè®®é‡‡çº³å¥–åŠ±\u0026#39;] }, { name: \u0026#39;ç”¨æˆ·æ•…äº‹\u0026#39;, type: \u0026#39;storytelling\u0026#39;, frequency: \u0026#39;monthly\u0026#39;, points: 50, rewards: [\u0026#39;ç§¯åˆ†\u0026#39;, \u0026#39;ç”¨æˆ·å¾½ç« \u0026#39;] } ], interest: [ { name: \u0026#39;çŸ¥è¯†åˆ†äº«\u0026#39;, type: \u0026#39;education\u0026#39;, frequency: \u0026#39;weekly\u0026#39;, points: 20, rewards: [\u0026#39;ç§¯åˆ†\u0026#39;, \u0026#39;ä¸“å®¶è®¤è¯\u0026#39;] }, { name: \u0026#39;ç»éªŒäº¤æµ\u0026#39;, type: \u0026#39;networking\u0026#39;, frequency: \u0026#39;weekly\u0026#39;, points: 15, rewards: [\u0026#39;ç§¯åˆ†\u0026#39;, \u0026#39;ç¤¾äº¤ç§¯åˆ†\u0026#39;] }, { name: \u0026#39;é¡¹ç›®åˆä½œ\u0026#39;, type: \u0026#39;collaboration\u0026#39;, frequency: \u0026#39;monthly\u0026#39;, points: 100, rewards: [\u0026#39;ç§¯åˆ†\u0026#39;, \u0026#39;åˆä½œæœºä¼š\u0026#39;] } ] }; return activities[communityType] || activities[\u0026#39;user\u0026#39;]; } // ç”¨æˆ·æ¿€åŠ±ç³»ç»Ÿ createIncentiveSystem(communityData) { return { points: { earn: [ \u0026#39;æ¯æ—¥ç­¾åˆ°: +10ç§¯åˆ†\u0026#39;, \u0026#39;å‘å¸ƒå†…å®¹: +20ç§¯åˆ†\u0026#39;, \u0026#39;è·å¾—ç‚¹èµ: +2ç§¯åˆ†\u0026#39;, \u0026#39;è·å¾—è¯„è®º: +5ç§¯åˆ†\u0026#39;, \u0026#39;åˆ†äº«å†…å®¹: +15ç§¯åˆ†\u0026#39;, \u0026#39;ä¼˜è´¨å†…å®¹: +50ç§¯åˆ†\u0026#39; ], spend: [ \u0026#39;ä¼˜æƒ åˆ¸: 100-500ç§¯åˆ†\u0026#39;, \u0026#39;å®ç‰©å¥–åŠ±: 1000-5000ç§¯åˆ†\u0026#39;, \u0026#39;VIPç‰¹æƒ: 2000-10000ç§¯åˆ†\u0026#39;, \u0026#39;å…¬ç›Šæèµ : ä»»æ„ç§¯åˆ†\u0026#39; ] }, gamification: { levels: [ { name: \u0026#39;æ–°æ‰‹\u0026#39;, points: 0, privileges: [\u0026#39;åŸºç¡€åŠŸèƒ½\u0026#39;] }, { name: \u0026#39;æ´»è·ƒ\u0026#39;, points: 1000, privileges: [\u0026#39;é«˜çº§åŠŸèƒ½\u0026#39;] }, { name: \u0026#39;ä¸“å®¶\u0026#39;, points: 5000, privileges: [\u0026#39;ä¸“å®¶æ ‡è¯†\u0026#39;] }, { name: \u0026#39;å¤§å¸ˆ\u0026#39;, points: 20000, privileges: [\u0026#39;ç¤¾åŒºé¢†è¢–\u0026#39;] } ], badges: [ { name: \u0026#39;ç­¾åˆ°è¾¾äºº\u0026#39;, criteria: \u0026#39;è¿ç»­ç­¾åˆ°30å¤©\u0026#39; }, { name: \u0026#39;å†…å®¹ä¸“å®¶\u0026#39;, criteria: \u0026#39;å‘å¸ƒ50ä¸ªä¼˜è´¨å†…å®¹\u0026#39; }, { name: \u0026#39;ç¤¾äº¤è¾¾äºº\u0026#39;, criteria: \u0026#39;è·èµ100ä¸ªä»¥ä¸Š\u0026#39; }, { name: \u0026#39;åˆ†äº«ä¹‹æ˜Ÿ\u0026#39;, criteria: \u0026#39;åˆ†äº«100æ¬¡ä»¥ä¸Š\u0026#39; } ], leaderboard: { types: [\u0026#39;total_points\u0026#39;, \u0026#39;monthly_points\u0026#39;, \u0026#39;quality_points\u0026#39;], refresh: \u0026#39;daily\u0026#39;, rewards: [\u0026#39;å‰10åå¥–åŠ±\u0026#39;, \u0026#39;å‰100åå±•ç¤º\u0026#39;] } }, recognition: { highlights: [\u0026#39;æ¯å‘¨ç²¾é€‰ç”¨æˆ·\u0026#39;, \u0026#39;æœˆåº¦ä¼˜ç§€æˆå‘˜\u0026#39;], features: [\u0026#39;ç¤¾åŒºé¦–é¡µå±•ç¤º\u0026#39;, \u0026#39;å®˜æ–¹åª’ä½“æŠ¥é“\u0026#39;], exclusive: [\u0026#39;VIPæ´»åŠ¨é‚€è¯·\u0026#39;, \u0026#39;æ–°äº§å“è¯•ç”¨\u0026#39;] } }; } // ç¤¾ç¾¤è¿è¥è‡ªåŠ¨åŒ– setupAutomation() { return { moderation: { autoModeration: { enabled: true, rules: [ \u0026#39;å…³é”®è¯è¿‡æ»¤\u0026#39;, \u0026#39;å›¾ç‰‡è¯†åˆ«\u0026#39;, \u0026#39;æƒ…æ„Ÿåˆ†æ\u0026#39;, \u0026#39;åƒåœ¾æ£€æµ‹\u0026#39; ] }, reportSystem: { reportTypes: [\u0026#39;spam\u0026#39;, \u0026#39;abuse\u0026#39;, \u0026#39;offensive\u0026#39;, \u0026#39;inappropriate\u0026#39;], reviewProcess: \u0026#39;ai_initial + human_final\u0026#39;, responseTime: \u0026#39;2å°æ—¶å†…\u0026#39; } }, engagement: { contentScheduling: { optimalTimes: this.calculateOptimalPostTimes(), autoPublishing: false, // éœ€è¦äººå·¥å®¡æ ¸ contentCuration: true }, userOnboarding: { welcomeMessages: [ \u0026#39;æ¬¢è¿æ¥åˆ°ç¤¾åŒº\u0026#39;, \u0026#39;è¯·ä»”ç»†é˜…è¯»ç¤¾åŒºè§„åˆ™\u0026#39;, \u0026#39;ä»‹ç»ä¸€ä¸‹ä½ è‡ªå·±å§ï¼\u0026#39; ], tutorialVideos: [\u0026#39;å¦‚ä½•å‘å¸ƒå†…å®¹\u0026#39;, \u0026#39;å¦‚ä½•ä¸å…¶ä»–æˆå‘˜äº’åŠ¨\u0026#39;], communityGuidelines: [\u0026#39;ç¤¾åŒºæ–‡åŒ–\u0026#39;, \u0026#39;è¡Œä¸ºå‡†åˆ™\u0026#39;, \u0026#39;è¿è§„å¤„ç†\u0026#39;] } }, growth: { memberAcquisition: { inviteCodeSystem: true, inviteRewards: { inviter: \u0026#39;100ç§¯åˆ†\u0026#39;, invitee: \u0026#39;50ç§¯åˆ†\u0026#39; } }, retention: { atRiskMember: { identification: { criteria: [\u0026#39;7å¤©æœªç™»å½•\u0026#39;, \u0026#39;30å¤©æ— äº’åŠ¨\u0026#39;], alert: true, intervention: \u0026#39;è‡ªåŠ¨æé†’\u0026#39; }, reengagement: { methods: [\u0026#39;ç§ä¿¡æé†’\u0026#39;, \u0026#39;ä¼˜æƒ åˆºæ¿€\u0026#39;, \u0026#39;å†…å®¹æ¨è\u0026#39;], successRate: 0.3 } } } } }; } } æ•°æ®é©±åŠ¨å†³ç­– 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 174 175 176 177 178 179 180 181 182 183 184 185 186 187 188 189 190 191 192 193 194 195 196 197 198 199 200 201 202 203 204 205 206 207 208 209 210 211 212 213 214 215 216 217 218 219 220 221 222 223 224 225 226 227 228 229 230 231 232 233 234 235 236 237 238 239 240 241 242 // è¥é”€æ•°æ®åˆ†æç³»ç»Ÿ class MarketingAnalytics { constructor() { this.dataSources = { userBehavior: \u0026#39;user_behavior_events\u0026#39;, acquisition: \u0026#39;acquisition_channels\u0026#39;, conversion: \u0026#39;conversion_funnel\u0026#39;, revenue: \u0026#39;revenue_tracking\u0026#39;, engagement: \u0026#39;engagement_metrics\u0026#39; }; this.metrics = { acquisition: [\u0026#39;CAC\u0026#39;, \u0026#39;CPI\u0026#39;, \u0026#39;CPA\u0026#39;, \u0026#39;channel_performance\u0026#39;], engagement: [\u0026#39;DAU\u0026#39;, \u0026#39;MAU\u0026#39;, \u0026#39;session_duration\u0026#39;, \u0026#39;retention_rate\u0026#39;], conversion: [\u0026#39;conversion_rate\u0026#39;, \u0026#39;conversion_value\u0026#39;, \u0026#39;funnel_drop_off\u0026#39;], revenue: [\u0026#39;LTV\u0026#39;, \u0026#39;ARPU\u0026#39;, \u0026#39;revenue_growth\u0026#39;, \u0026#39;churn_rate\u0026#39;] }; } // å®æ—¶æ•°æ®çœ‹æ¿ createRealTimeDashboard() { return { overview: { currentDAU: \u0026#39;å®æ—¶æ—¥æ´»ç”¨æˆ·æ•°\u0026#39;, currentMAU: \u0026#39;å®æ—¶æœˆæ´»ç”¨æˆ·æ•°\u0026#39;, currentSessionTime: \u0026#39;å®æ—¶å¹³å‡ä¼šè¯æ—¶é•¿\u0026#39;, todayRevenue: \u0026#39;ä»Šæ—¥æ”¶å…¥\u0026#39;, activeCampaigns: \u0026#39;æ´»è·ƒè¥é”€æ´»åŠ¨\u0026#39; }, channels: { organic: { app_store: \u0026#39;åº”ç”¨å•†åº—æ•°æ®\u0026#39;, search: \u0026#39;æœç´¢æµé‡æ•°æ®\u0026#39;, referral: \u0026#39;æ¨èæ•°æ®\u0026#39;, social: \u0026#39;ç¤¾äº¤åª’ä½“æ•°æ®\u0026#39; }, paid: { ads: \u0026#39;å¹¿å‘ŠæŠ•æ”¾æ•°æ®\u0026#39;, affiliates: \u0026#39;è”ç›Ÿè¥é”€æ•°æ®\u0026#39;, influencers: \u0026#39;KOLæ¨å¹¿æ•°æ®\u0026#39; } }, funnels: { acquisition: \u0026#39;è·å®¢æ¼æ–—\u0026#39;, activation: \u0026#39;æ¿€æ´»æ¼æ–—\u0026#39;, retention: \u0026#39;ç•™å­˜æ¼æ–—\u0026#39;, revenue: \u0026#39;å˜ç°æ¼æ–—\u0026#39; }, alerts: { realTime: [ \u0026#39;DAUçªé™è¶…è¿‡20%\u0026#39;, \u0026#39;è½¬åŒ–ç‡ä½äºé˜ˆå€¼\u0026#39;, \u0026#39;æ”¶å…¥å¢é•¿ç‡ä½äºé¢„æœŸ\u0026#39;, \u0026#39;è·å®¢æˆæœ¬è¶…è¿‡é¢„ç®—\u0026#39; ], alertsHistory: [] } }; } // ç”¨æˆ·è·å–æˆæœ¬åˆ†æ analyzeCAC(timeRange) { return new Promise(async (resolve) =\u0026gt; { const data = await this.fetchCACData(timeRange); const analysis = { overall: { totalCAC: this.calculateOverallCAC(data), channelBreakdown: this.getChannelCACBreakdown(data), trend: this.calculateCACTrend(data), projection: this.projectCAC(data) }, channels: {}, recommendations: [] }; // åˆ†æå„æ¸ é“CAC Object.keys(data.channels).forEach(channel =\u0026gt; { const channelData = data.channels[channel]; analysis.channels[channel] = { cac: this.calculateChannelCAC(channelData), ltv: this.calculateChannelLTV(channelData), cac_ltv_ratio: this.calculateCACLTVRatio(channelData), paybackPeriod: this.calculatePaybackPeriod(channelData), performance: this.evaluateChannelPerformance(channelData) }; // ç”Ÿæˆæ¸ é“å»ºè®® if (analysis.channels[channel].cac_ltv_ratio \u0026lt; 1) { analysis.recommendations.push({ channel, issue: `CAC/LTVæ¯”ç‡è¿‡ä½ (${analysis.channels[channel].cac_ltv_ratio.toFixed(2)})`, suggestion: \u0026#39;ä¼˜åŒ–æŠ•æ”¾ç­–ç•¥æˆ–è€ƒè™‘å‡å°‘è¯¥æ¸ é“æŠ•å…¥\u0026#39;, priority: this.getRecommendationPriority(analysis.channels[channel].cac_ltv_ratio) }); } }); resolve(analysis); }); } // ç”¨æˆ·ç”Ÿå‘½å‘¨æœŸä»·å€¼åˆ†æ analyzeLTV() { return new Promise(async (resolve) =\u0026gt; { const data = await this.fetchLTVData(); const ltvAnalysis = { overall: { averageLTV: data.averageLTV, ltvBySource: data.ltvBySource, ltvBySegment: data.ltvBySegment, ltvTrend: data.ltvTrend }, cohortAnalysis: this.performCohortAnalysis(data.cohorts), predictive: { ltvPrediction: this.predictLTV(data), ltvSegments: this.segmentByLTV(data), ltvDrivers: this.identifyLTVDrivers(data) }, optimization: { improvementOpportunities: this.identifyLTVImprovements(data), retentionImpact: this.calculateRetentionImpact(data), optimizationROI: this.calculateOptimizationROI(data) } }; resolve(ltvAnalysis); }); } // A/Bæµ‹è¯•åˆ†æ analyzeABTest(testId) { return { testInfo: { id: testId, name: \u0026#39;è·å–æµ‹è¯•ä¿¡æ¯\u0026#39;, variants: [], duration: 14, status: \u0026#39;running\u0026#39; }, results: { statisticalSignificance: \u0026#39;95%ç½®ä¿¡åº¦\u0026#39;, winner: \u0026#39;variantA\u0026#39;, improvement: \u0026#39;23.5%\u0026#39;, confidence: \u0026#39;high\u0026#39; }, insights: [ \u0026#39;é¢œè‰²æŒ‰é’®æ¯”é»‘ç™½æŒ‰é’®è¡¨ç°æ›´å¥½\u0026#39;, \u0026#39;ç´§æ€¥æ–‡æ¡ˆæ•ˆæœæ˜¾è‘—\u0026#39;, \u0026#39;ä¸ªæ€§åŒ–æ¨èå¤§å¹…æå‡è½¬åŒ–ç‡\u0026#39; ] }; } // è¥é”€é¢„ç®—ä¼˜åŒ– optimizeBudget(budget, goals) { const optimization = { allocation: { allocationStrategy: \u0026#39;åŸºäºROIè‡ªåŠ¨åˆ†é…\u0026#39;, channels: { search: budget * 0.3, social: budget * 0.4, display: budget * 0.2, influencer: budget * 0.1 }, dynamicAdjustment: { enabled: true, adjustmentInterval: 7, // å¤© criteria: [\u0026#39;performance_based\u0026#39;, \u0026#39;market_based\u0026#39;, \u0026#39;seasonal\u0026#39;] } }, efficiency: { currentROAS: this.calculateCurrentROAS(budget), targetROAS: goals.targetROAS, efficiencyScore: 0, optimizations: [] }, prediction: { nextQuarterBudget: this.predictOptimalBudget(budget, goals), expectedResults: this.predictOptimalResults(budget, goals), riskAssessment: this.assessBudgetRisks(budget) } }; return optimization; } // è‡ªåŠ¨åŒ–è¥é”€å†³ç­– setupAutomation() { return { bidManagement: { platform: \u0026#39;all\u0026#39;, optimization: { \u0026#39;æˆæœ¬æ§åˆ¶\u0026#39;: { maxCAC: 50, dailyBudget: 10000, hourlyBudget: 417 }, \u0026#39;æ•ˆæœä¼˜åŒ–\u0026#39;: { \u0026#39;frequency\u0026#39;: \u0026#39;æ¯å°æ—¶\u0026#39;, \u0026#39;metrics\u0026#39;: [\u0026#39;CPA\u0026#39;, \u0026#39;conversion_rate\u0026#39;, \u0026#39;ROI\u0026#39;], \u0026#39;strategy\u0026#39;: \u0026#39;è‡ªåŠ¨å‡ºä»·\u0026#39; } } }, contentOptimization: { creatives: { \u0026#39;è‡ªåŠ¨æµ‹è¯•\u0026#39;: true, \u0026#39;å¤šå˜ä½“A/B\u0026#39;: true, \u0026#39;æ€§èƒ½ç›‘æ§\u0026#39;: \u0026#39;CTR, CVR\u0026#39; }, copywriting: { \u0026#39;AIè¾…åŠ©\u0026#39;: true, \u0026#39;æƒ…æ„Ÿåˆ†æ\u0026#39;: true\u0026#39;, \u0026#39;A/Bæµ‹è¯•\u0026#39;: true } }, audienceTargeting: { \u0026#39;segmentation\u0026#39;: \u0026#39;è¡Œä¸ºæ•°æ®é©±åŠ¨\u0026#39;, \u0026#39;lookalike\u0026#39;: 2000, \u0026#39;retargeting\u0026#39;: \u0026#39;30å¤©\u0026#39; } }; } } æ€»ç»“ ç§»åŠ¨åº”ç”¨è¥é”€å¢é•¿çš„æˆåŠŸè¦ç´ ï¼š\nç”¨æˆ·å¢é•¿é£è½®ï¼š\nè·å®¢ã€æ¿€æ´»ã€ç•™å­˜ã€æ”¶å…¥ã€æ¨èçš„é—­ç¯è®¾è®¡ æŒç»­ä¼˜åŒ–é£è½®å„ç¯èŠ‚ï¼Œå½¢æˆæ­£å‘å¾ªç¯ æ•°æ®é©±åŠ¨å†³ç­–ï¼Œå¿«é€Ÿè¿­ä»£ å¤šæ¸ é“ååŒï¼Œå½¢æˆå¢é•¿åˆåŠ› ASOä¼˜åŒ–ï¼š\nå…³é”®è¯ç ”ç©¶å’Œç­–ç•¥æ€§å¸ƒå±€ åº”ç”¨å…ƒæ•°æ®å…¨é¢ä¼˜åŒ– è§†è§‰å…ƒç´ å’Œç”¨æˆ·è¯„ä»·ç®¡ç† æŒç»­ç›‘æ§å’ŒA/Bæµ‹è¯• ç¤¾äº¤ä¼ æ’­ï¼š\nè®¾è®¡æœ‰æ•ˆçš„ç—…æ¯’å¾ªç¯æœºåˆ¶ æ¿€åŠ±ç”¨æˆ·åˆ†äº«å’Œé‚€è¯· KOLè¥é”€å’Œç½‘çº¢åˆä½œ ç¤¾ç¾¤è¿è¥å’Œç”¨æˆ·åŸ¹è‚² æ•°æ®é©±åŠ¨ï¼š\nå…¨é“¾è·¯æ•°æ®æ”¶é›†å’Œåˆ†æ ç”¨æˆ·ç”Ÿå‘½å‘¨æœŸä»·å€¼ç®¡ç† A/Bæµ‹è¯•å’Œä¼˜åŒ–å†³ç­– è‡ªåŠ¨åŒ–å’Œæ™ºèƒ½åŒ–è¿è¥ é€šè¿‡ç³»ç»Ÿæ€§çš„è¥é”€ç­–ç•¥å’Œæ•°æ®é©±åŠ¨çš„å†³ç­–æ”¯æŒï¼Œå¯ä»¥å®ç°ä»0åˆ°100ä¸‡ç”¨æˆ·çš„å¯æŒç»­å¢é•¿ã€‚\nç›¸å…³èµ„æºï¼š\nASOä¼˜åŒ–æŒ‡å— Google Play Store Console ç§»åŠ¨åº”ç”¨è¥é”€æœ€ä½³å®è·µ Growth Hacking Guide ","permalink":"/blog/articles/mobile-app-marketing-growth/","summary":"æ·±åº¦å‰–æç§»åŠ¨åº”ç”¨è¥é”€çš„å…¨æ¸ é“ç­–ç•¥ï¼Œä»ç”¨æˆ·è·å–åˆ°ç•™å­˜å˜ç°çš„å®Œæ•´å¢é•¿è·¯å¾„ã€‚","title":"ç§»åŠ¨åº”ç”¨è¥é”€å¢é•¿é»‘å®¢ï¼šä»0åˆ°100ä¸‡ç”¨æˆ·çš„å®æˆ˜ç­–ç•¥"},{"content":"å¼•è¨€ å¾®ä¿¡å°ç¨‹åºç”Ÿæ€å·²ç»å‘å±•æˆä¸ºä¸€ä¸ªåºå¤§çš„å•†ä¸šä½“ç³»ï¼Œæ—¥æ´»è·ƒç”¨æˆ·è¶…è¿‡7äº¿ï¼Œå°ç¨‹åºæ•°é‡è¶…è¿‡700ä¸‡ã€‚ä»æœ€åˆçš„å·¥å…·ç±»åº”ç”¨åˆ°å¦‚ä»Šçš„å•†ä¸šç»¼åˆä½“ï¼Œå°ç¨‹åºå·²ç»æˆä¸ºä¼ä¸šæ•°å­—åŒ–è½¬å‹çš„å…³é”®ä¸€ç¯ã€‚æœ¬æ–‡å°†æ·±å…¥åˆ†æå¾®ä¿¡å°ç¨‹åºç”Ÿæ€çš„å•†ä¸šé€»è¾‘å’Œè¿è¥ç­–ç•¥ã€‚\nå¾®ä¿¡å°ç¨‹åºç”Ÿæ€æ¦‚è§ˆ ç”Ÿæ€æ•°æ®æ´å¯Ÿ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 // å°ç¨‹åºæ•°æ®åˆ†æç³»ç»Ÿ const MiniProgramAnalytics = { // æ ¸å¿ƒæŒ‡æ ‡ coreMetrics: { // 2024å¹´å¾®ä¿¡å°ç¨‹åºæ•°æ® dau: 7.0, // äº¿ maa: 7.8, // äº¿ totalApps: 7000000, // 700ä¸‡ dailyLaunch: 45000000000, // 450äº¿æ¬¡ avgSessionDuration: 12.5, // åˆ†é’Ÿ userRetention: { day1: 0.25, day7: 0.15, day30: 0.08 } }, // è¡Œä¸šåˆ†å¸ƒ industryDistribution: { \u0026#39;ç”µå•†\u0026#39;: 0.32, \u0026#39;å·¥å…·\u0026#39;: 0.18, \u0026#39;ç”Ÿæ´»æœåŠ¡\u0026#39;: 0.15, \u0026#39;æ•™è‚²\u0026#39;: 0.12, \u0026#39;å¨±ä¹\u0026#39;: 0.10, \u0026#39;å†…å®¹\u0026#39;: 0.08, \u0026#39;å…¶ä»–\u0026#39;: 0.05 }, // å•†ä¸šåŒ–ç¨‹åº¦ monetizationMetrics: { \u0026#39;å¹¿å‘Šæ”¶å…¥\u0026#39;: 1800, // äº¿å…ƒ/å¹´ \u0026#39;ç”µå•†äº¤æ˜“\u0026#39;: 8000, // äº¿å…ƒ/å¹´ \u0026#39;ä»˜è´¹ç”¨æˆ·\u0026#39;: 2.3, // äº¿ \u0026#39;arppu\u0026#39;: 180, // å…ƒ \u0026#39;è½¬åŒ–ç‡\u0026#39;: 0.045 // 4.5% } } ç”Ÿæ€æ¶æ„åˆ†æ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 // å¾®ä¿¡å°ç¨‹åºç”Ÿæ€æ¶æ„å›¾ const EcosystemArchitecture = { layers: { // åŸºç¡€å±‚ \u0026#39;platform\u0026#39;: { \u0026#39;wechat\u0026#39;: \u0026#39;ä¸»å¹³å°\u0026#39;, \u0026#39;ä¼ä¸šå¾®ä¿¡\u0026#39;: \u0026#39;Bç«¯å¹³å°\u0026#39;, \u0026#39;è§†é¢‘å·\u0026#39;: \u0026#39;å†…å®¹å¹³å°\u0026#39;, \u0026#39;å¾®ä¿¡æ”¯ä»˜\u0026#39;: \u0026#39;æ”¯ä»˜å¹³å°\u0026#39; }, // è¿æ¥å±‚ \u0026#39;connections\u0026#39;: { \u0026#39;social\u0026#39;: \u0026#39;ç¤¾äº¤å…³ç³»é“¾\u0026#39;, \u0026#39;payment\u0026#39;: \u0026#39;æ”¯ä»˜é—­ç¯\u0026#39;, \u0026#39;content\u0026#39;: \u0026#39;å†…å®¹åˆ†å‘\u0026#39;, \u0026#39;service\u0026#39;: \u0026#39;æœåŠ¡ç”Ÿæ€\u0026#39; }, // åº”ç”¨å±‚ \u0026#39;applications\u0026#39;: { \u0026#39;official\u0026#39;: \u0026#39;å®˜æ–¹å°ç¨‹åº\u0026#39;, \u0026#39;thirdParty\u0026#39;: \u0026#39;ç¬¬ä¸‰æ–¹å°ç¨‹åº\u0026#39;, \u0026#39;enterprise\u0026#39;: \u0026#39;ä¼ä¸šæœåŠ¡å°ç¨‹åº\u0026#39;, \u0026#39;personal\u0026#39;: \u0026#39;ä¸ªäººå¼€å‘å°ç¨‹åº\u0026#39; }, // å•†ä¸šå±‚ \u0026#39;business\u0026#39;: { \u0026#39;advertising\u0026#39;: \u0026#39;å¹¿å‘Šç³»ç»Ÿ\u0026#39;, \u0026#39;transaction\u0026#39;: \u0026#39;äº¤æ˜“ç³»ç»Ÿ\u0026#39;, \u0026#39;membership\u0026#39;: \u0026#39;ä¼šå‘˜ä½“ç³»\u0026#39;, \u0026#39;data\u0026#39;: \u0026#39;æ•°æ®æœåŠ¡\u0026#39; } } } æµé‡è·å–ç­–ç•¥ ç¤¾äº¤è£‚å˜æœºåˆ¶ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 // ç¤¾äº¤è£‚å˜ç³»ç»Ÿ class SocialFissionSystem { constructor() { this.shareConfig = { // åˆ†äº«å±‚çº§ levels: [ { level: 1, reward: 50, multiplier: 1 }, { level: 2, reward: 30, multiplier: 0.8 }, { level: 3, reward: 20, multiplier: 0.6 }, { level: 4, reward: 10, multiplier: 0.4 }, { level: 5, reward: 5, multiplier: 0.2 } ], // è£‚å˜ç³»æ•° viralCoefficient: 1.2, // è½¬åŒ–ç‡ conversionRate: 0.15, // åˆ†äº«ç‡ shareRate: 0.08 }; } // ç”Ÿæˆåˆ†äº«å†…å®¹ generateShareContent(type, userData) { const templates = { \u0026#39;product\u0026#39;: { title: `${userData.productName} - è¶…å€¼å¥½ç‰©ï¼`, desc: `æˆ‘å‘ç°äº†${userData.productName}ï¼Œ${userData.discount}æŠ˜ä¼˜æƒ ï¼Œå¿«æ¥ä¸€èµ·è´­ä¹°ï¼`, imageUrl: userData.productImage, path: `/pages/product/detail?id=${userData.productId}\u0026amp;shareId=${userData.userId}` }, \u0026#39;invite\u0026#39;: { title: \u0026#39;é‚€è¯·ä½ åŠ å…¥æˆ‘ä»¬\u0026#39;, desc: `ç‚¹å‡»åŠ å…¥ï¼Œæ–°äººä¸“äº«${userData.newUserReward}å…ƒå¤§ç¤¼åŒ…ï¼`, imageUrl: userData.inviteImage, path: `/pages/index?inviter=${userData.inviterId}\u0026amp;scene=invite` }, \u0026#39;achievement\u0026#39;: { title: \u0026#39;æˆ‘åœ¨${userData.appName}è·å¾—äº†${userData.achievement}ï¼\u0026#39;, desc: `å¿«æ¥æŒ‘æˆ˜${userData.achievement}ï¼Œçœ‹çœ‹ä½ èƒ½è¾¾åˆ°ä»€ä¹ˆæ°´å¹³ï¼`, imageUrl: userData.achievementImage, path: `/pages/game/achievement?userId=${userData.userId}` } }; return templates[type] || templates[\u0026#39;invite\u0026#39;]; } // å¤„ç†åˆ†äº«å›è°ƒ handleShare(shareData) { return new Promise((resolve, reject) =\u0026gt; { // è®°å½•åˆ†äº«è¡Œä¸º this.recordShareAction(shareData) .then(() =\u0026gt; { // ç”Ÿæˆåˆ†äº«å¥–åŠ± return this.generateShareReward(shareData); }) .then(reward =\u0026gt; { resolve({ success: true, reward: reward, message: \u0026#39;åˆ†äº«æˆåŠŸï¼Œè·å¾—å¥–åŠ±ï¼\u0026#39; }); }) .catch(error =\u0026gt; { reject({ success: false, error: error.message }); }); }); } // è®°å½•åˆ†äº«åŠ¨ä½œ async recordShareAction(shareData) { const response = await wx.request({ url: \u0026#39;/api/share/record\u0026#39;, method: \u0026#39;POST\u0026#39;, data: { userId: shareData.userId, shareType: shareData.type, shareTime: Date.now(), shareContent: shareData.content } }); return response.data; } // ç”Ÿæˆåˆ†äº«å¥–åŠ± async generateShareReward(shareData) { const baseReward = this.shareConfig.levels[0].reward; const userLevel = await this.getUserShareLevel(shareData.userId); const levelConfig = this.shareConfig.levels[userLevel] || this.shareConfig.levels[4]; const reward = { type: \u0026#39;points\u0026#39;, amount: Math.floor(baseReward * levelConfig.multiplier), description: `åˆ†äº«å¥–åŠ± Lv.${userLevel}` }; // å‘æ”¾å¥–åŠ± await this.issueReward(shareData.userId, reward); return reward; } // è£‚å˜æ•ˆæœåˆ†æ analyzeFission(campaignId) { return new Promise(async (resolve) =\u0026gt; { const response = await wx.request({ url: \u0026#39;/api/analyze/fission\u0026#39;, method: \u0026#39;GET\u0026#39;, data: { campaignId } }); const data = response.data; // è®¡ç®—å…³é”®æŒ‡æ ‡ const analysis = { totalUsers: data.totalUsers, sharedUsers: data.sharedUsers, newUsers: data.newUsers, viralCoefficient: this.calculateViralCoefficient(data), shareRate: data.sharedUsers / data.totalUsers, conversionRate: data.newUsers / data.sharedUsers, costPerAcquisition: data.totalCost / data.newUsers, roi: (data.newUsersRevenue - data.totalCost) / data.totalCost }; resolve(analysis); }); } // è®¡ç®—ç—…æ¯’ç³»æ•° calculateViralCoefficient(data) { // K = i Ã— conv Ã— c const i = data.avgInvitesPerShare; // æ¯æ¬¡åˆ†äº«å¸¦æ¥çš„é‚€è¯·æ•° const conv = data.inviteConversionRate; // é‚€è¯·è½¬åŒ–ç‡ const c = data.shareRate; // åˆ†äº«ç‡ return i * conv * c; } } å†…å®¹è¥é”€ç­–ç•¥ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 174 175 176 177 178 179 180 181 182 183 184 185 186 187 188 189 190 191 192 193 194 195 196 197 198 199 200 201 202 203 204 205 206 207 208 209 210 211 212 213 214 215 216 217 218 219 220 221 222 223 224 225 226 227 228 229 230 231 232 233 234 235 236 237 238 // å†…å®¹è¥é”€ç³»ç»Ÿ class ContentMarketingSystem { constructor() { this.contentTypes = { \u0026#39;article\u0026#39;: \u0026#39;å›¾æ–‡å†…å®¹\u0026#39;, \u0026#39;video\u0026#39;: \u0026#39;è§†é¢‘å†…å®¹\u0026#39;, \u0026#39;audio\u0026#39;: \u0026#39;éŸ³é¢‘å†…å®¹\u0026#39;, \u0026#39;live\u0026#39;: \u0026#39;ç›´æ’­å†…å®¹\u0026#39;, \u0026#39;interactive\u0026#39;: \u0026#39;äº’åŠ¨å†…å®¹\u0026#39; }; this.contentMetrics = { views: 0, shares: 0, likes: 0, comments: 0, conversions: 0, revenue: 0 }; } // åˆ›å»ºå†…å®¹è¥é”€æ´»åŠ¨ createMarketingCampaign(config) { return { id: this.generateCampaignId(), name: config.name, type: config.type, // \u0026#39;video\u0026#39;, \u0026#39;article\u0026#39;, \u0026#39;live\u0026#39;, \u0026#39;interactive\u0026#39; theme: config.theme, duration: config.duration, // æ´»åŠ¨æŒç»­æ—¶é—´ï¼ˆå¤©ï¼‰ budget: config.budget, targetAudience: config.targetAudience, contentPlan: this.generateContentPlan(config), distributionPlan: this.generateDistributionPlan(config), kpi: config.kpi || { views: 100000, shares: 5000, conversions: 1000, revenue: 50000 } }; } // ç”Ÿæˆå†…å®¹è®¡åˆ’ generateContentPlan(config) { const plan = []; switch (config.type) { case \u0026#39;video\u0026#39;: plan.push( { type: \u0026#39;preview\u0026#39;, title: \u0026#39;é¢„å‘Šè§†é¢‘\u0026#39;, duration: 15 }, { type: \u0026#39;main\u0026#39;, title: \u0026#39;ä¸»å†…å®¹\u0026#39;, duration: 300 }, { type: \u0026#39;behind\u0026#39;, title: \u0026#39;å¹•åèŠ±çµ®\u0026#39;, duration: 60 }, { type: \u0026#39;tutorial\u0026#39;, title: \u0026#39;ä½¿ç”¨æ•™ç¨‹\u0026#39;, duration: 120 } ); break; case \u0026#39;article\u0026#39;: plan.push( { type: \u0026#39;headline\u0026#39;, title: \u0026#39;æ ‡é¢˜æ–‡æ¡ˆ\u0026#39;, length: 50 }, { type: \u0026#39;summary\u0026#39;, title: \u0026#39;å†…å®¹æ‘˜è¦\u0026#39;, length: 200 }, { type: \u0026#39;content\u0026#39;, title: \u0026#39;æ­£æ–‡å†…å®¹\u0026#39;, length: 3000 }, { type: \u0026#39;cta\u0026#39;, title: \u0026#39;è¡ŒåŠ¨å·å¬\u0026#39;, length: 100 } ); break; case \u0026#39;live\u0026#39;: plan.push( { type: \u0026#39;announcement\u0026#39;, title: \u0026#39;å¼€æ’­å…¬å‘Š\u0026#39;, time: \u0026#39;3å¤©å‰\u0026#39; }, { type: \u0026#39;warmup\u0026#39;, title: \u0026#39;é¢„çƒ­äº’åŠ¨\u0026#39;, time: \u0026#39;30åˆ†é’Ÿå‰\u0026#39; }, { type: \u0026#39;main\u0026#39;, title: \u0026#39;ç›´æ’­å†…å®¹\u0026#39;, duration: 7200 }, { type: \u0026#39;replay\u0026#39;, title: \u0026#39;ç²¾å½©å›æ”¾\u0026#39;, time: \u0026#39;2å°æ—¶å\u0026#39; } ); break; } return plan; } // ç”Ÿæˆåˆ†å‘è®¡åˆ’ generateDistributionPlan(config) { return { channels: [ { name: \u0026#39;æœ‹å‹åœˆ\u0026#39;, strategy: \u0026#39;user_generated_content\u0026#39;, frequency: \u0026#39;daily\u0026#39;, budget: 0.3 }, { name: \u0026#39;å¾®ä¿¡ç¾¤\u0026#39;, strategy: \u0026#39;community_sharing\u0026#39;, frequency: \u0026#39;weekly\u0026#39;, budget: 0.2 }, { name: \u0026#39;å…¬ä¼—å·\u0026#39;, strategy: \u0026#39;content_promotion\u0026#39;, frequency: \u0026#39;weekly\u0026#39;, budget: 0.2 }, { name: \u0026#39;è§†é¢‘å·\u0026#39;, strategy: \u0026#39;video_distribution\u0026#39;, frequency: \u0026#39;daily\u0026#39;, budget: 0.2 }, { name: \u0026#39;å°ç¨‹åºè·³è½¬\u0026#39;, strategy: \u0026#39;direct_traffic\u0026#39;, frequency: \u0026#39;always\u0026#39;, budget: 0.1 } ], timeline: this.generateTimeline(config.duration) }; } // ç”Ÿæˆæ—¶é—´çº¿ generateTimeline(duration) { const timeline = []; const phases = [ { name: \u0026#39;é¢„çƒ­æœŸ\u0026#39;, duration: Math.floor(duration * 0.2), activities: [\u0026#39;é¢„å‘Šå‘å¸ƒ\u0026#39;, \u0026#39;è¯é¢˜è¥é€ \u0026#39;, \u0026#39;KOLåˆä½œ\u0026#39;] }, { name: \u0026#39;çˆ†å‘æœŸ\u0026#39;, duration: Math.floor(duration * 0.3), activities: [\u0026#39;å†…å®¹å‘å¸ƒ\u0026#39;, \u0026#39;äº’åŠ¨æ´»åŠ¨\u0026#39;, \u0026#39;æ¨å¹¿æŠ•æ”¾\u0026#39;] }, { name: \u0026#39;ç¨³å®šæœŸ\u0026#39;, duration: Math.floor(duration * 0.3), activities: [\u0026#39;æŒç»­æ›´æ–°\u0026#39;, \u0026#39;ç”¨æˆ·ç”Ÿæˆ\u0026#39;, \u0026#39;äºŒæ¬¡ä¼ æ’­\u0026#39;] }, { name: \u0026#39;æ”¶å°¾æœŸ\u0026#39;, duration: Math.floor(duration * 0.2), activities: [\u0026#39;æ€»ç»“å›é¡¾\u0026#39;, \u0026#39;ç”¨æˆ·åé¦ˆ\u0026#39;, \u0026#39;æ•ˆæœè¯„ä¼°\u0026#39;] } ]; let currentDate = 0; phases.forEach(phase =\u0026gt; { timeline.push({ phase: phase.name, startDate: currentDate + 1, endDate: currentDate + phase.duration, activities: phase.activities }); currentDate += phase.duration; }); return timeline; } // å†…å®¹æ•ˆæœè¿½è¸ª trackContentEffect(contentId, metrics) { return new Promise(async (resolve) =\u0026gt; { // è®°å½•å†…å®¹æ•ˆæœ await wx.request({ url: \u0026#39;/api/content/track\u0026#39;, method: \u0026#39;POST\u0026#39;, data: { contentId, timestamp: Date.now(), metrics: { views: metrics.views || 0, shares: metrics.shares || 0, likes: metrics.likes || 0, comments: metrics.comments || 0, conversions: metrics.conversions || 0, revenue: metrics.revenue || 0 } } }); // æ›´æ–°å…¨å±€æŒ‡æ ‡ this.updateGlobalMetrics(metrics); resolve({ success: true, message: \u0026#39;å†…å®¹æ•ˆæœå·²è®°å½•\u0026#39; }); }); } // å†…å®¹ä¼˜åŒ–å»ºè®® getContentOptimization(contentId) { return new Promise(async (resolve) =\u0026gt; { const response = await wx.request({ url: \u0026#39;/api/content/analyze\u0026#39;, method: \u0026#39;GET\u0026#39;, data: { contentId } }); const data = response.data; const suggestions = []; // åŸºäºæ•°æ®åˆ†æç”Ÿæˆä¼˜åŒ–å»ºè®® if (data.engagementRate \u0026lt; 0.02) { suggestions.push({ type: \u0026#39;engagement\u0026#39;, message: \u0026#39;ç”¨æˆ·å‚ä¸åº¦åä½ï¼Œå»ºè®®å¢åŠ äº’åŠ¨å…ƒç´ \u0026#39;, actions: [\u0026#39;æ·»åŠ é—®ç­”ç¯èŠ‚\u0026#39;, \u0026#39;è®¾ç½®æŠ•ç¥¨åŠŸèƒ½\u0026#39;, \u0026#39;é¼“åŠ±ç”¨æˆ·è¯„è®º\u0026#39;] }); } if (data.shareRate \u0026lt; 0.01) { suggestions.push({ type: \u0026#39;share\u0026#39;, message: \u0026#39;åˆ†äº«ç‡åä½ï¼Œéœ€è¦ä¼˜åŒ–åˆ†äº«æ¿€åŠ±\u0026#39;, actions: [\u0026#39;å¢åŠ åˆ†äº«å¥–åŠ±\u0026#39;, \u0026#39;ä¼˜åŒ–åˆ†äº«æ–‡æ¡ˆ\u0026#39;, \u0026#39;åˆ¶ä½œåˆ†äº«æµ·æŠ¥\u0026#39;] }); } if (data.conversionRate \u0026lt; 0.005) { suggestions.push({ type: \u0026#39;conversion\u0026#39;, message: \u0026#39;è½¬åŒ–ç‡åä½ï¼Œéœ€è¦ä¼˜åŒ–è½¬åŒ–è·¯å¾„\u0026#39;, actions: [\u0026#39;ç®€åŒ–è´­ä¹°æµç¨‹\u0026#39;, \u0026#39;å¢åŠ é™æ—¶ä¼˜æƒ \u0026#39;, \u0026#39;ä¼˜åŒ–äº§å“å±•ç¤º\u0026#39;] }); } resolve({ currentMetrics: data, suggestions: suggestions, actionPlan: this.generateActionPlan(suggestions) }); }); } // ç”Ÿæˆè¡ŒåŠ¨è®¡åˆ’ generateActionPlan(suggestions) { const plan = { immediate: [], shortTerm: [], longTerm: [] }; suggestions.forEach(suggestion =\u0026gt; { if (suggestion.type === \u0026#39;engagement\u0026#39;) { plan.immediate.push(...suggestion.actions); } else if (suggestion.type === \u0026#39;share\u0026#39;) { plan.shortTerm.push(...suggestion.actions); } else if (suggestion.type === \u0026#39;conversion\u0026#39;) { plan.longTerm.push(...suggestion.actions); } }); return plan; } } å•†ä¸šå˜ç°æ¨¡å¼ ç”µå•†å˜ç° 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 174 175 176 177 178 179 180 181 182 183 184 185 186 187 188 189 190 191 192 193 194 195 196 197 198 199 200 201 202 203 204 205 206 207 208 209 210 211 212 213 214 215 216 217 218 219 220 221 222 223 224 225 226 227 228 229 230 231 232 233 234 235 236 237 238 239 240 241 242 243 244 245 246 247 248 249 250 251 252 253 254 255 256 257 258 259 260 261 262 263 264 265 266 267 268 269 270 271 272 273 274 275 276 277 278 279 280 281 282 283 284 285 286 287 288 289 290 291 292 293 294 295 296 297 298 299 300 301 302 303 304 305 306 307 308 309 310 311 312 313 314 315 316 317 318 319 320 321 322 323 324 325 326 327 328 329 330 331 332 333 334 335 336 337 338 339 340 341 342 343 344 345 346 347 348 349 350 351 352 353 354 355 356 357 358 359 360 361 362 363 364 365 366 367 368 369 // å°ç¨‹åºç”µå•†ç³»ç»Ÿ class MiniProgramEcommerce { constructor() { this.productCategories = [ \u0026#39;digital\u0026#39;, // æ•°å­—äº§å“ \u0026#39;physical\u0026#39;, // å®ç‰©å•†å“ \u0026#39;service\u0026#39;, // æœåŠ¡ç±» \u0026#39;subscription\u0026#39; // è®¢é˜…åˆ¶ ]; this.salesMetrics = { gmv: 0, // GMVï¼ˆå•†å“äº¤æ˜“æ€»é¢ï¼‰ orders: 0, // è®¢å•æ•° conversionRate: 0, // è½¬åŒ–ç‡ averageOrderValue: 0, // å¹³å‡å®¢å•ä»· repeatPurchaseRate: 0 // å¤è´­ç‡ }; } // å•†å“ç®¡ç† createProduct(productData) { return { id: this.generateProductId(), name: productData.name, description: productData.description, category: productData.category, price: productData.price, originalPrice: productData.originalPrice, images: productData.images, specifications: productData.specifications || [], inventory: productData.inventory, tags: productData.tags || [], status: \u0026#39;active\u0026#39;, createdAt: Date.now(), salesCount: 0, rating: 0, reviews: [] }; } // è®¢å•å¤„ç† async createOrder(orderData) { const order = { id: this.generateOrderId(), userId: orderData.userId, products: orderData.products, totalAmount: this.calculateTotalAmount(orderData.products), shippingAddress: orderData.shippingAddress, paymentMethod: orderData.paymentMethod, status: \u0026#39;pending\u0026#39;, createdAt: Date.now(), estimatedDelivery: this.estimateDeliveryDate() }; // æ‰£å‡åº“å­˜ await this.updateInventory(order.products, -1); // åˆ›å»ºæ”¯ä»˜è®¢å• const paymentResult = await this.createPayment(order); if (paymentResult.success) { order.status = \u0026#39;paid\u0026#39;; order.paidAt = Date.now(); // å‘é€é€šçŸ¥ await this.sendOrderNotification(order); // æ›´æ–°é”€å”®æŒ‡æ ‡ this.updateSalesMetrics(order); } return order; } // è¥é”€æ´»åŠ¨ç®¡ç† createPromotion(promotionData) { return { id: this.generatePromotionId(), name: promotionData.name, type: promotionData.type, // \u0026#39;discount\u0026#39;, \u0026#39;flash_sale\u0026#39;, \u0026#39;group_buy\u0026#39;, \u0026#39;bundle\u0026#39; rules: promotionData.rules, products: promotionData.products, startTime: promotionData.startTime, endTime: promotionData.endTime, status: \u0026#39;draft\u0026#39;, createdAt: Date.now() }; } // é™æ—¶æŠ¢è´­æ´»åŠ¨ createFlashSale(flashSaleData) { const promotion = this.createPromotion({ name: flashSaleData.name, type: \u0026#39;flash_sale\u0026#39;, rules: { discount: flashSaleData.discount, limitedQuantity: flashSaleData.quantity, userLimit: flashSaleData.userLimit || 1, timeLimit: flashSaleData.duration || 1800 // 30åˆ†é’Ÿ }, products: flashSaleData.products, startTime: flashSaleData.startTime, endTime: new Date(flashSaleData.startTime.getTime() + flashSaleData.duration * 1000) }); return { promotion, currentState: { status: \u0026#39;upcoming\u0026#39;, startTime: flashSaleData.startTime, endTime: promotion.endTime, remainingStock: flashSaleData.quantity, participantCount: 0, countdownTimer: this.createCountdownTimer(flashSaleData.startTime, flashSaleData.duration) } }; } // æ‹¼å›¢åŠŸèƒ½ async createGroupBuy(productData) { const groupBuy = { id: this.generateGroupBuyId(), productId: productData.productId, requiredParticipants: productData.requiredParticipants || 3, maxParticipants: productData.maxParticipants || 5, groupPrice: productData.groupPrice, regularPrice: productData.regularPrice, duration: productData.duration || 86400000, // 24å°æ—¶ status: \u0026#39;recruiting\u0026#39;, creatorId: productData.creatorId, participants: [productData.creatorId], createdAt: Date.now(), expiresAt: Date.now() + (productData.duration || 86400000) }; // è®¾ç½®å®šæ—¶å™¨æ£€æŸ¥æ‹¼å›¢çŠ¶æ€ this.setGroupBuyTimer(groupBuy); return groupBuy; } // åŠ å…¥æ‹¼å›¢ async joinGroupBuy(groupBuyId, userId) { const groupBuy = await this.getGroupBuy(groupBuyId); if (!groupBuy) { throw new Error(\u0026#39;æ‹¼å›¢ä¸å­˜åœ¨\u0026#39;); } if (groupBuy.participants.includes(userId)) { throw new Error(\u0026#39;å·²å‚ä¸æ­¤æ‹¼å›¢\u0026#39;); } if (groupBuy.participants.length \u0026gt;= groupBuy.maxParticipants) { throw new Error(\u0026#39;æ‹¼å›¢äººæ•°å·²æ»¡\u0026#39;); } if (Date.now() \u0026gt; groupBuy.expiresAt) { throw new Error(\u0026#39;æ‹¼å›¢å·²è¿‡æœŸ\u0026#39;); } groupBuy.participants.push(userId); // æ£€æŸ¥æ˜¯å¦æˆå›¢ if (groupBuy.participants.length \u0026gt;= groupBuy.requiredParticipants) { groupBuy.status = \u0026#39;success\u0026#39;; await this.processSuccessfulGroupBuy(groupBuy); } // æ›´æ–°æ‹¼å›¢çŠ¶æ€ await this.updateGroupBuy(groupBuy); return { success: true, groupBuy: groupBuy, isSuccessful: groupBuy.status === \u0026#39;success\u0026#39; }; } // è®¢é˜…åˆ¶æœåŠ¡ createSubscription(subscriptionData) { return { id: this.generateSubscriptionId(), name: subscriptionData.name, type: subscriptionData.type, // \u0026#39;monthly\u0026#39;, \u0026#39;quarterly\u0026#39;, \u0026#39;yearly\u0026#39; price: subscriptionData.price, benefits: subscriptionData.benefits, billingCycle: this.getBillingCycle(subscriptionData.type), trialPeriod: subscriptionData.trialPeriod || 0, autoRenew: subscriptionData.autoRenew || true, createdAt: Date.now() }; } // ä¼šå‘˜æƒç›Šç®¡ç† createMembershipPlan(planData) { const plan = { id: this.generateMembershipId(), name: planData.name, tier: planData.tier, // \u0026#39;bronze\u0026#39;, \u0026#39;silver\u0026#39;, \u0026#39;gold\u0026#39;, \u0026#39;diamond\u0026#39; price: planData.price, duration: planData.duration, // 30, 90, 365 å¤© benefits: planData.benefits, privileges: planData.privileges, exclusiveProducts: planData.exclusiveProducts || [], discountRate: planData.discountRate || 0, createdAt: Date.now() }; return plan; } // é”€å”®æ•°æ®åˆ†æ analyzeSales(timeRange) { return new Promise(async (resolve) =\u0026gt; { const response = await wx.request({ url: \u0026#39;/api/ecommerce/sales/analyze\u0026#39;, method: \u0026#39;GET\u0026#39;, data: { startDate: timeRange.startDate, endDate: timeRange.endDate } }); const data = response.data; const analysis = { overview: { totalGMV: data.totalGMV, totalOrders: data.totalOrders, averageOrderValue: data.totalGMV / data.totalOrders, conversionRate: data.conversions / data.visitors }, categories: this.analyzeByCategory(data.categorySales), products: this.analyzeTopProducts(data.productSales), customers: this.analyzeCustomerBehavior(data.customerData), trends: this.analyzeSalesTrends(data.salesTrends) }; resolve(analysis); }); } // æ™ºèƒ½æ¨èç³»ç»Ÿ getRecommendations(userId, context) { return new Promise(async (resolve) =\u0026gt; { // è·å–ç”¨æˆ·å†å²è¡Œä¸º const userBehavior = await this.getUserBehavior(userId); // è·å–å½“å‰ä¸Šä¸‹æ–‡ const currentContext = { currentPage: context.page, currentCategory: context.category, timeOfDay: new Date().getHours(), deviceType: context.deviceType }; // ååŒè¿‡æ»¤æ¨è const collaborativeResults = await this.collaborativeFiltering(userId); // å†…å®¹æ¨è const contentResults = await this.contentBasedFiltering(userBehavior, currentContext); // æ··åˆæ¨èç»“æœ const recommendations = this.combineRecommendations( collaborativeResults, contentResults, context.strategy || \u0026#39;hybrid\u0026#39; ); resolve({ products: recommendations.slice(0, 10), strategy: context.strategy, reasoning: recommendations.map(item =\u0026gt; item.reasoning), personalizedScore: recommendations.map(item =\u0026gt; item.score) }); }); } // ååŒè¿‡æ»¤ç®—æ³• async collaborativeFiltering(userId) { const userVector = await this.getUserVector(userId); const similarUsers = await this.findSimilarUsers(userVector); const recommendations = []; for (const similarUser of similarUsers) { const userProducts = await this.getUserPurchases(similarUser.userId); for (const product of userProducts) { if (!userVector.products.includes(product.productId)) { recommendations.push({ productId: product.productId, score: similarUser.similarity * product.rating, reason: \u0026#39;similar_users_like\u0026#39; }); } } } return recommendations .sort((a, b) =\u0026gt; b.score - a.score) .slice(0, 50); } // åŸºäºå†…å®¹çš„æ¨è async contentBasedFiltering(userBehavior, context) { const userPreferences = this.extractUserPreferences(userBehavior); const contextualPreferences = this.extractContextualPreferences(context); const recommendations = []; // åŒ¹é…ç”¨æˆ·åå¥½ for (const preference of userPreferences) { const matchingProducts = await this.findProductsByPreference(preference); for (const product of matchingProducts) { recommendations.push({ productId: product.id, score: preference.weight * product.matchScore, reason: \u0026#39;matches_your_preferences\u0026#39; }); } } return recommendations .sort((a, b) =\u0026gt; b.score - a.score) .slice(0, 50); } // ç”Ÿæˆç”¨æˆ·ç”»åƒ generateUserProfile(userId) { return new Promise(async (resolve) =\u0026gt; { const userData = await Promise.all([ this.getUserDemographics(userId), this.getUserBehavior(userId), this.getUserPurchaseHistory(userId), this.getUserInterests(userId) ]); const [demographics, behavior, purchases, interests] = userData; const profile = { userId, demographics: demographics, behavior: { visitFrequency: behavior.visitFrequency, averageSession: behavior.averageSession, preferredCategories: behavior.categories, activityTimeSlots: behavior.timeSlots }, purchasing: { totalSpent: purchases.totalSpent, averageOrderValue: purchases.averageOrderValue, purchaseFrequency: purchases.frequency, preferredPriceRange: purchases.priceRange, brandPreferences: purchases.brands }, interests: interests, segments: this.segmentUser(demographics, behavior, purchases), predictions: { nextPurchaseDate: this.predictNextPurchase(purchases), likelyChurn: this.predictChurn(behavior), priceSensitivity: this.calculatePriceSensitivity(purchases) } }; resolve(profile); }); } } ç”¨æˆ·è¿è¥ä½“ç³» ç”¨æˆ·ç”Ÿå‘½å‘¨æœŸç®¡ç† 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 174 175 176 177 178 179 180 181 182 183 184 185 186 187 188 189 190 191 192 193 194 195 196 197 198 199 200 201 202 203 204 205 206 207 208 209 210 211 212 213 214 215 216 217 218 219 220 221 222 223 224 225 226 227 228 229 230 231 232 233 234 235 236 237 238 239 240 241 242 243 244 245 246 247 248 249 250 251 252 253 254 255 256 257 258 259 260 261 262 263 264 265 266 267 268 269 270 271 272 273 274 275 276 277 278 279 280 281 282 283 284 285 286 287 288 289 290 291 292 293 294 295 296 297 298 299 300 301 302 303 304 305 306 307 // ç”¨æˆ·ç”Ÿå‘½å‘¨æœŸç®¡ç†ç³»ç»Ÿ class UserLifecycleManager { constructor() { this.lifecycleStages = [ { name: \u0026#39;new\u0026#39;, duration: 7, retention: 0.8 }, { name: \u0026#39;active\u0026#39;, duration: 30, retention: 0.6 }, { name: \u0026#39;loyal\u0026#39;, duration: 90, retention: 0.8 }, { name: \u0026#39;at_risk\u0026#39;, duration: 30, retention: 0.4 }, { name: \u0026#39;dormant\u0026#39;, duration: 90, retention: 0.1 }, { name: \u0026#39;churned\u0026#39;, duration: 0, retention: 0 } ]; this.segmentRules = { \u0026#39;new_user\u0026#39;: { triggers: [\u0026#39;first_visit\u0026#39;], actions: [\u0026#39;welcome_series\u0026#39;, \u0026#39;onboarding_tutorial\u0026#39;, \u0026#39;new_user_reward\u0026#39;] }, \u0026#39;active_user\u0026#39;: { triggers: [\u0026#39;regular_usage\u0026#39;, \u0026#39;purchase_made\u0026#39;], actions: [\u0026#39;personalized_recommendations\u0026#39;, \u0026#39;loyalty_points\u0026#39;, \u0026#39;exclusive_content\u0026#39;] }, \u0026#39;at_risk_user\u0026#39;: { triggers: [\u0026#39;decreasing_activity\u0026#39;, \u0026#39;no_purchase_30_days\u0026#39;], actions: [\u0026#39;re_engagement_campaign\u0026#39;, \u0026#39;special_offers\u0026#39;, \u0026#39;support_reach_out\u0026#39;] }, \u0026#39;loyal_user\u0026#39;: { triggers: [\u0026#39;repeat_purchases\u0026#39;, \u0026#39;high_engagement\u0026#39;], actions: [\u0026#39;vip_program\u0026#39;, \u0026#39;early_access\u0026#39;, \u0026#39;referral_rewards\u0026#39;] } }; } // ç”¨æˆ·åˆ†æ®µ segmentUsers() { return new Promise(async (resolve) =\u0026gt; { const response = await wx.request({ url: \u0026#39;/api/users/segment\u0026#39;, method: \u0026#39;POST\u0026#39;, data: { criteria: { \u0026#39;lastLogin\u0026#39;: \u0026#39;7_days\u0026#39;, \u0026#39;purchaseHistory\u0026#39;: \u0026#39;30_days\u0026#39;, \u0026#39;activityLevel\u0026#39;: \u0026#39;high\u0026#39; } } }); const segments = { \u0026#39;new_users\u0026#39;: [], \u0026#39;active_users\u0026#39;: [], \u0026#39;at_risk_users\u0026#39;: [], \u0026#39;loyal_users\u0026#39;: [], \u0026#39;dormant_users\u0026#39;: [], \u0026#39;churned_users\u0026#39;: [] }; response.data.forEach(user =\u0026gt; { const segment = this.determineUserSegment(user); if (segments[segment]) { segments[segment].push(user); } }); // ä¸ºæ¯ä¸ªåˆ†æ®µç”Ÿæˆè¿è¥ç­–ç•¥ const segmentStrategies = {}; Object.keys(segments).forEach(segment =\u0026gt; { segmentStrategies[segment] = this.generateSegmentStrategy(segment, segments[segment]); }); resolve({ segments, strategies: segmentStrategies, summary: this.generateSegmentSummary(segments) }; }); } // ç¡®å®šç”¨æˆ·åˆ†æ®µ determineUserSegment(user) { const now = Date.now(); const daysSinceLastLogin = Math.floor((now - user.lastLoginTime) / (1000 * 60 * 60 * 24)); const daysSinceLastPurchase = Math.floor((now - user.lastPurchaseTime) / (1000 * 60 * 60 * 24)); if (daysSinceLastLogin \u0026gt; 90) { return \u0026#39;dormant_users\u0026#39;; } if (daysSinceLastLogin \u0026gt; 30 \u0026amp;\u0026amp; user.totalPurchases === 0) { return \u0026#39;at_risk_users\u0026#39;; } if (user.totalPurchases === 0 \u0026amp;\u0026amp; daysSinceLastLogin \u0026lt; 7) { return \u0026#39;new_users\u0026#39;; } if (user.totalPurchases \u0026gt; 5 \u0026amp;\u0026amp; daysSinceLastPurchase \u0026lt; 30) { return \u0026#39;loyal_users\u0026#39;; } if (daysSinceLastLogin \u0026lt; 7) { return \u0026#39;active_users\u0026#39;; } return \u0026#39;active_users\u0026#39;; } // ç”Ÿæˆåˆ†æ®µç­–ç•¥ generateSegmentStrategy(segment, users) { const strategies = { \u0026#39;new_users\u0026#39;: { goal: \u0026#39;æå‡7æ—¥ç•™å­˜ç‡\u0026#39;, tactics: [ \u0026#39;å‘é€æ–°æ‰‹å¼•å¯¼æ¶ˆæ¯\u0026#39;, \u0026#39;æä¾›é¦–å•ä¼˜æƒ \u0026#39;, \u0026#39;æ¨é€ä½¿ç”¨æ•™ç¨‹\u0026#39;, \u0026#39;é‚€è¯·å‚ä¸ç¤¾åŒºæ´»åŠ¨\u0026#39; ], metrics: { retention_7d: 0.8, conversion_rate: 0.15, engagement_score: 60 } }, \u0026#39;active_users\u0026#39;: { goal: \u0026#39;æå‡å¤è´­ç‡\u0026#39;, tactics: [ \u0026#39;ä¸ªæ€§åŒ–æ¨è\u0026#39;, \u0026#39;ä¼šå‘˜ç§¯åˆ†æ¿€åŠ±\u0026#39;, \u0026#39;é™æ—¶ä¼˜æƒ æ¨é€\u0026#39;, \u0026#39;ç”¨æˆ·ç”Ÿæˆå†…å®¹æ¿€åŠ±\u0026#39; ], metrics: { repeat_purchase_rate: 0.3, average_order_value: 200, engagement_score: 80 } }, \u0026#39;at_risk_users\u0026#39;: { goal: \u0026#39;é˜²æ­¢ç”¨æˆ·æµå¤±\u0026#39;, tactics: [ \u0026#39;å¬å›è¥é”€æ´»åŠ¨\u0026#39;, \u0026#39;ä¸ªæ€§åŒ–ä¼˜æƒ \u0026#39;, \u0026#39;å®¢æˆ·å…³æ€€å›è®¿\u0026#39;, \u0026#39;äº§å“ä½¿ç”¨æŒ‡å¯¼\u0026#39; ], metrics: { reactivation_rate: 0.25, retention_30d: 0.5, churn_rate: 0.1 } }, \u0026#39;loyal_users\u0026#39;: { goal: \u0026#39;æå‡ç”¨æˆ·ä»·å€¼\u0026#39;, tactics: [ \u0026#39;VIPä¸“å±æœåŠ¡\u0026#39;, \u0026#39;æ–°å“ä¼˜å…ˆä½“éªŒ\u0026#39;, \u0026#39;ä¸“å±æŠ˜æ‰£ä¼˜æƒ \u0026#39;, \u0026#39;å£ç¢‘ä¼ æ’­æ¿€åŠ±\u0026#39; ], metrics: { average_order_value: 500, referral_count: 3, lifetime_value: 5000 } } }; return strategies[segment] || strategies[\u0026#39;active_users\u0026#39;]; } // ç”¨æˆ·ç•™å­˜ç­–ç•¥ implementRetentionStrategy(userId) { return new Promise(async (resolve) =\u0026gt; { const user = await this.getUserData(userId); const segment = this.determineUserSegment(user); const strategy = this.segmentRules[`segment.replace(\u0026#39;_users\u0026#39;, \u0026#39;_user\u0026#39;)`]; const actions = []; if (strategy) { for (const action of strategy.actions) { actions.push(await this.executeAction(action, user)); } } resolve({ userId, segment, actions: actions, nextCheckTime: this.calculateNextCheckTime(segment) }); }); } // ä¸ªæ€§åŒ–è¥é”€ personalizeMarketing(userId) { return new Promise(async (resolve) =\u0026gt; { const userProfile = await this.generateUserProfile(userId); const personalization = { productRecommendations: await this.getPersonalizedProducts(userProfile), contentRecommendations: await this.getPersonalizedContent(userProfile), personalizedOffers: await this.createPersonalizedOffers(userProfile), preferredChannels: userProfile.behavior.preferredChannels, optimalSendTime: this.calculateOptimalSendTime(userProfile), messageTone: this.determineMessageTone(userProfile) }; resolve(personalization); }); } // ç”¨æˆ·ç§¯åˆ†ç³»ç»Ÿ createPointsSystem() { return { rules: { \u0026#39;daily_login\u0026#39;: { points: 10, maxDaily: 1 }, \u0026#39;first_purchase\u0026#39;: { points: 100, maxTotal: 1 }, \u0026#39;product_review\u0026#39;: { points: 20, maxDaily: 3 }, \u0026#39;friend_invite\u0026#39;: { points: 50, maxTotal: 10 }, \u0026#39;content_share\u0026#39;: { points: 5, maxDaily: 5 }, \u0026#39;complete_profile\u0026#39;: { points: 30, maxTotal: 1 } }, rewards: { 100: { type: \u0026#39;discount\u0026#39;, value: 10, description: \u0026#39;10å…ƒä¼˜æƒ åˆ¸\u0026#39; }, 500: { type: \u0026#39;gift\u0026#39;, value: \u0026#39;sample\u0026#39;, description: \u0026#39;ç²¾ç¾ç¤¼å“\u0026#39; }, 1000: { type: \u0026#39;vip\u0026#39;, value: \u0026#39;1_month\u0026#39;, description: \u0026#39;VIPä¼šå‘˜1ä¸ªæœˆ\u0026#39; }, 5000: { type: \u0026#39;cashback\u0026#39;, value: 50, description: \u0026#39;50å…ƒè¿”ç°\u0026#39; } }, levels: [ { level: 1, name: \u0026#39;é“œç‰Œ\u0026#39;, points: 0, benefits: [\u0026#39;åŸºç¡€ç§¯åˆ†\u0026#39;] }, { level: 2, name: \u0026#39;é“¶ç‰Œ\u0026#39;, points: 1000, benefits: [\u0026#39;åŒå€ç§¯åˆ†\u0026#39;, \u0026#39;ä¸“å±ä¼˜æƒ \u0026#39;] }, { level: 3, name: \u0026#39;é‡‘ç‰Œ\u0026#39;, points: 5000, benefits: [\u0026#39;ä¸‰å€ç§¯åˆ†\u0026#39;, \u0026#39;ç”Ÿæ—¥ç¤¼åŒ…\u0026#39;, \u0026#39;ä¸“å±å®¢æœ\u0026#39;] }, { level: 4, name: \u0026#39;é’»çŸ³\u0026#39;, points: 20000, benefits: [\u0026#39;äº”å€ç§¯åˆ†\u0026#39;, \u0026#39;å®šåˆ¶æœåŠ¡\u0026#39;, \u0026#39;æ–°å“è¯•ç©¿\u0026#39;] } ] }; } // ç¤¾ç¾¤è¿è¥ createCommunityGroup(groupData) { return { id: this.generateGroupId(), name: groupData.name, type: groupData.type, // \u0026#39;interest\u0026#39;, \u0026#39;location\u0026#39;, \u0026#39;purchase_based\u0026#39;, \u0026#39;vip\u0026#39; description: groupData.description, rules: groupData.rules || [], moderators: groupData.moderators || [], members: [groupData.creatorId], activities: { daily_checkin: true, weekly_topic: true, monthly_event: true, exclusive_deals: true }, createdAt: Date.now() }; } // ç¤¾ç¾¤æ´»åŠ¨ç®¡ç† manageCommunityActivities(groupId) { return { activities: [ { type: \u0026#39;check_in\u0026#39;, name: \u0026#39;æ¯æ—¥ç­¾åˆ°\u0026#39;, points: 5, frequency: \u0026#39;daily\u0026#39;, startTime: \u0026#39;09:00\u0026#39;, endTime: \u0026#39;23:59\u0026#39; }, { type: \u0026#39;discussion\u0026#39;, name: \u0026#39;è¯é¢˜è®¨è®º\u0026#39;, points: 10, frequency: \u0026#39;weekly\u0026#39;, topic: \u0026#39;æœ¬å‘¨æœ€çƒ­é—¨å•†å“\u0026#39; }, { type: \u0026#39;sharing\u0026#39;, name: \u0026#39;å¥½ç‰©åˆ†äº«\u0026#39;, points: 15, frequency: \u0026#39;weekly\u0026#39;, requirements: [\u0026#39;verified_purchase\u0026#39;, \u0026#39;product_photos\u0026#39;] }, { type: \u0026#39;contest\u0026#39;, name: \u0026#39;è¯„é€‰æ´»åŠ¨\u0026#39;, points: 50, frequency: \u0026#39;monthly\u0026#39;, prize: \u0026#39;ä»·å€¼500å…ƒå¤§å¥–\u0026#39; } ], mechanics: { \u0026#39;participation\u0026#39;: \u0026#39;points-based\u0026#39;, \u0026#39;ranking\u0026#39;: \u0026#39;leaderboard\u0026#39;, \u0026#39;recognition\u0026#39;: \u0026#39;badges_system\u0026#39;, \u0026#39;reward_distribution\u0026#39;: \u0026#39;automatic\u0026#39; } }; } } æ•°æ®åˆ†æä¸ä¼˜åŒ– å…¨é“¾è·¯æ•°æ®åˆ†æ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 174 175 176 177 178 179 180 181 182 183 184 185 186 187 188 189 190 191 192 193 194 195 196 197 198 199 200 201 202 203 204 205 206 207 208 209 210 211 212 213 214 215 216 217 218 219 220 221 222 223 224 225 226 227 228 229 230 231 232 233 234 235 236 237 238 239 240 241 242 243 244 245 246 247 248 249 250 251 252 253 254 255 256 257 258 259 260 261 262 263 264 265 266 267 268 269 270 271 272 273 274 275 276 277 278 279 280 281 282 283 284 285 286 287 288 289 290 291 292 293 294 295 296 297 298 299 300 301 302 303 304 305 306 307 308 309 310 311 312 313 314 315 316 317 318 319 320 321 322 323 324 325 326 327 328 329 330 331 332 333 334 335 336 337 338 339 340 341 342 343 344 345 346 347 348 349 350 351 352 353 354 355 356 357 358 359 360 361 362 363 364 365 366 367 368 369 370 371 372 373 374 375 376 377 378 379 380 381 382 383 384 385 386 387 388 389 390 391 // å°ç¨‹åºæ•°æ®åˆ†æç³»ç»Ÿ class MiniProgramAnalytics { constructor() { this.dataSources = { \u0026#39;user_behavior\u0026#39;: \u0026#39;/api/analytics/user_behavior\u0026#39;, \u0026#39;content_performance\u0026#39;: \u0026#39;/api/analytics/content\u0026#39;, \u0026#39;conversion_funnel\u0026#39;: \u0026#39;/api/analytics/conversion\u0026#39;, \u0026#39;retention_analysis\u0026#39;: \u0026#39;/api/analytics/retention\u0026#39;, \u0026#39;revenue_analysis\u0026#39;: \u0026#39;/api/analytics/revenue\u0026#39; }; this.kpiDefinitions = { \u0026#39;mau\u0026#39;: \u0026#39;æœˆæ´»è·ƒç”¨æˆ·æ•°\u0026#39;, \u0026#39;dau\u0026#39;: \u0026#39;æ—¥æ´»è·ƒç”¨æˆ·æ•°\u0026#39;, \u0026#39;retention\u0026#39;: \u0026#39;ç”¨æˆ·ç•™å­˜ç‡\u0026#39;, \u0026#39;ltv\u0026#39;: \u0026#39;ç”¨æˆ·ç”Ÿå‘½å‘¨æœŸä»·å€¼\u0026#39;, \u0026#39;cac\u0026#39;: \u0026#39;ç”¨æˆ·è·å–æˆæœ¬\u0026#39;, \u0026#39;arpu\u0026#39;: \u0026#39;æ¯ç”¨æˆ·å¹³å‡æ”¶å…¥\u0026#39;, \u0026#39;conversion_rate\u0026#39;: \u0026#39;è½¬åŒ–ç‡\u0026#39; }; } // æ„å»ºæ•°æ®çœ‹æ¿ buildDashboard(timeRange) { return new Promise(async (resolve) =\u0026gt; { const [ userMetrics, contentMetrics, conversionMetrics, retentionMetrics, revenueMetrics ] = await Promise.all([ this.getUserMetrics(timeRange), this.getContentMetrics(timeRange), this.getConversionMetrics(timeRange), this.getRetentionMetrics(timeRange), this.getRevenueMetrics(timeRange) ]); const dashboard = { overview: { totalUsers: userMetrics.totalUsers, activeUsers: userMetrics.activeUsers, totalRevenue: revenueMetrics.totalRevenue, averageOrderValue: revenueMetrics.averageOrderValue, conversionRate: conversionMetrics.overall }, trends: { userGrowth: this.calculateGrowthRate(userMetrics.userGrowth), revenueGrowth: this.calculateGrowthRate(revenueMetrics.revenueGrowth), engagementTrend: this.analyzeEngagementTrend(userMetrics.engagement), seasonality: this.detectSeasonalityPatterns(revenueMetrics.salesData) }, funnels: { acquisition: this.buildFunnel(conversionMetrics.acquisition), activation: this.buildFunnel(conversionMetrics.activation), retention: this.buildFunnel(retentionMetrics.retention), revenue: this.buildFunnel(conversionMetrics.revenue) }, segments: { userSegments: this.analyzeUserSegments(userMetrics.segments), contentSegments: this.analyzeContentSegments(contentMetrics.segments), productSegments: this.analyzeProductSegments(revenueMetrics.segments) }, predictions: { nextMonthRevenue: this.predictRevenue(revenueMetrics.historical), churnRate: this.predictChurnRate(retentionMetrics.behavior), growthPotential: this.predictGrowthPotential(userMetrics.newUsers) }, recommendations: this.generateOptimizationRecommendations({ userMetrics, contentMetrics, conversionMetrics, retentionMetrics, revenueMetrics }) }; resolve(dashboard); }); } // ç”¨æˆ·è¡Œä¸ºåˆ†æ analyzeUserBehavior(userId) { return new Promise(async (resolve) =\u0026gt; { const response = await wx.request({ url: \u0026#39;/api/analytics/user_behavior/detail\u0026#39;, method: \u0026#39;GET\u0026#39;, data: { userId } }); const data = response.data; const behaviorAnalysis = { profile: { registrationDate: data.registrationDate, totalSessions: data.totalSessions, sessionDuration: this.analyzeSessionDuration(data.sessions), deviceUsage: data.deviceUsage, timePatterns: data.timePatterns }, engagement: { pagesVisited: data.pagesVisited, averageTimeOnPage: data.averageTimeOnPage, bounceRate: data.bounceRate, interactionRate: this.calculateInteractionRate(data.interactions), socialSharing: data.socialSharing }, preferences: { favoriteCategories: data.favoriteCategories, preferredContentTypes: data.preferredContentTypes, purchaseBehavior: data.purchaseBehavior, communicationPreferences: data.communicationPreferences }, journey: { firstSessionPath: data.firstSessionPath, commonPaths: this.identifyCommonPaths(data.sessions), dropOffPoints: this.identifyDropOffPoints(data.sessions), conversionEvents: data.conversionEvents }, predictions: { likelihoodToChurn: this.predictChurnLikelihood(data), likelyNextAction: this.predictNextAction(data), recommendedContent: this.recommendNextContent(data), optimalOfferTiming: this.calculateOptimalOfferTiming(data) } }; resolve(behaviorAnalysis); }); } // å†…å®¹æ•ˆæœåˆ†æ analyzeContentEffect(contentId) { return new Promise(async (resolve) =\u0026gt; { const response = await wx.request({ url: \u0026#39;/api/analytics/content/performance\u0026#39;, method: \u0026#39;GET\u0026#39;, data: { contentId } }); const data = response.data; const contentAnalysis = { metrics: { views: data.views, shares: data.shares, likes: data.likes, comments: data.comments, dwellTime: data.averageDwellTime, bounceRate: data.bounceRate, conversionRate: data.conversionRate }, demographics: { ageDistribution: data.ageDistribution, genderDistribution: data.genderDistribution, regionDistribution: data.regionDistribution, deviceDistribution: data.deviceDistribution }, viral: { viralCoefficient: this.calculateViralCoefficient(data), shareNetwork: data.shareNetwork, referralTraffic: data.referralTraffic, organicReach: data.organicReach }, comparison: { industryBenchmarks: data.benchmarks, percentileRanking: data.percentileRanking, improvementSuggestions: this.generateContentSuggestions(data) }, optimization: { bestPerformingTime: data.bestPerformingTime, optimalLength: data.optimalLength, effectiveKeywords: data.effectiveKeywords, mostEngagingElements: data.mostEngagingElements } }; resolve(contentAnalysis); }); } // å®æ—¶ç›‘æ§å‘Šè­¦ setupRealTimeMonitoring() { const monitoring = { metrics: { \u0026#39;active_users\u0026#39;: { threshold: -0.1, alert: \u0026#39;active_users_drop\u0026#39; }, \u0026#39;error_rate\u0026#39;: { threshold: 0.05, alert: \u0026#39;error_rate_increase\u0026#39; }, \u0026#39;conversion_rate\u0026#39;: { threshold: -0.2, alert: \u0026#39;conversion_drop\u0026#39; }, \u0026#39;response_time\u0026#39;: { threshold: 3000, alert: \u0026#39;performance_degradation\u0026#39; } }, alerts: [], startMonitoring: () =\u0026gt; { setInterval(() =\u0026gt; { this.checkMetrics(monitoring.metrics); }, 60000); // æ¯åˆ†é’Ÿæ£€æŸ¥ä¸€æ¬¡ }, checkMetrics: async (metrics) =\u0026gt; { const currentMetrics = await this.getCurrentMetrics(); for (const [metric, config] of Object.entries(metrics)) { const currentValue = currentMetrics[metric]; const previousValue = currentMetrics[`${metric}_previous`]; if (previousValue) { const change = (currentValue - previousValue) / previousValue; if (config.threshold \u0026gt; 0 \u0026amp;\u0026amp; change \u0026gt; config.threshold) { monitoring.alerts.push({ type: config.alert, metric, currentValue, change, timestamp: Date.now(), severity: this.calculateSeverity(change) }); } else if (config.threshold \u0026lt; 0 \u0026amp;\u0026amp; change \u0026lt; config.threshold) { monitoring.alerts.push({ type: config.alert, metric, currentValue, change, timestamp: Date.now(), severity: this.calculateSeverity(change) }); } } } if (monitoring.alerts.length \u0026gt; 0) { this.sendAlert(monitoring.alerts); } } }; monitoring.startMonitoring(); return monitoring; } // A/Bæµ‹è¯•åˆ†æ analyzeABTest(testId) { return new Promise(async (resolve) =\u0026gt; { const response = await wx.request({ url: \u0026#39;/api/abtest/analyze\u0026#39;, method: \u0026#39;GET\u0026#39;, data: { testId } }); const data = response.data; const analysis = { testInfo: { name: data.testName, description: data.description, startDate: data.startDate, endDate: data.endDate, variants: data.variants }, results: { variants: data.variants.map(variant =\u0026gt; ({ id: variant.id, name: variant.name, users: variant.users, conversions: variant.conversions, conversionRate: variant.conversions / variant.users, revenue: variant.revenue, averageOrderValue: variant.revenue / variant.conversions })) }, statistics: { significance: this.calculateStatisticalSignificance(data), confidence: data.confidenceLevel, sampleSize: data.totalUsers, duration: data.testDuration }, winner: { declared: data.winningVariant, confidence: data.winningConfidence, improvement: data.improvementPercentage, revenueImpact: data.revenueImpact }, insights: { userPreferences: data.userSegmentPreferences, behavioralInsights: data.behavioralInsights, learningTakeaways: data.learningTakeaways } }; resolve(analysis); }); } // ä¼˜åŒ–å»ºè®®ç”Ÿæˆå™¨ generateOptimizationRecommendations(metrics) { const recommendations = []; // ç”¨æˆ·å¢é•¿å»ºè®® if (metrics.userMetrics.activeUsers \u0026lt; this.getIndustryBenchmark(\u0026#39;active_users\u0026#39;)) { recommendations.push({ category: \u0026#39;user_growth\u0026#39;, priority: \u0026#39;high\u0026#39;, issue: \u0026#39;æ´»è·ƒç”¨æˆ·æ•°ä½äºè¡Œä¸šåŸºå‡†\u0026#39;, suggestions: [ \u0026#39;ä¼˜åŒ–ç”¨æˆ·å¼•å¯¼æµç¨‹\u0026#39;, \u0026#39;å¢åŠ ç¤¾äº¤åˆ†äº«æ¿€åŠ±\u0026#39;, \u0026#39;å®æ–½æ¨èç³»ç»Ÿä¼˜åŒ–\u0026#39;, \u0026#39;å¼€å±•ç”¨æˆ·å¬å›æ´»åŠ¨\u0026#39; ], expectedImpact: \u0026#39;20-30% DAUæå‡\u0026#39;, implementationTime: \u0026#39;2-4å‘¨\u0026#39; }); } // è½¬åŒ–ç‡å»ºè®® if (metrics.conversionMetrics.overall \u0026lt; 0.02) { recommendations.push({ category: \u0026#39;conversion\u0026#39;, priority: \u0026#39;high\u0026#39;, issue: \u0026#39;è½¬åŒ–ç‡ä½äº2%\u0026#39;, suggestions: [ \u0026#39;ä¼˜åŒ–äº§å“è¯¦æƒ…é¡µ\u0026#39;, \u0026#39;ç®€åŒ–è´­ä¹°æµç¨‹\u0026#39;, \u0026#39;å¢åŠ ä¿¡ä»»è¦ç´ \u0026#39;, \u0026#39;å®æ–½A/Bæµ‹è¯•ä¼˜åŒ–\u0026#39; ], expectedImpact: \u0026#39;50-100% è½¬åŒ–ç‡æå‡\u0026#39;, implementationTime: \u0026#39;1-2å‘¨\u0026#39; }); } // ç•™å­˜ç‡å»ºè®® if (metrics.retentionMetrics.day7 \u0026lt; 0.15) { recommendations.push({ category: \u0026#39;retention\u0026#39;, priority: \u0026#39;medium\u0026#39;, issue: \u0026#39;7æ—¥ç•™å­˜ç‡ä½äº15%\u0026#39;, suggestions: [ \u0026#39;è®¾è®¡æ–°æ‰‹å¼•å¯¼æµç¨‹\u0026#39;, \u0026#39;å®æ–½ç§¯åˆ†æ¿€åŠ±æœºåˆ¶\u0026#39;, \u0026#39;å»ºç«‹ç”¨æˆ·ç¤¾ç¾¤\u0026#39;, \u0026#39;ä¸ªæ€§åŒ–å†…å®¹æ¨è\u0026#39; ], expectedImpact: \u0026#39;10-20% ç•™å­˜ç‡æå‡\u0026#39;, implementationTime: \u0026#39;3-6å‘¨\u0026#39; }); } // æ”¶å…¥å»ºè®® if (metrics.revenueMetrics.averageOrderValue \u0026lt; 150) { recommendations.push({ category: \u0026#39;revenue\u0026#39;, priority: \u0026#39;medium\u0026#39;, issue: \u0026#39;å®¢å•ä»·åä½\u0026#39;, suggestions: [ \u0026#39;æ¨å‡ºå¥—é¤ä¼˜æƒ \u0026#39;, \u0026#39;å®æ–½äº¤å‰é”€å”®\u0026#39;, \u0026#39;å¢åŠ é™„åŠ æœåŠ¡\u0026#39;, \u0026#39;æé«˜äº§å“ä»·æ ¼\u0026#39; ], expectedImpact: \u0026#39;15-30% å®¢å•ä»·æå‡\u0026#39;, implementationTime: \u0026#39;1-3å‘¨\u0026#39; }); } return { recommendations, priority: this.prioritizeRecommendations(recommendations), implementationPlan: this.createImplementationPlan(recommendations) }; } } æ€»ç»“ å¾®ä¿¡å°ç¨‹åºç”Ÿæ€çš„å•†ä¸šé€»è¾‘æ ¸å¿ƒåœ¨äºï¼š\næµé‡è·å–ï¼š\nç¤¾äº¤è£‚å˜æ˜¯æµé‡è·å–çš„æ ¸å¿ƒé©±åŠ¨åŠ› å†…å®¹è¥é”€æ˜¯ç”¨æˆ·æ•™è‚²çš„é‡è¦æ‰‹æ®µ ç¤¾ç¾¤è¿è¥æ˜¯ç”¨æˆ·æ²‰æ·€çš„å…³é”®è½½ä½“ å¤šæ¸ é“å¼•æµæ˜¯æµé‡å¤šå…ƒåŒ–çš„å¿…è¦æ‰‹æ®µ å•†ä¸šå˜ç°ï¼š\nç”µå•†å˜ç°æ˜¯æœ€ä¸»è¦çš„å˜ç°æ¨¡å¼ å¹¿å‘Šæ”¶å…¥æ˜¯é‡è¦çš„è¡¥å……æ¥æº ä»˜è´¹æœåŠ¡æ˜¯é«˜ä»·å€¼ç”¨æˆ·çš„å˜ç°æ–¹å¼ æ•°æ®å˜ç°æ˜¯æœªæ¥çš„å¢é•¿ç‚¹ ç”¨æˆ·è¿è¥ï¼š\nç”¨æˆ·ç”Ÿå‘½å‘¨æœŸç®¡ç†è´¯ç©¿å§‹ç»ˆ ä¸ªæ€§åŒ–æ¨èæå‡ç”¨æˆ·ä½“éªŒ ç¤¾ç¾¤è¿è¥å¢å¼ºç”¨æˆ·ç²˜æ€§ ç§¯åˆ†ä½“ç³»æ¿€åŠ±ç”¨æˆ·æ´»è·ƒ æ•°æ®é©±åŠ¨ï¼š\nå…¨é“¾è·¯æ•°æ®åˆ†æä¼˜åŒ–å†³ç­– A/Bæµ‹è¯•æŒç»­æå‡æ•ˆæœ å®æ—¶ç›‘æ§é¢„é˜²é£é™© æ™ºèƒ½æ¨èæå‡æ•ˆç‡ é€šè¿‡ç³»ç»ŸåŒ–çš„è¿è¥ç­–ç•¥å’Œæ•°æ®åˆ†æï¼Œä¼ä¸šå¯ä»¥åœ¨å¾®ä¿¡å°ç¨‹åºç”Ÿæ€ä¸­æ„å»ºå¯æŒç»­çš„å•†ä¸šæ¨¡å¼ï¼Œå®ç°ä»æµé‡åˆ°ä»·å€¼çš„å®Œæ•´è½¬åŒ–ã€‚\nç›¸å…³èµ„æºï¼š\nå¾®ä¿¡å°ç¨‹åºå®˜æ–¹æ–‡æ¡£ å¾®ä¿¡å¼€æ”¾å¹³å° å°ç¨‹åºæ•°æ®åˆ†ææŒ‡å— å¾®ä¿¡æ”¯ä»˜å•†æˆ·å¹³å° ","permalink":"/blog/articles/wechat-mini-program-ecosystem/","summary":"æ·±åº¦å‰–æå¾®ä¿¡å°ç¨‹åºç”Ÿæ€ç³»ç»Ÿï¼Œä»æµé‡è·å–ã€ç”¨æˆ·è¿è¥åˆ°å•†ä¸šå˜ç°çš„å®Œæ•´è·¯å¾„ã€‚","title":"å¾®ä¿¡å°ç¨‹åºç”Ÿæ€æ·±åº¦è§£æï¼šä»æµé‡åˆ°å˜ç°çš„å•†ä¸šé€»è¾‘"},{"content":"å¼•è¨€ Flutterå‡­å€Ÿå…¶å¼ºå¤§çš„åŠ¨ç”»ç³»ç»Ÿï¼Œè®©å¼€å‘è€…èƒ½å¤Ÿåˆ›é€ å‡ºåª²ç¾åŸç”Ÿåº”ç”¨çš„æµç•…åŠ¨ç”»æ•ˆæœã€‚ä»ç®€å•çš„è¿‡æ¸¡åŠ¨ç”»åˆ°å¤æ‚çš„ç²’å­ç³»ç»Ÿï¼ŒFlutteræä¾›äº†ä¸°å¯Œè€Œçµæ´»çš„åŠ¨ç”»APIã€‚æœ¬æ–‡å°†æ·±å…¥æ¢è®¨FlutteråŠ¨ç”»çš„é«˜çº§æŠ€å·§ï¼Œå¸®åŠ©ä½ æ‰“é€ ç”µå½±çº§çš„ç”¨æˆ·ä½“éªŒã€‚\nFlutteråŠ¨ç”»ç³»ç»Ÿæ¶æ„ åŠ¨ç”»æ ¸å¿ƒæ¦‚å¿µ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 // FlutteråŠ¨ç”»ç³»ç»Ÿæ¶æ„ /* AnimationController â†’ Animation â†’ Tween â†’ Widget â†“ â†“ â†“ â†“ æ§åˆ¶æ—¶é—´çº¿ æ•°å€¼å˜åŒ– æ’å€¼è®¡ç®— è§†è§‰æ›´æ–° */ // åŸºç¡€åŠ¨ç”»æ§åˆ¶å™¨ import \u0026#39;package:flutter/material.dart\u0026#39;; class BasicAnimationDemo extends StatefulWidget { @override _BasicAnimationDemoState createState() =\u0026gt; _BasicAnimationDemoState(); } class _BasicAnimationDemoState extends State\u0026lt;BasicAnimationDemo\u0026gt; with SingleTickerProviderStateMixin { late AnimationController _controller; late Animation\u0026lt;double\u0026gt; _animation; late Animation\u0026lt;Color?\u0026gt; _colorAnimation; late Animation\u0026lt;Size?\u0026gt; _sizeAnimation; @override void initState() { super.initState(); // åˆ›å»ºåŠ¨ç”»æ§åˆ¶å™¨ _controller = AnimationController( duration: const Duration(seconds: 2), vsync: this, ); // åˆ›å»ºè¡¥é—´åŠ¨ç”» _animation = Tween\u0026lt;double\u0026gt;( begin: 0.0, end: 1.0, ).animate(CurvedAnimation( parent: _controller, curve: Curves.easeInOut, )); // é¢œè‰²åŠ¨ç”» _colorAnimation = ColorTween( begin: Colors.blue, end: Colors.red, ).animate(_controller); // å°ºå¯¸åŠ¨ç”» _sizeAnimation = SizeTween( begin: const Size(100, 100), end: const Size(200, 200), ).animate(_controller); // ç›‘å¬åŠ¨ç”»çŠ¶æ€ _controller.addStatusListener((status) { print(\u0026#39;Animation status: $status\u0026#39;); }); // ç›‘å¬åŠ¨ç”»å€¼å˜åŒ– _controller.addListener(() { print(\u0026#39;Animation value: ${_animation.value}\u0026#39;); }); } @override void dispose() { _controller.dispose(); super.dispose(); } @override Widget build(BuildContext context) { return Scaffold( appBar: AppBar(title: const Text(\u0026#39;Basic Animation\u0026#39;)), body: Center( child: AnimatedBuilder( animation: _controller, builder: (context, child) { return Container( width: _sizeAnimation.value?.width, height: _sizeAnimation.value?.height, decoration: BoxDecoration( color: _colorAnimation.value, borderRadius: BorderRadius.circular( _animation.value * 20, ), ), child: Center( child: Text( \u0026#39;${(_animation.value * 100).toInt()}%\u0026#39;, style: TextStyle( color: Colors.white, fontSize: 20 + _animation.value * 10, ), ), ), ); }, ), ), floatingActionButton: FloatingActionButton( onPressed: () { if (_controller.isCompleted) { _controller.reverse(); } else { _controller.forward(); } }, child: const Icon(Icons.play_arrow), ), ); } } é«˜çº§æ›²çº¿åŠ¨ç”» 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 174 175 176 177 178 179 180 181 182 183 184 185 186 187 188 189 190 191 192 193 194 195 196 197 198 199 200 // è‡ªå®šä¹‰åŠ¨ç”»æ›²çº¿ class CustomCurves { // å¼¹æ€§æ›²çº¿ static const Curve elasticCurve = ElasticOutCurve(0.8); // è‡ªå®šä¹‰è´å¡å°”æ›²çº¿ static const Curve customBezier = Cubic(0.25, 0.1, 0.25, 1.0); // å¼¹è·³æ›²çº¿ static const Curve bounceCurve = BounceInOutCurve(); // å‘¼å¸æ•ˆæœæ›²çº¿ static Curve breathingCurve = _BreathingCurve(); } class _BreathingCurve extends Curve { @override double transform(double t) { // ä½¿ç”¨æ­£å¼¦å‡½æ•°åˆ›å»ºå‘¼å¸æ•ˆæœ return (1 - math.cos(t * 2 * math.pi)) / 2; } } // å¤æ‚åŠ¨ç”»ç»„åˆ class ComplexAnimationDemo extends StatefulWidget { @override _ComplexAnimationDemoState createState() =\u0026gt; _ComplexAnimationDemoState(); } class _ComplexAnimationDemoState extends State\u0026lt;ComplexAnimationDemo\u0026gt; with TickerProviderStateMixin { late AnimationController _mainController; late AnimationController _secondaryController; late Animation\u0026lt;double\u0026gt; _rotationAnimation; late Animation\u0026lt;double\u0026gt; _scaleAnimation; late Animation\u0026lt;double\u0026gt; _opacityAnimation; late Animation\u0026lt;Offset\u0026gt; _slideAnimation; late Animation\u0026lt;Color?\u0026gt; _gradientAnimation; @override void initState() { super.initState(); // ä¸»æ§åˆ¶å™¨ _mainController = AnimationController( duration: const Duration(seconds: 3), vsync: this, ); // æ¬¡çº§æ§åˆ¶å™¨ _secondaryController = AnimationController( duration: const Duration(milliseconds: 1500), vsync: this, ); // æ—‹è½¬åŠ¨ç”» _rotationAnimation = Tween\u0026lt;double\u0026gt;( begin: 0, end: 2 * math.pi, ).animate(CurvedAnimation( parent: _mainController, curve: CustomCurves.elasticCurve, )); // ç¼©æ”¾åŠ¨ç”» _scaleAnimation = Tween\u0026lt;double\u0026gt;( begin: 0.8, end: 1.2, ).animate(CurvedAnimation( parent: _secondaryController, curve: CustomCurves.bounceCurve, )); // é€æ˜åº¦åŠ¨ç”» _opacityAnimation = Tween\u0026lt;double\u0026gt;( begin: 0.3, end: 1.0, ).animate(CurvedAnimation( parent: _mainController, curve: const Interval(0.2, 0.8, curve: Curves.easeInOut), )); // æ»‘åŠ¨åŠ¨ç”» _slideAnimation = Tween\u0026lt;Offset\u0026gt;( begin: const Offset(-1, 0), end: const Offset(1, 0), ).animate(CurvedAnimation( parent: _secondaryController, curve: CustomCurves.customBezier, )); // æ¸å˜è‰²åŠ¨ç”» _gradientAnimation = RainbowColorTween( begin: Colors.purple, end: Colors.orange, ).animate(_mainController); // å¯åŠ¨æ¬¡çº§åŠ¨ç”»å»¶è¿Ÿ _secondaryController.repeat(reverse: true); } @override void dispose() { _mainController.dispose(); _secondaryController.dispose(); super.dispose(); } @override Widget build(BuildContext context) { return Scaffold( body: Container( decoration: BoxDecoration( gradient: LinearGradient( colors: [ _gradientAnimation.value ?? Colors.blue, (_gradientAnimation.value ?? Colors.blue).withOpacity(0.8), ], begin: Alignment.topLeft, end: Alignment.bottomRight, ), ), child: Center( child: AnimatedBuilder( animation: Listenable.merge([ _mainController, _secondaryController, ]), builder: (context, child) { return Transform.rotate( angle: _rotationAnimation.value, child: Transform.scale( scale: _scaleAnimation.value, child: SlideTransition( position: _slideAnimation, child: Opacity( opacity: _opacityAnimation.value, child: Container( width: 200, height: 200, decoration: BoxDecoration( color: Colors.white.withOpacity(0.9), borderRadius: BorderRadius.circular(20), boxShadow: [ BoxShadow( color: Colors.black.withOpacity(0.3), blurRadius: 20, offset: const Offset(0, 10), ), ], ), child: const Center( child: Text( \u0026#39;Complex\\nAnimation\u0026#39;, textAlign: TextAlign.center, style: TextStyle( fontSize: 24, fontWeight: FontWeight.bold, color: Colors.black87, ), ), ), ), ), ), ), ); }, ), ), ), floatingActionButton: Row( mainAxisAlignment: MainAxisAlignment.end, children: [ FloatingActionButton( onPressed: () =\u0026gt; _mainController.forward(), child: const Icon(Icons.play_arrow), ), const SizedBox(width: 10), FloatingActionButton( onPressed: () =\u0026gt; _mainController.reverse(), child: const Icon(Icons.arrow_back), ), const SizedBox(width: 10), FloatingActionButton( onPressed: () { if (_mainController.isAnimating) { _mainController.stop(); } else { _mainController.repeat(reverse: true); } }, child: const Icon(Icons.repeat), ), ], ), ); } } ç‰©ç†æ¨¡æ‹ŸåŠ¨ç”» å¼¹ç°§åŠ¨ç”» 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 174 175 176 // è‡ªå®šä¹‰å¼¹ç°§ç‰©ç†åŠ¨ç”» class SpringAnimation extends StatefulWidget { const SpringAnimation({Key? key}) : super(key: key); @override _SpringAnimationState createState() =\u0026gt; _SpringAnimationState(); } class _SpringAnimationState extends State\u0026lt;SpringAnimation\u0026gt; with TickerProviderStateMixin { late AnimationController _controller; late Animation\u0026lt;double\u0026gt; _springAnimation; double _targetPosition = 0; double _currentPosition = 0; @override void initState() { super.initState(); _controller = AnimationController( duration: const Duration(milliseconds: 1000), vsync: this, ); // ä½¿ç”¨SpringSimulation _springAnimation = _controller.drive( SpringSimulation( const SpringDescription( mass: 1, stiffness: 100, damping: 10, ), 0, 1, 0, ), ); } void _animateTo(double target) { _targetPosition = target; // æ›´æ–°å¼¹ç°§æ¨¡æ‹Ÿ final simulation = SpringSimulation( const SpringDescription( mass: 1, stiffness: 200, damping: 15, ), _currentPosition, _targetPosition, 0, ); _controller.animateWith(simulation); } @override Widget build(BuildContext context) { return Scaffold( appBar: AppBar(title: const Text(\u0026#39;Spring Animation\u0026#39;)), body: GestureDetector( onPanUpdate: (details) { setState(() { _currentPosition = details.localPosition.dy; }); }, onPanEnd: (details) { _animateTo(_currentPosition); }, child: AnimatedBuilder( animation: _springAnimation, builder: (context, child) { return Stack( children: [ // ç›®æ ‡ä½ç½®æŒ‡ç¤ºå™¨ Positioned( top: 200, left: 0, right: 0, child: Container( height: 2, color: Colors.grey.withOpacity(0.5), ), ), // å¼¹ç°§å°çƒ Positioned( top: 200 + _springAnimation.value * 200, left: 0, right: 0, child: Center( child: Container( width: 60, height: 60, decoration: BoxDecoration( color: Colors.blue, shape: BoxShape.circle, boxShadow: [ BoxShadow( color: Colors.blue.withOpacity(0.3), blurRadius: 20, spreadRadius: 5, ), ], ), ), ), ), // å¼¹ç°§è¿çº¿ CustomPaint( size: Size.infinite, painter: SpringPainter( startY: 200, endY: 200 + _springAnimation.value * 200, coils: 10, ), ), ], ); }, ), ), ); } } // å¼¹ç°§ç»˜åˆ¶å™¨ class SpringPainter extends CustomPainter { final double startY; final double endY; final int coils; SpringPainter({ required this.startY, required this.endY, this.coils = 10, }); @override void paint(Canvas canvas, Size size) { final paint = Paint() ..color = Colors.grey ..strokeWidth = 2; final path = Path(); final width = size.width / 2; path.moveTo(width, startY); final coilHeight = (endY - startY) / coils; for (int i = 0; i \u0026lt;= coils; i++) { final y = startY + (i * coilHeight); final x = width + (i % 2 == 0 ? -30 : 30); if (i == 0) { path.lineTo(x, y); } else { path.quadraticBezierTo( x - (i % 2 == 0 ? -30 : 30), y - coilHeight / 2, x, y, ); } } canvas.drawPath(path, paint); } @override bool shouldRepaint(covariant CustomPainter oldDelegate) { return true; } } é‡åŠ›å’Œç¢°æ’åŠ¨ç”» 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 174 175 176 177 178 179 180 181 182 183 184 185 186 187 188 189 190 191 192 193 194 195 196 197 198 199 200 201 202 203 204 205 206 207 208 209 210 211 212 213 214 215 216 217 218 219 220 221 222 223 224 225 226 227 228 229 230 231 232 233 234 235 236 237 238 239 240 241 242 243 244 245 246 247 248 // ç‰©ç†å¼•æ“åŠ¨ç”» class PhysicsEngineDemo extends StatefulWidget { const PhysicsEngineDemo({Key? key}) : super(key: key); @override _PhysicsEngineDemoState createState() =\u0026gt; _PhysicsEngineDemoState(); } class _PhysicsEngineDemoState extends State\u0026lt;PhysicsEngineDemo\u0026gt; with TickerProviderStateMixin { late AnimationController _physicsController; final List\u0026lt;Particle\u0026gt; _particles = []; late double _gravity = 980; // åƒç´ /ç§’Â² late double _restitution = 0.8; // å¼¹æ€§ç³»æ•° @override void initState() { super.initState(); _physicsController = AnimationController( duration: const Duration(hours: 1), // å¾ˆé•¿çš„æŒç»­æ—¶é—´ vsync: this, ); // åˆå§‹åŒ–ç²’å­ _initializeParticles(); // å¼€å§‹ç‰©ç†æ¨¡æ‹Ÿ _startPhysicsSimulation(); } void _initializeParticles() { final random = math.Random(); for (int i = 0; i \u0026lt; 20; i++) { _particles.add(Particle( position: Offset( random.nextDouble() * 300 + 50, random.nextDouble() * 100, ), velocity: Offset( (random.nextDouble() - 0.5) * 200, random.nextDouble() * -100, ), radius: random.nextDouble() * 20 + 10, color: Colors.primaries[random.nextInt(Colors.primaries.length)], )); } } void _startPhysicsSimulation() { _physicsController.addListener(_updatePhysics); _physicsController.repeat(); } void _updatePhysics() { final deltaTime = 0.016; // å‡è®¾60FPS for (final particle in _particles) { // åº”ç”¨é‡åŠ› particle.velocity += Offset(0, _gravity * deltaTime); // æ›´æ–°ä½ç½® particle.position += particle.velocity * deltaTime; // è¾¹ç•Œç¢°æ’æ£€æµ‹ _handleBoundaryCollision(particle); } // ç²’å­é—´ç¢°æ’æ£€æµ‹ _handleParticleCollisions(); setState(() {}); } void _handleBoundaryCollision(Particle particle) { final size = MediaQuery.of(context).size; final radius = particle.radius; // åº•éƒ¨ç¢°æ’ if (particle.position.dy + radius \u0026gt; size.height - 100) { particle.position.dy = size.height - 100 - radius; particle.velocity = Offset( particle.velocity.dx, -particle.velocity.dy * _restitution, ); } // å·¦å³è¾¹ç•Œç¢°æ’ if (particle.position.dx - radius \u0026lt; 0) { particle.position.dx = radius; particle.velocity = Offset( -particle.velocity.dx * _restitution, particle.velocity.dy, ); } if (particle.position.dx + radius \u0026gt; size.width) { particle.position.dx = size.width - radius; particle.velocity = Offset( -particle.velocity.dx * _restitution, particle.velocity.dy, ); } } void _handleParticleCollisions() { for (int i = 0; i \u0026lt; _particles.length; i++) { for (int j = i + 1; j \u0026lt; _particles.length; j++) { final p1 = _particles[i]; final p2 = _particles[j]; final distance = (p1.position - p2.position).distance; final minDistance = p1.radius + p2.radius; if (distance \u0026lt; minDistance) { // ç¢°æ’å‘ç”Ÿ _resolveCollision(p1, p2, distance, minDistance); } } } } void _resolveCollision(Particle p1, Particle p2, double distance, double minDistance) { // è®¡ç®—ç¢°æ’æ³•çº¿ final normal = (p2.position - p1.position) / distance; // åˆ†ç¦»é‡å çš„ç²’å­ final overlap = minDistance - distance; final separation = normal * (overlap / 2); p1.position -= separation; p2.position += separation; // è®¡ç®—ç›¸å¯¹é€Ÿåº¦ final relativeVelocity = p1.velocity - p2.velocity; final velocityAlongNormal = relativeVelocity.dx * normal.dx + relativeVelocity.dy * normal.dy; // å¦‚æœç²’å­æ­£åœ¨åˆ†ç¦»ï¼Œä¸éœ€è¦å¤„ç† if (velocityAlongNormal \u0026gt; 0) return; // è®¡ç®—ç¢°æ’åçš„é€Ÿåº¦ final restitution = _restitution; final impulse = 2 * velocityAlongNormal / 2; // å‡è®¾è´¨é‡ç›¸ç­‰ final impulseVector = normal * impulse * restitution; p1.velocity -= impulseVector; p2.velocity += impulseVector; } void _addExplosion(Offset center) { for (final particle in _particles) { final direction = particle.position - center; final distance = direction.distance; if (distance \u0026gt; 0) { final force = 50000 / distance; // çˆ†ç‚¸åŠ›éšè·ç¦»è¡°å‡ final normalizedDirection = direction / distance; particle.velocity += normalizedDirection * force; } } } @override Widget build(BuildContext context) { return Scaffold( appBar: AppBar(title: const Text(\u0026#39;Physics Engine\u0026#39;)), body: GestureDetector( onTapUp: (details) { _addExplosion(details.localPosition); }, child: Container( width: double.infinity, height: double.infinity, decoration: BoxDecoration( gradient: LinearGradient( begin: Alignment.topCenter, end: Alignment.bottomCenter, colors: [ Colors.blue.shade100, Colors.purple.shade100, ], ), ), child: Stack( children: _particles.map((particle) { return Positioned( left: particle.position.dx - particle.radius, top: particle.position.dy - particle.radius, child: Container( width: particle.radius * 2, height: particle.radius * 2, decoration: BoxDecoration( color: particle.color, shape: BoxShape.circle, boxShadow: [ BoxShadow( color: particle.color.withOpacity(0.5), blurRadius: particle.radius / 2, spreadRadius: particle.radius / 4, ), ], ), ), ); }).toList(), ), ), ), floatingActionButton: Column( mainAxisSize: MainAxisSize.min, children: [ FloatingActionButton( onPressed: () { setState(() { _particles.clear(); _initializeParticles(); }); }, child: const Icon(Icons.refresh), ), const SizedBox(height: 10), FloatingActionButton( onPressed: () { _gravity = _gravity == 980 ? 1960 : 980; }, child: const Icon(Icons.arrow_downward), ), ], ), ); } } // ç²’å­ç±» class Particle { Offset position; Offset velocity; double radius; Color color; Particle({ required this.position, required this.velocity, required this.radius, required this.color, }); } é«˜çº§åŠ¨ç”»æ•ˆæœ ç²’å­ç³»ç»Ÿ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 174 175 176 177 178 179 180 181 182 183 184 185 186 187 188 189 190 191 192 193 194 195 196 197 198 // é«˜æ€§èƒ½ç²’å­ç³»ç»Ÿ class ParticleSystem extends StatefulWidget { final ParticleConfig config; const ParticleSystem({ Key? key, required this.config, }) : super(key: key); @override _ParticleSystemState createState() =\u0026gt; _ParticleSystemState(); } class _ParticleSystemState extends State\u0026lt;ParticleSystem\u0026gt; with TickerProviderStateMixin { late AnimationController _controller; final List\u0026lt;Particle2\u0026gt; _particles = []; final Random _random = Random(); @override void initState() { super.initState(); _controller = AnimationController( duration: const Duration(seconds: 10), vsync: this, ); _initializeParticles(); _controller.repeat(); } void _initializeParticles() { for (int i = 0; i \u0026lt; widget.config.particleCount; i++) { _particles.add(Particle2( position: widget.config.emitterPosition, velocity: _generateInitialVelocity(), acceleration: widget.config.acceleration, life: _random.nextDouble() * widget.config.lifeSpan + widget.config.lifeSpan / 2, maxLife: widget.config.lifeSpan, size: _random.nextDouble() * widget.config.sizeVariation + widget.config.baseSize, color: widget.config.colors[_random.nextInt(widget.config.colors.length)], fadeOut: widget.config.fadeOut, )); } } Offset _generateInitialVelocity() { final angle = _random.nextDouble() * 2 * math.pi; final speed = _random.nextDouble() * widget.config.speedVariation + widget.config.baseSpeed; return Offset( math.cos(angle) * speed, math.sin(angle) * speed, ); } @override void dispose() { _controller.dispose(); super.dispose(); } @override Widget build(BuildContext context) { return CustomPaint( painter: ParticlePainter( particles: _particles, controller: _controller, ), child: Container(), ); } } // ç²’å­é…ç½®ç±» class ParticleConfig { final Offset emitterPosition; final int particleCount; final double baseSpeed; final double speedVariation; final double baseSize; final double sizeVariation; final double lifeSpan; final List\u0026lt;Color\u0026gt; colors; final bool fadeOut; final Offset acceleration; ParticleConfig({ required this.emitterPosition, this.particleCount = 100, this.baseSpeed = 100, this.speedVariation = 50, this.baseSize = 5, this.sizeVariation = 3, this.lifeSpan = 3, this.colors = const [Colors.white, Colors.yellow, Colors.orange], this.fadeOut = true, this.acceleration = const Offset(0, 50), }); } // ç²’å­ç±» class Particle2 { Offset position; Offset velocity; Offset acceleration; double life; final double maxLife; final double size; final Color color; final bool fadeOut; Particle2({ required this.position, required this.velocity, this.acceleration = const Offset(0, 50), required this.life, required this.maxLife, required this.size, required this.color, this.fadeOut = true, }); void update(double deltaTime) { // æ›´æ–°é€Ÿåº¦ velocity += acceleration * deltaTime; // æ›´æ–°ä½ç½® position += velocity * deltaTime; // æ›´æ–°ç”Ÿå‘½å€¼ life -= deltaTime; } Paint getPaint() { final paint = Paint() ..color = color; if (fadeOut) { paint.color = color.withOpacity(life / maxLife); } return paint; } } // ç²’å­ç»˜åˆ¶å™¨ class ParticlePainter extends CustomPainter { final List\u0026lt;Particle2\u0026gt; particles; final AnimationController controller; ParticlePainter({ required this.particles, required this.controller, }); @override void paint(Canvas canvas, Size size) { final deltaTime = 0.016; // å‡è®¾60FPS for (final particle in particles) { if (particle.life \u0026lt;= 0) { // é‡ç½®ç²’å­ _resetParticle(particle); } particle.update(deltaTime); if (particle.life \u0026gt; 0) { final paint = particle.getPaint(); canvas.drawCircle( particle.position, particle.size * (particle.life / particle.maxLife), paint, ); } } } void _resetParticle(Particle particle) { final random = Random(); final angle = random.nextDouble() * 2 * math.pi; final speed = random.nextDouble() * 50 + 100; particle.position = const Offset(200, 300); particle.velocity = Offset( math.cos(angle) * speed, math.sin(angle) * speed, ); particle.life = particle.maxLife; } @override bool shouldRepaint(covariant ParticlePainter oldDelegate) { return true; } } å½¢æ€å˜æ¢åŠ¨ç”» 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 174 175 176 177 178 179 180 181 182 183 184 185 186 187 188 189 190 191 192 193 194 195 196 197 198 199 200 201 202 203 204 205 206 207 208 209 210 211 212 213 214 215 216 217 218 219 220 221 222 223 224 225 226 227 228 229 230 231 232 233 234 235 236 237 238 239 240 241 242 243 244 245 246 247 248 249 250 251 252 253 254 255 256 257 // å¤æ‚çš„å½¢çŠ¶å˜æ¢åŠ¨ç”» class MorphingAnimation extends StatefulWidget { const MorphingAnimation({Key? key}) : super(key: key); @override _MorphingAnimationState createState() =\u0026gt; _MorphingAnimationState(); } class _MorphingAnimationState extends State\u0026lt;MorphingAnimation\u0026gt; with TickerProviderStateMixin { late AnimationController _controller; late Animation\u0026lt;double\u0026gt; _morphProgress; final List\u0026lt;Offset\u0026gt; _circlePoints = []; final List\u0026lt;Offset\u0026gt; _squarePoints = []; final List\u0026lt;Offset\u0026gt; _starPoints = []; final List\u0026lt;Offset\u0026gt; _currentPoints = []; @override void initState() { super.initState(); _controller = AnimationController( duration: const Duration(seconds: 4), vsync: this, ); _morphProgress = Tween\u0026lt;double\u0026gt;( begin: 0, end: 1, ).animate(CurvedAnimation( parent: _controller, curve: Curves.easeInOut, )); _generateShapePoints(); _controller.repeat(reverse: true); } void _generateShapePoints() { final center = const Offset(200, 200); final radius = 100; const pointCount = 32; // ç”Ÿæˆåœ†å½¢ç‚¹ for (int i = 0; i \u0026lt; pointCount; i++) { final angle = (i / pointCount) * 2 * math.pi; _circlePoints.add( Offset( center.dx + radius * math.cos(angle), center.dy + radius * math.sin(angle), ), ); } // ç”Ÿæˆæ–¹å½¢ç‚¹ final squareSize = radius * 1.5; for (int i = 0; i \u0026lt; pointCount; i++) { final t = i / pointCount; late Offset point; if (t \u0026lt; 0.25) { // ä¸Šè¾¹ final localT = t * 4; point = Offset( center.dx - squareSize / 2 + localT * squareSize, center.dy - squareSize / 2, ); } else if (t \u0026lt; 0.5) { // å³è¾¹ final localT = (t - 0.25) * 4; point = Offset( center.dx + squareSize / 2, center.dy - squareSize / 2 + localT * squareSize, ); } else if (t \u0026lt; 0.75) { // ä¸‹è¾¹ final localT = (t - 0.5) * 4; point = Offset( center.dx + squareSize / 2 - localT * squareSize, center.dy + squareSize / 2, ); } else { // å·¦è¾¹ final localT = (t - 0.75) * 4; point = Offset( center.dx - squareSize / 2, center.dy + squareSize / 2 - localT * squareSize, ); } _squarePoints.add(point); } // ç”Ÿæˆæ˜Ÿå½¢ç‚¹ const starPoints = 5; const outerRadius = radius; const innerRadius = radius * 0.5; for (int i = 0; i \u0026lt; pointCount; i++) { final pointIndex = (i * starPoints / pointCount).floor(); final t = (i * starPoints / pointCount) - pointIndex; late Offset point; final angle = (pointIndex / starPoints) * 2 * math.pi - math.pi / 2; if (pointIndex % 2 == 0) { // å¤–é¡¶ç‚¹ point = Offset( center.dx + outerRadius * math.cos(angle), center.dy + outerRadius * math.sin(angle), ); } else { // å†…é¡¶ç‚¹ point = Offset( center.dx + innerRadius * math.cos(angle), center.dy + innerRadius * math.sin(angle), ); } _starPoints.add(point); } // åˆå§‹åŒ–å½“å‰ç‚¹ä¸ºåœ†å½¢ _currentPoints.addAll(_circlePoints); } void _updateMorphing() { final progress = _morphProgress.value; // æ ¹æ®è¿›åº¦é€‰æ‹©ä¸åŒçš„å½¢çŠ¶ç»„åˆ List\u0026lt;Offset\u0026gt; targetPoints; String shapeName; if (progress \u0026lt; 0.33) { // åœ†å½¢åˆ°æ–¹å½¢ final t = progress / 0.33; targetPoints = _squarePoints; shapeName = \u0026#39;Circle â†’ Square\u0026#39;; } else if (progress \u0026lt; 0.66) { // æ–¹å½¢åˆ°æ˜Ÿå½¢ final t = (progress - 0.33) / 0.33; targetPoints = _starPoints; shapeName = \u0026#39;Square â†’ Star\u0026#39;; } else { // æ˜Ÿå½¢åˆ°åœ†å½¢ final t = (progress - 0.66) / 0.34; targetPoints = _circlePoints; shapeName = \u0026#39;Star â†’ Circle\u0026#39;; } // ä½¿ç”¨æ’å€¼æ›´æ–°å½“å‰ç‚¹ for (int i = 0; i \u0026lt; _currentPoints.length; i++) { final startPoint = _currentPoints[i]; final endPoint = targetPoints[i]; // æ ¹æ®æ•´ä½“è¿›åº¦è®¡ç®—æ’å€¼ var t = _morphProgress.value; // åº”ç”¨ç¼“åŠ¨æ•ˆæœ t = _applyEasing(t); _currentPoints[i] = Offset.lerp(startPoint, endPoint, t)!; } } double _applyEasing(double t) { // ä½¿ç”¨è‡ªå®šä¹‰ç¼“åŠ¨å‡½æ•° return t \u0026lt; 0.5 ? 2 * t * t : 1 - math.pow(-2 * t + 2, 2) / 2; } @override Widget build(BuildContext context) { return Scaffold( appBar: AppBar( title: const Text(\u0026#39;Morphing Animation\u0026#39;), actions: [ IconButton( icon: const Icon(Icons.play_arrow), onPressed: () { if (_controller.isAnimating) { _controller.stop(); } else { _controller.forward(); } }, ), ], ), body: AnimatedBuilder( animation: _morphProgress, builder: (context, child) { _updateMorphing(); return CustomPaint( painter: MorphingPainter( points: _currentPoints, color: Colors.blue, strokeWidth: 3, ), child: const SizedBox.expand(), ); }, ), ); } } // å˜å½¢ç»˜åˆ¶å™¨ class MorphingPainter extends CustomPainter { final List\u0026lt;Offset\u0026gt; points; final Color color; final double strokeWidth; MorphingPainter({ required this.points, required this.color, this.strokeWidth = 2, }); @override void paint(Canvas canvas, Size size) { if (points.isEmpty) return; final paint = Paint() ..color = color ..strokeWidth = strokeWidth ..style = PaintingStyle.stroke ..strokeCap = StrokeCap.round ..strokeJoin = StrokeJoin.round; final path = Path() ..addPolygon(points, true); // ç»˜åˆ¶å½¢çŠ¶è½®å»“ canvas.drawPath(path, paint); // å¡«å……åŠé€æ˜é¢œè‰² final fillPaint = Paint() ..color = color.withOpacity(0.2) ..style = PaintingStyle.fill; canvas.drawPath(path, fillPaint); // ç»˜åˆ¶é¡¶ç‚¹ for (final point in points) { canvas.drawCircle(point, 4, Paint()..color = color); } } @override bool shouldRepaint(covariant MorphingPainter oldDelegate) { return oldDelegate.points != points; } } æ‰‹åŠ¿é©±åŠ¨åŠ¨ç”» æ‹–æ‹½å’Œæ‰‹åŠ¿åŠ¨ç”» 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 174 175 176 177 178 179 180 181 182 183 184 185 186 187 188 189 190 191 192 193 194 195 196 197 198 199 200 201 202 203 204 205 206 207 208 209 210 211 212 213 214 215 216 217 218 219 220 221 222 223 224 225 226 227 228 229 230 231 232 233 234 235 236 237 238 239 240 241 242 243 244 245 246 247 248 249 250 251 252 253 // æ‰‹åŠ¿é©±åŠ¨çš„å¼¹æ€§åŠ¨ç”» class GestureAnimation extends StatefulWidget { const GestureAnimation({Key? key}) : super(key: key); @override _GestureAnimationState createState() =\u0026gt; _GestureAnimationState(); } class _GestureAnimationState extends State\u0026lt;GestureAnimation\u0026gt; with TickerProviderStateMixin { late AnimationController _animationController; late AnimationController _bounceController; final GlobalKey _cardKey = GlobalKey(); double _rotation = 0; double _scale = 1; Offset _position = const Offset(0, 0); bool _isDragging = false; @override void initState() { super.initState(); _animationController = AnimationController( duration: const Duration(milliseconds: 300), vsync: this, ); _bounceController = AnimationController( duration: const Duration(milliseconds: 600), vsync: this, ); } void _onPanStart(DragStartDetails details) { setState(() { _isDragging = true; }); _animationController.stop(); } void _onPanUpdate(DragUpdateDetails details) { final RenderBox renderBox = context.findRenderObject() as RenderBox; final localPosition = renderBox.globalToLocal(details.globalPosition); setState(() { _position = localPosition - const Offset(200, 150); // æ ¹æ®æ‹–æ‹½è·ç¦»è®¡ç®—æ—‹è½¬ _rotation = _position.dx * 0.01; // æ‹–æ‹½æ—¶ç•¥å¾®æ”¾å¤§ _scale = 1.05; }); } void _onPanEnd(DragEndDetails details) { setState(() { _isDragging = false; }); // è®¡ç®—å›å¼¹åŠ¨ç”» final velocity = details.velocity.pixelsPerSecond; final distance = (_position.distance + 100).clamp(0.0, 300.0); // ä½¿ç”¨å¼¹æ€§åŠ¨ç”»è¿”å›åŸä½ _animationController.animateTo(0).then((_) { // è§¦å‘å¼¹è·³æ•ˆæœ _bounceController.forward().then((_) { _bounceController.reverse(); }); }); // æ·»åŠ æƒ¯æ€§æ•ˆæœ _animateWithInertia(velocity, distance); } void _animateWithInertia(Offset velocity, double distance) { final inertiaAnimation = Tween\u0026lt;Offset\u0026gt;( begin: _position, end: Offset.zero, ).animate(CurvedAnimation( parent: _animationController, curve: Curves.elasticOut, )); inertiaAnimation.addListener(() { setState(() { _position = inertiaAnimation.value; _rotation = _position.dx * 0.01; _scale = 1 + distance * 0.0002 * (1 - inertiaAnimation.value.distance); }); }); _animationController.forward(from: _animationController.value); } void _onTap() { // ç‚¹å‡»æ—¶çš„å¼¹è·³åŠ¨ç”» _bounceController.forward().then((_) { _bounceController.reverse(); }); } @override Widget build(BuildContext context) { return Scaffold( appBar: AppBar(title: const Text(\u0026#39;Gesture Animation\u0026#39;)), body: Center( child: GestureDetector( onPanStart: _onPanStart, onPanUpdate: _onPanUpdate, onPanEnd: _onPanEnd, onTap: _onTap, child: Container( width: 400, height: 400, decoration: BoxDecoration( border: Border.all(color: Colors.grey.shade300), borderRadius: BorderRadius.circular(20), ), child: Stack( children: [ // å‚è€ƒç½‘æ ¼ CustomPaint( size: const Size(400, 400), painter: GridPainter(), ), // å¯æ‹–æ‹½å¡ç‰‡ AnimatedBuilder( animation: Listenable.merge([ _animationController, _bounceController, ]), builder: (context, child) { return Transform.translate( offset: _position, child: Transform.rotate( angle: _rotation, child: Transform.scale( scale: _scale * (1 + _bounceController.value * 0.1), child: Container( key: _cardKey, width: 300, height: 200, decoration: BoxDecoration( gradient: LinearGradient( colors: [ Colors.blue.shade400, Colors.purple.shade600, ], begin: Alignment.topLeft, end: Alignment.bottomRight, ), borderRadius: BorderRadius.circular(20), boxShadow: [ BoxShadow( color: Colors.black.withOpacity(_isDragging ? 0.3 : 0.2), blurRadius: _isDragging ? 20 : 10, offset: Offset( _isDragging ? _position.dx * 0.1 : 0, _isDragging ? _position.dy * 0.1 : 5, ), ), ], ), child: const Center( child: Column( mainAxisAlignment: MainAxisAlignment.center, children: [ Icon( Icons.touch_app, color: Colors.white, size: 48, ), SizedBox(height: 8), Text( \u0026#39;Drag Me!\u0026#39;, style: TextStyle( color: Colors.white, fontSize: 24, fontWeight: FontWeight.bold, ), ), ], ), ), ), ), ), ); }, ), ], ), ), ), ), ); } } // ç½‘æ ¼ç»˜åˆ¶å™¨ class GridPainter extends CustomPainter { @override void paint(Canvas canvas, Size size) { final paint = Paint() ..color = Colors.grey.shade300 ..strokeWidth = 0.5; const gridSize = 50.0; // ç»˜åˆ¶å‚ç›´çº¿ for (double x = 0; x \u0026lt; size.width; x += gridSize) { canvas.drawLine( Offset(x, 0), Offset(x, size.height), paint, ); } // ç»˜åˆ¶æ°´å¹³çº¿ for (double y = 0; y \u0026lt; size.height; y += gridSize) { canvas.drawLine( Offset(0, y), Offset(size.width, y), paint, ); } // ç»˜åˆ¶ä¸­å¿ƒåå­— final centerPaint = Paint() ..color = Colors.grey.shade500 ..strokeWidth = 1; canvas.drawLine( const Offset(200, 0), const Offset(200, 400), centerPaint, ); canvas.drawLine( const Offset(0, 200), const Offset(400, 200), centerPaint, ); } @override bool shouldRepaint(covariant CustomPainter oldDelegate) =\u0026gt; false; } æ€§èƒ½ä¼˜åŒ–æŠ€å·§ åŠ¨ç”»æ€§èƒ½ç›‘æ§ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 // åŠ¨ç”»æ€§èƒ½ç›‘æ§å™¨ class AnimationPerformanceMonitor { static final AnimationPerformanceMonitor _instance = AnimationPerformanceMonitor._internal(); factory AnimationPerformanceMonitor() =\u0026gt; _instance; AnimationPerformanceMonitor._internal(); final List\u0026lt;PerformanceMetric\u0026gt; _metrics = []; bool _isMonitoring = false; void startMonitoring() { if (_isMonitoring) return; _isMonitoring = true; WidgetsBinding.instance.addPostFrameCallback(_onFrame); } void stopMonitoring() { _isMonitoring = false; } void _onFrame(Duration timestamp) { if (!_isMonitoring) return; final renderer = WidgetsBinding.instance.renderObject; final frameTime = timestamp.inMicroseconds / 1000; // è®°å½•æ€§èƒ½æŒ‡æ ‡ final metric = PerformanceMetric( timestamp: timestamp, frameTime: frameTime, fps: 1000 / frameTime, cpuUsage: _getCpuUsage(), memoryUsage: _getMemoryUsage(), ); _metrics.add(metric); // ä¿æŒæœ€è¿‘1000å¸§çš„æŒ‡æ ‡ if (_metrics.length \u0026gt; 1000) { _metrics.removeAt(0); } // å¦‚æœæ€§èƒ½ä½äºé˜ˆå€¼ï¼Œå‘å‡ºè­¦å‘Š if (metric.fps \u0026lt; 30) { print(\u0026#39;âš ï¸ Low FPS detected: ${metric.fps.toStringAsFixed(1)}\u0026#39;); _analyzePerformanceIssue(metric); } WidgetsBinding.instance.addPostFrameCallback(_onFrame); } void _analyzePerformanceIssue(PerformanceMetric metric) { // åˆ†ææ€§èƒ½é—®é¢˜ if (metric.memoryUsage \u0026gt; 100 * 1024 * 1024) { // 100MB print(\u0026#39;ğŸ’¾ High memory usage detected\u0026#39;); } if (metric.cpuUsage \u0026gt; 80) { print(\u0026#39;ğŸ”¥ High CPU usage detected\u0026#39;); } } double _getCpuUsage() { // æ¨¡æ‹ŸCPUä½¿ç”¨ç‡ return 30 + (math.Random().nextDouble() * 40); } double _getMemoryUsage() { // æ¨¡æ‹Ÿå†…å­˜ä½¿ç”¨ return 50 * 1024 * 1024 + (math.Random().nextDouble() * 50 * 1024 * 1024); } PerformanceReport generateReport() { if (_metrics.isEmpty) { return PerformanceReport.empty(); } final avgFPS = _metrics.fold(0.0, (sum, m) =\u0026gt; sum + m.fps) / _metrics.length; final minFPS = _metrics.map((m) =\u0026gt; m.fps).reduce((a, b) =\u0026gt; a \u0026lt; b ? a : b); final maxFPS = _metrics.map((m) =\u0026gt; m.fps).reduce((a, b) =\u0026gt; a \u0026gt; b ? a : b); final avgMemory = _metrics.fold(0.0, (sum, m) =\u0026gt; sum + m.memoryUsage) / _metrics.length; return PerformanceReport( avgFPS: avgFPS, minFPS: minFPS, maxFPS: maxFPS, avgMemory: avgMemory, frameCount: _metrics.length, lowFPSFrames: _metrics.where((m) =\u0026gt; m.fps \u0026lt; 30).length, ); } void logReport() { final report = generateReport(); print(\u0026#39;ğŸ“Š Animation Performance Report:\u0026#39;); print(\u0026#39; Average FPS: ${report.avgFPS.toStringAsFixed(1)}\u0026#39;); print(\u0026#39; Min FPS: ${report.minFPS.toStringAsFixed(1)}\u0026#39;); print(\u0026#39; Max FPS: ${report.maxFPS.toStringAsFixed(1)}\u0026#39;); print(\u0026#39; Low FPS Frames: ${report.lowFPSFrames}\u0026#39;); print(\u0026#39; Average Memory: ${(report.avgMemory / 1024 / 1024).toStringAsFixed(1)} MB\u0026#39;); } } // æ€§èƒ½æŒ‡æ ‡ç±» class PerformanceMetric { final DateTime timestamp; final double frameTime; final double fps; final double cpuUsage; final double memoryUsage; PerformanceMetric({ required this.timestamp, required this.frameTime, required this.fps, required this.cpuUsage, required this.memoryUsage, }); } // æ€§èƒ½æŠ¥å‘Šç±» class PerformanceReport { final double avgFPS; final double minFPS; final double maxFPS; final double avgMemory; final int frameCount; final int lowFPSFrames; PerformanceReport({ required this.avgFPS, required this.minFPS, required this.maxFPS, required this.avgMemory, required this.frameCount, required this.lowFPSFrames, }); factory PerformanceReport.empty() { return PerformanceReport( avgFPS: 0, minFPS: 0, maxFPS: 0, avgMemory: 0, frameCount: 0, lowFPSFrames: 0, ); } bool get isPerformant =\u0026gt; avgFPS \u0026gt;= 55 \u0026amp;\u0026amp; lowFPSFrames \u0026lt; frameCount * 0.05; String get performanceRating { if (avgFPS \u0026gt;= 58) return \u0026#39;Excellent\u0026#39;; if (avgFPS \u0026gt;= 55) return \u0026#39;Good\u0026#39;; if (avgFPS \u0026gt;= 45) return \u0026#39;Fair\u0026#39;; return \u0026#39;Poor\u0026#39;; } } ä¼˜åŒ–çš„åŠ¨ç”»å®ç° 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 174 175 176 177 178 179 180 181 182 183 184 185 186 187 188 189 190 191 192 193 194 195 196 197 198 199 200 201 202 203 204 205 206 207 208 209 210 211 212 213 214 215 216 217 218 219 220 221 222 223 224 225 226 227 228 229 230 231 232 233 234 235 236 237 238 239 240 241 242 243 244 245 246 247 248 249 250 251 252 253 254 255 256 257 258 259 260 261 262 263 264 265 266 267 268 269 270 271 272 273 274 275 276 277 278 279 280 // é«˜æ€§èƒ½åŠ¨ç”»ç»„ä»¶ class OptimizedAnimatedWidget extends StatefulWidget { final Widget child; final Animation\u0026lt;double\u0026gt; animation; final bool enableCache; final Duration cacheDuration; const OptimizedAnimatedWidget({ Key? key, required this.child, required this.animation, this.enableCache = true, this.cacheDuration = const Duration(milliseconds: 100), }) : super(key: key); @override _OptimizedAnimatedWidgetState createState() =\u0026gt; _OptimizedAnimatedWidgetState(); } class _OptimizedAnimatedWidgetState extends State\u0026lt;OptimizedAnimatedWidget\u0026gt; with AutomaticKeepAliveClientMixin { Widget? _cachedChild; DateTime? _lastCacheTime; double _lastAnimationValue = -1; @override bool get wantKeepAlive =\u0026gt; true; @override void didUpdateWidget(OptimizedAnimatedWidget oldWidget) { super.didUpdateWidget(oldWidget); // å¦‚æœåŠ¨ç”»å˜åŒ–ï¼Œæ¸…é™¤ç¼“å­˜ if (widget.animation != oldWidget.animation) { _cachedChild = null; } } @override Widget build(BuildContext context) { super.build(context); final animationValue = widget.animation.value; // æ£€æŸ¥æ˜¯å¦å¯ä»¥ä½¿ç”¨ç¼“å­˜çš„å­ç»„ä»¶ if (widget.enableCache \u0026amp;\u0026amp; _cachedChild != null \u0026amp;\u0026amp; _lastCacheTime != null \u0026amp;\u0026amp; DateTime.now().difference(_lastCacheTime!) \u0026lt; widget.cacheDuration \u0026amp;\u0026amp; (animationValue - _lastAnimationValue).abs() \u0026lt; 0.01) { return _cachedChild!; } // ä½¿ç”¨RepaintBoundaryé™åˆ¶é‡ç»˜èŒƒå›´ return RepaintBoundary( child: AnimatedBuilder( animation: widget.animation, builder: (context, child) { // æ„å»ºä¼˜åŒ–åçš„ç»„ä»¶ final optimizedChild = Transform.scale( scale: animationValue, alignment: Alignment.center, child: FadeTransition( opacity: widget.animation, child: widget.child, ), ); // ç¼“å­˜æ„å»ºç»“æœ if (widget.enableCache) { _cachedChild = optimizedChild; _lastCacheTime = DateTime.now(); _lastAnimationValue = animationValue; } return optimizedChild; }, ), ); } } // æ‰¹é‡åŠ¨ç”»ç®¡ç†å™¨ class BatchAnimationManager { final Map\u0026lt;String, AnimationController\u0026gt; _controllers = {}; final Map\u0026lt;String, TickerProvider\u0026gt; _tickers = {}; Timer? _batchTimer; final List\u0026lt;VoidCallback\u0026gt; _pendingAnimations = []; // æ³¨å†ŒåŠ¨ç”»æ§åˆ¶å™¨ void registerController( String id, AnimationController controller, TickerProvider vsync, ) { _controllers[id] = controller; _tickers[id] = vsync; } // æ‰¹é‡å¯åŠ¨åŠ¨ç”» void batchStartAnimations(List\u0026lt;String\u0026gt; controllerIds) { for (final id in controllerIds) { final controller = _controllers[id]; if (controller != null \u0026amp;\u0026amp; !controller.isAnimating) { _pendingAnimations.add(() =\u0026gt; controller.forward()); } } _scheduleBatch(); } // æ‰¹é‡åœæ­¢åŠ¨ç”» void batchStopAnimations(List\u0026lt;String\u0026gt; controllerIds) { for (final id in controllerIds) { final controller = _controllers[id]; if (controller != null \u0026amp;\u0026amp; controller.isAnimating) { _pendingAnimations.add(() =\u0026gt; controller.stop()); } } _scheduleBatch(); } void _scheduleBatch() { _batchTimer?.cancel(); _batchTimer = Timer(const Duration(milliseconds: 16), () { // åœ¨ä¸‹ä¸€å¸§æ‰§è¡Œæ‰€æœ‰åŠ¨ç”» for (final animation in _pendingAnimations) { animation(); } _pendingAnimations.clear(); _batchTimer = null; }); } // é”€æ¯æŒ‡å®šæ§åˆ¶å™¨ void disposeController(String id) { _controllers[id]?.dispose(); _controllers.remove(id); _tickers.remove(id); } // é”€æ¯æ‰€æœ‰æ§åˆ¶å™¨ void disposeAll() { for (final controller in _controllers.values) { controller.dispose(); } _controllers.clear(); _tickers.clear(); _batchTimer?.cancel(); _pendingAnimations.clear(); } } // ä½¿ç”¨ç¤ºä¾‹ class AdvancedAnimationExample extends StatefulWidget { const AdvancedAnimationExample({Key? key}) : super(key: key); @override _AdvancedAnimationExampleState createState() =\u0026gt; _AdvancedAnimationExampleState(); } class _AdvancedAnimationExampleState extends State\u0026lt;AdvancedAnimationExample\u0026gt; with TickerProviderStateMixin { late AnimationController _mainController; late AnimationController _secondaryController; final BatchAnimationManager _batchManager = BatchAnimationManager(); @override void initState() { super.initState(); _mainController = AnimationController( duration: const Duration(seconds: 2), vsync: this, ); _secondaryController = AnimationController( duration: const Duration(milliseconds: 800), vsync: this, ); // æ³¨å†Œåˆ°æ‰¹é‡ç®¡ç†å™¨ _batchManager.registerController(\u0026#39;main\u0026#39;, _mainController, this); _batchManager.registerController(\u0026#39;secondary\u0026#39;, _secondaryController, this); // å¯åŠ¨æ€§èƒ½ç›‘æ§ AnimationPerformanceMonitor().startMonitoring(); } @override void dispose() { _mainController.dispose(); _secondaryController.dispose(); _batchManager.disposeAll(); super.dispose(); } void _startBatchAnimation() { _batchManager.batchStartAnimations([\u0026#39;main\u0026#39;, \u0026#39;secondary\u0026#39;]); } void _logPerformance() { AnimationPerformanceMonitor().logReport(); } @override Widget build(BuildContext context) { return Scaffold( appBar: AppBar( title: const Text(\u0026#39;Advanced Animation\u0026#39;), actions: [ IconButton( onPressed: _startBatchAnimation, icon: const Icon(Icons.play_arrow), ), IconButton( onPressed: _logPerformance, icon: const Icon(Icons.analytics), ), ], ), body: Center( child: Column( mainAxisAlignment: MainAxisAlignment.center, children: [ OptimizedAnimatedWidget( animation: _mainController, enableCache: true, child: Container( width: 200, height: 200, decoration: BoxDecoration( gradient: LinearGradient( colors: [Colors.blue, Colors.purple], begin: Alignment.topLeft, end: Alignment.bottomRight, ), borderRadius: BorderRadius.circular(20), ), child: const Center( child: Text( \u0026#39;Optimized\u0026#39;, style: TextStyle( color: Colors.white, fontSize: 24, fontWeight: FontWeight.bold, ), ), ), ), ), const SizedBox(height: 40), OptimizedAnimatedWidget( animation: _secondaryController, child: Container( width: 150, height: 150, decoration: BoxDecoration( color: Colors.orange, borderRadius: BorderRadius.circular(15), ), child: const Center( child: Text( \u0026#39;Cached\u0026#39;, style: TextStyle( color: Colors.white, fontSize: 20, fontWeight: FontWeight.bold, ), ), ), ), ), ], ), ), ); } } æ€»ç»“ FlutteråŠ¨ç”»ç³»ç»Ÿçš„å¼ºå¤§ä¹‹å¤„åœ¨äºï¼š\næ ¸å¿ƒç‰¹æ€§ï¼š\nçµæ´»çš„AnimationControllerå’ŒTweenç³»ç»Ÿ ä¸°å¯Œçš„åŠ¨ç”»æ›²çº¿é€‰æ‹© è‡ªå®šä¹‰ç»˜åˆ¶èƒ½åŠ› ç¡¬ä»¶åŠ é€Ÿæ”¯æŒ é«˜çº§æŠ€å·§ï¼š\nå¤æ‚åŠ¨ç”»ç¼–æ’å’Œç»„åˆ ç‰©ç†æ¨¡æ‹Ÿå’ŒçœŸå®æ„Ÿæ•ˆæœ æ‰‹åŠ¿é©±åŠ¨çš„äº¤äº’åŠ¨ç”» æ€§èƒ½ç›‘æ§å’Œä¼˜åŒ–ç­–ç•¥ æ€§èƒ½ä¼˜åŒ–ï¼š\nä½¿ç”¨AnimatedBuilderé¿å…ä¸å¿…è¦çš„é‡å»º å®ç°ç¼“å­˜æœºåˆ¶å‡å°‘è®¡ç®—å¼€é”€ åˆç†ä½¿ç”¨RepaintBoundary æ‰¹é‡ç®¡ç†åŠ¨ç”»æ§åˆ¶å™¨ æœ€ä½³å®è·µï¼š\nä¿æŒåŠ¨ç”»åœ¨60FPS é¿å…åœ¨åŠ¨ç”»ä¸­è¿›è¡Œå¤æ‚è®¡ç®— ä½¿ç”¨ç¡¬ä»¶åŠ é€Ÿçš„å±æ€§ åˆç†è®¾ç½®åŠ¨ç”»æŒç»­æ—¶é—´å’Œæ›²çº¿ æŒæ¡è¿™äº›é«˜çº§åŠ¨ç”»æŠ€å·§ï¼Œå°†è®©ä½ èƒ½å¤Ÿåˆ›é€ å‡ºä»¤äººæƒŠå¹çš„ Flutter åº”ç”¨ä½“éªŒã€‚\nç›¸å…³èµ„æºï¼š\nFlutteråŠ¨ç”»å®˜æ–¹æ–‡æ¡£ FlutteråŠ¨ç”»æ¡ˆä¾‹åº“ æ€§èƒ½ä¼˜åŒ–æŒ‡å— CustomPainterä½¿ç”¨æŒ‡å— ","permalink":"/blog/articles/flutter-advanced-animations/","summary":"æ·±å…¥FlutteråŠ¨ç”»ç³»ç»Ÿçš„æ ¸å¿ƒåŸç†ï¼ŒæŒæ¡é«˜çº§åŠ¨ç”»æŠ€å·§ï¼Œæ‰“é€ ä»¤äººæƒŠè‰³çš„ç”¨æˆ·ç•Œé¢ã€‚","title":"Flutteré«˜çº§åŠ¨ç”»å®Œå…¨æŒ‡å—ï¼šæ‰“é€ ç”µå½±çº§æµç•…ä½“éªŒçš„ç»ˆæç§˜ç±"},{"content":"å¼•è¨€ React Nativeä½œä¸ºè·¨å¹³å°ç§»åŠ¨å¼€å‘çš„ä¸»æµæ¡†æ¶ï¼Œæ€§èƒ½ä¼˜åŒ–ä¸€ç›´æ˜¯å¼€å‘è€…å…³æ³¨çš„é‡ç‚¹ã€‚ä¸€ä¸ªæµç•…çš„åº”ç”¨éœ€è¦ä¿æŒ60FPSçš„å¸§ç‡ï¼Œå¿«é€Ÿå“åº”äº¤äº’ï¼Œå¹¶ä¸”æœ‰æ•ˆç®¡ç†å†…å­˜èµ„æºã€‚æœ¬æ–‡å°†ä»åº•å±‚åŸç†åˆ°å®é™…åº”ç”¨ï¼Œå…¨é¢æ¢è®¨React Nativeæ€§èƒ½ä¼˜åŒ–çš„å„ç§æŠ€å·§ã€‚\nReact Nativeæ¶æ„ä¸æ€§èƒ½åŸç† æ¸²æŸ“æµç¨‹è§£æ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 // React Nativeæ¸²æŸ“æµç¨‹ /* JavaScript Thread (JS Thread) â†“ (schedule work) UI Thread (Main Thread) â†“ (create UI elements) Native Modules â†“ (render to screen) Display Hardware */ // æ€§èƒ½ç›‘æ§å·¥å…· class PerformanceMonitor { constructor() { this.metrics = { fps: 60, jsBundleLoadTime: 0, renderTime: 0, memoryUsage: 0, networkLatency: 0 }; this.frameCount = 0; this.lastFrameTime = Date.now(); } // å¼€å§‹æ€§èƒ½ç›‘æ§ startMonitoring() { this.startFPSMonitoring(); this.startMemoryMonitoring(); this.startNetworkMonitoring(); } // FPSç›‘æ§ startFPSMonitoring() { const measure = () =\u0026gt; { const now = Date.now(); const delta = now - this.lastFrameTime; if (delta \u0026gt;= 1000) { this.metrics.fps = Math.round((this.frameCount * 1000) / delta); this.frameCount = 0; this.lastFrameTime = now; // ä¸ŠæŠ¥æ€§èƒ½æ•°æ® this.reportMetrics(); } this.frameCount++; requestAnimationFrame(measure); }; requestAnimationFrame(measure); } // å†…å­˜ä½¿ç”¨ç›‘æ§ startMemoryMonitoring() { if (Platform.OS === \u0026#39;android\u0026#39;) { const getMemoryInfo = () =\u0026gt; { // Androidå†…å­˜ç›‘æ§ return require(\u0026#39;react-native\u0026#39;).NativeModules.MemoryInfoModule.getMemoryInfo(); }; setInterval(async () =\u0026gt; { try { const memoryInfo = await getMemoryInfo(); this.metrics.memoryUsage = memoryInfo.usedMemory; } catch (error) { console.warn(\u0026#39;Memory monitoring failed:\u0026#39;, error); } }, 5000); } else { // iOSå†…å­˜ç›‘æ§ const getMemoryUsage = () =\u0026gt; { return require(\u0026#39;react-native\u0026#39;).NativeModules.MemoryModule.getMemoryUsage(); }; setInterval(async () =\u0026gt; { try { const memoryUsage = await getMemoryUsage(); this.metrics.memoryUsage = memoryUsage.heapSize; } catch (error) { console.warn(\u0026#39;Memory monitoring failed:\u0026#39;, error); } }, 5000); } } // ç½‘ç»œå»¶è¿Ÿç›‘æ§ startNetworkMonitoring() { const originalFetch = global.fetch; global.fetch = async (...args) =\u0026gt; { const startTime = Date.now(); try { const response = await originalFetch(...args); const endTime = Date.now(); this.metrics.networkLatency = endTime - startTime; return response; } catch (error) { const endTime = Date.now(); this.metrics.networkLatency = endTime - startTime; throw error; } }; } // ä¸ŠæŠ¥æ€§èƒ½æŒ‡æ ‡ reportMetrics() { if (this.metrics.fps \u0026lt; 50) { console.warn(\u0026#39;Low FPS detected:\u0026#39;, this.metrics.fps); // å‘é€åˆ°ç›‘æ§ç³»ç»Ÿ this.sendToAnalytics(\u0026#39;performance_warning\u0026#39;, { fps: this.metrics.fps, memoryUsage: this.metrics.memoryUsage, timestamp: Date.now() }); } } // å‘é€åˆ†ææ•°æ® sendToAnalytics(event, data) { // é›†æˆåˆ†æSDK // Analytics.track(event, data); } } // ä½¿ç”¨ç¤ºä¾‹ const performanceMonitor = new PerformanceMonitor(); performanceMonitor.startMonitoring(); æ¸²æŸ“æ€§èƒ½ä¼˜åŒ– ç»„ä»¶ä¼˜åŒ–ç­–ç•¥ ä½¿ç”¨React.memoé¿å…ä¸å¿…è¦æ¸²æŸ“ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 import React, { memo } from \u0026#39;react\u0026#39;; import { View, Text, TouchableOpacity, StyleSheet } from \u0026#39;react-native\u0026#39;; // æ™®é€šç»„ä»¶ï¼ˆæ¯æ¬¡çˆ¶ç»„ä»¶æ›´æ–°éƒ½ä¼šé‡æ–°æ¸²æŸ“ï¼‰ const ListItem = (props) =\u0026gt; { console.log(\u0026#39;ListItem rendered\u0026#39;); return ( \u0026lt;TouchableOpacity style={styles.item} onPress={props.onPress}\u0026gt; \u0026lt;Text style={styles.title}\u0026gt;{props.title}\u0026lt;/Text\u0026gt; \u0026lt;Text style={styles.subtitle}\u0026gt;{props.subtitle}\u0026lt;/Text\u0026gt; \u0026lt;/TouchableOpacity\u0026gt; ); }; // ä¼˜åŒ–åçš„ç»„ä»¶ï¼ˆä»…åœ¨propså˜åŒ–æ—¶é‡æ–°æ¸²æŸ“ï¼‰ const OptimizedListItem = memo((props) =\u0026gt; { console.log(\u0026#39;OptimizedListItem rendered\u0026#39;); // ä½¿ç”¨useCallbackä¼˜åŒ–å›è°ƒå‡½æ•° const handlePress = React.useCallback(() =\u0026gt; { props.onPress(props.id); }, [props.id, props.onPress]); return ( \u0026lt;TouchableOpacity style={styles.item} onPress={handlePress}\u0026gt; \u0026lt;Text style={styles.title}\u0026gt;{props.title}\u0026lt;/Text\u0026gt; \u0026lt;Text style={styles.subtitle}\u0026gt;{props.subtitle}\u0026lt;/Text\u0026gt; \u0026lt;/TouchableOpacity\u0026gt; ); }, (prevProps, nextProps) =\u0026gt; { // è‡ªå®šä¹‰æ¯”è¾ƒå‡½æ•° return ( prevProps.id === nextProps.id \u0026amp;\u0026amp; prevProps.title === nextProps.title \u0026amp;\u0026amp; prevProps.subtitle === nextProps.subtitle ); }); // å¤æ‚å¯¹è±¡æ¯”è¾ƒä¼˜åŒ– const MemoizedComplexItem = memo(({ user, settings }) =\u0026gt; { const lastUserRef = React.useRef(null); // æ·±åº¦æ¯”è¾ƒuserå¯¹è±¡ if (lastUserRef.current?.id !== user.id || lastUserRef.current?.name !== user.name || lastUserRef.current?.avatar !== user.avatar) { lastUserRef.current = user; console.log(\u0026#39;User data changed, re-rendering\u0026#39;); } return ( \u0026lt;View style={styles.complexItem}\u0026gt; \u0026lt;Image source={{ uri: user.avatar }} style={styles.avatar} /\u0026gt; \u0026lt;View style={styles.userInfo}\u0026gt; \u0026lt;Text style={styles.userName}\u0026gt;{user.name}\u0026lt;/Text\u0026gt; \u0026lt;Text style={styles.userEmail}\u0026gt;{user.email}\u0026lt;/Text\u0026gt; \u0026lt;/View\u0026gt; \u0026lt;/View\u0026gt; ); }); FlatListä¼˜åŒ– 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 174 175 176 177 178 179 180 181 182 183 184 185 186 import React, { useState, useCallback, useMemo, useRef } from \u0026#39;react\u0026#39;; import { FlatList, View, Text, RefreshControl, ActivityIndicator } from \u0026#39;react-native\u0026#39;; const OptimizedFlatList = () =\u0026gt; { const [data, setData] = useState([]); const [loading, setLoading] = useState(false); const [refreshing, setRefreshing] = useState(false); const flatListRef = useRef(null); // ç”Ÿæˆå¤§é‡æµ‹è¯•æ•°æ® const generateData = useCallback((start, count) =\u0026gt; { return Array.from({ length: count }, (_, index) =\u0026gt; ({ id: start + index, title: `Item ${start + index}`, subtitle: `Subtitle for item ${start + index}`, // å¤æ‚å¯¹è±¡ç”¨äºæµ‹è¯•æ¸²æŸ“æ€§èƒ½ metadata: { created: new Date().toISOString(), tags: [\u0026#39;tag1\u0026#39;, \u0026#39;tag2\u0026#39;, \u0026#39;tag3\u0026#39;], score: Math.random() * 100 } })); }, []); // åˆå§‹åŒ–æ•°æ® React.useEffect(() =\u0026gt; { setData(generateData(0, 1000)); }, [generateData]); // æ¸²æŸ“é¡¹ç»„ä»¶ const renderItem = useCallback(({ item, index }) =\u0026gt; { return ( \u0026lt;MemoizedListItem item={item} index={index} onPress={handleItemPress} /\u0026gt; ); }, []); // é¡¹çš„å”¯ä¸€é”® const keyExtractor = useCallback((item) =\u0026gt; item.id.toString(), []); // æ™ºèƒ½æ»šåŠ¨æ€§èƒ½ä¼˜åŒ– const getItemLayout = useCallback((data, index) =\u0026gt; ({ length: ITEM_HEIGHT, offset: ITEM_HEIGHT * index, index, }), []); // å¤„ç†é¡¹ç›®ç‚¹å‡» const handleItemPress = useCallback((id) =\u0026gt; { console.log(\u0026#39;Item pressed:\u0026#39;, id); }, []); // ä¸‹æ‹‰åˆ·æ–° const handleRefresh = useCallback(async () =\u0026gt; { setRefreshing(true); try { // æ¨¡æ‹Ÿç½‘ç»œè¯·æ±‚ await new Promise(resolve =\u0026gt; setTimeout(resolve, 1000)); setData(prevData =\u0026gt; [...generateData(1000, 10), ...prevData]); } catch (error) { console.error(\u0026#39;Refresh failed:\u0026#39;, error); } finally { setRefreshing(false); } }, [generateData]); // åŠ è½½æ›´å¤š const handleLoadMore = useCallback(async () =\u0026gt; { if (loading) return; setLoading(true); try { // æ¨¡æ‹ŸåŠ è½½æ›´å¤š await new Promise(resolve =\u0026gt; setTimeout(resolve, 500)); const newData = generateData(data.length, 20); setData(prevData =\u0026gt; [...prevData, ...newData]); } catch (error) { console.error(\u0026#39;Load more failed:\u0026#39;, error); } finally { setLoading(false); } }, [loading, data.length, generateData]); // åˆ—è¡¨å¤´éƒ¨ç»„ä»¶ const ListHeaderComponent = useMemo(() =\u0026gt; ( \u0026lt;View style={styles.header}\u0026gt; \u0026lt;Text style={styles.headerText}\u0026gt;Optimized List ({data.length} items)\u0026lt;/Text\u0026gt; \u0026lt;/View\u0026gt; ), [data.length]); // åˆ—è¡¨å°¾éƒ¨ç»„ä»¶ const ListFooterComponent = useMemo(() =\u0026gt; ( loading ? ( \u0026lt;View style={styles.footer}\u0026gt; \u0026lt;ActivityIndicator size=\u0026#34;large\u0026#34; color=\u0026#34;#007AFF\u0026#34; /\u0026gt; \u0026lt;Text style={styles.footerText}\u0026gt;Loading more...\u0026lt;/Text\u0026gt; \u0026lt;/View\u0026gt; ) : null ), [loading]); // ç©ºåˆ—è¡¨ç»„ä»¶ const ListEmptyComponent = useMemo(() =\u0026gt; ( \u0026lt;View style={styles.empty}\u0026gt; \u0026lt;Text style={styles.emptyText}\u0026gt;No data available\u0026lt;/Text\u0026gt; \u0026lt;/View\u0026gt; ), []); return ( \u0026lt;FlatList ref={flatListRef} data={data} renderItem={renderItem} keyExtractor={keyExtractor} getItemLayout={getItemLayout} // æ€§èƒ½ä¼˜åŒ–å±æ€§ removeClippedSubviews={true} maxToRenderPerBatch={10} updateCellsBatchingPeriod={50} initialNumToRender={10} windowSize={10} // æ»šåŠ¨ä¼˜åŒ– showsVerticalScrollIndicator={false} contentContainerStyle={styles.listContainer} // åŠ è½½å’Œåˆ·æ–° refreshControl={ \u0026lt;RefreshControl refreshing={refreshing} onRefresh={handleRefresh} colors={[\u0026#39;#007AFF\u0026#39;]} tintColor=\u0026#34;#007AFF\u0026#34; /\u0026gt; } // ç»„ä»¶é…ç½® ListHeaderComponent={ListHeaderComponent} ListFooterComponent={ListFooterComponent} ListEmptyComponent={ListEmptyComponent} // æ»šåŠ¨åˆ°åº•éƒ¨åŠ è½½æ›´å¤š onEndReached={handleLoadMore} onEndReachedThreshold={0.1} /\u0026gt; ); }; // ä¼˜åŒ–çš„åˆ—è¡¨é¡¹ç»„ä»¶ const MemoizedListItem = memo(({ item, index, onPress }) =\u0026gt; { // ä½¿ç”¨useMemoç¼“å­˜è®¡ç®—ç»“æœ const formattedTitle = useMemo(() =\u0026gt; { return `${item.title} #${index + 1}`; }, [item.title, index]); const metadataInfo = useMemo(() =\u0026gt; { const score = Math.round(item.metadata.score); const tags = item.metadata.tags.slice(0, 2).join(\u0026#39;, \u0026#39;); return `Score: ${score} | Tags: ${tags}`; }, [item.metadata]); return ( \u0026lt;TouchableOpacity style={styles.item} onPress={() =\u0026gt; onPress(item.id)} activeOpacity={0.7} \u0026gt; \u0026lt;View style={styles.itemContent}\u0026gt; \u0026lt;Text style={styles.itemTitle} numberOfLines={1}\u0026gt; {formattedTitle} \u0026lt;/Text\u0026gt; \u0026lt;Text style={styles.itemSubtitle} numberOfLines={2}\u0026gt; {item.subtitle} \u0026lt;/Text\u0026gt; \u0026lt;Text style={styles.itemMetadata}\u0026gt; {metadataInfo} \u0026lt;/Text\u0026gt; \u0026lt;/View\u0026gt; \u0026lt;/TouchableOpacity\u0026gt; ); }); åŠ¨ç”»æ€§èƒ½ä¼˜åŒ– 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 174 175 176 177 178 179 180 181 182 183 184 185 186 187 188 189 190 191 192 193 194 195 196 197 198 199 200 201 202 203 204 205 206 207 208 209 210 211 212 213 214 215 216 217 218 219 220 221 222 223 224 225 226 227 228 229 230 231 232 233 import React, { useRef, useEffect } from \u0026#39;react\u0026#39;; import { View, Text, StyleSheet, Animated, PanGestureHandler, State } from \u0026#39;react-native\u0026#39;; import { PanGestureHandler } from \u0026#39;react-native-gesture-handler\u0026#39;; // ä½¿ç”¨åŸç”Ÿé©±åŠ¨çš„é«˜æ€§èƒ½åŠ¨ç”» const AnimatedCard = ({ title, content, onSwipe }) =\u0026gt; { const translateX = useRef(new Animated.Value(0)).current; const scale = useRef(new Animated.Value(1)).current; const opacity = useRef(new Animated.Value(1)).current; // æ‰‹åŠ¿å¤„ç† const onGestureEvent = Animated.event( [{ nativeEvent: { translationX: translateX } }], { useNativeDriver: true } ); const onHandlerStateChange = (event) =\u0026gt; { if (event.nativeEvent.state === State.END) { const { translationX } = event.nativeEvent; // åˆ¤æ–­æ»‘åŠ¨æ–¹å‘å’Œè·ç¦» if (Math.abs(translationX) \u0026gt; 100) { // æ‰§è¡Œæ»‘å‡ºåŠ¨ç”» Animated.parallel([ Animated.timing(translateX, { toValue: translationX \u0026gt; 0 ? 300 : -300, duration: 250, useNativeDriver: true }), Animated.timing(opacity, { toValue: 0, duration: 250, useNativeDriver: true }) ]).start(() =\u0026gt; { onSwipe(translationX \u0026gt; 0 ? \u0026#39;right\u0026#39; : \u0026#39;left\u0026#39;); }); } else { // å›å¼¹åŠ¨ç”» Animated.spring(translateX, { toValue: 0, useNativeDriver: true, tension: 100, friction: 8 }).start(); } } }; // è¿›å…¥åŠ¨ç”» useEffect(() =\u0026gt; { Animated.parallel([ Animated.spring(scale, { toValue: 1, fromValue: 0.8, useNativeDriver: true, tension: 100, friction: 8 }), Animated.timing(opacity, { toValue: 1, fromValue: 0, duration: 200, useNativeDriver: true }) ]).start(); }, []); // æŒ‰å‹åŠ¨ç”» const handlePressIn = () =\u0026gt; { Animated.spring(scale, { toValue: 0.95, useNativeDriver: true, tension: 200, friction: 8 }).start(); }; const handlePressOut = () =\u0026gt; { Animated.spring(scale, { toValue: 1, useNativeDriver: true, tension: 200, friction: 8 }).start(); }; return ( \u0026lt;Animated.View style={[ styles.card, { transform: [ { translateX }, { scale } ], opacity } ]} \u0026gt; \u0026lt;PanGestureHandler onGestureEvent={onGestureEvent} onHandlerStateChange={onHandlerStateChange} \u0026gt; \u0026lt;Animated.View style={styles.cardContent} onStartShouldSetResponder={() =\u0026gt; true} onResponderGrant={handlePressIn} onResponderRelease={handlePressOut} \u0026gt; \u0026lt;Text style={styles.title}\u0026gt;{title}\u0026lt;/Text\u0026gt; \u0026lt;Text style={styles.content}\u0026gt;{content}\u0026lt;/Text\u0026gt; \u0026lt;/Animated.View\u0026gt; \u0026lt;/PanGestureHandler\u0026gt; \u0026lt;/Animated.View\u0026gt; ); }; // å¤æ‚åŠ¨ç”»åºåˆ— const ComplexAnimation = () =\u0026gt; { const animatedValues = useRef({ scale: new Animated.Value(0), rotate: new Animated.Value(0), translateX: new Animated.Value(0), opacity: new Animated.Value(0) }).current; // æ‰§è¡Œå¤æ‚åŠ¨ç”»åºåˆ— const startComplexAnimation = () =\u0026gt; { const sequence = [ // ç¬¬ä¸€é˜¶æ®µï¼šæ·¡å…¥å’Œç¼©æ”¾ Animated.parallel([ Animated.timing(animatedValues.opacity, { toValue: 1, duration: 300, useNativeDriver: true }), Animated.spring(animatedValues.scale, { toValue: 1, tension: 100, friction: 8, useNativeDriver: true }) ]), // ç¬¬äºŒé˜¶æ®µï¼šæ—‹è½¬å’Œç§»åŠ¨ Animated.parallel([ Animated.timing(animatedValues.rotate, { toValue: 1, duration: 500, useNativeDriver: true }), Animated.timing(animatedValues.translateX, { toValue: 100, duration: 500, useNativeDriver: true }) ]), // ç¬¬ä¸‰é˜¶æ®µï¼šå›å¼¹ Animated.spring(animatedValues.translateX, { toValue: 0, tension: 100, friction: 8, useNativeDriver: true }) ]; Animated.sequence(sequence).start(); }; return ( \u0026lt;Animated.View style={[ styles.animatedBox, { transform: [ { scale: animatedValues.scale }, { rotate: animatedValues.rotate.interpolate({ inputRange: [0, 1], outputRange: [\u0026#39;0deg\u0026#39;, \u0026#39;360deg\u0026#39;] }) }, { translateX: animatedValues.translateX } ], opacity: animatedValues.opacity } ]} /\u0026gt; ); }; // åˆ—è¡¨é¡¹è¿›å…¥åŠ¨ç”» const ListItemEnterAnimation = ({ children, index, delay }) =\u0026gt; { const translateY = useRef(new Animated.Value(50)).current; const opacity = useRef(new Animated.Value(0)).current; useEffect(() =\u0026gt; { const timer = setTimeout(() =\u0026gt; { Animated.parallel([ Animated.timing(translateY, { toValue: 0, duration: 300, useNativeDriver: true }), Animated.timing(opacity, { toValue: 1, duration: 300, useNativeDriver: true }) ]).start(); }, delay * index); return () =\u0026gt; clearTimeout(timer); }, [index, delay]); return ( \u0026lt;Animated.View style={{ transform: [{ translateY }], opacity }} \u0026gt; {children} \u0026lt;/Animated.View\u0026gt; ); }; å†…å­˜ç®¡ç†ä¼˜åŒ– å›¾ç‰‡å†…å­˜ä¼˜åŒ– 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 174 175 176 177 178 179 180 181 182 183 184 185 186 187 188 189 190 191 192 193 194 195 196 197 198 199 200 201 202 203 204 205 206 207 208 209 210 211 212 213 214 215 216 217 218 219 220 221 222 223 import React, { useState, useEffect, useCallback } from \u0026#39;react\u0026#39;; import { Image, View, Dimensions } from \u0026#39;react-native\u0026#39;; // å›¾ç‰‡ç¼“å­˜ç®¡ç†å™¨ class ImageCacheManager { constructor(maxCacheSize = 100) { this.cache = new Map(); this.maxCacheSize = maxCacheSize; this.accessOrder = []; } // è·å–ç¼“å­˜çš„å›¾ç‰‡ get(uri) { if (this.cache.has(uri)) { // æ›´æ–°è®¿é—®é¡ºåº this.updateAccessOrder(uri); return Promise.resolve(this.cache.get(uri)); } // åŠ è½½å¹¶ç¼“å­˜å›¾ç‰‡ return this.loadAndCache(uri); } // åŠ è½½å¹¶ç¼“å­˜å›¾ç‰‡ async loadAndCache(uri) { try { // é¢„åŠ è½½å›¾ç‰‡ä¿¡æ¯ä»¥è·å–å°ºå¯¸ const imageInfo = await this.getImageInfo(uri); // æ ¹æ®å±å¹•å°ºå¯¸è°ƒæ•´å›¾ç‰‡å¤§å° const optimizedUri = this.optimizeImageUri(uri, imageInfo); // åŠ è½½ä¼˜åŒ–åçš„å›¾ç‰‡ const image = await this.loadImage(optimizedUri); // æ·»åŠ åˆ°ç¼“å­˜ this.addToCache(uri, image); return image; } catch (error) { console.error(\u0026#39;Failed to load image:\u0026#39;, uri, error); throw error; } } // ä¼˜åŒ–å›¾ç‰‡URI optimizeImageUri(originalUri, imageInfo) { const { width: screenWidth } = Dimensions.get(\u0026#39;window\u0026#39;); const { width: imageWidth, height: imageHeight } = imageInfo; // å¦‚æœå›¾ç‰‡å®½åº¦è¿‡å¤§ï¼Œæ·»åŠ å°ºå¯¸å‚æ•° if (imageWidth \u0026gt; screenWidth * 2) { const separator = originalUri.includes(\u0026#39;?\u0026#39;) ? \u0026#39;\u0026amp;\u0026#39; : \u0026#39;?\u0026#39;; return `${originalUri}${separator}w=${screenWidth * 2}`; } return originalUri; } // åŠ è½½å›¾ç‰‡ loadImage(uri) { return new Promise((resolve, reject) =\u0026gt; { Image.getSize( uri, (width, height) =\u0026gt; { resolve({ uri, width, height }); }, reject ); }); } // è·å–å›¾ç‰‡ä¿¡æ¯ getImageInfo(uri) { return new Promise((resolve, reject) =\u0026gt; { Image.getSize( uri, (width, height) =\u0026gt; resolve({ width, height }), reject ); }); } // æ·»åŠ åˆ°ç¼“å­˜ addToCache(uri, image) { // å¦‚æœç¼“å­˜å·²æ»¡ï¼Œåˆ é™¤æœ€ä¹…æœªä½¿ç”¨çš„å›¾ç‰‡ if (this.cache.size \u0026gt;= this.maxCacheSize) { const oldestUri = this.accessOrder.shift(); this.cache.delete(oldestUri); } this.cache.set(uri, image); this.accessOrder.push(uri); } // æ›´æ–°è®¿é—®é¡ºåº updateAccessOrder(uri) { const index = this.accessOrder.indexOf(uri); if (index \u0026gt; -1) { this.accessOrder.splice(index, 1); } this.accessOrder.push(uri); } // æ¸…ç†ç¼“å­˜ clearCache() { this.cache.clear(); this.accessOrder = []; } // è·å–ç¼“å­˜å¤§å° getCacheSize() { return this.cache.size; } } // ä¼˜åŒ–çš„å›¾ç‰‡ç»„ä»¶ const OptimizedImage = ({ source, style, placeholder, onLoad, onError, resizeMode = \u0026#39;cover\u0026#39; }) =\u0026gt; { const [imageLoaded, setImageLoaded] = useState(false); const [imageSource, setImageSource] = useState(placeholder || null); const cacheManager = React.useMemo(() =\u0026gt; new ImageCacheManager(), []); useEffect(() =\u0026gt; { const uri = typeof source === \u0026#39;string\u0026#39; ? source : source.uri; if (!uri) return; // ä»ç¼“å­˜è·å–å›¾ç‰‡ cacheManager.get(uri) .then(cachedImage =\u0026gt; { setImageSource(cachedImage); setImageLoaded(true); onLoad?.(cachedImage); }) .catch(error =\u0026gt; { console.error(\u0026#39;Image load failed:\u0026#39;, error); onError?.(error); }); // æ¸…ç†å‡½æ•° return () =\u0026gt; { // å¯ä»¥åœ¨è¿™é‡Œæ·»åŠ æ¸…ç†é€»è¾‘ }; }, [source, onLoad, onError, cacheManager]); // ä½¿ç”¨blurhashä½œä¸ºå ä½ç¬¦ const [blurhash] = useState(\u0026#39;LGF5?xYk^6#M@-5c,1J5@[or[Q6.\u0026#39;); return ( \u0026lt;View style={style}\u0026gt; {!imageLoaded \u0026amp;\u0026amp; placeholder \u0026amp;\u0026amp; ( \u0026lt;Image source={placeholder} style={[style, { position: \u0026#39;absolute\u0026#39; }]} blurRadius={2} /\u0026gt; )} \u0026lt;Image source={imageSource} style={[ style, { opacity: imageLoaded ? 1 : 0 } ]} resizeMode={resizeMode} onLoad={() =\u0026gt; setImageLoaded(true)} /\u0026gt; \u0026lt;/View\u0026gt; ); }; // å›¾ç‰‡æ‡’åŠ è½½ç»„ä»¶ const LazyImage = ({ source, style, containerStyle, lazy = true, threshold = 100 }) =\u0026gt; { const [isVisible, setIsVisible] = useState(!lazy); const [hasLoaded, setHasLoaded] = useState(false); const viewRef = React.useRef(null); useEffect(() =\u0026gt; { if (!lazy) return; const observer = new IntersectionObserver( ([entry]) =\u0026gt; { if (entry.isIntersecting) { setIsVisible(true); observer.disconnect(); } }, { threshold: 0.1, rootMargin: `${threshold}px` } ); if (viewRef.current) { observer.observe(viewRef.current); } return () =\u0026gt; observer.disconnect(); }, [lazy, threshold]); return ( \u0026lt;View ref={viewRef} style={containerStyle}\u0026gt; {isVisible \u0026amp;\u0026amp; ( \u0026lt;OptimizedImage source={source} style={style} onLoad={() =\u0026gt; setHasLoaded(true)} placeholder={require(\u0026#39;./assets/placeholder.png\u0026#39;)} /\u0026gt; )} \u0026lt;/View\u0026gt; ); }; ç½‘ç»œè¯·æ±‚ä¼˜åŒ– è¯·æ±‚ç¼“å­˜ä¸æ‰¹å¤„ç† 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 174 175 176 177 178 179 180 181 182 183 184 185 186 187 188 189 190 191 192 193 194 195 196 197 198 199 200 201 202 203 204 205 206 207 208 209 210 211 212 213 214 215 216 217 218 219 220 221 222 223 224 225 226 227 228 229 230 231 232 233 234 235 236 237 238 239 240 241 242 243 244 245 246 247 248 249 250 251 252 253 254 255 256 257 258 259 260 261 262 263 264 265 266 267 268 269 270 271 272 273 274 275 276 277 278 279 280 281 282 283 284 285 286 287 288 289 290 291 292 293 294 295 296 297 298 299 300 301 302 303 304 305 306 307 308 309 310 311 312 313 314 315 316 317 318 319 320 321 // ç½‘ç»œè¯·æ±‚ç®¡ç†å™¨ class NetworkManager { constructor() { this.cache = new Map(); this.pendingRequests = new Map(); this.batchQueue = []; this.batchTimeout = null; this.batchDelay = 50; // 50msæ‰¹å¤„ç†å»¶è¿Ÿ } // è¯·æ±‚é…ç½® defaultConfig = { timeout: 10000, cache: true, cacheTime: 5 * 60 * 1000, // 5åˆ†é’Ÿ retry: 3, retryDelay: 1000 }; // å‘é€è¯·æ±‚ async request(url, options = {}, config = {}) { const finalConfig = { ...this.defaultConfig, ...config }; const cacheKey = this.getCacheKey(url, options); // æ£€æŸ¥ç¼“å­˜ if (finalConfig.cache \u0026amp;\u0026amp; this.cache.has(cacheKey)) { const cached = this.cache.get(cacheKey); if (Date.now() - cached.timestamp \u0026lt; finalConfig.cacheTime) { return cached.data; } else { this.cache.delete(cacheKey); } } // æ£€æŸ¥æ˜¯å¦æœ‰ç›¸åŒè¯·æ±‚æ­£åœ¨è¿›è¡Œ if (this.pendingRequests.has(cacheKey)) { return this.pendingRequests.get(cacheKey); } // åˆ›å»ºè¯·æ±‚Promise const requestPromise = this.executeRequest(url, options, finalConfig); this.pendingRequests.set(cacheKey, requestPromise); try { const response = await requestPromise; // ç¼“å­˜å“åº” if (finalConfig.cache \u0026amp;\u0026amp; response.ok) { this.cache.set(cacheKey, { data: response, timestamp: Date.now() }); } return response; } finally { this.pendingRequests.delete(cacheKey); } } // æ‰§è¡Œè¯·æ±‚ async executeRequest(url, options, config) { let lastError; for (let attempt = 0; attempt \u0026lt;= config.retry; attempt++) { try { const controller = new AbortController(); const timeoutId = setTimeout(() =\u0026gt; controller.abort(), config.timeout); const response = await fetch(url, { ...options, signal: controller.signal, headers: { \u0026#39;Content-Type\u0026#39;: \u0026#39;application/json\u0026#39;, ...options.headers } }); clearTimeout(timeoutId); if (!response.ok) { throw new Error(`HTTP ${response.status}: ${response.statusText}`); } const data = await response.json(); return { ...response, data }; } catch (error) { lastError = error; if (attempt \u0026lt; config.retry) { // æŒ‡æ•°é€€é¿é‡è¯• const delay = config.retryDelay * Math.pow(2, attempt); await new Promise(resolve =\u0026gt; setTimeout(resolve, delay)); } } } throw lastError; } // æ‰¹é‡è¯·æ±‚ batchRequest(requests) { return new Promise((resolve, reject) =\u0026gt; { this.batchQueue.push({ requests, resolve, reject }); if (this.batchTimeout) { clearTimeout(this.batchTimeout); } this.batchTimeout = setTimeout(() =\u0026gt; { this.processBatch(); }, this.batchDelay); }); } // å¤„ç†æ‰¹é‡è¯·æ±‚ async processBatch() { if (this.batchQueue.length === 0) return; const batch = this.batchQueue.splice(0); const allRequests = batch.flatMap(item =\u0026gt; item.requests); try { const responses = await Promise.allSettled( allRequests.map(req =\u0026gt; this.request(req.url, req.options, req.config)) ); // æŒ‰æ‰¹æ¬¡åˆ†ç»„å“åº” let responseIndex = 0; batch.forEach(({ requests, resolve }) =\u0026gt; { const batchResponses = responses.slice( responseIndex, responseIndex + requests.length ); responseIndex += requests.length; resolve(batchResponses); }); } catch (error) { batch.forEach(({ reject }) =\u0026gt; reject(error)); } } // å¹¶å‘æ§åˆ¶è¯·æ±‚ async concurrentRequests(requests, maxConcurrent = 3) { const results = []; const executing = []; for (const [index, request] of requests.entries()) { const promise = this.request(request.url, request.options, request.config) .then(response =\u0026gt; ({ index, response })) .catch(error =\u0026gt; ({ index, error })); results.push(promise); executing.push(promise); if (executing.length \u0026gt;= maxConcurrent) { await Promise.race(executing); executing.splice(executing.findIndex(p =\u0026gt; p === promise), 1); } } return Promise.allSettled(results); } // ç”Ÿæˆç¼“å­˜é”® getCacheKey(url, options) { const optionsStr = JSON.stringify(options); return `${url}:${optionsStr}`; } // æ¸…ç†ç¼“å­˜ clearCache() { this.cache.clear(); } // è·å–ç¼“å­˜ç»Ÿè®¡ getCacheStats() { return { size: this.cache.size, keys: Array.from(this.cache.keys()) }; } } // GraphQLæŸ¥è¯¢ç®¡ç†å™¨ class GraphQLManager extends NetworkManager { constructor(endpoint) { super(); this.endpoint = endpoint; this.queryCache = new Map(); } // æ‰§è¡ŒGraphQLæŸ¥è¯¢ async query(query, variables = {}, options = {}) { const cacheKey = this.getGraphQLCacheKey(query, variables); // æ£€æŸ¥æŸ¥è¯¢ç¼“å­˜ if (this.queryCache.has(cacheKey)) { return this.queryCache.get(cacheKey); } const response = await this.request(this.endpoint, { method: \u0026#39;POST\u0026#39;, body: JSON.stringify({ query, variables }) }, options); // ç¼“å­˜æŸ¥è¯¢ç»“æœ if (response.ok) { this.queryCache.set(cacheKey, response.data); } return response; } // ç”ŸæˆGraphQLç¼“å­˜é”® getGraphQLCacheKey(query, variables) { const queryStr = typeof query === \u0026#39;string\u0026#39; ? query : query.loc?.source.body || \u0026#39;\u0026#39;; const variablesStr = JSON.stringify(variables); const hash = this.simpleHash(queryStr + variablesStr); return `gql_${hash}`; } // ç®€å•å“ˆå¸Œå‡½æ•° simpleHash(str) { let hash = 0; for (let i = 0; i \u0026lt; str.length; i++) { const char = str.charCodeAt(i); hash = ((hash \u0026lt;\u0026lt; 5) - hash) + char; hash = hash \u0026amp; hash; } return hash.toString(36); } // é¢„å–æŸ¥è¯¢ prefetch(query, variables, options) { // ä¸ç­‰å¾…ç»“æœï¼Œå¼‚æ­¥é¢„å– this.query(query, variables, { ...options, cache: true }); } } // ä½¿ç”¨ç¤ºä¾‹ const networkManager = new NetworkManager(); const graphqlManager = new GraphQLManager(\u0026#39;https://api.example.com/graphql\u0026#39;); // APIæœåŠ¡ const ApiService = { // è·å–ç”¨æˆ·ä¿¡æ¯ async getUser(userId) { return networkManager.request( `https://api.example.com/users/${userId}`, { method: \u0026#39;GET\u0026#39; }, { cache: true, cacheTime: 10 * 60 * 1000 } ); }, // æ‰¹é‡è·å–ç”¨æˆ·ä¿¡æ¯ async getUsersBatch(userIds) { const requests = userIds.map(id =\u0026gt; ({ url: `https://api.example.com/users/${id}`, options: { method: \u0026#39;GET\u0026#39; } })); const responses = await networkManager.concurrentRequests(requests, 5); return responses .filter(r =\u0026gt; r.status === \u0026#39;fulfilled\u0026#39;) .map(r =\u0026gt; r.value.data); }, // GraphQLæŸ¥è¯¢ç¤ºä¾‹ async getUserPosts(userId, limit = 10) { const query = ` query GetUserPosts($userId: ID!, $limit: Int!) { user(id: $userId) { posts(first: $limit) { edges { node { id title content createdAt } } } } } `; return graphqlManager.query(query, { userId, limit }); }, // é¢„å–ç”¨æˆ·æ•°æ® prefetchUserData(userId) { networkManager.request( `https://api.example.com/users/${userId}/profile`, { method: \u0026#39;GET\u0026#39; }, { cache: true } ); graphqlManager.prefetch(` query GetUserDetails($userId: ID!) { user(id: $userId) { friends { id name avatar } achievements { id title description } } } `, { userId }); } }; å¯åŠ¨æ€§èƒ½ä¼˜åŒ– Bundleæ‹†åˆ†ä¸æ‡’åŠ è½½ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 174 175 176 177 178 179 180 181 182 183 184 185 186 187 188 189 190 191 192 193 194 195 196 197 198 199 200 201 202 203 204 205 206 207 208 209 210 211 212 213 214 215 216 217 218 219 220 221 222 223 224 225 226 227 228 229 230 231 232 233 234 235 236 237 238 239 240 241 242 243 244 245 246 247 248 249 250 251 252 253 254 255 256 257 258 259 260 261 262 263 264 265 266 267 268 269 // å¼‚æ­¥ç»„ä»¶åŠ è½½ const AsyncComponentLoader = ({ componentLoader, fallback }) =\u0026gt; { const [Component, setComponent] = useState(null); useEffect(() =\u0026gt; { componentLoader() .then(module =\u0026gt; { setComponent(() =\u0026gt; module.default); }) .catch(error =\u0026gt; { console.error(\u0026#39;Component loading failed:\u0026#39;, error); }); }, [componentLoader]); if (!Component) { return fallback || \u0026lt;ActivityIndicator size=\u0026#34;large\u0026#34; /\u0026gt;; } return \u0026lt;Component /\u0026gt;; }; // ä½¿ç”¨ç¤ºä¾‹ const LazyUserProfile = () =\u0026gt; ( \u0026lt;AsyncComponentLoader componentLoader={() =\u0026gt; import(\u0026#39;./UserProfile\u0026#39;)} fallback={\u0026lt;View\u0026gt;\u0026lt;Text\u0026gt;Loading profile...\u0026lt;/Text\u0026gt;\u0026lt;/View\u0026gt;} /\u0026gt; ); const LazySettings = () =\u0026gt; ( \u0026lt;AsyncComponentLoader componentLoader={() =\u0026gt; import(\u0026#39;./Settings\u0026#39;)} fallback={\u0026lt;View\u0026gt;\u0026lt;Text\u0026gt;Loading settings...\u0026lt;/Text\u0026gt;\u0026lt;/View\u0026gt;} /\u0026gt; ); // è·¯ç”±çº§åˆ«çš„ä»£ç åˆ†å‰² const createLazyRoute = (componentPath) =\u0026gt; { return () =\u0026gt; { const Component = React.lazy(() =\u0026gt; import(componentPath)); return ( \u0026lt;React.Suspense fallback={\u0026lt;ActivityIndicator size=\u0026#34;large\u0026#34; /\u0026gt;}\u0026gt; \u0026lt;Component /\u0026gt; \u0026lt;/React.Suspense\u0026gt; ); }; }; // ä½¿ç”¨ä»£ç åˆ†å‰²çš„è·¯ç”±é…ç½® const routes = { Home: createLazyRoute(\u0026#39;./screens/Home\u0026#39;), Profile: createLazyRoute(\u0026#39;./screens/Profile\u0026#39;), Settings: createLazyRoute(\u0026#39;./screens/Settings\u0026#39;), Chat: createLazyRoute(\u0026#39;./screens/Chat\u0026#39;) }; // Metroé…ç½®ä¼˜åŒ– (metro.config.js) module.exports = { transformer: { getTransformOptions: async () =\u0026gt; ({ transform: { experimentalImportSupport: false, inlineRequires: true, }, }), }, resolver: { alias: { \u0026#39;@\u0026#39;: \u0026#39;./src\u0026#39;, \u0026#39;@components\u0026#39;: \u0026#39;./src/components\u0026#39;, \u0026#39;@screens\u0026#39;: \u0026#39;./src/screens\u0026#39;, \u0026#39;@utils\u0026#39;: \u0026#39;./src/utils\u0026#39;, \u0026#39;@assets\u0026#39;: \u0026#39;./src/assets\u0026#39; } }, watchFolders: [ \u0026#39;./src\u0026#39; ], maxWorkers: 4, resetCache: true, // å¯ç”¨å‹ç¼© minifierConfig: { keep_fnames: true, mangle: { keep_fnames: true } } }; // Bundleåˆ†æå·¥å…· const BundleAnalyzer = { // è·å–Bundleå¤§å°ä¿¡æ¯ async getBundleInfo(platform = \u0026#39;android\u0026#39;) { const fs = require(\u0026#39;fs\u0026#39;); const path = require(\u0026#39;path\u0026#39;); const bundlePath = platform === \u0026#39;android\u0026#39; ? \u0026#39;android/app/build/generated/assets/react/release/index.android.bundle\u0026#39; : \u0026#39;ios/YourApp/build/Build/Products/Release-iphoneos/YourApp.app/main.jsbundle\u0026#39;; try { const stats = fs.statSync(bundlePath); return { size: stats.size, sizeFormatted: this.formatFileSize(stats.size), path: bundlePath }; } catch (error) { console.error(\u0026#39;Bundle file not found:\u0026#39;, bundlePath); return null; } }, // æ ¼å¼åŒ–æ–‡ä»¶å¤§å° formatFileSize(bytes) { if (bytes === 0) return \u0026#39;0 Bytes\u0026#39;; const k = 1024; const sizes = [\u0026#39;Bytes\u0026#39;, \u0026#39;KB\u0026#39;, \u0026#39;MB\u0026#39;, \u0026#39;GB\u0026#39;]; const i = Math.floor(Math.log(bytes) / Math.log(k)); return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + \u0026#39; \u0026#39; + sizes[i]; }, // åˆ†æBundleå†…å®¹ async analyzeBundle() { const { execSync } = require(\u0026#39;child_process\u0026#39;); try { // ä½¿ç”¨react-native-bundle-visualizer const result = execSync(\u0026#39;npx react-native-bundle-visualizer\u0026#39;, { encoding: \u0026#39;utf8\u0026#39; }); console.log(\u0026#39;Bundle analysis completed\u0026#39;); return result; } catch (error) { console.error(\u0026#39;Bundle analysis failed:\u0026#39;, error); return null; } } }; // é¢„åŠ è½½ç®¡ç†å™¨ class PreloadManager { constructor() { this.preloadQueue = []; this.isPreloading = false; } // æ·»åŠ é¢„åŠ è½½ä»»åŠ¡ addPreloadTask(task) { this.preloadQueue.push(task); if (!this.isPreloading) { this.startPreload(); } } // å¼€å§‹é¢„åŠ è½½ async startPreload() { if (this.isPreloading || this.preloadQueue.length === 0) return; this.isPreloading = true; while (this.preloadQueue.length \u0026gt; 0) { const task = this.preloadQueue.shift(); try { await this.executePreloadTask(task); } catch (error) { console.error(\u0026#39;Preload task failed:\u0026#39;, error); } // ç»™UIçº¿ç¨‹ä¸€äº›æ—¶é—´ await new Promise(resolve =\u0026gt; setTimeout(resolve, 100)); } this.isPreloading = false; } // æ‰§è¡Œé¢„åŠ è½½ä»»åŠ¡ async executePreloadTask(task) { switch (task.type) { case \u0026#39;component\u0026#39;: await import(task.componentPath); break; case \u0026#39;image\u0026#39;: await Image.prefetch(task.imageUrl); break; case \u0026#39;data\u0026#39;: await task.dataLoader(); break; case \u0026#39;asset\u0026#39;: await this.preloadAsset(task.assetPath); break; default: console.warn(\u0026#39;Unknown preload task type:\u0026#39;, task.type); } } // é¢„åŠ è½½èµ„æº async preloadAsset(assetPath) { // å®ç°èµ„æºé¢„åŠ è½½é€»è¾‘ return new Promise(resolve =\u0026gt; { setTimeout(resolve, 100); // æ¨¡æ‹Ÿé¢„åŠ è½½ }); } // é¢„åŠ è½½å¸¸ç”¨ç»„ä»¶ preloadCommonComponents() { this.addPreloadTask({ type: \u0026#39;component\u0026#39;, componentPath: \u0026#39;./screens/Home\u0026#39; }); this.addPreloadTask({ type: \u0026#39;component\u0026#39;, componentPath: \u0026#39;./screens/Profile\u0026#39; }); } // é¢„åŠ è½½å…³é”®å›¾ç‰‡ preloadKeyImages() { const keyImages = [ \u0026#39;https://example.com/logo.png\u0026#39;, \u0026#39;https://example.com/hero-image.jpg\u0026#39;, \u0026#39;https://example.com/background.jpg\u0026#39; ]; keyImages.forEach(imageUrl =\u0026gt; { this.addPreloadTask({ type: \u0026#39;image\u0026#39;, imageUrl }); }); } // é¢„åŠ è½½ç”¨æˆ·æ•°æ® preloadUserData(userId) { this.addPreloadTask({ type: \u0026#39;data\u0026#39;, dataLoader: () =\u0026gt; ApiService.getUser(userId) }); this.addPreloadTask({ type: \u0026#39;data\u0026#39;, dataLoader: () =\u0026gt; ApiService.getUserPosts(userId) }); } } // ä½¿ç”¨é¢„åŠ è½½ç®¡ç†å™¨ const preloadManager = new PreloadManager(); // åœ¨åº”ç”¨å¯åŠ¨æ—¶é¢„åŠ è½½ AppRegistry.registerComponent(\u0026#39;MyApp\u0026#39;, () =\u0026gt; { // å¯åŠ¨é¢„åŠ è½½ preloadManager.preloadCommonComponents(); preloadManager.preloadKeyImages(); return App; }); æ€§èƒ½ç›‘æ§ä¸åˆ†æ å®æ—¶æ€§èƒ½ç›‘æ§ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 174 175 176 177 178 179 180 181 182 183 184 185 186 187 188 189 190 191 192 193 194 195 196 197 198 199 200 201 202 203 204 205 206 207 208 209 210 211 212 213 214 215 216 217 218 219 220 221 222 223 224 225 226 227 228 229 230 231 232 233 234 235 236 237 238 239 240 241 242 243 244 245 246 247 248 249 250 251 252 253 254 255 256 257 258 259 260 261 262 263 264 265 266 267 268 269 270 271 272 273 274 275 276 277 278 279 280 281 282 283 284 285 286 287 288 289 290 291 292 293 294 295 296 297 298 299 300 301 302 303 304 305 306 307 308 309 310 311 312 313 314 315 316 317 318 319 320 321 322 323 324 325 326 327 328 329 330 331 332 333 334 335 336 337 338 339 340 341 342 343 344 345 346 347 348 349 350 351 352 353 354 355 356 357 358 359 360 361 362 363 364 365 366 367 368 369 370 371 372 373 374 375 376 377 378 379 380 381 382 383 384 385 386 387 388 389 390 391 392 393 394 395 396 397 398 399 400 401 402 403 404 405 406 407 408 409 410 411 412 413 414 415 416 417 418 419 420 421 422 423 424 425 426 427 428 429 430 431 432 433 434 435 436 // æ€§èƒ½ç›‘æ§SDK class PerformanceSDK { constructor(config) { this.config = { apiKey: config.apiKey, endpoint: config.endpoint, enableCrashReporting: config.enableCrashReporting || true, enableANRReporting: config.enableANRReporting || true, enableNetworkMonitoring: config.enableNetworkMonitoring || true, enableMemoryLeakDetection: config.enableMemoryLeakDetection || true, sampleRate: config.sampleRate || 1.0 }; this.metrics = { fps: [], memory: [], network: [], crashes: [], anr: [] }; this.isInitialized = false; } // åˆå§‹åŒ–SDK async initialize() { if (this.isInitialized) return; try { // è®¾ç½®å…¨å±€é”™è¯¯å¤„ç† if (this.config.enableCrashReporting) { this.setupCrashReporting(); } // è®¾ç½®ANRç›‘æ§ if (this.config.enableANRReporting) { this.setupANRMonitoring(); } // è®¾ç½®ç½‘ç»œç›‘æ§ if (this.config.enableNetworkMonitoring) { this.setupNetworkMonitoring(); } // è®¾ç½®å†…å­˜æ³„æ¼æ£€æµ‹ if (this.config.enableMemoryLeakDetection) { this.setupMemoryLeakDetection(); } this.isInitialized = true; console.log(\u0026#39;Performance SDK initialized\u0026#39;); } catch (error) { console.error(\u0026#39;Failed to initialize Performance SDK:\u0026#39;, error); } } // è®¾ç½®å´©æºƒæŠ¥å‘Š setupCrashReporting() { const defaultErrorHandler = ErrorUtils.getGlobalHandler(); ErrorUtils.setGlobalHandler((error, isFatal) =\u0026gt; { // è®°å½•å´©æºƒä¿¡æ¯ const crashInfo = { message: error.message, stack: error.stack, isFatal, timestamp: Date.now(), deviceInfo: this.getDeviceInfo(), appState: this.getAppState() }; this.metrics.crashes.push(crashInfo); // ä¸ŠæŠ¥å´©æºƒ this.reportCrash(crashInfo); // è°ƒç”¨åŸå§‹é”™è¯¯å¤„ç†å™¨ defaultErrorHandler(error, isFatal); }); } // è®¾ç½®ANRç›‘æ§ setupANRMonitoring() { let isChecking = false; const checkANR = () =\u0026gt; { if (isChecking) return; isChecking = true; const startTime = Date.now(); // ä½¿ç”¨setTimeoutæ£€æµ‹é˜»å¡ setTimeout(() =\u0026gt; { const endTime = Date.now(); const duration = endTime - startTime; // å¦‚æœæ‰§è¡Œæ—¶é—´è¶…è¿‡2ç§’ï¼Œè®¤ä¸ºæ˜¯ANR if (duration \u0026gt; 2000) { const anrInfo = { duration, timestamp: Date.now(), stackTrace: this.getCurrentStackTrace(), deviceInfo: this.getDeviceInfo() }; this.metrics.anr.push(anrInfo); this.reportANR(anrInfo); } isChecking = false; }, 100); }; // å®šæœŸæ£€æŸ¥ setInterval(checkANR, 1000); } // è®¾ç½®ç½‘ç»œç›‘æ§ setupNetworkMonitoring() { const originalFetch = global.fetch; global.fetch = async (...args) =\u0026gt; { const startTime = Date.now(); const [url, options] = args; try { const response = await originalFetch(...args); const endTime = Date.now(); // è®°å½•ç½‘ç»œè¯·æ±‚ const networkMetric = { url, method: options?.method || \u0026#39;GET\u0026#39;, status: response.status, duration: endTime - startTime, size: response.headers.get(\u0026#39;content-length\u0026#39;), timestamp: endTime }; this.metrics.network.push(networkMetric); this.reportNetworkMetric(networkMetric); return response; } catch (error) { const endTime = Date.now(); // è®°å½•ç½‘ç»œé”™è¯¯ const networkMetric = { url, method: options?.method || \u0026#39;GET\u0026#39;, error: error.message, duration: endTime - startTime, timestamp: endTime }; this.metrics.network.push(networkMetric); this.reportNetworkMetric(networkMetric); throw error; } }; } // è®¾ç½®å†…å­˜æ³„æ¼æ£€æµ‹ setupMemoryLeakDetection() { let lastMemoryUsage = 0; let leakCount = 0; setInterval(() =\u0026gt; { const currentMemoryUsage = this.getMemoryUsage(); if (lastMemoryUsage \u0026gt; 0) { const memoryIncrease = currentMemoryUsage - lastMemoryUsage; // å¦‚æœå†…å­˜æŒç»­å¢é•¿ï¼Œå¯èƒ½å­˜åœ¨å†…å­˜æ³„æ¼ if (memoryIncrease \u0026gt; 10 * 1024 * 1024) { // 10MB leakCount++; if (leakCount \u0026gt;= 3) { const leakInfo = { currentUsage: currentMemoryUsage, increase: memoryIncrease, leakCount, timestamp: Date.now() }; this.reportMemoryLeak(leakInfo); leakCount = 0; } } else { leakCount = 0; } } lastMemoryUsage = currentMemoryUsage; this.metrics.memory.push({ usage: currentMemoryUsage, timestamp: Date.now() }); }, 30000); // æ¯30ç§’æ£€æŸ¥ä¸€æ¬¡ } // è®°å½•è‡ªå®šä¹‰æŒ‡æ ‡ recordMetric(name, value, tags = {}) { const metric = { name, value, tags, timestamp: Date.now() }; // æ ¹æ®æŒ‡æ ‡ç±»å‹åˆ†ç±» if (name.startsWith(\u0026#39;fps.\u0026#39;)) { this.metrics.fps.push(metric); } this.reportCustomMetric(metric); } // è®°å½•FPS recordFPS(fps) { this.recordMetric(\u0026#39;fps.current\u0026#39;, fps); if (fps \u0026lt; 30) { this.recordMetric(\u0026#39;fps.low_fps\u0026#39;, 1, { fps_range: \u0026#39;0-30\u0026#39; }); } else if (fps \u0026lt; 45) { this.recordMetric(\u0026#39;fps.low_fps\u0026#39;, 1, { fps_range: \u0026#39;30-45\u0026#39; }); } } // è®°å½•å±å¹•æ€§èƒ½ recordScreenPerformance(screenName, metrics) { this.recordMetric(`screen.${screenName}.load_time`, metrics.loadTime); this.recordMetric(`screen.${screenName}.render_time`, metrics.renderTime); if (metrics.interactionTime) { this.recordMetric(`screen.${screenName}.interaction_time`, metrics.interactionTime); } } // è·å–è®¾å¤‡ä¿¡æ¯ getDeviceInfo() { return { platform: Platform.OS, version: Platform.Version, brand: DeviceInfo.getBrand(), model: DeviceInfo.getModel(), systemVersion: DeviceInfo.getSystemVersion(), appVersion: DeviceInfo.getVersion(), buildNumber: DeviceInfo.getBuildNumber(), bundleId: DeviceInfo.getBundleId(), isEmulator: DeviceInfo.isEmulatorSync() }; } // è·å–åº”ç”¨çŠ¶æ€ getAppState() { return { state: AppState.currentState, memoryUsage: this.getMemoryUsage(), storageUsage: this.getStorageUsage() }; } // è·å–å†…å­˜ä½¿ç”¨æƒ…å†µ getMemoryUsage() { if (Platform.OS === \u0026#39;android\u0026#39;) { return require(\u0026#39;react-native\u0026#39;).NativeModules.MemoryInfoModule.getMemoryUsage(); } else { return require(\u0026#39;react-native\u0026#39;).NativeModules.MemoryModule.getMemoryUsage(); } } // è·å–å­˜å‚¨ä½¿ç”¨æƒ…å†µ getStorageUsage() { // å®ç°å­˜å‚¨ä½¿ç”¨æƒ…å†µè·å– return { used: 0, total: 0 }; } // è·å–å½“å‰å †æ ˆè·Ÿè¸ª getCurrentStackTrace() { // å®ç°å †æ ˆè·Ÿè¸ªè·å– return new Error().stack; } // ä¸ŠæŠ¥å´©æºƒ reportCrash(crashInfo) { this.sendToEndpoint(\u0026#39;/crashes\u0026#39;, crashInfo); } // ä¸ŠæŠ¥ANR reportANR(anrInfo) { this.sendToEndpoint(\u0026#39;/anr\u0026#39;, anrInfo); } // ä¸ŠæŠ¥ç½‘ç»œæŒ‡æ ‡ reportNetworkMetric(networkMetric) { this.sendToEndpoint(\u0026#39;/network\u0026#39;, networkMetric); } // ä¸ŠæŠ¥å†…å­˜æ³„æ¼ reportMemoryLeak(leakInfo) { this.sendToEndpoint(\u0026#39;/memory-leaks\u0026#39;, leakInfo); } // ä¸ŠæŠ¥è‡ªå®šä¹‰æŒ‡æ ‡ reportCustomMetric(metric) { this.sendToEndpoint(\u0026#39;/metrics\u0026#39;, metric); } // å‘é€åˆ°ç«¯ç‚¹ async sendToEndpoint(path, data) { if (Math.random() \u0026gt; this.config.sampleRate) return; try { await fetch(`${this.config.endpoint}${path}`, { method: \u0026#39;POST\u0026#39;, headers: { \u0026#39;Content-Type\u0026#39;: \u0026#39;application/json\u0026#39;, \u0026#39;X-API-Key\u0026#39;: this.config.apiKey }, body: JSON.stringify({ ...data, deviceInfo: this.getDeviceInfo(), sessionId: this.getSessionId() }) }); } catch (error) { console.error(\u0026#39;Failed to report to endpoint:\u0026#39;, error); } } // è·å–ä¼šè¯ID getSessionId() { let sessionId = require(\u0026#39;react-native\u0026#39;).AsyncStorage.getItem(\u0026#39;performance_session_id\u0026#39;); if (!sessionId) { sessionId = Date.now().toString(36) + Math.random().toString(36).substr(2); require(\u0026#39;react-native\u0026#39;).AsyncStorage.setItem(\u0026#39;performance_session_id\u0026#39;, sessionId); } return sessionId; } // ç”Ÿæˆæ€§èƒ½æŠ¥å‘Š generateReport() { const report = { timeRange: { start: Date.now() - 24 * 60 * 60 * 1000, // 24å°æ—¶å‰ end: Date.now() }, summary: { totalCrashes: this.metrics.crashes.length, totalANR: this.metrics.anr.length, avgFPS: this.calculateAverageFPS(), avgMemoryUsage: this.calculateAverageMemory(), networkErrorRate: this.calculateNetworkErrorRate() }, details: { crashes: this.metrics.crashes.slice(-10), anr: this.metrics.anr.slice(-10), networkErrors: this.metrics.network.filter(m =\u0026gt; m.error).slice(-20) } }; return report; } // è®¡ç®—å¹³å‡FPS calculateAverageFPS() { const recentFPS = this.metrics.fps.slice(-100); if (recentFPS.length === 0) return 60; const total = recentFPS.reduce((sum, metric) =\u0026gt; sum + metric.value, 0); return Math.round(total / recentFPS.length); } // è®¡ç®—å¹³å‡å†…å­˜ä½¿ç”¨ calculateAverageMemory() { const recentMemory = this.metrics.memory.slice(-50); if (recentMemory.length === 0) return 0; const total = recentMemory.reduce((sum, metric) =\u0026gt; sum + metric.usage, 0); return Math.round(total / recentMemory.length); } // è®¡ç®—ç½‘ç»œé”™è¯¯ç‡ calculateNetworkErrorRate() { const recentNetwork = this.metrics.network.slice(-100); if (recentNetwork.length === 0) return 0; const errors = recentNetwork.filter(m =\u0026gt; m.error).length; return Math.round((errors / recentNetwork.length) * 100); } } // ä½¿ç”¨ç¤ºä¾‹ const performanceSDK = new PerformanceSDK({ apiKey: \u0026#39;your-api-key\u0026#39;, endpoint: \u0026#39;https://your-performance-endpoint.com/api/v1\u0026#39;, sampleRate: 0.1 // 10%é‡‡æ ·ç‡ }); // åœ¨åº”ç”¨å¯åŠ¨æ—¶åˆå§‹åŒ– performanceSDK.initialize(); // åœ¨ç»„ä»¶ä¸­ä½¿ç”¨ const MyComponent = () =\u0026gt; { useEffect(() =\u0026gt; { // è®°å½•å±å¹•æ€§èƒ½ const startTime = Date.now(); // æ¨¡æ‹Ÿæ¸²æŸ“æ—¶é—´ setTimeout(() =\u0026gt; { const renderTime = Date.now() - startTime; performanceSDK.recordScreenPerformance(\u0026#39;MyComponent\u0026#39;, { loadTime: startTime - performance.mark(\u0026#39;component_start\u0026#39;), renderTime }); }, 0); // è®°å½•FPS const fpsInterval = setInterval(() =\u0026gt; { performanceSDK.recordFPS(58); // ç¤ºä¾‹FPSå€¼ }, 1000); return () =\u0026gt; { clearInterval(fpsInterval); }; }, []); return \u0026lt;View\u0026gt;My Component\u0026lt;/View\u0026gt;; }; æ€»ç»“ React Nativeæ€§èƒ½ä¼˜åŒ–éœ€è¦ä»å¤šä¸ªç»´åº¦å…¥æ‰‹ï¼š\næ¸²æŸ“ä¼˜åŒ–ï¼š\nä½¿ç”¨React.memoå’ŒuseCallbacké¿å…ä¸å¿…è¦æ¸²æŸ“ ä¼˜åŒ–FlatListæ€§èƒ½é…ç½® ä½¿ç”¨åŸç”Ÿé©±åŠ¨çš„åŠ¨ç”» å®ç°å›¾ç‰‡æ‡’åŠ è½½å’Œç¼“å­˜ å†…å­˜ç®¡ç†ï¼š\nå®ç°æ™ºèƒ½å›¾ç‰‡ç¼“å­˜ é¿å…å†…å­˜æ³„æ¼ åˆç†ä½¿ç”¨ç»„ä»¶å¸è½½ ç›‘æ§å†…å­˜ä½¿ç”¨æƒ…å†µ ç½‘ç»œä¼˜åŒ–ï¼š\nå®ç°è¯·æ±‚ç¼“å­˜å’Œæ‰¹å¤„ç† æ§åˆ¶å¹¶å‘è¯·æ±‚æ•°é‡ ä½¿ç”¨GraphQLä¼˜åŒ–æ•°æ®è·å– é¢„åŠ è½½å…³é”®æ•°æ® å¯åŠ¨ä¼˜åŒ–ï¼š\nå®ç°ä»£ç åˆ†å‰²å’Œæ‡’åŠ è½½ ä¼˜åŒ–Bundleå¤§å° é¢„åŠ è½½å…³é”®èµ„æº å¼‚æ­¥åŠ è½½éå…³é”®ç»„ä»¶ ç›‘æ§åˆ†æï¼š\nå»ºç«‹å…¨é¢çš„æ€§èƒ½ç›‘æ§ä½“ç³» å®æ—¶è¿½è¸ªå…³é”®æŒ‡æ ‡ å®šæœŸç”Ÿæˆæ€§èƒ½æŠ¥å‘Š æŒç»­ä¼˜åŒ–å’Œæ”¹è¿› é€šè¿‡ç³»ç»Ÿæ€§çš„æ€§èƒ½ä¼˜åŒ–ç­–ç•¥ï¼Œå¯ä»¥å°†React Nativeåº”ç”¨çš„æ€§èƒ½æå‡åˆ°æ¥è¿‘åŸç”Ÿåº”ç”¨çš„æ°´å¹³ï¼Œä¸ºç”¨æˆ·æä¾›æµç•…çš„60FPSä½“éªŒã€‚\nç›¸å…³èµ„æºï¼š\nReact Nativeå®˜æ–¹æ€§èƒ½æŒ‡å— Flipperè°ƒè¯•å·¥å…· Reactotron Bundleåˆ†æå·¥å…· ","permalink":"/blog/articles/react-native-performance-optimization/","summary":"æ·±å…¥React Nativeæ€§èƒ½ä¼˜åŒ–çš„æ ¸å¿ƒæŠ€æœ¯ï¼Œä»åŸç†åˆ°å®è·µçš„å®Œæ•´è§£å†³æ–¹æ¡ˆã€‚","title":"React Nativeæ€§èƒ½ä¼˜åŒ–å®æˆ˜ï¼šæ‰“é€ 60FPSæµç•…ä½“éªŒçš„ç»ˆææŒ‡å—"},{"content":"å¼•è¨€ 2024å¹´å…¨çƒæ¸¸æˆå¸‚åœºè§„æ¨¡è¾¾åˆ°2000äº¿ç¾å…ƒï¼Œå…¶ä¸­ä¸­å›½æ¸¸æˆæµ·å¤–æ”¶å…¥è¶…è¿‡180äº¿ç¾å…ƒã€‚æ¸¸æˆå‡ºæµ·å·²æˆä¸ºä¸­å›½æ¸¸æˆä¼ä¸šçš„é‡è¦å¢é•¿å¼•æ“ã€‚ç„¶è€Œï¼ŒæˆåŠŸçš„å‡ºæµ·ä¸ä»…ä»…æ˜¯ç®€å•çš„è¯­è¨€ç¿»è¯‘ï¼Œæ›´éœ€è¦æ·±åº¦çš„æ–‡åŒ–ç†è§£ã€æœ¬åœ°åŒ–é€‚é…å’Œå…¨çƒåŒ–è¿è¥ç­–ç•¥ã€‚æœ¬æ–‡å°†æ·±å…¥æ¢è®¨æ¸¸æˆå‡ºæµ·çš„å…¨é“¾è·¯è§£å†³æ–¹æ¡ˆã€‚\næµ·å¤–å¸‚åœºåˆ†æ ä¸»è¦å¸‚åœºç‰¹ç‚¹ åŒ—ç¾å¸‚åœº å¸‚åœºè§„æ¨¡ï¼š çº¦600äº¿ç¾å…ƒ ç”¨æˆ·ç‰¹ç‚¹ï¼š\nä»˜è´¹æ„æ„¿é«˜ï¼ŒARPPUé¢†å…ˆå…¨çƒ ä¸»æµå¹³å°ï¼šPCã€ä¸»æœºã€ç§»åŠ¨ç«¯å‡è¡¡ åå¥½ï¼šé«˜è´¨é‡ç”»é¢ã€æ·±åº¦ç©æ³•ã€IPæ”¹ç¼–æ¸¸æˆ æˆåŠŸæ¡ˆä¾‹ï¼š\nã€ŠåŸç¥ã€‹æœˆæ”¶å…¥è¶…è¿‡1äº¿ç¾å…ƒ ã€ŠPUBG Mobileã€‹æŒç»­éœ¸æ¦œ å¸‚åœºç­–ç•¥ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 // åŒ—ç¾å¸‚åœºæœ¬åœ°åŒ–é…ç½® const naMarketConfig = { pricing: { tier1: 0.99, // åŸºç¡€æ¡£ä½ tier2: 4.99, tier3: 9.99, tier4: 19.99, tier5: 49.99 }, events: { thanksgiving: { name: \u0026#34;Thanksgiving Festival\u0026#34;, startDate: \u0026#34;2024-11-28\u0026#34;, endDate: \u0026#34;2024-12-02\u0026#34;, discounts: 0.3 }, blackFriday: { name: \u0026#34;Black Friday Special\u0026#34;, startDate: \u0026#34;2024-11-29\u0026#34;, endDate: \u0026#34;2024-12-01\u0026#34;, discounts: 0.5 }, christmas: { name: \u0026#34;Winter Holiday\u0026#34;, startDate: \u0026#34;2024-12-20\u0026#34;, endDate: \u0026#34;2025-01-03\u0026#34;, discounts: 0.25 } }, features: { englishVoice: true, textSize: \u0026#34;normal\u0026#34;, // è€å¹´ç”¨æˆ·å‹å¥½ autoPlay: true, // ä¼‘é—²ç©å®¶éœ€æ±‚ crossSave: true // å¤šå¹³å°åŒæ­¥ } } æ¬§æ´²å¸‚åœº å¸‚åœºè§„æ¨¡ï¼š çº¦450äº¿ç¾å…ƒ ç‰¹ç‚¹åˆ†æï¼š\nå¤šè¯­è¨€ç¯å¢ƒå¤æ‚ï¼ˆè‹±ã€å¾·ã€æ³•ã€è¥¿ã€æ„ç­‰ï¼‰ å®¡æ ¸ä¸¥æ ¼ï¼Œç‰¹åˆ«æ˜¯å¾·å›½å’Œæ³•å›½ æ•°æ®éšç§ä¿æŠ¤è¦æ±‚é«˜ï¼ˆGDPRï¼‰ PCå’Œä¸»æœºæ–‡åŒ–æ·±åš åˆè§„ç­–ç•¥ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 // GDPRåˆè§„å®ç° class GDPRCompliance { constructor() { this.consentData = {}; this.privacySettings = { analytics: false, advertising: false, crashReporting: true, performance: false }; } // æ˜¾ç¤ºéšç§æ”¿ç­– showPrivacyDialog() { return new Promise((resolve) =\u0026gt; { const dialog = { title: this.getLocalizedText(\u0026#39;privacy.title\u0026#39;), content: this.getLocalizedText(\u0026#39;privacy.content\u0026#39;), buttons: [ { text: this.getLocalizedText(\u0026#39;privacy.accept_all\u0026#39;), action: () =\u0026gt; this.acceptAllConsents() }, { text: this.getLocalizedText(\u0026#39;privacy.customize\u0026#39;), action: () =\u0026gt; this.showCustomizeDialog() }, { text: this.getLocalizedText(\u0026#39;privacy.reject\u0026#39;), action: () =\u0026gt; this.rejectAllConsents() } ] }; this.showDialog(dialog, resolve); }); } // è·å–æœ¬åœ°åŒ–æ–‡æœ¬ getLocalizedText(key) { const texts = { \u0026#39;en\u0026#39;: { \u0026#39;privacy.title\u0026#39;: \u0026#39;Privacy \u0026amp; Data\u0026#39;, \u0026#39;privacy.content\u0026#39;: \u0026#39;We use cookies and data to...\u0026#39;, \u0026#39;privacy.accept_all\u0026#39;: \u0026#39;Accept All\u0026#39;, \u0026#39;privacy.customize\u0026#39;: \u0026#39;Customize\u0026#39;, \u0026#39;privacy.reject\u0026#39;: \u0026#39;Reject\u0026#39; }, \u0026#39;de\u0026#39;: { \u0026#39;privacy.title\u0026#39;: \u0026#39;Datenschutz\u0026#39;, \u0026#39;privacy.content\u0026#39;: \u0026#39;Wir verwenden Cookies...\u0026#39;, \u0026#39;privacy.accept_all\u0026#39;: \u0026#39;Alle akzeptieren\u0026#39;, \u0026#39;privacy.customize\u0026#39;: \u0026#39;Anpassen\u0026#39;, \u0026#39;privacy.reject\u0026#39;: \u0026#39;Ablehnen\u0026#39; } }; const locale = this.getUserLocale(); return texts[locale]?.[key] || texts[\u0026#39;en\u0026#39;][key]; } // æ•°æ®å¤„ç†å‰æ£€æŸ¥ checkConsent(dataType) { return this.privacySettings[dataType] || this.isEssentialData(dataType); } // æ•°æ®åˆ é™¤è¯·æ±‚å¤„ç† handleDataDeletionRequest(userId) { return new Promise(async (resolve) =\u0026gt; { try { // åˆ é™¤ç”¨æˆ·æ•°æ® await this.deleteUserData(userId); // ç”Ÿæˆåˆ é™¤æŠ¥å‘Š const report = await this.generateDeletionReport(userId); // é€šçŸ¥ç”¨æˆ· this.notifyDeletionComplete(userId); resolve({ success: true, report }); } catch (error) { resolve({ success: false, error: error.message }); } }); } } æ—¥éŸ©å¸‚åœº æ—¥æœ¬å¸‚åœºï¼š\nå¸‚åœºè§„æ¨¡ï¼š180äº¿ç¾å…ƒ ç”¨æˆ·ç‰¹å¾ï¼šå¿ è¯šåº¦é«˜ï¼Œå–œæ¬¢IPè”åŠ¨ ä¸»æµç±»å‹ï¼šRPGã€éŸ³æ¸¸ã€å¡ç‰Œæ¸¸æˆ ä»˜è´¹ä¹ æƒ¯ï¼šè¯¾é‡‘æ–‡åŒ–æ·±åš éŸ©å›½å¸‚åœºï¼š\nå¸‚åœºè§„æ¨¡ï¼š70äº¿ç¾å…ƒ ç”¨æˆ·ç‰¹å¾ï¼šç«æŠ€æ€§å¼ºï¼Œå–œæ¬¢PVP ä¸»æµç±»å‹ï¼šMMORPGã€MOBA å‘è¡Œè¦æ±‚ï¼šéœ€è¦æ¸¸æˆåˆ†çº§è®¤è¯ æœ¬åœ°åŒ–ç­–ç•¥ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 // æ—¥éŸ©å¸‚åœºæœ¬åœ°åŒ– const jpkrConfig = { jp: { language: \u0026#39;ja\u0026#39;, textDirection: \u0026#39;ltr\u0026#39;, currency: \u0026#39;JPY\u0026#39;, dateFormat: \u0026#39;YYYY/MM/DD\u0026#39;, features: { voicePack: true, // å£°ä¼˜æ–‡åŒ– gachaSystem: true, // æŠ½å¡æœºåˆ¶ idolSystem: true, // å¶åƒå…ƒç´  seasonalEvents: true // å­£èŠ‚æ´»åŠ¨ }, cultural: { avoidNumber4: true, // é¿è®³æ•°å­—4 cherryBlossom: true, // æ¨±èŠ±å…ƒç´  shrineVisit: true, // ç¥ç¤¾åœºæ™¯ schoolSetting: true // æ ¡å›­èƒŒæ™¯ } }, kr: { language: \u0026#39;ko\u0026#39;, currency: \u0026#39;KRW\u0026#39;, features: { rankingSystem: true, // æ’è¡Œæ¦œç³»ç»Ÿ pvpArena: true, // PvPç«æŠ€åœº guildSystem: true, // å…¬ä¼šç³»ç»Ÿ esportsIntegration: true // ç”µç«å…ƒç´  }, monetization: { battlePass: true, // é€šè¡Œè¯ cosmeticItems: true, // å¤–è§‚é“å…· convenienceItems: true // ä¾¿åˆ©é“å…· } } }; æœ¬åœ°åŒ–æŠ€æœ¯å®ç° å¤šè¯­è¨€ç³»ç»Ÿæ¶æ„ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 174 175 176 177 178 179 180 181 182 // å›½é™…åŒ–ç®¡ç†å™¨ class I18nManager { constructor() { this.currentLanguage = \u0026#39;en\u0026#39;; this.fallbackLanguage = \u0026#39;en\u0026#39;; this.translations = new Map(); this.loadedLanguages = new Set(); this.pluralRules = new Map(); } // åˆå§‹åŒ–è¯­è¨€åŒ… async init(language = \u0026#39;en\u0026#39;) { await this.loadLanguage(language); await this.loadLanguage(this.fallbackLanguage); this.setLanguage(language); this.initPluralRules(); } // åŠ è½½è¯­è¨€åŒ… async loadLanguage(language) { if (this.loadedLanguages.has(language)) { return; } try { const translations = await this.fetchTranslations(language); this.translations.set(language, translations); this.loadedLanguages.add(language); } catch (error) { console.error(`Failed to load language ${language}:`, error); } } // è·å–ç¿»è¯‘æ–‡ä»¶ async fetchTranslations(language) { const response = await fetch(`./locales/${language}.json`); return await response.json(); } // è®¾ç½®å½“å‰è¯­è¨€ setLanguage(language) { if (this.loadedLanguages.has(language)) { this.currentLanguage = language; this.updateUI(); this.saveLanguagePreference(language); } } // è·å–ç¿»è¯‘æ–‡æœ¬ t(key, params = {}) { const translation = this.getTranslation(key, this.currentLanguage) || this.getTranslation(key, this.fallbackLanguage) || key; // å¤„ç†å‚æ•°æ›¿æ¢ return this.interpolate(translation, params); } // è·å–ç‰¹å®šè¯­è¨€çš„ç¿»è¯‘ getTranslation(key, language) { const translations = this.translations.get(language); if (!translations) return null; // æ”¯æŒåµŒå¥—keyå¦‚ \u0026#39;menu.settings.audio\u0026#39; const keys = key.split(\u0026#39;.\u0026#39;); let result = translations; for (const k of keys) { result = result?.[k]; if (result === undefined) return null; } return result; } // å¤æ•°å½¢å¼å¤„ç† tn(key, count, params = {}) { const rule = this.getPluralRule(count); const pluralKey = `${key}.${rule}`; params.count = count; return this.t(pluralKey, params); } // è·å–å¤æ•°è§„åˆ™ getPluralRule(count) { const rule = this.pluralRules.get(this.currentLanguage); return rule ? rule(count) : \u0026#39;other\u0026#39;; } // åˆå§‹åŒ–å¤æ•°è§„åˆ™ initPluralRules() { // è‹±è¯­å¤æ•°è§„åˆ™ this.pluralRules.set(\u0026#39;en\u0026#39;, (n) =\u0026gt; n === 1 ? \u0026#39;one\u0026#39; : \u0026#39;other\u0026#39;); // ä¸­æ–‡æ— å¤æ•° this.pluralRules.set(\u0026#39;zh\u0026#39;, () =\u0026gt; \u0026#39;other\u0026#39;); // æ—¥è¯­å¤æ•°è§„åˆ™ this.pluralRules.set(\u0026#39;ja\u0026#39;, () =\u0026gt; \u0026#39;other\u0026#39;); // æ³•è¯­å¤æ•°è§„åˆ™ this.pluralRules.set(\u0026#39;fr\u0026#39;, (n) =\u0026gt; n \u0026gt;= 0 \u0026amp;\u0026amp; n \u0026lt; 2 ? \u0026#39;one\u0026#39; : \u0026#39;other\u0026#39;); } // å‚æ•°æ’å€¼ interpolate(text, params) { return text.replace(/\\{\\{(\\w+)\\}\\}/g, (match, key) =\u0026gt; { return params[key] !== undefined ? params[key] : match; }); } // æ›´æ–°UIæ–‡æœ¬ updateUI() { // æ›´æ–°æ‰€æœ‰å¸¦æœ‰data-i18nå±æ€§çš„å…ƒç´  const elements = document.querySelectorAll(\u0026#39;[data-i18n]\u0026#39;); elements.forEach(element =\u0026gt; { const key = element.getAttribute(\u0026#39;data-i18n\u0026#39;); const text = this.t(key); if (element.tagName === \u0026#39;INPUT\u0026#39; || element.tagName === \u0026#39;TEXTAREA\u0026#39;) { element.placeholder = text; } else { element.textContent = text; } }); } // ä¿å­˜è¯­è¨€åå¥½ saveLanguagePreference(language) { localStorage.setItem(\u0026#39;preferredLanguage\u0026#39;, language); } // è·å–ä¿å­˜çš„è¯­è¨€ getSavedLanguage() { return localStorage.getItem(\u0026#39;preferredLanguage\u0026#39;) || navigator.language.split(\u0026#39;-\u0026#39;)[0] || \u0026#39;en\u0026#39;; } // åŠ¨æ€åŠ è½½å­—ä½“ async loadFontForLanguage(language) { const fontConfig = { \u0026#39;ar\u0026#39;: { family: \u0026#39;Noto Sans Arabic\u0026#39;, url: \u0026#39;https://fonts.googleapis.com/css2?family=Noto+Sans+Arabic:wght@400;700\u0026amp;display=swap\u0026#39; }, \u0026#39;ja\u0026#39;: { family: \u0026#39;Noto Sans JP\u0026#39;, url: \u0026#39;https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;700\u0026amp;display=swap\u0026#39; }, \u0026#39;ko\u0026#39;: { family: \u0026#39;Noto Sans KR\u0026#39;, url: \u0026#39;https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;700\u0026amp;display=swap\u0026#39; }, \u0026#39;th\u0026#39;: { family: \u0026#39;Noto Sans Thai\u0026#39;, url: \u0026#39;https://fonts.googleapis.com/css2?family=Noto+Sans+Thai:wght@400;700\u0026amp;display=swap\u0026#39; } }; const config = fontConfig[language]; if (config) { const link = document.createElement(\u0026#39;link\u0026#39;); link.href = config.url; link.rel = \u0026#39;stylesheet\u0026#39;; document.head.appendChild(link); // ç­‰å¾…å­—ä½“åŠ è½½ await document.fonts.load(`16px ${config.family}`); } } // å¤„ç†æ–‡æœ¬æ–¹å‘ setTextDirection() { const rtlLanguages = [\u0026#39;ar\u0026#39;, \u0026#39;he\u0026#39;, \u0026#39;fa\u0026#39;]; const isRTL = rtlLanguages.includes(this.currentLanguage); document.documentElement.dir = isRTL ? \u0026#39;rtl\u0026#39; : \u0026#39;ltr\u0026#39;; document.body.classList.toggle(\u0026#39;rtl\u0026#39;, isRTL); } } èµ„æºæœ¬åœ°åŒ–ç®¡ç† 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 // èµ„æºæœ¬åœ°åŒ–ç³»ç»Ÿ class AssetLocalizationManager { constructor() { this.localizedAssets = new Map(); this.assetCache = new Map(); this.currentRegion = \u0026#39;global\u0026#39;; } // æ ¹æ®åœ°åŒºåŠ è½½èµ„æº async loadLocalizedAsset(assetType, assetName, region) { const cacheKey = `${region}:${assetType}:${assetName}`; if (this.assetCache.has(cacheKey)) { return this.assetCache.get(cacheKey); } try { // å°è¯•åŠ è½½åœ°åŒºç‰¹å®šèµ„æº let assetUrl = this.getLocalizedAssetUrl(assetType, assetName, region); let asset = await this.loadAsset(assetUrl); // å¦‚æœåœ°åŒºç‰¹å®šèµ„æºä¸å­˜åœ¨ï¼Œä½¿ç”¨å…¨å±€èµ„æº if (!asset \u0026amp;\u0026amp; region !== \u0026#39;global\u0026#39;) { assetUrl = this.getLocalizedAssetUrl(assetType, assetName, \u0026#39;global\u0026#39;); asset = await this.loadAsset(assetUrl); } if (asset) { this.assetCache.set(cacheKey, asset); return asset; } } catch (error) { console.error(`Failed to load localized asset: ${assetName}`, error); } return null; } // è·å–æœ¬åœ°åŒ–èµ„æºURL getLocalizedAssetUrl(assetType, assetName, region) { const baseUrl = \u0026#39;./assets\u0026#39;; const regionFolder = region !== \u0026#39;global\u0026#39; ? `/${region}` : \u0026#39;\u0026#39;; switch (assetType) { case \u0026#39;image\u0026#39;: return `${baseUrl}/images${regionFolder}/${assetName}`; case \u0026#39;audio\u0026#39;: return `${baseUrl}/audio${regionFolder}/${assetName}`; case \u0026#39;video\u0026#39;: return `${baseUrl}/video${regionFolder}/${assetName}`; case \u0026#39;ui\u0026#39;: return `${baseUrl}/ui${regionFolder}/${assetName}`; default: return `${baseUrl}${regionFolder}/${assetName}`; } } // åŠ è½½èµ„æº async loadAsset(url) { if (url.endsWith(\u0026#39;.json\u0026#39;)) { const response = await fetch(url); return await response.json(); } else if (url.match(/\\.(jpg|jpeg|png|gif|webp)$/)) { return new Promise((resolve, reject) =\u0026gt; { const img = new Image(); img.onload = () =\u0026gt; resolve(img); img.onerror = reject; img.src = url; }); } else if (url.match(/\\.(mp3|wav|ogg)$/)) { return new Promise((resolve, reject) =\u0026gt; { const audio = new Audio(); audio.oncanplaythrough = () =\u0026gt; resolve(audio); audio.onerror = reject; audio.src = url; }); } } // é¢„åŠ è½½åœ°åŒºç‰¹å®šèµ„æº async preloadRegionalAssets(region, assetList) { const promises = assetList.map(async (asset) =\u0026gt; { return { type: asset.type, name: asset.name, data: await this.loadLocalizedAsset(asset.type, asset.name, region) }; }); const results = await Promise.allSettled(promises); return results.filter(r =\u0026gt; r.status === \u0026#39;fulfilled\u0026#39;).map(r =\u0026gt; r.value); } // æ¸…ç†ç¼“å­˜ clearCache() { this.assetCache.clear(); } } æ–‡åŒ–é€‚é…ç­–ç•¥ è§†è§‰å…ƒç´ æœ¬åœ°åŒ– 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 174 175 176 177 178 179 180 181 182 183 184 185 186 187 188 189 190 191 192 193 194 195 196 197 198 199 200 201 202 203 204 205 206 207 208 209 210 211 212 213 214 215 216 217 218 219 220 221 222 223 224 225 226 227 228 229 230 231 // æ–‡åŒ–é€‚é…ç®¡ç†å™¨ class CulturalAdaptationManager { constructor() { this.culturalConfigs = new Map(); this.currentCulture = \u0026#39;default\u0026#39;; this.initCulturalConfigs(); } // åˆå§‹åŒ–æ–‡åŒ–é…ç½® initCulturalConfigs() { // ä¸­ä¸œåœ°åŒºé…ç½® this.culturalConfigs.set(\u0026#39;middle-east\u0026#39;, { colors: { primary: \u0026#39;#2D5F8C\u0026#39;, // æ·±è“è‰²ï¼Œä»£è¡¨ç¨³é‡ secondary: \u0026#39;#D4AF37\u0026#39;, // é‡‘è‰²ï¼Œè±¡å¾ç¹è£ danger: \u0026#39;#DC143C\u0026#39;, // çº¢è‰²ï¼Œæ³¨æ„ä½¿ç”¨ success: \u0026#39;#228B22\u0026#39; // ç»¿è‰² }, imagery: { avoid: [\u0026#39;pigs\u0026#39;, \u0026#39;alcohol\u0026#39;, \u0026#39;revealing clothing\u0026#39;], prefer: [\u0026#39;geometric\u0026#39;, \u0026#39;calligraphy\u0026#39;, \u0026#39;architecture\u0026#39;] }, ui: { textDirection: \u0026#39;rtl\u0026#39;, fontFamily: \u0026#39;Noto Sans Arabic\u0026#39;, roundedCorners: false, // åå¥½æ–¹æ­£è®¾è®¡ minimalIcons: true // é¿å…å¤æ‚å›¾æ ‡ }, content: { genderRepresentation: \u0026#39;separate\u0026#39;, religiousSensitivity: \u0026#39;high\u0026#39;, familyValues: \u0026#39;conservative\u0026#39; } }); // ä¸œäºšåœ°åŒºé…ç½® this.culturalConfigs.set(\u0026#39;east-asia\u0026#39;, { colors: { primary: \u0026#39;#E60012\u0026#39;, // ä¸­å›½çº¢ secondary: \u0026#39;#FFD700\u0026#39;, // é‡‘è‰² danger: \u0026#39;#FF0000\u0026#39;, success: \u0026#39;#00C853\u0026#39; }, imagery: { avoid: [\u0026#39;skulls\u0026#39;, \u0026#39;excessive violence\u0026#39;], prefer: [\u0026#39;dragons\u0026#39;, \u0026#39;nature\u0026#39;, \u0026#39;cute characters\u0026#39;] }, ui: { textDirection: \u0026#39;ltr\u0026#39;, fontFamily: \u0026#39;Noto Sans CJK\u0026#39;, denseLayout: true, // ä¿¡æ¯å¯†åº¦é«˜ cuteElements: true // å¯çˆ±åŒ–å…ƒç´  }, content: { ageRating: \u0026#39;strict\u0026#39;, violence: \u0026#39;moderate\u0026#39;, socialHarmony: \u0026#39;important\u0026#39; } }); // æ¬§ç¾åœ°åŒºé…ç½® this.culturalConfigs.set(\u0026#39;western\u0026#39;, { colors: { primary: \u0026#39;#0078D4\u0026#39;, // å¾®è½¯è“ secondary: \u0026#39;#50E3C2\u0026#39;, danger: \u0026#39;#FF4444\u0026#39;, success: \u0026#39;#4CAF50\u0026#39; }, imagery: { avoid: [], prefer: [\u0026#39;realistic\u0026#39;, \u0026#39;diverse\u0026#39;, \u0026#39;modern\u0026#39;] }, ui: { textDirection: \u0026#39;ltr\u0026#39;, fontFamily: \u0026#39;Roboto, Arial\u0026#39;, cleanMinimal: true, highContrast: true }, content: { diversity: \u0026#39;important\u0026#39;, individualism: \u0026#39;valued\u0026#39;, directCommunication: \u0026#39;preferred\u0026#39; } }); } // åº”ç”¨æ–‡åŒ–é€‚é… applyCulturalAdaptation(culture) { const config = this.culturalConfigs.get(culture); if (!config) return; this.currentCulture = culture; // åº”ç”¨é¢œè‰²ä¸»é¢˜ this.applyColorTheme(config.colors); // åº”ç”¨UIè°ƒæ•´ this.applyUIAdjustments(config.ui); // åº”ç”¨å†…å®¹è¿‡æ»¤ this.applyContentFilters(config.content); } // åº”ç”¨é¢œè‰²ä¸»é¢˜ applyColorTheme(colors) { const root = document.documentElement; root.style.setProperty(\u0026#39;--primary-color\u0026#39;, colors.primary); root.style.setProperty(\u0026#39;--secondary-color\u0026#39;, colors.secondary); root.style.setProperty(\u0026#39;--danger-color\u0026#39;, colors.danger); root.style.setProperty(\u0026#39;--success-color\u0026#39;, colors.success); } // åº”ç”¨UIè°ƒæ•´ applyUIAdjustments(ui) { const body = document.body; // è®¾ç½®æ–‡æœ¬æ–¹å‘ body.style.direction = ui.textDirection; // è®¾ç½®å­—ä½“ if (ui.fontFamily) { body.style.fontFamily = ui.fontFamily; } // æ·»åŠ æ–‡åŒ–CSSç±» body.classList.add(`culture-${this.currentCulture}`); // è°ƒæ•´é—´è·å’Œå¸ƒå±€ if (ui.denseLayout) { body.classList.add(\u0026#39;dense-layout\u0026#39;); } if (ui.roundedCorners === false) { body.classList.add(\u0026#39;square-corners\u0026#39;); } } // å†…å®¹è¿‡æ»¤ filterContent(content, type) { const config = this.culturalConfigs.get(this.currentCulture); if (!config || !config.content) return content; switch (type) { case \u0026#39;image\u0026#39;: return this.filterImage(content, config.imagery); case \u0026#39;text\u0026#39;: return this.filterText(content, config.content); case \u0026#39;audio\u0026#39;: return this.filterAudio(content, config.content); default: return content; } } // å›¾ç‰‡è¿‡æ»¤ filterImage(imageUrl, imageryConfig) { // å®ç°å›¾ç‰‡å†…å®¹è¿‡æ»¤é€»è¾‘ // å¯ä»¥ä½¿ç”¨AIå›¾åƒè¯†åˆ«APIæ£€æµ‹æ•æ„Ÿå†…å®¹ return imageUrl; } // æ–‡æœ¬è¿‡æ»¤ filterText(text, contentConfig) { let filteredText = text; // æ ¹æ®æ–‡åŒ–æ•æ„Ÿæ€§è¿‡æ»¤å†…å®¹ if (contentConfig.religiousSensitivity === \u0026#39;high\u0026#39;) { // ç§»é™¤å®—æ•™ç›¸å…³æ•æ„Ÿè¯æ±‡ filteredText = this.removeSensitiveContent(filteredText); } return filteredText; } // è·å–æœ¬åœ°åŒ–æ—¥æœŸæ ¼å¼ getLocalizedDateFormat() { const formats = { \u0026#39;middle-east\u0026#39;: \u0026#39;DD/MM/YYYY\u0026#39;, \u0026#39;east-asia\u0026#39;: \u0026#39;YYYY/MM/DD\u0026#39;, \u0026#39;western\u0026#39;: \u0026#39;MM/DD/YYYY\u0026#39;, \u0026#39;european\u0026#39;: \u0026#39;DD.MM.YYYY\u0026#39; }; return formats[this.currentCulture] || \u0026#39;YYYY-MM-DD\u0026#39;; } // è·å–æœ¬åœ°åŒ–æ•°å­—æ ¼å¼ formatNumber(number, type = \u0026#39;decimal\u0026#39;) { const formatters = { \u0026#39;middle-east\u0026#39;: new Intl.NumberFormat(\u0026#39;ar-SA\u0026#39;), \u0026#39;east-asia\u0026#39;: new Intl.NumberFormat(\u0026#39;zh-CN\u0026#39;), \u0026#39;western\u0026#39;: new Intl.NumberFormat(\u0026#39;en-US\u0026#39;), \u0026#39;european\u0026#39;: new Intl.NumberFormat(\u0026#39;de-DE\u0026#39;) }; const formatter = formatters[this.currentCulture] || new Intl.NumberFormat(\u0026#39;en-US\u0026#39;); switch (type) { case \u0026#39;currency\u0026#39;: return formatter.format(number); case \u0026#39;percent\u0026#39;: return formatter.format(number / 100) + \u0026#39;%\u0026#39;; default: return formatter.format(number); } } // è·å–æ–‡åŒ–ç‰¹å®šçš„èŠ‚æ—¥åˆ—è¡¨ getCulturalHolidays() { const holidays = { \u0026#39;middle-east\u0026#39;: [ { name: \u0026#39;Eid al-Fitr\u0026#39;, date: \u0026#39;2024-04-10\u0026#39;, type: \u0026#39;major\u0026#39; }, { name: \u0026#39;Eid al-Adha\u0026#39;, date: \u0026#39;2024-06-17\u0026#39;, type: \u0026#39;major\u0026#39; }, { name: \u0026#39;Ramadan Start\u0026#39;, date: \u0026#39;2024-03-11\u0026#39;, type: \u0026#39;major\u0026#39; } ], \u0026#39;east-asia\u0026#39;: [ { name: \u0026#39;Chinese New Year\u0026#39;, date: \u0026#39;2024-02-10\u0026#39;, type: \u0026#39;major\u0026#39; }, { name: \u0026#39;Golden Week\u0026#39;, date: \u0026#39;2024-04-29\u0026#39;, type: \u0026#39;major\u0026#39; }, { name: \u0026#39;Mid-Autumn Festival\u0026#39;, date: \u0026#39;2024-09-17\u0026#39;, type: \u0026#39;minor\u0026#39; } ], \u0026#39;western\u0026#39;: [ { name: \u0026#39;Christmas\u0026#39;, date: \u0026#39;2024-12-25\u0026#39;, type: \u0026#39;major\u0026#39; }, { name: \u0026#39;Easter\u0026#39;, date: \u0026#39;2024-03-31\u0026#39;, type: \u0026#39;major\u0026#39; }, { name: \u0026#39;Halloween\u0026#39;, date: \u0026#39;2024-10-31\u0026#39;, type: \u0026#39;minor\u0026#39; } ] }; return holidays[this.currentCulture] || []; } } æµ·å¤–å‘è¡Œç­–ç•¥ æ¸ é“é€‰æ‹©ä¸ä¼˜åŒ– 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 174 175 176 177 178 179 180 181 182 183 184 185 186 187 188 189 190 191 192 193 194 195 196 197 198 199 200 201 202 203 204 205 206 207 208 209 210 211 212 213 214 215 216 217 218 // æ¸ é“ç®¡ç†å™¨ class ChannelManager { constructor() { this.channels = new Map(); this.channelMetrics = new Map(); this.initChannels(); } // åˆå§‹åŒ–æ¸ é“é…ç½® initChannels() { // Google Play this.channels.set(\u0026#39;google-play\u0026#39;, { name: \u0026#39;Google Play Store\u0026#39;, platform: \u0026#39;android\u0026#39;, regions: [\u0026#39;global\u0026#39;], features: { inAppPurchase: true, subscriptions: true, seasonalPromotions: true, preRegistration: true }, optimization: { aso: true, featuredPlacement: true, localPricing: true, betaTesting: true }, costs: { developerFee: 25, revenueShare: 0.30 } }); // App Store this.channels.set(\u0026#39;app-store\u0026#39;, { name: \u0026#39;Apple App Store\u0026#39;, platform: \u0026#39;ios\u0026#39;, regions: [\u0026#39;global\u0026#39;], features: { inAppPurchase: true, subscriptions: true, appClips: true, arcade: false }, optimization: { aso: true, editorialPlacement: true, searchAds: true, productPage: true }, costs: { developerFee: 99, revenueShare: 0.30 } }); // Steam this.channels.set(\u0026#39;steam\u0026#39;, { name: \u0026#39;Steam\u0026#39;, platform: \u0026#39;pc\u0026#39;, regions: [\u0026#39;global\u0026#39;], features: { dlc: true, workshop: true, cards: true, achievements: true }, optimization: { discoveryQueue: true, seasonalSales: true, communityFeatures: true, earlyAccess: true }, costs: { submissionFee: 100, revenueShare: { 0.30: 1000000, 0.25: 50000000, 0.20: Infinity } } }); // Nintendo eShop this.channels.set(\u0026#39;eshop\u0026#39;, { name: \u0026#39;Nintendo eShop\u0026#39;, platform: \u0026#39;switch\u0026#39;, regions: [\u0026#39;americas\u0026#39;, \u0026#39;europe\u0026#39;, \u0026#39;asia\u0026#39;], features: { demoVersions: true, discounts: true, goldPoints: true, multiplayer: true }, optimization: { featuredBanners: true, eshopSales: true, socialMediaIntegration: true }, costs: { developerProgram: 500, revenueShare: 0.30 } }); } // è·å–æ¨èæ¸ é“ getRecommendedChannels(targetPlatform, targetRegion, gameType) { const recommendations = []; this.channels.forEach((channel, channelKey) =\u0026gt; { if (channel.platform === targetPlatform || targetPlatform === \u0026#39;all\u0026#39;) { if (channel.regions.includes(\u0026#39;global\u0026#39;) || channel.regions.includes(targetRegion)) { recommendations.push({ id: channelKey, name: channel.name, matchScore: this.calculateMatchScore(channel, gameType) }); } } }); return recommendations.sort((a, b) =\u0026gt; b.matchScore - a.matchScore); } // è®¡ç®—æ¸ é“åŒ¹é…åº¦ calculateMatchScore(channel, gameType) { let score = 50; // åŸºç¡€åˆ†æ•° // æ ¹æ®æ¸¸æˆç±»å‹è°ƒæ•´åˆ†æ•° if (gameType === \u0026#39;casual\u0026#39; \u0026amp;\u0026amp; channel.features?.seasonalPromotions) { score += 20; } if (gameType === \u0026#39;indie\u0026#39; \u0026amp;\u0026amp; channel.platform === \u0026#39;steam\u0026#39;) { score += 30; } if (gameType === \u0026#39;mobile\u0026#39; \u0026amp;\u0026amp; (channel.platform === \u0026#39;android\u0026#39; || channel.platform === \u0026#39;ios\u0026#39;)) { score += 25; } return score; } // æ¸ é“å‘å¸ƒæ£€æŸ¥æ¸…å• getPublishingChecklist(channelKey) { const channel = this.channels.get(channelKey); if (!channel) return []; const checklist = [ { category: \u0026#39;legal\u0026#39;, items: [ { task: \u0026#39;éšç§æ”¿ç­–\u0026#39;, required: true }, { task: \u0026#39;æœåŠ¡æ¡æ¬¾\u0026#39;, required: true }, { task: \u0026#39;ç‰ˆæƒå£°æ˜\u0026#39;, required: true }, { task: \u0026#39;åœ°åŒºæ³•è§„ç¬¦åˆ\u0026#39;, required: true } ] }, { category: \u0026#39;technical\u0026#39;, items: [ { task: \u0026#39;åº”ç”¨ç­¾å\u0026#39;, required: true }, { task: \u0026#39;æƒé™å£°æ˜\u0026#39;, required: true }, { task: \u0026#39;å´©æºƒæŠ¥å‘Š\u0026#39;, required: false }, { task: \u0026#39;æ€§èƒ½ä¼˜åŒ–\u0026#39;, required: false } ] }, { category: \u0026#39;content\u0026#39;, items: [ { task: \u0026#39;æœ¬åœ°åŒ–å®Œæˆ\u0026#39;, required: true }, { task: \u0026#39;æˆªå›¾å’Œè§†é¢‘\u0026#39;, required: true }, { task: \u0026#39;æè¿°æ–‡æ¡ˆ\u0026#39;, required: true }, { task: \u0026#39;å…³é”®è¯ä¼˜åŒ–\u0026#39;, required: false } ] }, { category: \u0026#39;monetization\u0026#39;, items: [ { task: \u0026#39;å®šä»·ç­–ç•¥\u0026#39;, required: true }, { task: \u0026#39;å†…è´­é…ç½®\u0026#39;, required: false }, { task: \u0026#39;å¹¿å‘Šé›†æˆ\u0026#39;, required: false }, { task: \u0026#39;è®¢é˜…è®¾ç½®\u0026#39;, required: false } ] } ]; return checklist; } // æ¸ é“æ”¶ç›Šåˆ†æ analyzeChannelRevenue(channelKey, metrics) { const channel = this.channels.get(channelKey); if (!channel) return null; const revenue = metrics.revenue || 0; const downloads = metrics.downloads || 0; const revenueShare = channel.costs.revenueShare; // è®¡ç®—å‡€æ”¶ç›Š let netRevenue = revenue; if (typeof revenueShare === \u0026#39;number\u0026#39;) { netRevenue = revenue * (1 - revenueShare); } else if (typeof revenueShare === \u0026#39;object\u0026#39;) { // é˜¶æ¢¯å¼åˆ†æˆ for (const [share, threshold] of Object.entries(revenueShare)) { if (revenue \u0026lt;= threshold) { netRevenue = revenue * (1 - parseFloat(share)); break; } } } return { grossRevenue: revenue, netRevenue, channelFee: revenue - netRevenue, arpd: downloads \u0026gt; 0 ? revenue / downloads : 0, profitMargin: revenue \u0026gt; 0 ? (netRevenue / revenue) * 100 : 0 }; } } ç”¨æˆ·è·å–ç­–ç•¥ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 174 175 176 177 178 179 180 181 182 183 184 185 186 187 188 189 190 // ç”¨æˆ·è·å–ç®¡ç†å™¨ class UserAcquisitionManager { constructor() { this.campaigns = new Map(); this.metrics = new Map(); this.attributionModel = \u0026#39;last_click\u0026#39;; } // åˆ›å»ºè¥é”€æ´»åŠ¨ createCampaign(config) { const campaign = { id: this.generateCampaignId(), name: config.name, type: config.type, // \u0026#39;cpi\u0026#39;, \u0026#39;cpa\u0026#39;, \u0026#39;cpm\u0026#39;, \u0026#39;organic\u0026#39; platform: config.platform, region: config.region, budget: config.budget, targeting: config.targeting, creative: config.creative, startDate: config.startDate, endDate: config.endDate, status: \u0026#39;active\u0026#39;, metrics: { impressions: 0, clicks: 0, installs: 0, cost: 0, revenue: 0, roas: 0 } }; this.campaigns.set(campaign.id, campaign); return campaign; } // è·å–ç”¨æˆ·æ¥æºåˆ†æ getUserSourceAnalysis(timeRange = \u0026#39;30d\u0026#39;) { const sources = { organic: { users: 0, revenue: 0, retention: [] }, paid_social: { users: 0, revenue: 0, retention: [] }, paid_search: { users: 0, revenue: 0, retention: [] }, influencer: { users: 0, revenue: 0, retention: [] }, referral: { users: 0, revenue: 0, retention: [] } }; // åˆ†æå„æ¸ é“æ•°æ® this.metrics.forEach((userMetrics, userId) =\u0026gt; { const source = userMetrics.acquisitionSource; if (sources[source]) { sources[source].users++; sources[source].revenue += userMetrics.ltv || 0; sources[source].retention.push(userMetrics.retention || 0); } }); // è®¡ç®—å¹³å‡å€¼ Object.keys(sources).forEach(source =\u0026gt; { const retentionData = sources[source].retention; sources[source].avgRetention = retentionData.length \u0026gt; 0 ? retentionData.reduce((a, b) =\u0026gt; a + b, 0) / retentionData.length : 0; }); return sources; } // A/Bæµ‹è¯•å¹¿å‘Šç´ æ async testAdCreatives(campaignId, creatives) { const results = []; for (const creative of creatives) { const testResult = await this.runAdTest(campaignId, creative); results.push({ creative: creative, cpm: testResult.cpm, ctr: testResult.ctr, cpi: testResult.cpi, roas: testResult.roas, significance: testResult.significance }); } // æ’åºå¹¶æ¨èæœ€ä½³ç´ æ return results.sort((a, b) =\u0026gt; b.roas - a.roas); } // è¿è¡Œå¹¿å‘Šæµ‹è¯• async runAdTest(campaignId, creative) { // å®ç°A/Bæµ‹è¯•é€»è¾‘ // è¿”å›æµ‹è¯•æŒ‡æ ‡ return { cpm: 2.5, ctr: 0.015, cpi: 1.2, roas: 2.8, significance: 0.95 }; } // è®¡ç®—LTV/CACæ¯”ç‡ calculateLTVCACRatio() { let totalLTV = 0; let totalCAC = 0; let userCount = 0; this.metrics.forEach((metrics) =\u0026gt; { if (metrics.ltv \u0026amp;\u0026amp; metrics.cac) { totalLTV += metrics.ltv; totalCAC += metrics.cac; userCount++; } }); if (userCount === 0) return 0; const avgLTV = totalLTV / userCount; const avgCAC = totalCAC / userCount; return avgLTV / avgCAC; } // ç”Ÿæˆç”¨æˆ·è·å–æŠ¥å‘Š generateAcquisitionReport(timeRange = \u0026#39;7d\u0026#39;) { const report = { period: timeRange, totalUsers: 0, totalCost: 0, totalRevenue: 0, avgCAC: 0, avgLTV: 0, ltvCACRatio: this.calculateLTVCACRatio(), topChannels: [], recommendations: [] }; // ç»Ÿè®¡æ•°æ® this.campaigns.forEach((campaign) =\u0026gt; { if (this.isCampaignInPeriod(campaign, timeRange)) { report.totalUsers += campaign.metrics.installs; report.totalCost += campaign.metrics.cost; report.totalRevenue += campaign.metrics.revenue; } }); // è®¡ç®—å¹³å‡å€¼ if (report.totalUsers \u0026gt; 0) { report.avgCAC = report.totalCost / report.totalUsers; report.avgLTV = report.totalRevenue / report.totalUsers; } // ç”Ÿæˆå»ºè®® report.recommendations = this.generateRecommendations(report); return report; } // ç”Ÿæˆä¼˜åŒ–å»ºè®® generateRecommendations(report) { const recommendations = []; if (report.ltvCACRatio \u0026lt; 1) { recommendations.push({ type: \u0026#39;warning\u0026#39;, message: \u0026#39;LTV/CACæ¯”ç‡ä½äº1ï¼Œéœ€è¦ä¼˜åŒ–ç”¨æˆ·è·å–ç­–ç•¥\u0026#39;, actions: [\u0026#39;æé«˜ç”¨æˆ·ç•™å­˜\u0026#39;, \u0026#39;ä¼˜åŒ–å¹¿å‘Šç´ æ\u0026#39;, \u0026#39;è°ƒæ•´ç›®æ ‡å—ä¼—\u0026#39;] }); } if (report.avgCAC \u0026gt; report.avgLTV * 0.3) { recommendations.push({ type: \u0026#39;info\u0026#39;, message: \u0026#39;è·å®¢æˆæœ¬åé«˜ï¼Œå»ºè®®ä¼˜åŒ–æŠ•æ”¾æ¸ é“\u0026#39;, actions: [\u0026#39;æµ‹è¯•æ–°æ¸ é“\u0026#39;, \u0026#39;ä¼˜åŒ–æŠ•æ”¾æ—¶æ®µ\u0026#39;, \u0026#39;æ”¹è¿›è½åœ°é¡µ\u0026#39;] }); } return recommendations; } // ç”Ÿæˆæ´»åŠ¨ID generateCampaignId() { return \u0026#39;camp_\u0026#39; + Date.now().toString(36) + Math.random().toString(36).substr(2); } // æ£€æŸ¥æ´»åŠ¨æ˜¯å¦åœ¨æŒ‡å®šæ—¶é—´èŒƒå›´å†… isCampaignInPeriod(campaign, timeRange) { // å®ç°æ—¶é—´èŒƒå›´æ£€æŸ¥é€»è¾‘ return true; } } æ€»ç»“ æ¸¸æˆå‡ºæµ·æˆåŠŸçš„å…³é”®è¦ç´ ï¼š\næœ¬åœ°åŒ–æ·±åº¦ï¼š\nè¯­è¨€ç¿»è¯‘çš„å‡†ç¡®æ€§å’Œæ–‡åŒ–é€‚åº”æ€§ è§†è§‰å…ƒç´ çš„æ–‡åŒ–æ•æ„Ÿåº¦å¤„ç† ç”¨æˆ·ä½“éªŒçš„æœ¬åœ°åŒ–ä¼˜åŒ– ç¤¾äº¤åŠŸèƒ½çš„æœ¬åœ°åŒ–è°ƒæ•´ å‘è¡Œç­–ç•¥ï¼š\nåˆé€‚çš„æ¸ é“é€‰æ‹©å’Œç»„åˆ ç²¾å‡†çš„ç”¨æˆ·è·å–ç­–ç•¥ æ•°æ®é©±åŠ¨çš„ä¼˜åŒ–å†³ç­– æŒç»­çš„å¸‚åœºç›‘æ§å’Œè°ƒæ•´ è¿è¥è¦ç‚¹ï¼š\næ·±åº¦ç†è§£ç›®æ ‡å¸‚åœºæ–‡åŒ– å»ºç«‹æœ¬åœ°åŒ–è¿è¥å›¢é˜Ÿ é€‚åº”ä¸åŒåœ°åŒºçš„æ³•è§„è¦æ±‚ ä¿æŒäº§å“æŒç»­ä¼˜åŒ– æˆåŠŸæŒ‡æ ‡ï¼š\nç”¨æˆ·ç•™å­˜ç‡ ä»˜è´¹è½¬åŒ–ç‡ LTV/CACæ¯”ç‡ å¸‚åœºä»½é¢å¢é•¿ é€šè¿‡ç³»ç»ŸåŒ–çš„å‡ºæµ·ç­–ç•¥ï¼Œä¸­å›½æ¸¸æˆä¼ä¸šå¯ä»¥åœ¨å…¨çƒå¸‚åœºå–å¾—æˆåŠŸï¼Œå®ç°å•†ä¸šä»·å€¼å’Œæ–‡åŒ–å½±å“åŠ›çš„åŒé‡æå‡ã€‚\nç›¸å…³èµ„æºï¼š\nGoogle Play Console Apple App Store Connect Steamworks æ¸¸æˆæœ¬åœ°åŒ–æœ€ä½³å®è·µ ","permalink":"/blog/articles/game-localization-overseas-strategy/","summary":"æ·±åº¦è§£ææ¸¸æˆå‡ºæµ·çš„å®Œæ•´ç­–ç•¥ï¼Œä»äº§å“æœ¬åœ°åŒ–åˆ°æµ·å¤–å¸‚åœºè¿è¥çš„å®æˆ˜ç»éªŒã€‚","title":"æ¸¸æˆå‡ºæµ·å…¨æ”»ç•¥ï¼šä»æœ¬åœŸåŒ–åˆ°å…¨çƒå‘è¡Œçš„åˆ¶èƒœä¹‹é“"},{"content":"å¼•è¨€ å°æ¸¸æˆå¸‚åœºåœ¨2024å¹´ç»§ç»­è“¬å‹ƒå‘å±•ï¼Œå¾®ä¿¡å°æ¸¸æˆæœˆæ´»è·ƒç”¨æˆ·çªç ´4äº¿ï¼Œå°æ¸¸æˆå¸‚åœºè§„æ¨¡è¾¾åˆ°500äº¿å…ƒã€‚éšç€å¼€å‘é—¨æ§›é™ä½å’Œå˜ç°æ¸ é“å¤šæ ·åŒ–ï¼Œè¶Šæ¥è¶Šå¤šå¼€å‘è€…æ¶Œå…¥è¿™ä¸ªé¢†åŸŸã€‚æœ¬æ–‡å°†ä»æŠ€æœ¯å®ç°ã€å•†ä¸šæ¨¡å¼ã€ç”¨æˆ·è¿è¥ç­‰å¤šä¸ªç»´åº¦ï¼Œå…¨é¢è§£æå°æ¸¸æˆå¼€å‘ä¸å˜ç°çš„ç­–ç•¥ã€‚\nå°æ¸¸æˆæŠ€æœ¯æ¶æ„ æŠ€æœ¯æ ˆé€‰æ‹© LayaAirå¼•æ“ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 // LayaAir 2.x æ¸¸æˆåˆå§‹åŒ– class GameMain { constructor() { // åˆå§‹åŒ–å¼•æ“ Laya.init(1136, 640, WebGL).then(() =\u0026gt; { this.init() }) } init() { // è®¾ç½®é€‚é…æ¨¡å¼ Laya.stage.scaleMode = Laya.Stage.SCALE_FIXED_AUTO; Laya.stage.screenMode = Laya.Stage.SCREEN_HORIZONTAL; // åŠ è½½èµ„æº this.loadResources(); } loadResources() { Laya.loader.load([ \u0026#34;res/atlas/ui.atlas\u0026#34;, \u0026#34;res/scene/scene.json\u0026#34;, \u0026#34;res/character/player.json\u0026#34; ], Laya.Handler.create(this, this.onLoaded)); } onLoaded() { // åˆ›å»ºæ¸¸æˆåœºæ™¯ this.gameScene = new GameScene(); Laya.stage.addChild(this.gameScene); // å¯åŠ¨æ¸¸æˆå¾ªç¯ this.startGameLoop(); } startGameLoop() { Laya.timer.frameLoop(1, this, this.update); } update() { // æ¸¸æˆé€»è¾‘æ›´æ–° this.gameScene.update(); } } // å¯åŠ¨æ¸¸æˆ new GameMain(); Cocos Creator 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 // Cocos Creator æ¸¸æˆè„šæœ¬ import { _decorator, Component, Node, input, Input, EventTouch, Vec3 } from \u0026#39;cc\u0026#39;; const { ccclass, property } = _decorator; @ccclass(\u0026#39;PlayerController\u0026#39;) export class PlayerController extends Component { @property(Node) playerNode: Node = null!; @property moveSpeed: number = 300; private _moveDir: Vec3 = new Vec3(); onLoad() { // åˆå§‹åŒ–è¾“å…¥ç³»ç»Ÿ input.on(Input.EventType.TOUCH_START, this.onTouchStart, this); input.on(Input.EventType.TOUCH_MOVE, this.onTouchMove, this); input.on(Input.EventType.TOUCH_END, this.onTouchEnd, this); } onTouchStart(event: EventTouch) { // è·å–è§¦æ‘¸ä½ç½® const touchPos = event.getUILocation(); this.updateMoveDirection(touchPos); } onTouchMove(event: EventTouch) { const touchPos = event.getUILocation(); this.updateMoveDirection(touchPos); } onTouchEnd() { this._moveDir.set(0, 0, 0); } private updateMoveDirection(touchPos: Vec3) { const playerPos = this.playerNode.position; const dir = new Vec3( touchPos.x - playerPos.x, touchPos.y - playerPos.y, 0 ); Vec3.normalize(dir, dir); this._moveDir = dir; } update(deltaTime: number) { if (this._moveDir.lengthSquared() \u0026gt; 0) { const movement = new Vec3(); Vec3.multiplyScalar(movement, this._moveDir, this.moveSpeed * deltaTime); const newPos = this.playerNode.position.clone(); Vec3.add(newPos, newPos, movement); this.playerNode.position = newPos; } } onDestroy() { input.off(Input.EventType.TOUCH_START, this.onTouchStart, this); input.off(Input.EventType.TOUCH_MOVE, this.onTouchMove, this); input.off(Input.EventType.TOUCH_END, this.onTouchEnd); } } æ¸¸æˆæ€§èƒ½ä¼˜åŒ– å¯¹è±¡æ± ç®¡ç† 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 // å¯¹è±¡æ± å®ç° class ObjectPool { constructor(createFn, resetFn, maxSize = 50) { this.createFn = createFn; this.resetFn = resetFn; this.maxSize = maxSize; this.pool = []; } get() { if (this.pool.length \u0026gt; 0) { return this.pool.pop(); } else { return this.createFn(); } } put(obj) { if (this.pool.length \u0026lt; this.maxSize) { this.resetFn(obj); this.pool.push(obj); } } clear() { this.pool = []; } } // å­å¼¹å¯¹è±¡æ± ä½¿ç”¨ç¤ºä¾‹ class BulletManager { constructor() { this.bulletPool = new ObjectPool( // åˆ›å»ºå‡½æ•° () =\u0026gt; { const bullet = new Laya.Sprite(); bullet.graphics.drawCircle(0, 0, 5, \u0026#34;#ff0000\u0026#34;); return bullet; }, // é‡ç½®å‡½æ•° (bullet) =\u0026gt; { bullet.removeSelf(); bullet.active = false; } ); this.activeBullets = []; } createBullet(x, y, direction, speed) { const bullet = this.bulletPool.get(); bullet.pos(x, y); bullet.active = true; bullet.direction = direction; bullet.speed = speed; this.activeBullets.push(bullet); Laya.stage.addChild(bullet); } update() { for (let i = this.activeBullets.length - 1; i \u0026gt;= 0; i--) { const bullet = this.activeBullets[i]; // æ›´æ–°ä½ç½® bullet.x += bullet.direction.x * bullet.speed; bullet.y += bullet.direction.y * bullet.speed; // æ£€æŸ¥æ˜¯å¦è¶…å‡ºå±å¹• if (bullet.x \u0026lt; -50 || bullet.x \u0026gt; Laya.stage.width + 50 || bullet.y \u0026lt; -50 || bullet.y \u0026gt; Laya.stage.height + 50) { this.removeBullet(bullet); } } } removeBullet(bullet) { const index = this.activeBullets.indexOf(bullet); if (index \u0026gt; -1) { this.activeBullets.splice(index, 1); this.bulletPool.put(bullet); } } } èµ„æºåŠ è½½ä¼˜åŒ– 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 // èµ„æºåŠ è½½ç®¡ç†å™¨ class ResourceManager { constructor() { this.loadedResources = new Map(); this.loadingPromises = new Map(); } // é¢„åŠ è½½èµ„æº async preloadResources(resourceList) { const groups = this.groupResources(resourceList); for (const group of groups) { await this.loadResourceGroup(group); } } // åˆ†ç»„èµ„æºï¼ˆæŒ‰ä¼˜å…ˆçº§ï¼‰ groupResources(resources) { const critical = []; const important = []; const optional = []; resources.forEach(resource =\u0026gt; { switch (resource.priority) { case \u0026#39;critical\u0026#39;: critical.push(resource); break; case \u0026#39;important\u0026#39;: important.push(resource); break; case \u0026#39;optional\u0026#39;: optional.push(resource); break; } }); return [critical, important, optional]; } // åŠ è½½èµ„æºç»„ async loadResourceGroup(group) { const promises = group.map(resource =\u0026gt; this.loadResource(resource)); return Promise.all(promises); } // åŠ è½½å•ä¸ªèµ„æº async loadResource(resource) { if (this.loadedResources.has(resource.url)) { return this.loadedResources.get(resource.url); } if (this.loadingPromises.has(resource.url)) { return this.loadingPromises.get(resource.url); } const promise = this.doLoadResource(resource); this.loadingPromises.set(resource.url, promise); try { const result = await promise; this.loadedResources.set(resource.url, result); return result; } finally { this.loadingPromises.delete(resource.url); } } // å®é™…åŠ è½½é€»è¾‘ async doLoadResource(resource) { return new Promise((resolve, reject) =\u0026gt; { Laya.loader.load(resource.url, Laya.Handler.create(this, resolve), null, resource.type); }); } // é‡Šæ”¾æœªä½¿ç”¨èµ„æº releaseUnusedResources() { // å®ç°èµ„æºé‡Šæ”¾é€»è¾‘ Laya.loader.clearRes(); } } å¹¿å‘Šå˜ç°ç­–ç•¥ å¾®ä¿¡å°æ¸¸æˆå¹¿å‘Šç³»ç»Ÿé›†æˆ Bannerå¹¿å‘Š 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 // Bannerå¹¿å‘Šç®¡ç†å™¨ class BannerAdManager { constructor() { this.bannerAd = null; this.bannerAdUnitId = \u0026#39;adunit-xxxxx\u0026#39;; // æ›¿æ¢ä¸ºå®é™…å¹¿å‘Šä½ID this.isShowing = false; this.retryCount = 0; this.maxRetryCount = 3; } init() { // åˆ›å»ºBannerå¹¿å‘Š this.bannerAd = wx.createBannerAd({ adUnitId: this.bannerAdUnitId, style: { left: 0, top: wx.getSystemInfoSync().windowHeight - 100, width: wx.getSystemInfoSync().windowWidth } }); // ç›‘å¬å¹¿å‘ŠåŠ è½½ this.bannerAd.onLoad(() =\u0026gt; { console.log(\u0026#39;Bannerå¹¿å‘ŠåŠ è½½æˆåŠŸ\u0026#39;); this.retryCount = 0; }); // ç›‘å¬å¹¿å‘Šé”™è¯¯ this.bannerAd.onError((err) =\u0026gt; { console.error(\u0026#39;Bannerå¹¿å‘ŠåŠ è½½å¤±è´¥:\u0026#39;, err); this.retryLoad(); }); // ç›‘å¬å¹¿å‘Šå…³é—­ this.bannerAd.onClose(() =\u0026gt; { console.log(\u0026#39;Bannerå¹¿å‘Šå…³é—­\u0026#39;); this.isShowing = false; }); } show() { if (this.bannerAd \u0026amp;\u0026amp; !this.isShowing) { this.bannerAd.show().then(() =\u0026gt; { this.isShowing = true; }).catch(err =\u0026gt; { console.error(\u0026#39;Bannerå¹¿å‘Šæ˜¾ç¤ºå¤±è´¥:\u0026#39;, err); }); } } hide() { if (this.bannerAd \u0026amp;\u0026amp; this.isShowing) { this.bannerAd.hide(); this.isShowing = false; } } destroy() { if (this.bannerAd) { this.bannerAd.destroy(); this.bannerAd = null; } } retryLoad() { if (this.retryCount \u0026lt; this.maxRetryCount) { this.retryCount++; setTimeout(() =\u0026gt; { this.init(); }, 2000 * this.retryCount); } } } æ¿€åŠ±è§†é¢‘å¹¿å‘Š 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 // æ¿€åŠ±è§†é¢‘å¹¿å‘Šç®¡ç†å™¨ class RewardedVideoAdManager { constructor() { this.rewardedVideoAd = null; this.adUnitId = \u0026#39;adunit-yyyyy\u0026#39;; // æ›¿æ¢ä¸ºå®é™…å¹¿å‘Šä½ID this.isLoaded = false; this.loadPromise = null; this.watchCallback = null; } init() { this.rewardedVideoAd = wx.createRewardedVideoAd({ adUnitId: this.adUnitId }); this.setupEventListeners(); this.loadAd(); } setupEventListeners() { // å¹¿å‘ŠåŠ è½½æˆåŠŸ this.rewardedVideoAd.onLoad(() =\u0026gt; { console.log(\u0026#39;æ¿€åŠ±è§†é¢‘å¹¿å‘ŠåŠ è½½æˆåŠŸ\u0026#39;); this.isLoaded = true; this.loadPromise = null; }); // å¹¿å‘ŠåŠ è½½å¤±è´¥ this.rewardedVideoAd.onError((err) =\u0026gt; { console.error(\u0026#39;æ¿€åŠ±è§†é¢‘å¹¿å‘ŠåŠ è½½å¤±è´¥:\u0026#39;, err); this.isLoaded = false; this.loadPromise = null; // é€šçŸ¥å›è°ƒå¤±è´¥ if (this.watchCallback) { this.watchCallback({ success: false, error: err }); this.watchCallback = null; } }); // å¹¿å‘Šå…³é—­ this.rewardedVideoAd.onClose((res) =\u0026gt; { console.log(\u0026#39;æ¿€åŠ±è§†é¢‘å¹¿å‘Šå…³é—­\u0026#39;, res); // é¢„åŠ è½½ä¸‹ä¸€ä¸ªå¹¿å‘Š this.loadAd(); // é€šçŸ¥å›è°ƒç»“æœ if (this.watchCallback) { this.watchCallback({ success: res.isEnded || res.ended, rewarded: res.isEnded || res.ended }); this.watchCallback = null; } }); } async loadAd() { if (this.loadPromise) { return this.loadPromise; } this.loadPromise = new Promise((resolve) =\u0026gt; { this.rewardedVideoAd.load().then(() =\u0026gt; { resolve(); }).catch(() =\u0026gt; { resolve(); }); }); return this.loadPromise; } // è§‚çœ‹å¹¿å‘Š async watchAd() { return new Promise((resolve) =\u0026gt; { if (this.watchCallback) { resolve({ success: false, error: \u0026#39;å¹¿å‘Šæ­£åœ¨æ’­æ”¾ä¸­\u0026#39; }); return; } if (!this.isLoaded) { resolve({ success: false, error: \u0026#39;å¹¿å‘ŠæœªåŠ è½½å®Œæˆ\u0026#39; }); return; } this.watchCallback = resolve; this.rewardedVideoAd.show() .catch(err =\u0026gt; { this.watchCallback = null; resolve({ success: false, error: err }); }); }); } } æ’å±å¹¿å‘Š 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 // æ’å±å¹¿å‘Šç®¡ç†å™¨ class InterstitialAdManager { constructor() { this.interstitialAd = null; this.adUnitId = \u0026#39;adunit-zzzzz\u0026#39;; // æ›¿æ¢ä¸ºå®é™…å¹¿å‘Šä½ID this.isLoaded = false; this.lastShowTime = 0; this.minInterval = 30000; // æœ€å°é—´éš”30ç§’ } init() { this.interstitialAd = wx.createInterstitialAd({ adUnitId: this.adUnitId }); this.interstitialAd.onLoad(() =\u0026gt; { console.log(\u0026#39;æ’å±å¹¿å‘ŠåŠ è½½æˆåŠŸ\u0026#39;); this.isLoaded = true; }); this.interstitialAd.onError((err) =\u0026gt; { console.error(\u0026#39;æ’å±å¹¿å‘ŠåŠ è½½å¤±è´¥:\u0026#39;, err); this.isLoaded = false; }); this.interstitialAd.onClose(() =\u0026gt; { console.log(\u0026#39;æ’å±å¹¿å‘Šå…³é—­\u0026#39;); this.isLoaded = false; // å»¶è¿Ÿé‡æ–°åŠ è½½ setTimeout(() =\u0026gt; { this.loadAd(); }, 5000); }); this.loadAd(); } loadAd() { if (!this.isLoaded) { this.interstitialAd.load(); } } // æ˜¾ç¤ºæ’å±å¹¿å‘Š show() { const now = Date.now(); // æ£€æŸ¥æ—¶é—´é—´éš” if (now - this.lastShowTime \u0026lt; this.minInterval) { console.log(\u0026#39;æ’å±å¹¿å‘Šé—´éš”æ—¶é—´æœªåˆ°\u0026#39;); return false; } if (this.isLoaded) { this.interstitialAd.show() .then(() =\u0026gt; { this.lastShowTime = now; console.log(\u0026#39;æ’å±å¹¿å‘Šæ˜¾ç¤ºæˆåŠŸ\u0026#39;); return true; }) .catch(err =\u0026gt; { console.error(\u0026#39;æ’å±å¹¿å‘Šæ˜¾ç¤ºå¤±è´¥:\u0026#39;, err); return false; }); } else { console.log(\u0026#39;æ’å±å¹¿å‘ŠæœªåŠ è½½å®Œæˆ\u0026#39;); return false; } } } å†…è´­ç³»ç»Ÿè®¾è®¡ è™šæ‹Ÿå•†å“ç®¡ç† 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 174 175 176 177 178 179 180 181 182 183 184 185 186 187 188 189 190 191 192 193 194 195 196 197 198 199 200 201 202 // å•†åº—ç³»ç»Ÿ class GameStore { constructor() { this.products = [ { id: \u0026#39;coin_100\u0026#39;, name: \u0026#39;100é‡‘å¸\u0026#39;, price: 6, // 6å…ƒ description: \u0026#39;è·å¾—100é‡‘å¸ï¼Œå¯ç”¨äºè´­ä¹°é“å…·\u0026#39;, icon: \u0026#39;res/icons/coin_100.png\u0026#39;, type: \u0026#39;consumable\u0026#39; }, { id: \u0026#39;remove_ads\u0026#39;, name: \u0026#39;å»å¹¿å‘Š\u0026#39;, price: 12, description: \u0026#39;æ°¸ä¹…ç§»é™¤æ‰€æœ‰å¹¿å‘Š\u0026#39;, icon: \u0026#39;res/icons/no_ads.png\u0026#39;, type: \u0026#39;permanent\u0026#39; }, { id: \u0026#39;vip_month\u0026#39;, name: \u0026#39;æœˆåº¦VIP\u0026#39;, price: 18, description: \u0026#39;30å¤©VIPç‰¹æƒï¼Œäº«åŒå€å¥–åŠ±\u0026#39;, icon: \u0026#39;res/icons/vip.png\u0026#39;, type: \u0026#39;subscription\u0026#39;, duration: 30 * 24 * 60 * 60 * 1000 // 30å¤© } ]; this.purchasedItems = new Map(); this.initPayment(); } initPayment() { // åˆå§‹åŒ–æ”¯ä»˜ç³»ç»Ÿ if (wx.requestPayment) { this.paymentProvider = \u0026#39;wechat\u0026#39;; } else { console.error(\u0026#39;æ”¯ä»˜ç³»ç»Ÿä¸å¯ç”¨\u0026#39;); } } // è·å–å•†å“åˆ—è¡¨ getProducts() { return this.products; } // è´­ä¹°å•†å“ async purchaseProduct(productId) { const product = this.products.find(p =\u0026gt; p.id === productId); if (!product) { throw new Error(\u0026#39;å•†å“ä¸å­˜åœ¨\u0026#39;); } // æ£€æŸ¥æ˜¯å¦å·²è´­ä¹°æ°¸ä¹…å•†å“ if (product.type === \u0026#39;permanent\u0026#39; \u0026amp;\u0026amp; this.isProductPurchased(productId)) { throw new Error(\u0026#39;è¯¥å•†å“å·²è´­ä¹°\u0026#39;); } try { // å‘èµ·æ”¯ä»˜ await this.requestPayment(product); // æ”¯ä»˜æˆåŠŸï¼Œå¤„ç†è´­ä¹°é€»è¾‘ await this.processPurchase(product); return { success: true, product }; } catch (error) { console.error(\u0026#39;è´­ä¹°å¤±è´¥:\u0026#39;, error); return { success: false, error: error.message }; } } // å‘èµ·æ”¯ä»˜è¯·æ±‚ async requestPayment(product) { // è·å–æ”¯ä»˜å‚æ•° const paymentParams = await this.getPaymentParams(product); return new Promise((resolve, reject) =\u0026gt; { wx.requestPayment({ ...paymentParams, success: resolve, fail: reject }); }); } // è·å–æ”¯ä»˜å‚æ•° async getPaymentParams(product) { // è°ƒç”¨åç«¯APIè·å–æ”¯ä»˜å‚æ•° const response = await wx.request({ url: \u0026#39;https://api.example.com/payment/create\u0026#39;, method: \u0026#39;POST\u0026#39;, data: { productId: product.id, price: product.price, userId: wx.getStorageSync(\u0026#39;userId\u0026#39;) } }); return response.data; } // å¤„ç†è´­ä¹°ç»“æœ async processPurchase(product) { const purchaseInfo = { productId: product.id, purchaseTime: Date.now(), type: product.type }; switch (product.type) { case \u0026#39;consumable\u0026#39;: // æ¶ˆè€—å“ï¼Œç«‹å³ç»™äºˆå¥–åŠ± this.grantRewards(product); break; case \u0026#39;permanent\u0026#39;: // æ°¸ä¹…å•†å“ï¼Œè®°å½•è´­ä¹°çŠ¶æ€ this.purchasedItems.set(product.id, purchaseInfo); this.savePurchasedItems(); break; case \u0026#39;subscription\u0026#39;: // è®¢é˜…å•†å“ï¼Œè®¾ç½®è¿‡æœŸæ—¶é—´ purchaseInfo.expireTime = Date.now() + product.duration; this.purchasedItems.set(product.id, purchaseInfo); this.savePurchasedItems(); break; } // è§¦å‘è´­ä¹°äº‹ä»¶ this.triggerPurchaseEvent(product); } // ç»™äºˆå¥–åŠ± grantRewards(product) { switch (product.id) { case \u0026#39;coin_100\u0026#39;: // å¢åŠ 100é‡‘å¸ gameManager.addCoins(100); break; case \u0026#39;remove_ads\u0026#39;: // ç§»é™¤å¹¿å‘Š adManager.removeAllAds(); break; } } // æ£€æŸ¥å•†å“æ˜¯å¦å·²è´­ä¹° isProductPurchased(productId) { const purchase = this.purchasedItems.get(productId); if (!purchase) return false; if (purchase.type === \u0026#39;subscription\u0026#39;) { // æ£€æŸ¥è®¢é˜…æ˜¯å¦è¿‡æœŸ return Date.now() \u0026lt; purchase.expireTime; } return true; } // è·å–è´­ä¹°çŠ¶æ€ getPurchaseStatus() { const status = {}; this.purchasedItems.forEach((purchase, productId) =\u0026gt; { status[productId] = { purchased: this.isProductPurchased(productId), purchaseTime: purchase.purchaseTime, expireTime: purchase.expireTime }; }); return status; } // ä¿å­˜è´­ä¹°è®°å½• savePurchasedItems() { const data = Array.from(this.purchasedItems.entries()); wx.setStorageSync(\u0026#39;purchasedItems\u0026#39;, data); } // åŠ è½½è´­ä¹°è®°å½• loadPurchasedItems() { const data = wx.getStorageSync(\u0026#39;purchasedItems\u0026#39;) || []; this.purchasedItems = new Map(data); } // è§¦å‘è´­ä¹°äº‹ä»¶ triggerPurchaseEvent(product) { // æ•°æ®ç»Ÿè®¡ wx.reportAnalytics(\u0026#39;purchase\u0026#39;, { product_id: product.id, price: product.price, timestamp: Date.now() }); // æ¸¸æˆå†…äº‹ä»¶ gameManager.eventSystem.emit(\u0026#39;product_purchased\u0026#39;, product); } } ç”¨æˆ·ç•™å­˜ä¸å¢é•¿ æ¸¸æˆæ•°æ®åˆ†æ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 174 175 176 177 178 179 180 181 182 183 184 185 186 187 188 189 190 191 192 193 194 195 196 197 198 199 200 201 202 203 204 205 206 207 208 209 210 211 212 213 214 215 216 217 218 219 220 221 222 223 224 225 226 227 228 229 230 231 232 233 234 235 236 237 238 239 240 241 242 243 244 245 246 247 248 249 250 251 252 253 254 255 256 257 258 259 260 261 262 263 264 265 266 267 268 269 270 271 272 273 274 275 276 // æ¸¸æˆæ•°æ®åˆ†æç³»ç»Ÿ class GameAnalytics { constructor() { this.sessionStartTime = Date.now(); this.sessionId = this.generateSessionId(); this.customEvents = []; this.levelProgress = new Map(); } // ç”Ÿæˆä¼šè¯ID generateSessionId() { return Date.now().toString(36) + Math.random().toString(36).substr(2); } // è®°å½•æ¸¸æˆå¼€å§‹ trackGameStart() { const event = { eventName: \u0026#39;game_start\u0026#39;, timestamp: Date.now(), sessionId: this.sessionId, properties: { deviceInfo: wx.getSystemInfoSync(), isNewPlayer: this.isNewPlayer(), lastPlayTime: wx.getStorageSync(\u0026#39;lastPlayTime\u0026#39;) || null } }; this.reportEvent(event); } // è®°å½•æ¸¸æˆç»“æŸ trackGameEnd(properties = {}) { const sessionDuration = Date.now() - this.sessionStartTime; const event = { eventName: \u0026#39;game_end\u0026#39;, timestamp: Date.now(), sessionId: this.sessionId, properties: { sessionDuration, level: properties.level || 1, score: properties.score || 0, reason: properties.reason || \u0026#39;normal\u0026#39; } }; this.reportEvent(event); // ä¿å­˜æ¸¸æˆæ—¶é•¿ this.savePlaytime(sessionDuration); } // è®°å½•å…³å¡è¿›åº¦ trackLevelStart(levelId) { const event = { eventName: \u0026#39;level_start\u0026#39;, timestamp: Date.now(), sessionId: this.sessionId, properties: { levelId, attempts: this.getLevelAttempts(levelId) } }; this.reportEvent(event); } trackLevelComplete(levelId, properties = {}) { const attempts = this.getLevelAttempts(levelId); const event = { eventName: \u0026#39;level_complete\u0026#39;, timestamp: Date.now(), sessionId: this.sessionId, properties: { levelId, attempts, duration: properties.duration, stars: properties.stars || 0, score: properties.score || 0 } }; this.reportEvent(event); // æ›´æ–°å…³å¡è¿›åº¦ this.updateLevelProgress(levelId, \u0026#39;complete\u0026#39;); } trackLevelFail(levelId, properties = {}) { const attempts = this.getLevelAttempts(levelId); const event = { eventName: \u0026#39;level_fail\u0026#39;, timestamp: Date.now(), sessionId: this.sessionId, properties: { levelId, attempts, reason: properties.reason || \u0026#39;timeout\u0026#39;, progress: properties.progress || 0 } }; this.reportEvent(event); // æ›´æ–°å…³å¡è¿›åº¦ this.updateLevelProgress(levelId, \u0026#39;fail\u0026#39;); } // è®°å½•å¹¿å‘Šè§‚çœ‹ trackAdWatch(adType, result) { const event = { eventName: \u0026#39;ad_watch\u0026#39;, timestamp: Date.now(), sessionId: this.sessionId, properties: { adType, // \u0026#39;banner\u0026#39;, \u0026#39;interstitial\u0026#39;, \u0026#39;rewarded\u0026#39; result, // \u0026#39;completed\u0026#39;, \u0026#39;skipped\u0026#39;, \u0026#39;failed\u0026#39; placement: this.getCurrentPlacement() } }; this.reportEvent(event); } // è®°å½•å†…è´­è¡Œä¸º trackPurchase(productId, price, result) { const event = { eventName: \u0026#39;purchase\u0026#39;, timestamp: Date.now(), sessionId: this.sessionId, properties: { productId, price, result, // \u0026#39;success\u0026#39;, \u0026#39;failed\u0026#39;, \u0026#39;cancelled\u0026#39; level: this.getCurrentLevel() } }; this.reportEvent(event); } // è®°å½•è‡ªå®šä¹‰äº‹ä»¶ trackCustomEvent(eventName, properties = {}) { const event = { eventName, timestamp: Date.now(), sessionId: this.sessionId, properties }; this.customEvents.push(event); this.reportEvent(event); } // ä¸ŠæŠ¥äº‹ä»¶åˆ°æœåŠ¡å™¨ async reportEvent(event) { try { await wx.request({ url: \u0026#39;https://api.example.com/analytics/events\u0026#39;, method: \u0026#39;POST\u0026#39;, data: { events: [event], userId: wx.getStorageSync(\u0026#39;userId\u0026#39;), appId: wx.getAccountInfoSync().miniProgram.appId } }); } catch (error) { console.error(\u0026#39;äº‹ä»¶ä¸ŠæŠ¥å¤±è´¥:\u0026#39;, error); // æœ¬åœ°ç¼“å­˜ï¼Œç¨åé‡è¯• this.cacheEvent(event); } } // ç¼“å­˜äº‹ä»¶ cacheEvent(event) { const cachedEvents = wx.getStorageSync(\u0026#39;cachedEvents\u0026#39;) || []; cachedEvents.push(event); // é™åˆ¶ç¼“å­˜å¤§å° if (cachedEvents.length \u0026gt; 100) { cachedEvents.shift(); } wx.setStorageSync(\u0026#39;cachedEvents\u0026#39;, cachedEvents); } // é‡è¯•ä¸ŠæŠ¥ç¼“å­˜çš„äº‹ä»¶ async retryCachedEvents() { const cachedEvents = wx.getStorageSync(\u0026#39;cachedEvents\u0026#39;) || []; if (cachedEvents.length === 0) return; try { await wx.request({ url: \u0026#39;https://api.example.com/analytics/events\u0026#39;, method: \u0026#39;POST\u0026#39;, data: { events: cachedEvents, userId: wx.getStorageSync(\u0026#39;userId\u0026#39;), appId: wx.getAccountInfoSync().miniProgram.appId } }); // æ¸…ç©ºç¼“å­˜ wx.removeStorageSync(\u0026#39;cachedEvents\u0026#39;); } catch (error) { console.error(\u0026#39;ç¼“å­˜äº‹ä»¶ä¸ŠæŠ¥å¤±è´¥:\u0026#39;, error); } } // è·å–å…³å¡å°è¯•æ¬¡æ•° getLevelAttempts(levelId) { const key = `level_attempts_${levelId}`; return wx.getStorageSync(key) || 0; } // å¢åŠ å…³å¡å°è¯•æ¬¡æ•° incrementLevelAttempts(levelId) { const key = `level_attempts_${levelId}`; const attempts = this.getLevelAttempts(levelId); wx.setStorageSync(key, attempts + 1); } // æ›´æ–°å…³å¡è¿›åº¦ updateLevelProgress(levelId, status) { if (!this.levelProgress.has(levelId)) { this.levelProgress.set(levelId, { attempts: 0, bestScore: 0, completed: false, completedAt: null }); } const progress = this.levelProgress.get(levelId); progress.attempts++; if (status === \u0026#39;complete\u0026#39; \u0026amp;\u0026amp; !progress.completed) { progress.completed = true; progress.completedAt = Date.now(); } wx.setStorageSync(\u0026#39;levelProgress\u0026#39;, Array.from(this.levelProgress.entries())); } // æ£€æŸ¥æ˜¯å¦ä¸ºæ–°ç©å®¶ isNewPlayer() { return !wx.getStorageSync(\u0026#39;hasPlayedBefore\u0026#39;); } // ä¿å­˜æ¸¸æˆæ—¶é•¿ savePlaytime(duration) { const today = new Date().toDateString(); const playtimeData = wx.getStorageSync(\u0026#39;playtimeData\u0026#39;) || {}; if (!playtimeData[today]) { playtimeData[today] = 0; } playtimeData[today] += duration; wx.setStorageSync(\u0026#39;playtimeData\u0026#39;, playtimeData); wx.setStorageSync(\u0026#39;lastPlayTime\u0026#39;, Date.now()); wx.setStorageSync(\u0026#39;hasPlayedBefore\u0026#39;, true); } // è·å–å½“å‰å…³å¡ getCurrentLevel() { return wx.getStorageSync(\u0026#39;currentLevel\u0026#39;) || 1; } // è·å–å½“å‰å¹¿å‘Šä½ getCurrentPlacement() { return wx.getStorageSync(\u0026#39;currentPlacement\u0026#39;) || \u0026#39;unknown\u0026#39;; } } A/Bæµ‹è¯•ç³»ç»Ÿ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 // A/Bæµ‹è¯•ç®¡ç†å™¨ class ABTestManager { constructor() { this.experiments = new Map(); this.userVariant = new Map(); this.loadExperiments(); } // åŠ è½½å®éªŒé…ç½® async loadExperiments() { try { const response = await wx.request({ url: \u0026#39;https://api.example.com/abtest/experiments\u0026#39;, method: \u0026#39;GET\u0026#39; }); response.data.forEach(experiment =\u0026gt; { this.experiments.set(experiment.id, experiment); }); // ä¸ºç”¨æˆ·åˆ†é…å®éªŒç»„ this.assignUserToExperiments(); } catch (error) { console.error(\u0026#39;åŠ è½½A/Bæµ‹è¯•é…ç½®å¤±è´¥:\u0026#39;, error); } } // ä¸ºç”¨æˆ·åˆ†é…å®éªŒç»„ assignUserToExperiments() { const userId = wx.getStorageSync(\u0026#39;userId\u0026#39;) || this.generateUserId(); wx.setStorageSync(\u0026#39;userId\u0026#39;, userId); this.experiments.forEach((experiment, expId) =\u0026gt; { if (!this.userVariant.has(expId)) { const variant = this.assignVariant(experiment, userId); this.userVariant.set(expId, variant); // è®°å½•åˆ†ç»„äº‹ä»¶ this.trackExperimentAssignment(expId, variant); } }); // ä¿å­˜åˆ†ç»„ç»“æœ this.saveUserVariants(); } // åˆ†é…å˜ä½“ assignVariant(experiment, userId) { const hash = this.hashString(userId + experiment.id); const ratio = hash / 0xFFFFFFFF; let cumulativeRatio = 0; for (const variant of experiment.variants) { cumulativeRatio += variant.ratio; if (ratio \u0026lt;= cumulativeRatio) { return variant.id; } } // é»˜è®¤è¿”å›ç¬¬ä¸€ä¸ªå˜ä½“ return experiment.variants[0].id; } // å­—ç¬¦ä¸²å“ˆå¸Œ hashString(str) { let hash = 0; for (let i = 0; i \u0026lt; str.length; i++) { const char = str.charCodeAt(i); hash = ((hash \u0026lt;\u0026lt; 5) - hash) + char; hash = hash \u0026amp; hash; } return Math.abs(hash); } // ç”Ÿæˆç”¨æˆ·ID generateUserId() { return Date.now().toString(36) + Math.random().toString(36).substr(2); } // è·å–å®éªŒå˜ä½“ getVariant(experimentId) { return this.userVariant.get(experimentId); } // æ£€æŸ¥æ˜¯å¦åœ¨å®éªŒä¸­ isInExperiment(experimentId, variantId) { const userVariant = this.getVariant(experimentId); return userVariant === variantId; } // åº”ç”¨å®éªŒé…ç½® applyExperimentConfig(experimentId, defaultValue) { const variant = this.getVariant(experimentId); const experiment = this.experiments.get(experimentId); if (!experiment || !variant) { return defaultValue; } const variantConfig = experiment.variants.find(v =\u0026gt; v.id === variant); return variantConfig ? variantConfig.config : defaultValue; } // è®°å½•å®éªŒåˆ†ç»„ trackExperimentAssignment(experimentId, variant) { wx.reportAnalytics(\u0026#39;experiment_assignment\u0026#39;, { experiment_id: experimentId, variant: variant, timestamp: Date.now() }); } // è®°å½•å®éªŒç»“æœ trackExperimentResult(experimentId, metric, value) { const variant = this.getVariant(experimentId); wx.reportAnalytics(\u0026#39;experiment_result\u0026#39;, { experiment_id: experimentId, variant: variant, metric: metric, value: value, timestamp: Date.now() }); } // ä¿å­˜ç”¨æˆ·åˆ†ç»„ saveUserVariants() { const data = Array.from(this.userVariant.entries()); wx.setStorageSync(\u0026#39;abtest_variants\u0026#39;, data); } // åŠ è½½ç”¨æˆ·åˆ†ç»„ loadUserVariants() { const data = wx.getStorageSync(\u0026#39;abtest_variants\u0026#39;) || []; this.userVariant = new Map(data); } } æ€»ç»“ å°æ¸¸æˆå¼€å‘ä¸å˜ç°éœ€è¦ç»¼åˆè€ƒé‡å¤šä¸ªæ–¹é¢ï¼š\næŠ€æœ¯å®ç°ï¼š\né€‰æ‹©åˆé€‚çš„æ¸¸æˆå¼•æ“å’Œå¼€å‘æ¡†æ¶ å®ç°é«˜æ•ˆçš„æ€§èƒ½ä¼˜åŒ–ç­–ç•¥ å»ºç«‹å®Œå–„çš„èµ„æºç®¡ç†ç³»ç»Ÿ å˜ç°æ¨¡å¼ï¼š\nå¤šå…ƒåŒ–å¹¿å‘Šç³»ç»Ÿé›†æˆ åˆç†çš„å†…è´­æœºåˆ¶è®¾è®¡ æŒç»­çš„ç”¨æˆ·ä»·å€¼æŒ–æ˜ ç”¨æˆ·è¿è¥ï¼š\næ·±åº¦çš„æ•°æ®åˆ†æå’Œç›‘æ§ A/Bæµ‹è¯•é©±åŠ¨çš„äº§å“ä¼˜åŒ– ç”¨æˆ·ç•™å­˜å’Œå¢é•¿ç­–ç•¥ å•†ä¸šåŒ–æˆåŠŸè¦ç´ ï¼š\nä¼˜è´¨çš„æ¸¸æˆå†…å®¹å’Œä½“éªŒ åˆç†çš„å˜ç°èŠ‚å¥å’Œç­–ç•¥ ç²¾ç»†åŒ–çš„è¿è¥å’Œä¼˜åŒ– é€šè¿‡ç³»ç»ŸåŒ–çš„å¼€å‘å’Œè¿è¥ç­–ç•¥ï¼Œå°æ¸¸æˆå¯ä»¥å®ç°å•†ä¸šæˆåŠŸï¼Œä¸ºç”¨æˆ·åˆ›é€ ä»·å€¼çš„åŒæ—¶è·å¾—æŒç»­æ”¶ç›Šã€‚\nç›¸å…³èµ„æºï¼š\nå¾®ä¿¡å°æ¸¸æˆå®˜æ–¹æ–‡æ¡£ LayaAirå®˜æ–¹æ–‡æ¡£ Cocos Creatorå®˜æ–¹æ–‡æ¡£ å°æ¸¸æˆæ•°æ®åˆ†ææŒ‡å— ","permalink":"/blog/articles/mini-game-development-monetization/","summary":"æ·±å…¥æ¢è®¨å°æ¸¸æˆå¼€å‘çš„æ ¸å¿ƒæŠ€å·§å’Œå¤šç§å˜ç°æ¨¡å¼ï¼Œå¸®åŠ©å¼€å‘è€…æ‰“é€ ç›ˆåˆ©çš„æ¸¸æˆäº§å“ã€‚","title":"å°æ¸¸æˆå¼€å‘ä¸å˜ç°å®Œå…¨æŒ‡å—ï¼šä»åˆ›æ„åˆ°ç›ˆåˆ©çš„å®æˆ˜æ‰‹å†Œ"},{"content":"å¼•è¨€ å°ç¨‹åºä½œä¸ºè½»é‡çº§åº”ç”¨å½¢æ€ï¼Œå·²æˆä¸ºç§»åŠ¨äº’è”ç½‘çš„é‡è¦å…¥å£ã€‚æˆªè‡³2024å¹´ï¼Œå¾®ä¿¡å°ç¨‹åºæ—¥æ´»è·ƒç”¨æˆ·è¶…è¿‡7äº¿ï¼Œæ”¯ä»˜å®å°ç¨‹åºæœˆæ´»è·ƒç”¨æˆ·çªç ´6äº¿ã€‚æœ¬æ–‡å°†æ·±å…¥æ¢è®¨å°ç¨‹åºå¼€å‘çš„é«˜çº§æŠ€å·§ï¼Œå¸®åŠ©å¼€å‘è€…æ„å»ºé«˜è´¨é‡ã€é«˜æ€§èƒ½çš„å°ç¨‹åºåº”ç”¨ã€‚\nå°ç¨‹åºç”Ÿæ€ç³»ç»Ÿæ¦‚è§ˆ ä¸»æµå°ç¨‹åºå¹³å°å¯¹æ¯” å¹³å° ç”¨æˆ·è§„æ¨¡ ä¸»è¦ç‰¹ç‚¹ å¼€å‘è¯­è¨€ å…¥é©»é—¨æ§› å¾®ä¿¡ 7äº¿+ DAU ç¤¾äº¤è£‚å˜èƒ½åŠ›å¼º JavaScript/WXML ä¼ä¸šè®¤è¯ æ”¯ä»˜å® 6äº¿+ MAU å•†ä¸šåŒ–åœºæ™¯ä¸°å¯Œ JavaScript/AXML ä¼ä¸šè®¤è¯ ç™¾åº¦ 4äº¿+ MAU æœç´¢æµé‡å…¥å£ JavaScript/Swan ä¸ªäººå¯æ³¨å†Œ å­—èŠ‚è·³åŠ¨ 3äº¿+ MAU å†…å®¹åˆ†å‘ä¼˜åŠ¿ JavaScript/Ttml ä¼ä¸šè®¤è¯ å¼€å‘æ¡†æ¶é€‰æ‹© åŸç”Ÿå¼€å‘ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 // å¾®ä¿¡å°ç¨‹åºåŸç”Ÿå¼€å‘ // app.js App({ onLaunch() { // è·å–ç”¨æˆ·ä¿¡æ¯ wx.getSetting({ success: (res) =\u0026gt; { if (res.authSetting[\u0026#39;scope.userInfo\u0026#39;]) { wx.getUserInfo({ success: (res) =\u0026gt; { this.globalData.userInfo = res.userInfo } }) } } }) }, globalData: { userInfo: null } }) // é¡µé¢æ–‡ä»¶ // pages/index/index.js Page({ data: { motto: \u0026#39;Hello World\u0026#39;, userInfo: {}, hasUserInfo: false }, onLoad() { if (app.globalData.userInfo) { this.setData({ userInfo: app.globalData.userInfo, hasUserInfo: true }) } else if (this.data.canIUse) { // ç”±äº getUserInfo æ˜¯ç½‘ç»œè¯·æ±‚ï¼Œå¯èƒ½ä¼šåœ¨ Page.onLoad ä¹‹åæ‰è¿”å› // æ‰€ä»¥æ­¤å¤„åŠ å…¥ callback ä»¥é˜²æ­¢è¿™ç§æƒ…å†µ app.userInfoReadyCallback = res =\u0026gt; { this.setData({ userInfo: res.userInfo, hasUserInfo: true }) } } else { // åœ¨æ²¡æœ‰ open-type=getUserInfo ç‰ˆæœ¬çš„å…¼å®¹å¤„ç† wx.getUserInfo({ success: res =\u0026gt; { app.globalData.userInfo = res.userInfo this.setData({ userInfo: res.userInfo, hasUserInfo: true }) } }) } }, getUserInfo(e) { this.setData({ userInfo: e.detail.userInfo, hasUserInfo: true }) } }) è·¨ç«¯æ¡†æ¶å¼€å‘ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 // Taroè·¨ç«¯æ¡†æ¶å¼€å‘ // app.config.js export default { pages: [ \u0026#39;pages/index/index\u0026#39;, \u0026#39;pages/profile/index\u0026#39; ], window: { backgroundTextStyle: \u0026#39;light\u0026#39;, navigationBarBackgroundColor: \u0026#39;#fff\u0026#39;, navigationBarTitleText: \u0026#39;WeChat\u0026#39;, navigationBarTextStyle: \u0026#39;black\u0026#39; } } // é¡µé¢ç»„ä»¶ // pages/index/index.jsx import { Component } from \u0026#39;@tarojs/taro\u0026#39; import { View, Text, Button } from \u0026#39;@tarojs/components\u0026#39; import \u0026#39;./index.scss\u0026#39; export default class Index extends Component { state = { motto: \u0026#39;Hello World\u0026#39;, userInfo: {} } componentWillMount() { } componentDidMount() { } componentWillUnmount() { } componentDidShow() { } componentDidHide() { } render() { return ( \u0026lt;View className=\u0026#39;index\u0026#39;\u0026gt; \u0026lt;View className=\u0026#39;userinfo\u0026#39;\u0026gt; \u0026lt;Button\u0026gt;è·å–å¤´åƒæ˜µç§°\u0026lt;/Button\u0026gt; \u0026lt;Text className=\u0026#39;user-nickname\u0026#39;\u0026gt;{this.state.userInfo.nickName}\u0026lt;/Text\u0026gt; \u0026lt;/View\u0026gt; \u0026lt;View className=\u0026#39;usermotto\u0026#39;\u0026gt; \u0026lt;Text className=\u0026#39;user-motto\u0026#39;\u0026gt;{this.state.motto}\u0026lt;/Text\u0026gt; \u0026lt;/View\u0026gt; \u0026lt;/View\u0026gt; ) } } æ¶æ„è®¾è®¡ä¸æœ€ä½³å®è·µ é¡¹ç›®ç»“æ„è®¾è®¡ miniprogram/ â”œâ”€â”€ components/ # å…¬å…±ç»„ä»¶ â”‚ â”œâ”€â”€ nav-bar/ # å¯¼èˆªæ ç»„ä»¶ â”‚ â”œâ”€â”€ loading/ # åŠ è½½ç»„ä»¶ â”‚ â””â”€â”€ empty/ # ç©ºçŠ¶æ€ç»„ä»¶ â”œâ”€â”€ pages/ # é¡µé¢ â”‚ â”œâ”€â”€ index/ # é¦–é¡µ â”‚ â”œâ”€â”€ profile/ # ä¸ªäººä¸­å¿ƒ â”‚ â””â”€â”€ detail/ # è¯¦æƒ…é¡µ â”œâ”€â”€ utils/ # å·¥å…·å‡½æ•° â”‚ â”œâ”€â”€ request.js # ç½‘ç»œè¯·æ±‚ â”‚ â”œâ”€â”€ storage.js # æœ¬åœ°å­˜å‚¨ â”‚ â””â”€â”€ format.js # æ•°æ®æ ¼å¼åŒ– â”œâ”€â”€ api/ # APIæ¥å£ â”œâ”€â”€ assets/ # é™æ€èµ„æº â”œâ”€â”€ styles/ # æ ·å¼æ–‡ä»¶ â”œâ”€â”€ behaviors/ # è¡Œä¸º â””â”€â”€ mixins/ # æ··å…¥ çŠ¶æ€ç®¡ç†æ–¹æ¡ˆ å…¨å±€çŠ¶æ€ç®¡ç† 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 // behaviors/store.js const storeBehavior = Behavior({ data: { $state: {} }, methods: { $setState(newState) { this.setData({ $state: { ...this.data.$state, ...newState } }) // é€šçŸ¥å…¶ä»–é¡µé¢ const pages = getCurrentPages() const currentPage = pages[pages.length - 1] const eventChannel = currentPage.getOpenerEventChannel() if (eventChannel) { eventChannel.emit(\u0026#39;stateChange\u0026#39;, { ...this.data.$state, ...newState }) } }, $getState(key) { return key ? this.data.$state[key] : this.data.$state } } }) // é¡µé¢ä¸­ä½¿ç”¨ // pages/profile/profile.js const storeBehavior = require(\u0026#39;../../behaviors/store\u0026#39;) Page({ behaviors: [storeBehavior], onLoad() { // ç›‘å¬çŠ¶æ€å˜åŒ– const eventChannel = this.getOpenerEventChannel() eventChannel.on(\u0026#39;stateChange\u0026#39;, (newState) =\u0026gt; { this.setData({ $state: newState }) }) }, updateProfile() { this.$setState({ userName: \u0026#39;æ–°ç”¨æˆ·å\u0026#39;, avatar: \u0026#39;æ–°å¤´åƒURL\u0026#39; }) } }) ç»„ä»¶åŒ–å¼€å‘ å¯å¤ç”¨ç»„ä»¶è®¾è®¡ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 // components/card/card.js Component({ options: { styleIsolation: \u0026#39;apply-shared\u0026#39; }, properties: { title: { type: String, value: \u0026#39;\u0026#39; }, content: { type: String, value: \u0026#39;\u0026#39; }, showFooter: { type: Boolean, value: true }, footerBtnText: { type: String, value: \u0026#39;ç¡®å®š\u0026#39; } }, data: { isExpanded: false }, methods: { toggleContent() { this.setData({ isExpanded: !this.data.isExpanded }) }, onFooterBtnTap() { this.triggerEvent(\u0026#39;footerclick\u0026#39;, { expanded: this.data.isExpanded }) }, onCardTap() { this.triggerEvent(\u0026#39;cardtap\u0026#39;) } } }) æ€§èƒ½ä¼˜åŒ–æŠ€å·§ ä»£ç åŒ…ä¼˜åŒ– åˆ†åŒ…ç­–ç•¥ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 // app.json { \u0026#34;pages\u0026#34;: [ \u0026#34;pages/index/index\u0026#34;, \u0026#34;pages/profile/profile\u0026#34; ], \u0026#34;subPackages\u0026#34;: [ { \u0026#34;root\u0026#34;: \u0026#34;packageA\u0026#34;, \u0026#34;pages\u0026#34;: [ \u0026#34;pages/a/index\u0026#34;, \u0026#34;pages/b/index\u0026#34; ] }, { \u0026#34;root\u0026#34;: \u0026#34;packageB\u0026#34;, \u0026#34;name\u0026#34;: \u0026#34;pack2\u0026#34;, \u0026#34;pages\u0026#34;: [ \u0026#34;pages/c/index\u0026#34; ], \u0026#34;independent\u0026#34;: true } ], \u0026#34;preloadRule\u0026#34;: { \u0026#34;pages/index/index\u0026#34;: { \u0026#34;network\u0026#34;: \u0026#34;all\u0026#34;, \u0026#34;packages\u0026#34;: [\u0026#34;packageA\u0026#34;] } } } å›¾ç‰‡ä¼˜åŒ– 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 // utils/image.js const imageUtils = { // å›¾ç‰‡æ‡’åŠ è½½ lazyLoad() { const images = wx.createIntersectionObserver() images.relativeToViewport().observe(\u0026#39;.lazy-image\u0026#39;, (res) =\u0026gt; { if (res.intersectionRatio \u0026gt; 0) { const img = res.target const src = img.dataset.src if (src) { img.src = src img.removeAttribute(\u0026#39;data-src\u0026#39;) } } }) }, // å›¾ç‰‡å‹ç¼© compressImage(src, quality = 0.8) { return new Promise((resolve) =\u0026gt; { wx.compressImage({ src, quality, success: (res) =\u0026gt; resolve(res.tempFilePath), fail: () =\u0026gt; resolve(src) }) }) }, // WebPæ ¼å¼æ£€æµ‹ supportWebP() { return new Promise((resolve) =\u0026gt; { wx.getImageInfo({ src: \u0026#39;data:image/webp;base64,UklGRiQAAABXRUJQVlA4IBgAAAAwAQCdASoBAAEAAwA0JaQAA3AA/vuUAAA=\u0026#39;, success: () =\u0026gt; resolve(true), fail: () =\u0026gt; resolve(false) }) }) } } æ¸²æŸ“æ€§èƒ½ä¼˜åŒ– è™šæ‹Ÿåˆ—è¡¨å®ç° 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 // components/virtual-list/virtual-list.js Component({ properties: { data: { type: Array, value: [] }, itemHeight: { type: Number, value: 50 }, visibleCount: { type: Number, value: 10 } }, data: { startIndex: 0, visibleData: [], totalHeight: 0 }, observers: { \u0026#39;data, itemHeight\u0026#39;: function(data, itemHeight) { const totalHeight = data.length * itemHeight this.setData({ totalHeight, visibleData: data.slice(0, this.properties.visibleCount) }) } }, methods: { onScroll(e) { const scrollTop = e.detail.scrollTop const { itemHeight, visibleCount } = this.properties const startIndex = Math.floor(scrollTop / itemHeight) const endIndex = Math.min( startIndex + visibleCount + 5, // é¢„ç•™5é¡¹ this.properties.data.length ) const visibleData = this.properties.data.slice(startIndex, endIndex) this.setData({ startIndex, visibleData, offsetY: startIndex * itemHeight }) }, getItemStyle(index) { const { startIndex, itemHeight } = this.data const actualIndex = startIndex + index return `height: ${itemHeight}px; transform: translateY(${actualIndex * itemHeight}px)` } } }) ç½‘ç»œè¯·æ±‚ä¼˜åŒ– è¯·æ±‚å°è£… 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 // utils/request.js class Request { constructor() { this.baseUrl = \u0026#39;https://api.example.com\u0026#39; this.timeout = 10000 this.interceptors = { request: [], response: [] } } addRequestInterceptor(interceptor) { this.interceptors.request.push(interceptor) } addResponseInterceptor(interceptor) { this.interceptors.response.push(interceptor) } request(options) { // æ‰§è¡Œè¯·æ±‚æ‹¦æˆªå™¨ let config = { ...options } this.interceptors.request.forEach(interceptor =\u0026gt; { config = interceptor(config) || config }) return new Promise((resolve, reject) =\u0026gt; { wx.request({ url: this.baseUrl + config.url, method: config.method || \u0026#39;GET\u0026#39;, data: config.data, header: { \u0026#39;content-type\u0026#39;: \u0026#39;application/json\u0026#39;, ...config.header }, timeout: this.timeout, success: (res) =\u0026gt; { // æ‰§è¡Œå“åº”æ‹¦æˆªå™¨ let response = res this.interceptors.response.forEach(interceptor =\u0026gt; { response = interceptor(response) || response }) if (response.statusCode === 200) { resolve(response.data) } else { reject(response) } }, fail: reject }) }) } // ç¼“å­˜è¯·æ±‚ cacheRequest(key, requestFn, expireTime = 5 * 60 * 1000) { const cacheKey = `cache_${key}` const cachedData = wx.getStorageSync(cacheKey) if (cachedData \u0026amp;\u0026amp; Date.now() - cachedData.timestamp \u0026lt; expireTime) { return Promise.resolve(cachedData.data) } return requestFn().then(data =\u0026gt; { wx.setStorageSync(cacheKey, { data, timestamp: Date.now() }) return data }) } } // åˆ›å»ºå®ä¾‹ const request = new Request() // æ·»åŠ æ‹¦æˆªå™¨ request.addRequestInterceptor((config) =\u0026gt; { // æ·»åŠ token const token = wx.getStorageSync(\u0026#39;token\u0026#39;) if (token) { config.header = { ...config.header, \u0026#39;Authorization\u0026#39;: `Bearer ${token}` } } return config }) request.addResponseInterceptor((response) =\u0026gt; { // ç»Ÿä¸€é”™è¯¯å¤„ç† if (response.statusCode === 401) { wx.removeStorageSync(\u0026#39;token\u0026#39;) wx.navigateTo({ url: \u0026#39;/pages/login/login\u0026#39; }) } return response }) module.exports = request ç”¨æˆ·ä½“éªŒæå‡ äº¤äº’è®¾è®¡ æ‰‹åŠ¿æ“ä½œ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 // components/swipe-action/swipe-action.js Component({ properties: { disabled: { type: Boolean, value: false }, autoClose: { type: Boolean, value: true } }, data: { x: 0, startX: 0, moveX: 0, buttons: [] }, methods: { onTouchStart(e) { if (this.properties.disabled) return const touch = e.touches[0] this.setData({ startX: touch.clientX, moveX: this.data.x }) }, onTouchMove(e) { if (this.properties.disabled) return const touch = e.touches[0] const diffX = touch.clientX - this.data.startX let x = this.data.moveX + diffX // é™åˆ¶æ»‘åŠ¨èŒƒå›´ const maxMove = this.data.buttons.reduce((sum, btn) =\u0026gt; { return sum + (btn.width || 80) }, 0) x = Math.max(-maxMove, Math.min(0, x)) this.setData({ x }) }, onTouchEnd() { if (this.properties.disabled) return const { x, moveX } = this.data const diff = Math.abs(x - moveX) // åˆ¤æ–­æ˜¯å¦è§¦å‘æŒ‰é’® if (diff \u0026gt; 30) { this.triggerAction(x \u0026lt; moveX ? \u0026#39;left\u0026#39; : \u0026#39;right\u0026#39;) } else { // å›å¼¹ this.setData({ x: moveX }) } }, triggerAction(direction) { if (direction === \u0026#39;left\u0026#39;) { // æ‰§è¡Œå·¦æ»‘æ“ä½œ this.triggerEvent(\u0026#39;leftaction\u0026#39;) } } } }) åŠ¨ç”»æ•ˆæœ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 // utils/animation.js class AnimationUtils { // åˆ›å»ºåŠ¨ç”»å®ä¾‹ static createAnimation(duration = 300, timingFunction = \u0026#39;ease\u0026#39;) { return wx.createAnimation({ duration, timingFunction }) } // æ·¡å…¥æ·¡å‡º static fadeIn(page, selector = \u0026#39;.fade-element\u0026#39;) { const animation = this.createAnimation() animation.opacity(1).step() page.setData({ [`${selector}Animation`]: animation.export() }) } static fadeOut(page, selector = \u0026#39;.fade-element\u0026#39;) { const animation = this.createAnimation() animation.opacity(0).step() page.setData({ [`${selector}Animation`]: animation.export() }) } // æ»‘å…¥æ•ˆæœ static slideIn(page, selector = \u0026#39;.slide-element\u0026#39;, direction = \u0026#39;bottom\u0026#39;) { const animation = this.createAnimation() switch (direction) { case \u0026#39;top\u0026#39;: animation.translateY(0).step() break case \u0026#39;bottom\u0026#39;: animation.translateY(0).step() break case \u0026#39;left\u0026#39;: animation.translateX(0).step() break case \u0026#39;right\u0026#39;: animation.translateX(0).step() break } page.setData({ [`${selector}Animation`]: animation.export() }) } // å¼¹æ€§åŠ¨ç”» static bounce(page, selector = \u0026#39;.bounce-element\u0026#39;) { const animation = this.createAnimation(600, \u0026#39;ease-out\u0026#39;) animation .scale(1.1) .step({ duration: 200 }) .scale(1) .step({ duration: 400 }) page.setData({ [`${selector}Animation`]: animation.export() }) } } é”™è¯¯å¤„ç† å…¨å±€é”™è¯¯å¤„ç† 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 // app.js App({ onError(err) { console.error(\u0026#39;å…¨å±€é”™è¯¯:\u0026#39;, err) // ä¸ŠæŠ¥é”™è¯¯æ—¥å¿— this.reportError(err) // æ˜¾ç¤ºå‹å¥½æç¤º wx.showToast({ title: \u0026#39;ç³»ç»Ÿç¹å¿™ï¼Œè¯·ç¨åé‡è¯•\u0026#39;, icon: \u0026#39;none\u0026#39; }) }, onUnhandledRejection(res) { console.error(\u0026#39;Promiseé”™è¯¯:\u0026#39;, res) this.reportError(res) }, reportError(error) { // é”™è¯¯ä¸ŠæŠ¥ wx.request({ url: \u0026#39;https://api.example.com/error/report\u0026#39;, method: \u0026#39;POST\u0026#39;, data: { error: error.stack || error.message, page: this.getCurrentPages().pop()?.route, userAgent: wx.getSystemInfoSync() } }) } }) ç½‘ç»œå¼‚å¸¸å¤„ç† 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 // utils/network-handler.js const networkHandler = { // æ£€æŸ¥ç½‘ç»œçŠ¶æ€ checkNetworkStatus() { return new Promise((resolve) =\u0026gt; { wx.getNetworkType({ success: (res) =\u0026gt; { resolve(res.networkType !== \u0026#39;none\u0026#39;) }, fail: () =\u0026gt; resolve(false) }) }) }, // ç½‘ç»œçŠ¶æ€ç›‘å¬ startNetworkMonitoring() { wx.onNetworkStatusChange((res) =\u0026gt; { if (!res.isConnected) { wx.showModal({ title: \u0026#39;ç½‘ç»œå¼‚å¸¸\u0026#39;, content: \u0026#39;è¯·æ£€æŸ¥ç½‘ç»œè¿æ¥\u0026#39;, showCancel: false }) } }) }, // é‡è¯•æœºåˆ¶ async retryRequest(requestFn, maxRetries = 3, delay = 1000) { let lastError for (let i = 0; i \u0026lt; maxRetries; i++) { try { const result = await requestFn() return result } catch (error) { lastError = error if (i \u0026lt; maxRetries - 1) { await new Promise(resolve =\u0026gt; setTimeout(resolve, delay * Math.pow(2, i))) } } } throw lastError } } å•†ä¸šåŒ–ç­–ç•¥ ä»˜è´¹åŠŸèƒ½å®ç° æ”¯ä»˜é›†æˆ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 // utils/payment.js const payment = { // å¾®ä¿¡æ”¯ä»˜ async wechatPay(orderInfo) { try { // ç»Ÿä¸€ä¸‹å• const paymentParams = await wx.requestPayment({ timeStamp: orderInfo.timeStamp, nonceStr: orderInfo.nonceStr, package: orderInfo.package, signType: orderInfo.signType, paySign: orderInfo.paySign }) return paymentParams } catch (error) { if (error.errMsg.includes(\u0026#39;requestPayment:fail cancel\u0026#39;)) { throw new Error(\u0026#39;ç”¨æˆ·å–æ¶ˆæ”¯ä»˜\u0026#39;) } else { throw new Error(\u0026#39;æ”¯ä»˜å¤±è´¥\u0026#39;) } } }, // æ”¯ä»˜å®æ”¯ä»˜ async alipayPay(orderInfo) { return new Promise((resolve, reject) =\u0026gt; { my.tradePay({ tradeNO: orderInfo.tradeNO, success: resolve, fail: reject }) }) }, // æŸ¥è¯¢æ”¯ä»˜çŠ¶æ€ async queryPaymentStatus(orderId) { const response = await wx.request({ url: \u0026#39;/api/payment/status\u0026#39;, method: \u0026#39;GET\u0026#39;, data: { orderId } }) return response.data } } ä¼šå‘˜ä½“ç³» 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 // services/member.js const memberService = { // æ£€æŸ¥ä¼šå‘˜çŠ¶æ€ async checkMemberStatus() { const userId = wx.getStorageSync(\u0026#39;userId\u0026#39;) try { const response = await wx.request({ url: \u0026#39;/api/member/status\u0026#39;, method: \u0026#39;GET\u0026#39;, data: { userId } }) return response.data } catch (error) { return { isMember: false, expireTime: null } } }, // å‡çº§ä¼šå‘˜ async upgradeMember(planId) { const userId = wx.getStorageSync(\u0026#39;userId\u0026#39;) try { const response = await wx.request({ url: \u0026#39;/api/member/upgrade\u0026#39;, method: \u0026#39;POST\u0026#39;, data: { userId, planId } }) return response.data } catch (error) { throw new Error(\u0026#39;ä¼šå‘˜å‡çº§å¤±è´¥\u0026#39;) } }, // è·å–ä¼šå‘˜æƒç›Š async getMemberBenefits() { try { const response = await wx.request({ url: \u0026#39;/api/member/benefits\u0026#39;, method: \u0026#39;GET\u0026#39; }) return response.data } catch (error) { return [] } } } æ•°æ®åˆ†æ ç”¨æˆ·è¡Œä¸ºè¿½è¸ª 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 // utils/analytics.js const analytics = { // é¡µé¢è®¿é—®ç»Ÿè®¡ trackPageView(pageName, properties = {}) { const data = { event: \u0026#39;page_view\u0026#39;, page: pageName, timestamp: Date.now(), properties: { ...properties, userId: wx.getStorageSync(\u0026#39;userId\u0026#39;), sessionId: this.getSessionId() } } this.report(data) }, // è‡ªå®šä¹‰äº‹ä»¶è¿½è¸ª trackEvent(eventName, properties = {}) { const data = { event: eventName, timestamp: Date.now(), properties: { ...properties, userId: wx.getStorageSync(\u0026#39;userId\u0026#39;), sessionId: this.getSessionId() } } this.report(data) }, // è·å–ä¼šè¯ID getSessionId() { let sessionId = wx.getStorageSync(\u0026#39;sessionId\u0026#39;) if (!sessionId) { sessionId = Date.now().toString(36) + Math.random().toString(36).substr(2) wx.setStorageSync(\u0026#39;sessionId\u0026#39;, sessionId) } return sessionId }, // æ•°æ®ä¸ŠæŠ¥ report(data) { // æ‰¹é‡ä¸ŠæŠ¥ const events = wx.getStorageSync(\u0026#39;pendingEvents\u0026#39;) || [] events.push(data) // é™åˆ¶ç¼“å­˜å¤§å° if (events.length \u0026gt; 50) { events.shift() } wx.setStorageSync(\u0026#39;pendingEvents\u0026#39;, events) // ç«‹å³ä¸ŠæŠ¥æˆ–å»¶è¿Ÿä¸ŠæŠ¥ if (data.event === \u0026#39;page_view\u0026#39;) { this.flushEvents() } else { this.scheduleFlush() } }, // ç«‹å³ä¸ŠæŠ¥ async flushEvents() { const events = wx.getStorageSync(\u0026#39;pendingEvents\u0026#39;) || [] if (events.length === 0) return try { await wx.request({ url: \u0026#39;/api/analytics/events\u0026#39;, method: \u0026#39;POST\u0026#39;, data: { events } }) wx.removeStorageSync(\u0026#39;pendingEvents\u0026#39;) } catch (error) { console.error(\u0026#39;æ•°æ®ä¸ŠæŠ¥å¤±è´¥:\u0026#39;, error) } }, // å®šæ—¶ä¸ŠæŠ¥ scheduleFlush() { if (this.flushTimer) return this.flushTimer = setTimeout(() =\u0026gt; { this.flushEvents() this.flushTimer = null }, 5000) } } // é¡µé¢ä¸­ä½¿ç”¨ // pages/index/index.js Page({ onLoad() { analytics.trackPageView(\u0026#39;index\u0026#39;) }, onButtonClick() { analytics.trackEvent(\u0026#39;button_click\u0026#39;, { buttonId: \u0026#39;main_button\u0026#39;, location: \u0026#39;homepage\u0026#39; }) } }) æ€»ç»“ å°ç¨‹åºå¼€å‘éœ€è¦å…³æ³¨å¤šä¸ªæ ¸å¿ƒæ–¹é¢ï¼š\næŠ€æœ¯è¦ç‚¹ï¼š\nåˆç†çš„æ¶æ„è®¾è®¡å’Œç»„ä»¶åŒ–å¼€å‘ æ€§èƒ½ä¼˜åŒ–å’Œä»£ç åŒ…ç®¡ç† ç”¨æˆ·ä½“éªŒå’Œäº¤äº’è®¾è®¡ é”™è¯¯å¤„ç†å’Œå¼‚å¸¸æ•è· å•†ä¸šåŒ–ç­–ç•¥ï¼š\næ”¯ä»˜åŠŸèƒ½é›†æˆ ä¼šå‘˜ä½“ç³»è®¾è®¡ æ•°æ®åˆ†æå’Œç”¨æˆ·è¿½è¸ª å¢é•¿ç­–ç•¥å®æ–½ æœ€ä½³å®è·µï¼š\néµå¾ªå¹³å°è§„èŒƒ æ³¨é‡æ€§èƒ½ä¼˜åŒ– ä¿è¯ç”¨æˆ·ä½“éªŒ æŒç»­æ•°æ®ç›‘æ§ æŒæ¡è¿™äº›æŠ€å·§å°†å¸®åŠ©ä½ æ„å»ºå‡ºé«˜è´¨é‡çš„å°ç¨‹åºåº”ç”¨ï¼Œåœ¨ç«äº‰æ¿€çƒˆçš„å¸‚åœºä¸­è„±é¢–è€Œå‡ºã€‚\nç›¸å…³èµ„æºï¼š\nå¾®ä¿¡å°ç¨‹åºå®˜æ–¹æ–‡æ¡£ æ”¯ä»˜å®å°ç¨‹åºå®˜æ–¹æ–‡æ¡£ Taroè·¨ç«¯æ¡†æ¶ uni-appå®˜æ–¹æ–‡æ¡£ ","permalink":"/blog/articles/mini-program-development-best-practices/","summary":"å…¨é¢æŒæ¡å°ç¨‹åºå¼€å‘çš„æ ¸å¿ƒæŠ€å·§ï¼ŒåŒ…æ‹¬æ€§èƒ½ä¼˜åŒ–ã€ç”¨æˆ·ä½“éªŒæå‡ã€è·¨å¹³å°é€‚é…ç­‰é«˜çº§å®è·µã€‚","title":"å°ç¨‹åºå¼€å‘å®Œå…¨æŒ‡å—ï¼šä»é›¶åˆ°ä¸Šçº¿çš„é«˜çº§æŠ€å·§"},{"content":"å¼•è¨€ åœ¨ç§»åŠ¨äº’è”ç½‘æ—¶ä»£ï¼Œè·¨å¹³å°å¼€å‘å·²æˆä¸ºè¶‹åŠ¿ã€‚ä¼ä¸šå¸Œæœ›ç”¨æ›´ä½çš„æˆæœ¬è¦†ç›–iOSå’ŒAndroidåŒå¹³å°ï¼Œè€ŒReact Nativeã€Flutterå’ŒUni-appä½œä¸ºä¸»æµçš„è·¨å¹³å°æ¡†æ¶ï¼Œå„æœ‰ç‰¹è‰²ã€‚æœ¬æ–‡å°†ä»æŠ€æœ¯åŸç†ã€æ€§èƒ½è¡¨ç°ã€å¼€å‘æ•ˆç‡ã€ç”Ÿæ€ç³»ç»Ÿç­‰å¤šä¸ªç»´åº¦è¿›è¡Œæ·±åº¦å¯¹æ¯”åˆ†æã€‚\nè·¨å¹³å°æ¡†æ¶æ¦‚è§ˆ React Native ç‰¹ç‚¹ï¼š\nåŸºäºJavaScript/TypeScript ä½¿ç”¨åŸç”Ÿç»„ä»¶æ¸²æŸ“ Facebookç»´æŠ¤ï¼Œç”Ÿæ€æˆç†Ÿ çƒ­æ›´æ–°æ”¯æŒ æ¶æ„åŸç†ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 // React Native æ¶æ„ç¤ºæ„ JavaScript Bridge â†’ Native Modules â†’ Native UI Components // ä»£ç ç¤ºä¾‹ import React, { useState } from \u0026#39;react\u0026#39; import { View, Text, TouchableOpacity, StyleSheet } from \u0026#39;react-native\u0026#39; const App = () =\u0026gt; { const [count, setCount] = useState(0) return ( \u0026lt;View style={styles.container}\u0026gt; \u0026lt;Text style={styles.text}\u0026gt;Count: {count}\u0026lt;/Text\u0026gt; \u0026lt;TouchableOpacity style={styles.button} onPress={() =\u0026gt; setCount(count + 1)} \u0026gt; \u0026lt;Text style={styles.buttonText}\u0026gt;Increase\u0026lt;/Text\u0026gt; \u0026lt;/TouchableOpacity\u0026gt; \u0026lt;/View\u0026gt; ) } Flutter ç‰¹ç‚¹ï¼š\nåŸºäºDartè¯­è¨€ è‡ªæ¸²æŸ“å¼•æ“ Googleæ”¯æŒï¼Œå‘å±•è¿…é€Ÿ é«˜æ€§èƒ½æµç•…ä½“éªŒ æ¶æ„åŸç†ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 // Flutter æ¶æ„ç¤ºæ„ Dart Framework â†’ Skia Engine â†’ GPU â†’ Native Platform // ä»£ç ç¤ºä¾‹ import \u0026#39;package:flutter/material.dart\u0026#39;; class MyApp extends StatefulWidget { @override _MyAppState createState() =\u0026gt; _MyAppState(); } class _MyAppState extends State\u0026lt;MyApp\u0026gt; { int count = 0; @override Widget build(BuildContext context) { return MaterialApp( home: Scaffold( body: Center( child: Column( mainAxisAlignment: MainAxisAlignment.center, children: [ Text(\u0026#39;Count: $count\u0026#39;), ElevatedButton( onPressed: () =\u0026gt; setState(() =\u0026gt; count++), child: Text(\u0026#39;Increase\u0026#39;), ), ], ), ), ), ); } } Uni-app ç‰¹ç‚¹ï¼š\nåŸºäºVue.jsè¯­æ³• ä¸€å¥—ä»£ç å¤šç«¯å‘å¸ƒ å›½å†…ç”Ÿæ€å®Œå–„ å¼€å‘é—¨æ§›ä½ æ¶æ„åŸç†ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 \u0026lt;!-- Uni-app ä»£ç ç¤ºä¾‹ --\u0026gt; \u0026lt;template\u0026gt; \u0026lt;view class=\u0026#34;container\u0026#34;\u0026gt; \u0026lt;text class=\u0026#34;count\u0026#34;\u0026gt;Count: {{ count }}\u0026lt;/text\u0026gt; \u0026lt;button @click=\u0026#34;increaseCount\u0026#34;\u0026gt;Increase\u0026lt;/button\u0026gt; \u0026lt;/view\u0026gt; \u0026lt;/template\u0026gt; \u0026lt;script\u0026gt; export default { data() { return { count: 0 } }, methods: { increaseCount() { this.count++ } } } \u0026lt;/script\u0026gt; æ€§èƒ½å¯¹æ¯”åˆ†æ å¯åŠ¨æ€§èƒ½ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 // å„æ¡†æ¶å¯åŠ¨æ—¶é—´æµ‹è¯•ï¼ˆæ¯«ç§’ï¼‰ // React Native const RNStartupTime = { Debug: 2000, Release: 800 } // Flutter const FlutterStartupTime = { Debug: 1500, Release: 400 } // Uni-app const UniAppStartupTime = { Debug: 2500, Release: 1000 } è¿è¡Œæ—¶æ€§èƒ½ å¸§ç‡è¡¨ç° 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 // å¸§ç‡æµ‹è¯•ä»£ç ç¤ºä¾‹ class PerformanceMonitor { constructor() { this.frameCount = 0 this.startTime = Date.now() } measureFPS() { this.frameCount++ const currentTime = Date.now() const elapsed = currentTime - this.startTime if (elapsed \u0026gt;= 1000) { const fps = Math.round((this.frameCount * 1000) / elapsed) console.log(`FPS: ${fps}`) this.frameCount = 0 this.startTime = currentTime } } } æµ‹è¯•ç»“æœå¯¹æ¯”ï¼š\næ¡†æ¶ ç®€å•åŠ¨ç”»FPS å¤æ‚åŠ¨ç”»FPS å†…å­˜å ç”¨ Flutter 60 58 45MB React Native 60 52 55MB Uni-app 55 48 60MB åŒ…ä½“ç§¯å¯¹æ¯” 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 // ç©ºé¡¹ç›®åŒ…ä½“ç§¯ï¼ˆMBï¼‰ const PackageSize = { \u0026#39;React Native\u0026#39;: { iOS: 8.5, Android: 7.2 }, \u0026#39;Flutter\u0026#39;: { iOS: 12.3, Android: 10.8 }, \u0026#39;Uni-app\u0026#39;: { iOS: 6.8, Android: 5.5 } } å¼€å‘æ•ˆç‡å¯¹æ¯” å¼€å‘ç¯å¢ƒé…ç½® React Native 1 2 3 4 5 6 7 8 9 10 11 # ç¯å¢ƒé…ç½® npm install -g react-native-cli npx react-native init MyApp cd MyApp # iOSä¾èµ– cd ios \u0026amp;\u0026amp; pod install # è¿è¡Œé¡¹ç›® npx react-native run-ios # iOS npx react-native run-android # Android Flutter 1 2 3 4 5 6 7 8 9 # ç¯å¢ƒé…ç½® # ä¸‹è½½Flutter SDKï¼Œé…ç½®ç¯å¢ƒå˜é‡ # åˆ›å»ºé¡¹ç›® flutter create my_app cd my_app # è¿è¡Œé¡¹ç›® flutter run # è‡ªåŠ¨æ£€æµ‹è®¾å¤‡ Uni-app 1 2 3 4 5 6 7 # å®‰è£…HBuilderX # æˆ–é€šè¿‡CLI npm install -g @dcloudio/uvm uvm install latest # åˆ›å»ºé¡¹ç›® vue create -p dcloudio/uni-preset-vue my-project å¼€å‘å·¥å…·å¯¹æ¯” ç‰¹æ€§ React Native Flutter Uni-app IDE VSCodeã€WebStorm Android Studioã€VSCode HBuilderXã€VSCode è°ƒè¯• Reactotronã€Flipper Flutter Inspector å†…ç½®è°ƒè¯•å·¥å…· çƒ­æ›´æ–° æ”¯æŒ æ”¯æŒ æ”¯æŒ å®æ—¶é¢„è§ˆ æ”¯æŒ æ”¯æŒ æ”¯æŒ ä»£ç å¤æ‚åº¦å¯¹æ¯” åˆ—è¡¨æ¸²æŸ“å®ç° React Native:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 import { FlatList } from \u0026#39;react-native\u0026#39; const MyList = ({ data }) =\u0026gt; { const renderItem = ({ item }) =\u0026gt; ( \u0026lt;View style={styles.item}\u0026gt; \u0026lt;Text\u0026gt;{item.title}\u0026lt;/Text\u0026gt; \u0026lt;/View\u0026gt; ) return ( \u0026lt;FlatList data={data} renderItem={renderItem} keyExtractor={item =\u0026gt; item.id} ItemSeparatorComponent={() =\u0026gt; \u0026lt;View style={styles.separator} /\u0026gt;} /\u0026gt; ) } Flutter:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 class MyList extends StatelessWidget { final List\u0026lt;Item\u0026gt; data; MyList({required this.data}); @override Widget build(BuildContext context) { return ListView.builder( itemCount: data.length, itemBuilder: (context, index) { return Column( children: [ ListTile(title: Text(data[index].title)), Divider(), ], ); }, ); } } Uni-app:\n1 2 3 4 5 6 7 \u0026lt;template\u0026gt; \u0026lt;scroll-view\u0026gt; \u0026lt;view v-for=\u0026#34;item in data\u0026#34; :key=\u0026#34;item.id\u0026#34; class=\u0026#34;item\u0026#34;\u0026gt; \u0026lt;text\u0026gt;{{ item.title }}\u0026lt;/text\u0026gt; \u0026lt;/view\u0026gt; \u0026lt;/scroll-view\u0026gt; \u0026lt;/template\u0026gt; ç”Ÿæ€ç³»ç»Ÿåˆ†æ ç¤¾åŒºæ”¯æŒ GitHubæ•°æ®ï¼ˆæˆªè‡³2024å¹´ï¼‰ æ¡†æ¶ Stars Forks Issues Contributors React Native 118k 23.5k 2.1k 2.8k Flutter 162k 25.3k 4.2k 3.1k Uni-app 39.2k 7.8k 526 189 ç¬¬ä¸‰æ–¹åº“æ”¯æŒ React Nativeç”Ÿæ€åº“ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 // UIç»„ä»¶åº“ npm install @react-navigation/native npm install react-native-elements npm install @react-native-community/async-storage // çŠ¶æ€ç®¡ç† npm install @reduxjs/toolkit npm install react-redux // ç½‘ç»œè¯·æ±‚ npm install axios npm install @apollo/client Flutterç”Ÿæ€åº“ï¼š\n1 2 3 4 5 6 # pubspec.yaml dependencies: flutter_bloc: ^8.1.3 # çŠ¶æ€ç®¡ç† dio: ^5.3.2 # ç½‘ç»œè¯·æ±‚ get: ^4.6.6 # è·¯ç”±å’ŒçŠ¶æ€ç®¡ç† shared_preferences: ^2.2.2 # æœ¬åœ°å­˜å‚¨ Uni-appæ’ä»¶å¸‚åœºï¼š\n1 2 3 4 5 6 7 // manifest.json { \u0026#34;plugins\u0026#34;: { \u0026#34;uni-pay\u0026#34;: {}, // æ”¯ä»˜ \u0026#34;uni-push\u0026#34;: {} // æ¨é€ } } å®æˆ˜æ¡ˆä¾‹åˆ†æ æ¡ˆä¾‹ä¸€ï¼šç”µå•†åº”ç”¨ React Nativeå®ç° 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 // å•†å“åˆ—è¡¨ç»„ä»¶ const ProductList = () =\u0026gt; { const [products, setProducts] = useState([]) const [loading, setLoading] = useState(false) useEffect(() =\u0026gt; { loadProducts() }, []) const loadProducts = async () =\u0026gt; { setLoading(true) try { const response = await api.get(\u0026#39;/products\u0026#39;) setProducts(response.data) } catch (error) { console.error(\u0026#39;åŠ è½½å¤±è´¥:\u0026#39;, error) } finally { setLoading(false) } } return ( \u0026lt;View style={styles.container}\u0026gt; \u0026lt;FlatList data={products} numColumns={2} renderItem={({ item }) =\u0026gt; ( \u0026lt;ProductCard product={item} /\u0026gt; )} onRefresh={loadProducts} refreshing={loading} /\u0026gt; \u0026lt;/View\u0026gt; ) } Flutterå®ç° 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 class ProductList extends StatefulWidget { @override _ProductListState createState() =\u0026gt; _ProductListState(); } class _ProductListState extends State\u0026lt;ProductList\u0026gt; { List\u0026lt;Product\u0026gt; products = []; bool isLoading = false; @override void initState() { super.initState(); loadProducts(); } Future\u0026lt;void\u0026gt; loadProducts() async { setState(() =\u0026gt; isLoading = true); try { final response = await ApiService.getProducts(); setState(() =\u0026gt; products = response); } catch (e) { print(\u0026#39;åŠ è½½å¤±è´¥: $e\u0026#39;); } finally { setState(() =\u0026gt; isLoading = false); } } @override Widget build(BuildContext context) { return Scaffold( body: RefreshIndicator( onRefresh: loadProducts, child: GridView.builder( gridDelegate: SliverGridDelegateWithFixedCrossAxisCount( crossAxisCount: 2, ), itemCount: products.length, itemBuilder: (context, index) { return ProductCard(product: products[index]); }, ), ), ); } } æ¡ˆä¾‹äºŒï¼šç›´æ’­åº”ç”¨ é«˜æ€§èƒ½è§†é¢‘å¤„ç† 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 // React Nativeé›†æˆåŸç”Ÿæ¨¡å— import { NativeModules } from \u0026#39;react-native\u0026#39; const { VideoPlayer } = NativeModules class LivePlayer extends Component { startStreaming = async () =\u0026gt; { try { await VideoPlayer.startStream({ url: this.state.rtmpUrl, resolution: \u0026#39;720p\u0026#39;, fps: 30, bitrate: 2000 }) } catch (error) { Alert.alert(\u0026#39;é”™è¯¯\u0026#39;, \u0026#39;æ¨æµå¤±è´¥\u0026#39;) } } } 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 // Flutterä½¿ç”¨MethodChannel class LivePlayer extends StatefulWidget { @override _LivePlayerState createState() =\u0026gt; _LivePlayerState(); } class _LivePlayerState extends State\u0026lt;LivePlayer\u0026gt; { static const platform = MethodChannel(\u0026#39;live_stream\u0026#39;); Future\u0026lt;void\u0026gt; startStreaming() async { try { await platform.invokeMethod(\u0026#39;startStream\u0026#39;, { \u0026#39;url\u0026#39;: rtmpUrl, \u0026#39;resolution\u0026#39;: \u0026#39;720p\u0026#39;, \u0026#39;fps\u0026#39;: 30, \u0026#39;bitrate\u0026#39;: 2000, }); } on PlatformException catch (e) { ScaffoldMessenger.of(context).showSnackBar( SnackBar(content: Text(\u0026#39;æ¨æµå¤±è´¥: ${e.message}\u0026#39;)), ); } } } é€‰å‹å»ºè®® React Nativeé€‚åˆåœºæ™¯ âœ… æ¨èä½¿ç”¨ï¼š\nå›¢é˜Ÿç†Ÿæ‚‰React/JavaScript éœ€è¦çƒ­æ›´æ–°åŠŸèƒ½ å¤§é‡ç¬¬ä¸‰æ–¹åº“ä¾èµ– Webå’Œç§»åŠ¨ç«¯æŠ€æœ¯æ ˆç»Ÿä¸€ âŒ ä¸æ¨èï¼š\né«˜æ€§èƒ½æ¸¸æˆåº”ç”¨ å¤§é‡åŠ¨ç”»æ•ˆæœ å¯¹åŒ…ä½“ç§¯è¦æ±‚æå…¶ä¸¥æ ¼ Flutteré€‚åˆåœºæ™¯ âœ… æ¨èä½¿ç”¨ï¼š\nè¿½æ±‚æè‡´æ€§èƒ½ å¤æ‚UIå’ŒåŠ¨ç”» å•ä¸€ä»£ç åº“ç»´æŠ¤ Googleç”Ÿæ€é›†æˆ âŒ ä¸æ¨èï¼š\nå›¢é˜ŸDartç»éªŒä¸è¶³ éœ€è¦é¢‘ç¹çƒ­æ›´æ–° å¯¹åŒ…å¤§å°è¦æ±‚ä¸¥æ ¼ Uni-appé€‚åˆåœºæ™¯ âœ… æ¨èä½¿ç”¨ï¼š\nå¿«é€ŸåŸå‹å¼€å‘ å¤šç«¯å‘å¸ƒéœ€æ±‚ å°ç¨‹åºä¼˜å…ˆ å›½å†…å¸‚åœºä¸ºä¸» âŒ ä¸æ¨èï¼š\nå¤æ‚åŠ¨ç”»éœ€æ±‚ æµ·å¤–å‘å¸ƒè®¡åˆ’ é«˜æ€§èƒ½è¦æ±‚åº”ç”¨ æŠ€æœ¯é€‰å‹å†³ç­–æ ‘ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 function selectFramework(requirements) { if (requirements.multiPlatform \u0026amp;\u0026amp; requirements.includeMiniProgram) { return \u0026#39;Uni-app\u0026#39; } if (requirements.performance === \u0026#39;high\u0026#39; \u0026amp;\u0026amp; requirements.teamDart) { return \u0026#39;Flutter\u0026#39; } if (requirements.hotUpdate \u0026amp;\u0026amp; requirements.ecosystem) { return \u0026#39;React Native\u0026#39; } if (requirements.teamJS \u0026amp;\u0026amp; requirements.quickStart) { return \u0026#39;React Native\u0026#39; } return \u0026#39;Flutter\u0026#39; // é»˜è®¤æ¨è } æœ€ä½³å®è·µå»ºè®® å¼€å‘è§„èŒƒ ä»£ç ç»„ç»‡ 1 2 3 4 5 6 7 8 9 // React Nativeé¡¹ç›®ç»“æ„ src/ â”œâ”€â”€ components/ # å…¬å…±ç»„ä»¶ â”œâ”€â”€ screens/ # é¡µé¢ç»„ä»¶ â”œâ”€â”€ navigation/ # å¯¼èˆªé…ç½® â”œâ”€â”€ services/ # APIæœåŠ¡ â”œâ”€â”€ utils/ # å·¥å…·å‡½æ•° â”œâ”€â”€ store/ # çŠ¶æ€ç®¡ç† â””â”€â”€ assets/ # é™æ€èµ„æº æ€§èƒ½ä¼˜åŒ– 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 // React Nativeæ€§èƒ½ä¼˜åŒ– const OptimizedList = ({ data }) =\u0026gt; { // ä½¿ç”¨memoé¿å…ä¸å¿…è¦çš„é‡æ¸²æŸ“ const renderItem = React.useCallback( ({ item }) =\u0026gt; \u0026lt;ItemComponent data={item} /\u0026gt;, [] ) // ä½¿ç”¨FlatListçš„ä¼˜åŒ–å±æ€§ return ( \u0026lt;FlatList data={data} renderItem={renderItem} keyExtractor={useCallback(item =\u0026gt; item.id, [])} getItemLayout={useCallback( (data, index) =\u0026gt; ({ length: ITEM_HEIGHT, offset: ITEM_HEIGHT * index, index, }), [] )} removeClippedSubviews={true} maxToRenderPerBatch={10} windowSize={10} /\u0026gt; ) } è·¨å¹³å°å…¼å®¹æ€§å¤„ç† 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 // å¹³å°ç‰¹å®šä»£ç  import { Platform, StyleSheet } from \u0026#39;react-native\u0026#39; const styles = StyleSheet.create({ container: { padding: Platform.OS === \u0026#39;ios\u0026#39; ? 20 : 16, // iOSå’ŒAndroidä¸åŒçš„å¤„ç† shadowColor: Platform.OS === \u0026#39;ios\u0026#39; ? \u0026#39;#000\u0026#39; : \u0026#39;transparent\u0026#39;, shadowOpacity: Platform.OS === \u0026#39;ios\u0026#39; ? 0.2 : 0, } }) // æ¡ä»¶æ¸²æŸ“ const PlatformSpecificComponent = () =\u0026gt; { if (Platform.OS === \u0026#39;ios\u0026#39;) { return \u0026lt;iOSComponent /\u0026gt; } return \u0026lt;AndroidComponent /\u0026gt; } æ€»ç»“ è·¨å¹³å°ç§»åŠ¨å¼€å‘æ¡†æ¶å„æœ‰ä¼˜åŠ£ï¼š\nReact Nativeï¼šç”Ÿæ€æˆç†Ÿï¼Œå¼€å‘æ•ˆç‡é«˜ï¼Œé€‚åˆå¿«é€Ÿå¼€å‘å’ŒWebæŠ€æœ¯æ ˆå›¢é˜Ÿã€‚\nFlutterï¼šæ€§èƒ½å‡ºè‰²ï¼ŒUIä¸€è‡´æ€§å¥½ï¼Œé€‚åˆè¿½æ±‚æè‡´ä½“éªŒçš„åº”ç”¨ã€‚\nUni-appï¼šå¤šç«¯èƒ½åŠ›å¼ºï¼Œå­¦ä¹ æˆæœ¬ä½ï¼Œé€‚åˆå°ç¨‹åºå’Œå›½å†…å¸‚åœºé¡¹ç›®ã€‚\né€‰æ‹©æ¡†æ¶æ—¶ï¼Œéœ€è¦è€ƒè™‘å›¢é˜ŸæŠ€æœ¯æ ˆã€é¡¹ç›®éœ€æ±‚ã€æ€§èƒ½è¦æ±‚ç­‰å¤šä¸ªå› ç´ ã€‚å»ºè®®åœ¨é¡¹ç›®åˆæœŸè¿›è¡ŒæŠ€æœ¯éªŒè¯ï¼Œé€‰æ‹©æœ€é€‚åˆçš„è§£å†³æ–¹æ¡ˆã€‚\nç›¸å…³èµ„æºï¼š\nReact Nativeå®˜æ–¹æ–‡æ¡£ Flutterå®˜æ–¹æ–‡æ¡£ Uni-appå®˜æ–¹æ–‡æ¡£ è·¨å¹³å°æ¡†æ¶æ€§èƒ½å¯¹æ¯”æµ‹è¯• ","permalink":"/blog/articles/cross-platform-mobile-app-development/","summary":"æ·±å…¥åˆ†æä¸‰å¤§è·¨å¹³å°ç§»åŠ¨å¼€å‘æ¡†æ¶çš„ä¼˜ç¼ºç‚¹ï¼Œå¸®åŠ©å¼€å‘è€…é€‰æ‹©æœ€é€‚åˆçš„æŠ€æœ¯æ ˆã€‚","title":"è·¨å¹³å°ç§»åŠ¨åº”ç”¨å¼€å‘ï¼šReact Native vs Flutter vs Uni-app æ·±åº¦å¯¹æ¯”"},{"content":"åœ¨å…¨çƒæ¸¸æˆå¸‚åœºç«äº‰æ—¥ç›Šæ¿€çƒˆçš„ä»Šå¤©ï¼ŒæˆåŠŸçš„å‘è¡Œç­–ç•¥å¯¹äºæ¸¸æˆäº§å“çš„æˆåŠŸè‡³å…³é‡è¦ã€‚æœ¬æ–‡å°†è¯¦ç»†ä»‹ç»ä»æ¸¸æˆç«‹é¡¹åˆ°å…¨çƒå‘è¡Œçš„å®Œæ•´ç­–ç•¥ä½“ç³»ï¼Œå¸®åŠ©å¼€å‘è€…å’Œå‘è¡Œå•†åœ¨æµ·å¤–å¸‚åœºå–å¾—æˆåŠŸã€‚\nä¸€ã€å…¨çƒå¸‚åœºåˆ†æä¸é€‰æ‹© 1.1 å¸‚åœºè§„æ¨¡ä¸æ½œåŠ›è¯„ä¼° åŒ—ç¾å¸‚åœºç‰¹å¾\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 // åŒ—ç¾å¸‚åœºæ•°æ®æ¨¡å‹ const northAmericaMarket = { å¸‚åœºè§„æ¨¡: { mobile: \u0026#34;42äº¿ç¾å…ƒå¹´è¥æ”¶\u0026#34;, console: \u0026#34;38äº¿ç¾å…ƒå¹´è¥æ”¶\u0026#34;, PC: \u0026#34;28äº¿ç¾å…ƒå¹´è¥æ”¶\u0026#34; }, userBehavior: { arppu: 35.8, // å¹³å‡ä»˜è´¹ç”¨æˆ·æ”¶å…¥ retentionRate: 0.32, // æ¬¡æ—¥ç•™å­˜ç‡ ltv: 45.6 // ç”Ÿå‘½å‘¨æœŸä»·å€¼ }, platformDistribution: { iOS: 0.48, Android: 0.35, PC: 0.12, Console: 0.05 }, competitiveLandscape: { topGenres: [\u0026#34;ç­–ç•¥\u0026#34;, \u0026#34;RPG\u0026#34;, \u0026#34;ä¼‘é—²\u0026#34;, \u0026#34;ä½“è‚²\u0026#34;], barriers: \u0026#34;é«˜ç ”å‘æˆæœ¬ï¼Œå¼ºIPä¾èµ–\u0026#34;, opportunities: \u0026#34;åˆ›æ–°ç©æ³•ï¼Œç»†åˆ†å¸‚åœº\u0026#34; } }; æ¬§æ´²å¸‚åœºæ ¼å±€\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 // æ¬§æ´²åˆ†åŒºåŸŸå¸‚åœºåˆ†æ const europeanMarketAnalysis = { westernEurope: { // è‹±å›½ã€å¾·å›½ã€æ³•å›½ã€è·å…° marketSize: \u0026#34;â‚¬85äº¿\u0026#34;, characteristics: { purchasingPower: \u0026#34;é«˜ARPPU\u0026#34;, gamePreferences: \u0026#34;ç­–ç•¥ã€è§£è°œã€ç«é€Ÿ\u0026#34;, platformUsage: \u0026#34;PCå’Œä¸»æœºå ä¸»å¯¼\u0026#34; }, regulations: { gDPR: \u0026#34;ä¸¥æ ¼çš„æ•°æ®ä¿æŠ¤\u0026#34;, lootBoxLaws: \u0026#34;éƒ¨åˆ†å›½å®¶é™åˆ¶\u0026#34;, ageRating: \u0026#34;PEGIç³»ç»Ÿ\u0026#34; } }, easternEurope: { // æ³¢å…°ã€ä¿„ç½—æ–¯ã€ä¹Œå…‹å…° marketSize: \u0026#34;â‚¬28äº¿\u0026#34;, characteristics: { priceSensitivity: \u0026#34;ä¸­é«˜\u0026#34;, gamePreferences: \u0026#34;FPSã€MOBAã€ç­–ç•¥\u0026#34;, platformUsage: \u0026#34;PCæ¸¸æˆæ–‡åŒ–æµ“åš\u0026#34; }, challenges: { paymentSystems: \u0026#34;æœ¬åœ°åŒ–æ”¯ä»˜éœ€æ±‚\u0026#34;, infrastructure: \u0026#34;ç½‘ç»œæ¡ä»¶å·®å¼‚\u0026#34;, competition: \u0026#34;ä½ä»·æ ¼ç«äº‰æ¿€çƒˆ\u0026#34; } } }; äºšæ´²å¸‚åœºæœºä¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 // äºšæ´²é‡ç‚¹å¸‚åœºåˆ†æ const asianMarketOpportunities = { japan: { marketSize: \u0026#34;Â¥1.8ä¸‡äº¿\u0026#34;, uniqueFeatures: { consoleDominance: 0.65, // ä¸»æœºæ¸¸æˆå æ¯” gachaMonetization: \u0026#34;æŠ½å¡æ¨¡å¼æˆç†Ÿ\u0026#34;, ipLicensing: \u0026#34;å¼ºIPæ–‡åŒ–å½±å“\u0026#34; }, entryStrategy: { localization: \u0026#34;æ·±åº¦æ–‡åŒ–é€‚åº”\u0026#34;, partnerships: \u0026#34;æœ¬åœ°å‘è¡Œå•†åˆä½œ\u0026#34;, compliance: \u0026#34;ä¸¥æ ¼å†…å®¹å®¡æŸ¥\u0026#34; } }, korea: { marketSize: \u0026#34;â‚©8.5ä¸‡äº¿\u0026#34;, marketCharacteristics: { pcBangCulture: \u0026#34;ç½‘å§ç”µç«æ–‡åŒ–\u0026#34;, competitiveGaming: \u0026#34;å¼ºç”µç«ç”Ÿæ€\u0026#34;, mobileFirst: \u0026#34;æ‰‹æ¸¸ä¸»å¯¼è¶‹åŠ¿\u0026#34; }, successFactors: { communityBuilding: \u0026#34;å¼ºç¤¾åŒºè¿è¥\u0026#34;, esportsIntegration: \u0026#34;ç”µç«èµ›äº‹åˆä½œ\u0026#34;, kolsMarketing: \u0026#34;ç½‘çº¢ç›´æ’­æ¨å¹¿\u0026#34; } }, southeastAsia: { marketSize: \u0026#34;$45äº¿\u0026#34;, growthPotential: { cagr: \u0026#34;12.5%\u0026#34;, smartphonePenetration: \u0026#34;å¿«é€Ÿå¢é•¿\u0026#34;, demographic: \u0026#34;å¹´è½»åŒ–ç”¨æˆ·ç¾¤\u0026#34; }, localizationNeeds: { languageSupport: \u0026#34;å¤šè¯­è¨€è¦†ç›–\u0026#34;, deviceOptimization: \u0026#34;ä¸­ä½ç«¯è®¾å¤‡é€‚é…\u0026#34;, paymentMethods: \u0026#34;æœ¬åœ°æ”¯ä»˜æ¸ é“\u0026#34; } } }; 1.2 å¸‚åœºè¿›å…¥ç­–ç•¥åˆ¶å®š é˜¶æ®µæ€§å¸‚åœºè¿›å…¥æ¨¡å‹\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 # å¸‚åœºè¿›å…¥ç­–ç•¥åˆ†æç³»ç»Ÿ class MarketEntryAnalyzer: def __init__(self): self.market_maturity_levels = { \u0026#39;emerging\u0026#39;: { \u0026#39;characteristics\u0026#39;: [\u0026#39;ç«äº‰è¾ƒå°‘\u0026#39;, \u0026#39;ç”¨æˆ·å¢é•¿å¿«\u0026#39;, \u0026#39;åŸºç¡€è®¾æ–½å¾…å®Œå–„\u0026#39;], \u0026#39;strategy\u0026#39;: \u0026#39;å…ˆè¡Œè€…ä¼˜åŠ¿\u0026#39;, \u0026#39;risk_level\u0026#39;: \u0026#39;high\u0026#39;, \u0026#39;investment_priority\u0026#39;: \u0026#39;ç”¨æˆ·æ•™è‚²\u0026#39; }, \u0026#39;growing\u0026#39;: { \u0026#39;characteristics\u0026#39;: [\u0026#39;ç«äº‰åŠ å‰§\u0026#39;, \u0026#39;å¸‚åœºè§„èŒƒ\u0026#39;, \u0026#39;ç”¨æˆ·æˆç†Ÿ\u0026#39;], \u0026#39;strategy\u0026#39;: \u0026#39;å·®å¼‚åŒ–ç«äº‰\u0026#39;, \u0026#39;risk_level\u0026#39;: \u0026#39;medium\u0026#39;, \u0026#39;investment_priority\u0026#39;: \u0026#39;å“ç‰Œå»ºè®¾\u0026#39; }, \u0026#39;mature\u0026#39;: { \u0026#39;characteristics\u0026#39;: [\u0026#39;ç«äº‰æ¿€çƒˆ\u0026#39;, \u0026#39;æ ¼å±€ç¨³å®š\u0026#39;, \u0026#39;åˆ›æ–°é©±åŠ¨\u0026#39;], \u0026#39;strategy\u0026#39;: \u0026#39;ç»†åˆ†å¸‚åœºçªç ´\u0026#39;, \u0026#39;risk_level\u0026#39;: \u0026#39;low\u0026#39;, \u0026#39;investment_priority\u0026#39;: \u0026#39;äº§å“åˆ›æ–°\u0026#39; } } def analyze_entry_timing(self, market_data): \u0026#34;\u0026#34;\u0026#34; åˆ†æå¸‚åœºè¿›å…¥æ—¶æœº \u0026#34;\u0026#34;\u0026#34; growth_rate = market_data[\u0026#39;growth_rate\u0026#39;] competition_level = market_data[\u0026#39;competition_index\u0026#39;] market_size = market_data[\u0026#39;total_market_size\u0026#39;] if growth_rate \u0026gt; 0.15 and competition_level \u0026lt; 0.4: return { \u0026#39;timing\u0026#39;: \u0026#39;early_entrance\u0026#39;, \u0026#39;advantages\u0026#39;: [\u0026#39;ä½ç«äº‰\u0026#39;, \u0026#39;é«˜å¢é•¿\u0026#39;, \u0026#39;å®šä»·æƒ\u0026#39;], \u0026#39;risks\u0026#39;: [\u0026#39;å¸‚åœºä¸ç¡®å®š\u0026#39;, \u0026#39;æ•™è‚²æˆæœ¬é«˜\u0026#39;], \u0026#39;recommendation\u0026#39;: \u0026#39;å¿«é€Ÿè¿›å…¥ï¼ŒæŠ¢å å¸‚åœºä»½é¢\u0026#39; } elif growth_rate \u0026gt; 0.08 and competition_level \u0026lt; 0.7: return { \u0026#39;timing\u0026#39;: \u0026#39;growth_phase\u0026#39;, \u0026#39;advantages\u0026#39;: [\u0026#39;å¸‚åœºéªŒè¯\u0026#39;, \u0026#39;ç”¨æˆ·è®¤çŸ¥\u0026#39;], \u0026#39;risks\u0026#39;: [\u0026#39;ç«äº‰åŠ å‰§\u0026#39;, \u0026#39;æˆæœ¬ä¸Šå‡\u0026#39;], \u0026#39;recommendation\u0026#39;: \u0026#39;å·®å¼‚åŒ–äº§å“ï¼Œç²¾å‡†è¥é”€\u0026#39; } else: return { \u0026#39;timing\u0026#39;: \u0026#39;mature_market\u0026#39;, \u0026#39;advantages\u0026#39;: [\u0026#39;å¸‚åœºç¨³å®š\u0026#39;, \u0026#39;ç”¨æˆ·æˆç†Ÿ\u0026#39;], \u0026#39;risks\u0026#39;: [\u0026#39;çº¢æµ·ç«äº‰\u0026#39;, \u0026#39;åˆ©æ¶¦å‹ç¼©\u0026#39;], \u0026#39;recommendation\u0026#39;: \u0026#39;ç»†åˆ†å¸‚åœºï¼Œç²¾å“ç­–ç•¥\u0026#39; } def calculate_market_potential(self, market_metrics): \u0026#34;\u0026#34;\u0026#34; è®¡ç®—å¸‚åœºæ½œåŠ›æŒ‡æ•° \u0026#34;\u0026#34;\u0026#34; size_weight = 0.3 growth_weight = 0.25 profit_weight = 0.25 competitive_weight = 0.2 normalized_size = self.normalize_value(market_metrics[\u0026#39;size\u0026#39;], 0, 100) normalized_growth = self.normalize_value(market_metrics[\u0026#39;growth_rate\u0026#39;], 0, 0.3) normalized_profit = self.normalize_value(market_metrics[\u0026#39;profit_margin\u0026#39;], 0, 0.5) normalized_competition = 1 - self.normalize_value(market_metrics[\u0026#39;competition\u0026#39;], 0, 1) potential_index = ( normalized_size * size_weight + normalized_growth * growth_weight + normalized_profit * profit_weight + normalized_competition * competitive_weight ) return { \u0026#39;potential_score\u0026#39;: potential_index, \u0026#39;market_level\u0026#39;: self.classify_market_level(potential_index), \u0026#39;investment_priority\u0026#39;: self.suggest_investment_priority(potential_index) } æ¸ é“ç­–ç•¥é€‰æ‹©æ¡†æ¶\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 // å‘è¡Œæ¸ é“ç­–ç•¥ç³»ç»Ÿ const distributionStrategy = { // ç›´æ¥å‘è¡Œç­–ç•¥ directDistribution: { platforms: [\u0026#34;App Store\u0026#34;, \u0026#34;Google Play\u0026#34;, \u0026#34;Steam\u0026#34;, \u0026#34;Epic Games\u0026#34;], advantages: [ \u0026#34;ç›´æ¥ç”¨æˆ·å…³ç³»\u0026#34;, \u0026#34;å®Œæ•´çš„æ”¶å…¥è·å–\u0026#34;, \u0026#34;å“ç‰Œæ§åˆ¶æƒ\u0026#34;, \u0026#34;ç”¨æˆ·æ•°æ®æŒæ¡\u0026#34; ], challenges: [ \u0026#34;é«˜è¥é”€æˆæœ¬\u0026#34;, \u0026#34;æ¸ é“å»ºç«‹éš¾åº¦\u0026#34;, \u0026#34;å®¢æœæ”¯æŒè´Ÿæ‹…\u0026#34;, \u0026#34;æœ¬åœ°åŒ–å¤æ‚åº¦\u0026#34; ], suitableFor: [ \u0026#34;æœ‰æˆç†Ÿå‘è¡Œç»éªŒ\u0026#34;, \u0026#34;èµ„é‡‘å……è¶³\u0026#34;, \u0026#34;å…¨çƒåŒ–èƒ½åŠ›\u0026#34; ] }, // åˆä½œå‘è¡Œç­–ç•¥ partnershipDistribution: { partnerTypes: [ \u0026#34;å…¨çƒå‘è¡Œå•†\u0026#34;, \u0026#34;åŒºåŸŸå‘è¡Œå•†\u0026#34;, \u0026#34;å¹³å°å‘è¡Œå•†\u0026#34;, \u0026#34;IPåˆä½œæ–¹\u0026#34; ], advantages: [ \u0026#34;ç°æˆæ¸ é“ç½‘ç»œ\u0026#34;, \u0026#34;æœ¬åœ°åŒ–ä¸“ä¸šèƒ½åŠ›\u0026#34;, \u0026#34;é£é™©å…±æ‹…\u0026#34;, \u0026#34;å¿«é€Ÿå¸‚åœºè¿›å…¥\u0026#34; ], considerations: [ \u0026#34;æ”¶å…¥åˆ†æˆæ¯”ä¾‹\u0026#34;, \u0026#34;æ§åˆ¶æƒè®©æ¸¡\u0026#34;, \u0026#34;åˆä½œä¼™ä¼´é€‰æ‹©\u0026#34;, \u0026#34;åˆåŒæ¡æ¬¾ç»†èŠ‚\u0026#34; ] }, // æ··åˆå‘è¡Œç­–ç•¥ hybridDistribution: { strategy: \u0026#34;é‡ç‚¹åŒºåŸŸç›´å‘ï¼Œå…¶ä»–åŒºåŸŸåˆä½œ\u0026#34;, implementation: { tier1_markets: \u0026#34;åŒ—ç¾ã€è¥¿æ¬§ç›´å‘\u0026#34;, tier2_markets: \u0026#34;æ—¥éŸ©ã€ä¸œå—äºšåˆä½œ\u0026#34;, emerging_markets: \u0026#34;æœ¬åœ°å‘è¡Œå•†åˆä½œ\u0026#34; }, optimization: { \u0026#34;æ ¹æ®äº§å“è¡¨ç°è°ƒæ•´ç­–ç•¥\u0026#34;, \u0026#34;é€æ­¥æ‰©å¤§ç›´å‘èŒƒå›´\u0026#34;, \u0026#34;åŸ¹å…»å†…éƒ¨å‘è¡Œèƒ½åŠ›\u0026#34; } } }; äºŒã€æ¸¸æˆæœ¬åœ°åŒ–ç­–ç•¥ 2.1 è¯­è¨€æœ¬åœ°åŒ–æœ€ä½³å®è·µ å¤šå±‚æ¬¡æœ¬åœ°åŒ–å®æ–½\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 # æ¸¸æˆæœ¬åœ°åŒ–ç®¡ç†ç³»ç»Ÿ class GameLocalizationManager: def __init__(self): self.localization_tiers = { \u0026#39;tier_1_basic\u0026#39;: { languages: [\u0026#39;è‹±è¯­\u0026#39;, \u0026#39;è¥¿ç­ç‰™è¯­\u0026#39;, \u0026#39;å¾·è¯­\u0026#39;, \u0026#39;æ³•è¯­\u0026#39;], coverage: \u0026#34;åŸºç¡€ç•Œé¢å’Œå…³é”®æ–‡æœ¬\u0026#34;, quality_standard: \u0026#34;æœºå™¨ç¿»è¯‘+äººå·¥æ ¡å¯¹\u0026#34;, budget_ratio: 0.15, timeframe: \u0026#34;2-3å‘¨\u0026#34; }, \u0026#39;tier_2_extended\u0026#39;: { languages: [\u0026#39;æ„å¤§åˆ©è¯­\u0026#39;, \u0026#39;ä¿„è¯­\u0026#39;, \u0026#39;æ—¥è¯­\u0026#39;, \u0026#39;éŸ©è¯­\u0026#39;, \u0026#39;è‘¡è„ç‰™è¯­\u0026#39;], coverage: \u0026#34;å®Œæ•´æ¸¸æˆå†…æ–‡æœ¬ï¼Œéƒ¨åˆ†é…éŸ³\u0026#34;, quality_standard: \u0026#34;ä¸“ä¸šæ¯è¯­ç¿»è¯‘\u0026#34;, budget_ratio: 0.25, timeframe: \u0026#34;4-6å‘¨\u0026#34; }, \u0026#39;tier_3_premium\u0026#39;: { languages: [\u0026#39;ä¸­æ–‡ï¼ˆç®€ç¹ä½“ï¼‰\u0026#39;, \u0026#39;é˜¿æ‹‰ä¼¯è¯­\u0026#39;, \u0026#39;å°åœ°è¯­\u0026#39;], coverage: \u0026#34;å…¨é¢æœ¬åœ°åŒ–ï¼ŒåŒ…å«æ–‡åŒ–é€‚é…\u0026#34;, quality_standard: \u0026#34;æœ¬åœ°å›¢é˜Ÿæ·±åº¦å‚ä¸\u0026#34;, budget_ratio: 0.35, timeframe: \u0026#34;8-12å‘¨\u0026#34; } } def create_localization_pipeline(self, game_content): \u0026#34;\u0026#34;\u0026#34; åˆ›å»ºæœ¬åœ°åŒ–å·¥ä½œæµ \u0026#34;\u0026#34;\u0026#34; pipeline = { \u0026#39;preparation\u0026#39;: { \u0026#39;text_extraction\u0026#39;: self.extract_all_text(game_content), \u0026#39;context_documentation\u0026#39;: self.create_translation_guide(), \u0026#39;terminology_database\u0026#39;: self.build_terminology_db() }, \u0026#39;translation\u0026#39;: { \u0026#39;machine_preprocessing\u0026#39;: self.machine_translation_prepare(), \u0026#39;human_translation\u0026#39;: self.professional_translation(), \u0026#39;cultural_adaptation\u0026#39;: self.cultural_localization_review() }, \u0026#39;implementation\u0026#39;: { \u0026#39;text_integration\u0026#39;: self.integrate_translated_text(), \u0026#39;ui_adjustment\u0026#39;: self.adjust_ui_for_languages(), \u0026#39;quality_assurance\u0026#39;: self.localization_testing() }, \u0026#39;maintenance\u0026#39;: { \u0026#39;updates_management\u0026#39;: self.handle_content_updates(), \u0026#39;community_feedback\u0026#39;: self.collect_localization_feedback(), \u0026#39;continuous_improvement\u0026#39;: self.iterative_improvement() } } return pipeline def handle_cultural_sensitivity(self, content_analysis): \u0026#34;\u0026#34;\u0026#34; æ–‡åŒ–æ•æ„Ÿåº¦å¤„ç† \u0026#34;\u0026#34;\u0026#34; cultural_considerations = { \u0026#39;religious_content\u0026#39;: { \u0026#39;risk_level\u0026#39;: \u0026#39;high\u0026#39;, \u0026#39;regions\u0026#39;: [\u0026#39;ä¸­ä¸œ\u0026#39;, \u0026#39;å°åº¦\u0026#39;, \u0026#39;ä¸œå—äºšéƒ¨åˆ†å›½å®¶\u0026#39;], \u0026#39;action\u0026#39;: \u0026#39;é¿å…æˆ–ä¿®æ”¹æ•æ„Ÿå®—æ•™ç¬¦å·å’Œå†…å®¹\u0026#39; }, \u0026#39;political_content\u0026#39;: { \u0026#39;risk_level\u0026#39;: \u0026#39;high\u0026#39;, \u0026#39;regions\u0026#39;: [\u0026#39;å…¨çƒå¤šä¸ªåœ°åŒº\u0026#39;], \u0026#39;action\u0026#39;: \u0026#39;é¿å…æ”¿æ²»ç«‹åœºè¡¨è¾¾ï¼Œä¿æŒä¸­ç«‹\u0026#39; }, \u0026#39;violence_level\u0026#39;: { \u0026#39;risk_level\u0026#39;: \u0026#39;medium\u0026#39;, \u0026#39;regions\u0026#39;: [\u0026#39;å¾·å›½\u0026#39;, \u0026#39;æ¾³å¤§åˆ©äºš\u0026#39;, \u0026#39;ä¸­å›½\u0026#39;], \u0026#39;action\u0026#39;: \u0026#39;è°ƒæ•´æš´åŠ›è¡¨ç°ï¼Œç¬¦åˆå®¡æŸ¥æ ‡å‡†\u0026#39; }, \u0026#39;social_norms\u0026#39;: { \u0026#39;risk_level\u0026#39;: \u0026#39;medium\u0026#39;, \u0026#39;regions\u0026#39;: [\u0026#39;æ—¥æœ¬\u0026#39;, \u0026#39;éŸ©å›½\u0026#39;, \u0026#39;ä¸­ä¸œ\u0026#39;], \u0026#39;action\u0026#39;: \u0026#39;å°Šé‡å½“åœ°ç¤¾ä¼šä¹ ä¿—å’Œä»·å€¼è§‚\u0026#39; } } return cultural_considerations é…éŸ³ä¸éŸ³é¢‘æœ¬åœ°åŒ–\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 # éŸ³é¢‘æœ¬åœ°åŒ–ç­–ç•¥ç³»ç»Ÿ class AudioLocalizationStrategy: def __init__(self): self.audio_requirements = { \u0026#39;voice_acting\u0026#39;: { \u0026#39;professional_level\u0026#39;: { \u0026#39;character_per_voice\u0026#39;: 3-5, \u0026#39;studio_time_per_hour\u0026#39;: 300-500, \u0026#39;direction_complexity\u0026#39;: \u0026#39;high\u0026#39; }, \u0026#39;budget_optimization\u0026#39;: { \u0026#39;reuse_voice_actors\u0026#39;: \u0026#39;æé«˜æ€§ä»·æ¯”\u0026#39;, \u0026#39;recording_efficiency\u0026#39;: \u0026#39;æ‰¹é‡å½•åˆ¶\u0026#39;, \u0026#39;remote_recording\u0026#39;: \u0026#39;é™ä½æˆæœ¬\u0026#39; } }, \u0026#39;cultural_adaptation\u0026#39;: { \u0026#39;accent_considerations\u0026#39;: \u0026#39;é€‰æ‹©åˆé€‚çš„å£éŸ³\u0026#39;, \u0026#39;emotional_tone\u0026#39;: \u0026#39;æ–‡åŒ–æƒ…æ„Ÿè¡¨è¾¾å·®å¼‚\u0026#39;, \u0026#39;naming_conventions\u0026#39;: \u0026#39;è§’è‰²åç§°æœ¬åœ°åŒ–\u0026#39; } } def calculate_audio_localization_cost(self, game_specs): \u0026#34;\u0026#34;\u0026#34; è®¡ç®—éŸ³é¢‘æœ¬åœ°åŒ–æˆæœ¬ \u0026#34;\u0026#34;\u0026#34; base_costs = { \u0026#39;english\u0026#39;: 100, # åŸºå‡†æˆæœ¬ \u0026#39;japanese\u0026#39;: 150, \u0026#39;german\u0026#39;: 130, \u0026#39;french\u0026#39;: 125, \u0026#39;spanish\u0026#39;: 110, \u0026#39;russian\u0026#39;: 140, \u0026#39;korean\u0026#39;: 145, \u0026#39;mandarin\u0026#39;: 135 } total_word_count = game_specs[\u0026#39;total_words\u0026#39;] character_count = game_specs[\u0026#39;character_count\u0026#39;] languages = game_specs[\u0026#39;target_languages\u0026#39;] estimated_costs = {} for language in languages: cost_per_word = base_costs.get(language, base_costs[\u0026#39;english\u0026#39;]) total_cost = ( total_word_count * cost_per_word + character_count * 50 # æ¯ä¸ªè§’è‰²åŸºç¡€æˆæœ¬ ) estimated_costs[language] = total_cost return { \u0026#39;language_costs\u0026#39;: estimated_costs, \u0026#39;total_budget\u0026#39;: sum(estimated_costs.values()), \u0026#39;optimization_suggestions\u0026#39;: self.suggest_cost_optimizations(estimated_costs) } def optimize_recording_process(self, voice_requirements): \u0026#34;\u0026#34;\u0026#34; ä¼˜åŒ–å½•éŸ³æµç¨‹ \u0026#34;\u0026#34;\u0026#34; optimization_strategies = { \u0026#39;batch_recording\u0026#39;: { \u0026#39;description\u0026#39;: \u0026#39;æ‰¹é‡å½•åˆ¶ç›¸ä¼¼å°è¯\u0026#39;, \u0026#39;benefits\u0026#39;: [\u0026#39;å‡å°‘å‡†å¤‡æ—¶é—´\u0026#39;, \u0026#39;ä¿æŒå£°éŸ³ä¸€è‡´æ€§\u0026#39;, \u0026#39;é™ä½æˆæœ¬\u0026#39;], \u0026#39;implementation\u0026#39;: \u0026#39;æŒ‰è§’è‰²å’Œæƒ…ç»ªåœºæ™¯åˆ†ç»„\u0026#39; }, \u0026#39;remote_recording\u0026#39;: { \u0026#39;description\u0026#39;: \u0026#39;è¿œç¨‹å½•éŸ³è§£å†³æ–¹æ¡ˆ\u0026#39;, \u0026#39;benefits\u0026#39;: [\u0026#39;æ‰©å¤§äººæ‰é€‰æ‹©\u0026#39;, \u0026#39;é™ä½å·®æ—…æˆæœ¬\u0026#39;, \u0026#39;çµæ´»æ—¶é—´å®‰æ’\u0026#39;], \u0026#39;implementation\u0026#39;: \u0026#39;ä¸“ä¸šçº§å®¶åº­å½•éŸ³è®¾å¤‡æŒ‡å¯¼\u0026#39; }, \u0026#39;ai_assistance\u0026#39;: { \u0026#39;description\u0026#39;: \u0026#39;AIè¾…åŠ©éŸ³é¢‘å¤„ç†\u0026#39;, \u0026#39;benefits\u0026#39;: [\u0026#39;è‡ªåŠ¨é™å™ª\u0026#39;, \u0026#39;éŸ³é¢‘æ ‡å‡†åŒ–\u0026#39;, \u0026#39;æ‰¹é‡å¤„ç†\u0026#39;], \u0026#39;implementation\u0026#39;: \u0026#39;åæœŸåˆ¶ä½œè‡ªåŠ¨åŒ–å·¥å…·\u0026#39; } } return optimization_strategies 2.2 æ–‡åŒ–é€‚åº”æ€§ç­–ç•¥ æ¸¸æˆå†…å®¹æ–‡åŒ–é€‚é…\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 // æ–‡åŒ–é€‚é…æ£€æŸ¥æ¸…å• const culturalAdaptationChecklist = { // è§†è§‰å…ƒç´ é€‚é… visualElements: { colorSymbolism: { china: { red: \u0026#34;å–œåº†ã€å‰ç¥¥\u0026#34;, yellow: \u0026#34;çš‡æƒã€å°Šè´µ\u0026#34;, black: \u0026#34;ä¸¥è‚ƒã€ç¥ç§˜\u0026#34;, white: \u0026#34;å“€æ‚¼ã€ä¸å¹¸\u0026#34; }, western: { red: \u0026#34;æ¿€æƒ…ã€å±é™©\u0026#34;, yellow: \u0026#34;æ¸©æš–ã€è°¨æ…\u0026#34;, black: \u0026#34;ä¼˜é›…ã€æ­»äº¡\u0026#34;, white: \u0026#34;çº¯æ´ã€å’Œå¹³\u0026#34; }, middleEast: { green: \u0026#34;ä¼Šæ–¯å…°ã€ç¹è£\u0026#34;, blue: \u0026#34;ä¿æŠ¤ã€ä¿¡ä»»\u0026#34;, gold: \u0026#34;è´¢å¯Œã€ç¥åœ£\u0026#34; } }, characterDesign: { bodyTypes: \u0026#34;é¿å…å•ä¸€å®¡ç¾æ ‡å‡†\u0026#34;, clothing: \u0026#34;ç¬¦åˆå½“åœ°æ–‡åŒ–ä¹ æƒ¯\u0026#34;, hairstyles: \u0026#34;è€ƒè™‘ç§æ—ç‰¹å¾\u0026#34;, accessories: \u0026#34;æ–‡åŒ–ç¬¦å·ä½¿ç”¨\u0026#34; }, iconography: { religiousSymbols: \u0026#34;è°¨æ…ä½¿ç”¨å®—æ•™å›¾æ ‡\u0026#34;, politicalSymbols: \u0026#34;é¿å…æ”¿æ²»ç¬¦å·\u0026#34;, culturalIcons: \u0026#34;æ­£ç¡®ä½¿ç”¨æ–‡åŒ–å…ƒç´ \u0026#34;, taboos: \u0026#34;äº†è§£å¹¶é¿å…ç¦å¿Œ\u0026#34; } }, // å™äº‹å†…å®¹é€‚é… narrativeContent: { storyThemes: { familyValues: \u0026#34;ç¬¦åˆå½“åœ°å®¶åº­è§‚å¿µ\u0026#34;, socialHierarchy: \u0026#34;å°Šé‡å½“åœ°ç¤¾ä¼šç»“æ„\u0026#34;, historicalContext: \u0026#34;é¿å…å†å²äº‰è®®\u0026#34;, moralValues: \u0026#34;ç¬¦åˆå½“åœ°é“å¾·æ ‡å‡†\u0026#34; }, characterNames: { pronunciation: \u0026#34;æ˜“äºå½“åœ°äººå‘éŸ³\u0026#34;, meaning: \u0026#34;é¿å…ä¸è‰¯å«ä¹‰\u0026#34;, culturalFit: \u0026#34;ç¬¦åˆæ–‡åŒ–èƒŒæ™¯\u0026#34;, trademark: \u0026#34;æ£€æŸ¥å•†æ ‡å†²çª\u0026#34; }, humorContent: { culturalReferences: \u0026#34;æœ¬åœ°åŒ–å¹½é»˜å…ƒç´ \u0026#34;, linguisticHumor: \u0026#34;è¯­è¨€åŒå…³å¤„ç†\u0026#34;, socialTaboos: \u0026#34;é¿å…æ•æ„Ÿè¯é¢˜\u0026#34;, generationalGaps: \u0026#34;è€ƒè™‘å¹´é¾„å·®å¼‚\u0026#34; } }, // æ¸¸æˆæœºåˆ¶é€‚é… gameplayMechanics: { difficultyCurve: { learningCurve: \u0026#34;é€‚åº”å½“åœ°ç©å®¶ä¹ æƒ¯\u0026#34;, tutorialDesign: \u0026#34;è€ƒè™‘æ•™è‚²èƒŒæ™¯\u0026#34;, complexity: \u0026#34;ç¬¦åˆç›®æ ‡ç”¨æˆ·èƒ½åŠ›\u0026#34;, guidance: \u0026#34;æä¾›è¶³å¤ŸæŒ‡å¯¼\u0026#34; }, socialFeatures: { communityBehavior: \u0026#34;ç¬¦åˆå½“åœ°ç¤¾äº¤ä¹ æƒ¯\u0026#34;, privacyConcerns: \u0026#34;å°Šé‡éšç§æ–‡åŒ–\u0026#34;, competitiveStyle: \u0026#34;é€‚åº”å½“åœ°ç«äº‰æ–¹å¼\u0026#34;, cooperationMechanics: \u0026#34;ä¿ƒè¿›å›¢é˜Ÿåä½œ\u0026#34; }, monetization: { purchasingPower: \u0026#34;è€ƒè™‘ç»æµæ°´å¹³\u0026#34;, paymentPreferences: \u0026#34;æœ¬åœ°æ”¯ä»˜æ–¹å¼\u0026#34;, valuePerception: \u0026#34;ç¬¦åˆä»·å€¼è§‚å¿µ\u0026#34;, regulatoryCompliance: \u0026#34;éµå®ˆå½“åœ°æ³•è§„\u0026#34; } } }; åœ°åŒºç‰¹è‰²å†…å®¹å®šåˆ¶\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 # åœ°åŒºç‰¹è‰²å†…å®¹å®šåˆ¶ç³»ç»Ÿ class RegionalContentCustomizer: def __init__(self): self.region_specific_features = { \u0026#39;china\u0026#39;: { festivals: [ \u0026#34;æ˜¥èŠ‚ä¸»é¢˜æ´»åŠ¨\u0026#34;, \u0026#34;ä¸­ç§‹èŠ‚ä»»åŠ¡\u0026#34;, \u0026#34;å›½åº†èŠ‚åº†å…¸\u0026#34;, \u0026#34;ç«¯åˆèŠ‚é¾™èˆŸèµ›\u0026#34; ], culturalElements: [ \u0026#34;äº¬å‰§è„¸è°±\u0026#34;, \u0026#34;ä¹¦æ³•è‰ºæœ¯\u0026#34;, \u0026#34;ä¼ ç»Ÿå»ºç­‘\u0026#34;, \u0026#34;ç¥è¯ä¼ è¯´\u0026#34; ], socialFeatures: [ \u0026#34;å¾®ä¿¡åˆ†äº«\u0026#34;, \u0026#34;QQç™»å½•\u0026#34;, \u0026#34;çº¢åŒ…ç³»ç»Ÿ\u0026#34;, \u0026#34;æ’è¡Œæ¦œ\u0026#34; ] }, \u0026#39;japan\u0026#39;: { festivals: [ \u0026#34;æ¨±èŠ±èŠ‚\u0026#34;, \u0026#34;å¤æ—¥ç¥­å…¸\u0026#34;, \u0026#34;çº¢å¶è§‚èµ\u0026#34;, \u0026#34;åˆè¯£ç¥ˆç¦\u0026#34; ], culturalElements: [ \u0026#34;æ­¦å£«é“ç²¾ç¥\u0026#34;, \u0026#34;åŠ¨æ¼«æ–‡åŒ–\u0026#34;, \u0026#34;ä¼ ç»Ÿå·¥è‰º\u0026#34;, \u0026#34;èŒ¶é“æ–‡åŒ–\u0026#34; ], gameplayPreferences: [ \u0026#34;æ”¶é›†è¦ç´ \u0026#34;, \u0026#34;è§’è‰²å…»æˆ\u0026#34;, \u0026#34;å‰§æƒ…æ·±åº¦\u0026#34;, \u0026#34;éŸ³ä¹å“è´¨\u0026#34; ] }, \u0026#39;korea\u0026#39;: { culturalFeatures: [ \u0026#34;K-popå…ƒç´ \u0026#34;, \u0026#34;ç”µç«æ–‡åŒ–\u0026#34;, \u0026#34;ç¾é£Ÿæ–‡åŒ–\u0026#34;, \u0026#34;æ—¶å°šæ½®æµ\u0026#34; ], socialIntegration: [ \u0026#34;Kakao Talkåˆ†äº«\u0026#34;, \u0026#34;Naverç™»å½•\u0026#34;, \u0026#34;ç›´æ’­äº’åŠ¨\u0026#34;, \u0026#34;ç¤¾åŒºç³»ç»Ÿ\u0026#34; ] } } def generate_regional_content(self, base_game, target_region): \u0026#34;\u0026#34;\u0026#34; ç”Ÿæˆåœ°åŒºç‰¹è‰²å†…å®¹ \u0026#34;\u0026#34;\u0026#34; regional_features = self.region_specific_features.get(target_region, {}) content_adaptations = { \u0026#39;events\u0026#39;: self.create_regional_events(regional_features), \u0026#39;cosmetics\u0026#39;: self.design_regional_cosmetics(regional_features), \u0026#39;gameplay\u0026#39;: self.adapt_gameplay_mechanics(target_region), \u0026#39;narrative\u0026#39;: self.localize_story_elements(target_region), \u0026#39;audio\u0026#39;: self.adapt_audio_content(regional_features) } return { \u0026#39;region\u0026#39;: target_region, \u0026#39;adaptations\u0026#39;: content_adaptations, \u0026#39;implementation_plan\u0026#39;: self.create_implementation_timeline(content_adaptations), \u0026#39;success_metrics\u0026#39;: self.define_regional_success_metrics(target_region) } def measure_cultural_fit_score(self, content_analysis, target_culture): \u0026#34;\u0026#34;\u0026#34; æµ‹é‡æ–‡åŒ–å¥‘åˆåº¦è¯„åˆ† \u0026#34;\u0026#34;\u0026#34; scoring_criteria = { \u0026#39;visual_appropriateness\u0026#39;: 0.25, # è§†è§‰å…ƒç´ åˆé€‚æ€§ \u0026#39;natural_language\u0026#39;: 0.20, # è¯­è¨€è‡ªç„¶åº¦ \u0026#39;cultural_resonance\u0026#39;: 0.20, # æ–‡åŒ–å…±é¸£åº¦ \u0026#39;social_acceptability\u0026#39;: 0.15, # ç¤¾ä¼šæ¥å—åº¦ \u0026#39;regulatory_compliance\u0026#39;: 0.20 # æ³•è§„åˆè§„æ€§ } scores = {} for criterion, weight in scoring_criteria.items(): raw_score = self.evaluate_criterion(content_analysis, criterion, target_culture) weighted_score = raw_score * weight scores[criterion] = weighted_score total_score = sum(scores.values()) return { \u0026#39;overall_score\u0026#39;: total_score, \u0026#39;individual_scores\u0026#39;: scores, \u0026#39;recommendations\u0026#39;: self.generate_improvement_recommendations(scores, target_culture), \u0026#39;risk_assessment\u0026#39;: self.assess_cultural_risks(scores) } ä¸‰ã€å…¨çƒè¥é”€æ¨å¹¿ç­–ç•¥ 3.1 é¢„çƒ­æœŸè¥é”€ç­–ç•¥ æ‚¬å¿µè¥é”€ä¸ç¤¾åŒºå»ºè®¾\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 // é¢„çƒ­è¥é”€ç­–ç•¥ç³»ç»Ÿ const preLaunchMarketing = { // æ‚¬å¿µè¥é”€é˜¶æ®µ teaserCampaign: { phase1_teaser: { duration: \u0026#34;6ä¸ªæœˆå‰\u0026#34;, objectives: [\u0026#34;å»ºç«‹å“ç‰Œè®¤çŸ¥\u0026#34;, \u0026#34;æ¿€å‘å¥½å¥‡å¿ƒ\u0026#34;, \u0026#34;æ”¶é›†æ½œåœ¨ç”¨æˆ·\u0026#34;], tactics: [ { type: \u0026#34;ç¥ç§˜é¢„å‘Š\u0026#34;, description: \u0026#34;å‘å¸ƒæ¦‚å¿µå›¾å’ŒèƒŒæ™¯æ•…äº‹\u0026#34;, channels: [\u0026#34;ç¤¾äº¤åª’ä½“\u0026#34;, \u0026#34;æ¸¸æˆè®ºå›\u0026#34;], timeline: \u0026#34;æ¯å‘¨å‘å¸ƒ\u0026#34;, budget_allocation: \u0026#34;15%\u0026#34; }, { type: \u0026#34;å¼€å‘è€…æ—¥è®°\u0026#34;, description: \u0026#34;åˆ†äº«å¼€å‘è¿‡ç¨‹å’Œç†å¿µ\u0026#34;, channels: [\u0026#34;å®˜æ–¹ç½‘ç«™\u0026#34;, \u0026#34;YouTube\u0026#34;], timeline: \u0026#34;æ¯ä¸¤å‘¨ä¸€æœŸ\u0026#34;, budget_allocation: \u0026#34;10%\u0026#34; }, { type: \u0026#34;æ¦‚å¿µè‰ºæœ¯å±•ç¤º\u0026#34;, description: \u0026#34;å±•ç¤ºæ¸¸æˆä¸–ç•Œè§‚å’Œè§’è‰²è®¾è®¡\u0026#34;, channels: [\u0026#34;ArtStation\u0026#34;, \u0026#34;DeviantArt\u0026#34;, \u0026#34;Instagram\u0026#34;], timeline: \u0026#34;æ¯æœˆä¸»é¢˜\u0026#34;, budget_allocation: \u0026#34;5%\u0026#34; } ] }, phase2_engagement: { duration: \u0026#34;3ä¸ªæœˆå‰\u0026#34;, objectives: [\u0026#34;æ·±åŒ–ç¤¾åŒºå‚ä¸\u0026#34;, \u0026#34;å»ºç«‹æœŸå¾…æ„Ÿ\u0026#34;, \u0026#34;æ”¶é›†ç”¨æˆ·åé¦ˆ\u0026#34;], tactics: [ { type: \u0026#34;Alphaæµ‹è¯•æ‹›å‹Ÿ\u0026#34;, description: \u0026#34;é‚€è¯·æ ¸å¿ƒç©å®¶å‚ä¸æµ‹è¯•\u0026#34;, channels: [\u0026#34;Discord\u0026#34;, \u0026#34;é‚®ä»¶åˆ—è¡¨\u0026#34;], participant_count: 1000, selection_criteria: \u0026#34;æ´»è·ƒåº¦å’ŒåŒ¹é…åº¦\u0026#34; }, { type: \u0026#34;ç¤¾åŒºäº’åŠ¨æ´»åŠ¨\u0026#34;, description: \u0026#34;è®¾è®¡æŠ•ç¥¨ã€ç«çŒœã€åˆ›ä½œæ¯”èµ›\u0026#34;, platforms: [\u0026#34;Reddit\u0026#34;, \u0026#34;Twitter\u0026#34;, \u0026#34;å¾®åš\u0026#34;], frequency: \u0026#34;æ¯å‘¨æ´»åŠ¨\u0026#34;, rewards_system: \u0026#34;æ¸¸æˆå†…å¥–åŠ±å’Œå®ä½“å‘¨è¾¹\u0026#34; } ] } }, // KOLåˆä½œç­–ç•¥ influencerMarketing: { tierSelection: { megaInfluencers: { followerRange: \u0026#34;\u0026gt;1M\u0026#34;, costModel: \u0026#34;å›ºå®šè´¹ç”¨+æ”¶å…¥åˆ†æˆ\u0026#34;, focus: \u0026#34;å“ç‰Œæ›å…‰å’Œå¤§ä¼—è§¦è¾¾\u0026#34;, engagementStrategy: \u0026#34;ç‹¬å®¶é¦–æ’­å†…å®¹\u0026#34; }, macroInfluencers: { followerRange: \u0026#34;100K-1M\u0026#34;, costModel: \u0026#34;CPM+CPI\u0026#34;, focus: \u0026#34;ç²¾å‡†å—ä¼—è§¦è¾¾\u0026#34;, engagementStrategy: \u0026#34;æ·±åº¦ä½“éªŒå†…å®¹\u0026#34; }, microInfluencers: { followerRange: \u0026#34;10K-100K\u0026#34;, costModel: \u0026#34;å›ºå®šè´¹ç”¨+äº§å“èµ é€\u0026#34;, focus: \u0026#34;å‚ç›´é¢†åŸŸå½±å“åŠ›\u0026#34;, engagementStrategy: \u0026#34;é•¿æœŸåˆä½œå…³ç³»\u0026#34; }, nanoInfluencers: { followerRange: \u0026#34;\u0026lt;10K\u0026#34;, costModel: \u0026#34;äº§å“èµ é€+æ”¶å…¥åˆ†æˆ\u0026#34;, focus: \u0026#34;ç¤¾åŒºçœŸå®æ„Ÿ\u0026#34;, engagementStrategy: \u0026#34;æ—©æœŸä½“éªŒè€…èº«ä»½\u0026#34; } }, contentStrategy: { exclusiveContent: \u0026#34;æä¾›ç‹¬å®¶æ¸¸æˆå†…å®¹\u0026#34;, earlyAccess: \u0026#34;æå‰ä½“éªŒæ–°ç‰ˆæœ¬\u0026#34;, coCreation: \u0026#34;åˆä½œåˆ›ä½œå®šåˆ¶å†…å®¹\u0026#34;, liveStreaming: \u0026#34;ç›´æ’­è¯•ç©å’Œè§£è¯´\u0026#34; } }, // é¢„è®¢æ´»åŠ¨è®¾è®¡ preOrderCampaign: { rewardTiers: [ { tier: \u0026#34;åŸºç¡€é¢„è®¢\u0026#34;, price: \u0026#34;$29.99\u0026#34;, rewards: [ \u0026#34;æ¸¸æˆæœ¬ä½“æ•°å­—ç‰ˆ\u0026#34;, \u0026#34;é¢„è®¢ä¸“å±å¤´åƒ\u0026#34;, \u0026#34;å¼€åœºå‰§æƒ…è®¿é—®\u0026#34; ] }, { tier: \u0026#34;è±ªåç‰ˆ\u0026#34;, price: \u0026#34;$49.99\u0026#34;, rewards: [ \u0026#34;æ¸¸æˆæœ¬ä½“+å­£ç¥¨\u0026#34;, \u0026#34;æ•°å­—è®¾å®šé›†\u0026#34;, \u0026#34;åŸå£°éŸ³ä¹ä¸‹è½½\u0026#34;, \u0026#34;æ¸¸æˆå†…å® ç‰©\u0026#34; ] }, { tier: \u0026#34;æ”¶è—ç‰ˆ\u0026#34;, price: \u0026#34;$89.99\u0026#34;, rewards: [ \u0026#34;è±ªåç‰ˆæ‰€æœ‰å†…å®¹\u0026#34;, \u0026#34;å®ä½“å‘¨è¾¹ï¼ˆå¾½ç« ã€è´´çº¸ï¼‰\u0026#34;, \u0026#34;å¼€å‘è€…æ„Ÿè°¢ä¿¡\u0026#34;, \u0026#34;Discordç‰¹æ®Šèº«ä»½\u0026#34; ] }, { tier: \u0026#34;åˆ›å§‹äººç‰ˆ\u0026#34;, price: \u0026#34;$149.99\u0026#34;, rewards: [ \u0026#34;æ”¶è—ç‰ˆæ‰€æœ‰å†…å®¹\u0026#34;, \u0026#34;æ¸¸æˆå†…NPCå† åæƒ\u0026#34;, \u0026#34;å¼€å‘å›¢é˜Ÿè§†é¢‘é€šè¯\u0026#34;, \u0026#34;é™é‡å®ä½“æ”¶è—å“\u0026#34; ] } ], urgencyElements: [ \u0026#34;é™é‡æ—©é¸Ÿä¼˜æƒ \u0026#34;, \u0026#34;å€’è®¡æ—¶ç‰¹ä»·\u0026#34;, \u0026#34;ç‹¬å®¶å¥–åŠ±é™æ—¶é¢†å–\u0026#34;, \u0026#34;é˜¶æ¢¯å¼å¥–åŠ±è§£é”\u0026#34; ] } }; åª’ä½“å…³ç³»ä¸PRç­–ç•¥\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 # PRåª’ä½“å…³ç³»ç®¡ç†ç³»ç»Ÿ class PRMediaManager: def __init__(self): self.media_tiers = { \u0026#39;tier_1_global\u0026#39;: { \u0026#39;outlets\u0026#39;: [ \u0026#39;IGN\u0026#39;, \u0026#39;GameSpot\u0026#39;, \u0026#39;Polygon\u0026#39;, \u0026#39;Kotaku\u0026#39;, \u0026#39;PC Gamer\u0026#39; ], \u0026#39;approach\u0026#39;: \u0026#39;ä¸“å±ä¸“è®¿+è¯•ç©\u0026#39;, \u0026#39;timing\u0026#39;: \u0026#39;æå‰2ä¸ªæœˆæ¥è§¦\u0026#39;, \u0026#39;value\u0026#39;: \u0026#39;è¡Œä¸šæƒå¨èƒŒä¹¦\u0026#39; }, \u0026#39;tier_2_regional\u0026#39;: { \u0026#39;outlets\u0026#39;: [ \u0026#39;4Gamer (æ—¥æœ¬)\u0026#39;, \u0026#39;GameStar (å¾·å›½)\u0026#39;, \u0026#39;Jeuxvideo (æ³•å›½)\u0026#39;, \u0026#39;Eurogamer\u0026#39; ], \u0026#39;approach\u0026#39;: \u0026#39;æœ¬åœ°åŒ–å†…å®¹+åœ°åŒºç‹¬å®¶\u0026#39;, \u0026#39;timing\u0026#39;: \u0026#39;æå‰1.5ä¸ªæœˆæ¥è§¦\u0026#39;, \u0026#39;value\u0026#39;: \u0026#39;åŒºåŸŸå¸‚åœºè¦†ç›–\u0026#39; }, \u0026#39;tier_3_niche\u0026#39;: { \u0026#39;outlets\u0026#39;: [ \u0026#39;Rock Paper Shotgun\u0026#39;, \u0026#39;Destructoid\u0026#39;, \u0026#39;TouchArcade\u0026#39;, \u0026#39;Siliconera\u0026#39; ], \u0026#39;approach\u0026#39;: \u0026#39;ç»†åˆ†å®šä½+æ·±åº¦åˆ†æ\u0026#39;, \u0026#39;timing\u0026#39;: \u0026#39;æå‰1ä¸ªæœˆæ¥è§¦\u0026#39;, \u0026#39;value\u0026#39;: \u0026#39;å‚ç›´å—ä¼—è§¦è¾¾\u0026#39; } } def create_media_kit(self, game_info): \u0026#34;\u0026#34;\u0026#34; åˆ›å»ºåª’ä½“èµ„æ–™åŒ… \u0026#34;\u0026#34;\u0026#34; media_kit = { \u0026#39;core_information\u0026#39;: { \u0026#39;game_overview\u0026#39;: self.create_game_summary(game_info), \u0026#39;key_features\u0026#39;: self.highlight_main_features(game_info), \u0026#39;development_team\u0026#39;: self.team_background(game_info), \u0026#39;technical_specs\u0026#39;: self.technical_specifications(game_info) }, \u0026#39;visual_assets\u0026#39;: { \u0026#39;screenshots\u0026#39;: self.curate_best_screenshots(game_info), \u0026#39;gameplay_videos\u0026#39;: self.prepare_gameplay_footage(game_info), \u0026#39;concept_art\u0026#39;: self.organize_concept_art(game_info), \u0026#39;brand_assets\u0026#39;: self.provide_brand_guidelines() }, \u0026#39;story_elements\u0026#39;: { \u0026#39;narrative_summary\u0026#39;: self.game_story_summary(game_info), \u0026#39;character_profiles\u0026#39;: self.main_character_descriptions(game_info), \u0026#39;world_building\u0026#39;: self.game_world_lore(game_info) }, \u0026#39;business_information\u0026#39;: { \u0026#39;platforms_dates\u0026#39;: self.release_schedule(game_info), \u0026#39;pricing_info\u0026#39;: self.pricing_strategy(game_info), \u0026#39;monetization_model\u0026#39;: self.revenue_model_explanation(game_info), \u0026#39;company_background\u0026#39;: self.studio_information() } } return media_kit def plan_press_events(self, launch_timeline): \u0026#34;\u0026#34;\u0026#34; è§„åˆ’åª’ä½“æ´»åŠ¨ \u0026#34;\u0026#34;\u0026#34; event_schedule = { \u0026#39;media_preview\u0026#39;: { \u0026#39;timing\u0026#39;: \u0026#39;å‘è¡Œå‰2ä¸ªæœˆ\u0026#39;, \u0026#39;format\u0026#39;: \u0026#39;å°å‹é—­é—¨ä½“éªŒä¼š\u0026#39;, \u0026#39;participants\u0026#39;: 15, \u0026#39;focus\u0026#39;: \u0026#39;æ·±åº¦ä½“éªŒ+QAäº¤æµ\u0026#39;, \u0026#39;follow_up\u0026#39;: \u0026#39;ä¸“å±é‡‡è®¿æœºä¼š\u0026#39; }, \u0026#39;press_conference\u0026#39;: { \u0026#39;timing\u0026#39;: \u0026#39;å‘è¡Œå‰1ä¸ªæœˆ\u0026#39;, \u0026#39;format\u0026#39;: \u0026#39;çº¿ä¸Š+çº¿ä¸‹æ··åˆå‘å¸ƒä¼š\u0026#39;, \u0026#39;participants\u0026#39;: 100, \u0026#39;focus\u0026#39;: \u0026#39;æ­£å¼å…¬å¸ƒ+æ¼”ç¤º\u0026#39;, \u0026#39;live_stream\u0026#39;: \u0026#39;å…¨çƒåŒæ­¥ç›´æ’­\u0026#39; }, \u0026#39;influencer_day\u0026#39;: { \u0026#39;timing\u0026#39;: \u0026#39;å‘è¡Œå‰2å‘¨\u0026#39;, \u0026#39;format\u0026#39;: \u0026#39;åˆ›ä½œè€…ä¸“å±ä½“éªŒæ—¥\u0026#39;, \u0026#39;participants\u0026#39;: 50, \u0026#39;focus\u0026#39;: \u0026#39;å†…å®¹åˆ›ä½œæ”¯æŒ\u0026#39;, \u0026#39;assets_provided\u0026#39;: \u0026#39;ä¸“å±ç´ æ+æ•™ç¨‹\u0026#39; }, \u0026#39;launch_event\u0026#39;: { \u0026#39;timing\u0026#39;: \u0026#39;å‘è¡Œæ—¥\u0026#39;, \u0026#39;format\u0026#39;: \u0026#39;åº†ç¥æ´»åŠ¨\u0026#39;, \u0026#39;participants\u0026#39;: 200, \u0026#39;focus\u0026#39;: \u0026#39;ç¤¾åŒºäº’åŠ¨+åª’ä½“é‡‡è®¿\u0026#39;, \u0026#39;special_guests\u0026#39;: \u0026#39;å¼€å‘å›¢é˜Ÿ+ç‰¹é‚€å˜‰å®¾\u0026#39; } } return event_schedule 3.2 å‘è¡ŒæœŸè¥é”€çˆ†å‘ å¤šå¹³å°å¹¿å‘ŠæŠ•æ”¾ç­–ç•¥\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 // å¹¿å‘ŠæŠ•æ”¾ç­–ç•¥é…ç½® const advertisingStrategy = { // æœç´¢å¼•æ“è¥é”€ searchEngineMarketing: { googleAds: { campaign_structure: { brand_campaign: { keywords: [\u0026#34;æ¸¸æˆåç§°\u0026#34;, \u0026#34;æ¸¸æˆåä¸‹è½½\u0026#34;, \u0026#34;æ¸¸æˆåå®˜ç½‘\u0026#34;], ad_copy: \u0026#34;å®˜æ–¹ä¸‹è½½é“¾æ¥ï¼Œå®‰å…¨å¯é \u0026#34;, landing_page: \u0026#34;å®˜æ–¹ç½‘ç«™\u0026#34;, budget_allocation: \u0026#34;25%\u0026#34; }, genre_campaign: { keywords: [\u0026#34;RPGæ¸¸æˆ\u0026#34;, \u0026#34;ç­–ç•¥æ¸¸æˆ\u0026#34;, \u0026#34;å†’é™©æ¸¸æˆ\u0026#34;], ad_copy: \u0026#34;2025å¹´åº¦æœ€ä½³RPGï¼Œç«‹å³ä½“éªŒ\u0026#34;, landing_page: \u0026#34;æ¸¸æˆç‰¹è‰²é¡µé¢\u0026#34;, budget_allocation: \u0026#34;35%\u0026#34; }, competitor_campaign: { keywords: [\u0026#34;ç±»ä¼¼XXæ¸¸æˆ\u0026#34;, \u0026#34;XXæ›¿ä»£æ¸¸æˆ\u0026#34;], ad_copy: \u0026#34;æ¯”XXæ›´å¥½ç©çš„RPGæ¸¸æˆ\u0026#34;, landing_page: \u0026#34;å¯¹æ¯”é¡µé¢\u0026#34;, budget_allocation: \u0026#34;15%\u0026#34; }, platform_specific: { keywords: [\u0026#34;Steam RPG\u0026#34;, \u0026#34;æ‰‹æœºç­–ç•¥æ¸¸æˆ\u0026#34;, \u0026#34;PS5å†’é™©æ¸¸æˆ\u0026#34;], ad_copy: \u0026#34;å¹³å°ä¸“å±ä¼˜åŒ–ç‰ˆæœ¬\u0026#34;, landing_page: \u0026#34;å¹³å°ä¸‹è½½é¡µ\u0026#34;, budget_allocation: \u0026#34;25%\u0026#34; } }, optimization_strategies: { bidding: \u0026#34;æ™ºèƒ½å‡ºä»·+ç›®æ ‡CPA\u0026#34;, ad_rotation: \u0026#34;å¤šç‰ˆæœ¬A/Bæµ‹è¯•\u0026#34;, audience_targeting: \u0026#34;ç±»ä¼¼å—ä¼—+å†è¥é”€\u0026#34;, conversion_tracking: \u0026#34;å®Œæ•´æ¼æ–—è¿½è¸ª\u0026#34; } }, // ç¤¾äº¤åª’ä½“å¹¿å‘Š socialMediaAds: { facebook_instagram: { format_types: [ { type: \u0026#34;è§†é¢‘å¹¿å‘Š\u0026#34;, duration: \u0026#34;15-30ç§’\u0026#34;, objective: \u0026#34;å“ç‰Œè®¤çŸ¥+å®‰è£…\u0026#34;, placement: \u0026#34;Stories+Reels\u0026#34; }, { type: \u0026#34;è½®æ’­å¹¿å‘Š\u0026#34;, cards: 5, objective: \u0026#34;åŠŸèƒ½å±•ç¤º\u0026#34;, content: \u0026#34;æ¸¸æˆæˆªå›¾+ç‰¹è‰²ä»‹ç»\u0026#34; }, { type: \u0026#34;ç²¾å“æ å¹¿å‘Š\u0026#34;, objective: \u0026#34;æ·±åº¦äº’åŠ¨\u0026#34;, content: \u0026#34;æ¸¸æˆè¯¦æƒ…+å³æ—¶ä½“éªŒ\u0026#34; } ], targeting_strategy: { core_gaming_audience: \u0026#34;æ¸¸æˆå…´è¶£+è®¾å¤‡ä½¿ç”¨\u0026#34;, lookalike_audiences: \u0026#34;åŸºäºç°æœ‰ç”¨æˆ·\u0026#34;, custom_audiences: \u0026#34;ç½‘ç«™è®¿é—®è€…+é‚®ç®±åˆ—è¡¨\u0026#34;, behavioral_targeting: \u0026#34;ä»˜è´¹ç”¨æˆ·+æ´»è·ƒç©å®¶\u0026#34; } }, youtube: { ad_formats: [ { type: \u0026#34;å¯è·³è¿‡æ’æ’­å¹¿å‘Š\u0026#34;, duration: \u0026#34;30ç§’\u0026#34;, content: \u0026#34;ç²¾å½©æ¸¸æˆå‰ªè¾‘\u0026#34;, call_to_action: \u0026#34;ç«‹å³ä¸‹è½½\u0026#34; }, { type: \u0026#34;ä¸å¯è·³è¿‡å¹¿å‘Š\u0026#34;, duration: \u0026#34;15ç§’\u0026#34;, content: \u0026#34;æ ¸å¿ƒå–ç‚¹å±•ç¤º\u0026#34;, branding_focus: true }, { type: \u0026#34;å¯¼è§†å¹¿å‘Š\u0026#34;, placement: \u0026#34;æœç´¢ç»“æœæ—\u0026#34;, content: \u0026#34;æ¸¸æˆé¢„å‘Šç‰‡\u0026#34; } ] }, tiktok: { creative_strategy: { content_types: [ \u0026#34;æ¸¸æˆé«˜å…‰æ—¶åˆ»\u0026#34;, \u0026#34;éŸ³ä¹é…åˆæ¸¸æˆç”»é¢\u0026#34;, \u0026#34;æŒ‘æˆ˜èµ›æ´»åŠ¨\u0026#34;, \u0026#34;è¾¾äººåˆä½œå†…å®¹\u0026#34; ], optimization_tips: [ \u0026#34;å‰3ç§’æŠ“ä½æ³¨æ„åŠ›\u0026#34;, \u0026#34;ä½¿ç”¨çƒ­é—¨éŸ³ä¹\u0026#34;, \u0026#34;åŠ å…¥äº’åŠ¨å…ƒç´ \u0026#34;, \u0026#34;å‚ç›´æ ¼å¼ä¼˜åŒ–\u0026#34; ] } } }, // ç¨‹åºåŒ–å¹¿å‘Š programmaticAdvertising: { demand_side_platforms: [ \u0026#34;Google Display \u0026amp; Video 360\u0026#34;, \u0026#34;The Trade Desk\u0026#34;, \u0026#34;Amazon DSP\u0026#34;, \u0026#34;AppNexus\u0026#34; ], targeting_parameters: { demographic: \u0026#34;å¹´é¾„18-45ï¼Œæ¸¸æˆçˆ±å¥½è€…\u0026#34;, contextual: \u0026#34;æ¸¸æˆç›¸å…³ç½‘ç«™å’Œåº”ç”¨\u0026#34;, behavioral: \u0026#34;æ¸¸æˆä¸‹è½½å†å²+æ¸¸æˆæ—¶é—´\u0026#34;, retargeting: \u0026#34;å¹¿å‘Šæ›å…‰ä½†æœªè½¬åŒ–ç”¨æˆ·\u0026#34; }, creative_optimization: { dynamic_creative_optimization: \u0026#34;æ ¹æ®ç”¨æˆ·æ•°æ®å±•ç¤ºä¸åŒåˆ›æ„\u0026#34;, frequency_capping: \u0026#34;é¿å…å¹¿å‘Šç–²åŠ³\u0026#34;, viewability_optimization: \u0026#34;ç¡®ä¿å¹¿å‘Šå¯è§æ€§\u0026#34;, brand_safety: \u0026#34;é¿å…ä¸å½“å±•ç¤ºç¯å¢ƒ\u0026#34; } } }; ç¤¾åŒºè¿è¥ä¸ç”¨æˆ·äº’åŠ¨\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 # ç¤¾åŒºè¿è¥ç®¡ç†ç³»ç»Ÿ class CommunityManagementSystem: def __init__(self): self.community_platforms = { \u0026#39;discord\u0026#39;: { \u0026#39;purpose\u0026#39;: \u0026#39;æ ¸å¿ƒç©å®¶ç¤¾åŒº\u0026#39;, \u0026#39;features\u0026#39;: [\u0026#39;è¯­éŸ³èŠå¤©\u0026#39;, \u0026#39;æ–‡æœ¬é¢‘é“\u0026#39;, \u0026#39;è§’è‰²ç³»ç»Ÿ\u0026#39;], \u0026#39;management_strategy\u0026#39;: \u0026#39;æ´»è·ƒåº¦æ¿€åŠ±+å†…å®¹åˆ›ä½œ\u0026#39;, \u0026#39;engagement_metrics\u0026#39;: [\u0026#39;DAU\u0026#39;, \u0026#39;æ¶ˆæ¯æ•°é‡\u0026#39;, \u0026#39;å‚ä¸åº¦\u0026#39;] }, \u0026#39;reddit\u0026#39;: { \u0026#39;purpose\u0026#39;: \u0026#39;è®¨è®ºå’Œåé¦ˆ\u0026#39;, \u0026#39;features\u0026#39;: [\u0026#39;è¯é¢˜ç»„ç»‡\u0026#39;, \u0026#39;æŠ•ç¥¨ç³»ç»Ÿ\u0026#39;, \u0026#39;AMAæ´»åŠ¨\u0026#39;], \u0026#39;management_strategy\u0026#39;: \u0026#39;å†…å®¹å¼•å¯¼+é—®é¢˜è§£ç­”\u0026#39;, \u0026#39;engagement_metrics\u0026#39;: [\u0026#39;å¸–å­æ•°é‡\u0026#39;, \u0026#39;è¯„è®ºæ•°\u0026#39;, \u0026#39;æŠ•ç¥¨æ•°\u0026#39;] }, \u0026#39;twitter\u0026#39;: { \u0026#39;purpose\u0026#39;: \u0026#39;å®æ—¶äº’åŠ¨å’Œå…¬å‘Š\u0026#39;, \u0026#39;features\u0026#39;: [\u0026#39;çŸ­æ¶ˆæ¯\u0026#39;, \u0026#39;è¯é¢˜æ ‡ç­¾\u0026#39;, \u0026#39;åª’ä½“åˆ†äº«\u0026#39;], \u0026#39;management_strategy\u0026#39;: \u0026#39;å¿«é€Ÿå“åº”+çƒ­ç‚¹å‚ä¸\u0026#39;, \u0026#39;engagement_metrics\u0026#39;: [\u0026#39;è½¬å‘æ•°\u0026#39;, \u0026#39;ç‚¹èµæ•°\u0026#39;, \u0026#39;å›å¤æ•°\u0026#39;] }, \u0026#39;facebook\u0026#39;: { \u0026#39;purpose\u0026#39;: \u0026#39;å¹¿æ³›ç”¨æˆ·è¦†ç›–\u0026#39;, \u0026#39;features\u0026#39;: [\u0026#39;é¡µé¢ç®¡ç†\u0026#39;, \u0026#39;ç¾¤ç»„åŠŸèƒ½\u0026#39;, \u0026#39;æ´»åŠ¨åˆ›å»º\u0026#39;], \u0026#39;management_strategy\u0026#39;: \u0026#39;å†…å®¹è¥é”€+æ´»åŠ¨ç»„ç»‡\u0026#39;, \u0026#39;engagement_metrics\u0026#39;: [\u0026#39;é¡µé¢è®¿é—®\u0026#39;, \u0026#39;å¸–å­äº’åŠ¨\u0026#39;, \u0026#39;æ´»åŠ¨å‚ä¸\u0026#39;] } } def create_content_calendar(self, launch_phase): \u0026#34;\u0026#34;\u0026#34; åˆ›å»ºç¤¾åŒºå†…å®¹æ—¥å† \u0026#34;\u0026#34;\u0026#34; if launch_phase == \u0026#39;pre_launch\u0026#39;: content_types = [ \u0026#39;å¼€å‘æ—¥å¿—\u0026#39;, \u0026#39;æ¦‚å¿µè‰ºæœ¯\u0026#39;, \u0026#39;è§’è‰²ä»‹ç»\u0026#39;, \u0026#39;ä¸–ç•Œè§‚è®¾å®š\u0026#39;, \u0026#39;éŸ³ä¹é‡‡æ ·\u0026#39;, \u0026#39;å¹•åæ•…äº‹\u0026#39; ] frequency = \u0026#39;æ¯æ—¥1-2æ¡å†…å®¹\u0026#39; engagement_focus = \u0026#39;å»ºç«‹æœŸå¾…å’Œç¤¾åŒºå½’å±æ„Ÿ\u0026#39; elif launch_phase == \u0026#39;launch_week\u0026#39;: content_types = [ \u0026#39;ä¸‹è½½æŒ‡å¼•\u0026#39;, \u0026#39;æ–°æ‰‹æ•™ç¨‹\u0026#39;, \u0026#39;ç›´æ’­æ´»åŠ¨\u0026#39;, \u0026#39;ç©å®¶æ™’å›¾\u0026#39;, \u0026#39;FAQè§£ç­”\u0026#39;, \u0026#39;å®æ—¶æ›´æ–°\u0026#39; ] frequency = \u0026#39;æ¯å°æ—¶1æ¡å†…å®¹\u0026#39; engagement_focus = \u0026#39;ç”¨æˆ·å¼•å¯¼å’Œé—®é¢˜è§£å†³\u0026#39; elif launch_phase == \u0026#39;post_launch\u0026#39;: content_types = [ \u0026#39;ç‰ˆæœ¬æ›´æ–°\u0026#39;, \u0026#39;æ´»åŠ¨å…¬å‘Š\u0026#39;, \u0026#39;ç©å®¶ç²¾é€‰\u0026#39;, \u0026#39;æ”»ç•¥åˆ†äº«\u0026#39;, \u0026#39;ç«å“å¯¹æ¯”\u0026#39;, \u0026#39;ç¤¾åŒºæŠ•ç¥¨\u0026#39; ] frequency = \u0026#39;æ¯æ—¥3-5æ¡å†…å®¹\u0026#39; engagement_focus = \u0026#39;ç”¨æˆ·ç•™å­˜å’Œç¤¾åŒºæ´»è·ƒ\u0026#39; return { \u0026#39;phase\u0026#39;: launch_phase, \u0026#39;content_types\u0026#39;: content_types, \u0026#39;posting_frequency\u0026#39;: frequency, \u0026#39;engagement_objective\u0026#39;: engagement_focus, \u0026#39;platform_specific\u0026#39;: self.adapt_content_for_platforms(content_types) } def implement_gamification(self, community_data): \u0026#34;\u0026#34;\u0026#34; å®æ–½ç¤¾åŒºæ¸¸æˆåŒ– \u0026#34;\u0026#34;\u0026#34; gamification_elements = { \u0026#39;reputation_system\u0026#39;: { \u0026#39;levels\u0026#39;: [\u0026#39;æ–°æ‰‹ä¸Šè·¯\u0026#39;, \u0026#39;æ´»è·ƒç©å®¶\u0026#39;, \u0026#39;ç¤¾åŒºè¾¾äºº\u0026#39;, \u0026#39;ç‰ˆä¸»å€™é€‰äºº\u0026#39;], \u0026#39;points_earning\u0026#39;: [ \u0026#39;å‘å¸ƒå†…å®¹: +10åˆ†\u0026#39;, \u0026#39;è·å¾—ç‚¹èµ: +2åˆ†\u0026#39;, \u0026#39;ä¼˜è´¨å›ç­”: +20åˆ†\u0026#39;, \u0026#39;ä¸¾æŠ¥è¿è§„: +5åˆ†\u0026#39; ], \u0026#39;privileges\u0026#39;: { \u0026#39;ä¸“å±å¾½ç« \u0026#39;: \u0026#39;100åˆ†è§£é”\u0026#39;, \u0026#39;ç‰¹æ®Šè§’è‰²\u0026#39;: \u0026#39;500åˆ†è§£é”\u0026#39;, \u0026#39;ç‰ˆä¸»æƒé™\u0026#39;: \u0026#39;2000åˆ†è§£é”\u0026#39; } }, \u0026#39;achievement_system\u0026#39;: { \u0026#39;participation_achievements\u0026#39;: [ \u0026#39;é¦–æ¬¡å‘è¨€: \u0026#34;åˆéœ²å¤´è§’\u0026#34;\u0026#39;, \u0026#39;è¿ç»­ç­¾åˆ°7å¤©: \u0026#34;åšæŒä¸æ‡ˆ\u0026#34;\u0026#39;, \u0026#39;å‘å¸ƒ10æ¡å†…å®¹: \u0026#34;å†…å®¹åˆ›ä½œè€…\u0026#34;\u0026#39; ], \u0026#39;quality_achievements\u0026#39;: [ \u0026#39;è·å¾—100ä¸ªèµ: \u0026#34;äººæ°”ç‹\u0026#34;\u0026#39;, \u0026#39;ä¼˜è´¨å›ç­”è¢«ç½®é¡¶: \u0026#34;æ™ºå¤šæ˜Ÿ\u0026#34;\u0026#39;, \u0026#39;ç¤¾åŒºè´¡çŒ®å¥–: \u0026#34;åŠŸå‹‹ç©å®¶\u0026#34;\u0026#39; ], \u0026#39;special_achievements\u0026#39;: [ \u0026#39;é‚€è¯·å¥½å‹åŠ å…¥: \u0026#34;ç¤¾äº¤è¾¾äºº\u0026#34;\u0026#39;, \u0026#39;å‚ä¸ç¤¾åŒºæ´»åŠ¨: \u0026#34;æ´»è·ƒåˆ†å­\u0026#34;\u0026#39;, \u0026#39;bugæŠ¥å‘Šè´¡çŒ®: \u0026#34;è´¨é‡å®ˆæŠ¤è€…\u0026#34;\u0026#39; ] }, \u0026#39;reward_system\u0026#39;: { \u0026#39;digital_rewards\u0026#39;: [ \u0026#39;æ¸¸æˆå†…é“å…·\u0026#39;, \u0026#39;ä¸“å±å¤´åƒæ¡†\u0026#39;, \u0026#39;é™é‡çš®è‚¤\u0026#39;, \u0026#39;ç§°å·å¾½ç« \u0026#39; ], \u0026#39;physical_rewards\u0026#39;: [ \u0026#39;æ¸¸æˆå‘¨è¾¹\u0026#39;, \u0026#39;å®šåˆ¶ç¤¼å“\u0026#39;, \u0026#39;å¼€å‘è€…ç­¾å\u0026#39;, \u0026#39;é™é‡æ”¶è—å“\u0026#39; ], \u0026#39;experiential_rewards\u0026#39;: [ \u0026#39;å¼€å‘å›¢é˜Ÿè§é¢ä¼š\u0026#39;, \u0026#39;æ¸¸æˆæµ‹è¯•ä¼˜å…ˆæƒ\u0026#39;, \u0026#39;ç‰ˆæœ¬æ›´æ–°å†…æµ‹èµ„æ ¼\u0026#39;, \u0026#39;æ¸¸æˆåˆ¶ä½œå‚ä¸æœºä¼š\u0026#39; ] } } return gamification_elements å››ã€æ•°æ®é©±åŠ¨çš„è¿è¥ä¼˜åŒ– 4.1 å…³é”®æŒ‡æ ‡ç›‘æ§ä½“ç³» ç”¨æˆ·ç”Ÿå‘½å‘¨æœŸåˆ†æ\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 # ç”¨æˆ·ç”Ÿå‘½å‘¨æœŸåˆ†æç³»ç»Ÿ class UserLifecycleAnalyzer: def __init__(self): self.lifecycle_stages = { \u0026#39;acquisition\u0026#39;: { \u0026#39;metrics\u0026#39;: [\u0026#39;install_count\u0026#39;, \u0026#39;acquisition_cost\u0026#39;, \u0026#39;source_breakdown\u0026#39;], \u0026#39;target\u0026#39;: 0.30, # 30%è½¬åŒ–ç‡ç›®æ ‡ \u0026#39;optimization_focus\u0026#39;: \u0026#39;æ¸ é“è´¨é‡å’Œæˆæœ¬æ•ˆç‡\u0026#39; }, \u0026#39;activation\u0026#39;: { \u0026#39;metrics\u0026#39;: [\u0026#39;tutorial_completion\u0026#39;, \u0026#39;first_session_duration\u0026#39;, \u0026#39;key_actions\u0026#39;], \u0026#39;target\u0026#39;: 0.70, # 70%æ¿€æ´»ç‡ç›®æ ‡ \u0026#39;optimization_focus\u0026#39;: \u0026#39;æ–°æ‰‹å¼•å¯¼å’Œæ ¸å¿ƒåŠŸèƒ½å‘ç°\u0026#39; }, \u0026#39;retention\u0026#39;: { \u0026#39;metrics\u0026#39;: [\u0026#39;day_1_retention\u0026#39;, \u0026#39;day_7_retention\u0026#39;, \u0026#39;day_30_retention\u0026#39;], \u0026#39;targets\u0026#39;: {\u0026#39;d1\u0026#39;: 0.40, \u0026#39;d7\u0026#39;: 0.25, \u0026#39;d30\u0026#39;: 0.15}, \u0026#39;optimization_focus\u0026#39;: \u0026#39;é•¿æœŸå‚ä¸å’Œä¹ æƒ¯å…»æˆ\u0026#39; }, \u0026#39;revenue\u0026#39;: { \u0026#39;metrics\u0026#39;: [\u0026#39;arppu\u0026#39;, \u0026#39;ltv\u0026#39;, \u0026#39;monetization_rate\u0026#39;, \u0026#39;repeat_purchases\u0026#39;], \u0026#39;targets\u0026#39;: {\u0026#39;arppu\u0026#39;: 15.0, \u0026#39;ltv\u0026#39;: 25.0, \u0026#39;conv_rate\u0026#39;: 0.05}, \u0026#39;optimization_focus\u0026#39;: \u0026#39;ä»˜è´¹è½¬åŒ–å’Œå®¢å•ä»·æå‡\u0026#39; }, \u0026#39;referral\u0026#39;: { \u0026#39;metrics\u0026#39;: [\u0026#39;viral_coefficient\u0026#39;, \u0026#39;referral_rate\u0026#39;, \u0026#39;social_shares\u0026#39;], \u0026#39;target\u0026#39;: 0.20, # 20%æ¨èç‡ç›®æ ‡ \u0026#39;optimization_focus\u0026#39;: \u0026#39;ç¤¾äº¤åˆ†äº«å’Œç”¨æˆ·æ¨è\u0026#39; } } def calculate_ltv_cac_ratio(self, user_cohort): \u0026#34;\u0026#34;\u0026#34; è®¡ç®—LTV/CACæ¯”ç‡ \u0026#34;\u0026#34;\u0026#34; # ç”¨æˆ·è·å–æˆæœ¬ cac_metrics = { \u0026#39;marketing_spend\u0026#39;: user_cohort[\u0026#39;total_marketing_cost\u0026#39;], \u0026#39;acquired_users\u0026#39;: user_cohort[\u0026#39;new_user_count\u0026#39;], \u0026#39;sales_team_cost\u0026#39;: user_cohort[\u0026#39;sales_expenses\u0026#39;], \u0026#39;overhead_costs\u0026#39;: user_cohort[\u0026#39;operational_overhead\u0026#39;] } cac = ( cac_metrics[\u0026#39;marketing_spend\u0026#39;] + cac_metrics[\u0026#39;sales_team_cost\u0026#39;] + cac_metrics[\u0026#39;overhead_costs\u0026#39;] ) / cac_metrics[\u0026#39;acquired_users\u0026#39;] # ç”¨æˆ·ç”Ÿå‘½å‘¨æœŸä»·å€¼ revenue_data = user_cohort[\u0026#39;revenue_timeline\u0026#39;] retention_data = user_cohort[\u0026#39;retention_curve\u0026#39;] ltv = 0 cumulative_revenue = 0 for month in range(1, 25): # 24ä¸ªæœˆLTVçª—å£ monthly_revenue = revenue_data.get(month, 0) retention_rate = retention_data.get(month, 0) # è€ƒè™‘è´§å¸æ—¶é—´ä»·å€¼ discounted_revenue = monthly_revenue * retention_rate / (1 + 0.01) ** month cumulative_revenue += discounted_revenue # å½“ç´¯ç§¯æ”¶å…¥å¢é•¿å°äº1%æ—¶åœæ­¢è®¡ç®— if month \u0026gt; 1: growth_rate = (cumulative_revenue - previous_revenue) / previous_revenue if growth_rate \u0026lt; 0.01: break previous_revenue = cumulative_revenue ltv = cumulative_revenue # åˆ†æç»“æœ ratio = ltv / cac return { \u0026#39;ltv\u0026#39;: ltv, \u0026#39;cac\u0026#39;: cac, \u0026#39;ltv_cac_ratio\u0026#39;: ratio, \u0026#39;payback_period\u0026#39;: self.calculate_payback_period(user_cohort), \u0026#39;assessment\u0026#39;: self.assess_business_health(ratio), \u0026#39;recommendations\u0026#39;: self.generate_ltv_optimization_suggestions(ltv, cac) } def analyze_churn_patterns(self, user_activity_data): \u0026#34;\u0026#34;\u0026#34; åˆ†æç”¨æˆ·æµå¤±æ¨¡å¼ \u0026#34;\u0026#34;\u0026#34; churn_analysis = { \u0026#39;time_based_churn\u0026#39;: self.analyze_churn_by_time(user_activity_data), \u0026#39;behavioral_churn\u0026#39;: self.analyze_churn_by_behavior(user_activity_data), \u0026#39;segment_based_churn\u0026#39;: self.analyze_churn_by_segments(user_activity_data), \u0026#39;predictive_churn\u0026#39;: self.build_churn_prediction_model(user_activity_data) } # æµå¤±åŸå› åˆ†æ churn_reasons = { \u0026#39;early_game_difficulty\u0026#39;: { \u0026#39;indicator\u0026#39;: \u0026#39;æ–°æ‰‹æ•™ç¨‹æœªå®Œæˆ\u0026#39;, \u0026#39;percentage\u0026#39;: 0.35, \u0026#39;intervention\u0026#39;: \u0026#39;ä¼˜åŒ–æ–°æ‰‹å¼•å¯¼éš¾åº¦\u0026#39; }, \u0026#39;lack_of_content\u0026#39;: { \u0026#39;indicator\u0026#39;: \u0026#39;ä¸»çº¿ä»»åŠ¡å®Œæˆåæµå¤±\u0026#39;, \u0026#39;percentage\u0026#39;: 0.28, \u0026#39;intervention\u0026#39;: \u0026#39;åŠ å¿«å†…å®¹æ›´æ–°é¢‘ç‡\u0026#39; }, \u0026#39;social_factors\u0026#39;: { \u0026#39;indicator\u0026#39;: \u0026#39;å¥½å‹æµå¤±åè·Ÿéšæµå¤±\u0026#39;, \u0026#39;percentage\u0026#39;: 0.22, \u0026#39;intervention\u0026#39;: \u0026#39;å¢å¼ºç¤¾äº¤ç³»ç»Ÿ\u0026#39; }, \u0026#39;performance_issues\u0026#39;: { \u0026#39;indicator\u0026#39;: \u0026#39;è®¾å¤‡é€‚é…é—®é¢˜\u0026#39;, \u0026#39;percentage\u0026#39;: 0.15, \u0026#39;intervention\u0026#39;: \u0026#39;æ€§èƒ½ä¼˜åŒ–å’Œè®¾å¤‡æ”¯æŒ\u0026#39; } } return { \u0026#39;churn_patterns\u0026#39;: churn_analysis, \u0026#39;root_causes\u0026#39;: churn_reasons, \u0026#39;retention_strategies\u0026#39;: self.design_retention_interventions(churn_analysis), \u0026#39;roi_impact\u0026#39;: self.calculate_churn_financial_impact(churn_analysis) } å®æ—¶ç›‘æ§ä¸é¢„è­¦ç³»ç»Ÿ\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 // å®æ—¶ç›‘æ§é…ç½®ç³»ç»Ÿ const realTimeMonitoring = { // æ ¸å¿ƒä¸šåŠ¡æŒ‡æ ‡ coreMetrics: { userMetrics: { onlineUsers: { alertThreshold: { drop: { value: 0.20, timeWindow: \u0026#39;1h\u0026#39; }, spike: { value: 0.50, timeWindow: \u0026#39;30m\u0026#39; } }, dashboard: \u0026#39;å®æ—¶åœ¨çº¿ç”¨æˆ·æ•°\u0026#39;, notificationChannels: [\u0026#39;slack\u0026#39;, \u0026#39;email\u0026#39;, \u0026#39;sms\u0026#39;] }, newRegistrations: { alertThreshold: { drop: { value: 0.30, timeWindow: \u0026#39;2h\u0026#39; }, zero: { timeWindow: \u0026#39;1h\u0026#39; } }, dashboard: \u0026#39;æ–°ç”¨æˆ·æ³¨å†Œè¶‹åŠ¿\u0026#39;, notificationChannels: [\u0026#39;slack\u0026#39;, \u0026#39;email\u0026#39;] }, crashRate: { alertThreshold: { spike: { value: 0.05, timeWindow: \u0026#39;15m\u0026#39; }, sustained: { value: 0.02, timeWindow: \u0026#39;1h\u0026#39; } }, dashboard: \u0026#39;åº”ç”¨å´©æºƒç‡ç›‘æ§\u0026#39;, notificationChannels: [\u0026#39;slack\u0026#39;, \u0026#39;sms\u0026#39;, \u0026#39;pager\u0026#39;] } }, revenueMetrics: { transactions: { alertThreshold: { failure: { value: 0.05, timeWindow: \u0026#39;10m\u0026#39; }, volume_drop: { value: 0.25, timeWindow: \u0026#39;1h\u0026#39; } }, dashboard: \u0026#39;äº¤æ˜“æˆåŠŸç‡\u0026#39;, notificationChannels: [\u0026#39;slack\u0026#39;, \u0026#39;sms\u0026#39;, \u0026#39;email\u0026#39;] }, revenuePerMinute: { alertThreshold: { drop: { value: 0.30, timeWindow: \u0026#39;30m\u0026#39; } }, dashboard: \u0026#39;å®æ—¶æ”¶å…¥ç›‘æ§\u0026#39;, notificationChannels: [\u0026#39;slack\u0026#39;, \u0026#39;email\u0026#39;] }, paymentGateways: { monitoring: \u0026#39;å„æ”¯ä»˜æ¸ é“çŠ¶æ€\u0026#39;, alertThreshold: { failure: { value: 0.10, timeWindow: \u0026#39;5m\u0026#39; } }, dashboard: \u0026#39;æ”¯ä»˜ç½‘å…³å¥åº·çŠ¶æ€\u0026#39; } }, technicalMetrics: { serverLoad: { cpu: { alertThreshold: 0.85, timeWindow: \u0026#39;5m\u0026#39; }, memory: { alertThreshold: 0.90, timeWindow: \u0026#39;5m\u0026#39; }, disk: { alertThreshold: 0.95, timeWindow: \u0026#39;1h\u0026#39; } }, database: { connectionPool: { alertThreshold: 0.90, timeWindow: \u0026#39;1m\u0026#39; }, queryTime: { alertThreshold: 2000, timeWindow: \u0026#39;5m\u0026#39; }, deadlocks: { alertThreshold: 1, timeWindow: \u0026#39;1m\u0026#39; } }, network: { latency: { alertThreshold: 500, timeWindow: \u0026#39;5m\u0026#39; }, errorRate: { alertThreshold: 0.02, timeWindow: \u0026#39;5m\u0026#39; }, bandwidth: { alertThreshold: 0.90, timeWindow: \u0026#39;10m\u0026#39; } } } }, // æ™ºèƒ½å¼‚å¸¸æ£€æµ‹ anomalyDetection: { statisticalAnalysis: { method: \u0026#39;Z-score + Moving Average\u0026#39;, sensitivity: 0.95, timeWindows: [\u0026#39;5m\u0026#39;, \u0026#39;15m\u0026#39;, \u0026#39;1h\u0026#39;, \u0026#39;6h\u0026#39;, \u0026#39;24h\u0026#39;], seasonalAdjustment: true }, machineLearning: { models: [\u0026#39;Isolation Forest\u0026#39;, \u0026#39;LSTM Autoencoder\u0026#39;], trainingDataWindow: \u0026#39;30 days\u0026#39;, retrainingFrequency: \u0026#39;daily\u0026#39;, featureEngineering: [ \u0026#39;trend_analysis\u0026#39;, \u0026#39;seasonality_decomposition\u0026#39;, \u0026#39;correlation_analysis\u0026#39;, \u0026#39;external_factors\u0026#39; ] }, alertCorrelation: { groupRelated: true, deduplicationWindow: \u0026#39;15m\u0026#39;, severityClassification: [\u0026#39;critical\u0026#39;, \u0026#39;high\u0026#39;, \u0026#39;medium\u0026#39;, \u0026#39;low\u0026#39;], autoResolution: { enabled: true, conditions: [\u0026#39;temporary_spike\u0026#39;, \u0026#39;known_flapping\u0026#39;] } } }, // åº”æ€¥å“åº”æµç¨‹ incidentResponse: { escalationMatrix: { p0_critical: { responseTime: \u0026#39;5åˆ†é’Ÿ\u0026#39;, escalationChain: [\u0026#39;oncall_engineer\u0026#39;, \u0026#39;team_lead\u0026#39;, \u0026#39;engineering_manager\u0026#39;], communicationChannels: [\u0026#39;phone\u0026#39;, \u0026#39;slack\u0026#39;, \u0026#39;email\u0026#39;], stakeholderNotification: true }, p1_high: { responseTime: \u0026#39;15åˆ†é’Ÿ\u0026#39;, escalationChain: [\u0026#39;oncall_engineer\u0026#39;, \u0026#39;team_lead\u0026#39;], communicationChannels: [\u0026#39;slack\u0026#39;, \u0026#39;email\u0026#39;], stakeholderNotification: false }, p2_medium: { responseTime: \u0026#39;1å°æ—¶\u0026#39;, escalationChain: [\u0026#39;oncall_engineer\u0026#39;], communicationChannels: [\u0026#39;slack\u0026#39;], stakeholderNotification: false } }, automatedResponses: { autoScaling: { trigger: \u0026#39;CPU \u0026gt; 80%\u0026#39;, action: \u0026#39;å¢åŠ æœåŠ¡å™¨å®ä¾‹\u0026#39;, rollback: \u0026#39;è‡ªåŠ¨å›æ»šé…ç½®\u0026#39; }, circuitBreaker: { trigger: \u0026#39;é”™è¯¯ç‡ \u0026gt; 10%\u0026#39;, action: \u0026#39;æ–­è·¯å™¨å¼€å¯\u0026#39;, recovery: \u0026#39;é€æ­¥æ¢å¤æµé‡\u0026#39; }, cacheWarmup: { trigger: \u0026#39;ç¼“å­˜å‘½ä¸­ç‡ä¸‹é™\u0026#39;, action: \u0026#39;é¢„çƒ­ç¼“å­˜æ•°æ®\u0026#39;, monitoring: \u0026#39;å®æ—¶ç¼“å­˜çŠ¶æ€\u0026#39; } } } }; 4.2 A/Bæµ‹è¯•ä¸ä¼˜åŒ– ç‰ˆæœ¬å®éªŒè®¾è®¡\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 # A/Bæµ‹è¯•å®éªŒè®¾è®¡ç³»ç»Ÿ class ABTestExperimentDesigner: def __init__(self): self.test_types = { \u0026#39;ui_ux_tests\u0026#39;: { \u0026#39;examples\u0026#39;: [ \u0026#39;æŒ‰é’®é¢œè‰²å’Œä½ç½®\u0026#39;, \u0026#39;å¯¼èˆªç»“æ„ä¼˜åŒ–\u0026#39;, \u0026#39;æ¸¸æˆç•Œé¢å¸ƒå±€\u0026#39;, \u0026#39;æ•™ç¨‹æµç¨‹æ”¹è¿›\u0026#39; ], \u0026#39;success_metrics\u0026#39;: [\u0026#39;è½¬åŒ–ç‡\u0026#39;, \u0026#39;å®Œæˆç‡\u0026#39;, \u0026#39;ç”¨æˆ·æ»¡æ„åº¦\u0026#39;], \u0026#39;test_duration\u0026#39;: \u0026#39;7-14å¤©\u0026#39; }, \u0026#39;monetization_tests\u0026#39;: { \u0026#39;examples\u0026#39;: [ \u0026#39;å®šä»·ç­–ç•¥è°ƒæ•´\u0026#39;, \u0026#39;é“å…·åŒ…ç»„åˆ\u0026#39;, \u0026#39;è®¢é˜…æ¨¡å¼å¯¹æ¯”\u0026#39;, \u0026#39;å¹¿å‘Šå±•ç¤ºé¢‘ç‡\u0026#39; ], \u0026#39;success_metrics\u0026#39;: [\u0026#39;ARPPU\u0026#39;, \u0026#39;ä»˜è´¹è½¬åŒ–ç‡\u0026#39;, \u0026#39;LTV\u0026#39;], \u0026#39;test_duration\u0026#39;: \u0026#39;14-30å¤©\u0026#39; }, \u0026#39;gameplay_tests\u0026#39;: { \u0026#39;examples\u0026#39;: [ \u0026#39;éš¾åº¦æ›²çº¿è°ƒæ•´\u0026#39;, \u0026#39;å¥–åŠ±æœºåˆ¶ä¼˜åŒ–\u0026#39;, \u0026#39;æ–°åŠŸèƒ½æ¥å—åº¦\u0026#39;, \u0026#39;æ¸¸æˆèŠ‚å¥æ§åˆ¶\u0026#39; ], \u0026#39;success_metrics\u0026#39;: [\u0026#39;ç•™å­˜ç‡\u0026#39;, \u0026#39;å‚ä¸åº¦\u0026#39;, \u0026#39;æ¸¸æˆæ—¶é•¿\u0026#39;], \u0026#39;test_duration\u0026#39;: \u0026#39;14-21å¤©\u0026#39; } } def design_experiment(self, hypothesis, metrics): \u0026#34;\u0026#34;\u0026#34; è®¾è®¡A/Bæµ‹è¯•å®éªŒ \u0026#34;\u0026#34;\u0026#34; experiment_design = { \u0026#39;hypothesis\u0026#39;: hypothesis, \u0026#39;primary_metric\u0026#39;: metrics[\u0026#39;primary\u0026#39;], \u0026#39;secondary_metrics\u0026#39;: metrics[\u0026#39;secondary\u0026#39;], \u0026#39;sample_size_calculation\u0026#39;: self.calculate_sample_size( baseline=metrics[\u0026#39;baseline\u0026#39;], minimum_detectable_effect=metrics[\u0026#39;mde\u0026#39;], statistical_power=0.80, significance_level=0.05 ), \u0026#39;randomization_strategy\u0026#39;: { \u0026#39;method\u0026#39;: \u0026#39;user_id_based\u0026#39;, \u0026#39;stratification\u0026#39;: [\u0026#39;country\u0026#39;, \u0026#39;device_type\u0026#39;, \u0026#39;acquisition_channel\u0026#39;], \u0026#39;allocation_ratio\u0026#39;: \u0026#39;50/50\u0026#39; }, \u0026#39;duration_calculation\u0026#39;: self.estimate_test_duration( daily_users=metrics[\u0026#39;daily_users\u0026#39;], required_sample_size=self.calculate_sample_size( baseline=metrics[\u0026#39;baseline\u0026#39;], minimum_detectable_effect=metrics[\u0026#39;mde\u0026#39;] ) ), \u0026#39;success_criteria\u0026#39;: { \u0026#39;statistical_significance\u0026#39;: 0.05, \u0026#39;minimum_effect_size\u0026#39;: metrics[\u0026#39;mde\u0026#39;], \u0026#39;practical_significance\u0026#39;: self.determine_practical_significance(metrics), \u0026#39;guardrail_metrics\u0026#39;: self.define_guardrail_metrics(metrics) } } return experiment_design def analyze_results(self, test_data): \u0026#34;\u0026#34;\u0026#34; åˆ†æA/Bæµ‹è¯•ç»“æœ \u0026#34;\u0026#34;\u0026#34; control_group = test_data[\u0026#39;control\u0026#39;] variant_group = test_data[\u0026#39;variant\u0026#39;] # åŸºç¡€ç»Ÿè®¡è®¡ç®— results = { \u0026#39;sample_sizes\u0026#39;: { \u0026#39;control\u0026#39;: len(control_group), \u0026#39;variant\u0026#39;: len(variant_group) }, \u0026#39;conversion_rates\u0026#39;: { \u0026#39;control\u0026#39;: control_group.mean(), \u0026#39;variant\u0026#39;: variant_group.mean(), \u0026#39;absolute_difference\u0026#39;: variant_group.mean() - control_group.mean(), \u0026#39;relative_change\u0026#39;: (variant_group.mean() - control_group.mean()) / control_group.mean() }, \u0026#39;statistical_tests\u0026#39;: self.perform_statistical_tests(control_group, variant_group), \u0026#39;confidence_intervals\u0026#39;: self.calculate_confidence_intervals( control_group, variant_group, confidence_level=0.95 ), \u0026#39;effect_size\u0026#39;: self.calculate_cohens_d(control_group, variant_group), \u0026#39;segment_analysis\u0026#39;: self.analyze_segment_results(test_data[\u0026#39;segments\u0026#39;]), \u0026#39;longitudinal_analysis\u0026#39;: self.analyze_time_series_effects(test_data[\u0026#39;daily_metrics\u0026#39;]) } # å•†ä¸šå½±å“è¯„ä¼° business_impact = self.assess_business_impact(results, test_data[\u0026#39;business_context\u0026#39;]) # æ¨èå†³ç­– recommendation = self.make_recommendation(results, business_impact) return { \u0026#39;statistical_results\u0026#39;: results, \u0026#39;business_impact\u0026#39;: business_impact, \u0026#39;recommendation\u0026#39;: recommendation, \u0026#39;next_steps\u0026#39;: self.suggest_next_steps(recommendation), \u0026#39;learnings\u0026#39;: self.extract_learnings(results) } def create_roadmap(self, completed_experiments): \u0026#34;\u0026#34;\u0026#34; åˆ›å»ºä¼˜åŒ–è·¯çº¿å›¾ \u0026#34;\u0026#34;\u0026#34; insights = self.extract_insights_from_experiments(completed_experiments) roadmap = { \u0026#39;high_impact_opportunities\u0026#39;: [ { \u0026#39;priority\u0026#39;: 1, \u0026#39;experiment\u0026#39;: \u0026#39;å®šä»·ç­–ç•¥ä¼˜åŒ–\u0026#39;, \u0026#39;expected_lift\u0026#39;: \u0026#39;15-25%\u0026#39;, \u0026#39;implementation_effort\u0026#39;: \u0026#39;medium\u0026#39;, \u0026#39;timeline\u0026#39;: \u0026#39;4-6å‘¨\u0026#39; }, { \u0026#39;priority\u0026#39;: 2, \u0026#39;experiment\u0026#39;: \u0026#39;æ–°æ‰‹æ•™ç¨‹æ”¹è¿›\u0026#39;, \u0026#39;expected_lift\u0026#39;: \u0026#39;8-12%\u0026#39;, \u0026#39;implementation_effort\u0026#39;: \u0026#39;low\u0026#39;, \u0026#39;timeline\u0026#39;: \u0026#39;2-3å‘¨\u0026#39; } ], \u0026#39;medium_impact_opportunities\u0026#39;: [ { \u0026#39;priority\u0026#39;: 3, \u0026#39;experiment\u0026#39;: \u0026#39;ç¤¾äº¤åŠŸèƒ½å¼ºåŒ–\u0026#39;, \u0026#39;expected_lift\u0026#39;: \u0026#39;5-8%\u0026#39;, \u0026#39;implementation_effort\u0026#39;: \u0026#39;high\u0026#39;, \u0026#39;timeline\u0026#39;: \u0026#39;8-10å‘¨\u0026#39; } ], \u0026#39;long_term_experiments\u0026#39;: [ { \u0026#39;priority\u0026#39;: 4, \u0026#39;experiment\u0026#39;: \u0026#39;æ¸¸æˆæœºåˆ¶æ·±åº¦ä¼˜åŒ–\u0026#39;, \u0026#39;expected_lift\u0026#39;: \u0026#39;10-15%\u0026#39;, \u0026#39;implementation_effort\u0026#39;: \u0026#39;very_high\u0026#39;, \u0026#39;timeline\u0026#39;: \u0026#39;3-4ä¸ªæœˆ\u0026#39; } ] } return roadmap äº”ã€é£é™©ç®¡ç†ä¸åˆè§„ 5.1 æ³•å¾‹åˆè§„ç®¡ç† å…¨çƒæ•°æ®éšç§åˆè§„\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 // æ•°æ®éšç§åˆè§„ç®¡ç†ç³»ç»Ÿ const dataPrivacyCompliance = { // GDPRåˆè§„ï¼ˆæ¬§ç›Ÿï¼‰ gdprCompliance: { consentManagement: { consentTypes: [ { type: \u0026#39;essential_cookies\u0026#39;, required: true, description: \u0026#39;ç½‘ç«™æ­£å¸¸è¿è¡Œå¿…éœ€çš„cookie\u0026#39;, examples: [\u0026#39;ç”¨æˆ·è®¤è¯\u0026#39;, \u0026#39;å®‰å…¨éªŒè¯\u0026#39;, \u0026#39;è´­ç‰©è½¦åŠŸèƒ½\u0026#39;] }, { type: \u0026#39;analytics_cookies\u0026#39;, required: false, description: \u0026#39;ç”¨äºç½‘ç«™åˆ†æå’Œæ”¹è¿›\u0026#39;, examples: [\u0026#39;Google Analytics\u0026#39;, \u0026#39;è‡ªå®šä¹‰åˆ†æå·¥å…·\u0026#39;] }, { type: \u0026#39;marketing_cookies\u0026#39;, required: false, description: \u0026#39;ç”¨äºä¸ªæ€§åŒ–è¥é”€å’Œå¹¿å‘Š\u0026#39;, examples: [\u0026#39;Facebook Pixel\u0026#39;, \u0026#39;Google Ads\u0026#39;, \u0026#39;é‡å®šå‘å¹¿å‘Š\u0026#39;] }, { type: \u0026#39;functional_cookies\u0026#39;, required: false, description: \u0026#39;æä¾›å¢å¼ºåŠŸèƒ½å’Œä¸ªæ€§åŒ–ä½“éªŒ\u0026#39;, examples: [\u0026#39;èŠå¤©åŠŸèƒ½\u0026#39;, \u0026#39;è§†é¢‘æ’­æ”¾\u0026#39;, \u0026#39;ç¤¾äº¤åˆ†äº«\u0026#39;] } ], consentImplementation: { consentBanner: { display: \u0026#39;é¦–æ¬¡è®¿é—®æ—¶æ˜¾ç¤º\u0026#39;, content: \u0026#39;æ¸…æ™°çš„cookieä½¿ç”¨è¯´æ˜\u0026#39;, options: \u0026#39;æ¥å—å…¨éƒ¨\u0026#39; + \u0026#39;è‡ªå®šä¹‰è®¾ç½®\u0026#39; + \u0026#39;æ‹’ç»å…¨éƒ¨\u0026#39;, style: \u0026#39;éä¾µå…¥å¼è®¾è®¡ï¼Œæ˜“äºç†è§£\u0026#39; }, consentDashboard: { access: \u0026#39;ç”¨æˆ·å¯éšæ—¶æ›´æ”¹åå¥½\u0026#39;, interface: \u0026#39;ç›´è§‚çš„è®¾ç½®é¢æ¿\u0026#39;, granularity: \u0026#39;ç»†ç²’åº¦çš„cookieç±»åˆ«æ§åˆ¶\u0026#39; } } }, dataSubjectRights: { rightsFramework: { rightOfAccess: { description: \u0026#39;è·å–ä¸ªäººæ•°æ®å‰¯æœ¬\u0026#39;, implementation: \u0026#39;è‡ªåŠ©ä¸‹è½½+äººå·¥æ”¯æŒ\u0026#39;, responseTime: \u0026#39;30å¤©å†…\u0026#39;, format: \u0026#39;æœºå™¨å¯è¯»æ ¼å¼ï¼ˆJSON/CSVï¼‰\u0026#39; }, rightToRectification: { description: \u0026#39;æ›´æ­£ä¸å‡†ç¡®æ•°æ®\u0026#39;, implementation: \u0026#39;åœ¨çº¿ç¼–è¾‘+å®¡æ ¸æµç¨‹\u0026#39;, responseTime: \u0026#39;30å¤©å†…\u0026#39;, verification: \u0026#39;èº«ä»½éªŒè¯è¦æ±‚\u0026#39; }, rightToErasure: { description: \u0026#39;åˆ é™¤ä¸ªäººæ•°æ®ï¼ˆè¢«é—å¿˜æƒï¼‰\u0026#39;, implementation: \u0026#39;ä¸€é”®åˆ é™¤+ç¡®è®¤æµç¨‹\u0026#39;, exceptions: [\u0026#39;æ³•å¾‹ä¹‰åŠ¡\u0026#39;, \u0026#39;å…¬å…±åˆ©ç›Š\u0026#39;, \u0026#39;ç§‘å­¦ç ”ç©¶\u0026#39;], responseTime: \u0026#39;30å¤©å†…\u0026#39; }, rightToPortability: { description: \u0026#39;æ•°æ®è¿ç§»æƒ\u0026#39;, implementation: \u0026#39;æ•°æ®å¯¼å‡º+APIæ¥å£\u0026#39;, format: \u0026#39;ç»“æ„åŒ–ã€é€šç”¨æ ¼å¼\u0026#39;, responseTime: \u0026#39;30å¤©å†…\u0026#39; } } } }, // CCPAåˆè§„ï¼ˆåŠ å·ï¼‰ ccpaCompliance: { privacyRights: { rightToKnow: { description: \u0026#39;äº†è§£æ”¶é›†çš„ä¸ªäººæ•°æ®ç±»åˆ«\u0026#39;, implementation: \u0026#39;éšç§ä¸­å¿ƒ+æ•°æ®æ¸…å•\u0026#39;, frequency: \u0026#39;12ä¸ªæœˆå†…ä¸¤æ¬¡å…è´¹è¯·æ±‚\u0026#39;, responseTime: \u0026#39;45å¤©å†…\u0026#39; }, rightToDelete: { description: \u0026#39;è¦æ±‚åˆ é™¤ä¸ªäººæ•°æ®\u0026#39;, implementation: \u0026#39;åˆ é™¤è¯·æ±‚å¤„ç†ç³»ç»Ÿ\u0026#39;, verification: \u0026#39;èº«ä»½éªŒè¯æµç¨‹\u0026#39;, exceptions: [\u0026#39;å®Œæˆäº¤æ˜“\u0026#39;, \u0026#39;å®‰å…¨ç»´æŠ¤\u0026#39;, \u0026#39;ç§‘å­¦ç ”ç©¶\u0026#39;] }, rightToOptOut: { description: \u0026#39;é€‰æ‹©ä¸å‡ºå”®ä¸ªäººä¿¡æ¯\u0026#39;, implementation: \u0026#39;Do Not SellæŒ‰é’®\u0026#39;, signalDetection: \u0026#39;æµè§ˆå™¨éšç§ä¿¡å·\u0026#39;, effect: \u0026#39;åœæ­¢æ•°æ®å‡ºå”®å’Œå…±äº«\u0026#39; } }, businessPractices: { dataMinimization: { principle: \u0026#39;åªæ”¶é›†å¿…è¦æ•°æ®\u0026#39;, implementation: \u0026#39;æ•°æ®æ”¶é›†æ¸…å•\u0026#39;, reviewFrequency: \u0026#39;å­£åº¦è¯„ä¼°\u0026#39; }, purposeLimitation: { principle: \u0026#39;æ˜ç¡®æ”¶é›†ç›®çš„\u0026#39;, implementation: \u0026#39;ç›®çš„å£°æ˜æ–‡æ¡£\u0026#39;, changeManagement: \u0026#39;ç›®çš„å˜æ›´é€šçŸ¥\u0026#39; } } }, // æ•°æ®æœ¬åœ°åŒ–è¦æ±‚ dataLocalization: { requirements: { china: { personalInformationProtectionLaw: true, dataCrossBorder: \u0026#39;å®‰å…¨è¯„ä¼°è¦æ±‚\u0026#39;, localStorage: \u0026#39;å…³é”®åŸºç¡€è®¾æ–½æ•°æ®\u0026#39;, consentRequirement: \u0026#39;å•ç‹¬åŒæ„æœºåˆ¶\u0026#39; }, russia: { dataLocalizationLaw: true, russianCitizenData: \u0026#39;å¿…é¡»åœ¨ä¿„å¢ƒå†…å­˜å‚¨\u0026#39;, governmentAccess: \u0026#39;å¯èƒ½éœ€è¦æ•°æ®è®¿é—®æ¥å£\u0026#39; }, india: { dataProtectionBill: \u0026#39;å³å°†å®æ–½\u0026#39;, sensitiveData: \u0026#39;æœ¬åœ°å­˜å‚¨è¦æ±‚\u0026#39;, crossBorderTransfer: \u0026#39;ç‰¹å®šæ¡ä»¶é™åˆ¶\u0026#39; } } } }; 5.2 è´¢åŠ¡é£é™©æ§åˆ¶ æ”¶ç›Šé¢„æµ‹ä¸é¢„ç®—ç®¡ç†\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 174 175 176 177 178 179 180 181 182 183 184 185 186 187 188 189 190 191 192 193 194 195 196 197 198 199 200 201 202 203 # è´¢åŠ¡é£é™©ç®¡ç†å·¥å…· class FinancialRiskManager: def __init__(self): self.risk_categories = { \u0026#39;revenue_risks\u0026#39;: { \u0026#39;market_saturation\u0026#39;: { probability: 0.30, impact: \u0026#39;high\u0026#39;, mitigation: \u0026#39;å·®å¼‚åŒ–äº§å“å®šä½\u0026#39;, monitoring: \u0026#39;å¸‚åœºä»½é¢è¶‹åŠ¿åˆ†æ\u0026#39; }, \u0026#39;user_churn\u0026#39;: { probability: 0.45, impact: \u0026#39;medium\u0026#39;, mitigation: \u0026#39;ç”¨æˆ·ç•™å­˜ç­–ç•¥\u0026#39;, monitoring: \u0026#39;ç•™å­˜ç‡é¢„è­¦ç³»ç»Ÿ\u0026#39; }, \u0026#39;monetization_failure\u0026#39;: { probability: 0.25, impact: \u0026#39;high\u0026#39;, mitigation: \u0026#39;å¤šå…ƒåŒ–æ”¶å…¥æ¨¡å¼\u0026#39;, monitoring: \u0026#39;ä»˜è´¹è½¬åŒ–ç‡åˆ†æ\u0026#39; } }, \u0026#39;cost_risks\u0026#39;: { \u0026#39;development_overrun\u0026#39;: { probability: 0.35, impact: \u0026#39;medium\u0026#39;, mitigation: \u0026#39;æ•æ·å¼€å‘ç®¡ç†\u0026#39;, monitoring: \u0026#39;å¼€å‘è¿›åº¦è·Ÿè¸ª\u0026#39; }, \u0026#39;marketing_inefficiency\u0026#39;: { probability: 0.40, impact: \u0026#39;medium\u0026#39;, mitigation: \u0026#39;ROIä¼˜åŒ–ç­–ç•¥\u0026#39;, monitoring: \u0026#39;æ¸ é“æ•ˆæœåˆ†æ\u0026#39; }, \u0026#39;infrastructure_scaling\u0026#39;: { probability: 0.20, impact: \u0026#39;low\u0026#39;, mitigation: \u0026#39;å¼¹æ€§æ¶æ„è®¾è®¡\u0026#39;, monitoring: \u0026#39;èµ„æºä½¿ç”¨ç‡ç›‘æ§\u0026#39; } }, \u0026#39;market_risks\u0026#39;: { \u0026#39;competition_increase\u0026#39;: { probability: 0.50, impact: \u0026#39;medium\u0026#39;, mitigation: \u0026#39;æŒç»­äº§å“åˆ›æ–°\u0026#39;, monitoring: \u0026#39;ç«å“åˆ†ææŠ¥å‘Š\u0026#39; }, \u0026#39;regulatory_changes\u0026#39;: { probability: 0.15, impact: \u0026#39;high\u0026#39;, mitigation: \u0026#39;åˆè§„ç›‘æ§ä½“ç³»\u0026#39;, monitoring: \u0026#39;æ”¿ç­–æ³•è§„è·Ÿè¸ª\u0026#39; }, \u0026#39;economic_downturn\u0026#39;: { probability: 0.25, impact: \u0026#39;high\u0026#39;, mitigation: \u0026#39;æˆæœ¬å¼¹æ€§ç»“æ„\u0026#39;, monitoring: \u0026#39;ç»æµæŒ‡æ ‡é¢„è­¦\u0026#39; } } } def calculate_revenue_projection(self, market_analysis): \u0026#34;\u0026#34;\u0026#34; è®¡ç®—æ”¶å…¥é¢„æµ‹æ¨¡å‹ \u0026#34;\u0026#34;\u0026#34; # åŸºç¡€å‡è®¾ assumptions = { \u0026#39;market_size\u0026#39;: market_analysis[\u0026#39;total_addressable_market\u0026#39;], \u0026#39;market_penetration\u0026#39;: market_analysis[\u0026#39;realistic_penetration_rate\u0026#39;], \u0026#39;user_growth_rate\u0026#39;: market_analysis[\u0026#39;projected_growth_rate\u0026#39;], \u0026#39;monetization_rate\u0026#39;: market_analysis[\u0026#39;average_conversion_rate\u0026#39;], \u0026#39;arppu\u0026#39;: market_analysis[\u0026#39;average_revenue_per_paying_user\u0026#39;] } # å¤šåœºæ™¯é¢„æµ‹ scenarios = { \u0026#39;conservative\u0026#39;: { \u0026#39;penetration_rate\u0026#39;: assumptions[\u0026#39;market_penetration\u0026#39;] * 0.7, \u0026#39;growth_rate\u0026#39;: assumptions[\u0026#39;user_growth_rate\u0026#39;] * 0.8, \u0026#39;monetization_rate\u0026#39;: assumptions[\u0026#39;monetization_rate\u0026#39;] * 0.9, \u0026#39;confidence\u0026#39;: 0.80 }, \u0026#39;realistic\u0026#39;: { \u0026#39;penetration_rate\u0026#39;: assumptions[\u0026#39;market_penetration\u0026#39;], \u0026#39;growth_rate\u0026#39;: assumptions[\u0026#39;user_growth_rate\u0026#39;], \u0026#39;monetization_rate\u0026#39;: assumptions[\u0026#39;monetization_rate\u0026#39;], \u0026#39;confidence\u0026#39;: 0.50 }, \u0026#39;optimistic\u0026#39;: { \u0026#39;penetration_rate\u0026#39;: assumptions[\u0026#39;market_penetration\u0026#39;] * 1.3, \u0026#39;growth_rate\u0026#39;: assumptions[\u0026#39;user_growth_rate\u0026#39;] * 1.2, \u0026#39;monetization_rate\u0026#39;: assumptions[\u0026#39;monetization_rate\u0026#39;] * 1.1, \u0026#39;confidence\u0026#39;: 0.20 } } projections = {} for scenario, params in scenarios.items(): monthly_projections = [] cumulative_users = 0 for month in range(1, 37): # 3å¹´é¢„æµ‹ if month == 1: new_users = (assumptions[\u0026#39;market_size\u0026#39;] * params[\u0026#39;penetration_rate\u0026#39;] / 12) else: new_users = cumulative_users * params[\u0026#39;growth_rate\u0026#39;] / 12 cumulative_users += new_users paying_users = cumulative_users * params[\u0026#39;monetization_rate\u0026#39;] monthly_revenue = paying_users * assumptions[\u0026#39;arppu\u0026#39;] monthly_projections.append({ \u0026#39;month\u0026#39;: month, \u0026#39;new_users\u0026#39;: new_users, \u0026#39;total_users\u0026#39;: cumulative_users, \u0026#39;paying_users\u0026#39;: paying_users, \u0026#39;monthly_revenue\u0026#39;: monthly_revenue, \u0026#39;cumulative_revenue\u0026#39;: sum(p[\u0026#39;monthly_revenue\u0026#39;] for p in monthly_projections) }) projections[scenario] = { \u0026#39;monthly_data\u0026#39;: monthly_projections, \u0026#39;year_1_revenue\u0026#39;: monthly_projections[11][\u0026#39;cumulative_revenue\u0026#39;], \u0026#39;year_2_revenue\u0026#39;: monthly_projections[23][\u0026#39;cumulative_revenue\u0026#39;], \u0026#39;year_3_revenue\u0026#39;: monthly_projections[35][\u0026#39;cumulative_revenue\u0026#39;], \u0026#39;confidence\u0026#39;: params[\u0026#39;confidence\u0026#39;] } return { \u0026#39;assumptions\u0026#39;: assumptions, \u0026#39;scenarios\u0026#39;: projections, \u0026#39;sensitivity_analysis\u0026#39;: self.perform_sensitivity_analysis(projections), \u0026#39;risk_adjusted_projection\u0026#39;: self.apply_risk_adjustments(projections) } def create_risk_mitigation_plan(self, risk_assessment): \u0026#34;\u0026#34;\u0026#34; åˆ›å»ºé£é™©ç¼“è§£è®¡åˆ’ \u0026#34;\u0026#34;\u0026#34; mitigation_strategies = { \u0026#39;revenue_diversification\u0026#39;: { \u0026#39;actions\u0026#39;: [ \u0026#39;å¤šå¹³å°å‘è¡Œç­–ç•¥\u0026#39;, \u0026#39;è®¢é˜…æ¨¡å¼+IAPç»„åˆ\u0026#39;, \u0026#39;æˆæƒå’ŒIPè¡ç”Ÿ\u0026#39;, \u0026#39;ç”µç«èµ›äº‹æ”¶å…¥\u0026#39; ], \u0026#39;implementation_timeline\u0026#39;: \u0026#39;6-12ä¸ªæœˆ\u0026#39;, \u0026#39;expected_impact\u0026#39;: \u0026#39;é™ä½æ”¶å…¥ä¾èµ–æ€§30%\u0026#39; }, \u0026#39;cost_optimization\u0026#39;: { \u0026#39;actions\u0026#39;: [ \u0026#39;å¼¹æ€§äº‘è®¡ç®—æ¶æ„\u0026#39;, \u0026#39;è‡ªåŠ¨åŒ–è¿è¥æµç¨‹\u0026#39;, \u0026#39;ç²¾å‡†è¥é”€æŠ•æ”¾\u0026#39;, \u0026#39;å¤–åŒ…éæ ¸å¿ƒä¸šåŠ¡\u0026#39; ], \u0026#39;implementation_timeline\u0026#39;: \u0026#39;3-6ä¸ªæœˆ\u0026#39;, \u0026#39;expected_impact\u0026#39;: \u0026#39;é™ä½è¿è¥æˆæœ¬25%\u0026#39; }, \u0026#39;user_retention\u0026#39;: { \u0026#39;actions\u0026#39;: [ \u0026#39;ä¸ªæ€§åŒ–æ¨èç³»ç»Ÿ\u0026#39;, \u0026#39;ç¤¾åŒºè¿è¥å¢å¼º\u0026#39;, \u0026#39;å®šæœŸå†…å®¹æ›´æ–°\u0026#39;, \u0026#39;å®¢æˆ·æœåŠ¡ä¼˜åŒ–\u0026#39; ], \u0026#39;implementation_timeline\u0026#39;: \u0026#39;æŒç»­è¿›è¡Œ\u0026#39;, \u0026#39;expected_impact\u0026#39;: \u0026#39;æå‡ç”¨æˆ·ç•™å­˜ç‡20%\u0026#39; }, \u0026#39;regulatory_compliance\u0026#39;: { \u0026#39;actions\u0026#39;: [ \u0026#39;æ³•åŠ¡å›¢é˜Ÿå»ºè®¾\u0026#39;, \u0026#39;åˆè§„ç›‘æ§ä½“ç³»\u0026#39;, \u0026#39;æœ¬åœ°åŒ–æ³•å¾‹é¡¾é—®\u0026#39;, \u0026#39;å®šæœŸåˆè§„å®¡è®¡\u0026#39; ], \u0026#39;implementation_timeline\u0026#39;: \u0026#39;3-9ä¸ªæœˆ\u0026#39;, \u0026#39;expected_impact\u0026#39;: \u0026#39;é™ä½åˆè§„é£é™©80%\u0026#39; } } return { \u0026#39;risk_overview\u0026#39;: risk_assessment, \u0026#39;mitigation_strategies\u0026#39;: mitigation_strategies, \u0026#39;implementation_roadmap\u0026#39;: self.create_implementation_roadmap(mitigation_strategies), \u0026#39;success_metrics\u0026#39;: self.define_success_metrics(mitigation_strategies), \u0026#39;contingency_plans\u0026#39;: self.develop_contingency_scenarios() } æ€»ç»“ å…¨çƒæ¸¸æˆå‘è¡Œæ˜¯ä¸€ä¸ªå¤æ‚çš„ç³»ç»Ÿå·¥ç¨‹ï¼Œéœ€è¦ç»¼åˆè€ƒè™‘å¸‚åœºã€äº§å“ã€è¿è¥ã€åˆè§„ç­‰å¤šä¸ªç»´åº¦ã€‚æˆåŠŸçš„å‘è¡Œç­–ç•¥åº”è¯¥å…·å¤‡ä»¥ä¸‹ç‰¹å¾ï¼š\næ ¸å¿ƒæˆåŠŸè¦ç´ ï¼š\næ•°æ®é©±åŠ¨çš„å†³ç­–ï¼šåŸºäºæ·±åº¦å¸‚åœºåˆ†æå’Œç”¨æˆ·æ•°æ®åˆ¶å®šç­–ç•¥ æœ¬åœ°åŒ–æ·±åº¦ï¼šä¸ä»…è¯­è¨€ç¿»è¯‘ï¼Œæ›´è¦æ–‡åŒ–é€‚é…å’Œæœ¬åœ°åŒ–è¿è¥ å¤šæ¸ é“æ•´åˆï¼šçº¿ä¸Šçº¿ä¸‹ç»“åˆï¼Œå…¨æ¸ é“è¦†ç›–ç›®æ ‡ç”¨æˆ· æ•æ·ä¼˜åŒ–ï¼šå¿«é€Ÿå“åº”å¸‚åœºå˜åŒ–ï¼ŒæŒç»­ä¼˜åŒ–äº§å“ä½“éªŒ é£é™©ç®¡æ§ï¼šæå‰è¯†åˆ«å’Œè¯„ä¼°é£é™©ï¼Œåˆ¶å®šå®Œå–„çš„åº”å¯¹æ–¹æ¡ˆ å…³é”®å®æ–½å»ºè®®ï¼š\nå»ºç«‹å®Œå–„çš„æ•°æ®åˆ†æä½“ç³»ï¼Œå®æ—¶ç›‘æ§å…³é”®æŒ‡æ ‡ ç»„å»ºä¸“ä¸šçš„æœ¬åœ°åŒ–å›¢é˜Ÿï¼Œç¡®ä¿æ–‡åŒ–é€‚åº”æ€§ æ„å»ºå¤šå…ƒåŒ–çš„å‘è¡Œæ¸ é“ï¼Œé™ä½å•ä¸€æ¸ é“é£é™© åˆ¶å®šè¯¦ç»†çš„é£é™©ç®¡ç†è®¡åˆ’ï¼Œç¡®ä¿ä¸šåŠ¡è¿ç»­æ€§ ä¿æŒäº§å“åˆ›æ–°èƒ½åŠ›ï¼ŒæŒç»­æå‡ç”¨æˆ·ä½“éªŒ é€šè¿‡ç³»ç»ŸåŒ–çš„å‘è¡Œç­–ç•¥å’Œç²¾ç»†åŒ–è¿è¥ï¼Œæ¸¸æˆäº§å“å¯ä»¥åœ¨å…¨çƒå¸‚åœºè·å¾—æˆåŠŸï¼Œå®ç°å•†ä¸šä»·å€¼çš„æœ€å¤§åŒ–ã€‚\n","permalink":"/blog/articles/%E5%85%A8%E7%90%83%E6%B8%B8%E6%88%8F%E5%8F%91%E8%A1%8C%E7%AD%96%E7%95%A5%E4%BB%8E%E7%AB%8B%E9%A1%B9%E5%88%B0%E8%BF%90%E8%90%A5%E7%9A%84%E5%AE%8C%E6%95%B4%E6%8C%87%E5%8D%97/","summary":"\u003cp\u003eåœ¨å…¨çƒæ¸¸æˆå¸‚åœºç«äº‰æ—¥ç›Šæ¿€çƒˆçš„ä»Šå¤©ï¼ŒæˆåŠŸçš„å‘è¡Œç­–ç•¥å¯¹äºæ¸¸æˆäº§å“çš„æˆåŠŸè‡³å…³é‡è¦ã€‚æœ¬æ–‡å°†è¯¦ç»†ä»‹ç»ä»æ¸¸æˆç«‹é¡¹åˆ°å…¨çƒå‘è¡Œçš„å®Œæ•´ç­–ç•¥ä½“ç³»ï¼Œå¸®åŠ©å¼€å‘è€…å’Œå‘è¡Œå•†åœ¨æµ·å¤–å¸‚åœºå–å¾—æˆåŠŸã€‚\u003c/p\u003e\n\u003ch2 id=\"ä¸€å…¨çƒå¸‚åœºåˆ†æä¸é€‰æ‹©\"\u003eä¸€ã€å…¨çƒå¸‚åœºåˆ†æä¸é€‰æ‹©\u003c/h2\u003e\n\u003ch3 id=\"11-å¸‚åœºè§„æ¨¡ä¸æ½œåŠ›è¯„ä¼°\"\u003e1.1 å¸‚åœºè§„æ¨¡ä¸æ½œåŠ›è¯„ä¼°\u003c/h3\u003e\n\u003cp\u003e\u003cstrong\u003eåŒ—ç¾å¸‚åœºç‰¹å¾\u003c/strong\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv style=\"color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2;\"\u003e\n\u003ctable style=\"border-spacing:0;padding:0;margin:0;border:0;\"\u003e\u003ctr\u003e\u003ctd style=\"vertical-align:top;padding:0;margin:0;border:0;\"\u003e\n\u003cpre tabindex=\"0\" style=\"color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2;\"\u003e\u003ccode\u003e\u003cspan style=\"white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679\"\u003e 1\n\u003c/span\u003e\u003cspan style=\"white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679\"\u003e 2\n\u003c/span\u003e\u003cspan style=\"white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679\"\u003e 3\n\u003c/span\u003e\u003cspan style=\"white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679\"\u003e 4\n\u003c/span\u003e\u003cspan style=\"white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679\"\u003e 5\n\u003c/span\u003e\u003cspan style=\"white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679\"\u003e 6\n\u003c/span\u003e\u003cspan style=\"white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679\"\u003e 7\n\u003c/span\u003e\u003cspan style=\"white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679\"\u003e 8\n\u003c/span\u003e\u003cspan style=\"white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679\"\u003e 9\n\u003c/span\u003e\u003cspan style=\"white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679\"\u003e10\n\u003c/span\u003e\u003cspan style=\"white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679\"\u003e11\n\u003c/span\u003e\u003cspan style=\"white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679\"\u003e12\n\u003c/span\u003e\u003cspan style=\"white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679\"\u003e13\n\u003c/span\u003e\u003cspan style=\"white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679\"\u003e14\n\u003c/span\u003e\u003cspan style=\"white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679\"\u003e15\n\u003c/span\u003e\u003cspan style=\"white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679\"\u003e16\n\u003c/span\u003e\u003cspan style=\"white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679\"\u003e17\n\u003c/span\u003e\u003cspan style=\"white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679\"\u003e18\n\u003c/span\u003e\u003cspan style=\"white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679\"\u003e19\n\u003c/span\u003e\u003cspan style=\"white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679\"\u003e20\n\u003c/span\u003e\u003cspan style=\"white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679\"\u003e21\n\u003c/span\u003e\u003cspan style=\"white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679\"\u003e22\n\u003c/span\u003e\u003cspan style=\"white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679\"\u003e23\n\u003c/span\u003e\u003cspan style=\"white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679\"\u003e24\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd style=\"vertical-align:top;padding:0;margin:0;border:0;;width:100%\"\u003e\n\u003cpre tabindex=\"0\" style=\"color:#e6edf3;background-color:#0d1117;-moz-tab-size:2;-o-tab-size:2;tab-size:2;\"\u003e\u003ccode class=\"language-javascript\" data-lang=\"javascript\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#8b949e;font-style:italic\"\u003e// åŒ—ç¾å¸‚åœºæ•°æ®æ¨¡å‹\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#8b949e;font-style:italic\"\u003e\u003c/span\u003e\u003cspan style=\"color:#ff7b72\"\u003econst\u003c/span\u003e northAmericaMarket \u003cspan style=\"color:#ff7b72;font-weight:bold\"\u003e=\u003c/span\u003e {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e å¸‚åœºè§„æ¨¡\u003cspan style=\"color:#ff7b72;font-weight:bold\"\u003e:\u003c/span\u003e {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    mobile\u003cspan style=\"color:#ff7b72;font-weight:bold\"\u003e:\u003c/span\u003e \u003cspan style=\"color:#a5d6ff\"\u003e\u0026#34;42äº¿ç¾å…ƒå¹´è¥æ”¶\u0026#34;\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    console\u003cspan style=\"color:#ff7b72;font-weight:bold\"\u003e:\u003c/span\u003e \u003cspan style=\"color:#a5d6ff\"\u003e\u0026#34;38äº¿ç¾å…ƒå¹´è¥æ”¶\u0026#34;\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    PC\u003cspan style=\"color:#ff7b72;font-weight:bold\"\u003e:\u003c/span\u003e \u003cspan style=\"color:#a5d6ff\"\u003e\u0026#34;28äº¿ç¾å…ƒå¹´è¥æ”¶\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  },\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  userBehavior\u003cspan style=\"color:#ff7b72;font-weight:bold\"\u003e:\u003c/span\u003e {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    arppu\u003cspan style=\"color:#ff7b72;font-weight:bold\"\u003e:\u003c/span\u003e \u003cspan style=\"color:#a5d6ff\"\u003e35.8\u003c/span\u003e, \u003cspan style=\"color:#8b949e;font-style:italic\"\u003e// å¹³å‡ä»˜è´¹ç”¨æˆ·æ”¶å…¥\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#8b949e;font-style:italic\"\u003e\u003c/span\u003e    retentionRate\u003cspan style=\"color:#ff7b72;font-weight:bold\"\u003e:\u003c/span\u003e \u003cspan style=\"color:#a5d6ff\"\u003e0.32\u003c/span\u003e, \u003cspan style=\"color:#8b949e;font-style:italic\"\u003e// æ¬¡æ—¥ç•™å­˜ç‡\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#8b949e;font-style:italic\"\u003e\u003c/span\u003e    ltv\u003cspan style=\"color:#ff7b72;font-weight:bold\"\u003e:\u003c/span\u003e \u003cspan style=\"color:#a5d6ff\"\u003e45.6\u003c/span\u003e \u003cspan style=\"color:#8b949e;font-style:italic\"\u003e// ç”Ÿå‘½å‘¨æœŸä»·å€¼\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#8b949e;font-style:italic\"\u003e\u003c/span\u003e  },\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  platformDistribution\u003cspan style=\"color:#ff7b72;font-weight:bold\"\u003e:\u003c/span\u003e {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    iOS\u003cspan style=\"color:#ff7b72;font-weight:bold\"\u003e:\u003c/span\u003e \u003cspan style=\"color:#a5d6ff\"\u003e0.48\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    Android\u003cspan style=\"color:#ff7b72;font-weight:bold\"\u003e:\u003c/span\u003e \u003cspan style=\"color:#a5d6ff\"\u003e0.35\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    PC\u003cspan style=\"color:#ff7b72;font-weight:bold\"\u003e:\u003c/span\u003e \u003cspan style=\"color:#a5d6ff\"\u003e0.12\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    Console\u003cspan style=\"color:#ff7b72;font-weight:bold\"\u003e:\u003c/span\u003e \u003cspan style=\"color:#a5d6ff\"\u003e0.05\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  },\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  competitiveLandscape\u003cspan style=\"color:#ff7b72;font-weight:bold\"\u003e:\u003c/span\u003e {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    topGenres\u003cspan style=\"color:#ff7b72;font-weight:bold\"\u003e:\u003c/span\u003e [\u003cspan style=\"color:#a5d6ff\"\u003e\u0026#34;ç­–ç•¥\u0026#34;\u003c/span\u003e, \u003cspan style=\"color:#a5d6ff\"\u003e\u0026#34;RPG\u0026#34;\u003c/span\u003e, \u003cspan style=\"color:#a5d6ff\"\u003e\u0026#34;ä¼‘é—²\u0026#34;\u003c/span\u003e, \u003cspan style=\"color:#a5d6ff\"\u003e\u0026#34;ä½“è‚²\u0026#34;\u003c/span\u003e],\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    barriers\u003cspan style=\"color:#ff7b72;font-weight:bold\"\u003e:\u003c/span\u003e \u003cspan style=\"color:#a5d6ff\"\u003e\u0026#34;é«˜ç ”å‘æˆæœ¬ï¼Œå¼ºIPä¾èµ–\u0026#34;\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    opportunities\u003cspan style=\"color:#ff7b72;font-weight:bold\"\u003e:\u003c/span\u003e \u003cspan style=\"color:#a5d6ff\"\u003e\u0026#34;åˆ›æ–°ç©æ³•ï¼Œç»†åˆ†å¸‚åœº\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  }\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e};\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e\u003cstrong\u003eæ¬§æ´²å¸‚åœºæ ¼å±€\u003c/strong\u003e\u003c/p\u003e","title":"å…¨çƒæ¸¸æˆå‘è¡Œç­–ç•¥ï¼šä»ç«‹é¡¹åˆ°è¿è¥çš„å®Œæ•´æŒ‡å—"},{"content":"2025å¹´Web Vitalsæ€§èƒ½ä¼˜åŒ–ç»ˆææŒ‡å— Web Vitalså·²æˆä¸ºè¡¡é‡ç½‘ç«™ç”¨æˆ·ä½“éªŒçš„æ ¸å¿ƒæŒ‡æ ‡ï¼Œç›´æ¥å½±å“SEOæ’åå’Œç”¨æˆ·æ»¡æ„åº¦ã€‚æœ¬æŒ‡å—å°†æ·±å…¥æ¢è®¨2025å¹´æœ€æ–°çš„ä¼˜åŒ–ç­–ç•¥å’ŒæŠ€æœ¯ã€‚\nCore Web Vitals 2025æ›´æ–° 1. LCP (Largest Contentful Paint) ä¼˜åŒ– 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 // LCPç›‘æµ‹å’Œä¼˜åŒ– import { getCLS, getFID, getFCP, getLCP, getTTFB } from \u0026#39;web-vitals\u0026#39;; // ç›‘æµ‹LCP getLCP(console.log); // LCPä¼˜åŒ–ç­–ç•¥ class LCPOptimizer { constructor() { this.optimizationStrategies = [ this.preloadCriticalResources.bind(this), this.optimizeImages.bind(this), this.minifyCriticalCSS.bind(this), this.useResourceHints.bind(this) ]; } // é¢„åŠ è½½å…³é”®èµ„æº preloadCriticalResources() { const criticalResources = [ { href: \u0026#39;/fonts/main.woff2\u0026#39;, as: \u0026#39;font\u0026#39;, type: \u0026#39;font/woff2\u0026#39;, crossOrigin: \u0026#39;anonymous\u0026#39; }, { href: \u0026#39;/css/critical.css\u0026#39;, as: \u0026#39;style\u0026#39; }, { href: \u0026#39;/js/critical.js\u0026#39;, as: \u0026#39;script\u0026#39; } ]; criticalResources.forEach(resource =\u0026gt; { const link = document.createElement(\u0026#39;link\u0026#39;); link.rel = \u0026#39;preload\u0026#39;; Object.keys(resource).forEach(key =\u0026gt; { link.setAttribute(key, resource[key]); }); document.head.appendChild(link); }); } // å›¾ç‰‡ä¼˜åŒ– async optimizeImages() { const images = document.querySelectorAll(\u0026#39;img[data-src]\u0026#39;); const imageObserver = new IntersectionObserver((entries, observer) =\u0026gt; { entries.forEach(entry =\u0026gt; { if (entry.isIntersecting) { const img = entry.target; this.loadImageOptimized(img); observer.unobserve(img); } }); }, { rootMargin: \u0026#39;50px\u0026#39; }); images.forEach(img =\u0026gt; imageObserver.observe(img)); } // ä¼˜åŒ–å›¾ç‰‡åŠ è½½ async loadImageOptimized(img) { // ä½¿ç”¨WebPæ ¼å¼ const webpUrl = img.dataset.src.replace(/\\.(jpg|png)$/, \u0026#39;.webp\u0026#39;); // å“åº”å¼å›¾ç‰‡ const srcset = this.generateSrcset(img.dataset.src); img.srcset = srcset; img.sizes = \u0026#39;(max-width: 768px) 100vw, (max-width: 1200px) 50vw, 33vw\u0026#39;; // æ¸è¿›å¼åŠ è½½ img.style.filter = \u0026#39;blur(5px)\u0026#39;; img.onload = () =\u0026gt; { img.style.filter = \u0026#39;none\u0026#39;; img.style.transition = \u0026#39;filter 0.3s\u0026#39;; }; img.src = webpUrl; } // ç”Ÿæˆå“åº”å¼å›¾ç‰‡srcset generateSrcset(baseUrl) { const widths = [320, 640, 960, 1280, 1920]; return widths .map(width =\u0026gt; `${baseUrl}?w=${width} ${width}w`) .join(\u0026#39;, \u0026#39;); } } // å…³é”®CSSå†…è” class CriticalCSS { constructor() { this.injectCriticalCSS(); this.loadNonCriticalCSS(); } injectCriticalCSS() { const criticalCSS = ` /* å…³é”®CSSå†…å®¹ */ body { margin: 0; font-family: system-ui; } .header { height: 60px; background: #fff; } .hero { min-height: 400px; background: linear-gradient(45deg, #667eea 0%, #764ba2 100%); } `; const style = document.createElement(\u0026#39;style\u0026#39;); style.textContent = criticalCSS; document.head.appendChild(style); } loadNonCriticalCSS() { const nonCriticalCSS = [ \u0026#39;/css/animations.css\u0026#39;, \u0026#39;/css/components.css\u0026#39;, \u0026#39;/css/utilities.css\u0026#39; ]; nonCriticalCSS.forEach(href =\u0026gt; { const link = document.createElement(\u0026#39;link\u0026#39;); link.rel = \u0026#39;preload\u0026#39;; link.as = \u0026#39;style\u0026#39;; link.onload = function() { this.rel = \u0026#39;stylesheet\u0026#39;; }; link.href = href; document.head.appendChild(link); }); } } 2. FID (First Input Delay) ä¼˜åŒ– 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 // FIDä¼˜åŒ–ç­–ç•¥ class FIDOptimizer { constructor() { this.optimizeJavaScript(); this.setupEventListeners(); this.minimizeMainThreadWork(); } // JavaScriptä¼˜åŒ– optimizeJavaScript() { // ä»£ç åˆ†å‰² this.lazyLoadModules(); // ä¼˜åŒ–ç¬¬ä¸‰æ–¹è„šæœ¬ this.optimizeThirdPartyScripts(); // ä½¿ç”¨Web Workers this.setupWebWorkers(); } // æ‡’åŠ è½½æ¨¡å— lazyLoadModules() { const modules = { // äº¤äº’å¼åœ°å›¾ map: () =\u0026gt; import(\u0026#39;./modules/map.js\u0026#39;), // å›¾è¡¨ç»„ä»¶ charts: () =\u0026gt; import(\u0026#39;./modules/charts.js\u0026#39;), // è§†é¢‘æ’­æ”¾å™¨ video: () =\u0026gt; import(\u0026#39;./modules/video.js\u0026#39;) }; // æŒ‰éœ€åŠ è½½ document.addEventListener(\u0026#39;click\u0026#39;, (e) =\u0026gt; { if (e.target.matches(\u0026#39;.map-trigger\u0026#39;)) { modules.map().then(module =\u0026gt; module.init()); } }, { passive: true }); // äº¤é›†è§‚å¯Ÿå™¨åŠ è½½ const observer = new IntersectionObserver((entries) =\u0026gt; { entries.forEach(entry =\u0026gt; { if (entry.isIntersecting) { const moduleName = entry.target.dataset.module; if (modules[moduleName]) { modules[moduleName](); observer.unobserve(entry.target); } } }); }, { rootMargin: \u0026#39;100px\u0026#39; }); document.querySelectorAll(\u0026#39;[data-module]\u0026#39;).forEach(el =\u0026gt; { observer.observe(el); }); } // ä¼˜åŒ–ç¬¬ä¸‰æ–¹è„šæœ¬ optimizeThirdPartyScripts() { // å»¶è¿ŸåŠ è½½åˆ†æè„šæœ¬ window.addEventListener(\u0026#39;load\u0026#39;, () =\u0026gt; { setTimeout(() =\u0026gt; { this.loadScript(\u0026#39;https://www.google-analytics.com/analytics.js\u0026#39;, { async: true, defer: true }); }, 2000); }); // é¢„è¿æ¥åˆ°ç¬¬ä¸‰æ–¹åŸŸå const preconnectDomains = [ \u0026#39;https://www.google-analytics.com\u0026#39;, \u0026#39;https://stats.g.doubleclick.net\u0026#39;, \u0026#39;https://fonts.googleapis.com\u0026#39; ]; preconnectDomains.forEach(domain =\u0026gt; { const link = document.createElement(\u0026#39;link\u0026#39;); link.rel = \u0026#39;preconnect\u0026#39;; link.href = domain; document.head.appendChild(link); }); } // Web Workersè®¾ç½® setupWebWorkers() { // è®¡ç®—å¯†é›†å‹ä»»åŠ¡ç§»è‡³Web Worker const workerCode = ` self.onmessage = function(e) { const result = heavyComputation(e.data); self.postMessage(result); }; function heavyComputation(data) { // å¤æ‚è®¡ç®—é€»è¾‘ return data.reduce((acc, val) =\u0026gt; acc + val, 0); } `; const blob = new Blob([workerCode], { type: \u0026#39;application/javascript\u0026#39; }); const worker = new Worker(URL.createObjectURL(blob)); // ä½¿ç”¨ç¤ºä¾‹ worker.postMessage([1, 2, 3, 4, 5]); worker.onmessage = (e) =\u0026gt; { console.log(\u0026#39;è®¡ç®—ç»“æœ:\u0026#39;, e.data); }; } // ä¼˜åŒ–äº‹ä»¶ç›‘å¬å™¨ setupEventListeners() { // ä½¿ç”¨äº‹ä»¶å§”æ‰˜ document.body.addEventListener(\u0026#39;click\u0026#39;, (e) =\u0026gt; { if (e.target.matches(\u0026#39;.btn\u0026#39;)) { this.handleButtonClick(e); } }, { passive: true }); // é˜²æŠ–æ»šåŠ¨äº‹ä»¶ let ticking = false; const updatePosition = () =\u0026gt; { // æ›´æ–°ä½ç½®é€»è¾‘ ticking = false; }; window.addEventListener(\u0026#39;scroll\u0026#39;, () =\u0026gt; { if (!ticking) { requestAnimationFrame(updatePosition); ticking = true; } }, { passive: true }); } } 3. CLS (Cumulative Layout Shift) ä¼˜åŒ– 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 // CLSä¼˜åŒ–ç­–ç•¥ class CLSOptimizer { constructor() { this.reserveSpace(); this.optimizeFontLoading(); this.handleAdsAndWidgets(); } // ä¸ºåŠ¨æ€å†…å®¹é¢„ç•™ç©ºé—´ reserveSpace() { // å›¾ç‰‡å®¹å™¨é¢„ç•™ç©ºé—´ const imageContainers = document.querySelectorAll(\u0026#39;.image-container\u0026#39;); imageContainers.forEach(container =\u0026gt; { const aspectRatio = container.dataset.aspectRatio || \u0026#39;16/9\u0026#39;; const [width, height] = aspectRatio.split(\u0026#39;/\u0026#39;).map(Number); const paddingBottom = (height / width) * 100; container.style.paddingBottom = `${paddingBottom}%`; container.style.position = \u0026#39;relative\u0026#39;; }); // å­—ä½“åŠ è½½å‰è®¾ç½®è¡Œé«˜ const headings = document.querySelectorAll(\u0026#39;h1, h2, h3\u0026#39;); headings.forEach(heading =\u0026gt; { heading.style.lineHeight = \u0026#39;1.2\u0026#39;; heading.style.minHeight = \u0026#39;1.2em\u0026#39;; }); // å¹¿å‘Šä½é¢„ç•™ const adSlots = document.querySelectorAll(\u0026#39;.ad-slot\u0026#39;); adSlots.forEach(slot =\u0026gt; { const width = slot.dataset.width || \u0026#39;300\u0026#39;; const height = slot.dataset.height || \u0026#39;250\u0026#39;; slot.style.width = `${width}px`; slot.style.height = `${height}px`; slot.style.backgroundColor = \u0026#39;#f0f0f0\u0026#39;; }); } // ä¼˜åŒ–å­—ä½“åŠ è½½ optimizeFontLoading() { // å­—ä½“æ˜¾ç¤ºç­–ç•¥ const fontDisplay = ` @font-face { font-family: \u0026#39;Custom Font\u0026#39;; src: url(\u0026#39;/fonts/custom-font.woff2\u0026#39;) format(\u0026#39;woff2\u0026#39;); font-display: swap; ascent-override: 90%; descent-override: 35%; } `; const style = document.createElement(\u0026#39;style\u0026#39;); style.textContent = fontDisplay; document.head.appendChild(style); // é¢„åŠ è½½å…³é”®å­—ä½“ const fontLink = document.createElement(\u0026#39;link\u0026#39;); fontLink.rel = \u0026#39;preload\u0026#39;; fontLink.href = \u0026#39;/fonts/critical-font.woff2\u0026#39;; fontLink.as = \u0026#39;font\u0026#39;; fontLink.type = \u0026#39;font/woff2\u0026#39;; fontLink.crossOrigin = \u0026#39;anonymous\u0026#39;; document.head.appendChild(fontLink); // å­—ä½“åŠ è½½ä¼˜åŒ– if (\u0026#39;fonts\u0026#39; in document) { Promise.all([ document.fonts.load(\u0026#39;16px Custom Font\u0026#39;), document.fonts.load(\u0026#39;24px Custom Font\u0026#39;) ]).then(() =\u0026gt; { document.documentElement.classList.add(\u0026#39;fonts-loaded\u0026#39;); }); } } // å¤„ç†å¹¿å‘Šå’ŒåµŒå…¥å†…å®¹ handleAdsAndWidgets() { // å¹¿å‘Šå®¹å™¨ä¼˜åŒ– const adContainers = document.querySelectorAll(\u0026#39;.ad-container\u0026#39;); adContainers.forEach(container =\u0026gt; { container.style.minHeight = container.dataset.minHeight || \u0026#39;250px\u0026#39;; container.style.display = \u0026#39;flex\u0026#39;; container.style.alignItems = \u0026#39;center\u0026#39;; container.style.justifyContent = \u0026#39;center\u0026#39;; container.style.backgroundColor = \u0026#39;#f5f5f5\u0026#39;; }); // å»¶è¿ŸåŠ è½½åµŒå…¥å†…å®¹ const embedElements = document.querySelectorAll(\u0026#39;[data-embed]\u0026#39;); const embedObserver = new IntersectionObserver((entries) =\u0026gt; { entries.forEach(entry =\u0026gt; { if (entry.isIntersecting) { const element = entry.target; this.loadEmbed(element); embedObserver.unobserve(element); } }); }, { rootMargin: \u0026#39;200px\u0026#39; }); embedElements.forEach(el =\u0026gt; embedObserver.observe(el)); } // åŠ è½½åµŒå…¥å†…å®¹ loadEmbed(element) { const embedType = element.dataset.embed; const embedSrc = element.dataset.src; switch (embedType) { case \u0026#39;youtube\u0026#39;: element.innerHTML = ` \u0026lt;iframe src=\u0026#34;${embedSrc}\u0026#34; frameborder=\u0026#34;0\u0026#34; allow=\u0026#34;accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture\u0026#34; allowfullscreen\u0026gt; \u0026lt;/iframe\u0026gt; `; break; case \u0026#39;twitter\u0026#39;: this.loadTwitterEmbed(embedSrc, element); break; } } } æ€§èƒ½ç›‘æ§å’Œæµ‹é‡ 1. å®æ—¶æ€§èƒ½ç›‘æ§ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 174 175 176 177 178 179 180 181 182 183 184 185 186 187 188 189 190 191 192 193 194 195 196 197 198 199 200 201 202 203 204 205 206 207 208 209 // æ€§èƒ½ç›‘æ§ç³»ç»Ÿ class PerformanceMonitor { constructor() { this.metrics = {}; this.observers = []; this.setupObservers(); this.trackWebVitals(); } setupObservers() { // Performance Observer if (\u0026#39;PerformanceObserver\u0026#39; in window) { this.observeNavigation(); this.observeResources(); this.observePaint(); this.observeLayoutShift(); this.observeLongTasks(); } } // å¯¼èˆªæ€§èƒ½ç›‘æ§ observeNavigation() { const observer = new PerformanceObserver((list) =\u0026gt; { const entries = list.getEntries(); entries.forEach(entry =\u0026gt; { if (entry.entryType === \u0026#39;navigation\u0026#39;) { this.metrics.navigation = { dns: entry.domainLookupEnd - entry.domainLookupStart, tcp: entry.connectEnd - entry.connectStart, ssl: entry.secureConnectionStart \u0026gt; 0 ? entry.connectEnd - entry.secureConnectionStart : 0, ttfb: entry.responseStart - entry.requestStart, download: entry.responseEnd - entry.responseStart, domParse: entry.domContentLoadedEventStart - entry.responseEnd, domReady: entry.domContentLoadedEventEnd - entry.domContentLoadedEventStart, loadComplete: entry.loadEventEnd - entry.loadEventStart }; } }); }); observer.observe({ entryTypes: [\u0026#39;navigation\u0026#39;] }); this.observers.push(observer); } // èµ„æºåŠ è½½ç›‘æ§ observeResources() { const observer = new PerformanceObserver((list) =\u0026gt; { const entries = list.getEntries(); entries.forEach(entry =\u0026gt; { const resource = { name: entry.name, type: this.getResourceType(entry), duration: entry.duration, size: entry.transferSize || 0, cached: entry.transferSize === 0 \u0026amp;\u0026amp; entry.decodedBodySize \u0026gt; 0 }; if (!this.metrics.resources) { this.metrics.resources = []; } this.metrics.resources.push(resource); }); }); observer.observe({ entryTypes: [\u0026#39;resource\u0026#39;] }); this.observers.push(observer); } // LCPç›‘æ§ observePaint() { const observer = new PerformanceObserver((list) =\u0026gt; { const entries = list.getEntries(); entries.forEach(entry =\u0026gt; { if (entry.name === \u0026#39;largest-contentful-paint\u0026#39;) { this.metrics.lcp = entry.startTime; } }); }); observer.observe({ entryTypes: [\u0026#39;largest-contentful-paint\u0026#39;] }); this.observers.push(observer); } // CLSç›‘æ§ observeLayoutShift() { let clsValue = 0; const observer = new PerformanceObserver((list) =\u0026gt; { const entries = list.getEntries(); entries.forEach(entry =\u0026gt; { if (!entry.hadRecentInput) { clsValue += entry.value; this.metrics.cls = clsValue; } }); }); observer.observe({ entryTypes: [\u0026#39;layout-shift\u0026#39;] }); this.observers.push(observer); } // é•¿ä»»åŠ¡ç›‘æ§ observeLongTasks() { const observer = new PerformanceObserver((list) =\u0026gt; { const entries = list.getEntries(); entries.forEach(entry =\u0026gt; { if (!this.metrics.longTasks) { this.metrics.longTasks = []; } this.metrics.longTasks.push({ duration: entry.duration, startTime: entry.startTime }); }); }); observer.observe({ entryTypes: [\u0026#39;longtask\u0026#39;] }); this.observers.push(observer); } // Web Vitalsè¿½è¸ª trackWebVitals() { // ä½¿ç”¨web-vitalsåº“ getCLS((metric) =\u0026gt; { this.sendMetric(\u0026#39;CLS\u0026#39;, metric); }); getFID((metric) =\u0026gt; { this.sendMetric(\u0026#39;FID\u0026#39;, metric); }); getLCP((metric) =\u0026gt; { this.sendMetric(\u0026#39;LCP\u0026#39;, metric); }); getFCP((metric) =\u0026gt; { this.sendMetric(\u0026#39;FCP\u0026#39;, metric); }); getTTFB((metric) =\u0026gt; { this.sendMetric(\u0026#39;TTFB\u0026#39;, metric); }); } // å‘é€æŒ‡æ ‡åˆ°åˆ†ææœåŠ¡ sendMetric(name, metric) { const data = { name, value: metric.value, id: metric.id, delta: metric.delta, url: window.location.href, userAgent: navigator.userAgent, timestamp: Date.now() }; // å‘é€åˆ°åˆ†ææœåŠ¡å™¨ fetch(\u0026#39;/api/vitals\u0026#39;, { method: \u0026#39;POST\u0026#39;, headers: { \u0026#39;Content-Type\u0026#39;: \u0026#39;application/json\u0026#39; }, body: JSON.stringify(data) }).catch(err =\u0026gt; { console.warn(\u0026#39;Failed to send vitals:\u0026#39;, err); }); } // ç”Ÿæˆæ€§èƒ½æŠ¥å‘Š generateReport() { const report = { timestamp: new Date().toISOString(), url: window.location.href, userAgent: navigator.userAgent, metrics: this.metrics, recommendations: this.generateRecommendations() }; return report; } // ç”Ÿæˆä¼˜åŒ–å»ºè®® generateRecommendations() { const recommendations = []; if (this.metrics.lcp \u0026gt; 2500) { recommendations.push({ metric: \u0026#39;LCP\u0026#39;, suggestion: \u0026#39;ä¼˜åŒ–LCPï¼šé¢„åŠ è½½å…³é”®èµ„æºï¼Œä¼˜åŒ–å›¾ç‰‡ï¼Œä½¿ç”¨CDN\u0026#39; }); } if (this.metrics.fid \u0026gt; 100) { recommendations.push({ metric: \u0026#39;FID\u0026#39;, suggestion: \u0026#39;ä¼˜åŒ–FIDï¼šå‡å°‘JavaScriptæ‰§è¡Œæ—¶é—´ï¼Œä½¿ç”¨Web Workers\u0026#39; }); } if (this.metrics.cls \u0026gt; 0.1) { recommendations.push({ metric: \u0026#39;CLS\u0026#39;, suggestion: \u0026#39;ä¼˜åŒ–CLSï¼šä¸ºåŠ¨æ€å†…å®¹é¢„ç•™ç©ºé—´ï¼Œä¼˜åŒ–å­—ä½“åŠ è½½\u0026#39; }); } return recommendations; } } é«˜çº§ä¼˜åŒ–æŠ€æœ¯ 1. HTTP/3 å’Œ QUIC ä¼˜åŒ– 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 // HTTP/3ä¼˜åŒ–é…ç½® class HTTP3Optimizer { constructor() { this.optimizeConnections(); this.enableEarlyHints(); } optimizeConnections() { // Alt-Svcå¤´éƒ¨æç¤º const altSvc = document.createElement(\u0026#39;meta\u0026#39;); altSvc.httpEquiv = \u0026#39;Alt-Svc\u0026#39;; altSvc.content = \u0026#39;h3=\u0026#34;:443\u0026#34;; ma=2592000,h3-29=\u0026#34;:443\u0026#34;; ma=2592000\u0026#39;; document.head.appendChild(altSvc); // é¢„è¿æ¥åˆ°HTTP/3ç«¯ç‚¹ const h3Endpoints = [ \u0026#39;https://api.example.com\u0026#39;, \u0026#39;https://cdn.example.com\u0026#39; ]; h3Endpoints.forEach(endpoint =\u0026gt; { const link = document.createElement(\u0026#39;link\u0026#39;); link.rel = \u0026#39;preconnect\u0026#39;; link.href = endpoint; link.setAttribute(\u0026#39;crossorigin\u0026#39;, \u0026#39;anonymous\u0026#39;); document.head.appendChild(link); }); } enableEarlyHints() { // 103 Early Hintsæ”¯æŒ if (\u0026#39;serviceWorker\u0026#39; in navigator) { navigator.serviceWorker.register(\u0026#39;/sw-hints.js\u0026#39;).then(registration =\u0026gt; { registration.addEventListener(\u0026#39;message\u0026#39;, event =\u0026gt; { if (event.data.type === \u0026#39;EARLY_HINTS\u0026#39;) { this.processEarlyHints(event.data.hints); } }); }); } } processEarlyHints(hints) { hints.link.forEach(link =\u0026gt; { const linkEl = document.createElement(\u0026#39;link\u0026#39;); Object.keys(link).forEach(key =\u0026gt; { linkEl.setAttribute(key, link[key]); }); document.head.appendChild(linkEl); }); } } 2. è¾¹ç¼˜è®¡ç®—ä¼˜åŒ– 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 // è¾¹ç¼˜è®¡ç®—ä¼˜åŒ– class EdgeOptimizer { constructor() { this.setupEdgeHeaders(); this.configureCdnFeatures(); } // è¾¹ç¼˜ä¼˜åŒ–å¤´éƒ¨ setupEdgeHeaders() { const edgeHeaders = [ { name: \u0026#39;Edge-Cache-Tag\u0026#39;, content: \u0026#39;product-page,v2\u0026#39; }, { name: \u0026#39;Edge-Cache-TTL\u0026#39;, content: \u0026#39;3600\u0026#39; }, { name: \u0026#39;Edge-Compute\u0026#39;, content: \u0026#39;true\u0026#39; } ]; edgeHeaders.forEach(header =\u0026gt; { const meta = document.createElement(\u0026#39;meta\u0026#39;); meta.name = header.name; meta.content = header.content; document.head.appendChild(meta); }); } // CDNåŠŸèƒ½é…ç½® configureCdnFeatures() { // è‡ªåŠ¨å›¾ç‰‡ä¼˜åŒ– const imgUrls = document.querySelectorAll(\u0026#39;img[src*=\u0026#34;cdn.example.com\u0026#34;]\u0026#39;); imgUrls.forEach(img =\u0026gt; { const url = new URL(img.src); url.searchParams.set(\u0026#39;auto\u0026#39;, \u0026#39;format,compress\u0026#39;); url.searchParams.set(\u0026#39;width\u0026#39;, img.getAttribute(\u0026#39;width\u0026#39;) || \u0026#39;auto\u0026#39;); url.searchParams.set(\u0026#39;quality\u0026#39;, \u0026#39;80\u0026#39;); img.src = url.toString(); }); // å­—ä½“ä¼˜åŒ– const fontUrls = document.querySelectorAll(\u0026#39;link[href*=\u0026#34;fonts.googleapis.com\u0026#34;]\u0026#39;); fontUrls.forEach(link =\u0026gt; { const url = new URL(link.href); url.searchParams.set(\u0026#39;display\u0026#39;, \u0026#39;swap\u0026#39;); url.searchParams.set(\u0026#39;subset\u0026#39;, \u0026#39;latin,latin-ext\u0026#39;); link.href = url.toString(); }); } } å®æ–½å’Œæµ‹è¯• 1. A/Bæµ‹è¯•æ¡†æ¶ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 // æ€§èƒ½A/Bæµ‹è¯• class PerformanceABTest { constructor() { this.variant = this.getVariant(); this.trackVariant(); } getVariant() { // ä»URLå‚æ•°è·å–å˜ä½“ const urlParams = new URLSearchParams(window.location.search); const variant = urlParams.get(\u0026#39;variant\u0026#39;); if (variant) { return variant; } // éšæœºåˆ†é…å˜ä½“ const variants = [\u0026#39;control\u0026#39;, \u0026#39;optimized\u0026#39;]; const randomIndex = Math.floor(Math.random() * variants.length); const assignedVariant = variants[randomIndex]; // å­˜å‚¨å˜ä½“ localStorage.setItem(\u0026#39;ab_test_variant\u0026#39;, assignedVariant); return assignedVariant; } trackVariant() { // å‘é€å˜ä½“ä¿¡æ¯åˆ°åˆ†ææœåŠ¡ fetch(\u0026#39;/api/ab-test\u0026#39;, { method: \u0026#39;POST\u0026#39;, headers: { \u0026#39;Content-Type\u0026#39;: \u0026#39;application/json\u0026#39; }, body: JSON.stringify({ test: \u0026#39;performance_optimization\u0026#39;, variant: this.variant, url: window.location.href, userAgent: navigator.userAgent }) }); } applyOptimizations() { if (this.variant === \u0026#39;optimized\u0026#39;) { // åº”ç”¨æ€§èƒ½ä¼˜åŒ– new LCPOptimizer(); new FIDOptimizer(); new CLSOptimizer(); new HTTP3Optimizer(); } } trackPerformance() { // è¿½è¸ªæ€§èƒ½æŒ‡æ ‡ getCLS((metric) =\u0026gt; { this.sendPerformanceMetric(\u0026#39;CLS\u0026#39;, metric); }); getFID((metric) =\u0026gt; { this.sendPerformanceMetric(\u0026#39;FID\u0026#39;, metric); }); getLCP((metric) =\u0026gt; { this.sendPerformanceMetric(\u0026#39;LCP\u0026#39;, metric); }); } sendPerformanceMetric(metricName, metric) { fetch(\u0026#39;/api/ab-test-metrics\u0026#39;, { method: \u0026#39;POST\u0026#39;, headers: { \u0026#39;Content-Type\u0026#39;: \u0026#39;application/json\u0026#39; }, body: JSON.stringify({ test: \u0026#39;performance_optimization\u0026#39;, variant: this.variant, metric: metricName, value: metric.value, timestamp: Date.now() }) }); } } // åˆå§‹åŒ–A/Bæµ‹è¯• const abTest = new PerformanceABTest(); abTest.applyOptimizations(); abTest.trackPerformance(); 2025å¹´æœ€æ–°è¶‹åŠ¿ 1. AIé©±åŠ¨çš„æ€§èƒ½ä¼˜åŒ– 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 // AIæ€§èƒ½ä¼˜åŒ–å™¨ class AIPerformanceOptimizer { constructor() { this.aiModel = null; this.loadAIModel(); } async loadAIModel() { // åŠ è½½TensorFlow.jsæ¨¡å‹ const model = await tf.loadLayersModel(\u0026#39;/models/performance-optimizer/model.json\u0026#39;); this.aiModel = model; } async predictOptimalStrategy() { // æ”¶é›†ä¸Šä¸‹æ–‡æ•°æ® const context = this.collectContext(); // é¢„æµ‹æœ€ä¼˜ç­–ç•¥ const prediction = await this.aiModel.predict(context); return this.applyPredictedOptimizations(prediction); } collectContext() { return { deviceType: this.getDeviceType(), connectionType: this.getConnectionType(), viewportSize: { width: window.innerWidth, height: window.innerHeight }, browserCapabilities: this.getBrowserCapabilities(), currentMetrics: this.getCurrentMetrics() }; } getDeviceType() { const userAgent = navigator.userAgent; if (/Mobile|Android|iPhone|iPad/.test(userAgent)) { return \u0026#39;mobile\u0026#39;; } else if (/Tablet/.test(userAgent)) { return \u0026#39;tablet\u0026#39;; } return \u0026#39;desktop\u0026#39;; } getConnectionType() { if (\u0026#39;connection\u0026#39; in navigator) { return navigator.connection.effectiveType; } return \u0026#39;unknown\u0026#39;; } getBrowserCapabilities() { return { webp: this.supportsWebP(), webp2: this.supportsWebP2(), avif: this.supportsAVIF(), http2: this.supportsHTTP2(), serviceWorker: \u0026#39;serviceWorker\u0026#39; in navigator }; } supportsWebP() { const canvas = document.createElement(\u0026#39;canvas\u0026#39;); return canvas.toDataURL(\u0026#39;image/webp\u0026#39;).indexOf(\u0026#39;data:image/webp\u0026#39;) === 0; } supportsAVIF() { const canvas = document.createElement(\u0026#39;canvas\u0026#39;); return canvas.toDataURL(\u0026#39;image/avif\u0026#39;).indexOf(\u0026#39;data:image/avif\u0026#39;) === 0; } supportsHTTP2() { // é€šè¿‡æ£€æŸ¥èµ„æºæ—¶é—´æˆ³åˆ¤æ–­ const timing = performance.getEntriesByType(\u0026#39;navigation\u0026#39;)[0]; return timing \u0026amp;\u0026amp; timing.nextHopProtocol === \u0026#39;h2\u0026#39;; } async applyPredictedOptimizations(prediction) { const strategies = { images: { format: prediction.imageFormat, quality: prediction.imageQuality, lazyLoad: prediction.lazyLoadImages }, scripts: { defer: prediction.deferScripts, preload: prediction.preloadCriticalScripts }, styles: { inline: prediction.inlineCriticalCSS, preload: prediction.preloadFonts } }; // åº”ç”¨AIæ¨èçš„ä¼˜åŒ–ç­–ç•¥ this.applyImageOptimizations(strategies.images); this.applyScriptOptimizations(strategies.scripts); this.applyStyleOptimizations(strategies.styles); } } æœ€ä½³å®è·µæ¸…å• 1. éƒ¨ç½²å‰æ£€æŸ¥ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 // æ€§èƒ½æ£€æŸ¥æ¸…å• class PerformanceChecklist { constructor() { this.checks = [ this.checkImageOptimization, this.checkCriticalResources, this.checkThirdPartyScripts, this.checkCachingHeaders, this.checkCompression, this.checkMinification, this.checkCoreWebVitals ]; } async runAllChecks() { const results = await Promise.all( this.checks.map(check =\u0026gt; check.call(this)) ); return { score: this.calculateScore(results), results: results, recommendations: this.generateRecommendations(results) }; } async checkImageOptimization() { const images = document.querySelectorAll(\u0026#39;img\u0026#39;); const issues = []; images.forEach(img =\u0026gt; { // æ£€æŸ¥æ ¼å¼ if (!img.src.match(/\\.(webp|avif|svg)$/)) { issues.push({ element: img, issue: \u0026#39;Suboptimal image format\u0026#39;, suggestion: \u0026#39;Use WebP or AVIF format\u0026#39; }); } // æ£€æŸ¥å°ºå¯¸ if (!img.srcset \u0026amp;\u0026amp; !img.sizes) { issues.push({ element: img, issue: \u0026#39;Missing responsive images\u0026#39;, suggestion: \u0026#39;Add srcset and sizes attributes\u0026#39; }); } // æ£€æŸ¥æ‡’åŠ è½½ if (!img.loading \u0026amp;\u0026amp; !img.dataset.src) { const rect = img.getBoundingClientRect(); if (rect.top \u0026gt; window.innerHeight) { issues.push({ element: img, issue: \u0026#39;Lazy loading not implemented\u0026#39;, suggestion: \u0026#39;Add loading=\u0026#34;lazy\u0026#34; or implement custom lazy loading\u0026#39; }); } } }); return { name: \u0026#39;Image Optimization\u0026#39;, passed: issues.length === 0, issues: issues }; } async checkCoreWebVitals() { return new Promise((resolve) =\u0026gt; { let metrics = {}; getCLS((metric) =\u0026gt; { metrics.cls = metric; checkComplete(); }); getFID((metric) =\u0026gt; { metrics.fid = metric; checkComplete(); }); getLCP((metric) =\u0026gt; { metrics.lcp = metric; checkComplete(); }); function checkComplete() { if (metrics.cls \u0026amp;\u0026amp; metrics.fid \u0026amp;\u0026amp; metrics.lcp) { const issues = []; if (metrics.lcp.value \u0026gt; 2500) { issues.push({ metric: \u0026#39;LCP\u0026#39;, value: metrics.lcp.value, threshold: 2500, status: metrics.lcp.value \u0026gt; 4000 ? \u0026#39;poor\u0026#39; : \u0026#39;needs-improvement\u0026#39; }); } if (metrics.fid.value \u0026gt; 100) { issues.push({ metric: \u0026#39;FID\u0026#39;, value: metrics.fid.value, threshold: 100, status: metrics.fid.value \u0026gt; 300 ? \u0026#39;poor\u0026#39; : \u0026#39;needs-improvement\u0026#39; }); } if (metrics.cls.value \u0026gt; 0.1) { issues.push({ metric: \u0026#39;CLS\u0026#39;, value: metrics.cls.value, threshold: 0.1, status: metrics.cls.value \u0026gt; 0.25 ? \u0026#39;poor\u0026#39; : \u0026#39;needs-improvement\u0026#39; }); } resolve({ name: \u0026#39;Core Web Vitals\u0026#39;, passed: issues.length === 0, metrics: metrics, issues: issues }); } } }); } calculateScore(results) { const totalChecks = results.length; const passedChecks = results.filter(r =\u0026gt; r.passed).length; return Math.round((passedChecks / totalChecks) * 100); } generateRecommendations(results) { const allIssues = results.flatMap(r =\u0026gt; r.issues || []); return allIssues.map(issue =\u0026gt; ({ priority: this.calculatePriority(issue), description: issue.suggestion || issue.issue, element: issue.element?.outerHTML?.substring(0, 100) + \u0026#39;...\u0026#39; })).sort((a, b) =\u0026gt; b.priority - a.priority); } calculatePriority(issue) { // æ ¹æ®å½±å“ç¨‹åº¦è®¡ç®—ä¼˜å…ˆçº§ const highImpactMetrics = [\u0026#39;LCP\u0026#39;, \u0026#39;CLS\u0026#39;, \u0026#39;FID\u0026#39;]; if (issue.metric \u0026amp;\u0026amp; highImpactMetrics.includes(issue.metric)) { return issue.status === \u0026#39;poor\u0026#39; ? 10 : 7; } return 5; } } // è¿è¡Œæ€§èƒ½æ£€æŸ¥ const checklist = new PerformanceChecklist(); const performanceReport = await checklist.runAllChecks(); console.log(\u0026#39;Performance Score:\u0026#39;, performanceReport.score); æ€»ç»“ 2025å¹´Web Vitalsä¼˜åŒ–çš„å…³é”®ç­–ç•¥ï¼š\nLCPä¼˜åŒ–ï¼šå…³é”®èµ„æºé¢„åŠ è½½ã€å›¾ç‰‡ä¼˜åŒ–ã€CDNä½¿ç”¨ FIDä¼˜åŒ–ï¼šJavaScriptä¼˜åŒ–ã€Web Workersã€ä»£ç åˆ†å‰² CLSä¼˜åŒ–ï¼šç©ºé—´é¢„ç•™ã€å­—ä½“ä¼˜åŒ–ã€å¼‚æ­¥å†…å®¹åŠ è½½ ç›‘æ§æµ‹é‡ï¼šå®æ—¶ç›‘æ§ã€A/Bæµ‹è¯•ã€AIä¼˜åŒ– æ–°æŠ€æœ¯åº”ç”¨ï¼šHTTP/3ã€è¾¹ç¼˜è®¡ç®—ã€AIé©±åŠ¨ä¼˜åŒ– é€šè¿‡å®æ–½è¿™äº›ç­–ç•¥ï¼Œå¯ä»¥æ˜¾è‘—æå‡ç½‘ç«™æ€§èƒ½ï¼Œæ”¹å–„ç”¨æˆ·ä½“éªŒã€‚\nç›¸å…³èµ„æº Web Vitalså®˜æ–¹æ–‡æ¡£ PageSpeed Insights Chrome DevTools Performance ","permalink":"/blog/articles/web-vitals-optimization-2025/","summary":"æŒæ¡æœ€æ–°çš„Webæ€§èƒ½ä¼˜åŒ–æŠ€æœ¯ï¼Œæå‡ç½‘ç«™ç”¨æˆ·ä½“éªŒå’Œæœç´¢æ’åã€‚","title":"2025å¹´Web Vitalsæ€§èƒ½ä¼˜åŒ–ç»ˆææŒ‡å—"},{"content":"å¾®æœåŠ¡é€šä¿¡æ¨¡å¼æ·±åº¦è§£æ å¾®æœåŠ¡æ¶æ„çš„æ ¸å¿ƒæŒ‘æˆ˜ä¹‹ä¸€æ˜¯å¦‚ä½•è®¾è®¡æœåŠ¡é—´çš„é€šä¿¡æœºåˆ¶ã€‚æœ¬æ–‡å°†æ·±å…¥æ¢è®¨å„ç§é€šä¿¡æ¨¡å¼ï¼Œå¸®åŠ©æ‚¨æ„å»ºé«˜æ•ˆã€å¯é çš„å¾®æœåŠ¡ç³»ç»Ÿã€‚\né€šä¿¡æ¨¡å¼åˆ†ç±» 1. åŒæ­¥ vs å¼‚æ­¥é€šä¿¡ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 # åŒæ­¥é€šä¿¡ç¤ºä¾‹ - REST API import requests import json from fastapi import FastAPI app = FastAPI() class OrderService: def __init__(self): self.user_service_url = \u0026#34;http://user-service:8001\u0026#34; self.payment_service_url = \u0026#34;http://payment-service:8002\u0026#34; self.inventory_service_url = \u0026#34;http://inventory-service:8003\u0026#34; def create_order(self, order_data): \u0026#34;\u0026#34;\u0026#34;åŒæ­¥åˆ›å»ºè®¢å•\u0026#34;\u0026#34;\u0026#34; # éªŒè¯ç”¨æˆ· user_response = requests.get( f\u0026#34;{self.user_service_url}/users/{order_data[\u0026#39;user_id\u0026#39;]}\u0026#34; ) if user_response.status_code != 200: raise Exception(\u0026#34;Invalid user\u0026#34;) # æ£€æŸ¥åº“å­˜ inventory_response = requests.post( f\u0026#34;{self.inventory_service_url}/check\u0026#34;, json={\u0026#34;items\u0026#34;: order_data[\u0026#34;items\u0026#34;]} ) if inventory_response.status_code != 200: raise Exception(\u0026#34;Insufficient inventory\u0026#34;) # å¤„ç†æ”¯ä»˜ payment_response = requests.post( f\u0026#34;{self.payment_service_url}/pay\u0026#34;, json={ \u0026#34;amount\u0026#34;: order_data[\u0026#34;total\u0026#34;], \u0026#34;user_id\u0026#34;: order_data[\u0026#34;user_id\u0026#34;] } ) if payment_response.status_code != 200: raise Exception(\u0026#34;Payment failed\u0026#34;) return {\u0026#34;order_id\u0026#34;: \u0026#34;ORD-123\u0026#34;, \u0026#34;status\u0026#34;: \u0026#34;created\u0026#34;} # å¼‚æ­¥é€šä¿¡ç¤ºä¾‹ - æ¶ˆæ¯é˜Ÿåˆ— import asyncio import aiokafka import json class AsyncOrderService: def __init__(self): self.order_events_topic = \u0026#34;order-events\u0026#34; self.producer = None async def start(self): \u0026#34;\u0026#34;\u0026#34;åˆå§‹åŒ–ç”Ÿäº§è€…\u0026#34;\u0026#34;\u0026#34; self.producer = aiokafka.AIOKafkaProducer( bootstrap_servers=\u0026#39;kafka:9092\u0026#39;, value_serializer=lambda v: json.dumps(v).encode(\u0026#39;utf-8\u0026#39;) ) await self.producer.start() async def create_order_async(self, order_data): \u0026#34;\u0026#34;\u0026#34;å¼‚æ­¥åˆ›å»ºè®¢å•\u0026#34;\u0026#34;\u0026#34; # åˆ›å»ºè®¢å•è®°å½• order = await self.save_order(order_data) # å‘å¸ƒäº‹ä»¶ await self.publish_event({ \u0026#34;event_type\u0026#34;: \u0026#34;order_created\u0026#34;, \u0026#34;order_id\u0026#34;: order[\u0026#34;id\u0026#34;], \u0026#34;user_id\u0026#34;: order[\u0026#34;user_id\u0026#34;], \u0026#34;items\u0026#34;: order[\u0026#34;items\u0026#34;] }) return order async def publish_event(self, event): \u0026#34;\u0026#34;\u0026#34;å‘å¸ƒäº‹ä»¶\u0026#34;\u0026#34;\u0026#34; await self.producer.send( topic=self.order_events_topic, value=event ) åŒæ­¥é€šä¿¡æ¨¡å¼ 1. RESTful API 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 # user_service.py - ç”¨æˆ·æœåŠ¡ from fastapi import FastAPI, HTTPException, Depends from pydantic import BaseModel from typing import List app = FastAPI(title=\u0026#34;User Service\u0026#34;) class User(BaseModel): id: int name: str email: str address: str class UserService: def __init__(self): self.users_db = {} def get_user(self, user_id: int): \u0026#34;\u0026#34;\u0026#34;è·å–ç”¨æˆ·\u0026#34;\u0026#34;\u0026#34; user = self.users_db.get(user_id) if not user: raise HTTPException(status_code=404, detail=\u0026#34;User not found\u0026#34;) return user def create_user(self, user: User): \u0026#34;\u0026#34;\u0026#34;åˆ›å»ºç”¨æˆ·\u0026#34;\u0026#34;\u0026#34; if user.id in self.users_db: raise HTTPException(status_code=400, detail=\u0026#34;User already exists\u0026#34;) self.users_db[user.id] = user return user user_service = UserService() @app.get(\u0026#34;/users/{user_id}\u0026#34;) async def get_user(user_id: int): return user_service.get_user(user_id) @app.post(\u0026#34;/users\u0026#34;) async def create_user(user: User): return user_service.create_user(user) # order_service.py - è®¢å•æœåŠ¡ï¼ˆæ¶ˆè´¹è€…ï¼‰ class OrderService: def __init__(self): self.user_service = UserClient() class UserClient: def __init__(self, base_url=\u0026#34;http://user-service:8001\u0026#34;): self.base_url = base_url self.session = requests.Session() def get_user(self, user_id: int): \u0026#34;\u0026#34;\u0026#34;è·å–ç”¨æˆ·ä¿¡æ¯\u0026#34;\u0026#34;\u0026#34; response = self.session.get(f\u0026#34;{self.base_url}/users/{user_id}\u0026#34;) if response.status_code == 404: return None response.raise_for_status() return response.json() def update_user_credit(self, user_id: int, amount: float): \u0026#34;\u0026#34;\u0026#34;æ›´æ–°ç”¨æˆ·ä¿¡ç”¨é¢åº¦\u0026#34;\u0026#34;\u0026#34; response = self.session.patch( f\u0026#34;{self.base_url}/users/{user_id}/credit\u0026#34;, json={\u0026#34;amount\u0026#34;: amount} ) response.raise_for_status() return response.json() 2. gRPCé€šä¿¡ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 // user.proto - Protocol Bufferså®šä¹‰ syntax = \u0026#34;proto3\u0026#34;; package user; service UserService { rpc GetUser(GetUserRequest) returns (UserResponse); rpc CreateUser(CreateUserRequest) returns (UserResponse); rpc UpdateUser(UpdateUserRequest) returns (UserResponse); } message GetUserRequest { int32 user_id = 1; } message CreateUserRequest { string name = 1; string email = 2; string address = 3; } message UpdateUserRequest { int32 user_id = 1; optional string name = 2; optional string email = 3; optional string address = 4; } message UserResponse { int32 id = 1; string name = 2; string email = 3; string address = 4; } 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 # user_service_server.py - gRPCæœåŠ¡ç«¯ import grpc from concurrent import futures import user_pb2 import user_pb2_grpc class UserServiceImpl(user_pb2_grpc.UserServiceServicer): def __init__(self): self.users = {} def GetUser(self, request, context): user = self.users.get(request.user_id) if not user: context.set_code(grpc.StatusCode.NOT_FOUND) context.set_details(\u0026#34;User not found\u0026#34;) return user_pb2.UserResponse() return user_pb2.UserResponse( id=user[\u0026#39;id\u0026#39;], name=user[\u0026#39;name\u0026#39;], email=user[\u0026#39;email\u0026#39;], address=user[\u0026#39;address\u0026#39;] ) def CreateUser(self, request, context): user_id = len(self.users) + 1 user = { \u0026#39;id\u0026#39;: user_id, \u0026#39;name\u0026#39;: request.name, \u0026#39;email\u0026#39;: request.email, \u0026#39;address\u0026#39;: request.address } self.users[user_id] = user return user_pb2.UserResponse(**user) def serve(): server = grpc.server(futures.ThreadPoolExecutor(max_workers=10)) user_pb2_grpc.add_UserServiceServicer_to_server( UserServiceImpl(), server ) server.add_insecure_port(\u0026#39;[::]:50051\u0026#39;) server.start() server.wait_for_termination() # order_service_client.py - gRPCå®¢æˆ·ç«¯ import grpc import user_pb2 import user_pb2_grpc class OrderServiceClient: def __init__(self): self.channel = grpc.insecure_channel(\u0026#39;user-service:50051\u0026#39;) self.stub = user_pb2_grpc.UserServiceStub(self.channel) def get_user(self, user_id): \u0026#34;\u0026#34;\u0026#34;è·å–ç”¨æˆ·ä¿¡æ¯\u0026#34;\u0026#34;\u0026#34; try: response = self.stub.GetUser( user_pb2.GetUserRequest(user_id=user_id) ) return { \u0026#39;id\u0026#39;: response.id, \u0026#39;name\u0026#39;: response.name, \u0026#39;email\u0026#39;: response.email, \u0026#39;address\u0026#39;: response.address } except grpc.RpcError as e: if e.code() == grpc.StatusCode.NOT_FOUND: return None raise å¼‚æ­¥é€šä¿¡æ¨¡å¼ 1. äº‹ä»¶é©±åŠ¨æ¶æ„ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 # event_store.py - äº‹ä»¶å­˜å‚¨ from abc import ABC, abstractmethod from typing import List, Dict, Any from datetime import datetime import asyncio import json class Event(ABC): def __init__(self, aggregate_id: str, event_id: str = None): self.aggregate_id = aggregate_id self.event_id = event_id or str(uuid.uuid4()) self.timestamp = datetime.utcnow() def to_dict(self) -\u0026gt; Dict[str, Any]: return { \u0026#39;event_type\u0026#39;: self.__class__.__name__, \u0026#39;aggregate_id\u0026#39;: self.aggregate_id, \u0026#39;event_id\u0026#39;: self.event_id, \u0026#39;timestamp\u0026#39;: self.timestamp.isoformat(), \u0026#39;data\u0026#39;: self.__dict__ } class OrderCreated(Event): def __init__(self, order_id: str, user_id: str, items: List[Dict]): super().__init__(order_id) self.order_id = order_id self.user_id = user_id self.items = items class OrderPaid(Event): def __init__(self, order_id: str, payment_id: str, amount: float): super().__init__(order_id) self.order_id = order_id self.payment_id = payment_id self.amount = amount # event_handler.py - äº‹ä»¶å¤„ç†å™¨ class EventHandler(ABC): @abstractmethod async def handle(self, event: Event): pass class OrderEventHandler(EventHandler): async def handle(self, event: Event): if isinstance(event, OrderCreated): await self.handle_order_created(event) elif isinstance(event, OrderPaid): await self.handle_order_paid(event) async def handle_order_created(self, event: OrderCreated): \u0026#34;\u0026#34;\u0026#34;å¤„ç†è®¢å•åˆ›å»ºäº‹ä»¶\u0026#34;\u0026#34;\u0026#34; # å‘é€è®¢å•ç¡®è®¤é‚®ä»¶ await self.send_confirmation_email(event) # æ›´æ–°åº“å­˜ await self.update_inventory(event) # è®°å½•å®¡è®¡æ—¥å¿— await self.log_audit_event(event) async def handle_order_paid(self, event: OrderPaid): \u0026#34;\u0026#34;\u0026#34;å¤„ç†è®¢å•æ”¯ä»˜äº‹ä»¶\u0026#34;\u0026#34;\u0026#34; # æ›´æ–°è®¢å•çŠ¶æ€ await self.update_order_status(event.order_id, \u0026#39;paid\u0026#39;) # è§¦å‘å‘è´§æµç¨‹ await self.initiate_shipping(event) 2. æ¶ˆæ¯é˜Ÿåˆ—å®ç° 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 # message_broker.py - æ¶ˆæ¯ä»£ç† import aiokafka import asyncio import json from typing import Dict, List, Callable class MessageBroker: def __init__(self, bootstrap_servers: str): self.bootstrap_servers = bootstrap_servers self.producer = None self.consumers: Dict[str, List[Callable]] = {} async def start(self): \u0026#34;\u0026#34;\u0026#34;å¯åŠ¨æ¶ˆæ¯ä»£ç†\u0026#34;\u0026#34;\u0026#34; self.producer = aiokafka.AIOKafkaProducer( bootstrap_servers=self.bootstrap_servers, value_serializer=lambda v: json.dumps(v).encode(\u0026#39;utf-8\u0026#39;) ) await self.producer.start() async def stop(self): \u0026#34;\u0026#34;\u0026#34;åœæ­¢æ¶ˆæ¯ä»£ç†\u0026#34;\u0026#34;\u0026#34; if self.producer: await self.producer.stop() async def publish(self, topic: str, message: Dict): \u0026#34;\u0026#34;\u0026#34;å‘å¸ƒæ¶ˆæ¯\u0026#34;\u0026#34;\u0026#34; await self.producer.send(topic, message) def subscribe(self, topic: str, handler: Callable): \u0026#34;\u0026#34;\u0026#34;è®¢é˜…æ¶ˆæ¯\u0026#34;\u0026#34;\u0026#34; if topic not in self.consumers: self.consumers[topic] = [] self.consumers[topic].append(handler) async def start_consuming(self, topics: List[str]): \u0026#34;\u0026#34;\u0026#34;å¼€å§‹æ¶ˆè´¹æ¶ˆæ¯\u0026#34;\u0026#34;\u0026#34; consumer = aiokafka.AIOKafkaConsumer( *topics, bootstrap_servers=self.bootstrap_servers, value_deserializer=lambda v: json.loads(v.decode(\u0026#39;utf-8\u0026#39;)) ) await consumer.start() try: async for msg in consumer: handlers = self.consumers.get(msg.topic, []) for handler in handlers: await handler(msg.value) finally: await consumer.stop() # ä½¿ç”¨ç¤ºä¾‹ class OrderService: def __init__(self, broker: MessageBroker): self.broker = broker async def create_order(self, order_data: Dict): \u0026#34;\u0026#34;\u0026#34;åˆ›å»ºè®¢å•\u0026#34;\u0026#34;\u0026#34; # ä¿å­˜è®¢å•åˆ°æ•°æ®åº“ order = await self.save_order(order_data) # å‘å¸ƒäº‹ä»¶ event = OrderCreated( order_id=order[\u0026#39;id\u0026#39;], user_id=order[\u0026#39;user_id\u0026#39;], items=order[\u0026#39;items\u0026#39;] ) await self.broker.publish( topic=\u0026#39;order-events\u0026#39;, message=event.to_dict() ) return order class NotificationService: def __init__(self, broker: MessageBroker): self.broker = broker self.broker.subscribe(\u0026#39;order-events\u0026#39;, self.handle_order_event) async def handle_order_event(self, event_data: Dict): \u0026#34;\u0026#34;\u0026#34;å¤„ç†è®¢å•äº‹ä»¶\u0026#34;\u0026#34;\u0026#34; event_type = event_data[\u0026#39;event_type\u0026#39;] data = event_data[\u0026#39;data\u0026#39;] if event_type == \u0026#39;OrderCreated\u0026#39;: await self.send_order_confirmation(data) elif event_type == \u0026#39;OrderPaid\u0026#39;: await self.send_payment_confirmation(data) APIç½‘å…³æ¨¡å¼ 1. ç½‘å…³å®ç° 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 # api_gateway.py - APIç½‘å…³ from fastapi import FastAPI, Request, HTTPException from fastapi.responses import Response import httpx import asyncio from typing import Dict class APIGateway: def __init__(self): self.app = FastAPI(title=\u0026#34;API Gateway\u0026#34;) self.services = { \u0026#39;user\u0026#39;: \u0026#39;http://user-service:8001\u0026#39;, \u0026#39;order\u0026#39;: \u0026#39;http://order-service:8002\u0026#39;, \u0026#39;payment\u0026#39;: \u0026#39;http://payment-service:8003\u0026#39;, \u0026#39;inventory\u0026#39;: \u0026#39;http://inventory-service:8004\u0026#39; } self.setup_routes() def setup_routes(self): \u0026#34;\u0026#34;\u0026#34;è®¾ç½®è·¯ç”±\u0026#34;\u0026#34;\u0026#34; @self.app.api_route(\u0026#34;/{service}/{path:path}\u0026#34;, methods=[\u0026#34;GET\u0026#34;, \u0026#34;POST\u0026#34;, \u0026#34;PUT\u0026#34;, \u0026#34;DELETE\u0026#34;]) async def proxy_request(service: str, path: str, request: Request): if service not in self.services: raise HTTPException(status_code=404, detail=\u0026#34;Service not found\u0026#34;) service_url = self.services[service] url = f\u0026#34;{service_url}/{path}\u0026#34; # è½¬å‘è¯·æ±‚ async with httpx.AsyncClient() as client: response = await client.request( method=request.method, url=url, headers=dict(request.headers), content=await request.body(), params=request.query_params ) return Response( content=response.content, status_code=response.status_code, headers=dict(response.headers) ) @self.app.post(\u0026#34;/orders\u0026#34;) async def create_order_aggregated(request: Request): \u0026#34;\u0026#34;\u0026#34;èšåˆåˆ›å»ºè®¢å•\u0026#34;\u0026#34;\u0026#34; order_data = await request.json() # éªŒè¯ç”¨æˆ· async with httpx.AsyncClient() as client: user_response = await client.get( f\u0026#34;{self.services[\u0026#39;user\u0026#39;]}/users/{order_data[\u0026#39;user_id\u0026#39;]}\u0026#34; ) if user_response.status_code != 200: raise HTTPException(status_code=400, detail=\u0026#34;Invalid user\u0026#34;) # æ£€æŸ¥åº“å­˜ async with httpx.AsyncClient() as client: inventory_response = await client.post( f\u0026#34;{self.services[\u0026#39;inventory\u0026#39;]}/check\u0026#34;, json={\u0026#34;items\u0026#34;: order_data[\u0026#34;items\u0026#34;]} ) if inventory_response.status_code != 200: raise HTTPException(status_code=400, detail=\u0026#34;Insufficient inventory\u0026#34;) # åˆ›å»ºè®¢å• async with httpx.AsyncClient() as client: order_response = await client.post( f\u0026#34;{self.services[\u0026#39;order\u0026#39;]}/orders\u0026#34;, json=order_data ) return Response( content=order_response.content, status_code=order_response.status_code, headers=dict(order_response.headers) ) # å¯åŠ¨ç½‘å…³ gateway = APIGateway() app = gateway.app 2. è®¤è¯å’Œæˆæƒ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 # auth_middleware.py - è®¤è¯ä¸­é—´ä»¶ import jwt import functools from fastapi import HTTPException, Request, Depends from fastapi.security import HTTPBearer security = HTTPBearer() class AuthMiddleware: def __init__(self, secret_key: str): self.secret_key = secret_key def verify_token(self, token: str) -\u0026gt; Dict: \u0026#34;\u0026#34;\u0026#34;éªŒè¯JWTä»¤ç‰Œ\u0026#34;\u0026#34;\u0026#34; try: payload = jwt.decode(token, self.secret_key, algorithms=[\u0026#34;HS256\u0026#34;]) return payload except jwt.ExpiredSignatureError: raise HTTPException(status_code=401, detail=\u0026#34;Token has expired\u0026#34;) except jwt.InvalidTokenError: raise HTTPException(status_code=401, detail=\u0026#34;Invalid token\u0026#34;) def require_auth(self, required_permissions: List[str] = None): \u0026#34;\u0026#34;\u0026#34;æƒé™æ£€æŸ¥è£…é¥°å™¨\u0026#34;\u0026#34;\u0026#34; def decorator(func): @functools.wraps(func) async def wrapper(request: Request, *args, **kwargs): # æå–ä»¤ç‰Œ authorization = request.headers.get(\u0026#34;Authorization\u0026#34;) if not authorization: raise HTTPException(status_code=401, detail=\u0026#34;No token provided\u0026#34;) token = authorization.split(\u0026#34; \u0026#34;)[1] # éªŒè¯ä»¤ç‰Œ payload = self.verify_token(token) # æ£€æŸ¥æƒé™ if required_permissions: user_permissions = payload.get(\u0026#34;permissions\u0026#34;, []) if not all(perm in user_permissions for perm in required_permissions): raise HTTPException(status_code=403, detail=\u0026#34;Insufficient permissions\u0026#34;) # å°†ç”¨æˆ·ä¿¡æ¯æ·»åŠ åˆ°è¯·æ±‚ä¸Šä¸‹æ–‡ request.state.user = payload return await func(request, *args, **kwargs) return wrapper return decorator # ä½¿ç”¨ç¤ºä¾‹ gateway = APIGateway() auth = AuthMiddleware(secret_key=\u0026#34;your-secret-key\u0026#34;) @gateway.app.post(\u0026#34;/admin/orders\u0026#34;) @auth.require_auth([\u0026#34;admin:orders\u0026#34;]) async def admin_create_order(request: Request): \u0026#34;\u0026#34;\u0026#34;ç®¡ç†å‘˜åˆ›å»ºè®¢å•\u0026#34;\u0026#34;\u0026#34; user = request.state.user # ç®¡ç†å‘˜é€»è¾‘ pass æœåŠ¡ç½‘æ ¼ 1. Istioé…ç½®ç¤ºä¾‹ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 # istio-gateway.yaml - ç½‘å…³é…ç½® apiVersion: networking.istio.io/v1beta1 kind: Gateway metadata: name: myapp-gateway spec: selector: istio: ingressgateway servers: - port: number: 80 name: http protocol: HTTP hosts: - myapp.example.com - port: number: 443 name: https protocol: HTTPS tls: mode: SIMPLE credentialName: myapp-tls hosts: - myapp.example.com --- apiVersion: networking.istio.io/v1beta1 kind: VirtualService metadata: name: myapp-vs spec: hosts: - myapp.example.com gateways: - myapp-gateway http: - match: - uri: prefix: \u0026#34;/api/v1/users\u0026#34; route: - destination: host: user-service port: number: 8000 timeout: 5s retries: attempts: 3 perTryTimeout: 2s - match: - uri: prefix: \u0026#34;/api/v1/orders\u0026#34; route: - destination: host: order-service port: number: 8000 fault: delay: percentage: value: 0.1 fixedDelay: 5s 2. æœåŠ¡é—´é€šä¿¡é…ç½® 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 # destination-rule.yaml - ç›®æ ‡è§„åˆ™ apiVersion: networking.istio.io/v1beta1 kind: DestinationRule metadata: name: user-service-dr spec: host: user-service trafficPolicy: connectionPool: tcp: maxConnections: 100 http: http1MaxPendingRequests: 50 maxRequestsPerConnection: 10 loadBalancer: simple: LEAST_CONN outlierDetection: consecutiveErrors: 3 interval: 30s baseEjectionTime: 30s --- apiVersion: networking.istio.io/v1beta1 kind: DestinationRule metadata: name: order-service-dr spec: host: order-service trafficPolicy: connectionPool: tcp: maxConnections: 50 http: http1MaxPendingRequests: 25 circuitBreaker: consecutiveErrors: 5 interval: 30s baseEjectionTime: 30s æ€§èƒ½ä¼˜åŒ– 1. è¿æ¥æ± ä¼˜åŒ– 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 # connection_pool.py - è¿æ¥æ± é…ç½® import httpx import asyncio from typing import Optional class ServiceClient: def __init__(self, base_url: str): self.base_url = base_url self.client = None async def __aenter__(self): self.client = httpx.AsyncClient( base_url=self.base_url, limits=httpx.Limits( max_keepalive_connections=20, max_connections=100, keepalive_expiry=30 ), timeout=httpx.Timeout(5.0, read=30.0) ) return self async def __aexit__(self, exc_type, exc_val, exc_tb): await self.client.aclose() async def get(self, path: str, params: Optional[Dict] = None): \u0026#34;\u0026#34;\u0026#34;GETè¯·æ±‚\u0026#34;\u0026#34;\u0026#34; response = await self.client.get(path, params=params) response.raise_for_status() return response.json() async def post(self, path: str, data: Optional[Dict] = None): \u0026#34;\u0026#34;\u0026#34;POSTè¯·æ±‚\u0026#34;\u0026#34;\u0026#34; response = await self.client.post(path, json=data) response.raise_for_status() return response.json() # ä½¿ç”¨ç¤ºä¾‹ class OrderService: async def get_user_info(self, user_id: int): \u0026#34;\u0026#34;\u0026#34;è·å–ç”¨æˆ·ä¿¡æ¯\u0026#34;\u0026#34;\u0026#34; async with ServiceClient(\u0026#34;http://user-service:8001\u0026#34;) as client: return await client.get(f\u0026#34;/users/{user_id}\u0026#34;) async def create_payment(self, order_data: Dict): \u0026#34;\u0026#34;\u0026#34;åˆ›å»ºæ”¯ä»˜\u0026#34;\u0026#34;\u0026#34; async with ServiceClient(\u0026#34;http://payment-service:8002\u0026#34;) as client: return await client.post(\u0026#34;/payments\u0026#34;, order_data) 2. ç¼“å­˜ç­–ç•¥ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 # cache_layer.py - ç¼“å­˜å±‚ import redis import json import hashlib from functools import wraps from typing import Any, Optional class CacheLayer: def __init__(self, redis_url: str): self.redis_client = redis.from_url(redis_url) def cache_result(self, ttl: int = 300): \u0026#34;\u0026#34;\u0026#34;ç¼“å­˜è£…é¥°å™¨\u0026#34;\u0026#34;\u0026#34; def decorator(func): @wraps(func) async def wrapper(*args, **kwargs): # ç”Ÿæˆç¼“å­˜é”® cache_key = self._generate_cache_key( func.__name__, args, kwargs ) # å°è¯•ä»ç¼“å­˜è·å– cached_result = self.redis_client.get(cache_key) if cached_result: return json.loads(cached_result) # æ‰§è¡Œå‡½æ•° result = await func(*args, **kwargs) # å­˜å…¥ç¼“å­˜ self.redis_client.setex( cache_key, ttl, json.dumps(result, default=str) ) return result return wrapper return decorator def _generate_cache_key(self, func_name: str, args, kwargs) -\u0026gt; str: \u0026#34;\u0026#34;\u0026#34;ç”Ÿæˆç¼“å­˜é”®\u0026#34;\u0026#34;\u0026#34; key_data = f\u0026#34;{func_name}:{str(args)}:{str(kwargs)}\u0026#34; return hashlib.md5(key_data.encode()).hexdigest() def invalidate_pattern(self, pattern: str): \u0026#34;\u0026#34;\u0026#34;ä½¿åŒ¹é…æ¨¡å¼çš„æ‰€æœ‰ç¼“å­˜å¤±æ•ˆ\u0026#34;\u0026#34;\u0026#34; keys = self.redis_client.keys(pattern) if keys: self.redis_client.delete(*keys) # ä½¿ç”¨ç¤ºä¾‹ cache = CacheLayer(\u0026#34;redis://localhost:6379\u0026#34;) class UserService: @cache.cache_result(ttl=600) async def get_user(self, user_id: int): \u0026#34;\u0026#34;\u0026#34;è·å–ç”¨æˆ·ï¼ˆå¸¦ç¼“å­˜ï¼‰\u0026#34;\u0026#34;\u0026#34; # å®é™…çš„æ•°æ®åº“æŸ¥è¯¢ pass @cache.cache_result(ttl=3600) async def get_user_preferences(self, user_id: int): \u0026#34;\u0026#34;\u0026#34;è·å–ç”¨æˆ·åå¥½ï¼ˆå¸¦ç¼“å­˜ï¼‰\u0026#34;\u0026#34;\u0026#34; # å®é™…çš„æ•°æ®åº“æŸ¥è¯¢ pass ç›‘æ§å’Œè¿½è¸ª 1. åˆ†å¸ƒå¼è¿½è¸ª 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 # tracing.py - åˆ†å¸ƒå¼è¿½è¸ª from opentelemetry import trace from opentelemetry.exporter.jaeger.thrift import JaegerExporter from opentelemetry.sdk.trace import TracerProvider from opentelemetry.sdk.trace.export import BatchSpanProcessor from opentelemetry.instrumentation.httpx import HTTPXClientInstrumentor from opentelemetry.instrumentation.fastapi import FastAPIInstrumentor import functools class TracingManager: def __init__(self, service_name: str): self.service_name = service_name self.setup_tracing() def setup_tracing(self): \u0026#34;\u0026#34;\u0026#34;è®¾ç½®è¿½è¸ª\u0026#34;\u0026#34;\u0026#34; trace.set_tracer_provider(TracerProvider()) tracer = trace.get_tracer(__name__) # é…ç½®Jaegerå¯¼å‡ºå™¨ jaeger_exporter = JaegerExporter( agent_host_name=\u0026#34;jaeger-agent\u0026#34;, agent_port=6831, ) span_processor = BatchSpanProcessor(jaeger_exporter) trace.get_tracer_provider().add_span_processor(span_processor) # è‡ªåŠ¨instrumentation HTTPXClientInstrumentor().instrument() FastAPIInstrumentor.instrument() def trace_function(self, name: str = None): \u0026#34;\u0026#34;\u0026#34;å‡½æ•°è¿½è¸ªè£…é¥°å™¨\u0026#34;\u0026#34;\u0026#34; def decorator(func): @functools.wraps(func) async def wrapper(*args, **kwargs): tracer = trace.get_tracer(__name__) span_name = name or f\u0026#34;{func.__module__}.{func.__name__}\u0026#34; with tracer.start_as_current_span(span_name) as span: span.set_attribute(\u0026#34;service.name\u0026#34;, self.service_name) span.set_attribute(\u0026#34;function.name\u0026#34;, func.__name__) try: result = await func(*args, **kwargs) span.set_attribute(\u0026#34;success\u0026#34;, True) return result except Exception as e: span.set_attribute(\u0026#34;success\u0026#34;, False) span.set_attribute(\u0026#34;error.message\u0026#34;, str(e)) raise return wrapper return decorator # ä½¿ç”¨ç¤ºä¾‹ tracing = TracingManager(\u0026#34;order-service\u0026#34;) class OrderService: @tracing.trace_function(\u0026#34;create_order\u0026#34;) async def create_order(self, order_data: Dict): \u0026#34;\u0026#34;\u0026#34;åˆ›å»ºè®¢å•ï¼ˆå¸¦è¿½è¸ªï¼‰\u0026#34;\u0026#34;\u0026#34; # åˆ›å»ºè®¢å•é€»è¾‘ pass @tracing.trace_function(\u0026#34;process_payment\u0026#34;) async def process_payment(self, order_id: str, amount: float): \u0026#34;\u0026#34;\u0026#34;å¤„ç†æ”¯ä»˜ï¼ˆå¸¦è¿½è¸ªï¼‰\u0026#34;\u0026#34;\u0026#34; # æ”¯ä»˜å¤„ç†é€»è¾‘ pass æœ€ä½³å®è·µ é€‰æ‹©åˆé€‚çš„é€šä¿¡æ¨¡å¼ï¼šæ ¹æ®ä¸šåŠ¡éœ€æ±‚é€‰æ‹©åŒæ­¥æˆ–å¼‚æ­¥ å®ç°ç†”æ–­æœºåˆ¶ï¼šé˜²æ­¢çº§è”æ•…éšœ ä½¿ç”¨APIç½‘å…³ï¼šç»Ÿä¸€å…¥å£å’Œè·¯ç”± å®æ–½ç›‘æ§ï¼šå…¨é¢çš„æ€§èƒ½å’Œé”™è¯¯ç›‘æ§ è®¾è®¡å¹‚ç­‰æ€§ï¼šç¡®ä¿é‡è¯•å®‰å…¨ æ€»ç»“ å¾®æœåŠ¡é€šä¿¡çš„å…³é”®æ¨¡å¼ï¼š\nåŒæ­¥é€šä¿¡ï¼šREST APIã€gRPCé€‚åˆå®æ—¶äº¤äº’ å¼‚æ­¥é€šä¿¡ï¼šæ¶ˆæ¯é˜Ÿåˆ—ã€äº‹ä»¶é©±åŠ¨å®ç°è§£è€¦ APIç½‘å…³ï¼šç»Ÿä¸€å…¥å£å’Œè·¯ç”±ç®¡ç† æœåŠ¡ç½‘æ ¼ï¼šé«˜çº§æµé‡ç®¡ç†å’Œå®‰å…¨ ç›‘æ§è¿½è¸ªï¼šç¡®ä¿ç³»ç»Ÿå¯è§‚æµ‹æ€§ åˆç†ä½¿ç”¨è¿™äº›æ¨¡å¼å¯ä»¥æ„å»ºå¥å£®ã€å¯æ‰©å±•çš„å¾®æœåŠ¡æ¶æ„ã€‚\nç›¸å…³èµ„æº å¾®æœåŠ¡æ¨¡å¼æ–‡æ¡£ Istioå®˜æ–¹æ–‡æ¡£ OpenTelemetryè§„èŒƒ ","permalink":"/blog/articles/microservices-communication-patterns/","summary":"æŒæ¡å¾®æœåŠ¡é€šä¿¡çš„æ ¸å¿ƒæ¨¡å¼ï¼Œæ„å»ºé«˜æ•ˆå¯é çš„åˆ†å¸ƒå¼ç³»ç»Ÿã€‚","title":"å¾®æœåŠ¡é€šä¿¡æ¨¡å¼æ·±åº¦è§£æ"},{"content":"AWS Lambdaæ€§èƒ½ä¼˜åŒ–å®Œå…¨æŒ‡å— AWS Lambdaä½œä¸ºæ— æœåŠ¡å™¨è®¡ç®—çš„æ ¸å¿ƒæœåŠ¡ï¼Œå…¶æ€§èƒ½ä¼˜åŒ–å¯¹äºæ„å»ºé«˜æ•ˆåº”ç”¨è‡³å…³é‡è¦ã€‚æœ¬æ–‡å°†æ·±å…¥æ¢è®¨å„ç§ä¼˜åŒ–ç­–ç•¥ï¼Œå¸®åŠ©æ‚¨å……åˆ†å‘æŒ¥Lambdaçš„æ½œåŠ›ã€‚\nå†·å¯åŠ¨ä¼˜åŒ– 1. ç†è§£å†·å¯åŠ¨ å†·å¯åŠ¨æ˜¯æŒ‡Lambdaå‡½æ•°åœ¨ä¸€æ®µæ—¶é—´æœªè¢«è°ƒç”¨åï¼Œé¦–æ¬¡æ‰§è¡Œæ—¶çš„åˆå§‹åŒ–è¿‡ç¨‹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 # lambda_function.py - ä¼˜åŒ–åˆå§‹åŒ–ä»£ç  import json import boto3 import os # åœ¨å…¨å±€èŒƒå›´åˆå§‹åŒ–SDKå’Œè¿æ¥ s3_client = boto3.client(\u0026#39;s3\u0026#39;) dynamodb = boto3.resource(\u0026#39;dynamodb\u0026#39;) # é¢„çƒ­è¿æ¥ table = dynamodb.Table(os.environ[\u0026#39;TABLE_NAME\u0026#39;]) # ç¼“å­˜é…ç½® CONFIG = { \u0026#39;bucket_name\u0026#39;: os.environ[\u0026#39;BUCKET_NAME\u0026#39;], \u0026#39;max_retries\u0026#39;: 3 } def lambda_handler(event, context): \u0026#34;\u0026#34;\u0026#34;å¤„ç†Lambdaè¯·æ±‚\u0026#34;\u0026#34;\u0026#34; try: # å‡½æ•°é€»è¾‘ result = process_event(event) return { \u0026#39;statusCode\u0026#39;: 200, \u0026#39;body\u0026#39;: json.dumps(result) } except Exception as e: return { \u0026#39;statusCode\u0026#39;: 500, \u0026#39;body\u0026#39;: json.dumps({\u0026#39;error\u0026#39;: str(e)}) } def process_event(event): \u0026#34;\u0026#34;\u0026#34;å¤„ç†äº‹ä»¶é€»è¾‘\u0026#34;\u0026#34;\u0026#34; # ä¸šåŠ¡é€»è¾‘ pass 2. é¢„çƒ­ç­–ç•¥ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 # warmer.py - Lambdaé¢„çƒ­å‡½æ•° import json import boto3 import time lambda_client = boto3.client(\u0026#39;lambda\u0026#39;) def warmup_handler(event, context): \u0026#34;\u0026#34;\u0026#34;é¢„çƒ­Lambdaå‡½æ•°\u0026#34;\u0026#34;\u0026#34; function_names = [ \u0026#39;my-app-api-handler\u0026#39;, \u0026#39;my-app-processor\u0026#39;, \u0026#39;my-app-notifier\u0026#39; ] for function_name in function_names: # å‘é€é¢„çƒ­è¯·æ±‚ try: lambda_client.invoke( FunctionName=function_name, InvocationType=\u0026#39;Event\u0026#39;, # å¼‚æ­¥è°ƒç”¨ Payload=json.dumps({\u0026#39;warmup\u0026#39;: True}) ) except Exception as e: print(f\u0026#34;Failed to warm up {function_name}: {e}\u0026#34;) return { \u0026#39;statusCode\u0026#39;: 200, \u0026#39;body\u0026#39;: json.dumps({\u0026#39;message\u0026#39;: \u0026#39;Warmup completed\u0026#39;}) } # ä½¿ç”¨EventBridgeå®šæœŸé¢„çƒ­ # æ¯5åˆ†é’Ÿæ‰§è¡Œä¸€æ¬¡é¢„çƒ­ 3. è¿è¡Œæ—¶ä¼˜åŒ– 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 // node.js - ä½¿ç”¨esbuildä¼˜åŒ–æ‰“åŒ… // build.js const esbuild = require(\u0026#39;esbuild\u0026#39;); esbuild.build({ entryPoints: [\u0026#39;index.js\u0026#39;], bundle: true, minify: true, platform: \u0026#39;node\u0026#39;, target: [\u0026#39;node14\u0026#39;], outfile: \u0026#39;dist/lambda.js\u0026#39;, external: [\u0026#39;aws-sdk\u0026#39;], define: { \u0026#39;process.env.NODE_ENV\u0026#39;: \u0026#39;\u0026#34;production\u0026#34;\u0026#39; } }).catch(() =\u0026gt; process.exit(1)); // package.json { \u0026#34;scripts\u0026#34;: { \u0026#34;build\u0026#34;: \u0026#34;node build.js\u0026#34;, \u0026#34;deploy\u0026#34;: \u0026#34;npm run build \u0026amp;\u0026amp; serverless deploy\u0026#34; } } å†…å­˜å’ŒCPUé…ç½® 1. æœ€ä¼˜å†…å­˜é…ç½® 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 # memory_optimizer.py - å†…å­˜ä¼˜åŒ–å·¥å…· import time import json import boto3 import statistics lambda_client = boto3.client(\u0026#39;lambda\u0026#39;) def test_memory_performance(function_name): \u0026#34;\u0026#34;\u0026#34;æµ‹è¯•ä¸åŒå†…å­˜é…ç½®çš„æ€§èƒ½\u0026#34;\u0026#34;\u0026#34; memory_sizes = [128, 256, 512, 1024, 2048, 3008] results = [] for memory_size in memory_sizes: # æ›´æ–°å‡½æ•°é…ç½® lambda_client.update_function_configuration( FunctionName=function_name, MemorySize=memory_size ) # ç­‰å¾…é…ç½®æ›´æ–° time.sleep(5) # æ‰§è¡Œæµ‹è¯• durations = [] for _ in range(10): start_time = time.time() response = lambda_client.invoke( FunctionName=function_name, Payload=json.dumps({\u0026#39;test\u0026#39;: True}) ) # ç­‰å¾…æ‰§è¡Œå®Œæˆ response[\u0026#39;Payload\u0026#39;].read() end_time = time.time() durations.append((end_time - start_time) * 1000) avg_duration = statistics.mean(durations) results.append({ \u0026#39;memory_size\u0026#39;: memory_size, \u0026#39;avg_duration\u0026#39;: avg_duration, \u0026#39;cost_per_invocation\u0026#39;: calculate_cost(memory_size, avg_duration) }) # æ‰¾åˆ°æ€§ä»·æ¯”æœ€ä¼˜çš„é…ç½® optimal_config = min(results, key=lambda x: x[\u0026#39;cost_per_invocation\u0026#39;]) return optimal_config, results def calculate_cost(memory_mb, duration_ms): \u0026#34;\u0026#34;\u0026#34;è®¡ç®—å•æ¬¡è°ƒç”¨æˆæœ¬\u0026#34;\u0026#34;\u0026#34; # AWS Lambda å®šä»·ï¼ˆç¤ºä¾‹ï¼‰ cost_per_mb_second = 0.0000166667 duration_seconds = duration_ms / 1000 return memory_mb * duration_seconds * cost_per_mb_second 2. åŠ¨æ€å†…å­˜è°ƒæ•´ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 # adaptive_memory.py - è‡ªé€‚åº”å†…å­˜ç®¡ç† import os import boto3 import time class AdaptiveMemoryManager: def __init__(self, function_name): self.function_name = function_name self.lambda_client = boto3.client(\u0026#39;lambda\u0026#39;) self.cloudwatch = boto3.client(\u0026#39;cloudwatch\u0026#39;) def monitor_and_adjust(self): \u0026#34;\u0026#34;\u0026#34;ç›‘æ§æ€§èƒ½å¹¶è°ƒæ•´å†…å­˜\u0026#34;\u0026#34;\u0026#34; # è·å–æ€§èƒ½æŒ‡æ ‡ metrics = self.get_performance_metrics() # æ ¹æ®æŒ‡æ ‡è°ƒæ•´å†…å­˜ new_memory = self.calculate_optimal_memory(metrics) if self.should_adjust_memory(new_memory): self.adjust_memory(new_memory) def get_performance_metrics(self): \u0026#34;\u0026#34;\u0026#34;è·å–æ€§èƒ½æŒ‡æ ‡\u0026#34;\u0026#34;\u0026#34; end_time = int(time.time()) start_time = end_time - 3600 # æœ€è¿‘1å°æ—¶ response = self.cloudwatch.get_metric_statistics( Namespace=\u0026#39;AWS/Lambda\u0026#39;, MetricName=\u0026#39;Duration\u0026#39;, Dimensions=[ { \u0026#39;Name\u0026#39;: \u0026#39;FunctionName\u0026#39;, \u0026#39;Value\u0026#39;: self.function_name } ], StartTime=start_time, EndTime=end_time, Period=60, Statistics=[\u0026#39;Average\u0026#39;, \u0026#39;Maximum\u0026#39;] ) return response[\u0026#39;Datapoints\u0026#39;] def calculate_optimal_memory(self, metrics): \u0026#34;\u0026#34;\u0026#34;è®¡ç®—æœ€ä¼˜å†…å­˜é…ç½®\u0026#34;\u0026#34;\u0026#34; if not metrics: return 512 # é»˜è®¤å€¼ # åŸºäºæœ€å¤§æ‰§è¡Œæ—¶é—´è®¡ç®—å†…å­˜éœ€æ±‚ max_duration = max(m[\u0026#39;Average\u0026#39;] for m in metrics) # æ ¹æ®ç»éªŒå…¬å¼è°ƒæ•´ if max_duration \u0026lt; 100: # 100ms return 256 elif max_duration \u0026lt; 500: return 512 elif max_duration \u0026lt; 1500: return 1024 else: return 2048 å¹¶å‘æ§åˆ¶ 1. é¢„ç•™å¹¶å‘ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 # concurrent_control.py - å¹¶å‘æ§åˆ¶é…ç½® import boto3 lambda_client = boto3.client(\u0026#39;lambda\u0026#39;) def configure_reserved_concurrency(): \u0026#34;\u0026#34;\u0026#34;é…ç½®é¢„ç•™å¹¶å‘\u0026#34;\u0026#34;\u0026#34; functions = { \u0026#39;critical-api\u0026#39;: 100, # å…³é”®API \u0026#39;batch-processor\u0026#39;: 50, # æ‰¹å¤„ç†ä»»åŠ¡ \u0026#39;notification-sender\u0026#39;: 20 # é€šçŸ¥å‘é€ } for function_name, concurrency in functions.items(): lambda_client.put_function_concurrency( FunctionName=function_name, ReservedConcurrentExecutions=concurrency ) print(f\u0026#34;Set {concurrency} reserved concurrency for {function_name}\u0026#34;) def configure_provisioned_concurrency(): \u0026#34;\u0026#34;\u0026#34;é…ç½®é¢„ç½®å¹¶å‘ï¼ˆç”¨äºåˆ«åï¼‰\u0026#34;\u0026#34;\u0026#34; lambda_client.put_provisioned_concurrency_config( FunctionName=\u0026#39;my-api-function\u0026#39;, Qualifier=\u0026#39;production\u0026#39;, ProvisionedConcurrentExecutions=50 ) # Serverless Frameworké…ç½® # serverless.yml service: my-app provider: name: aws runtime: python3.9 functions: criticalFunction: handler: handler.main reservedConcurrency: 10 provisionedConcurrency: 5 events: - http: path: /critical method: get 2. é™æµå’Œé™çº§ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 # rate_limiter.py - é™æµå®ç° import time import json from collections import defaultdict import threading class RateLimiter: def __init__(self, max_requests, time_window): self.max_requests = max_requests self.time_window = time_window self.requests = defaultdict(list) self.lock = threading.Lock() def is_allowed(self, key): \u0026#34;\u0026#34;\u0026#34;æ£€æŸ¥æ˜¯å¦å…è®¸è¯·æ±‚\u0026#34;\u0026#34;\u0026#34; with self.lock: now = time.time() # æ¸…ç†è¿‡æœŸè¯·æ±‚ self.requests[key] = [ req_time for req_time in self.requests[key] if now - req_time \u0026lt; self.time_window ] # æ£€æŸ¥æ˜¯å¦è¶…è¿‡é™åˆ¶ if len(self.requests[key]) \u0026gt;= self.max_requests: return False # è®°å½•æ–°è¯·æ±‚ self.requests[key].append(now) return True # åœ¨Lambdaä¸­ä½¿ç”¨ rate_limiter = RateLimiter(max_requests=100, time_window=60) def lambda_handler(event, context): client_ip = event[\u0026#39;requestContext\u0026#39;][\u0026#39;identity\u0026#39;][\u0026#39;sourceIp\u0026#39;] if not rate_limiter.is_allowed(client_ip): return { \u0026#39;statusCode\u0026#39;: 429, \u0026#39;body\u0026#39;: json.dumps({\u0026#39;error\u0026#39;: \u0026#39;Too many requests\u0026#39;}) } # å¤„ç†æ­£å¸¸è¯·æ±‚ pass ä»£ç ä¼˜åŒ– 1. å¼‚æ­¥å¤„ç† 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 # async_handler.py - å¼‚æ­¥å¤„ç†æ¨¡å¼ import asyncio import aiohttp import json from concurrent.futures import ThreadPoolExecutor # ä½¿ç”¨asyncioè¿›è¡Œå¼‚æ­¥å¤„ç† async def process_multiple_apis(urls): \u0026#34;\u0026#34;\u0026#34;å¹¶å‘è°ƒç”¨å¤šä¸ªAPI\u0026#34;\u0026#34;\u0026#34; async with aiohttp.ClientSession() as session: tasks = [fetch_url(session, url) for url in urls] results = await asyncio.gather(*tasks) return results async def fetch_url(session, url): \u0026#34;\u0026#34;\u0026#34;è·å–å•ä¸ªURL\u0026#34;\u0026#34;\u0026#34; async with session.get(url) as response: return await response.json() def lambda_handler(event, context): \u0026#34;\u0026#34;\u0026#34;Lambdaå¤„ç†å‡½æ•°\u0026#34;\u0026#34;\u0026#34; urls = [ \u0026#39;https://api1.example.com/data\u0026#39;, \u0026#39;https://api2.example.com/data\u0026#39;, \u0026#39;https://api3.example.com/data\u0026#39; ] # è¿è¡Œå¼‚æ­¥ä»£ç  loop = asyncio.get_event_loop() results = loop.run_until_complete(process_multiple_apis(urls)) return { \u0026#39;statusCode\u0026#39;: 200, \u0026#39;body\u0026#39;: json.dumps(results) } # ä½¿ç”¨çº¿ç¨‹æ± å¤„ç†CPUå¯†é›†å‹ä»»åŠ¡ def cpu_intensive_task(data): \u0026#34;\u0026#34;\u0026#34;CPUå¯†é›†å‹ä»»åŠ¡\u0026#34;\u0026#34;\u0026#34; result = sum(i * i for i in range(data)) return result def lambda_handler(event, context): with ThreadPoolExecutor(max_workers=4) as executor: futures = [] for item in event[\u0026#39;items\u0026#39;]: future = executor.submit(cpu_intensive_task, item) futures.append(future) results = [future.result() for future in futures] return { \u0026#39;statusCode\u0026#39;: 200, \u0026#39;body\u0026#39;: json.dumps(results) } 2. æ•°æ®å¤„ç†ä¼˜åŒ– 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 # data_optimization.py - æ•°æ®å¤„ç†ä¼˜åŒ– import json import gzip import io import csv # å‹ç¼©å“åº”æ•°æ® def compress_response(data): \u0026#34;\u0026#34;\u0026#34;å‹ç¼©å“åº”æ•°æ®\u0026#34;\u0026#34;\u0026#34; json_str = json.dumps(data) buffer = io.BytesIO() with gzip.GzipFile(fileobj=buffer, mode=\u0026#39;w\u0026#39;) as gz: gz.write(json_str.encode(\u0026#39;utf-8\u0026#39;)) return buffer.getvalue() # æµå¼å¤„ç†å¤§æ–‡ä»¶ def process_large_csv(event, context): \u0026#34;\u0026#34;\u0026#34;æµå¼å¤„ç†å¤§CSVæ–‡ä»¶\u0026#34;\u0026#34;\u0026#34; s3 = boto3.client(\u0026#39;s3\u0026#39;) # è·å–S3äº‹ä»¶ bucket = event[\u0026#39;Records\u0026#39;][0][\u0026#39;s3\u0026#39;][\u0026#39;bucket\u0026#39;][\u0026#39;name\u0026#39;] key = event[\u0026#39;Records\u0026#39;][0][\u0026#39;s3\u0026#39;][\u0026#39;object\u0026#39;][\u0026#39;key\u0026#39;] # æµå¼è¯»å– response = s3.get_object(Bucket=bucket, Key=key) results = [] for line in response[\u0026#39;Body\u0026#39;].iter_lines(): # é€è¡Œå¤„ç†ï¼Œé¿å…å†…å­˜æº¢å‡º row = json.loads(line) processed = process_row(row) results.append(processed) return { \u0026#39;processed_rows\u0026#39;: len(results) } # æ‰¹é‡å¤„ç†ä¼˜åŒ– def batch_process_items(items, batch_size=100): \u0026#34;\u0026#34;\u0026#34;æ‰¹é‡å¤„ç†é¡¹ç›®\u0026#34;\u0026#34;\u0026#34; batches = [items[i:i + batch_size] for i in range(0, len(items), batch_size)] for batch in batches: process_batch(batch) ç›‘æ§å’Œè°ƒè¯• 1. æ€§èƒ½ç›‘æ§ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 # monitoring.py - æ€§èƒ½ç›‘æ§è£…é¥°å™¨ import time import functools import boto3 import os cloudwatch = boto3.client(\u0026#39;cloudwatch\u0026#39;) def monitor_performance(metric_name): \u0026#34;\u0026#34;\u0026#34;æ€§èƒ½ç›‘æ§è£…é¥°å™¨\u0026#34;\u0026#34;\u0026#34; def decorator(func): @functools.wraps(func) def wrapper(*args, **kwargs): start_time = time.time() try: result = func(*args, **kwargs) success = True except Exception as e: success = False raise finally: duration = (time.time() - start_time) * 1000 # å‘é€æŒ‡æ ‡åˆ°CloudWatch cloudwatch.put_metric_data( Namespace=\u0026#39;Lambda/Performance\u0026#39;, MetricData=[ { \u0026#39;MetricName\u0026#39;: metric_name, \u0026#39;Value\u0026#39;: duration, \u0026#39;Unit\u0026#39;: \u0026#39;Milliseconds\u0026#39;, \u0026#39;Dimensions\u0026#39;: [ { \u0026#39;Name\u0026#39;: \u0026#39;FunctionName\u0026#39;, \u0026#39;Value\u0026#39;: os.environ.get(\u0026#39;AWS_LAMBDA_FUNCTION_NAME\u0026#39;, \u0026#39;Unknown\u0026#39;) } ] }, { \u0026#39;MetricName\u0026#39;: f\u0026#39;{metric_name}_Success\u0026#39;, \u0026#39;Value\u0026#39;: 1 if success else 0, \u0026#39;Unit\u0026#39;: \u0026#39;Count\u0026#39;, \u0026#39;Dimensions\u0026#39;: [ { \u0026#39;Name\u0026#39;: \u0026#39;FunctionName\u0026#39;, \u0026#39;Value\u0026#39;: os.environ.get(\u0026#39;AWS_LAMBDA_FUNCTION_NAME\u0026#39;, \u0026#39;Unknown\u0026#39;) } ] } ] ) return result return wrapper return decorator # ä½¿ç”¨ç¤ºä¾‹ @monitor_performance(\u0026#39;api_request\u0026#39;) def lambda_handler(event, context): \u0026#34;\u0026#34;\u0026#34;APIè¯·æ±‚å¤„ç†\u0026#34;\u0026#34;\u0026#34; # ä¸šåŠ¡é€»è¾‘ pass 2. é”™è¯¯å¤„ç†å’Œé‡è¯• 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 # retry_handler.py - é‡è¯•æœºåˆ¶ import time import random from functools import wraps def exponential_backoff(max_retries=3, base_delay=0.1, max_delay=2): \u0026#34;\u0026#34;\u0026#34;æŒ‡æ•°é€€é¿é‡è¯•è£…é¥°å™¨\u0026#34;\u0026#34;\u0026#34; def decorator(func): @wraps(func) def wrapper(*args, **kwargs): for attempt in range(max_retries + 1): try: return func(*args, **kwargs) except Exception as e: if attempt == max_retries: raise delay = min(base_delay * (2 ** attempt) + random.uniform(0, 0.1), max_delay) time.sleep(delay) return wrapper return decorator # æ–­è·¯å™¨æ¨¡å¼ class CircuitBreaker: def __init__(self, failure_threshold=5, timeout=60): self.failure_threshold = failure_threshold self.timeout = timeout self.failure_count = 0 self.last_failure_time = None self.state = \u0026#39;CLOSED\u0026#39; # CLOSED, OPEN, HALF_OPEN def call(self, func, *args, **kwargs): \u0026#34;\u0026#34;\u0026#34;æ–­è·¯å™¨è°ƒç”¨\u0026#34;\u0026#34;\u0026#34; if self.state == \u0026#39;OPEN\u0026#39;: if time.time() - self.last_failure_time \u0026gt; self.timeout: self.state = \u0026#39;HALF_OPEN\u0026#39; else: raise Exception(\u0026#39;Circuit breaker is OPEN\u0026#39;) try: result = func(*args, **kwargs) self.reset() return result except Exception as e: self.record_failure() raise def record_failure(self): \u0026#34;\u0026#34;\u0026#34;è®°å½•å¤±è´¥\u0026#34;\u0026#34;\u0026#34; self.failure_count += 1 self.last_failure_time = time.time() if self.failure_count \u0026gt;= self.failure_threshold: self.state = \u0026#39;OPEN\u0026#39; def reset(self): \u0026#34;\u0026#34;\u0026#34;é‡ç½®æ–­è·¯å™¨\u0026#34;\u0026#34;\u0026#34; self.failure_count = 0 self.state = \u0026#39;CLOSED\u0026#39; æˆæœ¬ä¼˜åŒ– 1. è®¡ç®—ä¼˜åŒ– 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 # cost_optimizer.py - æˆæœ¬ä¼˜åŒ– import json import boto3 from datetime import datetime, timedelta class LambdaCostOptimizer: def __init__(self): self.ce_client = boto3.client(\u0026#39;ce\u0026#39;) self.lambda_client = boto3.client(\u0026#39;lambda\u0026#39;) def analyze_costs(self): \u0026#34;\u0026#34;\u0026#34;åˆ†æLambdaæˆæœ¬\u0026#34;\u0026#34;\u0026#34; end_date = datetime.now().date() start_date = end_date - timedelta(days=30) response = self.ce_client.get_cost_and_usage( TimePeriod={ \u0026#39;Start\u0026#39;: start_date.isoformat(), \u0026#39;End\u0026#39;: end_date.isoformat() }, Granularity=\u0026#39;DAILY\u0026#39;, Metrics=[\u0026#39;BlendedCost\u0026#39;], GroupBy=[ { \u0026#39;Type\u0026#39;: \u0026#39;DIMENSION\u0026#39;, \u0026#39;Key\u0026#39;: \u0026#39;SERVICE\u0026#39; } ], Filter={ \u0026#39;Dimensions\u0026#39;: { \u0026#39;Key\u0026#39;: \u0026#39;SERVICE\u0026#39;, \u0026#39;Values\u0026#39;: [\u0026#39;AWS Lambda\u0026#39;] } } ) return response[\u0026#39;ResultsByTime\u0026#39;] def optimize_functions(self): \u0026#34;\u0026#34;\u0026#34;ä¼˜åŒ–å‡½æ•°é…ç½®\u0026#34;\u0026#34;\u0026#34; functions = self.get_all_functions() for function in functions: metrics = self.get_function_metrics(function[\u0026#39;FunctionName\u0026#39;]) if metrics: # æ ¹æ®ä½¿ç”¨æ¨¡å¼ä¼˜åŒ–é…ç½® optimal_memory = self.calculate_optimal_memory(metrics) optimal_timeout = self.calculate_optimal_timeout(metrics) self.update_function_config( function[\u0026#39;FunctionName\u0026#39;], optimal_memory, optimal_timeout ) def calculate_optimal_memory(self, metrics): \u0026#34;\u0026#34;\u0026#34;è®¡ç®—æœ€ä¼˜å†…å­˜é…ç½®\u0026#34;\u0026#34;\u0026#34; avg_duration = metrics.get(\u0026#39;avg_duration\u0026#39;, 100) max_duration = metrics.get(\u0026#39;max_duration\u0026#39;, 500) # åŸºäºæ‰§è¡Œæ—¶é—´è®¡ç®—å†…å­˜éœ€æ±‚ if avg_duration \u0026lt; 100: return 128 elif avg_duration \u0026lt; 500: return 256 elif avg_duration \u0026lt; 2000: return 512 else: return 1024 å®æˆ˜æ¡ˆä¾‹ 1. å›¾åƒå¤„ç†æœåŠ¡ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 # image_processor.py - å›¾åƒå¤„ç†Lambda import boto3 import io from PIL import Image s3_client = boto3.client(\u0026#39;s3\u0026#39;) s3_resource = boto3.resource(\u0026#39;s3\u0026#39;) def resize_image_handler(event, context): \u0026#34;\u0026#34;\u0026#34;å›¾åƒç¼©æ”¾å¤„ç†\u0026#34;\u0026#34;\u0026#34; for record in event[\u0026#39;Records\u0026#39;]: # è§£æS3äº‹ä»¶ bucket = record[\u0026#39;s3\u0026#39;][\u0026#39;bucket\u0026#39;][\u0026#39;name\u0026#39;] key = record[\u0026#39;s3\u0026#39;][\u0026#39;object\u0026#39;][\u0026#39;key\u0026#39;] # ä¸‹è½½å›¾åƒ obj = s3_resource.Object(bucket, key) image_data = obj.get()[\u0026#39;Body\u0026#39;].read() # å¤„ç†å›¾åƒ image = Image.open(io.BytesIO(image_data)) # ç”Ÿæˆå¤šä¸ªå°ºå¯¸ sizes = [ (\u0026#39;thumbnail\u0026#39;, (150, 150)), (\u0026#39;medium\u0026#39;, (500, 500)), (\u0026#39;large\u0026#39;, (1000, 1000)) ] for size_name, size in sizes: resized = image.copy() resized.thumbnail(size, Image.LANCZOS) # ä¿å­˜åˆ°S3 output_key = f\u0026#34;processed/{size_name}/{key}\u0026#34; output_buffer = io.BytesIO() resized.save(output_buffer, format=\u0026#39;JPEG\u0026#39;, quality=85) s3_client.put_object( Bucket=bucket, Key=output_key, Body=output_buffer.getvalue(), ContentType=\u0026#39;image/jpeg\u0026#39; ) # ä¼˜åŒ–ç‰ˆæœ¬ï¼šä½¿ç”¨é¢„åˆ†é…å†…å­˜ def optimized_resize_handler(event, context): \u0026#34;\u0026#34;\u0026#34;ä¼˜åŒ–çš„å›¾åƒå¤„ç†\u0026#34;\u0026#34;\u0026#34; # é¢„å…ˆåˆ†é…è¶³å¤Ÿçš„å†…å­˜ import os os.environ[\u0026#39;PYTHONMALLOC\u0026#39;] = \u0026#39;malloc\u0026#39; resize_image_handler(event, context) 2. APIç½‘å…³é›†æˆ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 # api_gateway.py - APIç½‘å…³é›†æˆä¼˜åŒ– import json import boto3 from decimal import Decimal dynamodb = boto3.resource(\u0026#39;dynamodb\u0026#39;) class DecimalEncoder(json.JSONEncoder): \u0026#34;\u0026#34;\u0026#34;å¤„ç†Decimalç±»å‹\u0026#34;\u0026#34;\u0026#34; def default(self, obj): if isinstance(obj, Decimal): return float(obj) return super(DecimalEncoder, self).default(obj) def api_handler(event, context): \u0026#34;\u0026#34;\u0026#34;APIå¤„ç†å‡½æ•°\u0026#34;\u0026#34;\u0026#34; http_method = event[\u0026#39;httpMethod\u0026#39;] path = event[\u0026#39;path\u0026#39;] # è·¯ç”±å¤„ç† if path == \u0026#39;/users\u0026#39; and http_method == \u0026#39;GET\u0026#39;: return get_users(event) elif path == \u0026#39;/users\u0026#39; and http_method == \u0026#39;POST\u0026#39;: return create_user(event) else: return { \u0026#39;statusCode\u0026#39;: 404, \u0026#39;body\u0026#39;: json.dumps({\u0026#39;error\u0026#39;: \u0026#39;Not found\u0026#39;}) } def get_users(event): \u0026#34;\u0026#34;\u0026#34;è·å–ç”¨æˆ·åˆ—è¡¨\u0026#34;\u0026#34;\u0026#34; table = dynamodb.Table(\u0026#39;users\u0026#39;) # åˆ†é¡µå‚æ•° limit = int(event.get(\u0026#39;queryStringParameters\u0026#39;, {}).get(\u0026#39;limit\u0026#39;, 10)) last_key = event.get(\u0026#39;queryStringParameters\u0026#39;, {}).get(\u0026#39;last_key\u0026#39;) scan_kwargs = {\u0026#39;Limit\u0026#39;: limit} if last_key: scan_kwargs[\u0026#39;ExclusiveStartKey\u0026#39;] = {\u0026#39;id\u0026#39;: last_key} response = table.scan(**scan_kwargs) return { \u0026#39;statusCode\u0026#39;: 200, \u0026#39;headers\u0026#39;: { \u0026#39;Content-Type\u0026#39;: \u0026#39;application/json\u0026#39;, \u0026#39;Access-Control-Allow-Origin\u0026#39;: \u0026#39;*\u0026#39; }, \u0026#39;body\u0026#39;: json.dumps( { \u0026#39;users\u0026#39;: response[\u0026#39;Items\u0026#39;], \u0026#39;last_key\u0026#39;: response.get(\u0026#39;LastEvaluatedKey\u0026#39;, {}).get(\u0026#39;id\u0026#39;) }, cls=DecimalEncoder ) } æœ€ä½³å®è·µæ€»ç»“ å†·å¯åŠ¨ä¼˜åŒ–ï¼šå…¨å±€åˆå§‹åŒ–ã€é¢„çƒ­ç­–ç•¥ã€è¿è¡Œæ—¶ä¼˜åŒ– èµ„æºé…ç½®ï¼šåŠ¨æ€è°ƒæ•´ã€é¢„ç•™å¹¶å‘ã€æ€§èƒ½ç›‘æ§ ä»£ç ä¼˜åŒ–ï¼šå¼‚æ­¥å¤„ç†ã€æ‰¹é‡æ“ä½œã€å†…å­˜ç®¡ç† é”™è¯¯å¤„ç†ï¼šé‡è¯•æœºåˆ¶ã€æ–­è·¯å™¨ã€ä¼˜é›…é™çº§ æˆæœ¬æ§åˆ¶ï¼šä½¿ç”¨æ¨¡å¼åˆ†æã€èµ„æºä¼˜åŒ–ã€ç›‘æ§å‘Šè­¦ æ€»ç»“ AWS Lambdaä¼˜åŒ–çš„å…³é”®ç‚¹ï¼š\nå‡å°‘å†·å¯åŠ¨ï¼šé¢„çƒ­å’Œä¼˜åŒ–åˆå§‹åŒ– åˆç†é…ç½®ï¼šæ ¹æ®å®é™…éœ€æ±‚è°ƒæ•´å†…å­˜å’Œå¹¶å‘ ä¼˜åŒ–ä»£ç ï¼šä½¿ç”¨å¼‚æ­¥å’Œæ‰¹å¤„ç†æŠ€æœ¯ æŒç»­ç›‘æ§ï¼šå»ºç«‹å®Œå–„çš„ç›‘æ§å’Œå‘Šè­¦ä½“ç³» æˆæœ¬æ§åˆ¶ï¼šå¹³è¡¡æ€§èƒ½å’Œæˆæœ¬ é€šè¿‡è¿™äº›ä¼˜åŒ–ç­–ç•¥ï¼Œå¯ä»¥æ„å»ºé«˜æ€§èƒ½ã€ä½æˆæœ¬çš„æ— æœåŠ¡å™¨åº”ç”¨ã€‚\nç›¸å…³èµ„æº AWS Lambdaå¼€å‘è€…æŒ‡å— Lambdaæœ€ä½³å®è·µ AWSæ— æœåŠ¡å™¨æ¶æ„ ","permalink":"/blog/articles/aws-lambda-optimization/","summary":"æŒæ¡AWS Lambdaä¼˜åŒ–æŠ€å·§ï¼Œæ„å»ºé«˜æ•ˆç»æµçš„æ— æœåŠ¡å™¨åº”ç”¨ã€‚","title":"AWS Lambdaæ€§èƒ½ä¼˜åŒ–å®Œå…¨æŒ‡å—"},{"content":"Django 5.0æ–°ç‰¹æ€§å…¨é¢è§£æ Django 5.0å¸¦æ¥äº†è®¸å¤šæ¿€åŠ¨äººå¿ƒçš„æ–°ç‰¹æ€§å’Œæ”¹è¿›ï¼Œè¿›ä¸€æ­¥å¼ºåŒ–äº†å…¶ä½œä¸ºPythonæœ€å¼ºå¤§Webæ¡†æ¶çš„åœ°ä½ã€‚æœ¬æ–‡å°†æ·±å…¥æ¢è®¨è¿™äº›æ–°ç‰¹æ€§åŠå…¶åœ¨å®é™…é¡¹ç›®ä¸­çš„åº”ç”¨ã€‚\nå¼‚æ­¥æ”¯æŒå¢å¼º 1. å¼‚æ­¥è§†å›¾å’Œä¸­é—´ä»¶ Django 5.0å¤§å¹…å¢å¼ºäº†å¯¹å¼‚æ­¥ç¼–ç¨‹çš„æ”¯æŒï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 # views.py - å¼‚æ­¥è§†å›¾ from django.http import JsonResponse import aiohttp async def async_weather_view(request): \u0026#34;\u0026#34;\u0026#34;å¼‚æ­¥è·å–å¤©æ°”æ•°æ®\u0026#34;\u0026#34;\u0026#34; async with aiohttp.ClientSession() as session: async with session.get(\u0026#39;https://api.weather.com/current\u0026#39;) as response: weather_data = await response.json() return JsonResponse(weather_data) # å¼‚æ­¥ä¸­é—´ä»¶ class AsyncTimingMiddleware: async def __call__(self, request): start_time = time.time() response = await self.get_response(request) duration = time.time() - start_time response[\u0026#39;X-Response-Time\u0026#39;] = str(duration) return response 2. å¼‚æ­¥æ•°æ®åº“æŸ¥è¯¢ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 # models.py from django.db import models from asgiref.sync import sync_to_async class Post(models.Model): title = models.CharField(max_length=200) content = models.TextField() created_at = models.DateTimeField(auto_now_add=True) # å¼‚æ­¥æŸ¥è¯¢ async def get_recent_posts(limit=10): \u0026#34;\u0026#34;\u0026#34;å¼‚æ­¥è·å–æœ€æ–°æ–‡ç« \u0026#34;\u0026#34;\u0026#34; posts = await sync_to_async(list)( Post.objects.order_by(\u0026#39;-created_at\u0026#39;)[:limit] ) return posts # å¼‚æ­¥ORMæ“ä½œ async def create_post_async(title, content): \u0026#34;\u0026#34;\u0026#34;å¼‚æ­¥åˆ›å»ºæ–‡ç« \u0026#34;\u0026#34;\u0026#34; post = await sync_to_async(Post.objects.create)( title=title, content=content ) return post è¡¨å•æ¸²æŸ“æ”¹è¿› 1. æ–°çš„è¡¨å•å­—æ®µç±»å‹ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 # forms.py from django import forms class AdvancedForm(forms.Form): # æ–°å¢å­—æ®µç±»å‹ color = forms.ColorField( help_text=\u0026#34;é€‰æ‹©é¢œè‰²\u0026#34; ) date_range = forms.SplitDateTimeField( widget=forms.SplitDateTimeWidget( date_attrs={\u0026#39;type\u0026#39;: \u0026#39;date\u0026#39;}, time_attrs={\u0026#39;type\u0026#39;: \u0026#39;time\u0026#39;} ) ) decimal_range = forms.DecimalField( min_value=0, max_value=1000, decimal_places=2 ) # è‡ªå®šä¹‰å­—æ®µæ¸²æŸ“ class CustomModelForm(forms.ModelForm): class Meta: model = MyModel fields = \u0026#39;__all__\u0026#39; widgets = { \u0026#39;description\u0026#39;: forms.Textarea(attrs={\u0026#39;rows\u0026#39;: 4}), \u0026#39;email\u0026#39;: forms.EmailInput(attrs={\u0026#39;autocomplete\u0026#39;: \u0026#39;email\u0026#39;}), } 2. å¢å¼ºçš„è¡¨å•éªŒè¯ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 # forms.py - å¤æ‚éªŒè¯é€»è¾‘ from django.core.exceptions import ValidationError class RegistrationForm(forms.Form): username = forms.CharField(max_length=150) email = forms.EmailField() password = forms.CharField(widget=forms.PasswordInput) confirm_password = forms.CharField(widget=forms.PasswordInput) def clean_username(self): username = self.cleaned_data[\u0026#39;username\u0026#39;] if User.objects.filter(username__iexact=username).exists(): raise ValidationError(\u0026#34;ç”¨æˆ·åå·²å­˜åœ¨\u0026#34;) return username def clean(self): cleaned_data = super().clean() password = cleaned_data.get(\u0026#39;password\u0026#39;) confirm_password = cleaned_data.get(\u0026#39;confirm_password\u0026#39;) if password and confirm_password and password != confirm_password: raise ValidationError(\u0026#34;ä¸¤æ¬¡è¾“å…¥çš„å¯†ç ä¸ä¸€è‡´\u0026#34;) æ•°æ®åº“ä¼˜åŒ– 1. æŸ¥è¯¢ä¼˜åŒ–å¢å¼º 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 # views.py - ä¼˜åŒ–çš„æŸ¥è¯¢ from django.db.models import Prefetch, Q, F from django.db import transaction def optimized_product_list(request): # ä½¿ç”¨select_relatedå’Œprefetch_related products = Product.objects.select_related(\u0026#39;category\u0026#39;).prefetch_related( Prefetch(\u0026#39;reviews\u0026#39;, queryset=Review.objects.filter(is_approved=True)) ).filter( Q(is_active=True) \u0026amp; Q(stock__gt=0) ).annotate( discount_price=F(\u0026#39;price\u0026#39;) * F(\u0026#39;discount_rate\u0026#39;) ).order_by(\u0026#39;-created_at\u0026#39;) return render(request, \u0026#39;products/list.html\u0026#39;, {\u0026#39;products\u0026#39;: products}) # æ‰¹é‡æ“ä½œ @transaction.atomic def bulk_update_products(): products = Product.objects.filter(category_id=1) for product in products: product.price *= 1.1 # æä»·10% Product.objects.bulk_update(products, [\u0026#39;price\u0026#39;]) 2. æ•°æ®åº“å‡½æ•°æ‰©å±• 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 # models.py - ä½¿ç”¨æ•°æ®åº“å‡½æ•° from django.db.models import Count, Avg, Sum, StdDev, Variance from django.db.models.functions import ( Coalesce, Greatest, Least, Length, Lower, Upper, Substr, Concat, Now, Extract ) class ProductSales(models.Model): product = models.ForeignKey(Product, on_delete=models.CASCADE) quantity = models.IntegerField() price = models.DecimalField(max_digits=10, decimal_places=2) sale_date = models.DateField() # å¤æ‚èšåˆæŸ¥è¯¢ def sales_statistics(): stats = ProductSales.objects.aggregate( total_sales=Sum(\u0026#39;quantity\u0026#39;), avg_price=Avg(\u0026#39;price\u0026#39;), price_stddev=StdDev(\u0026#39;price\u0026#39;), unique_products=Count(\u0026#39;product\u0026#39;, distinct=True) ) # æ—¶é—´åºåˆ—æ•°æ® monthly_sales = ProductSales.objects.annotate( month=Extract(\u0026#39;sale_date\u0026#39;, \u0026#39;month\u0026#39;), year=Extract(\u0026#39;sale_date\u0026#39;, \u0026#39;year\u0026#39;) ).values(\u0026#39;year\u0026#39;, \u0026#39;month\u0026#39;).annotate( total_quantity=Sum(\u0026#39;quantity\u0026#39;), total_revenue=Sum(\u0026#39;quantity\u0026#39; * F(\u0026#39;price\u0026#39;)) ).order_by(\u0026#39;year\u0026#39;, \u0026#39;month\u0026#39;) return stats, monthly_sales æ¨¡æ¿ç³»ç»Ÿæ”¹è¿› 1. æ–°çš„æ¨¡æ¿æ ‡ç­¾ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 \u0026lt;!-- templates/base.html --\u0026gt; {% load custom_tags %} \u0026lt;!-- æ–°çš„æ¨¡æ¿ä¸Šä¸‹æ–‡å¤„ç†å™¨ --\u0026gt; {% block content %} \u0026lt;!-- æ¡ä»¶æ¸²æŸ“æ”¹è¿› --\u0026gt; {% if user.is_authenticated|default:False %} \u0026lt;p\u0026gt;æ¬¢è¿, {{ user.username }}!\u0026lt;/p\u0026gt; {% endif %} \u0026lt;!-- å¼‚æ­¥æ¨¡æ¿æ¸²æŸ“ --\u0026gt; {% async_template \u0026#34;partials/async_content.html\u0026#34; %} \u0026lt;!-- æ¨¡æ¿ç»„ä»¶ --\u0026gt; {% component \u0026#34;card\u0026#34; title=\u0026#34;æ ‡é¢˜\u0026#34; %} \u0026lt;p\u0026gt;å¡ç‰‡å†…å®¹\u0026lt;/p\u0026gt; {% endcomponent %} {% endblock %} 2. æ¨¡æ¿æ€§èƒ½ä¼˜åŒ– 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 # templatetags/cache_tags.py from django import template from django.core.cache import cache register = template.Library() @register.inclusion_tag(\u0026#39;includes/product_card.html\u0026#39;) def product_card(product): \u0026#34;\u0026#34;\u0026#34;äº§å“å¡ç‰‡æ¨¡æ¿æ ‡ç­¾\u0026#34;\u0026#34;\u0026#34; return {\u0026#39;product\u0026#39;: product} @register.simple_tag def cached_product_count(category_slug): \u0026#34;\u0026#34;\u0026#34;ç¼“å­˜çš„äº§å“æ•°é‡\u0026#34;\u0026#34;\u0026#34; cache_key = f\u0026#39;product_count_{category_slug}\u0026#39; count = cache.get(cache_key) if count is None: count = Product.objects.filter( category__slug=category_slug, is_active=True ).count() cache.set(cache_key, count, 300) # ç¼“å­˜5åˆ†é’Ÿ return count APIå¼€å‘å¢å¼º 1. å¼‚æ­¥APIè§†å›¾ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 # api/views.py from django.http import JsonResponse from django.views.decorators.http import require_http_methods from asgiref.sync import sync_to_async @require_http_methods([\u0026#34;GET\u0026#34;]) async def async_api_list(request): \u0026#34;\u0026#34;\u0026#34;å¼‚æ­¥APIåˆ—è¡¨\u0026#34;\u0026#34;\u0026#34; try: # å¼‚æ­¥æ•°æ®åº“æŸ¥è¯¢ items = await sync_to_async(list)( Item.objects.all().values(\u0026#39;id\u0026#39;, \u0026#39;name\u0026#39;, \u0026#39;created_at\u0026#39;) ) # å¹¶å‘HTTPè¯·æ±‚ async with aiohttp.ClientSession() as session: tasks = [] for item in items: task = fetch_additional_data(session, item[\u0026#39;id\u0026#39;]) tasks.append(task) additional_data = await asyncio.gather(*tasks) # åˆå¹¶æ•°æ® for item, data in zip(items, additional_data): item[\u0026#39;additional\u0026#39;] = data return JsonResponse({\u0026#39;items\u0026#39;: items}) except Exception as e: return JsonResponse( {\u0026#39;error\u0026#39;: str(e)}, status=500 ) 2. DRFé›†æˆä¼˜åŒ– 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 # serializers.py - å¼‚æ­¥åºåˆ—åŒ–å™¨ from rest_framework import serializers from .models import Post class AsyncPostSerializer(serializers.ModelSerializer): author_name = serializers.CharField(source=\u0026#39;author.username\u0026#39;, read_only=True) class Meta: model = Post fields = [\u0026#39;id\u0026#39;, \u0026#39;title\u0026#39;, \u0026#39;content\u0026#39;, \u0026#39;author_name\u0026#39;, \u0026#39;created_at\u0026#39;] # views.py - å¼‚æ­¥ViewSet from rest_framework import viewsets from rest_framework.decorators import action from asgiref.sync import sync_to_async class AsyncPostViewSet(viewsets.ModelViewSet): serializer_class = AsyncPostSerializer queryset = Post.objects.all() async def list(self, request, *args, **kwargs): \u0026#34;\u0026#34;\u0026#34;å¼‚æ­¥åˆ—è¡¨\u0026#34;\u0026#34;\u0026#34; queryset = await sync_to_async(list)(self.get_queryset()) serializer = self.get_serializer(queryset, many=True) return Response(serializer.data) @action(detail=False, methods=[\u0026#39;GET\u0026#39;]) async def statistics(self, request): \u0026#34;\u0026#34;\u0026#34;å¼‚æ­¥ç»Ÿè®¡\u0026#34;\u0026#34;\u0026#34; stats = await sync_to_async(self.get_statistics)() return Response(stats) ç®¡ç†åå°æ”¹è¿› 1. è‡ªå®šä¹‰ç®¡ç†ç•Œé¢ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 # admin.py - å¢å¼ºçš„ç®¡ç†åå° from django.contrib import admin from django.db.models import Count from django.utils.html import format_html @admin.register(Product) class ProductAdmin(admin.ModelAdmin): list_display = [\u0026#39;name\u0026#39;, \u0026#39;category\u0026#39;, \u0026#39;price\u0026#39;, \u0026#39;stock_status\u0026#39;, \u0026#39;image_preview\u0026#39;] list_filter = [\u0026#39;category\u0026#39;, \u0026#39;is_active\u0026#39;, \u0026#39;created_at\u0026#39;] search_fields = [\u0026#39;name\u0026#39;, \u0026#39;description\u0026#39;] ordering = [\u0026#39;-created_at\u0026#39;] # è‡ªå®šä¹‰å­—æ®µ def stock_status(self, obj): if obj.stock \u0026gt; 50: color = \u0026#39;green\u0026#39; elif obj.stock \u0026gt; 10: color = \u0026#39;orange\u0026#39; else: color = \u0026#39;red\u0026#39; return format_html( \u0026#39;\u0026lt;span style=\u0026#34;color: {};\u0026#34;\u0026gt;{}\u0026lt;/span\u0026gt;\u0026#39;, color, obj.stock ) def image_preview(self, obj): if obj.image: return format_html( \u0026#39;\u0026lt;img src=\u0026#34;{}\u0026#34; width=\u0026#34;50\u0026#34; height=\u0026#34;50\u0026#34; /\u0026gt;\u0026#39;, obj.image.url ) return \u0026#34;æ— å›¾ç‰‡\u0026#34; # æ‰¹é‡æ“ä½œ actions = [\u0026#39;make_active\u0026#39;, \u0026#39;make_inactive\u0026#39;] def make_active(self, request, queryset): queryset.update(is_active=True) make_active.short_description = \u0026#34;è®¾ä¸ºæ¿€æ´»\u0026#34; # è‡ªå®šä¹‰è¡¨å• fieldsets = ( (\u0026#39;åŸºæœ¬ä¿¡æ¯\u0026#39;, { \u0026#39;fields\u0026#39;: (\u0026#39;name\u0026#39;, \u0026#39;category\u0026#39;, \u0026#39;description\u0026#39;) }), (\u0026#39;ä»·æ ¼å’Œåº“å­˜\u0026#39;, { \u0026#39;fields\u0026#39;: (\u0026#39;price\u0026#39;, \u0026#39;discount_rate\u0026#39;, \u0026#39;stock\u0026#39;) }), (\u0026#39;åª’ä½“\u0026#39;, { \u0026#39;fields\u0026#39;: (\u0026#39;image\u0026#39;, \u0026#39;gallery\u0026#39;) }), ) å®‰å…¨æ€§å¢å¼º 1. CSRFä¿æŠ¤æ”¹è¿› 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 # settings.py - CSRFé…ç½® CSRF_TRUSTED_ORIGINS = [ \u0026#39;https://yourdomain.com\u0026#39;, \u0026#39;https://api.yourdomain.com\u0026#39; ] # ä½¿ç”¨SameSite cookie CSRF_COOKIE_SAMESITE = \u0026#39;Lax\u0026#39; CSRF_COOKIE_SECURE = True CSRF_COOKIE_HTTPONLY = True # è‡ªå®šä¹‰CSRFä¿æŠ¤ class CustomCSRFMiddleware: def __init__(self, get_response): self.get_response = get_response def __call__(self, request): if request.path.startswith(\u0026#39;/api/\u0026#39;): # APIè¯·æ±‚ä½¿ç”¨ä¸åŒçš„CSRFå¤„ç† pass response = self.get_response(request) return response 2. è®¤è¯å’Œæˆæƒ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 # authentication.py - è‡ªå®šä¹‰è®¤è¯ from django.contrib.auth.backends import BaseBackend from django.contrib.auth.models import User class APIKeyBackend(BaseBackend): \u0026#34;\u0026#34;\u0026#34;APIå¯†é’¥è®¤è¯\u0026#34;\u0026#34;\u0026#34; def authenticate(self, request, api_key=None): if not api_key: return None try: user = User.objects.get(api_key__key=api_key, is_active=True) return user except User.DoesNotExist: return None def get_user(self, user_id): try: return User.objects.get(pk=user_id, is_active=True) except User.DoesNotExist: return None # permissions.py - æƒé™æ§åˆ¶ from rest_framework import permissions class IsOwnerOrReadOnly(permissions.BasePermission): \u0026#34;\u0026#34;\u0026#34;åªæœ‰æ‰€æœ‰è€…å¯ä»¥ç¼–è¾‘\u0026#34;\u0026#34;\u0026#34; def has_object_permission(self, request, view, obj): if request.method in permissions.SAFE_METHODS: return True return obj.owner == request.user æ€§èƒ½ç›‘æ§ 1. æ€§èƒ½åˆ†æå·¥å…· 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 # middleware.py - æ€§èƒ½ç›‘æ§ import time import logging from django.conf import settings logger = logging.getLogger(__name__) class PerformanceMiddleware: def __init__(self, get_response): self.get_response = get_response def __call__(self, request): if not settings.DEBUG: return self.get_response(request) start_time = time.time() # è®°å½•æŸ¥è¯¢æ•° from django.conf import settings from django.db import connection initial_queries = len(connection.queries) response = self.get_response(request) duration = time.time() - start_time query_count = len(connection.queries) - initial_queries logger.info( f\u0026#34;Path: {request.path} | \u0026#34; f\u0026#34;Duration: {duration:.3f}s | \u0026#34; f\u0026#34;Queries: {query_count}\u0026#34; ) response[\u0026#39;X-Debug-Duration\u0026#39;] = str(duration) response[\u0026#39;X-Debug-Queries\u0026#39;] = str(query_count) return response 2. ç¼“å­˜ç­–ç•¥ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 # views.py - å¤šçº§ç¼“å­˜ from django.views.decorators.cache import cache_page, never_cache from django.core.cache import cache from django.utils.decorators import method_decorator from django.views.decorators.vary import vary_on_headers @cache_page(60 * 15) # ç¼“å­˜15åˆ†é’Ÿ @vary_on_headers(\u0026#39;Cookie\u0026#39;, \u0026#39;Accept-Language\u0026#39;) def product_list(request): \u0026#34;\u0026#34;\u0026#34;äº§å“åˆ—è¡¨é¡µ\u0026#34;\u0026#34;\u0026#34; pass # æ¨¡æ¿ç‰‡æ®µç¼“å­˜ {% load cache %} {% cache 500 sidebar request.user.username %} \u0026lt;!-- ä¾§è¾¹æ å†…å®¹ --\u0026gt; {% endcache %} # å¯¹è±¡çº§ç¼“å­˜ def get_product_with_cache(product_id): cache_key = f\u0026#39;product_{product_id}\u0026#39; product = cache.get(cache_key) if product is None: product = Product.objects.get(id=product_id) cache.set(cache_key, product, 60 * 30) # 30åˆ†é’Ÿ return product å®æˆ˜æ¡ˆä¾‹ 1. å¼‚æ­¥ä»»åŠ¡å¤„ç† 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 # tasks.py - å¼‚æ­¥ä»»åŠ¡ from celery import shared_task from django.core.mail import send_mail import asyncio @shared_task def send_welcome_email(user_id): \u0026#34;\u0026#34;\u0026#34;å‘é€æ¬¢è¿é‚®ä»¶\u0026#34;\u0026#34;\u0026#34; from django.contrib.auth import get_user_model User = get_user_model() user = User.objects.get(id=user_id) send_mail( \u0026#39;æ¬¢è¿åŠ å…¥æˆ‘ä»¬\u0026#39;, f\u0026#39;æ¬¢è¿ {user.username}ï¼\u0026#39;, \u0026#39;from@example.com\u0026#39;, [user.email], fail_silently=False, ) @shared_task def process_uploaded_file(file_path): \u0026#34;\u0026#34;\u0026#34;å¤„ç†ä¸Šä¼ çš„æ–‡ä»¶\u0026#34;\u0026#34;\u0026#34; # å¼‚æ­¥å¤„ç†å¤§æ–‡ä»¶ pass 2. WebSocketé›†æˆ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 # consumers.py - WebSocketæ¶ˆè´¹è€… import json from channels.generic.websocket import AsyncWebsocketConsumer class ChatConsumer(AsyncWebsocketConsumer): async def connect(self): self.room_name = self.scope[\u0026#39;url_route\u0026#39;][\u0026#39;kwargs\u0026#39;][\u0026#39;room_name\u0026#39;] self.room_group_name = f\u0026#39;chat_{self.room_name}\u0026#39; await self.channel_layer.group_add( self.room_group_name, self.channel_name ) await self.accept() async def receive(self, text_data): text_data_json = json.loads(text_data) message = text_data_json[\u0026#39;message\u0026#39;] await self.channel_layer.group_send( self.room_group_name, { \u0026#39;type\u0026#39;: \u0026#39;chat_message\u0026#39;, \u0026#39;message\u0026#39;: message } ) async def chat_message(self, event): message = event[\u0026#39;message\u0026#39;] await self.send(text_data=json.dumps({ \u0026#39;message\u0026#39;: message })) å‡çº§æŒ‡å— 1. å‡†å¤‡å·¥ä½œ 1 2 3 4 5 6 7 8 # æ£€æŸ¥å…¼å®¹æ€§ pip install django==5.0 # è¿è¡Œæµ‹è¯• python manage.py test # æ£€æŸ¥å¼ƒç”¨è­¦å‘Š python -Wd manage.py runserver 2. è¿ç§»æ­¥éª¤ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 # settings.py - æ›´æ–°é…ç½® INSTALLED_APPS = [ # ç¡®ä¿æ‰€æœ‰åº”ç”¨å…¼å®¹Django 5.0 ] # ä¸­é—´ä»¶æ›´æ–° MIDDLEWARE = [ # æ›´æ–°ä¸ºå¼‚æ­¥ä¸­é—´ä»¶ \u0026#39;django.middleware.security.SecurityMiddleware\u0026#39;, \u0026#39;django.contrib.sessions.middleware.SessionMiddleware\u0026#39;, \u0026#39;django.middleware.common.CommonMiddleware\u0026#39;, \u0026#39;django.middleware.csrf.CsrfViewMiddleware\u0026#39;, \u0026#39;django.contrib.auth.middleware.AuthenticationMiddleware\u0026#39;, \u0026#39;django.contrib.messages.middleware.MessageMiddleware\u0026#39;, \u0026#39;django.middleware.clickjacking.XFrameOptionsMiddleware\u0026#39;, ] æœ€ä½³å®è·µ ä½¿ç”¨å¼‚æ­¥è§†å›¾ï¼šå¯¹äºI/Oå¯†é›†å‹æ“ä½œ ä¼˜åŒ–æ•°æ®åº“æŸ¥è¯¢ï¼šä½¿ç”¨select_relatedå’Œprefetch_related å®æ–½ç¼“å­˜ç­–ç•¥ï¼šå¤šçº§ç¼“å­˜æå‡æ€§èƒ½ å®‰å…¨é…ç½®ï¼šå¯ç”¨æ‰€æœ‰å®‰å…¨ç‰¹æ€§ ç›‘æ§å’Œæ—¥å¿—ï¼šå®Œå–„çš„é”™è¯¯è¿½è¸ªå’Œæ€§èƒ½ç›‘æ§ æ€»ç»“ Django 5.0çš„ä¸»è¦æ”¹è¿›ï¼š\nå¼‚æ­¥æ”¯æŒï¼šå®Œæ•´çš„å¼‚æ­¥è§†å›¾å’Œæ•°æ®åº“æ“ä½œ è¡¨å•æ”¹è¿›ï¼šæ–°çš„å­—æ®µç±»å‹å’ŒéªŒè¯æœºåˆ¶ æ€§èƒ½ä¼˜åŒ–ï¼šæŸ¥è¯¢ä¼˜åŒ–å’Œç¼“å­˜å¢å¼º å®‰å…¨æ€§ï¼šæ›´å¼ºçš„CSRFä¿æŠ¤å’Œè®¤è¯ç³»ç»Ÿ å¼€å‘ä½“éªŒï¼šæ›´å¥½çš„é”™è¯¯æç¤ºå’Œè°ƒè¯•å·¥å…· è¿™äº›æ”¹è¿›ä½¿Django 5.0æˆä¸ºæ›´å¼ºå¤§ã€æ›´ç°ä»£çš„Webæ¡†æ¶ã€‚\nç›¸å…³èµ„æº Django 5.0å®˜æ–¹æ–‡æ¡£ Djangoå¼‚æ­¥æ”¯æŒæ–‡æ¡£ Djangoæ€§èƒ½ä¼˜åŒ–æŒ‡å— ","permalink":"/blog/articles/django-5-new-features/","summary":"å…¨é¢äº†è§£Django 5.0çš„å¼ºå¤§æ–°åŠŸèƒ½ï¼Œæå‡Webå¼€å‘æ•ˆç‡å’Œæ€§èƒ½ã€‚","title":"Django 5.0æ–°ç‰¹æ€§å…¨é¢è§£æ"},{"content":"Redis 7æ€§èƒ½ä¼˜åŒ–å®Œå…¨æŒ‡å— Redis 7å¸¦æ¥äº†è®¸å¤šæ€§èƒ½ç›¸å…³çš„æ”¹è¿›å’Œæ–°ç‰¹æ€§ã€‚æœ¬æŒ‡å—å°†æ·±å…¥æ¢è®¨å¦‚ä½•å……åˆ†åˆ©ç”¨è¿™äº›ç‰¹æ€§ï¼Œæ„å»ºé«˜æ€§èƒ½ã€é«˜å¯ç”¨çš„Redisç³»ç»Ÿã€‚\nå†…å­˜ä¼˜åŒ– 1. å†…å­˜ç®¡ç†ç­–ç•¥ # redis.conf - å†…å­˜é…ç½® # è®¾ç½®æœ€å¤§å†…å­˜ maxmemory 8gb # å†…å­˜æ·˜æ±°ç­–ç•¥ # allkeys-lru: æ‰€æœ‰é”®ä½¿ç”¨LRU # volatile-lru: ä»…æœ‰è¿‡æœŸæ—¶é—´çš„é”®ä½¿ç”¨LRU # allkeys-random: éšæœºæ·˜æ±° # volatile-ttl: æ·˜æ±°å³å°†è¿‡æœŸçš„é”® maxmemory-policy allkeys-lru # å†…å­˜ä¼˜åŒ–é€‰é¡¹ hash-max-ziplist-entries 512 hash-max-ziplist-value 64 list-max-ziplist-size -2 set-max-intset-entries 512 zset-max-ziplist-entries 128 zset-max-ziplist-value 64 2. æ•°æ®ç»“æ„ä¼˜åŒ– 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 # æŸ¥çœ‹å†…å­˜ä½¿ç”¨æƒ…å†µ redis-cli info memory redis-cli memory usage key_name # ä¼˜åŒ–Hashç»“æ„ # å°Hashä½¿ç”¨ziplist HMSET user:1000 name \u0026#34;John\u0026#34; age 30 city \u0026#34;New York\u0026#34; # å¤§Hashä½¿ç”¨hashtable # å½“å­—æ®µæ•°é‡è¶…è¿‡hash-max-ziplist-entriesæ—¶è‡ªåŠ¨è½¬æ¢ # ä¼˜åŒ–Stringç»“æ„ # ä½¿ç”¨æ•´æ•°ç¼–ç  SET counter 1000 # ä½¿ç”¨SDSç¼–ç  SET description \u0026#34;This is a longer string that will use SDS encoding\u0026#34; 3. å†…å­˜åˆ†æ 1 2 3 4 5 6 7 8 9 10 11 # ä½¿ç”¨MEMORY DOCTORè¯Šæ–­å†…å­˜é—®é¢˜ redis-cli MEMORY DOCTOR # åˆ†æå¤§é”® redis-cli --bigkeys # ä½¿ç”¨å†…å­˜åˆ†æå™¨ redis-cli MEMORY STATS # æŸ¥çœ‹å†…å­˜ä½¿ç”¨åˆ†å¸ƒ redis-cli info memory | grep used_memory_human æŒä¹…åŒ–ä¼˜åŒ– 1. RDBé…ç½®ä¼˜åŒ– # RDBå¿«ç…§é…ç½® save 900 1 # 900ç§’å†…æœ‰1ä¸ªkeyå˜åŒ–æ—¶ä¿å­˜ save 300 10 # 300ç§’å†…æœ‰10ä¸ªkeyå˜åŒ–æ—¶ä¿å­˜ save 60 10000 # 60ç§’å†…æœ‰10000ä¸ªkeyå˜åŒ–æ—¶ä¿å­˜ # RDBæ–‡ä»¶ä¼˜åŒ– rdbcompression yes # å¯ç”¨å‹ç¼© rdbchecksum yes # å¯ç”¨æ ¡éªŒå’Œ rdb-del-sync-files no # å¼‚æ­¥åˆ é™¤æ—§RDBæ–‡ä»¶ stop-writes-on-bgsave-error yes # AOFé…ç½®ä¼˜åŒ– appendonly yes appendfilename \u0026#34;appendonly.aof\u0026#34; appendfsync everysec # æ¯ç§’åŒæ­¥ no-appendfsync-on-rewrite no # é‡å†™æ—¶ä¸æš‚åœåŒæ­¥ auto-aof-rewrite-percentage 100 # å¢é•¿100%æ—¶é‡å†™ auto-aof-rewrite-min-size 64mb # æœ€å°é‡å†™å¤§å° aof-load-truncated yes # åŠ è½½æˆªæ–­çš„AOFæ–‡ä»¶ 2. æ··åˆæŒä¹…åŒ– # Redis 4.0+ æ”¯æŒæ··åˆæŒä¹…åŒ– aof-use-rdb-preamble yes # æ£€æŸ¥AOFæ–‡ä»¶ redis-cli aof-check /var/lib/redis/appendonly.aof 3. æŒä¹…åŒ–æ€§èƒ½ç›‘æ§ 1 2 3 4 5 6 # ç›‘æ§RDBä¿å­˜ redis-cli config get save redis-cli lastsave # ç›‘æ§AOFé‡å†™ redis-cli info persistence | grep aof_rewrite ç½‘ç»œä¼˜åŒ– 1. TCPé…ç½® # ç½‘ç»œé…ç½® tcp-keepalive 300 tcp-backlog 511 timeout 0 # å®¢æˆ·ç«¯è¿æ¥é…ç½® maxclients 10000 # æ…¢æŸ¥è¯¢æ—¥å¿— slowlog-log-slower-than 10000 # 10ms slowlog-max-len 128 2. Pipelineå’Œæ‰¹å¤„ç† 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 # Pythonç¤ºä¾‹ - ä½¿ç”¨Pipeline import redis r = redis.Redis(host=\u0026#39;localhost\u0026#39;, port=6379) # æ‰¹é‡æ“ä½œ pipe = r.pipeline() for i in range(1000): pipe.set(f\u0026#39;key:{i}\u0026#39;, f\u0026#39;value:{i}\u0026#39;) pipe.execute() # äº‹åŠ¡æ“ä½œ pipe = r.pipeline() pipe.multi() pipe.set(\u0026#39;key1\u0026#39;, \u0026#39;value1\u0026#39;) pipe.set(\u0026#39;key2\u0026#39;, \u0026#39;value2\u0026#39;) pipe.execute() 3. è¿æ¥æ± ä¼˜åŒ– 1 2 3 4 5 6 7 8 9 10 11 12 # è¿æ¥æ± é…ç½® pool = redis.ConnectionPool( host=\u0026#39;localhost\u0026#39;, port=6379, db=0, max_connections=50, socket_keepalive=True, socket_keepalive_options={}, retry_on_timeout=True ) r = redis.Redis(connection_pool=pool) é›†ç¾¤ä¼˜åŒ– 1. Redis Clusteré…ç½® # é›†ç¾¤é…ç½® cluster-enabled yes cluster-config-file nodes-6379.conf cluster-node-timeout 5000 cluster-announce-ip 192.168.1.100 cluster-announce-port 6379 cluster-announce-bus-port 16379 # æ•…éšœè½¬ç§»é…ç½® cluster-migration-barrier 1 cluster-require-full-coverage no 2. ä¸»ä»å¤åˆ¶ä¼˜åŒ– # ä¸»èŠ‚ç‚¹é…ç½® replica-serve-stale-data yes replica-read-only yes repl-diskless-sync no repl-diskless-sync-delay 5 # ä»èŠ‚ç‚¹é…ç½® replica-priority 100 min-replicas-to-write 1 min-replicas-max-lag 10 3. å“¨å…µé…ç½® # sentinel.conf port 26379 sentinel monitor mymaster 127.0.0.1 6379 2 sentinel down-after-milliseconds mymaster 5000 sentinel parallel-syncs mymaster 1 sentinel failover-timeout mymaster 10000 sentinel deny-scripts-reconfig yes æ€§èƒ½ç›‘æ§ 1. å‘½ä»¤ç›‘æ§ 1 2 3 4 5 6 7 8 9 # å®æ—¶ç›‘æ§ redis-cli monitor # æ…¢æŸ¥è¯¢æ—¥å¿— redis-cli slowlog get 10 redis-cli slowlog reset # å‘½ä»¤ç»Ÿè®¡ redis-cli info commandstats | grep -E \u0026#34;cmdstat_[a-z]+\u0026#34; 2. æ€§èƒ½æŒ‡æ ‡ 1 2 3 4 5 6 7 8 9 10 11 12 13 # åŸºç¡€ä¿¡æ¯ redis-cli info server redis-cli info memory redis-cli info stats # è¿æ¥ä¿¡æ¯ redis-cli info clients # æŒä¹…åŒ–ä¿¡æ¯ redis-cli info persistence # å¤åˆ¶ä¿¡æ¯ redis-cli info replication 3. è‡ªå®šä¹‰ç›‘æ§è„šæœ¬ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 # monitor_redis.py import redis import time import json def monitor_redis(): r = redis.Redis(host=\u0026#39;localhost\u0026#39;, port=6379) while True: info = r.info() metrics = { \u0026#39;timestamp\u0026#39;: int(time.time()), \u0026#39;connected_clients\u0026#39;: info[\u0026#39;connected_clients\u0026#39;], \u0026#39;used_memory\u0026#39;: info[\u0026#39;used_memory_human\u0026#39;], \u0026#39;ops_per_sec\u0026#39;: info[\u0026#39;instantaneous_ops_per_sec\u0026#39;], \u0026#39;keyspace_hits\u0026#39;: info[\u0026#39;keyspace_hits\u0026#39;], \u0026#39;keyspace_misses\u0026#39;: info[\u0026#39;keyspace_misses\u0026#39;] } print(json.dumps(metrics, indent=2)) time.sleep(5) if __name__ == \u0026#39;__main__\u0026#39;: monitor_redis() é«˜çº§ä¼˜åŒ–æŠ€å·§ 1. Luaè„šæœ¬ä¼˜åŒ– 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 -- æ‰¹é‡æ“ä½œè„šæœ¬ local results = {} for i = 1, #ARGV do local key = ARGV[i] local value = redis.call(\u0026#39;GET\u0026#39;, key) table.insert(results, value) end return results -- å¤æ‚äº‹åŠ¡è„šæœ¬ if redis.call(\u0026#39;EXISTS\u0026#39;, KEYS[1]) == 1 then local current = redis.call(\u0026#39;GET\u0026#39;, KEYS[1]) local new_value = tonumber(current) + tonumber(ARGV[1]) redis.call(\u0026#39;SET\u0026#39;, KEYS[1], new_value) return new_value else return nil end 2. å†…å­˜ç¢ç‰‡æ•´ç† 1 2 3 4 5 6 7 # æ‰‹åŠ¨å†…å­˜ç¢ç‰‡æ•´ç† redis-cli memory purge # è‡ªåŠ¨å†…å­˜ç¢ç‰‡æ•´ç† redis-cli config set activedefrag yes redis-cli config set active-defrag-cycle-min 1 redis-cli config set active-defrag-cycle-max 25 3. æ•°æ®ç»“æ„é€‰æ‹©ç­–ç•¥ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 # String: ç®€å•é”®å€¼å¯¹ # ä½¿ç”¨åœºæ™¯ï¼šè®¡æ•°å™¨ã€ç®€å•ç¼“å­˜ SET user:1000:name \u0026#34;John\u0026#34; # Hash: å¯¹è±¡å­˜å‚¨ # ä½¿ç”¨åœºæ™¯ï¼šç”¨æˆ·ä¿¡æ¯ã€é…ç½® HMSET user:1000 name \u0026#34;John\u0026#34; age 30 email \u0026#34;john@example.com\u0026#34; # List: é˜Ÿåˆ—ã€æ ˆ # ä½¿ç”¨åœºæ™¯ï¼šæ¶ˆæ¯é˜Ÿåˆ—ã€æœ€æ–°åˆ—è¡¨ LPUSH queue:tasks \u0026#34;task1\u0026#34; RPOP queue:tasks # Set: å”¯ä¸€å€¼é›†åˆ # ä½¿ç”¨åœºæ™¯ï¼šæ ‡ç­¾ã€å…³æ³¨åˆ—è¡¨ SADD user:1000:tags \u0026#34;python\u0026#34; \u0026#34;redis\u0026#34; \u0026#34;database\u0026#34; # ZSet: æœ‰åºé›†åˆ # ä½¿ç”¨åœºæ™¯ï¼šæ’è¡Œæ¦œã€å¸¦æƒé‡çš„é˜Ÿåˆ— ZADD leaderboard 1000 \u0026#34;player1\u0026#34; 950 \u0026#34;player2\u0026#34; å®æˆ˜ä¼˜åŒ–æ¡ˆä¾‹ 1. ç¼“å­˜é¢„çƒ­ç­–ç•¥ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 # ç¼“å­˜é¢„çƒ­è„šæœ¬ def warm_up_cache(): r = redis.Redis() # é¢„çƒ­çƒ­ç‚¹æ•°æ® hot_items = get_hot_items_from_db() pipe = r.pipeline() for item in hot_items: pipe.setex( f\u0026#34;item:{item[\u0026#39;id\u0026#39;]}\u0026#34;, 3600, # 1å°æ—¶è¿‡æœŸ json.dumps(item) ) pipe.execute() 2. ç¼“å­˜æ›´æ–°ç­–ç•¥ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 # Cache-Asideæ¨¡å¼ def get_data(key): r = redis.Redis() # å…ˆä»ç¼“å­˜è·å– data = r.get(key) if data: return json.loads(data) # ç¼“å­˜æœªå‘½ä¸­ï¼Œä»æ•°æ®åº“è·å– data = get_from_database(key) if data: # å†™å…¥ç¼“å­˜ r.setex(key, 3600, json.dumps(data)) return data # Write-Throughæ¨¡å¼ def update_data(key, data): r = redis.Redis() # åŒæ—¶æ›´æ–°æ•°æ®åº“å’Œç¼“å­˜ update_database(key, data) r.setex(key, 3600, json.dumps(data)) 3. åˆ†å¸ƒå¼é”å®ç° 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 # Redisåˆ†å¸ƒå¼é” import time import uuid def acquire_lock(lock_name, acquire_timeout=10): r = redis.Redis() identifier = str(uuid.uuid4()) end = time.time() + acquire_timeout while time.time() \u0026lt; end: if r.set(lock_name, identifier, nx=True, ex=acquire_timeout): return identifier time.sleep(0.001) return False def release_lock(lock_name, identifier): r = redis.Redis() lua_script = \u0026#34;\u0026#34;\u0026#34; if redis.call(\u0026#34;get\u0026#34;, KEYS[1]) == ARGV[1] then return redis.call(\u0026#34;del\u0026#34;, KEYS[1]) else return 0 end \u0026#34;\u0026#34;\u0026#34; return r.eval(lua_script, 1, lock_name, identifier) æ•…éšœæ’æŸ¥ 1. å¸¸è§é—®é¢˜è¯Šæ–­ 1 2 3 4 5 6 7 8 9 10 11 # æ£€æŸ¥å»¶è¿Ÿ redis-cli --latency-history # å†…å­˜æ³„æ¼æ£€æŸ¥ redis-cli memory doctor # è¿æ¥é—®é¢˜ redis-cli client list # ä¸»ä»åŒæ­¥çŠ¶æ€ redis-cli info replication 2. æ€§èƒ½åˆ†æå·¥å…· 1 2 3 4 5 # Redis-Full-Check (æ•°æ®ä¸€è‡´æ€§) redis-full-check -s 127.0.0.1:6379 -t 127.0.0.1:6380 # Redis-Shake (æ•°æ®è¿ç§») redis-shake.linux -type=rump -source=127.0.0.1:6379 -target=127.0.0.1:6380 æœ€ä½³å®è·µæ€»ç»“ å†…å­˜ç®¡ç†ï¼šåˆç†è®¾ç½®maxmemoryå’Œæ·˜æ±°ç­–ç•¥ æŒä¹…åŒ–ï¼šæ ¹æ®ä¸šåŠ¡éœ€æ±‚é€‰æ‹©RDBæˆ–AOF ç½‘ç»œä¼˜åŒ–ï¼šä½¿ç”¨Pipelineå‡å°‘ç½‘ç»œå¾€è¿” é›†ç¾¤éƒ¨ç½²ï¼šåˆç†è§„åˆ’åˆ†ç‰‡å’Œå‰¯æœ¬ ç›‘æ§å‘Šè­¦ï¼šå»ºç«‹å®Œå–„çš„ç›‘æ§ä½“ç³» å®‰å…¨é…ç½®ï¼šè®¾ç½®å¯†ç å’Œè®¿é—®æ§åˆ¶ æ€»ç»“ Redis 7çš„æ€§èƒ½ä¼˜åŒ–è¦ç‚¹ï¼š\nå†…å­˜ä¼˜åŒ–ï¼šé€‰æ‹©åˆé€‚çš„æ•°æ®ç»“æ„ï¼Œé…ç½®å†…å­˜å‚æ•° æŒä¹…åŒ–ä¼˜åŒ–ï¼šå¹³è¡¡æ€§èƒ½å’Œæ•°æ®å®‰å…¨ ç½‘ç»œä¼˜åŒ–ï¼šå‡å°‘è¿æ¥å¼€é”€ï¼Œæ‰¹é‡å¤„ç†å‘½ä»¤ é›†ç¾¤ä¼˜åŒ–ï¼šåˆç†åˆ†ç‰‡ï¼Œä¿éšœé«˜å¯ç”¨ ç›‘æ§ä¼˜åŒ–ï¼šå®æ—¶ç›‘æ§ï¼ŒåŠæ—¶å‘ç°é—®é¢˜ é€šè¿‡ä»¥ä¸Šä¼˜åŒ–ç­–ç•¥ï¼Œå¯ä»¥æ„å»ºé«˜æ€§èƒ½ã€é«˜å¯ç”¨çš„Redisç³»ç»Ÿã€‚\nç›¸å…³èµ„æº Redis 7å®˜æ–¹æ–‡æ¡£ Redisæœ€ä½³å®è·µ Redisç›‘æ§å·¥å…· ","permalink":"/blog/articles/redis-7-optimization-guide/","summary":"æŒæ¡Redis 7çš„æ ¸å¿ƒä¼˜åŒ–æŠ€å·§ï¼Œæ„å»ºé«˜æ€§èƒ½ç¼“å­˜ç³»ç»Ÿã€‚","title":"Redis 7æ€§èƒ½ä¼˜åŒ–å®Œå…¨æŒ‡å—"},{"content":"PostgreSQL 17æ–°ç‰¹æ€§å…¨é¢è§£æ PostgreSQL 17å¸¦æ¥äº†ä¼—å¤šä»¤äººå…´å¥‹çš„æ–°ç‰¹æ€§å’Œæ”¹è¿›ï¼Œè¿›ä¸€æ­¥å·©å›ºäº†å…¶ä½œä¸ºä¸–ç•Œä¸Šæœ€å…ˆè¿›çš„å¼€æºå…³ç³»å‹æ•°æ®åº“çš„åœ°ä½ã€‚æœ¬æ–‡å°†æ·±å…¥æ¢è®¨è¿™äº›æ–°ç‰¹æ€§åŠå…¶åœ¨å®é™…åº”ç”¨ä¸­çš„ä»·å€¼ã€‚\næ ¸å¿ƒæ€§èƒ½æå‡ 1. å¹¶è¡ŒæŸ¥è¯¢ä¼˜åŒ– PostgreSQL 17å¤§å¹…æå‡äº†å¹¶è¡ŒæŸ¥è¯¢çš„èƒ½åŠ›ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 -- å¯ç”¨å¹¶è¡ŒæŸ¥è¯¢ SET max_parallel_workers_per_gather = 4; SET parallel_tuple_cost = 0.1; SET parallel_setup_cost = 1000.0; -- å¤æ‚æŸ¥è¯¢è‡ªåŠ¨å¹¶è¡Œæ‰§è¡Œ EXPLAIN (ANALYZE, BUFFERS) SELECT o.order_id, c.customer_name, SUM(oi.quantity * oi.price) as total_amount FROM orders o JOIN customers c ON o.customer_id = c.customer_id JOIN order_items oi ON o.order_id = oi.order_id WHERE o.order_date \u0026gt;= \u0026#39;2024-01-01\u0026#39; GROUP BY o.order_id, c.customer_name HAVING SUM(oi.quantity * oi.price) \u0026gt; 1000; -- å¹¶è¡Œåˆ›å»ºç´¢å¼• CREATE INDEX CONCURRENTLY idx_orders_customer_date ON orders(customer_id, order_date) WITH (parallel_workers = 4); 2. VACUUMæ€§èƒ½æ”¹è¿› 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 -- æ–°çš„VACUUMé€‰é¡¹ VACUUM (INDEX_CLEANUP OFF, TRUNCATE OFF) large_table; -- å¹¶è¡ŒVACUUM ALTER TABLE large_table SET (autovacuum_vacuum_scale_factor = 0.05); ALTER TABLE large_table SET (autovacuum_vacuum_cost_delay = \u0026#39;10ms\u0026#39;); ALTER TABLE large_table SET (autovacuum_vacuum_cost_limit = 200); -- ç›‘æ§VACUUMè¿›åº¦ SELECT pid, now() - pg_stat_activity.query_start AS duration, query, state FROM pg_stat_activity WHERE query LIKE \u0026#39;%VACUUM%\u0026#39;; JSON/JSONBå¢å¼º 1. SQL/JSONæ ‡å‡†æ”¯æŒ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 -- æ–°çš„SQL/JSONè·¯å¾„è¡¨è¾¾å¼ SELECT jsonb_path_query_array( data, \u0026#39;$.items[*] ? (@.price \u0026gt; 100)\u0026#39; ) as expensive_items FROM products; -- JSON_TABLEå‡½æ•° SELECT * FROM jsonb_table( \u0026#39;{\u0026#34;orders\u0026#34;: [{\u0026#34;id\u0026#34;: 1, \u0026#34;items\u0026#34;: [{\u0026#34;name\u0026#34;: \u0026#34;A\u0026#34;, \u0026#34;qty\u0026#34;: 2}]}]}\u0026#39;, \u0026#39;$.orders[*]\u0026#39; COLUMNS ( order_id int PATH \u0026#39;$.id\u0026#39;, item_count int PATH \u0026#39;$.items.size()\u0026#39; ) ); -- JSON_EXISTSå‡½æ•° SELECT product_id, product_name FROM products WHERE jsonb_exists( attributes, \u0026#39;$.details ? (@.warranty == true)\u0026#39; ); 2. JSONèšåˆå‡½æ•° 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 -- æ–°çš„JSONèšåˆå‡½æ•° SELECT customer_id, jsonb_agg( jsonb_build_object( \u0026#39;order_id\u0026#39;, order_id, \u0026#39;total\u0026#39;, total_amount, \u0026#39;date\u0026#39;, order_date ) ORDER BY order_date ) as orders FROM orders GROUP BY customer_id; -- JSON_OBJECTAGG SELECT json_object_agg( product_name, json_build_object(\u0026#39;price\u0026#39;, price, \u0026#39;stock\u0026#39;, stock) ) as product_catalog FROM products; SQLå¢å¼ºåŠŸèƒ½ 1. MERGEè¯­å¥æ”¹è¿› 1 2 3 4 5 6 7 8 9 10 11 12 13 14 -- å®Œæ•´çš„MERGEæ”¯æŒ MERGE INTO target_table t USING source_table s ON t.id = s.id WHEN MATCHED AND s.status = \u0026#39;deleted\u0026#39; THEN DELETE WHEN MATCHED AND t.updated_at \u0026lt; s.updated_at THEN UPDATE SET name = s.name, price = s.price, updated_at = CURRENT_TIMESTAMP WHEN NOT MATCHED THEN INSERT (id, name, price, created_at) VALUES (s.id, s.name, s.price, CURRENT_TIMESTAMP); 2. å¢å¼ºçš„åˆ†åŒºè¡¨åŠŸèƒ½ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 -- åŸç”Ÿåˆ†åŒºä¿®å‰ª CREATE TABLE orders ( order_id BIGINT, order_date DATE, customer_id INTEGER, amount DECIMAL(10,2) ) PARTITION BY RANGE (order_date); -- è‡ªåŠ¨åˆ›å»ºåˆ†åŒº CREATE TABLE orders_2024_q1 PARTITION OF orders FOR VALUES FROM (\u0026#39;2024-01-01\u0026#39;) TO (\u0026#39;2024-04-01\u0026#39;); -- åˆ†åŒºè£å‰ªä¼˜åŒ– EXPLAIN (COSTS OFF) SELECT * FROM orders WHERE order_date BETWEEN \u0026#39;2024-02-01\u0026#39; AND \u0026#39;2024-02-29\u0026#39;; ç´¢å¼•å’ŒæŸ¥è¯¢ä¼˜åŒ– 1. å¢å¼ºçš„Bæ ‘ç´¢å¼• 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 -- å¢é‡æ’åºæ”¯æŒ CREATE INDEX idx_products_name_price ON products(name ASC NULLS LAST, price DESC); -- INCLUDEç´¢å¼•ä¼˜åŒ– CREATE INDEX idx_orders_customer_date ON orders(customer_id) INCLUDE (order_date, total_amount); -- ç´¢å¼•ä½¿ç”¨ç»Ÿè®¡ SELECT schemaname, tablename, indexname, idx_scan, idx_tup_read, idx_tup_fetch FROM pg_stat_user_indexes ORDER BY idx_scan DESC; 2. å¹¶è¡Œç´¢å¼•åˆ›å»º 1 2 3 4 5 6 7 8 9 10 11 12 -- å¹¶è¡Œåˆ›å»ºç´¢å¼• CREATE INDEX CONCURRENTLY idx_large_table_column ON large_table(column) WITH (parallel_workers = 4); -- ç›‘æ§ç´¢å¼•åˆ›å»ºè¿›åº¦ SELECT pid, phase, tuples_done, tuples_total FROM pg_stat_progress_create_index; å¤åˆ¶å’Œé«˜å¯ç”¨æ€§ 1. é€»è¾‘å¤åˆ¶å¢å¼º 1 2 3 4 5 6 7 8 9 10 11 12 13 -- å‘å¸ƒè¡¨çš„éƒ¨åˆ†æ•°æ® CREATE PUBLICATION sales_publication FOR TABLE orders WHERE (order_date \u0026gt;= \u0026#39;2024-01-01\u0026#39;); -- è¡Œè¿‡æ»¤è®¢é˜… CREATE SUBSCRIPTION sales_subscription CONNECTION \u0026#39;host=replica dbname=sales\u0026#39; PUBLICATION sales_publication WITH (slot_name = sales_slot, create_slot = false); -- å¤åˆ¶å†²çªè§£å†³ ALTER SUBSCRIPTION sales_subscription SET (skip_transaction = \u0026#39;all\u0026#39;); 2. åŒæ­¥å¤åˆ¶æ”¹è¿› 1 2 3 4 5 6 7 8 9 10 11 -- é…ç½®åŒæ­¥å¤åˆ¶ ALTER SYSTEM SET synchronous_commit = \u0026#39;remote_apply\u0026#39;; ALTER SYSTEM SET synchronous_standby_names = \u0026#39;standby1,standby2\u0026#39;; -- ç›‘æ§å¤åˆ¶å»¶è¿Ÿ SELECT application_name, state, sync_state, pg_size_pretty(pg_wal_lsn_diff(pg_current_wal_lsn(), replay_lsn)) AS lag_bytes FROM pg_stat_replication; å®‰å…¨æ€§å¢å¼º 1. å¢å¼ºçš„è§’è‰²ç®¡ç† 1 2 3 4 5 6 7 8 9 10 11 12 13 14 -- è§’è‰²å±‚æ¬¡ç»“æ„ CREATE ROLE read_only; CREATE ROLE read_write INHERIT; GRANT read_only TO read_write; -- åŠ¨æ€æƒé™ç®¡ç† GRANT SELECT ON ALL TABLES IN SCHEMA public TO read_only; ALTER DEFAULT PRIVILEGES IN SCHEMA public GRANT SELECT ON TABLES TO read_only; -- è¡Œçº§å®‰å…¨ç­–ç•¥ CREATE POLICY user_orders_policy ON orders FOR ALL TO authenticated_users USING (customer_id = current_user_id()) WITH CHECK (customer_id = current_user_id()); 2. åŠ å¯†å’Œè®¤è¯ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 -- å­—æ®µçº§åŠ å¯† CREATE EXTENSION IF NOT EXISTS pgcrypto; -- ä½¿ç”¨åŠ å¯†å‡½æ•° INSERT INTO sensitive_data (id, encrypted_data) VALUES (1, pgp_sym_encrypt(\u0026#39;secret information\u0026#39;, \u0026#39;encryption_key\u0026#39;)); -- ç´¢å¼•åŠ å¯†æ•°æ® CREATE INDEX idx_encrypted_hash ON sensitive_data USING hash (md5(encrypted_data)); -- è¯ä¹¦è®¤è¯é…ç½® ALTER SYSTEM SET ssl_cert_file = \u0026#39;/etc/ssl/certs/server.crt\u0026#39;; ALTER SYSTEM SET ssl_key_file = \u0026#39;/etc/ssl/private/server.key\u0026#39;; SELECT pg_reload_conf(); ç›‘æ§å’Œè¯Šæ–­ 1. å¢å¼ºçš„ç»Ÿè®¡ä¿¡æ¯ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 -- æ‰©å±•ç»Ÿè®¡ä¿¡æ¯ CREATE STATISTICS s1 (dependencies, ndistinct) ON customer_id, order_date FROM orders; -- æŸ¥è¯¢ç»Ÿè®¡ä¿¡æ¯ SELECT schemaname, tablename, attname, n_distinct, correlation FROM pg_stats WHERE tablename = \u0026#39;orders\u0026#39;; -- å®æ—¶æŸ¥è¯¢ç›‘æ§ SELECT pid, now() - query_start as duration, query, state, wait_event_type, wait_event FROM pg_stat_activity WHERE state = \u0026#39;active\u0026#39;; 2. æ€§èƒ½åˆ†æå·¥å…· 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 -- æŸ¥è¯¢æ€§èƒ½åˆ†æ EXPLAIN (ANALYZE, BUFFERS, TIMING, SUMMARY, VERBOSE) SELECT * FROM large_table WHERE indexed_column = value; -- è‡ªåŠ¨æ‰©å±•ç»Ÿè®¡ ALTER SYSTEM SET track_activity_query_size = 16384; ALTER SYSTEM SET log_min_duration_statement = \u0026#39;1000ms\u0026#39;; -- æ…¢æŸ¥è¯¢æ—¥å¿— SELECT query, calls, total_time, mean_time, rows FROM pg_stat_statements ORDER BY mean_time DESC LIMIT 10; å®æˆ˜åº”ç”¨æ¡ˆä¾‹ 1. æ—¶åºæ•°æ®å¤„ç† 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 -- æ—¶åºæ•°æ®è¡¨è®¾è®¡ CREATE TABLE metrics ( time TIMESTAMPTZ NOT NULL, device_id INTEGER NOT NULL, metric_name TEXT NOT NULL, value DOUBLE PRECISION, tags JSONB ) PARTITION BY RANGE (time); -- è‡ªåŠ¨åˆ†åŒºç®¡ç† CREATE OR REPLACE FUNCTION create_monthly_partition(table_name text, start_date date) RETURNS void AS $$ DECLARE partition_name text; end_date date; BEGIN partition_name := table_name || \u0026#39;_\u0026#39; || to_char(start_date, \u0026#39;YYYY_MM\u0026#39;); end_date := start_date + interval \u0026#39;1 month\u0026#39;; EXECUTE format(\u0026#39;CREATE TABLE IF NOT EXISTS %I PARTITION OF %I FOR VALUES FROM (%L) TO (%L)\u0026#39;, partition_name, table_name, start_date, end_date); END; $$ LANGUAGE plpgsql; -- æ—¶é—´çª—å£æŸ¥è¯¢ SELECT time_bucket(\u0026#39;1 hour\u0026#39;, time) as hour, device_id, metric_name, avg(value) as avg_value, max(value) as max_value, min(value) as min_value FROM metrics WHERE time \u0026gt;= now() - interval \u0026#39;24 hours\u0026#39; GROUP BY hour, device_id, metric_name; 2. å…¨æ–‡æœç´¢ä¼˜åŒ– 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 -- å…¨æ–‡æœç´¢é…ç½® CREATE EXTENSION IF NOT EXISTS pg_trgm; -- åˆ›å»ºå…¨æ–‡æœç´¢ç´¢å¼• CREATE INDEX idx_products_search ON products USING gin(to_tsvector(\u0026#39;english\u0026#39;, name || \u0026#39; \u0026#39; || description)); -- é«˜çº§æœç´¢æŸ¥è¯¢ SELECT product_id, name, description, ts_rank(search_vector, query) as rank FROM products, plainto_tsquery(\u0026#39;english\u0026#39;, \u0026#39;high performance laptop\u0026#39;) as query WHERE search_vector @@ query ORDER BY rank DESC LIMIT 10; -- æ¨¡ç³Šæœç´¢ SELECT * FROM products WHERE name % \u0026#39;laptap\u0026#39; -- ç›¸ä¼¼åº¦æœç´¢ ORDER BY similarity(name, \u0026#39;laptap\u0026#39;) DESC; å‡çº§æŒ‡å— 1. å‡†å¤‡å·¥ä½œ 1 2 3 4 5 6 7 8 9 # å¤‡ä»½æ•°æ®åº“ pg_dumpall -U postgres \u0026gt; backup_before_17.sql # æ£€æŸ¥å…¼å®¹æ€§ pg_upgrade --check \\ --old-bindir=/usr/pgsql-16/bin \\ --new-bindir=/usr/pgsql-17/bin \\ --old-datadir=/var/lib/pgsql/16/data \\ --new-datadir=/var/lib/pgsql/17/data 2. æ‰§è¡Œå‡çº§ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 # åœæ­¢æœåŠ¡ systemctl stop postgresql-16 # æ‰§è¡Œå‡çº§ pg_upgrade \\ --old-bindir=/usr/pgsql-16/bin \\ --new-bindir=/usr/pgsql-17/bin \\ --old-datadir=/var/lib/pgsql/16/data \\ --new-datadir=/var/lib/pgsql/17/data \\ --old-port=5432 \\ --new-port=5433 # å¯åŠ¨æ–°ç‰ˆæœ¬ systemctl start postgresql-17 æœ€ä½³å®è·µ 1. æ€§èƒ½è°ƒä¼˜ 1 2 3 4 5 6 7 8 9 10 -- é…ç½®å»ºè®® ALTER SYSTEM SET shared_buffers = \u0026#39;4GB\u0026#39;; ALTER SYSTEM SET effective_cache_size = \u0026#39;12GB\u0026#39;; ALTER SYSTEM SET work_mem = \u0026#39;256MB\u0026#39;; ALTER SYSTEM SET maintenance_work_mem = \u0026#39;1GB\u0026#39;; ALTER SYSTEM SET random_page_cost = 1.1; ALTER SYSTEM SET effective_io_concurrency = 200; -- é‡æ–°åŠ è½½é…ç½® SELECT pg_reload_conf(); 2. ç›‘æ§è®¾ç½® 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 -- å¯ç”¨æ‰©å±• CREATE EXTENSION IF NOT EXISTS pg_stat_statements; CREATE EXTENSION IF NOT EXISTS pg_buffercache; -- ç›‘æ§æŸ¥è¯¢ SELECT datname, numbackends, xact_commit, xact_rollback, blks_read, blks_hit, tup_returned, tup_fetched, tup_inserted, tup_updated, tup_deleted FROM pg_stat_database WHERE datname not in (\u0026#39;template0\u0026#39;, \u0026#39;template1\u0026#39;); æ€»ç»“ PostgreSQL 17çš„ä¸»è¦æ”¹è¿›åŒ…æ‹¬ï¼š\næ€§èƒ½æå‡ï¼šå¹¶è¡ŒæŸ¥è¯¢ä¼˜åŒ–ã€VACUUMæ”¹è¿› JSONå¢å¼ºï¼šå®Œæ•´çš„SQL/JSONæ ‡å‡†æ”¯æŒ SQLåŠŸèƒ½ï¼šMERGEè¯­å¥æ”¹è¿›ã€åˆ†åŒºè¡¨å¢å¼º ç´¢å¼•ä¼˜åŒ–ï¼šå¹¶è¡Œç´¢å¼•åˆ›å»ºã€INCLUDEç´¢å¼• å¤åˆ¶æ”¹è¿›ï¼šé€»è¾‘å¤åˆ¶å¢å¼ºã€åŒæ­¥å¤åˆ¶ä¼˜åŒ– å®‰å…¨æ€§ï¼šè§’è‰²ç®¡ç†ã€åŠ å¯†åŠŸèƒ½å¢å¼º è¿™äº›ç‰¹æ€§ä½¿PostgreSQL 17æˆä¸ºæ›´å¼ºå¤§ã€æ›´å¯é çš„æ•°æ®åº“è§£å†³æ–¹æ¡ˆã€‚\nç›¸å…³èµ„æº PostgreSQL 17å®˜æ–¹æ–‡æ¡£ PostgreSQL 17å‘å¸ƒè¯´æ˜ PostgreSQLæ€§èƒ½è°ƒä¼˜æŒ‡å— ","permalink":"/blog/articles/postgresql-17-new-features/","summary":"å…¨é¢äº†è§£PostgreSQL 17çš„å¼ºå¤§æ–°åŠŸèƒ½ï¼Œæå‡æ•°æ®åº“æ€§èƒ½å’Œå¼€å‘ä½“éªŒã€‚","title":"PostgreSQL 17æ–°ç‰¹æ€§å…¨é¢è§£æ"},{"content":"Tailwind CSS 4.0æ–°ç‰¹æ€§æ·±åº¦è§£æ Tailwind CSS 4.0å¸¦æ¥äº†é©å‘½æ€§çš„å˜åŒ–ï¼Œä»PostCSSæ’ä»¶è½¬å˜ä¸ºåŸç”ŸCSSå¼•æ“ï¼Œä¸ºå¼€å‘è€…æä¾›äº†æ›´å¿«çš„æ„å»ºé€Ÿåº¦ã€æ›´çµæ´»çš„é…ç½®å’Œæ›´å¼ºå¤§çš„åŠŸèƒ½ã€‚æœ¬æ–‡å°†æ·±å…¥æ¢è®¨è¿™äº›æ–°ç‰¹æ€§ã€‚\næ ¸å¿ƒæ¶æ„å˜é© åŸç”ŸCSSå¼•æ“ Tailwind CSS 4.0æœ€å¤§çš„å˜åŒ–æ˜¯é‡‡ç”¨äº†åŸç”ŸCSSå¼•æ“ï¼Œä¸å†ä¾èµ–PostCSSï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 /* tailwind.css */ @import \u0026#34;tailwindcss\u0026#34;; /* ç›´æ¥åœ¨CSSä¸­ä½¿ç”¨å·¥å…·ç±» */ .my-component { @apply p-4 bg-blue-500 text-white rounded-lg; } /* æ–°çš„CSSå˜é‡ç³»ç»Ÿ */ :root { --color-primary: #3b82f6; --color-secondary: #64748b; } é…ç½®æ–¹å¼æ›´æ–° 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 // tailwind.config.js (æ”¯æŒJSå’ŒTS) export default { content: [\u0026#39;./src/**/*.{js,ts,jsx,tsx}\u0026#39;], theme: { extend: { colors: { primary: \u0026#39;var(--color-primary)\u0026#39;, secondary: \u0026#39;var(--color-secondary)\u0026#39; } } }, plugins: [] } // æˆ–ä½¿ç”¨CSSé…ç½® @config \u0026#34;./tailwind.config.js\u0026#34;; æ–°çš„å®¹å™¨æŸ¥è¯¢æ”¯æŒ å®¹å™¨æŸ¥è¯¢æ˜¯CSSçš„ä¸€ä¸ªé‡è¦æ–°ç‰¹æ€§ï¼ŒTailwind 4.0æä¾›äº†å®Œæ•´çš„æ”¯æŒï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 \u0026lt;div class=\u0026#34;container-query-demo\u0026#34;\u0026gt; \u0026lt;!-- çˆ¶å®¹å™¨å®šä¹‰å®¹å™¨ --\u0026gt; \u0026lt;div class=\u0026#34;@container\u0026#34;\u0026gt; \u0026lt;!-- å­å…ƒç´ æ ¹æ®å®¹å™¨å°ºå¯¸å“åº” --\u0026gt; \u0026lt;div class=\u0026#34;@lg:text-xl @2xl:text-2xl @4xl:text-3xl\u0026#34;\u0026gt; å“åº”å¼æ–‡æœ¬å¤§å° \u0026lt;/div\u0026gt; \u0026lt;div class=\u0026#34;@sm:grid-cols-1 @md:grid-cols-2 @lg:grid-cols-3 grid gap-4\u0026#34;\u0026gt; \u0026lt;!-- å“åº”å¼ç½‘æ ¼ --\u0026gt; \u0026lt;div class=\u0026#34;card\u0026#34;\u0026gt;å¡ç‰‡1\u0026lt;/div\u0026gt; \u0026lt;div class=\u0026#34;card\u0026#34;\u0026gt;å¡ç‰‡2\u0026lt;/div\u0026gt; \u0026lt;div class=\u0026#34;card\u0026#34;\u0026gt;å¡ç‰‡3\u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;style\u0026gt; /* å®šä¹‰å®¹å™¨ */ .container-query-demo { container-type: inline-size; } \u0026lt;/style\u0026gt; æ–°çš„é…è‰²ç³»ç»Ÿ Tailwind CSS 4.0å¼•å…¥äº†å…¨æ–°çš„é…è‰²ç³»ç»Ÿï¼Œæ”¯æŒæ›´çµæ´»çš„é¢œè‰²å®šä¹‰ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 /* æ–°çš„é¢œè‰²è¯­æ³• */ :root { /* åŸºç¡€é¢œè‰²å®šä¹‰ */ --color-blue: #3b82f6; /* é¢œè‰²å˜ä½“ */ --color-blue-50: #eff6ff; --color-blue-100: #dbeafe; /* ... */ /* è¯­ä¹‰åŒ–é¢œè‰² */ --color-primary: var(--color-blue); --color-primary-foreground: white; /* åŠ¨æ€é¢œè‰² */ --color-success: hsl(142, 76%, 36%); --color-warning: hsl(38, 92%, 50%); } /* ä½¿ç”¨æ–°é¢œè‰²ç³»ç»Ÿ */ .button { background-color: oklch(0.6 0.2 250); color: oklch(0.98 0.02 250); } .button:hover { background-color: oklch(0.55 0.25 250); } æ€§èƒ½ä¼˜åŒ– æŒ‰éœ€ç”Ÿæˆ Tailwind 4.0å®ç°äº†çœŸæ­£çš„æŒ‰éœ€ç”Ÿæˆï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 // vite.config.js export default { css: { postcss: { plugins: [ require(\u0026#39;tailwindcss\u0026#39;)({ // ä»…ç”Ÿæˆä½¿ç”¨çš„ç±» safelist: [\u0026#39;hover:scale-100\u0026#39;, \u0026#39;focus:ring-2\u0026#39;] }) ] } } } æ„å»ºé€Ÿåº¦æå‡ 1 2 3 4 5 6 // ä½¿ç”¨æ–°çš„CSSå¼•æ“å¯ä»¥æ˜¾è‘—æå‡æ„å»ºé€Ÿåº¦ const stats = { \u0026#34;Tailwind 3.x\u0026#34;: \u0026#34;æ„å»ºæ—¶é—´: 3.2s\u0026#34;, \u0026#34;Tailwind 4.0\u0026#34;: \u0026#34;æ„å»ºæ—¶é—´: 0.8s\u0026#34;, \u0026#34;æ€§èƒ½æå‡\u0026#34;: \u0026#34;çº¦75%\u0026#34; } æ–°çš„å®ç”¨åŠŸèƒ½ CSSåµŒå¥—æ”¯æŒ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 /* åŸç”ŸCSSåµŒå¥— */ .card { @apply p-6 bg-white rounded-lg shadow-sm; \u0026amp;:hover { @apply shadow-md; .card-title { @apply text-blue-600; } } \u0026amp;-title { @apply text-xl font-semibold mb-2; } \u0026amp;-content { @apply text-gray-600; } } è‡ªå®šä¹‰å±æ€§å¢å¼º 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 /* æ›´å¼ºå¤§çš„CSSå˜é‡æ”¯æŒ */ .theme-dark { --color-surface: oklch(0.1 0.01 250); --color-on-surface: oklch(0.9 0.01 250); } .theme-light { --color-surface: oklch(1 0.01 250); --color-on-surface: oklch(0.1 0.01 250); } /* è‡ªåŠ¨ä¸»é¢˜åˆ‡æ¢ */ @media (prefers-color-scheme: dark) { :root { @apply theme-dark; } } å¸ƒå±€æ–°ç‰¹æ€§ å­ç½‘æ ¼ï¼ˆSubgridï¼‰ 1 2 3 4 5 6 7 8 9 10 \u0026lt;div class=\u0026#34;grid grid-cols-3 gap-4\u0026#34;\u0026gt; \u0026lt;div class=\u0026#34;col-span-1\u0026#34;\u0026gt; \u0026lt;div class=\u0026#34;subgrid grid grid-cols-1 gap-2\u0026#34;\u0026gt; \u0026lt;!-- ç»§æ‰¿çˆ¶å®¹å™¨çš„ç½‘æ ¼çº¿ --\u0026gt; \u0026lt;div class=\u0026#34;col-start-1 col-span-2\u0026#34;\u0026gt;å­é¡¹1\u0026lt;/div\u0026gt; \u0026lt;div class=\u0026#34;col-span-3\u0026#34;\u0026gt;å­é¡¹2\u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;div class=\u0026#34;col-span-2\u0026#34;\u0026gt;ä¸»è¦å†…å®¹\u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; å¸ƒå±€æŸ¥è¯¢ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 /* æ ¹æ®å¸ƒå±€æ¨¡å¼åº”ç”¨æ ·å¼ */ .sidebar { @apply p-4 bg-gray-100; /* å½“ä½œä¸ºä¾§è¾¹æ æ—¶çš„æ ·å¼ */ @supports (display: flex) { @apply flex flex-col; } /* å½“ä½œä¸ºç‹¬ç«‹é¡µé¢æ—¶çš„æ ·å¼ */ @media (min-width: 768px) { @apply hidden md:block; } } åŠ¨ç”»å’Œè¿‡æ¸¡å¢å¼º æ›´æµç•…çš„åŠ¨ç”» 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 /* æ–°çš„åŠ¨ç”»å·¥å…·ç±» */ .animate-slide-up { animation: slide-up 0.3s ease-out; } @keyframes slide-up { from { transform: translateY(10px); opacity: 0; } to { transform: translateY(0); opacity: 1; } } /* è§†å·®æ»šåŠ¨æ•ˆæœ */ .parallax { view-timeline-name: --parallax; animation: parallax linear; animation-timeline: --parallax; } @keyframes parallax { to { transform: translateY(-100px); } } é«˜çº§è¿‡æ¸¡ 1 2 3 4 5 6 7 8 9 10 11 12 /* æ›´å¤æ‚çš„è¿‡æ¸¡æ•ˆæœ */ .card { @apply transition-all duration-300 ease-in-out; \u0026amp;:hover { @apply scale-105 shadow-xl; /* è¿‡æ¸¡ç‰¹å®šå±æ€§ */ transition-property: transform, box-shadow; transition-delay: 0.1s; } } ç»„ä»¶åº“é›†æˆ è®¾è®¡ç³»ç»Ÿé›†æˆ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 // tailwind.config.js export default { theme: { extend: { // è®¾è®¡ä»¤ç‰Œ spacing: { \u0026#39;18\u0026#39;: \u0026#39;4.5rem\u0026#39;, \u0026#39;88\u0026#39;: \u0026#39;22rem\u0026#39; }, // ç»„ä»¶å˜ä½“ typography: { DEFAULT: { css: { maxWidth: \u0026#39;none\u0026#39;, color: \u0026#39;var(--color-text)\u0026#39;, a: { color: \u0026#39;var(--color-primary)\u0026#39;, \u0026#39;\u0026amp;:hover\u0026#39;: { color: \u0026#39;var(--color-primary-hover)\u0026#39; } } } } } } }, plugins: [ // è‡ªå®šä¹‰æ’ä»¶ function({ addUtilities, theme }) { addUtilities({ \u0026#39;.text-shadow\u0026#39;: { textShadow: \u0026#39;0 2px 4px rgba(0,0,0,0.10)\u0026#39; } }) } ] } å®æˆ˜æ¡ˆä¾‹ å“åº”å¼å¯¼èˆªæ  1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 \u0026lt;nav class=\u0026#34;bg-white shadow-sm sticky top-0 z-50\u0026#34;\u0026gt; \u0026lt;div class=\u0026#34;max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\u0026#34;\u0026gt; \u0026lt;div class=\u0026#34;flex justify-between items-center h-16\u0026#34;\u0026gt; \u0026lt;!-- Logo --\u0026gt; \u0026lt;div class=\u0026#34;flex-shrink-0\u0026#34;\u0026gt; \u0026lt;span class=\u0026#34;text-xl font-bold text-blue-600\u0026#34;\u0026gt;Brand\u0026lt;/span\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;!-- æ¡Œé¢èœå• --\u0026gt; \u0026lt;div class=\u0026#34;hidden md:flex items-center space-x-8\u0026#34;\u0026gt; \u0026lt;a href=\u0026#34;#\u0026#34; class=\u0026#34;text-gray-700 hover:text-blue-600 transition-colors\u0026#34;\u0026gt;é¦–é¡µ\u0026lt;/a\u0026gt; \u0026lt;a href=\u0026#34;#\u0026#34; class=\u0026#34;text-gray-700 hover:text-blue-600 transition-colors\u0026#34;\u0026gt;äº§å“\u0026lt;/a\u0026gt; \u0026lt;a href=\u0026#34;#\u0026#34; class=\u0026#34;text-gray-700 hover:text-blue-600 transition-colors\u0026#34;\u0026gt;å…³äº\u0026lt;/a\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;!-- ç§»åŠ¨èœå•æŒ‰é’® --\u0026gt; \u0026lt;div class=\u0026#34;md:hidden\u0026#34;\u0026gt; \u0026lt;button class=\u0026#34;p-2 rounded-md text-gray-700 hover:bg-gray-100\u0026#34;\u0026gt; \u0026lt;span class=\u0026#34;sr-only\u0026#34;\u0026gt;Open menu\u0026lt;/span\u0026gt; \u0026lt;!-- èœå•å›¾æ ‡ --\u0026gt; \u0026lt;/button\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;!-- ç§»åŠ¨èœå• --\u0026gt; \u0026lt;div class=\u0026#34;md:hidden hidden\u0026#34;\u0026gt; \u0026lt;div class=\u0026#34;px-2 pt-2 pb-3 space-y-1\u0026#34;\u0026gt; \u0026lt;a href=\u0026#34;#\u0026#34; class=\u0026#34;block px-3 py-2 text-gray-700 hover:bg-gray-100 rounded-md\u0026#34;\u0026gt;é¦–é¡µ\u0026lt;/a\u0026gt; \u0026lt;a href=\u0026#34;#\u0026#34; class=\u0026#34;block px-3 py-2 text-gray-700 hover:bg-gray-100 rounded-md\u0026#34;\u0026gt;äº§å“\u0026lt;/a\u0026gt; \u0026lt;a href=\u0026#34;#\u0026#34; class=\u0026#34;block px-3 py-2 text-gray-700 hover:bg-gray-100 rounded-md\u0026#34;\u0026gt;å…³äº\u0026lt;/a\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/nav\u0026gt; ç”µå•†äº§å“å¡ç‰‡ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 \u0026lt;div class=\u0026#34;@container p-6\u0026#34;\u0026gt; \u0026lt;div class=\u0026#34;grid @sm:grid-cols-2 @lg:grid-cols-3 @4xl:grid-cols-4 gap-6\u0026#34;\u0026gt; \u0026lt;!-- äº§å“å¡ç‰‡ --\u0026gt; \u0026lt;div class=\u0026#34;group relative bg-white rounded-lg shadow-sm hover:shadow-xl transition-all duration-300\u0026#34;\u0026gt; \u0026lt;div class=\u0026#34;aspect-square overflow-hidden rounded-t-lg\u0026#34;\u0026gt; \u0026lt;img src=\u0026#34;/product.jpg\u0026#34; alt=\u0026#34;Product\u0026#34; class=\u0026#34;w-full h-full object-cover group-hover:scale-110 transition-transform duration-300\u0026#34; /\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;div class=\u0026#34;p-4\u0026#34;\u0026gt; \u0026lt;h3 class=\u0026#34;font-semibold text-lg mb-2 line-clamp-2\u0026#34;\u0026gt;äº§å“åç§°\u0026lt;/h3\u0026gt; \u0026lt;p class=\u0026#34;text-gray-600 text-sm mb-3 line-clamp-2\u0026#34;\u0026gt;äº§å“æè¿°...\u0026lt;/p\u0026gt; \u0026lt;div class=\u0026#34;flex items-center justify-between\u0026#34;\u0026gt; \u0026lt;span class=\u0026#34;text-2xl font-bold text-blue-600\u0026#34;\u0026gt;Â¥299\u0026lt;/span\u0026gt; \u0026lt;button class=\u0026#34;px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors\u0026#34;\u0026gt; åŠ å…¥è´­ç‰©è½¦ \u0026lt;/button\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;!-- å¿«é€Ÿæ“ä½œ --\u0026gt; \u0026lt;div class=\u0026#34;absolute top-2 right-2 opacity-0 group-hover:opacity-100 transition-opacity\u0026#34;\u0026gt; \u0026lt;button class=\u0026#34;p-2 bg-white rounded-full shadow-md hover:bg-gray-50\u0026#34;\u0026gt; \u0026lt;!-- æ”¶è—å›¾æ ‡ --\u0026gt; \u0026lt;/button\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; è¿ç§»æŒ‡å— ä»3.xå‡çº§åˆ°4.0 1 2 3 4 5 6 7 8 9 10 # å®‰è£…Tailwind CSS 4.0 npm install tailwindcss@next # æ›´æ–°é…ç½®æ–‡ä»¶ # tailwind.config.js -\u0026gt; ä¿æŒå…¼å®¹ # æ›´æ–°CSSå¯¼å…¥ # @tailwind base; -\u0026gt; @import \u0026#34;tailwindcss/base\u0026#34;; # @tailwind components; -\u0026gt; @import \u0026#34;tailwindcss/components\u0026#34;; # @tailwind utilities; -\u0026gt; @import \u0026#34;tailwindcss/utilities\u0026#34;; å¸¸è§è¿ç§»é—®é¢˜ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 // 1. PostCSSæ’ä»¶å˜æ›´ // æ—§ç‰ˆæœ¬ module.exports = { plugins: [ require(\u0026#39;tailwindcss\u0026#39;), require(\u0026#39;autoprefixer\u0026#39;) ] } // æ–°ç‰ˆæœ¬ module.exports = { plugins: { tailwindcss: {}, autoprefixer: {} } } // 2. å®¹å™¨æŸ¥è¯¢è¯­æ³•æ›´æ–° // æ—§ç‰ˆæœ¬ \u0026lt;div class=\u0026#34;grid grid-cols-1 md:grid-cols-3\u0026#34;\u0026gt; // æ–°ç‰ˆæœ¬ï¼ˆæ”¯æŒå®¹å™¨æŸ¥è¯¢ï¼‰ \u0026lt;div class=\u0026#34;@container\u0026#34;\u0026gt; \u0026lt;div class=\u0026#34;@md:grid-cols-3 grid\u0026#34;\u0026gt; æœ€ä½³å®è·µ 1. æ€§èƒ½ä¼˜åŒ– 1 2 3 4 5 6 7 8 9 10 // ä»…åŒ…å«ä½¿ç”¨çš„ç±» module.exports = { content: [\u0026#39;./src/**/*.{html,js}\u0026#39;], safelist: [ // åŠ¨æ€ç”Ÿæˆçš„ç±» { pattern: /bg-(red|green|blue)-500/ } ] } 2. ç»„ç»‡CSS 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 /* æŒ‰åŠŸèƒ½ç»„ç»‡ */ @import \u0026#34;tailwindcss/base\u0026#34;; @import \u0026#34;tailwindcss/components\u0026#34;; @import \u0026#34;tailwindcss/utilities\u0026#34;; /* è‡ªå®šä¹‰åŸºç¡€æ ·å¼ */ @layer base { html { scroll-behavior: smooth; } } /* è‡ªå®šä¹‰ç»„ä»¶ */ @layer components { .btn { @apply px-4 py-2 rounded-md font-medium transition-colors; } .btn-primary { @apply bg-blue-600 text-white hover:bg-blue-700; } } /* è‡ªå®šä¹‰å·¥å…·ç±» */ @layer utilities { .text-shadow { text-shadow: 0 2px 4px rgba(0,0,0,0.1); } } æ€»ç»“ Tailwind CSS 4.0çš„ä¸»è¦æ”¹è¿›ï¼š\nåŸç”ŸCSSå¼•æ“ï¼šæ›´å¿«çš„æ„å»ºé€Ÿåº¦ å®¹å™¨æŸ¥è¯¢ï¼šåŸºäºçˆ¶å®¹å™¨çš„å“åº”å¼è®¾è®¡ æ–°é…è‰²ç³»ç»Ÿï¼šæ›´çµæ´»çš„é¢œè‰²ç®¡ç† æ€§èƒ½ä¼˜åŒ–ï¼šæŒ‰éœ€ç”Ÿæˆå’Œç¼“å­˜ CSSåµŒå¥—ï¼šæ›´æ¸…æ™°çš„ç»“æ„ç»„ç»‡ æ›´å¥½çš„TypeScriptæ”¯æŒï¼šå®Œæ•´çš„ç±»å‹å®‰å…¨ è¿™äº›æ”¹è¿›ä½¿Tailwind CSS 4.0æˆä¸ºæ›´å¼ºå¤§ã€æ›´é«˜æ•ˆçš„CSSæ¡†æ¶ã€‚\nç›¸å…³èµ„æº Tailwind CSS 4.0æ–‡æ¡£ å®¹å™¨æŸ¥è¯¢è§„èŒƒ CSS Nesting Module ","permalink":"/blog/articles/tailwindcss-4-new-features/","summary":"æ·±å…¥äº†è§£Tailwind CSS 4.0çš„æ ¸å¿ƒæ”¹è¿›ï¼Œæå‡å¼€å‘æ•ˆç‡å’Œåº”ç”¨æ€§èƒ½ã€‚","title":"Tailwind CSS 4.0æ–°ç‰¹æ€§æ·±åº¦è§£æ"},{"content":"Next.js 15 App Routerå®Œå…¨æŒ‡å— Next.js 15å¸¦æ¥äº†é©å‘½æ€§çš„App Routeræ¶æ„ï¼ŒåŸºäºReact Server Componentsæ„å»ºï¼Œä¸ºå…¨æ ˆå¼€å‘æä¾›äº†æ›´å¼ºå¤§ã€æ›´çµæ´»çš„è§£å†³æ–¹æ¡ˆã€‚æœ¬æ–‡å°†æ·±å…¥æ¢è®¨App Routerçš„æ ¸å¿ƒæ¦‚å¿µå’Œæœ€ä½³å®è·µã€‚\nApp RouteråŸºç¡€ ç›®å½•ç»“æ„ app/ â”œâ”€â”€ layout.tsx # æ ¹å¸ƒå±€ â”œâ”€â”€ page.tsx # é¦–é¡µ â”œâ”€â”€ loading.tsx # åŠ è½½UI â”œâ”€â”€ error.tsx # é”™è¯¯è¾¹ç•Œ â”œâ”€â”€ not-found.tsx # 404é¡µé¢ â”œâ”€â”€ globals.css # å…¨å±€æ ·å¼ â”œâ”€â”€ layout.module.css # å¸ƒå±€æ¨¡å—æ ·å¼ â”œâ”€â”€ blog/ â”‚ â”œâ”€â”€ layout.tsx # åšå®¢å¸ƒå±€ â”‚ â”œâ”€â”€ page.tsx # åšå®¢åˆ—è¡¨ â”‚ â””â”€â”€ [slug]/ â”‚ â”œâ”€â”€ page.tsx # åšå®¢è¯¦æƒ… â”‚ â””â”€â”€ loading.tsx â””â”€â”€ api/ â””â”€â”€ posts/ â””â”€â”€ route.ts # APIè·¯ç”± æ ¹å¸ƒå±€é…ç½® 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 // app/layout.tsx import type { Metadata } from \u0026#39;next\u0026#39; import { Inter } from \u0026#39;next/font/google\u0026#39; import \u0026#39;./globals.css\u0026#39; const inter = Inter({ subsets: [\u0026#39;latin\u0026#39;] }) export const metadata: Metadata = { title: { default: \u0026#39;My Next.js App\u0026#39;, template: \u0026#39;%s | My Next.js App\u0026#39; }, description: \u0026#39;Built with Next.js 15\u0026#39;, metadataBase: new URL(\u0026#39;https://example.com\u0026#39;), openGraph: { title: \u0026#39;My Next.js App\u0026#39;, description: \u0026#39;Built with Next.js 15\u0026#39;, url: \u0026#39;https://example.com\u0026#39;, siteName: \u0026#39;My Next.js App\u0026#39;, images: [\u0026#39;/og-image.jpg\u0026#39;], locale: \u0026#39;en_US\u0026#39;, type: \u0026#39;website\u0026#39; } } export default function RootLayout({ children, }: { children: React.ReactNode }) { return ( \u0026lt;html lang=\u0026#34;en\u0026#34;\u0026gt; \u0026lt;body className={inter.className}\u0026gt; \u0026lt;nav\u0026gt; {/* å¯¼èˆªæ  */} \u0026lt;/nav\u0026gt; \u0026lt;main\u0026gt; {children} \u0026lt;/main\u0026gt; \u0026lt;footer\u0026gt; {/* é¡µè„š */} \u0026lt;/footer\u0026gt; \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt; ) } æœåŠ¡å™¨ç»„ä»¶ vs å®¢æˆ·ç«¯ç»„ä»¶ æœåŠ¡å™¨ç»„ä»¶ï¼ˆé»˜è®¤ï¼‰ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 // app/page.tsx - æœåŠ¡å™¨ç»„ä»¶ import { db } from \u0026#39;@/lib/db\u0026#39; import { PostCard } from \u0026#39;@/components/PostCard\u0026#39; async function getPosts() { const posts = await db.post.findMany({ orderBy: { createdAt: \u0026#39;desc\u0026#39; }, take: 10 }) return posts } export default async function HomePage() { const posts = await getPosts() return ( \u0026lt;div className=\u0026#34;container\u0026#34;\u0026gt; \u0026lt;h1\u0026gt;æœ€æ–°æ–‡ç« \u0026lt;/h1\u0026gt; \u0026lt;div className=\u0026#34;grid\u0026#34;\u0026gt; {posts.map(post =\u0026gt; ( \u0026lt;PostCard key={post.id} post={post} /\u0026gt; ))} \u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; ) } // åŠ¨æ€è·¯ç”± - æœåŠ¡å™¨ç»„ä»¶ export async function generateMetadata({ params }: { params: { slug: string } }) { const post = await getPost(params.slug) return { title: post.title, description: post.excerpt, openGraph: { images: [post.coverImage] } } } export default async function PostPage({ params }: { params: { slug: string } }) { const post = await getPost(params.slug) return ( \u0026lt;article className=\u0026#34;prose\u0026#34;\u0026gt; \u0026lt;h1\u0026gt;{post.title}\u0026lt;/h1\u0026gt; \u0026lt;p\u0026gt;{post.excerpt}\u0026lt;/p\u0026gt; \u0026lt;div dangerouslySetInnerHTML={{ __html: post.content }} /\u0026gt; \u0026lt;/article\u0026gt; ) } å®¢æˆ·ç«¯ç»„ä»¶ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 // components/InteractiveMap.tsx - å®¢æˆ·ç«¯ç»„ä»¶ \u0026#39;use client\u0026#39; import { useState, useEffect } from \u0026#39;react\u0026#39; interface MapProps { center: [number, number] zoom: number } export function InteractiveMap({ center, zoom }: MapProps) { const [map, setMap] = useState\u0026lt;any\u0026gt;(null) useEffect(() =\u0026gt; { // åˆå§‹åŒ–åœ°å›¾ import(\u0026#39;leaflet\u0026#39;).then((L) =\u0026gt; { const mapInstance = L.map(\u0026#39;map\u0026#39;).setView(center, zoom) L.tileLayer(\u0026#39;https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png\u0026#39;).addTo(mapInstance) setMap(mapInstance) }) return () =\u0026gt; { map?.remove() } }, []) return \u0026lt;div id=\u0026#34;map\u0026#34; style={{ height: \u0026#39;400px\u0026#39; }} /\u0026gt; } æ•°æ®è·å– æœåŠ¡å™¨ç«¯æ•°æ®è·å– 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 // app/api/posts/route.ts - APIè·¯ç”± import { NextResponse } from \u0026#39;next/server\u0026#39; import { db } from \u0026#39;@/lib/db\u0026#39; export async function GET() { try { const posts = await db.post.findMany({ orderBy: { createdAt: \u0026#39;desc\u0026#39; } }) return NextResponse.json(posts) } catch (error) { return NextResponse.json( { error: \u0026#39;Failed to fetch posts\u0026#39; }, { status: 500 } ) } } export async function POST(request: Request) { try { const body = await request.json() const post = await db.post.create({ data: body }) return NextResponse.json(post, { status: 201 }) } catch (error) { return NextResponse.json( { error: \u0026#39;Failed to create post\u0026#39; }, { status: 500 } ) } } å®¢æˆ·ç«¯æ•°æ®è·å– 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 // hooks/usePosts.ts - è‡ªå®šä¹‰Hook \u0026#39;use client\u0026#39; import { useState, useEffect } from \u0026#39;react\u0026#39; interface Post { id: string title: string excerpt: string createdAt: string } export function usePosts() { const [posts, setPosts] = useState\u0026lt;Post[]\u0026gt;([]) const [loading, setLoading] = useState(true) const [error, setError] = useState\u0026lt;string | null\u0026gt;(null) useEffect(() =\u0026gt; { fetchPosts() }, []) async function fetchPosts() { try { const response = await fetch(\u0026#39;/api/posts\u0026#39;) if (!response.ok) throw new Error(\u0026#39;Failed to fetch\u0026#39;) const data = await response.json() setPosts(data) } catch (err) { setError(err instanceof Error ? err.message : \u0026#39;Unknown error\u0026#39;) } finally { setLoading(false) } } return { posts, loading, error, refetch: fetchPosts } } è·¯ç”±å’Œå¯¼èˆª ç¼–ç¨‹å¼å¯¼èˆª 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 // components/PostLink.tsx \u0026#39;use client\u0026#39; import Link from \u0026#39;next/link\u0026#39; import { useRouter } from \u0026#39;next/navigation\u0026#39; interface PostLinkProps { slug: string title: string } export function PostLink({ slug, title }: PostLinkProps) { const router = useRouter() const handleClick = () =\u0026gt; { // ä½¿ç”¨ç¨‹åºåŒ–å¯¼èˆª router.push(`/blog/${slug}`) } return ( \u0026lt;div\u0026gt; \u0026lt;Link href={`/blog/${slug}`} className=\u0026#34;text-blue-500 hover:underline\u0026#34;\u0026gt; {title} \u0026lt;/Link\u0026gt; \u0026lt;button onClick={handleClick} className=\u0026#34;ml-2 px-2 py-1 bg-gray-200 rounded\u0026#34;\u0026gt; é˜…è¯» \u0026lt;/button\u0026gt; \u0026lt;/div\u0026gt; ) } åŠ¨æ€è·¯ç”±å’Œæ•è·æ‰€æœ‰è·¯ç”± 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 // app/blog/[...slug]/page.tsx - æ•è·æ‰€æœ‰è·¯ç”± export default function CatchAllPage({ params }: { params: { slug: string[] } }) { const slugPath = params.slug.join(\u0026#39;/\u0026#39;) return ( \u0026lt;div\u0026gt; \u0026lt;h1\u0026gt;æ•è·æ‰€æœ‰è·¯ç”±\u0026lt;/h1\u0026gt; \u0026lt;p\u0026gt;è·¯å¾„: /blog/{slugPath}\u0026lt;/p\u0026gt; \u0026lt;/div\u0026gt; ) } // app/shop/[...slug]/page.tsx - å¯é€‰æ•è·æ‰€æœ‰è·¯ç”± export default function OptionalCatchAllPage({ params }: { params: { slug?: string[] } }) { if (!params.slug) { return \u0026lt;h1\u0026gt;å•†åº—é¦–é¡µ\u0026lt;/h1\u0026gt; } return ( \u0026lt;div\u0026gt; \u0026lt;h1\u0026gt;å•†å“é¡µé¢\u0026lt;/h1\u0026gt; \u0026lt;p\u0026gt;è·¯å¾„: /shop/{params.slug.join(\u0026#39;/\u0026#39;)}\u0026lt;/p\u0026gt; \u0026lt;/div\u0026gt; ) } ç¼“å­˜å’Œé‡æ–°éªŒè¯ æ•°æ®ç¼“å­˜ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 // lib/cache.ts import { cache } from \u0026#39;react\u0026#39; // ç¼“å­˜æ•°æ®è·å–å‡½æ•° export const getCachedPosts = cache(async () =\u0026gt; { const response = await fetch(\u0026#39;https://api.example.com/posts\u0026#39;, { next: { tags: [\u0026#39;posts\u0026#39;], // æ ‡ç­¾ç”¨äºé‡æ–°éªŒè¯ revalidate: 3600 // 1å°æ—¶é‡æ–°éªŒè¯ } }) return response.json() }) // app/posts/page.tsx export default async function PostsPage() { // ä½¿ç”¨ç¼“å­˜æ•°æ® const posts = await getCachedPosts() return ( \u0026lt;div\u0026gt; {posts.map(post =\u0026gt; ( \u0026lt;div key={post.id}\u0026gt;{post.title}\u0026lt;/div\u0026gt; ))} \u0026lt;/div\u0026gt; ) } // é‡æ–°éªŒè¯API export async function POST() { // é‡æ–°éªŒè¯æ ‡è®°ä¸º \u0026#39;posts\u0026#39; çš„ç¼“å­˜ revalidateTag(\u0026#39;posts\u0026#39;) return NextResponse.json({ revalidated: true }) } é”™è¯¯å¤„ç†å’ŒåŠ è½½çŠ¶æ€ é”™è¯¯è¾¹ç•Œ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 // app/error.tsx - å…¨å±€é”™è¯¯è¾¹ç•Œ \u0026#39;use client\u0026#39; import { useEffect } from \u0026#39;react\u0026#39; import { useRouter } from \u0026#39;next/navigation\u0026#39; export default function Error({ error, reset, }: { error: Error \u0026amp; { digest?: string } reset: () =\u0026gt; void }) { useEffect(() =\u0026gt; { console.error(error) }, [error]) return ( \u0026lt;div className=\u0026#34;error-container\u0026#34;\u0026gt; \u0026lt;h2\u0026gt;å‡ºé”™äº†ï¼\u0026lt;/h2\u0026gt; \u0026lt;p\u0026gt;å¾ˆæŠ±æ­‰ï¼Œé¡µé¢åŠ è½½æ—¶å‡ºç°é”™è¯¯ã€‚\u0026lt;/p\u0026gt; \u0026lt;button onClick={reset}\u0026gt;é‡è¯•\u0026lt;/button\u0026gt; \u0026lt;/div\u0026gt; ) } // app/blog/error.tsx - ç‰¹å®šè·¯ç”±é”™è¯¯è¾¹ç•Œ export default function BlogError({ error, reset }: { error: Error reset: () =\u0026gt; void }) { return ( \u0026lt;div className=\u0026#34;blog-error\u0026#34;\u0026gt; \u0026lt;h2\u0026gt;åšå®¢åŠ è½½å¤±è´¥\u0026lt;/h2\u0026gt; \u0026lt;p\u0026gt;æ— æ³•åŠ è½½åšå®¢å†…å®¹ã€‚\u0026lt;/p\u0026gt; \u0026lt;button onClick={() =\u0026gt; reset()}\u0026gt;é‡æ–°åŠ è½½\u0026lt;/button\u0026gt; \u0026lt;/div\u0026gt; ) } åŠ è½½UI 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 // app/posts/loading.tsx export default function PostsLoading() { return ( \u0026lt;div className=\u0026#34;loading-container\u0026#34;\u0026gt; \u0026lt;h1\u0026gt;åŠ è½½ä¸­...\u0026lt;/h1\u0026gt; \u0026lt;div className=\u0026#34;skeleton-grid\u0026#34;\u0026gt; {[...Array(6)].map((_, i) =\u0026gt; ( \u0026lt;div key={i} className=\u0026#34;skeleton-card\u0026#34;\u0026gt; \u0026lt;div className=\u0026#34;skeleton-title\u0026#34;\u0026gt;\u0026lt;/div\u0026gt; \u0026lt;div className=\u0026#34;skeleton-excerpt\u0026#34;\u0026gt;\u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; ))} \u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; ) } æ€§èƒ½ä¼˜åŒ– ä»£ç åˆ†å‰² 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 // components/HeavyComponent.tsx import dynamic from \u0026#39;next/dynamic\u0026#39; // åŠ¨æ€å¯¼å…¥é‡å‹ç»„ä»¶ const HeavyChart = dynamic( () =\u0026gt; import(\u0026#39;@/components/Chart\u0026#39;).then(mod =\u0026gt; mod.Chart), { loading: () =\u0026gt; \u0026lt;p\u0026gt;å›¾è¡¨åŠ è½½ä¸­...\u0026lt;/p\u0026gt;, ssr: false // ä»…å®¢æˆ·ç«¯æ¸²æŸ“ } ) // ä½¿ç”¨ç»„ä»¶ export function Dashboard() { return ( \u0026lt;div\u0026gt; \u0026lt;h1\u0026gt;ä»ªè¡¨æ¿\u0026lt;/h1\u0026gt; \u0026lt;HeavyChart data={chartData} /\u0026gt; \u0026lt;/div\u0026gt; ) } å›¾ç‰‡ä¼˜åŒ– 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 // app/page.tsx import Image from \u0026#39;next/image\u0026#39; export default function HomePage() { return ( \u0026lt;div\u0026gt; {/* ä¼˜åŒ–çš„å›¾ç‰‡ */} \u0026lt;Image src=\u0026#34;/hero-image.jpg\u0026#34; alt=\u0026#34;Hero\u0026#34; width={1200} height={600} priority // é«˜ä¼˜å…ˆçº§åŠ è½½ placeholder=\u0026#34;blur\u0026#34; blurDataURL=\u0026#34;data:image/jpeg;base64,...\u0026#34; /\u0026gt; {/* å“åº”å¼å›¾ç‰‡ */} \u0026lt;Image src=\u0026#34;/responsive-image.jpg\u0026#34; alt=\u0026#34;Responsive\u0026#34; fill sizes=\u0026#34;(max-width: 768px) 100vw, 50vw\u0026#34; style={{ objectFit: \u0026#39;cover\u0026#39; }} /\u0026gt; \u0026lt;/div\u0026gt; ) } ä¸­é—´ä»¶ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 // middleware.ts import { NextResponse } from \u0026#39;next/server\u0026#39; import type { NextRequest } from \u0026#39;next/server\u0026#39; export function middleware(request: NextRequest) { // èº«ä»½éªŒè¯æ£€æŸ¥ if (request.nextUrl.pathname.startsWith(\u0026#39;/dashboard\u0026#39;)) { const token = request.cookies.get(\u0026#39;auth-token\u0026#39;) if (!token) { return NextResponse.redirect(new URL(\u0026#39;/login\u0026#39;, request.url)) } } // åœ°ç†ä½ç½®é‡å®šå‘ const country = request.geo?.country if (country === \u0026#39;CN\u0026#39; \u0026amp;\u0026amp; request.nextUrl.pathname === \u0026#39;/\u0026#39;) { return NextResponse.redirect(new URL(\u0026#39;/cn\u0026#39;, request.url)) } // æ·»åŠ è‡ªå®šä¹‰å¤´éƒ¨ const response = NextResponse.next() response.headers.set(\u0026#39;x-custom-header\u0026#39;, \u0026#39;custom-value\u0026#39;) return response } export const config = { matcher: [ \u0026#39;/((?!api|_next/static|_next/image|favicon.ico).*)\u0026#39;, ] } å®æˆ˜æ¡ˆä¾‹ ç”µå•†åº”ç”¨ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 // app/products/[slug]/page.tsx import { notFound } from \u0026#39;next/navigation\u0026#39; import { getProduct, getRelatedProducts } from \u0026#39;@/lib/products\u0026#39; import { ProductDetails } from \u0026#39;@/components/ProductDetails\u0026#39; import { RelatedProducts } from \u0026#39;@/components/RelatedProducts\u0026#39; export async function generateMetadata({ params }: { params: { slug: string } }) { const product = await getProduct(params.slug) if (!product) { return { title: \u0026#39;äº§å“æœªæ‰¾åˆ°\u0026#39; } } return { title: product.name, description: product.description, openGraph: { images: [product.images[0]] } } } export default async function ProductPage({ params }: { params: { slug: string } }) { const product = await getProduct(params.slug) if (!product) { notFound() } const relatedProducts = await getRelatedProducts(product.category, product.id) return ( \u0026lt;div className=\u0026#34;product-page\u0026#34;\u0026gt; \u0026lt;ProductDetails product={product} /\u0026gt; \u0026lt;RelatedProducts products={relatedProducts} /\u0026gt; \u0026lt;/div\u0026gt; ) } // ç”Ÿæˆé™æ€è·¯å¾„ export async function generateStaticParams() { const products = await getProducts() return products.map((product) =\u0026gt; ({ slug: product.slug })) } æœ€ä½³å®è·µ åˆç†ä½¿ç”¨æœåŠ¡å™¨ç»„ä»¶ï¼šä»…åœ¨éœ€è¦æ—¶ä½¿ç”¨å®¢æˆ·ç«¯ç»„ä»¶ ä¼˜åŒ–æ•°æ®è·å–ï¼šä½¿ç”¨ç¼“å­˜å’Œé‡æ–°éªŒè¯ç­–ç•¥ ä»£ç åˆ†å‰²ï¼šåŠ¨æ€å¯¼å…¥å¤§å‹ç»„ä»¶ é”™è¯¯å¤„ç†ï¼šå®ç°å®Œå–„çš„é”™è¯¯è¾¹ç•Œ æ€§èƒ½ç›‘æ§ï¼šä½¿ç”¨Next.js Analytics æ€»ç»“ Next.js 15 App Routeræä¾›äº†ï¼š\næœåŠ¡å™¨ç»„ä»¶ï¼šæ›´å¥½çš„æ€§èƒ½å’ŒSEO çµæ´»çš„è·¯ç”±ï¼šæ”¯æŒåŠ¨æ€å’ŒåµŒå¥—è·¯ç”± å¼ºå¤§çš„ç¼“å­˜ï¼šæ™ºèƒ½çš„æ•°æ®ç¼“å­˜ç­–ç•¥ TypeScriptæ”¯æŒï¼šå®Œå–„çš„ç±»å‹å®‰å…¨ æ€§èƒ½ä¼˜åŒ–ï¼šè‡ªåŠ¨ä»£ç åˆ†å‰²å’Œä¼˜åŒ– è¿™äº›ç‰¹æ€§ä½¿Next.js 15æˆä¸ºæ„å»ºç°ä»£å…¨æ ˆåº”ç”¨çš„ç†æƒ³é€‰æ‹©ã€‚\nç›¸å…³èµ„æº Next.js 15å®˜æ–¹æ–‡æ¡£ App Routeræ–‡æ¡£ React Server Components ","permalink":"/blog/articles/nextjs-15-app-router-guide/","summary":"æŒæ¡Next.js 15 App Routerçš„æ ¸å¿ƒæ¦‚å¿µï¼Œæ„å»ºé«˜æ€§èƒ½çš„å…¨æ ˆåº”ç”¨ã€‚","title":"Next.js 15 App Routerå®Œå…¨æŒ‡å—"},{"content":"Kubernetes 1.30æ–°ç‰¹æ€§å…¨é¢è§£æ Kubernetes 1.30ç‰ˆæœ¬å¸¦æ¥äº†è®¸å¤šä»¤äººå…´å¥‹çš„æ–°ç‰¹æ€§å’Œæ”¹è¿›ï¼Œè¿›ä¸€æ­¥å¢å¼ºäº†é›†ç¾¤çš„å¯æ‰©å±•æ€§ã€ç¨³å®šæ€§å’Œæ˜“ç”¨æ€§ã€‚æœ¬æ–‡å°†æ·±å…¥æ¢è®¨è¿™äº›æ–°ç‰¹æ€§åŠå…¶åœ¨å®é™…åœºæ™¯ä¸­çš„åº”ç”¨ã€‚\næ ¸å¿ƒæ–°ç‰¹æ€§ 1. åŠ¨æ€èµ„æºåˆ†é…ï¼ˆDynamic Resource Allocationï¼‰ Kubernetes 1.30å¼•å…¥äº†åŠ¨æ€èµ„æºåˆ†é…æ¡†æ¶ï¼Œå…è®¸æ›´çµæ´»çš„ç¡¬ä»¶èµ„æºç®¡ç†ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 apiVersion: v1 kind: ResourceClaim metadata: name: gpu-claim spec: resourceClassName: nvidia-gpu allocationMode: Immediate status: allocation: resourceHandle: driverName: nvidia.com data: \u0026#34;{\\\u0026#34;gpu-id\\\u0026#34;:\\\u0026#34;gpu-01\\\u0026#34;,\\\u0026#34;memory\\\u0026#34;:\\\u0026#34;16GB\\\u0026#34;}\u0026#34; 2. èŠ‚ç‚¹å‹åŠ›æ„ŸçŸ¥è°ƒåº¦ï¼ˆNode Pressure-aware Schedulingï¼‰ æ–°çš„è°ƒåº¦å™¨ç‰¹æ€§å¯ä»¥æ„ŸçŸ¥èŠ‚ç‚¹çš„å‹åŠ›çŠ¶å†µï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 apiVersion: v1 kind: Pod metadata: name: pressure-aware-pod spec: schedulerName: default-scheduler containers: - name: app image: nginx resources: requests: cpu: \u0026#34;500m\u0026#34; memory: \u0026#34;512Mi\u0026#34; nodeSelector: kubernetes.io/pressure: \u0026#34;low\u0026#34; 3. åŸç”ŸSidecarå®¹å™¨æ”¯æŒ Sidecarå®¹å™¨æ­£å¼è¿›å…¥GAé˜¶æ®µï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 apiVersion: v1 kind: Pod metadata: name: webapp-with-sidecar spec: containers: - name: webapp image: nginx:1.21 - name: log-collector image: fluent/fluent-bit:latest restartPolicy: Always sidecar: true ç½‘ç»œå’Œå®‰å…¨å¢å¼º 1. æœåŠ¡ç½‘æ ¼é›†æˆæ”¹è¿› 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 apiVersion: networking.k8s.io/v1 kind: Ingress metadata: name: app-ingress annotations: kubernetes.io/ingress.class: \u0026#34;istio\u0026#34; istio.io/rewrite-target: \u0026#34;/\u0026#34; spec: rules: - host: example.com http: paths: - path: /api pathType: Prefix backend: service: name: api-service port: number: 80 2. Podå®‰å…¨ç­–ç•¥ï¼ˆPod Security Standardsï¼‰å¢å¼º 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 apiVersion: policy/v1beta1 kind: PodSecurityPolicy metadata: name: restricted spec: privileged: false allowPrivilegeEscalation: false requiredDropCapabilities: - ALL volumes: - \u0026#39;configMap\u0026#39; - \u0026#39;emptyDir\u0026#39; - \u0026#39;projected\u0026#39; - \u0026#39;secret\u0026#39; - \u0026#39;downwardAPI\u0026#39; - \u0026#39;persistentVolumeClaim\u0026#39; runAsUser: rule: \u0026#39;MustRunAsNonRoot\u0026#39; seLinux: rule: \u0026#39;RunAsAny\u0026#39; fsGroup: rule: \u0026#39;RunAsAny\u0026#39; å­˜å‚¨æ”¹è¿› 1. CSIå¿«ç…§åŠŸèƒ½å¢å¼º 1 2 3 4 5 6 7 8 apiVersion: snapshot.storage.k8s.io/v1 kind: VolumeSnapshot metadata: name: pvc-snapshot spec: volumeSnapshotClassName: csi-hostpath-snapclass source: persistentVolumeClaimName: data-pvc 2. å·æ‰©å±•æ”¯æŒ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 apiVersion: v1 kind: PersistentVolumeClaim metadata: name: expandable-pvc annotations: volume.beta.kubernetes.io/storage-class: \u0026#34;standard\u0026#34; spec: accessModes: - ReadWriteOnce storageClassName: standard resources: requests: storage: 10Gi allowVolumeExpansion: true ç›‘æ§å’Œå¯è§‚æµ‹æ€§ 1. Prometheusé›†æˆä¼˜åŒ– 1 2 3 4 5 6 7 8 9 10 11 12 13 14 apiVersion: v1 kind: ServiceMonitor metadata: name: app-monitor labels: release: prometheus spec: selector: matchLabels: app: myapp endpoints: - port: metrics interval: 30s path: /metrics 2. åˆ†å¸ƒå¼è¿½è¸ªæ”¯æŒ 1 2 3 4 5 6 7 8 9 10 11 12 apiVersion: v1 kind: ConfigMap metadata: name: tracing-config data: config.yaml: | sampler: type: probabilistic param: 0.1 service_name: \u0026#34;kubernetes-app\u0026#34; jaeger: endpoint: \u0026#34;jaeger-collector:14250\u0026#34; æ€§èƒ½ä¼˜åŒ– 1. APIæœåŠ¡å™¨æ€§èƒ½æå‡ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 # kube-apiserver é…ç½®ä¼˜åŒ– apiVersion: v1 kind: ConfigMap metadata: name: apiserver-config data: config.yaml: | audit-log-maxage: \u0026#34;7\u0026#34; audit-log-maxbackup: \u0026#34;10\u0026#34; audit-log-maxsize: \u0026#34;100\u0026#34; event-ttl: \u0026#34;24h\u0026#34; enable-admission-plugins: - NamespaceLifecycle - LimitRanger - ServiceAccount - DefaultStorageClass - DefaultTolerationSeconds - NodeRestriction 2. è°ƒåº¦å™¨æ€§èƒ½è°ƒä¼˜ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 apiVersion: kubescheduler.config.k8s.io/v1beta3 kind: KubeSchedulerConfiguration clientConnection: kubeconfig: /etc/kubernetes/scheduler.conf profiles: - schedulerName: default-scheduler plugins: score: enabled: - name: NodeResourcesFit - name: NodeResourcesBalancedAllocation disabled: - name: ImageLocality pluginConfig: - name: NodeResourcesFit args: scoringStrategy: type: MostAllocated resources: - name: cpu weight: 1 - name: memory weight: 1 å®é™…åº”ç”¨æ¡ˆä¾‹ 1. å¤§è§„æ¨¡é›†ç¾¤éƒ¨ç½² 1 2 3 4 5 6 7 8 9 10 11 12 13 # é›†ç¾¤è‡ªåŠ¨æ‰©ç¼©å®¹é…ç½® apiVersion: autoscaling/v1 kind: HorizontalPodAutoscaler metadata: name: app-hpa spec: scaleTargetRef: apiVersion: apps/v1 kind: Deployment name: webapp minReplicas: 2 maxReplicas: 10 targetCPUUtilizationPercentage: 70 2. å¤šç§Ÿæˆ·ç®¡ç† 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 # å‘½åç©ºé—´é…é¢ apiVersion: v1 kind: ResourceQuota metadata: name: compute-quota namespace: dev-team spec: hard: requests.cpu: \u0026#34;10\u0026#34; requests.memory: 20Gi limits.cpu: \u0026#34;20\u0026#34; limits.memory: 40Gi persistentvolumeclaims: \u0026#34;5\u0026#34; pods: \u0026#34;10\u0026#34; services: \u0026#34;5\u0026#34; å‡çº§æŒ‡å— 1. å‡çº§å‰å‡†å¤‡ 1 2 3 4 5 6 7 8 9 # å¤‡ä»½ETCD ETCDCTL_API=3 etcdctl snapshot save snapshot.db \\ --endpoints=https://127.0.0.1:2379 \\ --cacert=/etc/kubernetes/pki/etcd/ca.crt \\ --cert=/etc/kubernetes/pki/etcd/server.crt \\ --key=/etc/kubernetes/pki/etcd/server.key # æ£€æŸ¥å½“å‰ç‰ˆæœ¬ kubectl version 2. å‡çº§æ­¥éª¤ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 # 1. å‡çº§ä¸»èŠ‚ç‚¹ kubeadm upgrade plan kubeadm upgrade apply v1.30.0 # 2. å‡çº§kubelet apt-mark unhold kubelet kubeadm kubectl apt-get update \u0026amp;\u0026amp; apt-get install -y kubelet=1.30.0-00 kubeadm=1.30.0-00 kubectl=1.30.0-00 apt-mark hold kubelet kubeadm kubectl # 3. é‡å¯kubelet systemctl daemon-reload systemctl restart kubelet # 4. å‡çº§å·¥ä½œèŠ‚ç‚¹ kubeadm upgrade node æœ€ä½³å®è·µ 1. èµ„æºç®¡ç† 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 # èµ„æºé™åˆ¶å’Œè¯·æ±‚ apiVersion: v1 kind: Pod metadata: name: resource-managed-pod spec: containers: - name: app image: nginx resources: requests: cpu: \u0026#34;100m\u0026#34; memory: \u0026#34;128Mi\u0026#34; limits: cpu: \u0026#34;500m\u0026#34; memory: \u0026#34;512Mi\u0026#34; readinessProbe: httpGet: path: /health port: 80 initialDelaySeconds: 5 periodSeconds: 10 2. å®‰å…¨é…ç½® 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 # Podå®‰å…¨ä¸Šä¸‹æ–‡ apiVersion: v1 kind: Pod metadata: name: secure-pod spec: securityContext: runAsNonRoot: true runAsUser: 1000 fsGroup: 2000 containers: - name: app image: nginx securityContext: allowPrivilegeEscalation: false readOnlyRootFilesystem: true capabilities: drop: - ALL æ•…éšœæ’æŸ¥ 1. å¸¸è§é—®é¢˜è¯Šæ–­ 1 2 3 4 5 6 7 8 9 10 11 12 # æ£€æŸ¥èŠ‚ç‚¹çŠ¶æ€ kubectl get nodes -o wide # æŸ¥çœ‹Podäº‹ä»¶ kubectl describe pod \u0026lt;pod-name\u0026gt; # æ£€æŸ¥èµ„æºä½¿ç”¨ kubectl top nodes kubectl top pods # æŸ¥çœ‹é›†ç¾¤äº‹ä»¶ kubectl get events --sort-by=.metadata.creationTimestamp 2. æ€§èƒ½åˆ†æ 1 2 3 4 5 # ä½¿ç”¨metrics-server kubectl apply -f https://github.com/kubernetes-sigs/metrics-server/releases/latest/download/components.yaml # é›†ç¾¤æ€§èƒ½æµ‹è¯• kubectl apply -f https://raw.githubusercontent.com/kubernetes/perf-tests/master/clusterloader2/testing/load/config.yaml æœªæ¥å±•æœ› Kubernetes 1.30ä¸ºæœªæ¥çš„å‘å±•å¥ å®šäº†åŸºç¡€ï¼š\nè¾¹ç¼˜è®¡ç®—æ”¯æŒï¼šæ›´å¥½çš„è¾¹ç¼˜è®¾å¤‡ç®¡ç† AI/MLå·¥ä½œè´Ÿè½½ï¼šä¸“é—¨çš„è°ƒåº¦å’Œèµ„æºç®¡ç† å¤šäº‘æ”¯æŒï¼šç»Ÿä¸€çš„å¤šäº‘èµ„æºç®¡ç† å®‰å…¨æ€§å¢å¼ºï¼šé›¶ä¿¡ä»»æ¶æ„é›†æˆ æ€»ç»“ Kubernetes 1.30ç‰ˆæœ¬å¸¦æ¥äº†æ˜¾è‘—çš„æ”¹è¿›ï¼š\nåŠ¨æ€èµ„æºåˆ†é…ï¼šæ›´çµæ´»çš„ç¡¬ä»¶èµ„æºåˆ©ç”¨ Sidecarå®¹å™¨ï¼šæ­£å¼æ”¯æŒç®€åŒ–éƒ¨ç½² æ€§èƒ½æå‡ï¼šAPIæœåŠ¡å™¨å’Œè°ƒåº¦å™¨ä¼˜åŒ– å®‰å…¨å¢å¼ºï¼šæ›´å®Œå–„çš„Podå®‰å…¨ç­–ç•¥ å¯è§‚æµ‹æ€§ï¼šæ›´å¥½çš„ç›‘æ§å’Œè¿½è¸ªæ”¯æŒ è¿™äº›ç‰¹æ€§ä½¿Kubernetesæˆä¸ºæ›´å¼ºå¤§ã€æ›´çµæ´»çš„å®¹å™¨ç¼–æ’å¹³å°ã€‚\nç›¸å…³èµ„æº Kubernetes 1.30å®˜æ–¹å‘å¸ƒè¯´æ˜ Kuberneteså®˜æ–¹æ–‡æ¡£ CNCFæœ€ä½³å®è·µ ","permalink":"/blog/articles/kubernetes-1-30-new-features/","summary":"å…¨é¢äº†è§£Kubernetes 1.30çš„åˆ›æ–°åŠŸèƒ½ï¼Œæå‡é›†ç¾¤ç®¡ç†æ•ˆç‡ã€‚","title":"Kubernetes 1.30æ–°ç‰¹æ€§å…¨é¢è§£æ"},{"content":"Rustå¼‚æ­¥ç¼–ç¨‹å®Œå…¨æŒ‡å— Rustçš„å¼‚æ­¥ç¼–ç¨‹æ¨¡å‹ä»¥å…¶é›¶æˆæœ¬æŠ½è±¡å’Œå†…å­˜å®‰å…¨ç‰¹æ€§ï¼Œä¸ºæ„å»ºé«˜æ€§èƒ½å¹¶å‘åº”ç”¨æä¾›äº†å¼ºå¤§æ”¯æŒã€‚æœ¬æ–‡å°†æ·±å…¥æ¢è®¨Rustå¼‚æ­¥ç¼–ç¨‹çš„æ ¸å¿ƒæ¦‚å¿µå’Œå®è·µæŠ€å·§ã€‚\nå¼‚æ­¥ç¼–ç¨‹åŸºç¡€ ä»€ä¹ˆæ˜¯å¼‚æ­¥ç¼–ç¨‹ï¼Ÿ å¼‚æ­¥ç¼–ç¨‹æ˜¯ä¸€ç§éé˜»å¡çš„ç¼–ç¨‹æ¨¡å¼ï¼Œå…è®¸ç¨‹åºåœ¨ç­‰å¾…I/Oæ“ä½œå®Œæˆæ—¶æ‰§è¡Œå…¶ä»–ä»»åŠ¡ï¼š\n1 2 3 4 5 6 7 8 9 // åŒæ­¥ä»£ç  fn read_file_sync() -\u0026gt; String { std::fs::read_to_string(\u0026#34;file.txt\u0026#34;).unwrap() } // å¼‚æ­¥ä»£ç  async fn read_file_async() -\u0026gt; String { tokio::fs::read_to_string(\u0026#34;file.txt\u0026#34;).await.unwrap() } Future traitè§£æ Futureæ˜¯Rustå¼‚æ­¥ç¼–ç¨‹çš„æ ¸å¿ƒï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 use std::future::Future; // è‡ªå®šä¹‰Futureå®ç° struct DelayedValue { value: i32, delay: std::time::Duration, } impl Future for DelayedValue { type Output = i32; fn poll( self: std::pin::Pin\u0026lt;\u0026amp;mut Self\u0026gt;, _cx: \u0026amp;mut std::task::Context\u0026lt;\u0026#39;_\u0026gt; ) -\u0026gt; std::task::Poll\u0026lt;Self::Output\u0026gt; { // å®é™…å®ç°éœ€è¦ä½¿ç”¨å®šæ—¶å™¨ std::task::Poll::Ready(self.value) } } async/awaitè¯­æ³• åŸºæœ¬ç”¨æ³• 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 use tokio::time::{sleep, Duration}; async fn fetch_data(url: \u0026amp;str) -\u0026gt; Result\u0026lt;String, reqwest::Error\u0026gt; { let response = reqwest::get(url).await?; let text = response.text().await?; Ok(text) } async fn process_data() { // å¹¶å‘æ‰§è¡Œå¤šä¸ªå¼‚æ­¥æ“ä½œ let (data1, data2) = tokio::join!( fetch_data(\u0026#34;https://api.example.com/data1\u0026#34;), fetch_data(\u0026#34;https://api.example.com/data2\u0026#34;) ); println!(\u0026#34;è·å–çš„æ•°æ®: {:?}\u0026#34;, (data1, data2)); } é”™è¯¯å¤„ç† 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 async fn handle_errors() -\u0026gt; Result\u0026lt;(), Box\u0026lt;dyn std::error::Error\u0026gt;\u0026gt; { match fetch_data(\u0026#34;https://api.example.com\u0026#34;).await { Ok(data) =\u0026gt; println!(\u0026#34;æˆåŠŸ: {}\u0026#34;, data), Err(e) =\u0026gt; eprintln!(\u0026#34;é”™è¯¯: {}\u0026#34;, e), } Ok(()) } // ä½¿ç”¨ ? æ“ä½œç¬¦ async fn chain_operations() -\u0026gt; Result\u0026lt;(), Box\u0026lt;dyn std::error::Error\u0026gt;\u0026gt; { let data = fetch_data(\u0026#34;https://api.example.com\u0026#34;).await?; let processed = process_json(\u0026amp;data).await?; save_to_database(\u0026amp;processed).await?; Ok(()) } å¼‚æ­¥è¿è¡Œæ—¶ Tokioè¿è¡Œæ—¶ 1 2 [dependencies] tokio = { version = \u0026#34;1.0\u0026#34;, features = [\u0026#34;full\u0026#34;] } 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 use tokio; #[tokio::main] async fn main() { println!(\u0026#34;Hello from async main!\u0026#34;); // åˆ›å»ºå¹¶å‘ä»»åŠ¡ let task1 = tokio::spawn(async { sleep(Duration::from_secs(1)).await; \u0026#34;ä»»åŠ¡1å®Œæˆ\u0026#34; }); let task2 = tokio::spawn(async { sleep(Duration::from_secs(2)).await; \u0026#34;ä»»åŠ¡2å®Œæˆ\u0026#34; }); // ç­‰å¾…ä»»åŠ¡å®Œæˆ let (result1, result2) = tokio::join!(task1, task2); println!(\u0026#34;{:?}\u0026#34;, (result1.unwrap(), result2.unwrap())); } async-stdè¿è¡Œæ—¶ 1 2 [dependencies] async-std = { version = \u0026#34;1.0\u0026#34;, features = [\u0026#34;attributes\u0026#34;] } 1 2 3 4 5 6 7 8 9 10 11 use async_std::task; use async_std::prelude::*; #[async_std::main] async fn main() { // ä½¿ç”¨async-stdçš„æµ let mut stream = async_std::fs::File::open(\u0026#34;file.txt\u0026#34;).await?; let mut contents = String::new(); stream.read_to_string(\u0026amp;mut contents).await?; println!(\u0026#34;{}\u0026#34;, contents); } é«˜çº§å¼‚æ­¥æ¨¡å¼ å¼‚æ­¥è¿­ä»£å™¨ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 use futures::stream::{self, StreamExt}; async fn process_stream() { let mut stream = stream::iter(vec![1, 2, 3, 4, 5]); while let Some(value) = stream.next().await { println!(\u0026#34;å¤„ç†å€¼: {}\u0026#34;, value); } } // è‡ªå®šä¹‰å¼‚æ­¥æµ use futures::stream::{Stream, StreamExt}; struct Counter { current: usize, max: usize, } impl Stream for Counter { type Item = usize; fn poll_next( mut self: std::pin::Pin\u0026lt;\u0026amp;mut Self\u0026gt;, _cx: \u0026amp;mut std::task::Context\u0026lt;\u0026#39;_\u0026gt; ) -\u0026gt; std::task::Poll\u0026lt;Option\u0026lt;Self::Item\u0026gt;\u0026gt; { if self.current \u0026lt; self.max { let val = self.current; self.current += 1; std::task::Poll::Ready(Some(val)) } else { std::task::Poll::Ready(None) } } } å¼‚æ­¥Trait 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 use async_trait::async_trait; #[async_trait] trait Database { async fn get(\u0026amp;self, key: \u0026amp;str) -\u0026gt; Result\u0026lt;Option\u0026lt;String\u0026gt;, Error\u0026gt;; async fn set(\u0026amp;self, key: \u0026amp;str, value: \u0026amp;str) -\u0026gt; Result\u0026lt;(), Error\u0026gt;; } struct MyDatabase { // æ•°æ®åº“è¿æ¥ } #[async_trait] impl Database for MyDatabase { async fn get(\u0026amp;self, key: \u0026amp;str) -\u0026gt; Result\u0026lt;Option\u0026lt;String\u0026gt;, Error\u0026gt; { // å®ç°è·å–é€»è¾‘ Ok(None) } async fn set(\u0026amp;self, key: \u0026amp;str, value: \u0026amp;str) -\u0026gt; Result\u0026lt;(), Error\u0026gt; { // å®ç°è®¾ç½®é€»è¾‘ Ok(()) } } æ€§èƒ½ä¼˜åŒ–æŠ€å·§ 1. ä½¿ç”¨åˆç†çš„æ•°æ®ç»“æ„ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 // ä½¿ç”¨ Arc\u0026lt;String\u0026gt; è€Œä¸æ˜¯ String use std::sync::Arc; async fn process_shared_data() { let data = Arc::new(\u0026#34;å…±äº«æ•°æ®\u0026#34;.to_string()); let mut handles = vec![]; for i in 0..5 { let data_clone = Arc::clone(\u0026amp;data); let handle = tokio::spawn(async move { println!(\u0026#34;ä»»åŠ¡ {} å¤„ç†: {}\u0026#34;, i, data_clone); }); handles.push(handle); } for handle in handles { handle.await.unwrap(); } } 2. æ‰¹é‡å¤„ç† 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 use futures::stream::{self, StreamExt}; async fn batch_process(items: Vec\u0026lt;i32\u0026gt;) -\u0026gt; Vec\u0026lt;i32\u0026gt; { items .stream() .chunks(10) // æ¯æ‰¹å¤„ç†10ä¸ª .map(|batch| async move { batch.into_iter().map(|x| x * 2).collect::\u0026lt;Vec\u0026lt;_\u0026gt;\u0026gt;() }) .buffer_unordered(5) // å¹¶å‘5ä¸ªæ‰¹æ¬¡ .collect::\u0026lt;Vec\u0026lt;_\u0026gt;\u0026gt;() .await .into_iter() .flatten() .collect() } 3. è¿æ¥æ±  1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 use sqlx::{Pool, Postgres, postgres::PgPoolOptions}; async fn create_db_pool() -\u0026gt; Result\u0026lt;Pool\u0026lt;Postgres\u0026gt;, sqlx::Error\u0026gt; { PgPoolOptions::new() .max_connections(20) .min_connections(5) .connect(\u0026#34;postgresql://user:password@localhost/db\u0026#34;) .await } // ä½¿ç”¨è¿æ¥æ±  async fn execute_query(pool: \u0026amp;Pool\u0026lt;Postgres\u0026gt;) -\u0026gt; Result\u0026lt;(), sqlx::Error\u0026gt; { let mut conn = pool.acquire().await?; sqlx::query(\u0026#34;SELECT * FROM users\u0026#34;) .fetch_all(\u0026amp;mut conn) .await?; Ok(()) } å®æˆ˜æ¡ˆä¾‹ æ„å»ºå¼‚æ­¥WebæœåŠ¡å™¨ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 use warp::{Filter, Reply}; #[tokio::main] async fn main() { // å®šä¹‰è·¯ç”± let hello = warp::path(\u0026#34;hello\u0026#34;) .and(warp::path::param::\u0026lt;String\u0026gt;()) .and(warp::get()) .map(|name| format!(\u0026#34;Hello, {}!\u0026#34;, name)); let api = warp::path(\u0026#34;api\u0026#34;) .and(warp::path(\u0026#34;data\u0026#34;)) .and(warp::get()) .and_then(get_data); let routes = hello.or(api); println!(\u0026#34;æœåŠ¡å™¨å¯åŠ¨åœ¨ http://localhost:3030\u0026#34;); warp::serve(routes) .run(([127, 0, 0, 1], 3030)) .await; } async fn get_data() -\u0026gt; Result\u0026lt;impl Reply, warp::Rejection\u0026gt; { let data = fetch_from_database().await; Ok(warp::reply::json(\u0026amp;data)) } async fn fetch_from_database() -\u0026gt; serde_json::Value { // æ¨¡æ‹Ÿæ•°æ®åº“æŸ¥è¯¢ serde_json::json!({ \u0026#34;message\u0026#34;: \u0026#34;ä»æ•°æ®åº“è·å–çš„æ•°æ®\u0026#34;, \u0026#34;timestamp\u0026#34;: chrono::Utc::now() }) } å¼‚æ­¥æ–‡ä»¶å¤„ç† 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 use tokio::fs; use tokio::io::AsyncReadExt; async fn process_files() -\u0026gt; Result\u0026lt;(), Box\u0026lt;dyn std::error::Error\u0026gt;\u0026gt; { let mut entries = fs::read_dir(\u0026#34;./files\u0026#34;).await?; let mut tasks = vec![]; while let Some(entry) = entries.next_entry().await? { let path = entry.path(); if path.extension().and_then(|s| s.to_str()) == Some(\u0026#34;txt\u0026#34;) { let task = tokio::spawn(async move { process_file(\u0026amp;path).await }); tasks.push(task); } } for task in tasks { task.await??; } Ok(()) } async fn process_file(path: \u0026amp;std::path::Path) -\u0026gt; Result\u0026lt;(), Box\u0026lt;dyn std::error::Error\u0026gt;\u0026gt; { let mut file = fs::File::open(path).await?; let mut contents = Vec::new(); file.read_to_end(\u0026amp;mut contents).await?; // å¤„ç†æ–‡ä»¶å†…å®¹ let processed = process_content(\u0026amp;contents); // å†™å…¥æ–°æ–‡ä»¶ let new_path = path.with_extension(\u0026#34;processed\u0026#34;); fs::write(new_path, processed).await?; Ok(()) } è°ƒè¯•å’Œæµ‹è¯• å¼‚æ­¥å‡½æ•°æµ‹è¯• 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 #[cfg(test)] mod tests { use super::*; use tokio_test; #[tokio::test] async fn test_async_function() { let result = fetch_data(\u0026#34;https://httpbin.org/json\u0026#34;).await; assert!(result.is_ok()); } #[tokio::test] async fn test_concurrent_operations() { let start = std::time::Instant::now(); let _ = tokio::join!( fetch_data(\u0026#34;https://httpbin.org/delay/1\u0026#34;), fetch_data(\u0026#34;https://httpbin.org/delay/1\u0026#34;) ); let duration = start.elapsed(); assert!(duration \u0026lt; std::time::Duration::from_secs(2)); } } æœ€ä½³å®è·µæ€»ç»“ åˆç†ä½¿ç”¨å¹¶å‘ï¼šé¿å…è¿‡åº¦å¹¶å‘å¯¼è‡´èµ„æºç«äº‰ é”™è¯¯å¤„ç†ï¼šä½¿ç”¨Resultè¿›è¡Œä¼˜é›…çš„é”™è¯¯å¤„ç† èµ„æºç®¡ç†ï¼šä½¿ç”¨Arcå…±äº«æ•°æ®ï¼Œæ³¨æ„ç”Ÿå‘½å‘¨æœŸ æ€§èƒ½ç›‘æ§ï¼šä½¿ç”¨tokio-consoleç­‰å·¥å…·ç›‘æ§æ€§èƒ½ ä»£ç ç»„ç»‡ï¼šåˆç†ç»„ç»‡å¼‚æ­¥ä»£ç ï¼Œä¿æŒå¯è¯»æ€§ ç›¸å…³èµ„æº Tokioå®˜æ–¹æ–‡æ¡£ Rustå¼‚æ­¥ç¼–ç¨‹ä¹¦ Futuresåº“æ–‡æ¡£ ","permalink":"/blog/articles/rust-async-programming-guide/","summary":"æŒæ¡Rustå¼‚æ­¥ç¼–ç¨‹çš„å…³é”®æŠ€æœ¯ï¼Œæ„å»ºé«˜æ€§èƒ½å¹¶å‘åº”ç”¨ã€‚","title":"Rustå¼‚æ­¥ç¼–ç¨‹å®Œå…¨æŒ‡å—"},{"content":"Vue 3.5 Composition APIæ·±åº¦è§£æ Vue 3.5 çš„å‘å¸ƒä¸ºå‰ç«¯å¼€å‘å¸¦æ¥äº†è¯¸å¤šæ¿€åŠ¨äººå¿ƒçš„æ”¹è¿›ï¼Œç‰¹åˆ«æ˜¯åœ¨ Composition API æ–¹é¢çš„ä¼˜åŒ–è®©å¼€å‘è€…ä½“éªŒå¾—åˆ°äº†æ˜¾è‘—æå‡ã€‚æœ¬æ–‡å°†æ·±å…¥æ¢è®¨è¿™äº›æ–°ç‰¹æ€§åŠå…¶åœ¨å®é™…é¡¹ç›®ä¸­çš„åº”ç”¨ã€‚\nå“åº”å¼ç³»ç»Ÿçš„é‡å¤§æ”¹è¿› Vue 3.5 åœ¨å“åº”å¼ç³»ç»Ÿå±‚é¢å®ç°äº†å¤šé¡¹ä¼˜åŒ–ï¼Œä¸»è¦åŒ…æ‹¬ï¼š\n1. æ›´ç²¾ç¡®çš„ä¾èµ–è¿½è¸ª æ–°çš„å“åº”å¼ç³»ç»Ÿé‡‡ç”¨äº†æ›´ç»†ç²’åº¦çš„ä¾èµ–è¿½è¸ªæœºåˆ¶ï¼Œèƒ½å¤Ÿï¼š\nå‡å°‘ä¸å¿…è¦çš„é‡æ–°æ¸²æŸ“ æå‡å¤§å‹åº”ç”¨çš„æ€§èƒ½è¡¨ç° ä¼˜åŒ–å†…å­˜ä½¿ç”¨æ•ˆç‡ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 // Vue 3.5 ä¸­æ›´é«˜æ•ˆçš„å“åº”å¼å†™æ³• import { reactive, computed, watchEffect } from \u0026#39;vue\u0026#39; const state = reactive({ userData: null, loading: false }) // è‡ªåŠ¨è¿½è¸ªä¾èµ–ï¼Œæ€§èƒ½æ›´ä¼˜ watchEffect(() =\u0026gt; { if (state.userData) { console.log(\u0026#39;ç”¨æˆ·æ•°æ®å·²æ›´æ–°:\u0026#39;, state.userData.name) } }) 2. ref() å’Œ reactive() çš„æ€§èƒ½ä¼˜åŒ– ref() çš„åˆ›å»ºé€Ÿåº¦æå‡äº†çº¦ 30% reactive() åœ¨æ·±åº¦åµŒå¥—å¯¹è±¡ä¸Šçš„è¡¨ç°æ›´åŠ å‡ºè‰² å‡å°‘äº†å†…å­˜å ç”¨ æ–°å¢çš„å®ç”¨ Composables Vue 3.5 å¼•å…¥äº†å¤šä¸ªå®ç”¨çš„ç»„åˆå¼å‡½æ•°ï¼š\nuseTemplateRef() ç®€åŒ–æ¨¡æ¿å¼•ç”¨çš„è·å–ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 \u0026lt;template\u0026gt; \u0026lt;div ref=\u0026#34;containerRef\u0026#34;\u0026gt;å†…å®¹åŒºåŸŸ\u0026lt;/div\u0026gt; \u0026lt;/template\u0026gt; \u0026lt;script setup\u0026gt; import { useTemplateRef } from \u0026#39;vue\u0026#39; // æ›´ç®€æ´çš„ ref è·å–æ–¹å¼ const containerRef = useTemplateRef(\u0026#39;container\u0026#39;) // ç›´æ¥å¯ç”¨ï¼Œæ— éœ€ç­‰å¾… mounted onMounted(() =\u0026gt; { console.log(containerRef.value) // è‡ªåŠ¨æ¨æ–­ç±»å‹ }) \u0026lt;/script\u0026gt; useId() ç”Ÿæˆå”¯ä¸€ IDï¼Œè§£å†³æœåŠ¡ç«¯æ¸²æŸ“çš„ ID ä¸€è‡´æ€§é—®é¢˜ï¼š\n1 2 3 import { useId } from \u0026#39;vue\u0026#39; const uniqueId = useId() // ç”Ÿæˆå”¯ä¸€çš„ã€ç¨³å®šçš„ ID æ€§èƒ½æå‡çš„æœ€ä½³å®è·µ 1. åˆç†ä½¿ç”¨ shallowRef å’Œ shallowReactive å¯¹äºå¤§å‹æ•°æ®ç»“æ„ï¼Œä½¿ç”¨æµ…å±‚å“åº”å¼ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 import { shallowRef, triggerRef } from \u0026#39;vue\u0026#39; // å¤§å‹æ•°æ®ä½¿ç”¨ shallowRef const largeData = shallowRef({ // åŒ…å«å¤§é‡å±æ€§çš„å¯¹è±¡ }) // æ‰‹åŠ¨è§¦å‘æ›´æ–° function updateLargeData() { largeData.value = newData triggerRef(largeData) } 2. ä¼˜åŒ– computed è®¡ç®—å±æ€§ 1 2 3 4 5 // ä½¿ç”¨ lazy computed å»¶è¿Ÿè®¡ç®— const expensiveComputed = computed(() =\u0026gt; { // è€—æ—¶è®¡ç®—é€»è¾‘ return heavyCalculation() }) å¼€å‘ä½“éªŒæ”¹è¿› 1. æ›´å¥½çš„ TypeScript æ”¯æŒ Vue 3.5 æä¾›äº†æ›´å®Œå–„çš„ TypeScript ç±»å‹æ¨å¯¼ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 // æ›´å‡†ç¡®çš„ç±»å‹æ¨å¯¼ import { ref } from \u0026#39;vue\u0026#39; const count = ref(0) // è‡ªåŠ¨æ¨å¯¼ä¸º Ref\u0026lt;number\u0026gt; const user = ref\u0026lt;User | null\u0026gt;(null) // æ˜ç¡®æŒ‡å®šç±»å‹ // ç»„ä»¶ props ç±»å‹æ›´å®‰å…¨ interface Props { title: string count?: number } const props = defineProps\u0026lt;Props\u0026gt;() 2. è°ƒè¯•å·¥å…·å¢å¼º Vue DevTools æ”¯æŒæ›´è¯¦ç»†çš„æ€§èƒ½åˆ†æ ç»„ä»¶æ¸²æŸ“æ—¶é—´è¿½è¸ª å†…å­˜ä½¿ç”¨æƒ…å†µç›‘æ§ å®é™…é¡¹ç›®åº”ç”¨æ¡ˆä¾‹ æ¡ˆä¾‹ 1ï¼šå¤§å‹åˆ—è¡¨ä¼˜åŒ– 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 \u0026lt;template\u0026gt; \u0026lt;VirtualList :items=\u0026#34;items\u0026#34; :itemHeight=\u0026#34;50\u0026#34;\u0026gt; \u0026lt;template #default=\u0026#34;{ item, index }\u0026#34;\u0026gt; \u0026lt;ListItem :data=\u0026#34;item\u0026#34; :key=\u0026#34;item.id\u0026#34; /\u0026gt; \u0026lt;/template\u0026gt; \u0026lt;/VirtualList\u0026gt; \u0026lt;/template\u0026gt; \u0026lt;script setup\u0026gt; import { computed, shallowRef } from \u0026#39;vue\u0026#39; // ä½¿ç”¨ shallowRef ä¼˜åŒ–å¤§æ•°æ®åˆ—è¡¨ const items = shallowRef([]) // åˆ†æ‰¹åŠ è½½æ•°æ® const visibleItems = computed(() =\u0026gt; { return items.value.slice(startIndex, endIndex) }) \u0026lt;/script\u0026gt; æ¡ˆä¾‹ 2ï¼šçŠ¶æ€ç®¡ç†ä¼˜åŒ– 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 // stores/user.js import { defineStore } from \u0026#39;pinia\u0026#39; import { computed } from \u0026#39;vue\u0026#39; export const useUserStore = defineStore(\u0026#39;user\u0026#39;, () =\u0026gt; { const state = reactive({ profile: null, preferences: {} }) // ä½¿ç”¨ computed ç¼“å­˜è®¡ç®—ç»“æœ const displayName = computed(() =\u0026gt; { return state.profile?.nickname || state.profile?.username || \u0026#39;åŒ¿åç”¨æˆ·\u0026#39; }) return { state, displayName } }) è¿ç§»æŒ‡å— ä» Vue 3.4 å‡çº§åˆ° 3.5 éœ€è¦æ³¨æ„ï¼š\nå…¼å®¹æ€§ï¼šå¤§éƒ¨åˆ† API ä¿æŒå‘åå…¼å®¹ ç ´åæ€§å˜æ›´ï¼šå°‘æ•°è¾¹ç¼˜ç”¨ä¾‹å¯èƒ½éœ€è¦è°ƒæ•´ æ€§èƒ½æå‡ï¼šå¤§éƒ¨åˆ†åº”ç”¨ä¼šè‡ªåŠ¨è·å¾—æ€§èƒ½æ”¹è¿› 1 2 # å‡çº§åˆ° Vue 3.5 npm install vue@^3.5.0 æ€»ç»“ Vue 3.5 çš„ Composition API æ”¹è¿›ä¸»è¦ä½“ç°åœ¨ï¼š\næ€§èƒ½æå‡ï¼šå“åº”å¼ç³»ç»Ÿä¼˜åŒ–ï¼Œå‡å°‘ä¸å¿…è¦çš„æ¸²æŸ“ å¼€å‘ä½“éªŒï¼šæ›´å¥½çš„ TypeScript æ”¯æŒå’Œè°ƒè¯•å·¥å…· æ–°ç‰¹æ€§ï¼šå®ç”¨çš„ Composables å’Œ API å¢å¼º ç¨³å®šæ€§ï¼šä¿æŒå‘åå…¼å®¹çš„åŒæ—¶æä¾›æ¸è¿›å¼å‡çº§è·¯å¾„ è¿™äº›æ”¹è¿›è®© Vue 3.5 æˆä¸ºäº†æ›´åŠ æˆç†Ÿå’Œå¼ºå¤§çš„å‰ç«¯æ¡†æ¶ï¼Œä¸ºå¼€å‘è€…æä¾›äº†æ›´å¥½çš„å¼€å‘ä½“éªŒå’Œåº”ç”¨æ€§èƒ½ã€‚\nç›¸å…³èµ„æº Vue 3.5 å®˜æ–¹å‘å¸ƒè¯´æ˜ Vue 3 Composition API æ–‡æ¡£ Vue 3 è¿ç§»æŒ‡å— ","permalink":"/blog/articles/vue-3-5-composition-api-deep-dive/","summary":"å…¨é¢è§£æVue 3.5 Composition APIçš„æ ¸å¿ƒæ”¹è¿›ï¼ŒåŠ©æ‚¨æŒæ¡æœ€æ–°å‰ç«¯å¼€å‘æŠ€æœ¯ã€‚","title":"Vue 3.5 Composition APIæ·±åº¦è§£æ"},{"content":"CSSå¸ƒå±€æŠ€æœ¯åœ¨è¿‡å»å‡ å¹´ä¸­å‘ç”Ÿäº†é©å‘½æ€§çš„å˜åŒ–ã€‚ä»ä¼ ç»Ÿçš„æµ®åŠ¨å’Œå®šä½å¸ƒå±€ï¼Œåˆ°ç°ä»£çš„Flexboxå’ŒGridå¸ƒå±€ï¼Œå¼€å‘è€…ç°åœ¨æœ‰äº†æ›´å¤šå¼ºå¤§è€Œçµæ´»çš„å·¥å…·æ¥åˆ›å»ºå“åº”å¼ã€ç°ä»£åŒ–çš„ç½‘é¡µå¸ƒå±€ã€‚æœ¬æ–‡å°†å…¨é¢ä»‹ç»ç°ä»£CSSå¸ƒå±€æŠ€æœ¯ï¼Œå¸®åŠ©ä½ æŒæ¡è¿™äº›å¼ºå¤§çš„å¸ƒå±€å·¥å…·ã€‚\nå¸ƒå±€æŠ€æœ¯æ¼”è¿› 1. ä¼ ç»Ÿå¸ƒå±€æ–¹å¼ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 /* æµ®åŠ¨å¸ƒå±€ */ .container { overflow: hidden; } .item { float: left; width: 50%; } /* æ¸…é™¤æµ®åŠ¨ */ .container::after { content: \u0026#39;\u0026#39;; display: table; clear: both; } /* å®šä½å¸ƒå±€ */ .positioned { position: absolute; top: 0; left: 0; width: 100%; } 2. ç°ä»£å¸ƒå±€æ–¹å¼ 1 2 3 4 5 6 7 8 9 10 11 12 13 /* Flexboxå¸ƒå±€ */ .flex-container { display: flex; justify-content: space-between; align-items: center; } /* Gridå¸ƒå±€ */ .grid-container { display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; } Flexboxå¸ƒå±€è¯¦è§£ 1. Flexå®¹å™¨å±æ€§ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 .container { display: flex; /* ä¸»è½´æ–¹å‘ */ flex-direction: row; /* row | row-reverse | column | column-reverse */ /* æ¢è¡Œæ§åˆ¶ */ flex-wrap: nowrap; /* nowrap | wrap | wrap-reverse */ /* ä¸»è½´å¯¹é½ */ justify-content: flex-start; /* flex-start | flex-end | center | space-between | space-around | space-evenly */ /* äº¤å‰è½´å¯¹é½ */ align-items: stretch; /* stretch | flex-start | flex-end | center | baseline */ /* å¤šè¡Œå¯¹é½ */ align-content: stretch; /* stretch | flex-start | flex-end | center | space-between | space-around | space-evenly */ /* è¡Œé—´è· */ gap: 10px; /* ç°ä»£æµè§ˆå™¨æ”¯æŒ */ row-gap: 10px; column-gap: 10px; } 2. Flexé¡¹ç›®å±æ€§ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 .item { /* æ‰©å±•æ¯”ä¾‹ */ flex-grow: 1; /* æ•°å­—ï¼Œé»˜è®¤0 */ /* æ”¶ç¼©æ¯”ä¾‹ */ flex-shrink: 1; /* æ•°å­—ï¼Œé»˜è®¤1 */ /* åŸºç¡€å¤§å° */ flex-basis: auto; /* auto | é•¿åº¦å•ä½ | ç™¾åˆ†æ¯” */ /* ç®€å†™å±æ€§ */ flex: 1 1 auto; /* flex-grow flex-shrink flex-basis */ /* å•ç‹¬å¯¹é½ */ align-self: auto; /* auto | flex-start | flex-end | center | baseline | stretch */ /* æ’åº */ order: 0; /* æ•°å­—ï¼Œé»˜è®¤0 */ } 3. å®ç”¨Flexboxå¸ƒå±€æ¨¡å¼ æ°´å¹³å±…ä¸­ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 /* æ–¹æ³•1ï¼šä½¿ç”¨justify-contentå’Œalign-items */ .center { display: flex; justify-content: center; align-items: center; height: 200px; } /* æ–¹æ³•2ï¼šä½¿ç”¨margin: auto */ .center { display: flex; } .center .item { margin: auto; } ç­‰é«˜åˆ— 1 2 3 4 5 6 7 8 9 .equal-height { display: flex; } .equal-height .column { flex: 1; /* ç¡®ä¿å†…å®¹ä¸ä¼šå¯¼è‡´é«˜åº¦ä¸ä¸€è‡´ */ align-items: stretch; } Holy Grailå¸ƒå±€ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 .holy-grail { display: flex; min-height: 100vh; flex-direction: column; } .holy-grail header, .holy-grail footer { flex: 0 0 60px; background: #f0f0f0; } .holy-grail main { flex: 1; display: flex; } .holy-grail nav, .holy-grail aside { flex: 0 0 150px; background: #e0e0e0; } .holy-grail nav { order: -1; } .holy-grail aside { order: 1; } .holy-grail content { flex: 1; background: #ffffff; padding: 20px; } ç²˜æ€§é¡µè„š 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 .sticky-footer { display: flex; min-height: 100vh; flex-direction: column; } .site-content { flex: 1; } .site-footer { flex: 0 0 auto; background: #f0f0f0; padding: 20px; } CSS Gridå¸ƒå±€è¯¦è§£ 1. Gridå®¹å™¨å±æ€§ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 .grid-container { display: grid; /* å®šä¹‰åˆ— */ grid-template-columns: 200px 1fr 2fr; /* å›ºå®š + çµæ´» + æ¯”ä¾‹ */ grid-template-columns: repeat(3, 1fr); /* é‡å¤ */ grid-template-columns: minmax(200px, 1fr); /* å“åº”å¼ */ grid-template-columns: 100px 1fr 100px 2fr; /* æ··åˆ */ /* å®šä¹‰è¡Œ */ grid-template-rows: auto 1fr auto; /* å›ºå®š + çµæ´» + å›ºå®š */ grid-template-rows: repeat(2, 100px); /* é‡å¤ */ /* å‘½ååŒºåŸŸ */ grid-template-areas: \u0026#34;header header header\u0026#34; \u0026#34;nav main aside\u0026#34; \u0026#34;footer footer footer\u0026#34;; /* é—´è· */ gap: 20px; row-gap: 20px; column-gap: 20px; /* å¯¹é½ */ justify-items: stretch; /* start | end | center | stretch */ align-items: stretch; /* start | end | center | stretch */ /* è‡ªåŠ¨æ”¾ç½® */ grid-auto-flow: row; /* row | column | dense */ grid-auto-columns: 100px; /* è‡ªåŠ¨åˆ—å®½åº¦ */ grid-auto-rows: 100px; /* è‡ªåŠ¨è¡Œé«˜åº¦ */ } 2. Gridé¡¹ç›®å±æ€§ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 .grid-item { /* æŒ‡å®šåŒºåŸŸ */ grid-column-start: 1; grid-column-end: 3; grid-row-start: 2; grid-row-end: 3; /* ç®€å†™å±æ€§ */ grid-column: 1 / 3; /* å¼€å§‹åˆ— / ç»“æŸåˆ— */ grid-row: 2 / 3; /* å¼€å§‹è¡Œ / ç»“æŸè¡Œ */ grid-area: 2 / 3 / 1 / 3; /* è¡Œå¼€å§‹ / è¡Œç»“æŸ / åˆ—å¼€å§‹ / åˆ—ç»“æŸ */ /* ä½¿ç”¨å‘½ååŒºåŸŸ */ grid-area: header; /* å¯¹é½ */ justify-self: stretch; /* start | end | center | stretch */ align-self: stretch; /* start | end | center | stretch */ /* å±‚å æ§åˆ¶ */ z-index: 1; } 3. å®ç”¨Gridå¸ƒå±€æ¨¡å¼ 12åˆ—ç½‘æ ¼ç³»ç»Ÿ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 .grid { display: grid; grid-template-columns: repeat(12, 1fr); gap: 16px; } .col-1 { grid-column: span 1; } .col-2 { grid-column: span 2; } .col-3 { grid-column: span 3; } .col-4 { grid-column: span 4; } .col-6 { grid-column: span 6; } .col-8 { grid-column: span 8; } .col-12 { grid-column: span 12; } /* åç§»ç±» */ .offset-1 { grid-column-start: 2; } .offset-2 { grid-column-start: 3; } .offset-3 { grid-column-start: 4; } å“åº”å¼ç½‘æ ¼ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 .responsive-grid { display: grid; /* ç§»åŠ¨ç«¯ */ grid-template-columns: 1fr; /* å¹³æ¿ */ grid-template-columns: repeat(2, 1fr); gap: 20px; /* æ¡Œé¢ */ grid-template-columns: repeat(4, 1fr); gap: 24px; } /* åª’ä½“æŸ¥è¯¢ */ @media (min-width: 768px) { .responsive-grid { grid-template-columns: repeat(2, 1fr); } } @media (min-width: 1200px) { .responsive-grid { grid-template-columns: repeat(4, 1fr); } } å¡ç‰‡å¸ƒå±€ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 .card-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 24px; padding: 24px; } .card { background: white; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); padding: 20px; transition: transform 0.2s ease, box-shadow 0.2s ease; } .card:hover { transform: translateY(-4px); box-shadow: 0 4px 8px rgba(0,0,0,0.15); } ä»ªè¡¨æ¿å¸ƒå±€ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 .dashboard { display: grid; grid-template-areas: \u0026#34;header header header\u0026#34; \u0026#34;sidebar main main\u0026#34; \u0026#34;sidebar stats stats\u0026#34; \u0026#34;footer footer footer\u0026#34;; grid-template-columns: 250px 1fr; grid-template-rows: 60px 1fr auto 60px; gap: 20px; min-height: 100vh; } .dashboard \u0026gt; * { background: white; border-radius: 8px; padding: 20px; } .dashboard header { grid-area: header; } .dashboard sidebar { grid-area: sidebar; } .dashboard main { grid-area: main; } .dashboard stats { grid-area: stats; } .dashboard footer { grid-area: footer; } å®¹å™¨æŸ¥è¯¢ï¼ˆContainer Queriesï¼‰ 1. åŸºç¡€å®¹å™¨æŸ¥è¯¢ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 /* å®¹å™¨å®½åº¦æŸ¥è¯¢ */ .card-container { container-type: inline-size; width: 100%; } @container (min-width: 400px) { .card { grid-column: 1 / 2; } } @container (min-width: 700px) { .card { grid-column: 1 / 3; } } @container (min-width: 1000px) { .card { grid-column: 1 / 4; } } 2. é«˜çº§å®¹å™¨æŸ¥è¯¢ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 /* å®¹å™¨æ ·å¼æŸ¥è¯¢ */ @container (min-width: 400px) and (max-width: 700px) { .component { font-size: 1rem; } } @container (min-width: 700px) { .component { font-size: 1.1rem; } } @container (orientation: portrait) { .navigation { flex-direction: column; } } @container (height \u0026gt; 400px) { .tall-component { display: grid; grid-template-rows: 1fr auto; } } å¤šåˆ—å¸ƒå±€ 1. åŸºç¡€å¤šåˆ—å¸ƒå±€ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 .multicolumn { /* åˆ—æ•° */ column-count: 3; /* åˆ—å®½ */ column-width: 200px; /* åˆ—é—´è· */ column-gap: 24px; /* åˆ—è§„åˆ™ */ column-rule: 1px solid #ddd; /* åˆ—å¡«å……å¹³è¡¡ */ column-fill: balance; /* balance | auto */ } /* ä½¿ç”¨å®¹å™¨æŸ¥è¯¢çš„å¤šåˆ—å¸ƒå±€ */ .responsive-multicolumn { container-type: inline-size; column-width: 200px; column-gap: 24px; } @container (min-width: 400px) { .responsive-multicolumn { column-count: 2; } } @container (min-width: 800px) { .responsive-multicolumn { column-count: 3; } } 2. å¤šåˆ—å¸ƒå±€çš„å®ç”¨æŠ€å·§ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 /* æŠ¥çº¸å¼å¸ƒå±€ */ .newspaper { column-count: 3; column-gap: 30px; column-rule: 1px solid #eee; } .newspaper h2 { column-span: all; break-after: column; margin-bottom: 1em; } .newspaper img { column-width: 100%; margin-bottom: 1em; } /* é¿å…å…ƒç´ è¢«åˆ†å‰² */ .newspaper blockquote, .newspaper pre, .newspaper figure { break-inside: avoid; } /* æ§åˆ¶å…ƒç´ è·¨è¶Š */ .newspaper .featured { column-span: 2; } é«˜çº§å¸ƒå±€æŠ€æœ¯ 1. æ··åˆå¸ƒå±€ï¼ˆFlexbox + Gridï¼‰ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 /* Flexå®¹å™¨åŒ…å«Gridå®¹å™¨ */ .hybrid-layout { display: flex; flex-direction: column; min-height: 100vh; } .header { flex: 0 0 auto; background: #f0f0f0; padding: 1rem; } .main-content { flex: 1; display: grid; grid-template-columns: 1fr 300px; gap: 20px; padding: 20px; } .content-area { display: grid; gap: 20px; } .sidebar { display: flex; flex-direction: column; gap: 20px; } 2. å­ç½‘æ ¼ï¼ˆSubgridï¼‰ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 .parent-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; } .subgrid-item { display: grid; grid-template-rows: auto 1fr; gap: 10px; subgrid: 1 / -1; } /* æ³¨æ„ï¼šSubgridçš„æµè§ˆå™¨æ”¯æŒæœ‰é™ */ /* ä½¿ç”¨ä¼ ç»Ÿæ–¹æ³•ä½œä¸ºåå¤‡æ–¹æ¡ˆ */ @supports not (display: grid) { .subgrid-item { display: flex; flex-direction: column; } } 3. é”šç‚¹å¸ƒå±€ï¼ˆAnchor Positioningï¼‰ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 .anchor-layout { display: grid; grid-template-columns: 200px 1fr; grid-template-rows: auto; } .sidebar { grid-row: 1 / -1; background: #f0f0f0; } .main-content { grid-template-rows: auto 1fr auto; } å®æˆ˜æ¡ˆä¾‹ 1. å“åº”å¼å¯¼èˆªæ  1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 .navbar { display: flex; align-items: center; justify-content: space-between; padding: 1rem; background: white; box-shadow: 0 2px 4px rgba(0,0,0,0.1); } .nav-brand { font-size: 1.25rem; font-weight: bold; } .nav-links { display: flex; gap: 2rem; align-items: center; } .nav-links a { text-decoration: none; color: #333; padding: 0.5rem 1rem; border-radius: 4px; transition: background-color 0.2s ease; } .nav-links a:hover { background-color: #f0f0f0; } .nav-actions { display: flex; gap: 1rem; align-items: center; } /* ç§»åŠ¨ç«¯èœå• */ .hamburger { display: none; flex-direction: column; justify-content: space-between; width: 24px; height: 24px; cursor: pointer; } @media (max-width: 768px) { .nav-links { display: none; } .hamburger { display: flex; } .navbar.mobile-open .nav-links { display: flex; position: absolute; top: 100%; left: 0; right: 0; background: white; flex-direction: column; box-shadow: 0 2px 4px rgba(0,0,0,0.1); padding: 1rem; } } 2. äº§å“å¡ç‰‡ç½‘æ ¼ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 .product-grid { display: grid; container-type: inline-size; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 24px; padding: 24px; } .product-card { display: flex; flex-direction: column; background: white; border-radius: 12px; overflow: hidden; box-shadow: 0 4px 6px rgba(0,0,0,0.1); transition: transform 0.2s ease, box-shadow 0.2s ease; } .product-card:hover { transform: translateY(-4px); box-shadow: 0 8px 12px rgba(0,0,0,0.15); } .product-image { width: 100%; height: 200px; object-fit: cover; background: #f0f0f0; } .product-info { flex: 1; padding: 16px; display: flex; flex-direction: column; } .product-title { font-size: 1.125rem; font-weight: 600; margin-bottom: 8px; color: #1a2021a; } .product-description { color: #6b7280; font-size: 0.875rem; line-height: 1.5; margin-bottom: 16px; flex: 1; } .product-price { font-size: 1.25rem; font-weight: bold; color: #059669; margin-bottom: 16px; } .product-actions { display: flex; gap: 8px; } .btn { flex: 1; padding: 8px 16px; border: none; border-radius: 6px; cursor: pointer; font-size: 0.875rem; transition: background-color 0.2s ease; } .btn-primary { background: #3b82f6; color: white; } .btn-primary:hover { background: #2563eb; } .btn-secondary { background: #6b7280; color: white; } .btn-secondary:hover { background: #4b5563; } /* å“åº”å¼è°ƒæ•´ */ @container (max-width: 480px) { .product-grid { grid-template-columns: 1fr; } } @container (min-width: 481px) and (max-width: 768px) { .product-grid { grid-template-columns: repeat(2, 1fr); } } 3. ç¤¾äº¤åª’ä½“å¸ƒå±€ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 .social-feed { max-width: 600px; margin: 0 auto; padding: 20px; } .feed-item { display: flex; gap: 16px; padding: 16px 0; border-bottom: 1px solid #e5e7eb; } .feed-item:last-child { border-bottom: none; } .avatar { width: 48px; height: 48px; border-radius: 50%; object-fit: cover; flex-shrink: 0; } .feed-content { flex: 1; min-width: 0; } .feed-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 8px; } .author-info { display: flex; flex-direction: column; } .author-name { font-weight: 600; color: #1f2937; } .timestamp { font-size: 0.875rem; color: #6b7280; } .feed-text { color: #374151; line-height: 1.5; margin-bottom: 12px; } .feed-actions { display: flex; gap: 16px; } .feed-action { display: flex; align-items: center; gap: 4px; color: #6b7280; text-decoration: none; font-size: 0.875rem; transition: color 0.2s ease; } .feed-action:hover { color: #3b82f6; } æ€§èƒ½ä¼˜åŒ– 1. é¿å…å¸ƒå±€é‡æ’ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 /* é¿å…ä¸å¿…è¦çš„å°ºå¯¸å˜åŒ– */ .layout-stable { contain: layout; width: 100%; height: 200px; } /* ä½¿ç”¨containå±æ€§ä¼˜åŒ– */ .performance-optimal { contain: layout style paint; /* æˆ–ä½¿ç”¨ä¸¥æ ¼çš„contain */ contain: strict; } /* ä½¿ç”¨will-changeä¼˜åŒ– */ .will-change-animation { will-change: transform; } 2. ä¼˜åŒ–é€‰æ‹©å™¨æ€§èƒ½ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 /* é¿å…è¿‡æ·±çš„é€‰æ‹©å™¨ */ /* âŒ é¿å… */ header nav ul li a { } /* âœ… æ¨è */ .nav-link { } /* ä½¿ç”¨BEMå‘½åçº¦å®š */ .card { /* å¡ç‰‡æ ·å¼ */ } .card__title { /* æ ‡é¢˜æ ·å¼ */ } .card__content { /* å†…å®¹æ ·å¼ */ } 3. ä½¿ç”¨ç¡¬ä»¶åŠ é€Ÿ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 /* å¯¹åŠ¨ç”»å…ƒç´ ä½¿ç”¨ç¡¬ä»¶åŠ é€Ÿ */ .animated-element { transform: translateZ(0); backface-visibility: hidden; perspective: 1000px; } /* å¯¹éœ€è¦é‡ç»˜çš„å…ƒç´  */ .complex-filter { will-change: filter; } /* å¯¹3Då˜æ¢ä½¿ç”¨ */ .transform-3d { transform: translate3d(0, 0, 0); backface-visibility: hidden; } è°ƒè¯•å·¥å…· 1. Chrome DevTools 1 2 3 4 5 6 7 8 9 /* ä½¿ç”¨CSS Grid Inspectoræ£€æŸ¥å¸ƒå±€ */ .grid-debug { /* å¯ä»¥åœ¨DevToolsä¸­æŸ¥çœ‹ */ } /* ä½¿ç”¨Flexbox Inspector */ .flex-debug { /* å¯ä»¥åœ¨DevToolsä¸­æŸ¥çœ‹ */ } 2. è§†è§‰åŒ–è°ƒè¯• 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 /* å¸ƒå±€è¾¹æ¡† */ .debug-layout * { outline: 1px solid red; } /* ç½‘æ ¼çº¿ */ .debug-grid { background-image: linear-gradient(rgba(255,0,0,.2) 1px, transparent 1px), linear-gradient(90deg, rgba(255,0,0,.2) 1px, transparent 1px); background-size: 50px 50px; } /* Flexboxè°ƒè¯• */ .debug-flex { background: linear-gradient(90deg, #ff9eb3 0%, transparent 100%); } .debug-flex \u0026gt; * { outline: 2px solid #4299e1; background: rgba(255, 236, 139, 0.1); } æ€»ç»“ ç°ä»£CSSå¸ƒå±€æŠ€æœ¯ä¸ºå¼€å‘è€…æä¾›äº†å¼ºå¤§è€Œçµæ´»çš„å·¥å…·ï¼š\næ ¸å¿ƒå¸ƒå±€æŠ€æœ¯ Flexboxï¼šä¸€ç»´å¸ƒå±€ï¼Œé€‚åˆå¯¼èˆªã€å¡ç‰‡ç­‰ç»„ä»¶ CSS Gridï¼šäºŒç»´å¸ƒå±€ï¼Œé€‚åˆå¤æ‚é¡µé¢ç»“æ„ å®¹å™¨æŸ¥è¯¢ï¼šåŸºäºå®¹å™¨å¤§å°çš„å“åº”å¼è®¾è®¡ å¤šåˆ—å¸ƒå±€ï¼šæŠ¥çº¸å¼æ–‡æœ¬å¸ƒå±€ æœ€ä½³å®è·µ ä¼˜å…ˆä½¿ç”¨ç°ä»£å¸ƒå±€æ–¹å¼ åˆç†ä½¿ç”¨åª’ä½“æŸ¥è¯¢å’Œå®¹å™¨æŸ¥è¯¢ æ³¨é‡æ€§èƒ½ä¼˜åŒ–å’Œå¯è®¿é—®æ€§ ä½¿ç”¨è¯­ä¹‰åŒ–HTMLç»“æ„ æä¾›è‰¯å¥½çš„é™çº§æ–¹æ¡ˆ æŠ€æœ¯é€‰æ‹©å»ºè®® ç®€å•ç»„ä»¶ï¼šFlexbox å¤æ‚é¡µé¢ï¼šCSS Grid å“åº”å¼è®¾è®¡ï¼šå®¹å™¨æŸ¥è¯¢ + Flexbox/Grid æ–‡æœ¬å¸ƒå±€ï¼šå¤šåˆ—å¸ƒå±€ ç‰¹æ®Šæ•ˆæœï¼šå®šä½ + å˜æ¢ é€šè¿‡æŒæ¡è¿™äº›ç°ä»£CSSå¸ƒå±€æŠ€æœ¯ï¼Œä½ å¯ä»¥åˆ›å»ºå‡ºæ›´åŠ çµæ´»ã€å“åº”å¼ã€æ˜“ç»´æŠ¤çš„ç½‘é¡µå¸ƒå±€ï¼Œä¸ºç”¨æˆ·æä¾›æ›´å¥½çš„æµè§ˆä½“éªŒã€‚è®°ä½ï¼Œé€‰æ‹©åˆé€‚çš„å¸ƒå±€å·¥å…·å¾ˆé‡è¦ï¼Œä¸åŒçš„åœºæ™¯é€‚åˆä¸åŒçš„è§£å†³æ–¹æ¡ˆã€‚\n","permalink":"/blog/articles/modern-css-layout-techniques/","summary":"å…¨é¢ä»‹ç»ç°ä»£CSSå¸ƒå±€æŠ€æœ¯ï¼ŒåŒ…æ‹¬Flexboxã€Gridã€å®¹å™¨æŸ¥è¯¢ã€å¤šåˆ—å¸ƒå±€ç­‰æ ¸å¿ƒç‰¹æ€§ï¼Œå¸®åŠ©ä½ æ„å»ºå“åº”å¼ã€ç°ä»£åŒ–çš„ç½‘é¡µå¸ƒå±€ã€‚","title":"ç°ä»£CSSå¸ƒå±€æŠ€æœ¯å…¨è§£æï¼šFlexboxã€Gridä¸æœ€ä½³å®è·µ"},{"content":"JavaScriptçš„å¼‚æ­¥ç¼–ç¨‹æ˜¯ç°ä»£Webå¼€å‘çš„æ ¸å¿ƒæ¦‚å¿µä¹‹ä¸€ã€‚ä»æœ€åˆçš„å›è°ƒå‡½æ•°åˆ°ç°åœ¨çš„Async/Awaitï¼ŒJavaScriptå¼‚æ­¥ç¼–ç¨‹ç»å†äº†å·¨å¤§çš„æ¼”è¿›ã€‚æœ¬æ–‡å°†æ·±å…¥æ¢è®¨å¼‚æ­¥ç¼–ç¨‹çš„æœ€ä½³å®è·µï¼Œå¸®åŠ©ä½ å†™å‡ºæ›´æ¸…æ™°ã€æ›´å¯ç»´æŠ¤çš„å¼‚æ­¥ä»£ç ã€‚\nå¼‚æ­¥ç¼–ç¨‹æ¼”è¿›å² 1. å›è°ƒå‡½æ•°æ—¶ä»£ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 // ä¼ ç»Ÿçš„å›è°ƒå‡½æ•° function fetchData(callback) { setTimeout(() =\u0026gt; { callback(\u0026#39;Data loaded\u0026#39;) }, 1000) } function processData(callback) { fetchData((data) =\u0026gt; { const result = data.toUpperCase() callback(result) }) } // å›è°ƒåœ°ç‹± function getData(callback) { fetchData((data1) =\u0026gt; { processData((data2) =\u0026gt; { anotherProcess((data3) =\u0026gt; { finalProcess((data4) =\u0026gt; { callback(data4) }) }) }) }) } 2. Promiseæ—¶ä»£ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 // PromiseåŸºç¡€ç”¨æ³• function fetchData() { return new Promise((resolve, reject) =\u0026gt; { setTimeout(() =\u0026gt; { resolve(\u0026#39;Data loaded\u0026#39;) }, 1000) }) } // Promiseé“¾ fetchData() .then(data =\u0026gt; { console.log(data) return processData(data) }) .then(result =\u0026gt; { console.log(result) return anotherProcess(result) }) .catch(error =\u0026gt; { console.error(\u0026#39;Error:\u0026#39;, error) }) 3. Async/Awaitæ—¶ä»£ 1 2 3 4 5 6 7 8 9 10 11 12 // Async/AwaitåŸºç¡€ç”¨æ³• async function getData() { try { const data = await fetchData() const result = await processData(data) const finalResult = await anotherProcess(result) return finalResult } catch (error) { console.error(\u0026#39;Error:\u0026#39;, error) throw error } } Promiseæ·±åº¦è§£æ 1. Promiseçš„ä¸‰ç§çŠ¶æ€ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 // Pendingï¼ˆè¿›è¡Œä¸­ï¼‰ const promise = new Promise((resolve, reject) =\u0026gt; { // å¼‚æ­¥æ“ä½œè¿›è¡Œä¸­ setTimeout(() =\u0026gt; { resolve(\u0026#39;Success\u0026#39;) // Fulfilledï¼ˆå·²å®Œæˆï¼‰ }, 1000) }) console.log(promise) // Promise { \u0026lt;pending\u0026gt; } // çŠ¶æ€å˜åŒ–å›¾è§£ // Pending â†’ Fulfilled // Pending â†’ Rejected // çŠ¶æ€ä¸€æ—¦ç¡®å®šå°±ä¸å¯é€†è½¬ 2. Promiseæ„é€ å‡½æ•°çš„æ­£ç¡®ä½¿ç”¨ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 // âŒ é”™è¯¯ç”¨æ³•ï¼šåœ¨æ„é€ å‡½æ•°ä¸­åŒæ­¥è°ƒç”¨resolve function badPromise() { const promise = new Promise((resolve) =\u0026gt; { resolve(\u0026#39;Already resolved\u0026#39;) // è¿™é‡Œçš„ä»£ç æ°¸è¿œä¸ä¼šæ‰§è¡Œ console.log(\u0026#39;This will never run\u0026#39;) }) return promise } // âœ… æ­£ç¡®ç”¨æ³•ï¼šå¼‚æ­¥è°ƒç”¨resolve function goodPromise() { return new Promise((resolve, reject) =\u0026gt; { setTimeout(() =\u0026gt; { resolve(\u0026#39;Resolved asynchronously\u0026#39;) console.log(\u0026#39;This will run\u0026#39;) }, 1000) }) } 3. Promiseçš„é”™è¯¯å¤„ç† 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 // Promiseé”™è¯¯å¤„ç†çš„å‡ ç§æ–¹å¼ // 1. ä½¿ç”¨catch() fetch(\u0026#39;/api/data\u0026#39;) .then(response =\u0026gt; response.json()) .then(data =\u0026gt; console.log(data)) .catch(error =\u0026gt; console.error(error)) // 2. ä½¿ç”¨ç¬¬äºŒä¸ªå‚æ•° fetch(\u0026#39;/api/data\u0026#39;) .then( response =\u0026gt; response.json(), error =\u0026gt; console.error(error) ) // 3. ä½¿ç”¨try-catchåŒ…è£… function async fetchWithErrorHandling() { try { const response = await fetch(\u0026#39;/api/data\u0026#39;) const data = await response.json() console.log(data) } catch (error) { console.error(error) } } 4. Promiseç»„åˆæ–¹æ³• 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 // Promise.all - æ‰€æœ‰Promiseéƒ½å®Œæˆ function fetchMultipleData() { const promise1 = fetch(\u0026#39;/api/users\u0026#39;) const promise2 = fetch(\u0026#39;/api/posts\u0026#39;) const promise3 = fetch(\u0026#39;/api/comments\u0026#39;) return Promise.all([promise1, promise2, promise3]) .then(([users, posts, comments]) =\u0026gt; { console.log(\u0026#39;All data loaded\u0026#39;) return { users, posts, comments } }) .catch(error =\u0026gt; { console.error(\u0026#39;One of the requests failed:\u0026#39;, error) throw error }) } // Promise.allSettled - æ‰€æœ‰Promiseéƒ½å®Œæˆï¼ˆä¸è®ºæˆåŠŸå¤±è´¥ï¼‰ function fetchAllSettled() { const urls = [\u0026#39;/api/users\u0026#39;, \u0026#39;/api/posts\u0026#39;, \u0026#39;/api/comments\u0026#39;] const promises = urls.map(url =\u0026gt; fetch(url).then(response =\u0026gt; response.json()) ) return Promise.allSettled(promises) .then(results =\u0026gt; { const successful = results.filter(result =\u0026gt; result.status === \u0026#39;fulfilled\u0026#39;) const failed = results.filter(result =\u0026gt; result.status === \u0026#39;rejected\u0026#39;) console.log(\u0026#39;Successful requests:\u0026#39;, successful.length) console.log(\u0026#39;Failed requests:\u0026#39;, failed.length) return { successful: successful.map(r =\u0026gt; r.value), failed: failed.map(f =\u0026gt; f.reason) } }) } // Promise.race - æœ€å¿«å®Œæˆçš„Promise function fetchWithRace() { const timeoutPromise = new Promise((_, reject) =\u0026gt; { setTimeout(() =\u0026gt; reject(new Error(\u0026#39;Request timeout\u0026#39;)), 5000) }) const fetchPromise = fetch(\u0026#39;/api/data\u0026#39;) .then(response =\u0026gt; response.json()) return Promise.race([fetchPromise, timeoutPromise]) .catch(error =\u0026gt; { if (error.message === \u0026#39;Request timeout\u0026#39;) { console.log(\u0026#39;è¯·æ±‚è¶…æ—¶\u0026#39;) } throw error }) } Async/Awaitæœ€ä½³å®è·µ 1. é”™è¯¯å¤„ç†ç­–ç•¥ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 // 1. ç»Ÿä¸€çš„é”™è¯¯å¤„ç†ä¸­é—´ä»¶ class ApiClient { async request(url, options = {}) { try { const response = await fetch(url, { headers: { \u0026#39;Content-Type\u0026#39;: \u0026#39;application/json\u0026#39;, ...options.headers, }, ...options, }) if (!response.ok) { throw new Error(`HTTP Error: ${response.status} ${response.statusText}`) } return await response.json() } catch (error) { if (error instanceof TypeError) { throw new Error(\u0026#39;Network error: \u0026#39; + error.message) } throw error } } } // 2. è‡ªå®šä¹‰é”™è¯¯ç±» class NetworkError extends Error { constructor(message, response) { super(message) this.name = \u0026#39;NetworkError\u0026#39; this.response = response } } class ValidationError extends Error { constructor(message, field) { super(message) this.name = \u0026#39;ValidationError\u0026#39; this.field = field } } // ä½¿ç”¨ç¤ºä¾‹ const apiClient = new ApiClient() async function getUserData(userId) { try { const userData = await apiClient.request(`/api/users/${userId}`) if (!userData.email) { throw new ValidationError(\u0026#39;Email is required\u0026#39;, \u0026#39;email\u0026#39;) } return userData } catch (error) { if (error instanceof ValidationError) { console.error(`Validation error in ${error.field}: ${error.message}`) } else if (error instanceof NetworkError) { console.error(\u0026#39;Network error:\u0026#39;, error.message) } else { console.error(\u0026#39;Unexpected error:\u0026#39;, error.message) } throw error } } 2. å¹¶å‘æ§åˆ¶ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 // å¹¶å‘é™åˆ¶å™¨ class ConcurrencyLimiter { constructor(maxConcurrent) { this.maxConcurrent = maxConcurrent this.currentCount = 0 this.queue = [] } async execute(task) { return new Promise((resolve, reject) =\u0026gt; { this.queue.push({ task, resolve, reject }) this.processQueue() }) } async processQueue() { if (this.currentCount \u0026gt;= this.maxConcurrent || this.queue.length === 0) { return } this.currentCount++ const { task, resolve, reject } = this.queue.shift() try { const result = await task() resolve(result) } catch (error) { reject(error) } finally { this.currentCount-- this.processQueue() } } } // ä½¿ç”¨ç¤ºä¾‹ const limiter = new ConcurrencyLimiter(3) async function processBatch(items) { const tasks = items.map(item =\u0026gt; limiter.execute(() =\u0026gt; processItem(item)) ) return Promise.all(tasks) } async function processItem(item) { console.log(`Processing item: ${item}`) await new Promise(resolve =\u0026gt; setTimeout(resolve, 1000)) return `Processed: ${item}` } 3. é‡è¯•æœºåˆ¶ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 // æŒ‡æ•°é€€é¿é‡è¯• async function retryWithBackoff(fn, maxRetries = 3, baseDelay = 1000) { let lastError for (let attempt = 0; attempt \u0026lt;= maxRetries; attempt++) { try { const result = await fn() return result } catch (error) { lastError = error if (attempt === maxRetries) { throw error } const delay = baseDelay * Math.pow(2, attempt) console.log(`Attempt ${attempt + 1} failed, retrying in ${delay}ms`) await new Promise(resolve =\u0026gt; setTimeout(resolve, delay)) } } throw lastError } // çº¿æ€§é€€é¿é‡è¯• async function retryLinear(fn, maxRetries = 3, delay = 1000) { let lastError for (let attempt = 0; attempt \u0026lt;= maxRetries; attempt++) { try { const result = await fn() return result } catch (error) { lastError = error if (attempt === maxRetries) { throw error } const waitTime = delay * (attempt + 1) console.log(`Attempt ${attempt + 1} failed, retrying in ${waitTime}ms`) await new Promise(resolve =\u0026gt; setTimeout(resolve, waitTime)) } } throw lastError } // ä½¿ç”¨ç¤ºä¾‹ async function fetchWithRetry(url) { return retryWithBackoff(async () =\u0026gt; { const response = await fetch(url) if (!response.ok) { throw new Error(`HTTP ${response.status}`) } return response.json() }, 5) } 4. è¶…æ—¶æ§åˆ¶ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 // å¸¦è¶…æ—¶çš„fetch async function fetchWithTimeout(url, timeout = 5000) { const controller = new AbortController() const timeoutId = setTimeout(() =\u0026gt; controller.abort(), timeout) try { const response = await fetch(url, { signal: controller.signal, }) if (!response.ok) { throw new Error(`HTTP Error: ${response.status}`) } return response.json() } finally { clearTimeout(timeoutId) } } // Promise.raceå®ç°çš„è¶…æ—¶ async function fetchWithTimeoutRace(url, timeout = 5000) { const fetchPromise = fetch(url).then(response =\u0026gt; { if (!response.ok) { throw new Error(`HTTP Error: ${response.status}`) }) return response.json() }) const timeoutPromise = new Promise((_, reject) =\u0026gt; { setTimeout(() =\u0026gt; reject(new Error(\u0026#39;Request timeout\u0026#39;)), timeout) }) return Promise.race([fetchPromise, timeoutPromise]) } // ä½¿ç”¨ç¤ºä¾‹ try { const data = await fetchWithTimeout(\u0026#39;/api/data\u0026#39;, 3000) console.log(data) } catch (error) { if (error.name === \u0026#39;AbortError\u0026#39;) { console.log(\u0026#39;Request was aborted due to timeout\u0026#39;) } else { console.error(\u0026#39;Error:\u0026#39;, error.message) } } é«˜çº§å¼‚æ­¥æ¨¡å¼ 1. å¹¶è¡Œå¤„ç† 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 // å¹¶è¡Œå¤„ç†æ•°ç»„ä¸­çš„å¼‚æ­¥æ“ä½œ async function processItemsInParallel(items, processor) { const promises = items.map(item =\u0026gt; processor(item)) const results = await Promise.all(promises) return results } // åˆ†æ‰¹å¹¶è¡Œå¤„ç† async function processItemsInBatches(items, processor, batchSize = 5) { const results = [] for (let i = 0; i \u0026lt; items.length; i += batchSize) { const batch = items.slice(i, i + batchSize) const batchResults = await Promise.all( batch.map(item =\u0026gt; processor(item)) ) results.push(...batchResults) } return results } // ä½¿ç”¨ç¤ºä¾‹ async function fetchUsersInParallel(userIds) { const fetchUser = async (id) =\u0026gt; { const response = await fetch(`/api/users/${id}`) return response.json() } const users = await processItemsInParallel(userIds, fetchUser) return users } 2. ç€¡é“æ¨¡å¼ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 // å¼‚æ­¥ç®¡é“ class AsyncPipeline { constructor() { this.steps = [] } step(fn) { this.steps.push(fn) return this } async execute(data) { let result = data for (const step of this.steps) { result = await step(result) } return result } } // ä½¿ç”¨ç¤ºä¾‹ const pipeline = new AsyncPipeline() pipeline .step(async (data) =\u0026gt; { console.log(\u0026#39;Step 1: Data validation\u0026#39;) if (!data.id) { throw new Error(\u0026#39;ID is required\u0026#39;) } return { ...data, validated: true } }) .step(async (data) =\u0026gt; { console.log(\u0026#39;Step 2: Data transformation\u0026#39;) return { ...data, transformed: true } }) .step(async (data) =\u0026gt; { console.log(\u0026#39;Step 3: Data saving\u0026#39;) await saveData(data) return { ...data, saved: true } }) const result = await pipeline.execute({ id: 1, name: \u0026#39;Test\u0026#39; }) 3. å‘å¸ƒè®¢é˜…æ¨¡å¼ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 // å¼‚æ­¥äº‹ä»¶å‘å°„å™¨ class AsyncEventEmitter { constructor() { this.listeners = new Map() } on(event, listener) { if (!this.listeners.has(event)) { this.listeners.set(event, []) } this.listeners.get(event).push(listener) return this } off(event, listener) { if (this.listeners.has(event)) { const listeners = this.listeners.get(event) const index = listeners.indexOf(listener) if (index !== -1) { listeners.splice(index, 1) } } return this } async emit(event, ...args) { if (!this.listeners.has(event)) { return } const listeners = this.listeners.get(event) const promises = listeners.map(listener =\u0026gt; Promise.resolve(listener(...args)) ) await Promise.all(promises) } async emitSeries(event, ...args) { if (!this.listeners.has(event)) { return } const listeners = this.listeners.get(event) for (const listener of listeners) { await Promise.resolve(listener(...args)) } } } // ä½¿ç”¨ç¤ºä¾‹ const emitter = new AsyncEventEmitter() emitter.on(\u0026#39;data\u0026#39;, async (data) =\u0026gt; { console.log(\u0026#39;Listener 1 received data:\u0026#39;, data) await processData(data) }) emitter.on(\u0026#39;data\u0026#39;, async (data) =\u0026gt; { console.log(\u0026#39;Listener 2 received data:\u0026#39;, data) await saveData(data) }) await emitter.emit(\u0026#39;data\u0026#39;, { id: 1, name: \u0026#39;Test\u0026#39; }) å¼‚æ­¥æ¨¡å¼åœ¨Reactä¸­çš„åº”ç”¨ 1. æ•°æ®è·å–Hook 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 import { useState, useEffect, useCallback } from \u0026#39;react\u0026#39; // è‡ªå®šä¹‰æ•°æ®è·å–Hook function useApi(url, options = {}) { const [data, setData] = useState(null) const [loading, setLoading] = useState(true) const [error, setError] = useState(null) const fetchData = useCallback(async () =\u0026gt; { try { setLoading(true) setError(null) const response = await fetch(url, options) if (!response.ok) { throw new Error(`HTTP error! status: ${response.status}`) } const result = await response.json() setData(result) } catch (err) { setError(err.message) } finally { setLoading(false) } }, [url, options]) useEffect(() =\u0026gt; { fetchData() }, [fetchData]) return { data, loading, error, refetch: fetchData } } // ä½¿ç”¨ç¤ºä¾‹ function UserProfile({ userId }) { const { data: user, loading, error, refetch } = useApi(`/api/users/${userId}`) if (loading) return \u0026lt;div\u0026gt;Loading...\u0026lt;/div\u0026gt; if (error) return \u0026lt;div\u0026gt;Error: {error}\u0026lt;/div\u0026gt; if (!user) return \u0026lt;div\u0026gt;No user found\u0026lt;/div\u0026gt; return ( \u0026lt;div\u0026gt; \u0026lt;h1\u0026gt;{user.name}\u0026lt;/h1\u0026gt; \u0026lt;p\u0026gt;{user.email}\u0026lt;/p\u0026gt; \u0026lt;button onClick={refetch}\u0026gt;Refresh\u0026lt;/button\u0026gt; \u0026lt;/div\u0026gt; ) } 2. è¡¨å•æäº¤å¤„ç† 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 import { useState } from \u0026#39;react\u0026#39; function useAsyncForm(initialValues, submitHandler) { const [values, setValues] = useState(initialValues) const [errors, setErrors] = useState({}) const [isSubmitting, setIsSubmitting] = useState(false) const handleChange = useCallback((e) =\u0026gt; { const { name, value, type, checked } = e.target const fieldValue = type === \u0026#39;checkbox\u0026#39; ? checked : value setValues(prev =\u0026gt; ({ ...prev, [name]: fieldValue })) if (errors[name]) { setErrors(prev =\u0026gt; ({ ...prev, [name]: \u0026#39;\u0026#39; })) } }, [errors]) const handleSubmit = useCallback(async (e) =\u0026gt; { e.preventDefault() setIsSubmitting(true) setErrors({}) try { await submitHandler(values) } catch (error) { if (error.validationErrors) { setErrors(error.validationErrors) } else { console.error(\u0026#39;Submit error:\u0026#39;, error) } } finally { setIsSubmitting(false) } }, [values, submitHandler]) const reset = useCallback(() =\u0026gt; { setValues(initialValues) setErrors({}) setIsSubmitting(false) }, [initialValues]) return { values, errors, isSubmitting, handleChange, handleSubmit, reset } } // ä½¿ç”¨ç¤ºä¾‹ function UserForm() { const submitHandler = async (values) =\u0026gt; { const response = await fetch(\u0026#39;/api/users\u0026#39;, { method: \u0026#39;POST\u0026#39;, headers: { \u0026#39;Content-Type\u0026#39;: \u0026#39;application/json\u0026#39; }, body: JSON.stringify(values), }) if (!response.ok) { const error = await response.json() throw new Error(error.message || \u0026#39;Submit failed\u0026#39;) } return response.json() } const { values, errors, isSubmitting, handleChange, handleSubmit, reset } = useAsyncForm({ name: \u0026#39;\u0026#39;, email: \u0026#39;\u0026#39; }, submitHandler) return ( \u0026lt;form onSubmit={handleSubmit}\u0026gt; \u0026lt;div\u0026gt; \u0026lt;label\u0026gt;Name:\u0026lt;/label\u0026gt; \u0026lt;input type=\u0026#34;text\u0026#34; name=\u0026#34;name\u0026#34; value={values.name} onChange={handleChange} /\u0026gt; {errors.name \u0026amp;\u0026amp; \u0026lt;span style={{ color: \u0026#39;red\u0026#39; }}\u0026gt;{errors.name}\u0026lt;/span\u0026gt;} \u0026lt;/div\u0026gt; \u0026lt;div\u0026gt; \u0026lt;label\u0026gt;Email:\u0026lt;/label\u0026gt; \u0026lt;input type=\u0026#34;email\u0026#34; name=\u0026#34;email\u0026#34; value={values.email} onChange={handleChange} /\u0026gt; {errors.email \u0026amp;\u0026amp; \u0026lt;span style={{ color: \u0026#39;red\u0026#39; }}\u0026gt;{errors.email}\u0026lt;/span\u0026gt;} \u0026lt;/div\u0026gt; \u0026lt;button type=\u0026#34;submit\u0026#34; disabled={isSubmitting}\u0026gt; {isSubmitting ? \u0026#39;Submitting...\u0026#39; : \u0026#39;Submit\u0026#39;} \u0026lt;/button\u0026gt; \u0026lt;button type=\u0026#34;button\u0026#34; onClick={reset}\u0026gt; Reset \u0026lt;/button\u0026gt; \u0026lt;/form\u0026gt; ) } æ€§èƒ½ä¼˜åŒ–æŠ€å·§ 1. è¯·æ±‚ç¼“å­˜ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 // ç®€å•çš„å†…å­˜ç¼“å­˜ class Cache { constructor(ttl = 5 * 60 * 1000) { // 5åˆ†é’ŸTTL this.cache = new Map() this.ttl = ttl } set(key, value) { this.cache.set(key, { value, timestamp: Date.now() }) } get(key) { const item = this.cache.get(key) if (!item) { return null } if (Date.now() - item.timestamp \u0026gt; this.ttl) { this.cache.delete(key) return null } return item.value } clear() { this.cache.clear() } } // å¸¦ç¼“å­˜çš„APIå®¢æˆ·ç«¯ class CachedApiClient { constructor() { this.cache = new Cache() } async get(url, options = {}) { const cacheKey = `${url}:${JSON.stringify(options)}` const cachedData = this.cache.get(cacheKey) if (cachedData) { console.log(\u0026#39;Returning cached data for:\u0026#39;, url) return cachedData } console.log(\u0026#39;Fetching fresh data for:\u0026#39;, url) const response = await fetch(url, options) const data = await response.json() this.cache.set(cacheKey, data) return data } } // ä½¿ç”¨ç¤ºä¾‹ const apiClient = new CachedApiClient() // ç¬¬ä¸€æ¬¡è¯·æ±‚ - å‘é€ç½‘ç»œè¯·æ±‚ const data1 = await apiClient.get(\u0026#39;/api/users\u0026#39;) // ç¬¬äºŒæ¬¡è¯·æ±‚ - è¿”å›ç¼“å­˜æ•°æ® const data2 = await apiClient.get(\u0026#39;/api/users\u0026#39;) 2. è¯·æ±‚å»é‡ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 // é˜²æŠ–å’ŒèŠ‚æµ function debounce(func, delay) { let timeoutId return function(...args) { clearTimeout(timeoutId) timeoutId = setTimeout(() =\u0026gt; func.apply(this, args), delay) } } function throttle(func, delay) { let lastCall = 0 return function(...args) { const now = Date.now() if (now - lastCall \u0026gt;= delay) { lastCall = now return func.apply(this, args) } } } // è¯·æ±‚å»é‡å™¨ class RequestDeduplicator { constructor() { this.pendingRequests = new Map() } async deduplicate(key, requestFn) { if (this.pendingRequests.has(key)) { return this.pendingRequests.get(key) } const promise = requestFn() .finally(() =\u0026gt; { this.pendingRequests.delete(key) }) this.pendingRequests.set(key, promise) return promise } } // ä½¿ç”¨ç¤ºä¾‹ const deduplicator = new RequestDeduplicator() async function fetchUserData(userId) { return deduplicator.deduplicate(`user:${userId}`, async () =\u0026gt; { const response = await fetch(`/api/users/${userId}`) return response.json() }) } // é˜²æŠ–æœç´¢ const debouncedSearch = debounce(async (query) =\u0026gt; { const response = await fetch(`/api/search?q=${query}`) return response.json() }, 300) // èŠ‚æµæ»šåŠ¨å¤„ç† const throttledHandleScroll = throttle((event) =\u0026gt; { console.log(\u0026#39;Scroll position:\u0026#39;, event.target.scrollTop) }, 100) æµ‹è¯•å¼‚æ­¥ä»£ç  1. æµ‹è¯•Promise 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 // Jestæµ‹è¯•Promise const fetchData = () =\u0026gt; { return new Promise(resolve =\u0026gt; { setTimeout(() =\u0026gt; resolve(\u0026#39;data\u0026#39;), 100) }) } describe(\u0026#39;fetchData\u0026#39;, () =\u0026gt; { test(\u0026#39;should resolve with data\u0026#39;, async () =\u0026gt; { const result = await fetchData() expect(result).toBe(\u0026#39;data\u0026#39;) }) test(\u0026#39;should handle rejection\u0026#39;, async () =\u0026gt; { const rejectFn = jest.fn() const errorPromise = new Promise((_, reject) =\u0026gt; { rejectFn(\u0026#39;error\u0026#39;) }) expect(errorPromise).rejects.toMatch(\u0026#39;error\u0026#39;) expect(rejectFn).toHaveBeenCalled() }) }) 2. æµ‹è¯•Async/Await 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 // æµ‹è¯•å¼‚æ­¥å‡½æ•° async function processUser(userData) { const validatedData = await validateUser(userData) const savedData = await saveUser(validatedData) return savedData } const mockValidateUser = jest.fn() const mockSaveUser = jest.fn() jest.mock(\u0026#39;./validation\u0026#39;, () =\u0026gt; ({ validateUser: mockValidateUser })) jest.mock(\u0026#39;./database\u0026#39;, () =\u0026gt; ({ saveUser: mockSaveUser })) describe(\u0026#39;processUser\u0026#39;, () =\u0026gt; { beforeEach(() =\u0026gt; { jest.clearAllMocks() }) test(\u0026#39;should process user successfully\u0026#39;, async () =\u0026gt; { const userData = { name: \u0026#39;John\u0026#39;, email: \u0026#39;john@example.com\u0026#39; } mockValidateUser.mockResolvedValue(userData) mockSaveUser.mockResolvedValue({ id: 1, ...userData }) const result = await processUser(userData) expect(mockValidateUser).toHaveBeenCalledWith(userData) expect(mockSaveUser).toHaveBeenCalledWith(userData) expect(result).toEqual({ id: 1, ...userData }) }) test(\u0026#39;should handle validation errors\u0026#39;, async () =\u0026gt; { const userData = { name: \u0026#39;\u0026#39;, email: \u0026#39;invalid-email\u0026#39; } mockValidateUser.mockRejectedValue(new Error(\u0026#39;Invalid user data\u0026#39;)) await expect(processUser(userData)).rejects.toThrow(\u0026#39;Invalid user data\u0026#39;) }) }) 3. æµ‹è¯•å¹¶å‘æ§åˆ¶ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 // æµ‹è¯•å¹¶å‘é™åˆ¶å™¨ describe(\u0026#39;ConcurrencyLimiter\u0026#39;, () =\u0026gt; { let limiter let executionCount = 0 beforeEach(() =\u0026gt; { limiter = new ConcurrencyLimiter(2) executionCount = 0 }) test(\u0026#39;should limit concurrent execution\u0026#39;, async () =\u0026gt; { const task = jest.fn().mockImplementation(async () =\u0026gt; { executionCount++ await new Promise(resolve =\u0026gt; setTimeout(resolve, 100)) return executionCount }) const promises = [ limiter.execute(task), limiter.execute(task), limiter.execute(task), limiter.execute(task), limiter.execute(task) ] const results = await Promise.all(promises) expect(results).toEqual([1, 2, 3, 4, 5]) expect(task).toHaveBeenCalledTimes(5) }) }) æ€»ç»“ JavaScriptå¼‚æ­¥ç¼–ç¨‹å·²ç»ä»å›è°ƒåœ°ç‹±å‘å±•åˆ°äº†ä¼˜é›…çš„Async/Awaitæ—¶ä»£ã€‚é€šè¿‡æŒæ¡è¿™äº›æœ€ä½³å®è·µï¼Œä½ å¯ä»¥ï¼š\næ ¸å¿ƒè¦ç‚¹ ç†è§£Promiseæœºåˆ¶ï¼šæŒæ¡Promiseçš„ä¸‰ç§çŠ¶æ€å’Œç”Ÿå‘½å‘¨æœŸ åˆç†ä½¿ç”¨Async/Awaitï¼šç®€åŒ–å¼‚æ­¥ä»£ç ï¼Œæé«˜å¯è¯»æ€§ å®Œå–„çš„é”™è¯¯å¤„ç†ï¼šå®ç°å¥å£®çš„é”™è¯¯å¤„ç†æœºåˆ¶ å¹¶å‘æ§åˆ¶ï¼šåˆç†æ§åˆ¶å¹¶å‘æ•°é‡ï¼Œé¿å…èµ„æºè€—å°½ æ€§èƒ½ä¼˜åŒ–ï¼šä½¿ç”¨ç¼“å­˜ã€å»é‡ç­‰æŠ€æœ¯æå‡æ€§èƒ½ å®è·µå»ºè®® ä¼˜å…ˆä½¿ç”¨Async/Awaitè€Œä¸æ˜¯Promiseé“¾ ç»Ÿä¸€é”™è¯¯å¤„ç†ç­–ç•¥ å®ç°åˆç†çš„é‡è¯•å’Œè¶…æ—¶æœºåˆ¶ ä½¿ç”¨ç¼“å­˜å‡å°‘ä¸å¿…è¦çš„è¯·æ±‚ å……åˆ†æµ‹è¯•å¼‚æ­¥ä»£ç  JavaScriptå¼‚æ­¥ç¼–ç¨‹æ˜¯ä¸€ä¸ªä¸æ–­å‘å±•çš„é¢†åŸŸï¼Œä¿æŒå­¦ä¹ å’Œå®è·µæ˜¯æŒæ¡å…¶ç²¾é«“çš„å…³é”®ã€‚é€šè¿‡éµå¾ªè¿™äº›æœ€ä½³å®è·µï¼Œä½ å¯ä»¥ç¼–å†™å‡ºæ›´æ¸…æ™°ã€æ›´å¯é ã€æ›´é«˜æ•ˆçš„å¼‚æ­¥ä»£ç ã€‚\n","permalink":"/blog/articles/javascript-async-programming-best-practices/","summary":"æ·±å…¥æ¢è®¨JavaScriptå¼‚æ­¥ç¼–ç¨‹çš„æœ€ä½³å®è·µï¼Œæ¶µç›–å›è°ƒå‡½æ•°ã€Promiseã€Async/Awaitã€é”™è¯¯å¤„ç†ã€å¹¶å‘æ§åˆ¶ç­‰å…³é”®æ¦‚å¿µï¼Œå¸®åŠ©å¼€å‘è€…ç¼–å†™æ›´ä¼˜é›…çš„å¼‚æ­¥ä»£ç ã€‚","title":"JavaScriptå¼‚æ­¥ç¼–ç¨‹æœ€ä½³å®è·µï¼šä»å›è°ƒåˆ°Async/Awaitçš„å®Œæ•´æŒ‡å—"},{"content":"Webpack 5å¸¦æ¥äº†è®¸å¤šæ–°ç‰¹æ€§å’Œæ”¹è¿›ï¼Œä½¿å¾—å‰ç«¯æ„å»ºå·¥å…·é“¾æ›´åŠ å¼ºå¤§å’Œé«˜æ•ˆã€‚æœ¬æ–‡å°†æ·±å…¥æ¢è®¨Webpack 5çš„ç°ä»£åŒ–é…ç½®ï¼Œå¸®åŠ©ä½ ä»é›¶å¼€å§‹æ„å»ºé«˜æ€§èƒ½çš„å‰ç«¯é¡¹ç›®ã€‚\nWebpack 5æ ¸å¿ƒç‰¹æ€§ 1. æ¨¡å—è”é‚¦ (Module Federation) æ¨¡å—è”é‚¦æ˜¯Webpack 5æœ€é‡è¦çš„ç‰¹æ€§ä¹‹ä¸€ï¼Œå…è®¸ä¸åŒåº”ç”¨ä¹‹é—´å…±äº«ä»£ç ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 // webpack.config.js const ModuleFederationPlugin = require(\u0026#39;@module-federation/webpack\u0026#39;) module.exports = { plugins: [ new ModuleFederationPlugin({ name: \u0026#39;shell\u0026#39;, filename: \u0026#39;remoteEntry.js\u0026#39;, remotes: { dashboard: \u0026#39;dashboard@http://localhost:3001/remoteEntry.js\u0026#39;, admin: \u0026#39;admin@http://localhost:3002/remoteEntry.js\u0026#39;, }, shared: { react: { singleton: true, requiredVersion: deps.react }, \u0026#39;react-dom\u0026#39;: { singleton: true, requiredVersion: deps[\u0026#39;react-dom\u0026#39;] }, }, }), ], } 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 // ä½¿ç”¨è¿œç¨‹æ¨¡å— import React, { lazy, Suspense } from \u0026#39;react\u0026#39; const RemoteDashboard = lazy(() =\u0026gt; import(\u0026#39;dashboard/Dashboard\u0026#39;)) const RemoteAdmin = lazy(() =\u0026gt; import(\u0026#39;admin/AdminPanel\u0026#39;)) function App() { return ( \u0026lt;div\u0026gt; \u0026lt;h1\u0026gt;ä¸»åº”ç”¨\u0026lt;/h1\u0026gt; \u0026lt;Suspense fallback=\u0026#34;Loading...\u0026#34;\u0026gt; \u0026lt;RemoteDashboard /\u0026gt; \u0026lt;/Suspense\u0026gt; \u0026lt;Suspense fallback=\u0026#34;Loading...\u0026#34;\u0026gt; \u0026lt;RemoteAdmin /\u0026gt; \u0026lt;/Suspense\u0026gt; \u0026lt;/div\u0026gt; ) } 2. æŒä¹…åŒ–ç¼“å­˜ Webpack 5æ”¹è¿›äº†ç¼“å­˜ç­–ç•¥ï¼Œæä¾›æ›´å¥½çš„é•¿æœŸç¼“å­˜ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 const path = require(\u0026#39;path\u0026#39;) const { CleanWebpackPlugin } = require(\u0026#39;clean-webpack-plugin\u0026#39;) module.exports = { output: { filename: \u0026#39;[name].[contenthash].js\u0026#39;, chunkFilename: \u0026#39;[name].[contenthash].chunk.js\u0026#39;, path: path.resolve(__dirname, \u0026#39;dist\u0026#39;), publicPath: \u0026#39;/\u0026#39;, }, optimization: { moduleIds: \u0026#39;deterministic\u0026#39;, runtimeChunk: \u0026#39;single\u0026#39;, splitChunks: { chunks: \u0026#39;all\u0026#39;, cacheGroups: { vendor: { test: /[\\\\/]node_modules[\\\\/]/, name: \u0026#39;vendors\u0026#39;, chunks: \u0026#39;all\u0026#39;, }, }, }, }, plugins: [ new CleanWebpackPlugin(), ], } 3. Asset Modules Webpack 5å¼•å…¥äº†Asset Modulesï¼Œæ›¿ä»£äº†file-loaderå’Œurl-loaderï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 module.exports = { module: { rules: [ { test: /\\.(png|jpe?g|gif|svg|webp)$/i, type: \u0026#39;asset\u0026#39;, parser: { dataUrlCondition: { maxSize: 8 * 1024, // 8kb }, }, generator: { filename: \u0026#39;images/[name].[hash][ext]\u0026#39;, }, }, { test: /\\.(woff2?|eot|ttf|otf)$/i, type: \u0026#39;asset/resource\u0026#39;, generator: { filename: \u0026#39;fonts/[name].[hash][ext]\u0026#39;, }, }, ], }, } åŸºç¡€é…ç½®è¯¦è§£ 1. å…¥å£å’Œè¾“å‡ºé…ç½® 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 // webpack.config.js const path = require(\u0026#39;path\u0026#39;) module.exports = { // å…¥å£é…ç½® entry: { main: \u0026#39;./src/index.js\u0026#39;, vendor: [\u0026#39;react\u0026#39;, \u0026#39;react-dom\u0026#39;], polyfills: \u0026#39;./src/polyfills.js\u0026#39;, }, // è¾“å‡ºé…ç½® output: { filename: \u0026#39;[name].[contenthash:8].js\u0026#39;, chunkFilename: \u0026#39;[name].[contenthash:8].chunk.js\u0026#39;, path: path.resolve(__dirname, \u0026#39;dist\u0026#39;), publicPath: \u0026#39;/\u0026#39;, clean: true, // Webpack 5æ–°ç‰¹æ€§ï¼šè‡ªåŠ¨æ¸…ç†è¾“å‡ºç›®å½• }, // è§£æé…ç½® resolve: { extensions: [\u0026#39;.js\u0026#39;, \u0026#39;.jsx\u0026#39;, \u0026#39;.ts\u0026#39;, \u0026#39;.tsx\u0026#39;, \u0026#39;.json\u0026#39;], alias: { \u0026#39;@\u0026#39;: path.resolve(__dirname, \u0026#39;src\u0026#39;), \u0026#39;@components\u0026#39;: path.resolve(__dirname, \u0026#39;src/components\u0026#39;), \u0026#39;@utils\u0026#39;: path.resolve(__dirname, \u0026#39;src/utils\u0026#39;), }, modules: [\u0026#39;node_modules\u0026#39;], }, } 2. Loaderé…ç½® 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 module.exports = { module: { rules: [ // JavaScript/TypeScript { test: /\\.(js|jsx|ts|tsx)$/, exclude: /node_modules/, use: { loader: \u0026#39;babel-loader\u0026#39;, options: { cacheDirectory: true, presets: [ [\u0026#39;@babel/preset-env\u0026#39;, { targets: { browsers: [\u0026#39;\u0026gt; 1%\u0026#39;, \u0026#39;last 2 versions\u0026#39;, \u0026#39;not dead\u0026#39;], }, useBuiltIns: \u0026#39;usage\u0026#39;, corejs: 3, }], \u0026#39;@babel/preset-react\u0026#39;, \u0026#39;@babel/preset-typescript\u0026#39;, ], plugins: [ \u0026#39;@babel/plugin-proposal-class-properties\u0026#39;, \u0026#39;@babel/plugin-proposal-object-rest-spread\u0026#39;, ], }, }, }, // CSS { test: /\\.css$/, use: [ \u0026#39;style-loader\u0026#39;, \u0026#39;css-loader\u0026#39;, { loader: \u0026#39;postcss-loader\u0026#39;, options: { postcssOptions: { plugins: [ require(\u0026#39;autoprefixer\u0026#39;), require(\u0026#39;cssnano\u0026#39;)({ preset: \u0026#39;default\u0026#39;, }), ], }, }, }, ], }, // SCSS/SASS { test: /\\.(scss|sass)$/, use: [ \u0026#39;style-loader\u0026#39;, \u0026#39;css-loader\u0026#39;, \u0026#39;sass-loader\u0026#39;, { loader: \u0026#39;postcss-loader\u0026#39;, options: { postcssOptions: { plugins: [ require(\u0026#39;autoprefixer\u0026#39;), ], }, }, }, ], }, // å›¾ç‰‡èµ„æº { test: /\\.(png|jpe?g|gif|svg|webp)$/i, type: \u0026#39;asset\u0026#39;, parser: { dataUrlCondition: { maxSize: 10 * 1024, // 10kb }, }, generator: { filename: \u0026#39;images/[name].[contenthash:8][ext]\u0026#39;, }, }, ], }, } 3. å¼€å‘æœåŠ¡å™¨é…ç½® 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 const webpack = require(\u0026#39;webpack\u0026#39;) module.exports = { devServer: { port: 3000, hot: true, open: true, historyApiFallback: true, compress: true, client: { overlay: { errors: true, warnings: false, }, progress: true, }, proxy: { \u0026#39;/api\u0026#39;: { target: \u0026#39;http://localhost:8080\u0026#39;, changeOrigin: true, pathRewrite: { \u0026#39;^/api\u0026#39;: \u0026#39;\u0026#39;, }, }, }, }, // å¼€å‘æ¨¡å¼ä¸‹çš„Source Map devtool: \u0026#39;eval-cheap-module-source-map\u0026#39;, // å¼€å‘æ¨¡å¼ä¸‹çš„ä¼˜åŒ– mode: \u0026#39;development\u0026#39;, optimization: { moduleIds: \u0026#39;named\u0026#39;, chunkIds: \u0026#39;named\u0026#39;, minimize: false, }, } ç”Ÿäº§ç¯å¢ƒä¼˜åŒ– 1. ä»£ç åˆ†å‰²å’Œä¼˜åŒ– 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 const TerserPlugin = require(\u0026#39;terser-webpack-plugin\u0026#39;) module.exports = { mode: \u0026#39;production\u0026#39;, optimization: { minimize: true, minimizer: [ new TerserPlugin({ terserOptions: { compress: { drop_console: true, drop_debugger: true, pure_funcs: [\u0026#39;console.log\u0026#39;, \u0026#39;console.info\u0026#39;], }, mangle: true, format: { comments: false, }, }, extractComments: false, }), ], splitChunks: { chunks: \u0026#39;all\u0026#39;, minSize: 20000, maxSize: 244000, minChunks: 1, maxAsyncRequests: 30, maxInitialRequests: 30, automaticNameDelimiter: \u0026#39;~\u0026#39;, cacheGroups: { vendors: { test: /[\\\\/]node_modules[\\\\/]/, priority: -10, reuseExistingChunk: true, }, default: { minChunks: 2, priority: -20, reuseExistingChunk: true, }, }, }, runtimeChunk: { name: \u0026#39;runtime\u0026#39;, }, moduleIds: \u0026#39;deterministic\u0026#39;, }, // ç”Ÿäº§ç¯å¢ƒSource Map devtool: \u0026#39;hidden-source-map\u0026#39;, } 2. Tree Shakingé…ç½® 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 // package.json { \u0026#34;sideEffects\u0026#34;: [ \u0026#34;*.css\u0026#34;, \u0026#34;*.scss\u0026#34;, \u0026#34;./src/index.js\u0026#34; ] } // webpack.config.js module.exports = { mode: \u0026#39;production\u0026#39;, optimization: { usedExports: true, sideEffects: false, }, } 3. ç¯å¢ƒå˜é‡ç®¡ç† 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 const webpack = require(\u0026#39;webpack\u0026#39;) module.exports = (env, argv) =\u0026gt; { const isProduction = argv.mode === \u0026#39;production\u0026#39; return { plugins: [ new webpack.DefinePlugin({ \u0026#39;process.env.NODE_ENV\u0026#39;: JSON.stringify(isProduction ? \u0026#39;production\u0026#39; : \u0026#39;development\u0026#39;), \u0026#39;process.env.API_URL\u0026#39;: JSON.stringify( isProduction ? \u0026#39;https://api.production.com\u0026#39; : \u0026#39;http://localhost:8080\u0026#39; ), }), ], } } é«˜çº§é…ç½®æŠ€å·§ 1. å¤šé¡µé¢åº”ç”¨é…ç½® 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 const HtmlWebpackPlugin = require(\u0026#39;html-webpack-plugin\u0026#39;) const path = require(\u0026#39;path\u0026#39;) const pages = [ { template: \u0026#39;./src/index.html\u0026#39;, filename: \u0026#39;index.html\u0026#39;, chunks: [\u0026#39;main\u0026#39;, \u0026#39;vendor\u0026#39;, \u0026#39;polyfills\u0026#39;], }, { template: \u0026#39;./src/admin.html\u0026#39;, filename: \u0026#39;admin.html\u0026#39;, chunks: [\u0026#39;admin\u0026#39;, \u0026#39;vendor\u0026#39;, \u0026#39;polyfills\u0026#39;], }, { template: \u0026#39;./src/dashboard.html\u0026#39;, filename: \u0026#39;dashboard.html\u0026#39;, chunks: [\u0026#39;dashboard\u0026#39;, \u0026#39;vendor\u0026#39;, \u0026#39;polyfills\u0026#39;], }, ] const entry = {} const htmlPlugins = [] pages.forEach(page =\u0026gt; { const { template, filename, chunks } = page const name = path.basename(filename, \u0026#39;.html\u0026#39;) entry[name] = `./src/${name}.js` htmlPlugins.push( new HtmlWebpackPlugin({ template, filename, chunks, minify: { removeComments: true, collapseWhitespace: true, removeRedundantAttributes: true, useShortDoctype: true, removeEmptyAttributes: true, removeStyleLinkTypeAttributes: true, keepClosingSlash: true, minifyJS: true, minifyCSS: true, minifyURLs: true, }, }) ) }) module.exports = { entry, plugins: [...htmlPlugins], } 2. TypeScripté›†æˆ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 // tsconfig.json { \u0026#34;compilerOptions\u0026#34;: { \u0026#34;target\u0026#34;: \u0026#34;ES2020\u0026#34;, \u0026#34;lib\u0026#34;: [\u0026#34;DOM\u0026#34;, \u0026#34;DOM.Iterable\u0026#34;, \u0026#34;ES6\u0026#34;], \u0026#34;allowJs\u0026#34;: true, \u0026#34;skipLibCheck\u0026#34;: true, \u0026#34;esModuleInterop\u0026#34;: true, \u0026#34;allowSyntheticDefaultImports\u0026#34;: true, \u0026#34;strict\u0026#34;: true, \u0026#34;forceConsistentCasingInFileNames\u0026#34;: true, \u0026#34;moduleResolution\u0026#34;: \u0026#34;node\u0026#34;, \u0026#34;resolveJsonModule\u0026#34;: true, \u0026#34;isolatedModules\u0026#34;: true, \u0026#34;noEmit\u0026#34;: true, \u0026#34;jsx\u0026#34;: \u0026#34;react-jsx\u0026#34; }, \u0026#34;include\u0026#34;: [ \u0026#34;src\u0026#34; ], \u0026#34;exclude\u0026#34;: [ \u0026#34;node_modules\u0026#34; ] } // webpack.config.js module.exports = { resolve: { extensions: [\u0026#39;.tsx\u0026#39;, \u0026#39;.ts\u0026#39;, \u0026#39;.js\u0026#39;, \u0026#39;.jsx\u0026#39;], }, module: { rules: [ { test: /\\.tsx?$/, exclude: /node_modules/, use: [ { loader: \u0026#39;babel-loader\u0026#39;, options: { presets: [ [\u0026#39;@babel/preset-env\u0026#39;, { targets: \u0026#39;defaults\u0026#39; }], \u0026#39;@babel/preset-react\u0026#39;, \u0026#39;@babel/preset-typescript\u0026#39;, ], }, }, { loader: \u0026#39;ts-loader\u0026#39;, options: { transpileOnly: true, }, }, ], }, ], }, } 3. CSS Moduleså’ŒCSS-in-JS 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 module.exports = { module: { rules: [ // CSS Modules { test: /\\.module\\.css$/, use: [ \u0026#39;style-loader\u0026#39;, { loader: \u0026#39;css-loader\u0026#39;, options: { modules: { localIdentName: \u0026#39;[name]__[local]--[hash:base64:5]\u0026#39;, }, }, }, \u0026#39;postcss-loader\u0026#39;, ], }, // SCSS Modules { test: /\\.module\\.scss$/, use: [ \u0026#39;style-loader\u0026#39;, { loader: \u0026#39;css-loader\u0026#39;, options: { modules: { localIdentName: \u0026#39;[name]__[local]--[hash:base64:5]\u0026#39;, }, }, }, \u0026#39;postcss-loader\u0026#39;, \u0026#39;sass-loader\u0026#39;, ], }, // CSS-in-JS (styled-components) { test: /\\.(js|jsx|ts|tsx)$/, exclude: /node_modules/, use: [ { loader: \u0026#39;babel-loader\u0026#39;, options: { plugins: [\u0026#39;styled-components\u0026#39;], }, }, ], }, ], }, } æ€§èƒ½ä¼˜åŒ–ç­–ç•¥ 1. ç¼“å­˜ä¼˜åŒ– 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 const HtmlWebpackPlugin = require(\u0026#39;html-webpack-plugin\u0026#39;) const MiniCssExtractPlugin = require(\u0026#39;mini-css-extract-plugin\u0026#39;) module.exports = { output: { filename: \u0026#39;[name].[contenthash:8].js\u0026#39;, chunkFilename: \u0026#39;[name].[contenthash:8].chunk.js\u0026#39;, }, plugins: [ new MiniCssExtractPlugin({ filename: \u0026#39;[name].[contenthash:8].css\u0026#39;, chunkFilename: \u0026#39;[name].[contenthash:8].chunk.css\u0026#39;, }), new HtmlWebpackPlugin({ template: \u0026#39;./src/index.html\u0026#39;, filename: \u0026#39;index.html\u0026#39;, minify: { removeComments: true, collapseWhitespace: true, removeRedundantAttributes: true, useShortDoctype: true, removeEmptyAttributes: true, removeStyleLinkTypeAttributes: true, keepClosingSlash: true, minifyJS: true, minifyCSS: true, minifyURLs: true, }, }), ], optimization: { splitChunks: { cacheGroups: { styles: { name: \u0026#39;styles\u0026#39;, test: /\\.(css|scss|sass|less|styl)$/, chunks: \u0026#39;all\u0026#39;, enforce: true, }, commons: { name: \u0026#39;commons\u0026#39;, chunks: \u0026#39;initial\u0026#39;, minChunks: 2, }, }, }, moduleIds: \u0026#39;deterministic\u0026#39;, runtimeChunk: \u0026#39;single\u0026#39;, }, } 2. Bundleåˆ†æ 1 2 3 4 5 6 7 8 9 10 11 const BundleAnalyzerPlugin = require(\u0026#39;webpack-bundle-analyzer\u0026#39;).BundleAnalyzerPlugin module.exports = { plugins: [ process.env.ANALYZE \u0026amp;\u0026amp; new BundleAnalyzerPlugin({ analyzerMode: \u0026#39;static\u0026#39;, openAnalyzer: false, reportFilename: \u0026#39;bundle-report.html\u0026#39;, }), ], } 3. Preloadå’ŒPrefetch 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 const PreloadWebpackPlugin = require(\u0026#39;@vue/preload-webpack-plugin\u0026#39;) module.exports = { plugins: [ new PreloadWebpackPlugin({ rel: \u0026#39;preload\u0026#39;, include: \u0026#39;asyncChunks\u0026#39;, }), new PreloadWebpackPlugin({ rel: \u0026#39;prefetch\u0026#39;, include: \u0026#39;asyncChunks\u0026#39;, }), ], } å¼€å‘ä½“éªŒä¼˜åŒ– 1. å¿«é€Ÿåˆ·æ–°é…ç½® 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 const ReactRefreshWebpackPlugin = require(\u0026#39;@pmmmwh/react-refresh-webpack-plugin\u0026#39;) module.exports = { mode: \u0026#39;development\u0026#39;, devServer: { hot: true, }, plugins: [ new webpack.HotModuleReplacementPlugin(), new ReactRefreshWebpackPlugin(), ], resolve: { alias: { \u0026#39;react-dom\u0026#39;: \u0026#39;@hot-loader/react-dom\u0026#39;, }, }, } 2. é”™è¯¯å¤„ç†å’Œè¯Šæ–­ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 const ErrorOverlayPlugin = require(\u0026#39;error-overlay-webpack-plugin\u0026#39;) module.exports = { mode: \u0026#39;development\u0026#39;, plugins: [ new ErrorOverlayPlugin(), ], stats: { errorDetails: true, warnings: true, modules: true, reasons: true, usedExports: true, providedExports: true, optimizationBailout: true, }, } 3. æ„å»ºè¿›åº¦æ˜¾ç¤º 1 2 3 4 5 6 7 8 9 10 11 const webpack = require(\u0026#39;webpack\u0026#39;) const { CleanWebpackPlugin } = require(\u0026#39;clean-webpack-plugin\u0026#39;) module.exports = { plugins: [ new webpack.ProgressPlugin((percentage, message) =\u0026gt; { console.log(`${Math.round(percentage)}%`, message) }), new CleanWebpackPlugin(), ], } å®Œæ•´é…ç½®ç¤ºä¾‹ 1. åŸºç¡€é…ç½®æ–‡ä»¶ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 // webpack.config.js const path = require(\u0026#39;path\u0026#39;) const HtmlWebpackPlugin = require(\u0026#39;html-webpack-plugin\u0026#39;) const { CleanWebpackPlugin } = require(\u0026#39;clean-webpack-plugin\u0026#39;) module.exports = { entry: { main: \u0026#39;./src/index.js\u0026#39;, }, output: { filename: \u0026#39;[name].[contenthash:8].js\u0026#39;, path: path.resolve(__dirname, \u0026#39;dist\u0026#39;), publicPath: \u0026#39;/\u0026#39;, clean: true, }, module: { rules: [ { test: /\\.(js|jsx)$/, exclude: /node_modules/, use: { loader: \u0026#39;babel-loader\u0026#39;, options: { cacheDirectory: true, presets: [ [\u0026#39;@babel/preset-env\u0026#39;, { targets: \u0026#39;\u0026gt; 1%, last 2 versions, not dead\u0026#39;, useBuiltIns: \u0026#39;usage\u0026#39;, corejs: 3, }], \u0026#39;@babel/preset-react\u0026#39;, ], }, }, }, { test: /\\.css$/, use: [\u0026#39;style-loader\u0026#39;, \u0026#39;css-loader\u0026#39;], }, { test: /\\.(png|jpe?g|gif|svg)$/i, type: \u0026#39;asset\u0026#39;, generator: { filename: \u0026#39;images/[name].[hash][ext]\u0026#39;, }, }, ], }, plugins: [ new HtmlWebpackPlugin({ template: \u0026#39;./src/index.html\u0026#39;, }), new CleanWebpackPlugin(), ], resolve: { extensions: [\u0026#39;.js\u0026#39;, \u0026#39;.jsx\u0026#39;], alias: { \u0026#39;@\u0026#39;: path.resolve(__dirname, \u0026#39;src\u0026#39;), }, }, } 2. å¼€å‘ç¯å¢ƒé…ç½® 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 // webpack.dev.js const { merge } = require(\u0026#39;webpack-merge\u0026#39;) const common = require(\u0026#39;./webpack.config.js\u0026#39;) module.exports = merge(common, { mode: \u0026#39;development\u0026#39;, devtool: \u0026#39;eval-cheap-module-source-map\u0026#39;, devServer: { port: 3000, hot: true, open: true, historyApiFallback: true, client: { overlay: true, }, }, }) 3. ç”Ÿäº§ç¯å¢ƒé…ç½® 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 // webpack.prod.js const { merge } = require(\u0026#39;webpack-merge\u0026#39;) const TerserPlugin = require(\u0026#39;terser-webpack-plugin\u0026#39;) const common = require(\u0026#39;./webpack.config.js\u0026#39;) module.exports = merge(common, { mode: \u0026#39;production\u0026#39;, devtool: \u0026#39;hidden-source-map\u0026#39;, optimization: { minimize: true, minimizer: [ new TerserPlugin({ terserOptions: { compress: { drop_console: true, }, }, }), ], splitChunks: { chunks: \u0026#39;all\u0026#39;, cacheGroups: { vendor: { test: /[\\\\/]node_modules[\\\\/]/, name: \u0026#39;vendors\u0026#39;, chunks: \u0026#39;all\u0026#39;, }, }, }, runtimeChunk: \u0026#39;single\u0026#39;, }, }) 4. TypeScripté…ç½® 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 // webpack.typescript.js const { merge } = require(\u0026#39;webpack-merge\u0026#39;) const common = require(\u0026#39;./webpack.config.js\u0026#39;) module.exports = merge(common, { resolve: { extensions: [\u0026#39;.tsx\u0026#39;, \u0026#39;.ts\u0026#39;, \u0026#39;.js\u0026#39;, \u0026#39;.jsx\u0026#39;], }, module: { rules: [ { test: /\\.tsx?$/, exclude: /node_modules/, use: [ { loader: \u0026#39;babel-loader\u0026#39;, options: { presets: [ [\u0026#39;@babel/preset-env\u0026#39;, { targets: \u0026#39;defaults\u0026#39; }], \u0026#39;@babel/preset-react\u0026#39;, \u0026#39;@babel/preset-typescript\u0026#39;, ], }, }, { loader: \u0026#39;ts-loader\u0026#39;, options: { transpileOnly: true, }, }, ], }, ], }, }) æ€»ç»“ Webpack 5ä¸ºå‰ç«¯æ„å»ºå·¥å…·é“¾å¸¦æ¥äº†è®¸å¤šé‡è¦çš„æ”¹è¿›å’Œæ–°ç‰¹æ€§ï¼š\næ ¸å¿ƒæ”¹è¿› æ¨¡å—è”é‚¦ï¼šå®ç°åº”ç”¨é—´çš„ä»£ç å…±äº« æŒä¹…åŒ–ç¼“å­˜ï¼šæ›´å¥½çš„é•¿æœŸç¼“å­˜ç­–ç•¥ Asset Modulesï¼šç»Ÿä¸€çš„èµ„æºå¤„ç†æ–¹å¼ æ€§èƒ½ä¼˜åŒ–ï¼šæ›´å¿«çš„æ„å»ºé€Ÿåº¦å’Œæ›´å°çš„åŒ…ä½“ç§¯ æœ€ä½³å®è·µ åˆç†é…ç½®ä»£ç åˆ†å‰² ä¼˜åŒ–ç¼“å­˜ç­–ç•¥ å……åˆ†åˆ©ç”¨Tree Shaking ä½¿ç”¨æ¨¡å—è”é‚¦å®ç°å¾®å‰ç«¯æ¶æ„ æ³¨é‡å¼€å‘ä½“éªŒå’Œé”™è¯¯è¯Šæ–­ é€šè¿‡æ·±å…¥ç†è§£å’Œåˆç†é…ç½®Webpack 5ï¼Œä½ å¯ä»¥æ„å»ºå‡ºé«˜æ•ˆã€å¯é çš„å‰ç«¯å·¥å…·é“¾ï¼Œä¸ºé¡¹ç›®çš„å¼€å‘å’Œéƒ¨ç½²æä¾›å¼ºæœ‰åŠ›çš„æ”¯æŒã€‚è®°ä½ï¼Œæ„å»ºå·¥å…·çš„é…ç½®éœ€è¦æ ¹æ®é¡¹ç›®å®é™…éœ€æ±‚è¿›è¡Œè°ƒæ•´å’Œä¼˜åŒ–ã€‚\n","permalink":"/blog/articles/webpack5-modern-frontend-toolchain/","summary":"å…¨é¢ä»‹ç»Webpack 5çš„ç°ä»£åŒ–é…ç½®ï¼Œæ¶µç›–æ¨¡å—è”é‚¦ã€æŒä¹…åŒ–ç¼“å­˜ã€Tree Shakingã€æ€§èƒ½ä¼˜åŒ–ç­‰æ ¸å¿ƒç‰¹æ€§ï¼ŒåŠ©ä½ æ„å»ºé«˜æ•ˆçš„å‰ç«¯å·¥å…·é“¾ã€‚","title":"Webpack 5ç°ä»£åŒ–å‰ç«¯å·¥å…·é“¾é…ç½®ï¼šä»é›¶å¼€å§‹æ„å»ºé«˜æ€§èƒ½é¡¹ç›®"},{"content":"React Hookså½»åº•æ”¹å˜äº†æˆ‘ä»¬ç¼–å†™Reactç»„ä»¶çš„æ–¹å¼ï¼Œè®©å‡½æ•°ç»„ä»¶æ‹¥æœ‰äº†ç±»ç»„ä»¶çš„æ‰€æœ‰èƒ½åŠ›ï¼ŒåŒæ—¶è¿˜å¸¦æ¥äº†æ›´ç®€æ´çš„ä»£ç ç»„ç»‡æ–¹å¼å’Œæ›´å¥½çš„é€»è¾‘å¤ç”¨ã€‚æœ¬æ–‡å°†æ·±å…¥æ¢è®¨Hooksçš„å†…éƒ¨åŸç†ã€æœ€ä½³å®è·µå’Œæ€§èƒ½ä¼˜åŒ–ç­–ç•¥ã€‚\nHooksåŸºç¡€å›é¡¾ åŸºæœ¬Hooksç±»å‹ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 import { useState, useEffect, useContext, useReducer, useCallback, useMemo, useRef, useLayoutEffect, useImperativeHandle } from \u0026#39;react\u0026#39; // useState - çŠ¶æ€ç®¡ç† const [count, setCount] = useState(0) // useEffect - å‰¯ä½œç”¨å¤„ç† useEffect(() =\u0026gt; { document.title = `Count: ${count}` return () =\u0026gt; { // æ¸…ç†å‡½æ•° } }, [count]) // useContext - Contextæ¶ˆè´¹ const theme = useContext(ThemeContext) // useReducer - å¤æ‚çŠ¶æ€ç®¡ç† const [state, dispatch] = useReducer(reducer, initialState) // useCallback - å‡½æ•°ç¼“å­˜ const handleClick = useCallback(() =\u0026gt; { setCount(count + 1) }, [count]) // useMemo - å€¼ç¼“å­˜ const expensiveValue = useMemo(() =\u0026gt; { return computeExpensiveValue(count) }, [count]) // useRef - å¼•ç”¨ç®¡ç† const inputRef = useRef(null) // useLayoutEffect - åŒæ­¥å‰¯ä½œç”¨ useLayoutEffect(() =\u0026gt; { // åœ¨DOMæ›´æ–°ååŒæ­¥æ‰§è¡Œ }) // useImperativeHandle - æš´éœ²å®ä¾‹æ–¹æ³• useImperativeHandle(ref, () =\u0026gt; ({ focus: () =\u0026gt; inputRef.current.focus() }), []) Hookså†…éƒ¨åŸç† 1. Hooksçš„æ•°æ®ç»“æ„ Reactä½¿ç”¨é“¾è¡¨æ¥å­˜å‚¨Hooksçš„çŠ¶æ€ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 // ç®€åŒ–çš„Hookså†…éƒ¨å®ç° let currentlyRenderingComponent = null let workInProgressHook = null let currentHook = null // HookèŠ‚ç‚¹ç»“æ„ const hook = { memoizedState: null, // Hookçš„å½“å‰çŠ¶æ€ baseState: null, // åŸºç¡€çŠ¶æ€ baseQueue: null, // åŸºç¡€æ›´æ–°é˜Ÿåˆ— queue: null, // æ›´æ–°é˜Ÿåˆ— next: null // ä¸‹ä¸€ä¸ªHook } // Hookåˆå§‹åŒ– function mountWorkInProgressHook() { const hook = { memoizedState: null, baseState: null, baseQueue: null, queue: null, next: null } if (workInProgressHook === null) { currentlyRenderingComponent.memoizedState = workInProgressHook = hook } else { workInProgressHook = workInProgressHook.next = hook } return workInProgressHook } // Hookæ›´æ–° function updateWorkInProgressHook() { let nextCurrentHook if (currentHook === null) { const current = currentlyRenderingComponent.alternate.memoizedState nextCurrentHook = current.next } else { nextCurrentHook = currentHook.next } let nextWorkInProgressHook if (workInProgressHook === null) { nextWorkInProgressHook = currentlyRenderingComponent.memoizedState } else { nextWorkInProgressHook = workInProgressHook.next } if (nextWorkInProgressHook !== null) { workInProgressHook = nextWorkInProgressHook nextWorkInProgressHook = createHook(nextCurrentHook) } else { // æ²¡æœ‰å¯¹åº”çš„Hookï¼Œå¯èƒ½æ˜¯æ–°å¢çš„Hook workInProgressHook = createHook(null) } currentHook = nextCurrentHook return workInProgressHook } 2. useStateçš„å®ç°åŸç† 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 // useStateçš„ç®€åŒ–å®ç° function useState(initialState) { return useReducer( (state, action) =\u0026gt; { return typeof action === \u0026#39;function\u0026#39; ? action(state) : action }, typeof initialState === \u0026#39;function\u0026#39; ? initialState() : initialState ) } // useReducerçš„ç®€åŒ–å®ç° function useReducer(reducer, initialState, init) { const hook = updateWorkInProgressHook() const queue = hook.queue // æ‰§è¡Œæ›´æ–°é˜Ÿåˆ— if (numberOfLanes \u0026gt; 1) { return hook.memoizedState } if (queue !== null) { let newState = hook.baseState let update = queue.first let didSkip = false while (update !== null) { const action = update.action if (shouldSkipUpdate(update.lane)) { didSkip = true } else { newState = reducer(newState, action) } update = update.next } if (!didSkip) { hook.baseState = newState hook.baseQueue = null } hook.memoizedState = newState } const dispatch = dispatchAction.bind(null, currentlyRenderingComponent, queue) return [hook.memoizedState, dispatch] } function dispatchAction(component, queue, action) { const update = { lane, action, next: null } const pending = queue.pending if (pending === null) { update.next = update } else { update.next = pending.next pending.next = update } queue.pending = update scheduleUpdateOnFiber(component, lane) } 3. useEffectçš„å®ç°åŸç† 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 function useEffect(create, deps) { return mountEffectImpl( UpdateEffect | PassEffect, HookPassive, create, deps ) } function mountEffectImpl(fiberFlags, hookFlags, create, deps) { const hook = mountWorkInProgressHook() const nextDeps = deps === undefined ? null : deps currentlyRenderingComponent.flags |= fiberFlags hook.memoizedState = pushEffect(HookHasEffect | hookFlags, create, undefined, nextDeps) } function pushEffect(tag, create, destroy, deps) { const effect = { tag, create, destroy, deps, next: null } let componentUpdateQueue = currentlyRenderingComponent.updateQueue if (componentUpdateQueue === null) { componentUpdateQueue = createFunctionComponentUpdateQueue() currentlyRenderingComponent.updateQueue = componentUpdateQueue componentUpdateQueue.lastEffect = effect.next = effect } else { const lastEffect = componentUpdateQueue.lastEffect if (lastEffect === null) { componentUpdateQueue.lastEffect = effect.next = effect } else { const firstEffect = lastEffect.next lastEffect.next = effect effect.next = firstEffect componentUpdateQueue.lastEffect = effect } } return effect } è‡ªå®šä¹‰Hookså¼€å‘ 1. åŸºç¡€è‡ªå®šä¹‰Hook 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 // useCounter - è®¡æ•°å™¨Hook function useCounter(initialValue = 0, step = 1) { const [count, setCount] = useState(initialValue) const increment = useCallback(() =\u0026gt; { setCount(prevCount =\u0026gt; prevCount + step) }, [step]) const decrement = useCallback(() =\u0026gt; { setCount(prevCount =\u0026gt; prevCount - step) }, [step]) const reset = useCallback(() =\u0026gt; { setCount(initialValue) }, [initialValue]) return { count, increment, decrement, reset } } // ä½¿ç”¨ç¤ºä¾‹ function Counter() { const { count, increment, decrement, reset } = useCounter(0, 2) return ( \u0026lt;div\u0026gt; \u0026lt;p\u0026gt;Count: {count}\u0026lt;/p\u0026gt; \u0026lt;button onClick={increment}\u0026gt;+2\u0026lt;/button\u0026gt; \u0026lt;button onClick={decrement}\u0026gt;-2\u0026lt;/button\u0026gt; \u0026lt;button onClick={reset}\u0026gt;Reset\u0026lt;/button\u0026gt; \u0026lt;/div\u0026gt; ) } 2. å¤æ‚ä¸šåŠ¡é€»è¾‘Hook 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 // useApi - APIè¯·æ±‚Hook function useApi(url, options = {}) { const [data, setData] = useState(null) const [loading, setLoading] = useState(true) const [error, setError] = useState(null) const fetchData = useCallback(async () =\u0026gt; { try { setLoading(true) setError(null) const response = await fetch(url, options) if (!response.ok) { throw new Error(`HTTP error! status: ${response.status}`) } const result = await response.json() setData(result) } catch (err) { setError(err.message) } finally { setLoading(false) } }, [url, options]) useEffect(() =\u0026gt; { fetchData() }, [fetchData]) const refetch = useCallback(() =\u0026gt; { fetchData() }, [fetchData]) return { data, loading, error, refetch } } // ä½¿ç”¨ç¤ºä¾‹ function UserProfile({ userId }) { const { data: user, loading, error, refetch } = useApi(`/api/users/${userId}`) if (loading) return \u0026lt;div\u0026gt;Loading...\u0026lt;/div\u0026gt; if (error) return \u0026lt;div\u0026gt;Error: {error}\u0026lt;/div\u0026gt; if (!user) return \u0026lt;div\u0026gt;No user found\u0026lt;/div\u0026gt; return ( \u0026lt;div\u0026gt; \u0026lt;h1\u0026gt;{user.name}\u0026lt;/h1\u0026gt; \u0026lt;p\u0026gt;{user.email}\u0026lt;/p\u0026gt; \u0026lt;button onClick={refetch}\u0026gt;Refresh\u0026lt;/button\u0026gt; \u0026lt;/div\u0026gt; ) } 3. localStorageåŒæ­¥Hook 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 // useLocalStorage - localStorageåŒæ­¥Hook function useLocalStorage(key, initialValue) { // è·å–åˆå§‹å€¼ const [storedValue, setStoredValue] = useState(() =\u0026gt; { try { const item = window.localStorage.getItem(key) return item ? JSON.parse(item) : initialValue } catch (error) { console.error(`Error reading localStorage key \u0026#34;${key}\u0026#34;:`, error) return initialValue } }) // è®¾ç½®å€¼åˆ°localStorageå’Œstate const setValue = useCallback((value) =\u0026gt; { try { const valueToStore = value instanceof Function ? value(storedValue) : value setStoredValue(valueToStore) window.localStorage.setItem(key, JSON.stringify(valueToStore)) } catch (error) { console.error(`Error setting localStorage key \u0026#34;${key}\u0026#34;:`, error) } }, [key, storedValue]) // ç›‘å¬å…¶ä»–tabçš„å˜åŒ– useEffect(() =\u0026gt; { const handleStorageChange = (e) =\u0026gt; { if (e.key === key) { try { setStoredValue(JSON.parse(e.newValue)) } catch (error) { console.error(`Error parsing storage value for key \u0026#34;${key}\u0026#34;:`, error) } } } window.addEventListener(\u0026#39;storage\u0026#39;, handleStorageChange) return () =\u0026gt; window.removeEventListener(\u0026#39;storage\u0026#39;, handleStorageChange) }, [key]) return [storedValue, setValue] } // ä½¿ç”¨ç¤ºä¾‹ function Settings() { const [theme, setTheme] = useLocalStorage(\u0026#39;theme\u0026#39;, \u0026#39;light\u0026#39;) const [language, setLanguage] = useLocalStorage(\u0026#39;language\u0026#39;, \u0026#39;en\u0026#39;) return ( \u0026lt;div\u0026gt; \u0026lt;select value={theme} onChange={(e) =\u0026gt; setTheme(e.target.value)}\u0026gt; \u0026lt;option value=\u0026#34;light\u0026#34;\u0026gt;Light\u0026lt;/option\u0026gt; \u0026lt;option value=\u0026#34;dark\u0026#34;\u0026gt;Dark\u0026lt;/option\u0026gt; \u0026lt;/select\u0026gt; \u0026lt;select value={language} onChange={(e) =\u0026gt; setLanguage(e.target.value)}\u0026gt; \u0026lt;option value=\u0026#34;en\u0026#34;\u0026gt;English\u0026lt;/option\u0026gt; \u0026lt;option value=\u0026#34;zh\u0026#34;\u0026gt;ä¸­æ–‡\u0026lt;/option\u0026gt; \u0026lt;/select\u0026gt; \u0026lt;/div\u0026gt; ) } 4. é˜²æŠ–Hook 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 // useDebounce - é˜²æŠ–Hook function useDebounce(value, delay) { const [debouncedValue, setDebouncedValue] = useState(value) useEffect(() =\u0026gt; { const handler = setTimeout(() =\u0026gt; { setDebouncedValue(value) }, delay) return () =\u0026gt; { clearTimeout(handler) } }, [value, delay]) return debouncedValue } // useDebouncedCallback - é˜²æŠ–å›è°ƒHook function useDebouncedCallback(callback, delay, deps = []) { const callbackRef = useRef(callback) const timeoutRef = useRef(null) useEffect(() =\u0026gt; { callbackRef.current = callback }, [callback]) return useCallback((...args) =\u0026gt; { if (timeoutRef.current) { clearTimeout(timeoutRef.current) } timeoutRef.current = setTimeout(() =\u0026gt; { callbackRef.current(...args) }, delay) }, [delay, ...deps]) } // ä½¿ç”¨ç¤ºä¾‹ function SearchInput() { const [searchTerm, setSearchTerm] = useState(\u0026#39;\u0026#39;) const debouncedSearchTerm = useDebounce(searchTerm, 500) const handleSearch = useDebouncedCallback((term) =\u0026gt; { // æ‰§è¡Œæœç´¢APIè°ƒç”¨ console.log(\u0026#39;Searching for:\u0026#39;, term) }, 500) useEffect(() =\u0026gt; { if (debouncedSearchTerm) { handleSearch(debouncedSearchTerm) } }, [debouncedSearchTerm, handleSearch]) return ( \u0026lt;input type=\u0026#34;text\u0026#34; value={searchTerm} onChange={(e) =\u0026gt; setSearchTerm(e.target.value)} placeholder=\u0026#34;Search...\u0026#34; /\u0026gt; ) } æ€§èƒ½ä¼˜åŒ–ç­–ç•¥ 1. useCallbackå’ŒuseMemoçš„æ­£ç¡®ä½¿ç”¨ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 // âŒ è¿‡åº¦ä½¿ç”¨useCallback function BadExample({ items, onItemClick }) { const handleClick = useCallback((item) =\u0026gt; { onItemClick(item.id) }, [onItemClick]) // æ¯æ¬¡onItemClickå˜åŒ–éƒ½åˆ›å»ºæ–°å‡½æ•° return ( \u0026lt;ul\u0026gt; {items.map(item =\u0026gt; ( \u0026lt;li key={item.id} onClick={() =\u0026gt; handleClick(item)}\u0026gt; {item.name} \u0026lt;/li\u0026gt; ))} \u0026lt;/ul\u0026gt; ) } // âœ… åˆç†ä½¿ç”¨useCallback function GoodExample({ items, onItemClick }) { const handleClick = useCallback((itemId) =\u0026gt; { onItemClick(itemId) }, [onItemClick]) return ( \u0026lt;ul\u0026gt; {items.map(item =\u0026gt; ( \u0026lt;Item key={item.id} item={item} onClick={handleClick} /\u0026gt; ))} \u0026lt;/ul\u0026gt; ) } // å­ç»„ä»¶ const Item = React.memo(({ item, onClick }) =\u0026gt; ( \u0026lt;li onClick={() =\u0026gt; onClick(item.id)}\u0026gt; {item.name} \u0026lt;/li\u0026gt; )) 2. çŠ¶æ€ä¼˜åŒ–ç­–ç•¥ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 // âŒ ä¸å¿…è¦çš„çŠ¶æ€åˆ†ç¦» function BadCounter() { const [count, setCount] = useState(0) const [double, setDouble] = useState(0) useEffect(() =\u0026gt; { setDouble(count * 2) }, [count]) return ( \u0026lt;div\u0026gt; \u0026lt;p\u0026gt;Count: {count}\u0026lt;/p\u0026gt; \u0026lt;p\u0026gt;Double: {double}\u0026lt;/p\u0026gt; \u0026lt;/div\u0026gt; ) } // âœ… ä½¿ç”¨æ´¾ç”ŸçŠ¶æ€ function GoodCounter() { const [count, setCount] = useState(0) const double = useMemo(() =\u0026gt; count * 2, [count]) return ( \u0026lt;div\u0026gt; \u0026lt;p\u0026gt;Count: {count}\u0026lt;/p\u0026gt; \u0026lt;p\u0026gt;Double: {double}\u0026lt;/p\u0026gt; \u0026lt;/div\u0026gt; ) } // âœ… å¤æ‚çŠ¶æ€çš„ä¼˜åŒ– function useComplexState(initialState) { const [state, setState] = useState(initialState) const updateState = useCallback((updater) =\u0026gt; { setState(prevState =\u0026gt; { const newState = typeof updater === \u0026#39;function\u0026#39; ? updater(prevState) : updater return { ...prevState, ...newState } }) }, []) return [state, updateState] } 3. ç»„ä»¶æ¸²æŸ“ä¼˜åŒ– 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 // âœ… ä½¿ç”¨React.memoä¼˜åŒ–å‡½æ•°ç»„ä»¶ const ExpensiveComponent = React.memo(({ data, onUpdate }) =\u0026gt; { return ( \u0026lt;div\u0026gt; {data.map(item =\u0026gt; ( \u0026lt;div key={item.id}\u0026gt;{item.name}\u0026lt;/div\u0026gt; ))} \u0026lt;/div\u0026gt; ) }, (prevProps, nextProps) =\u0026gt; { // è‡ªå®šä¹‰æ¯”è¾ƒå‡½æ•° return prevProps.data.length === nextProps.data.length }) // âœ… ä½¿ç”¨useMemoç¼“å­˜å¤æ‚è®¡ç®— function DataProcessor({ items }) { const processedData = useMemo(() =\u0026gt; { return items .filter(item =\u0026gt; item.active) .map(item =\u0026gt; ({ ...item, value: complexCalculation(item) })) .sort((a, b) =\u0026gt; a.value - b.value) }, [items]) return \u0026lt;DataList data={processedData} /\u0026gt; } // âœ… ä½¿ç”¨useRefé¿å…ä¸å¿…è¦çš„é‡æ–°æ¸²æŸ“ function Timer() { const [count, setCount] = useState(0) const intervalRef = useRef(null) useEffect(() =\u0026gt; { intervalRef.current = setInterval(() =\u0026gt; { setCount(c =\u0026gt; c + 1) }, 1000) return () =\u0026gt; { if (intervalRef.current) { clearInterval(intervalRef.current) } } }, []) return \u0026lt;div\u0026gt;Count: {count}\u0026lt;/div\u0026gt; } å¸¸è§é™·é˜±å’Œè§£å†³æ–¹æ¡ˆ 1. Hooksè°ƒç”¨è§„åˆ™ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 // âŒ åœ¨æ¡ä»¶è¯­å¥ä¸­è°ƒç”¨Hook function BadComponent({ condition }) { if (condition) { const [state, setState] = useState(0) // é”™è¯¯ï¼ } useEffect(() =\u0026gt; { // ... }, []) // é”™è¯¯ï¼Hookè°ƒç”¨é¡ºåºä¸ç¨³å®š return \u0026lt;div\u0026gt;Bad Component\u0026lt;/div\u0026gt; } // âœ… æ­£ç¡®çš„Hookè°ƒç”¨ function GoodComponent({ condition }) { const [state, setState] = useState(0) useEffect(() =\u0026gt; { if (condition) { // åœ¨effectå†…éƒ¨ä½¿ç”¨æ¡ä»¶é€»è¾‘ console.log(\u0026#39;Condition is true\u0026#39;) } }, [condition]) return \u0026lt;div\u0026gt;Good Component\u0026lt;/div\u0026gt; } 2. é—­åŒ…é™·é˜± 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 // âŒ é—­åŒ…é™·é˜± function CounterWithBug() { const [count, setCount] = useState(0) useEffect(() =\u0026gt; { const interval = setInterval(() =\u0026gt; { setCount(count + 1) // æ€»æ˜¯ä»0å¼€å§‹ }, 1000) return () =\u0026gt; clearInterval(interval) }, [count]) // æ¯æ¬¡countå˜åŒ–éƒ½é‡æ–°åˆ›å»ºinterval return \u0026lt;div\u0026gt;Count: {count}\u0026lt;/div\u0026gt; } // âœ… ä½¿ç”¨å‡½æ•°å¼æ›´æ–° function CounterWithFix() { const [count, setCount] = useState(0) useEffect(() =\u0026gt; { const interval = setInterval(() =\u0026gt; { setCount(prevCount =\u0026gt; prevCount + 1) // ä½¿ç”¨å‡½æ•°å¼æ›´æ–° }, 1000) return () =\u0026gt; clearInterval(interval) }, []) // åªåœ¨ç»„ä»¶æŒ‚è½½æ—¶åˆ›å»ºä¸€æ¬¡ return \u0026lt;div\u0026gt;Count: {count}\u0026lt;/div\u0026gt; } // âœ… ä½¿ç”¨useRefå­˜å‚¨å¯å˜å€¼ function CounterWithRef() { const [count, setCount] = useState(0) const countRef = useRef(count) useEffect(() =\u0026gt; { countRef.current = count }) useEffect(() =\u0026gt; { const interval = setInterval(() =\u0026gt; { setCount(countRef.current + 1) }, 1000) return () =\u0026gt; clearInterval(interval) }, []) return \u0026lt;div\u0026gt;Count: {count}\u0026lt;/div\u0026gt; } 3. ä¾èµ–æ•°ç»„é™·é˜± 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 // âŒ ç¼ºå°‘ä¾èµ–é¡¹ function BadExample({ id }) { const [data, setData] = useState(null) useEffect(() =\u0026gt; { fetchData(id).then(setData) }, []) // ç¼ºå°‘idä¾èµ–ï¼Œå½“idå˜åŒ–æ—¶ä¸ä¼šé‡æ–°è·å–æ•°æ® return \u0026lt;div\u0026gt;{data?.name}\u0026lt;/div\u0026gt; } // âœ… æ­£ç¡®çš„ä¾èµ–é¡¹ function GoodExample({ id }) { const [data, setData] = useState(null) useEffect(() =\u0026gt; { fetchData(id).then(setData) }, [id]) // åŒ…å«æ‰€æœ‰å¤–éƒ¨ä¾èµ– return \u0026lt;div\u0026gt;{data?.name}\u0026lt;/div\u0026gt; } // âœ… ä½¿ç”¨è‡ªå®šä¹‰Hookç®¡ç†å¤æ‚ä¾èµ– function useApiData(url, dependencies = []) { const [data, setData] = useState(null) const [loading, setLoading] = useState(true) useEffect(() =\u0026gt; { let isMounted = true setLoading(true) fetch(url) .then(response =\u0026gt; response.json()) .then(result =\u0026gt; { if (isMounted) { setData(result) } }) .catch(error =\u0026gt; { if (isMounted) { console.error(\u0026#39;API Error:\u0026#39;, error) } }) .finally(() =\u0026gt; { if (isMounted) { setLoading(false) } }) return () =\u0026gt; { isMounted = false } }, [url, ...dependencies]) return { data, loading } } é«˜çº§Hooksæ¨¡å¼ 1. çŠ¶æ€æœºHook 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 // useStateMachine - çŠ¶æ€æœºHook function useStateMachine(initialState, transitions) { const [currentState, setCurrentState] = useState(initialState) const [context, setContext] = useState({}) const transition = useCallback((action, payload) =\u0026gt; { setCurrentState(prevState =\u0026gt; { const stateConfig = transitions[prevState] if (!stateConfig || !stateConfig.on || !stateConfig.on[action]) { console.warn(`No transition defined for action ${action} in state ${prevState}`) return prevState } const transitionConfig = stateConfig.on[action] const nextState = typeof transitionConfig.target === \u0026#39;function\u0026#39; ? transitionConfig.target(prevState, payload) : transitionConfig.target if (transitionConfig.action) { transitionConfig.action(prevState, payload, context) } return nextState }) }, [transitions, context]) const can = useCallback((action) =\u0026gt; { const stateConfig = transitions[currentState] return stateConfig \u0026amp;\u0026amp; stateConfig.on \u0026amp;\u0026amp; stateConfig.on[action] }, [currentState, transitions]) return { currentState, transition, can, context, setContext } } // ä½¿ç”¨ç¤ºä¾‹ - ç™»å½•çŠ¶æ€æœº const loginMachine = { idle: { on: { login: { target: \u0026#39;loading\u0026#39;, action: (state, payload) =\u0026gt; ({ ...state, username: payload.username }) } } }, loading: { on: { success: \u0026#39;authenticated\u0026#39;, error: \u0026#39;error\u0026#39; } }, authenticated: { on: { logout: \u0026#39;idle\u0026#39; } }, error: { on: { retry: \u0026#39;loading\u0026#39;, cancel: \u0026#39;idle\u0026#39; } } } function LoginComponent() { const { currentState, transition, can } = useStateMachine(\u0026#39;idle\u0026#39;, loginMachine) const handleLogin = async (username, password) =\u0026gt; { transition(\u0026#39;login\u0026#39;, { username }) try { await performLogin(username, password) transition(\u0026#39;success\u0026#39;) } catch (error) { transition(\u0026#39;error\u0026#39;, { error: error.message }) } } return ( \u0026lt;div\u0026gt; \u0026lt;p\u0026gt;Current state: {currentState}\u0026lt;/p\u0026gt; {currentState === \u0026#39;idle\u0026#39; \u0026amp;\u0026amp; ( \u0026lt;button onClick={() =\u0026gt; handleLogin(\u0026#39;user\u0026#39;, \u0026#39;pass\u0026#39;)}\u0026gt;Login\u0026lt;/button\u0026gt; )} {currentState === \u0026#39;loading\u0026#39; \u0026amp;\u0026amp; \u0026lt;p\u0026gt;Loading...\u0026lt;/p\u0026gt;} {currentState === \u0026#39;authenticated\u0026#39; \u0026amp;\u0026amp; ( \u0026lt;div\u0026gt; \u0026lt;p\u0026gt;Authenticated!\u0026lt;/p\u0026gt; \u0026lt;button onClick={() =\u0026gt; transition(\u0026#39;logout\u0026#39;)}\u0026gt;Logout\u0026lt;/button\u0026gt; \u0026lt;/div\u0026gt; )} {currentState === \u0026#39;error\u0026#39; \u0026amp;\u0026amp; ( \u0026lt;div\u0026gt; \u0026lt;p\u0026gt;Error occurred\u0026lt;/p\u0026gt; \u0026lt;button onClick={() =\u0026gt; transition(\u0026#39;retry\u0026#39;)}\u0026gt;Retry\u0026lt;/button\u0026gt; \u0026lt;button onClick={() =\u0026gt; transition(\u0026#39;cancel\u0026#39;)}\u0026gt;Cancel\u0026lt;/button\u0026gt; \u0026lt;/div\u0026gt; )} \u0026lt;/div\u0026gt; ) } 2. è™šæ‹Ÿåˆ—è¡¨Hook 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 // useVirtualList - è™šæ‹Ÿåˆ—è¡¨Hook function useVirtualList(items, itemHeight, containerHeight) { const [scrollTop, setScrollTop] = useState(0) const visibleStart = Math.floor(scrollTop / itemHeight) const visibleEnd = Math.min( visibleStart + Math.ceil(containerHeight / itemHeight) + 1, items.length ) const visibleItems = useMemo(() =\u0026gt; { return items.slice(visibleStart, visibleEnd).map((item, index) =\u0026gt; ({ ...item, index: visibleStart + index })) }, [items, visibleStart, visibleEnd]) const totalHeight = items.length * itemHeight const offsetY = visibleStart * itemHeight const handleScroll = useCallback((e) =\u0026gt; { setScrollTop(e.target.scrollTop) }, []) return { visibleItems, totalHeight, offsetY, handleScroll } } // ä½¿ç”¨ç¤ºä¾‹ function VirtualList({ items, itemHeight = 50, containerHeight = 400 }) { const { visibleItems, totalHeight, offsetY, handleScroll } = useVirtualList(items, itemHeight, containerHeight) return ( \u0026lt;div style={{ height: containerHeight, overflow: \u0026#39;auto\u0026#39; }} onScroll={handleScroll}\u0026gt; \u0026lt;div style={{ height: totalHeight, position: \u0026#39;relative\u0026#39; }}\u0026gt; \u0026lt;div style={{ transform: `translateY(${offsetY}px)` }}\u0026gt; {visibleItems.map((item, index) =\u0026gt; ( \u0026lt;div key={item.id} style={{ height: itemHeight, borderBottom: \u0026#39;1px solid #eee\u0026#39;, display: \u0026#39;flex\u0026#39;, alignItems: \u0026#39;center\u0026#39;, padding: \u0026#39;0 16px\u0026#39;, background: index % 2 === 0 ? \u0026#39;#f9f9f9\u0026#39; : \u0026#39;white\u0026#39; }} \u0026gt; {item.name} \u0026lt;/div\u0026gt; ))} \u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; ) } 3. è¡¨å•ç®¡ç†Hook 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 // useForm - è¡¨å•ç®¡ç†Hook function useForm(initialValues, validationSchema = {}) { const [values, setValues] = useState(initialValues) const [errors, setErrors] = useState({}) const [touched, setTouched] = useState({}) const setValue = useCallback((name, value) =\u0026gt; { setValues(prev =\u0026gt; ({ ...prev, [name]: value })) }, []) const setError = useCallback((name, error) =\u0026gt; { setErrors(prev =\u0026gt; ({ ...prev, [name]: error })) }, []) const setTouched = useCallback((name, isTouched = true) =\u0026gt; { setTouched(prev =\u0026gt; ({ ...prev, [name]: isTouched })) }, []) const handleChange = useCallback((e) =\u0026gt; { const { name, value, type, checked } = e.target const fieldValue = type === \u0026#39;checkbox\u0026#39; ? checked : value setValue(name, fieldValue) if (touched[name]) { validateField(name, fieldValue) } }, [setValue, touched, validationSchema]) const validateField = useCallback((name, value) =\u0026gt; { if (!validationSchema[name]) { setError(name, \u0026#39;\u0026#39;) return true } const validator = validationSchema[name] const result = validator(value) if (typeof result === \u0026#39;string\u0026#39;) { setError(name, result) return false } else if (result === false) { setError(name, \u0026#39;Invalid field\u0026#39;) return false } else { setError(name, \u0026#39;\u0026#39;) return true } }, [validationSchema, setError]) const handleBlur = useCallback((e) =\u0026gt; { const { name, value } = e.target setTouched(name, true) validateField(name, value) }, [setTouched, validateField]) const validate = useCallback(() =\u0026gt; { let isValid = true const newErrors = {} Object.keys(validationSchema).forEach(name =\u0026gt; { if (!validateField(name, values[name])) { isValid = false newErrors[name] = errors[name] } }) setErrors(newErrors) return isValid }, [validationSchema, values, errors, validateField]) const reset = useCallback(() =\u0026gt; { setValues(initialValues) setErrors({}) setTouched({}) }, [initialValues]) return { values, errors, touched, setValue, setError, setTouched, handleChange, handleBlur, validate, reset, isValid: Object.keys(errors).every(key =\u0026gt; !errors[key]) } } // ä½¿ç”¨ç¤ºä¾‹ function LoginForm() { const validationSchema = { email: (value) =\u0026gt; { if (!value) return \u0026#39;Email is required\u0026#39; if (!/\\S+@\\S+\\.\\S+/.test(value)) return \u0026#39;Email is invalid\u0026#39; return true }, password: (value) =\u0026gt; { if (!value) return \u0026#39;Password is required\u0026#39; if (value.length \u0026lt; 6) return \u0026#39;Password must be at least 6 characters\u0026#39; return true } } const { values, errors, touched, handleChange, handleBlur, validate, reset, isValid } = useForm( { email: \u0026#39;\u0026#39;, password: \u0026#39;\u0026#39; }, validationSchema ) const handleSubmit = (e) =\u0026gt; { e.preventDefault() if (validate()) { console.log(\u0026#39;Form submitted:\u0026#39;, values) } } return ( \u0026lt;form onSubmit={handleSubmit}\u0026gt; \u0026lt;div\u0026gt; \u0026lt;label\u0026gt;Email:\u0026lt;/label\u0026gt; \u0026lt;input type=\u0026#34;email\u0026#34; name=\u0026#34;email\u0026#34; value={values.email} onChange={handleChange} onBlur={handleBlur} /\u0026gt; {touched.email \u0026amp;\u0026amp; errors.email \u0026amp;\u0026amp; ( \u0026lt;span style={{ color: \u0026#39;red\u0026#39; }}\u0026gt;{errors.email}\u0026lt;/span\u0026gt; )} \u0026lt;/div\u0026gt; \u0026lt;div\u0026gt; \u0026lt;label\u0026gt;Password:\u0026lt;/label\u0026gt; \u0026lt;input type=\u0026#34;password\u0026#34; name=\u0026#34;password\u0026#34; value={values.password} onChange={handleChange} onBlur={handleBlur} /\u0026gt; {touched.password \u0026amp;\u0026amp; errors.password \u0026amp;\u0026amp; ( \u0026lt;span style={{ color: \u0026#39;red\u0026#39; }}\u0026gt;{errors.password}\u0026lt;/span\u0026gt; )} \u0026lt;/div\u0026gt; \u0026lt;button type=\u0026#34;submit\u0026#34; disabled={!isValid}\u0026gt; Submit \u0026lt;/button\u0026gt; \u0026lt;button type=\u0026#34;button\u0026#34; onClick={reset}\u0026gt; Reset \u0026lt;/button\u0026gt; \u0026lt;/form\u0026gt; ) } Hooksæµ‹è¯•ç­–ç•¥ 1. æµ‹è¯•è‡ªå®šä¹‰Hooks 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 // ä½¿ç”¨ @testing-library/react-hooks import { renderHook, act } from \u0026#39;@testing-library/react-hooks\u0026#39; // æµ‹è¯•useCounter Hook import { useCounter } from \u0026#39;./useCounter\u0026#39; describe(\u0026#39;useCounter\u0026#39;, () =\u0026gt; { test(\u0026#39;should initialize with default value\u0026#39;, () =\u0026gt; { const { result } = renderHook(() =\u0026gt; useCounter()) expect(result.current.count).toBe(0) expect(typeof result.current.increment).toBe(\u0026#39;function\u0026#39;) expect(typeof result.current.decrement).toBe(\u0026#39;function\u0026#39;) expect(typeof result.current.reset).toBe(\u0026#39;function\u0026#39;) }) test(\u0026#39;should initialize with custom value\u0026#39;, () =\u0026gt; { const { result } = renderHook(() =\u0026gt; useCounter(5)) expect(result.current.count).toBe(5) }) test(\u0026#39;should increment count\u0026#39;, () =\u0026gt; { const { result } = renderHook(() =\u0026gt; useCounter(0, 1)) act(() =\u0026gt; { result.current.increment() }) expect(result.current.count).toBe(1) }) test(\u0026#39;should decrement count\u0026#39;, () =\u0026gt; { const { result } = renderHook(() =\u0026gt; useCounter(5, 2)) act(() =\u0026gt; { result.current.decrement() }) expect(result.current.count).toBe(3) }) test(\u0026#39;should reset count\u0026#39;, () =\u0026gt; { const { result } = renderHook(() =\u0026gt; useCounter(0)) act(() =\u0026gt; { result.current.increment() result.current.increment() }) expect(result.current.count).toBe(2) act(() =\u0026gt; { result.current.reset() }) expect(result.current.count).toBe(0) }) }) // æµ‹è¯•useApi Hook import { useApi } from \u0026#39;./useApi\u0026#39; // Mock fetch global.fetch = jest.fn() describe(\u0026#39;useApi\u0026#39;, () =\u0026gt; { beforeEach(() =\u0026gt; { fetch.mockClear() }) test(\u0026#39;should fetch data on mount\u0026#39;, async () =\u0026gt; { const mockData = { id: 1, name: \u0026#39;Test\u0026#39; } fetch.mockResolvedValueOnce({ ok: true, json: async () =\u0026gt; mockData }) const { result, waitForNextUpdate } = renderHook(() =\u0026gt; useApi(\u0026#39;/api/test\u0026#39;)) expect(result.current.loading).toBe(true) expect(result.current.data).toBe(null) expect(result.current.error).toBe(null) await waitForNextUpdate() expect(result.current.loading).toBe(false) expect(result.current.data).toEqual(mockData) expect(result.current.error).toBe(null) }) test(\u0026#39;should handle fetch error\u0026#39;, async () =\u0026gt; { fetch.mockRejectedValueOnce(new Error(\u0026#39;Network error\u0026#39;)) const { result, waitForNextUpdate } = renderHook(() =\u0026gt; useApi(\u0026#39;/api/test\u0026#39;)) await waitForNextUpdate() expect(result.current.loading).toBe(false) expect(result.current.data).toBe(null) expect(result.current.error).toBe(\u0026#39;Network error\u0026#39;) }) }) 2. é›†æˆæµ‹è¯• 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 // æµ‹è¯•ä½¿ç”¨Hooksçš„ç»„ä»¶ import { render, screen, fireEvent, waitFor } from \u0026#39;@testing-library/react\u0026#39; import { Counter } from \u0026#39;./Counter\u0026#39; describe(\u0026#39;Counter Component\u0026#39;, () =\u0026gt; { test(\u0026#39;should render initial count\u0026#39;, () =\u0026gt; { render(\u0026lt;Counter /\u0026gt;) expect(screen.getByText(\u0026#39;Count: 0\u0026#39;)).toBeInTheDocument() }) test(\u0026#39;should increment count when button clicked\u0026#39;, async () =\u0026gt; { render(\u0026lt;Counter /\u0026gt;) const incrementButton = screen.getByText(\u0026#39;+1\u0026#39;) fireEvent.click(incrementButton) await waitFor(() =\u0026gt; { expect(screen.getByText(\u0026#39;Count: 1\u0026#39;)).toBeInTheDocument() }) }) }) æ€»ç»“ React Hooksä¸ºæˆ‘ä»¬å¸¦æ¥äº†å¼ºå¤§çš„èƒ½åŠ›ï¼Œä½†ä¹Ÿéœ€è¦æ­£ç¡®ç†è§£å’Œä½¿ç”¨ï¼š\næ ¸å¿ƒè¦ç‚¹ ç†è§£åŸç†ï¼šHooksåŸºäºé“¾è¡¨ç»“æ„ï¼Œè°ƒç”¨é¡ºåºå¿…é¡»ä¸€è‡´ åˆç†ä¼˜åŒ–ï¼šé¿å…è¿‡åº¦ä¼˜åŒ–ï¼Œæ­£ç¡®ä½¿ç”¨useCallbackå’ŒuseMemo é¿å…é™·é˜±ï¼šæ³¨æ„é—­åŒ…ã€ä¾èµ–æ•°ç»„ã€è°ƒç”¨è§„åˆ™ç­‰é—®é¢˜ è‡ªå®šä¹‰Hooksï¼šæå–é€»è¾‘å¤ç”¨ï¼Œä¿æŒç»„ä»¶ç®€æ´ æµ‹è¯•ç­–ç•¥ï¼šå……åˆ†æµ‹è¯•è‡ªå®šä¹‰Hooksçš„è¡Œä¸º æœ€ä½³å®è·µ éµå¾ªHooksè§„åˆ™ åˆç†ä½¿ç”¨æ€§èƒ½ä¼˜åŒ–Hooks æå–å¤ç”¨é€»è¾‘ä¸ºè‡ªå®šä¹‰Hooks ç¼–å†™å¯æµ‹è¯•çš„Hooks æ³¨æ„å†…å­˜æ³„æ¼å’Œæ¸…ç† é€šè¿‡æ·±å…¥ç†è§£Hooksçš„åŸç†å’Œæœ€ä½³å®è·µï¼Œä½ å¯ä»¥ç¼–å†™å‡ºæ›´ç®€æ´ã€æ›´é«˜æ•ˆã€æ›´æ˜“ç»´æŠ¤çš„Reactç»„ä»¶ã€‚Hooksä¸ä»…æ˜¯æŠ€æœ¯å·¥å…·ï¼Œæ›´æ˜¯æ„å»ºç°ä»£åŒ–Reactåº”ç”¨çš„è®¾è®¡æ€ç»´ã€‚\n","permalink":"/blog/articles/react-hooks-deep-dive/","summary":"æ·±å…¥æ¢è®¨React Hooksçš„å†…éƒ¨å®ç°åŸç†ï¼Œæ¶µç›–è‡ªå®šä¹‰Hookså¼€å‘ã€æ€§èƒ½ä¼˜åŒ–ã€å¸¸è§é™·é˜±ä»¥åŠæœ€ä½³å®è·µï¼Œå¸®åŠ©ä½ æ›´å¥½åœ°æŒæ¡Reactç°ä»£åŒ–å¼€å‘ã€‚","title":"React Hooksæ·±åº¦è§£æï¼šåŸç†ã€æœ€ä½³å®è·µå’Œæ€§èƒ½ä¼˜åŒ–"},{"content":"Dockerå·²ç»æˆä¸ºç°ä»£è½¯ä»¶å¼€å‘å’Œéƒ¨ç½²çš„æ ‡å‡†å·¥å…·ã€‚ç„¶è€Œï¼Œä»…ä»…ä¼šç”¨Dockeræ˜¯è¿œè¿œä¸å¤Ÿçš„ï¼ŒæŒæ¡æœ€ä½³å®è·µæ‰èƒ½æ„å»ºå‡ºå®‰å…¨ã€é«˜æ•ˆã€å¯ç»´æŠ¤çš„å®¹å™¨åŒ–åº”ç”¨ã€‚æœ¬æ–‡å°†åˆ†äº«ä»å¼€å‘åˆ°ç”Ÿäº§çš„å®Œæ•´Dockeræœ€ä½³å®è·µã€‚\nDockeré•œåƒä¼˜åŒ– 1. é€‰æ‹©åˆé€‚çš„åŸºç¡€é•œåƒ 1 2 3 4 5 6 7 8 9 10 11 # âŒ ä½¿ç”¨æœ€æ–°çš„Ubuntué•œåƒï¼ˆä½“ç§¯å¤§ã€æ”»å‡»é¢å¤§ï¼‰ FROM ubuntu:latest # âœ… ä½¿ç”¨å®˜æ–¹è½»é‡çº§é•œåƒ FROM alpine:3.18 # âœ… ä½¿ç”¨ç‰¹å®šç‰ˆæœ¬çš„å®˜æ–¹é•œåƒ FROM node:18-alpine3.18 # âœ… ä½¿ç”¨distrolessé•œåƒï¼ˆæœ€å°æ”»å‡»é¢ï¼‰ FROM gcr.io/distroless/nodejs18-debian11 2. å¤šé˜¶æ®µæ„å»ºä¼˜åŒ– 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 # æ„å»ºé˜¶æ®µ FROM node:18-alpine AS builder WORKDIR /app # åªå¤åˆ¶ä¾èµ–æ–‡ä»¶ï¼Œåˆ©ç”¨Dockerç¼“å­˜ COPY package*.json ./ RUN npm ci --only=production \u0026amp;\u0026amp; npm cache clean --force # å¤åˆ¶æºä»£ç å¹¶æ„å»º COPY . . RUN npm run build # ç”Ÿäº§é˜¶æ®µ FROM node:18-alpine AS production # åˆ›å»ºérootç”¨æˆ· RUN addgroup -g 1001 -S nodejs RUN adduser -S nodejs -u 1001 WORKDIR /app # ä»æ„å»ºé˜¶æ®µå¤åˆ¶äº§ç‰© COPY --from=builder /app/dist ./dist COPY --from=builder /app/node_modules ./node_modules COPY --from=builder /app/package.json ./package.json # åˆ‡æ¢åˆ°érootç”¨æˆ· USER nodejs EXPOSE 3000 CMD [\u0026#34;node\u0026#34;, \u0026#34;dist/index.js\u0026#34;] 3. é•œåƒå±‚ä¼˜åŒ– 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 # âŒ æ¯æ¬¡RUNéƒ½åˆ›å»ºæ–°å±‚ FROM node:18-alpine RUN apt-get update RUN apt-get install -y git RUN apt-get install -y curl RUN apt-get install -y wget # âœ… åˆå¹¶å‘½ä»¤ï¼Œå‡å°‘å±‚æ•° FROM node:18-alpine RUN apt-get update \u0026amp;\u0026amp; \\ apt-get install -y git curl wget \u0026amp;\u0026amp; \\ apt-get clean \u0026amp;\u0026amp; \\ rm -rf /var/lib/apt/lists/* # âœ… ä½¿ç”¨.dockerignoreæ’é™¤ä¸å¿…è¦çš„æ–‡ä»¶ # .dockerignore node_modules npm-debug.log Dockerfile .dockerignore .git .gitignore README.md .env .nyc_output coverage .coverage .nyc_output .vscode 4. é•œåƒå®‰å…¨æ‰«æ 1 2 3 4 5 6 7 8 9 # ä½¿ç”¨Trivyæ‰«æé•œåƒæ¼æ´ trivy image myapp:latest # ä½¿ç”¨Docker Scoutï¼ˆæ–°ç‰ˆæœ¬Dockerå†…ç½®ï¼‰ docker scout cves myapp:latest # åœ¨CI/CDä¸­é›†æˆå®‰å…¨æ‰«æ docker build -t myapp:latest . docker scout cves myapp:latest --exit-code å®¹å™¨å®‰å…¨æœ€ä½³å®è·µ 1. ç”¨æˆ·æƒé™ç®¡ç† 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 # âŒ ä»¥rootç”¨æˆ·è¿è¡Œå®¹å™¨ FROM node:18-alpine # âœ… åˆ›å»ºå¹¶ä½¿ç”¨érootç”¨æˆ· FROM node:18-alpine # åˆ›å»ºç”¨æˆ·ç»„å’Œç”¨æˆ· RUN addgroup -g 1001 -S appgroup \u0026amp;\u0026amp; \\ adduser -u 1001 -S appuser -G appgroup # è®¾ç½®å·¥ä½œç›®å½•æƒé™ WORKDIR /app RUN chown -R appuser:appgroup /app USER appuser 2. ç½‘ç»œå®‰å…¨é…ç½® 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 # docker-compose.yml version: \u0026#39;3.8\u0026#39; services: web: build: . networks: - frontend - backend # åªæš´éœ²å¿…è¦çš„ç«¯å£ expose: - \u0026#34;3000\u0026#34; database: image: postgres:15 networks: - backend # ä¸æš´éœ²åˆ°å¤–éƒ¨ç½‘ç»œ expose: [] networks: frontend: driver: bridge backend: driver: bridge internal: true # å†…éƒ¨ç½‘ç»œï¼Œä¸èƒ½è®¿é—®å¤–ç½‘ 3. èµ„æºé™åˆ¶ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 # è®¾ç½®èµ„æºé™åˆ¶ services: app: image: myapp:latest deploy: resources: limits: cpus: \u0026#39;0.5\u0026#39; memory: 512M reservations: cpus: \u0026#39;0.25\u0026#39; memory: 256M ulimits: nproc: 65535 nofile: soft: 20000 hard: 40000 ç¯å¢ƒé…ç½®ç®¡ç† 1. å¤šç¯å¢ƒé…ç½® 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 # Dockerfile FROM node:18-alpine ARG NODE_ENV=production ENV NODE_ENV=$NODE_ENV # æ ¹æ®ç¯å¢ƒå®‰è£…ä¸åŒçš„ä¾èµ– COPY package*.json ./ RUN if [ \u0026#34;$NODE_ENV\u0026#34; = \u0026#34;production\u0026#34; ]; then \\ npm ci --only=production; \\ else \\ npm ci; \\ fi # å¤šé˜¶æ®µæ„å»ºæ”¯æŒä¸åŒç¯å¢ƒ FROM node:18-alpine AS development RUN npm ci COPY . . FROM node:18-alpine AS production RUN npm ci --only=production COPY --from=development /app/dist ./dist 2. é…ç½®æ–‡ä»¶ç®¡ç† 1 2 3 4 5 6 7 8 9 10 11 12 13 14 # ä½¿ç”¨ç¯å¢ƒå˜é‡é…ç½® version: \u0026#39;3.8\u0026#39; services: web: image: myapp:latest environment: - NODE_ENV=production - DATABASE_URL=${DATABASE_URL} - REDIS_URL=${REDIS_URL} - JWT_SECRET=${JWT_SECRET} env_file: - ./config/production.env - ./config/secrets.env 1 2 3 4 5 6 7 8 # production.env NODE_ENV=production PORT=3000 LOG_LEVEL=info # secrets.envï¼ˆä¸æäº¤åˆ°ç‰ˆæœ¬æ§åˆ¶ï¼‰ DATABASE_URL=postgresql://user:pass@localhost:5432/db JWT_SECRET=your-secret-key 3. é…ç½®æ³¨å…¥æœ€ä½³å®è·µ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 # ä½¿ç”¨é…ç½®æ–‡ä»¶æŒ‚è½½ docker run -d \\ --name myapp \\ -v $(pwd)/config.json:/app/config.json:ro \\ myapp:latest # ä½¿ç”¨ç¯å¢ƒå˜é‡æ–‡ä»¶ docker run -d \\ --name myapp \\ --env-file ./production.env \\ myapp:latest # ä½¿ç”¨Docker secretsï¼ˆSwarmæ¨¡å¼ï¼‰ echo \u0026#34;my-secret-password\u0026#34; | docker secret create db_password - æ•°æ®æŒä¹…åŒ–ç­–ç•¥ 1. æ•°æ®å·ç®¡ç† 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 version: \u0026#39;3.8\u0026#39; services: database: image: postgres:15 volumes: # ä½¿ç”¨å‘½åå· - postgres_data:/var/lib/postgresql/data # ä½¿ç”¨ç»‘å®šæŒ‚è½½ï¼ˆä»…å¼€å‘ç¯å¢ƒï¼‰ - ./init-scripts:/docker-entrypoint-initdb.d:ro app: image: myapp:latest volumes: - app_data:/app/data - app_logs:/app/logs # ä¸´æ—¶æ–‡ä»¶ä½¿ç”¨tmpfs - type: tmpfs target: /app/tmp volumes: postgres_data: driver: local app_data: driver: local app_logs: driver: local 2. å¤‡ä»½å’Œæ¢å¤ç­–ç•¥ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 #!/bin/bash # backup.sh - æ•°æ®åº“å¤‡ä»½è„šæœ¬ BACKUP_DIR=\u0026#34;/backups/postgres\u0026#34; DATE=$(date +%Y%m%d_%H%M%S) CONTAINER_NAME=\u0026#34;postgres\u0026#34; # åˆ›å»ºå¤‡ä»½ç›®å½• mkdir -p $BACKUP_DIR # å¤‡ä»½æ•°æ®åº“ docker exec $CONTAINER_NAME pg_dump -U postgres myapp \u0026gt; \u0026#34;$BACKUP_DIR/backup_$DATE.sql\u0026#34; # ä¿ç•™æœ€è¿‘30å¤©çš„å¤‡ä»½ find $BACKUP_DIR -name \u0026#34;backup_*.sql\u0026#34; -mtime +30 -delete echo \u0026#34;Backup completed: backup_$DATE.sql\u0026#34; 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 #!/bin/bash # restore.sh - æ•°æ®åº“æ¢å¤è„šæœ¬ if [ $# -eq 0 ]; then echo \u0026#34;Usage: $0 \u0026lt;backup_file\u0026gt;\u0026#34; exit 1 fi BACKUP_FILE=$1 CONTAINER_NAME=\u0026#34;postgres\u0026#34; # åœæ­¢åº”ç”¨è¿æ¥ docker stop app # æ¢å¤æ•°æ®åº“ docker exec -i $CONTAINER_NAME psql -U postgres -d myapp \u0026lt; $BACKUP_FILE # é‡å¯åº”ç”¨ docker start app echo \u0026#34;Database restored from $BACKUP_FILE\u0026#34; ç›‘æ§å’Œæ—¥å¿—ç®¡ç† 1. åº”ç”¨ç›‘æ§ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 version: \u0026#39;3.8\u0026#39; services: app: image: myapp:latest labels: - \u0026#34;prometheus.scrape=true\u0026#34; - \u0026#34;prometheus.port=3000\u0026#34; environment: - METRICS_ENABLED=true prometheus: image: prom/prometheus:latest ports: - \u0026#34;9090:9090\u0026#34; volumes: - ./prometheus.yml:/etc/prometheus/prometheus.yml:ro - prometheus_data:/prometheus grafana: image: grafana/grafana:latest ports: - \u0026#34;3001:3000\u0026#34; environment: - GF_SECURITY_ADMIN_PASSWORD=admin volumes: - grafana_data:/var/lib/grafana - ./grafana/dashboards:/etc/grafana/provisioning/dashboards:ro node-exporter: image: prom/node-exporter:latest ports: - \u0026#34;9100:9100\u0026#34; volumes: - /proc:/host/proc:ro - /sys:/host/sys:ro - /:/rootfs:ro volumes: prometheus_data: grafana_data: 2. æ—¥å¿—ç®¡ç†ç­–ç•¥ 1 2 3 4 5 6 7 8 9 10 11 12 13 # åº”ç”¨æ—¥å¿—é…ç½® FROM node:18-alpine # åˆ›å»ºæ—¥å¿—ç›®å½• RUN mkdir -p /app/logs \u0026amp;\u0026amp; \\ chown -R nodejs:nodejs /app/logs # ä½¿ç”¨å¥åº·æ£€æŸ¥ HEALTHCHECK --interval=30s --timeout=3s --start-period=5s --retries=3 \\ CMD curl -f http://localhost:3000/health || exit 1 # è®¾ç½®æ—¥å¿—é©±åŠ¨ # åœ¨docker-composeä¸­é…ç½® 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 # docker-compose.yml version: \u0026#39;3.8\u0026#39; services: app: image: myapp:latest logging: driver: \u0026#34;json-file\u0026#34; options: max-size: \u0026#34;10m\u0026#34; max-file: \u0026#34;3\u0026#34; labels: \u0026#34;app,production\u0026#34; labels: - \u0026#34;monitoring.logging=true\u0026#34; # ä½¿ç”¨ELK Stackè¿›è¡Œæ—¥å¿—èšåˆ elasticsearch: image: docker.elastic.co/elasticsearch/elasticsearch:8.5.0 environment: - discovery.type=single-node - \u0026#34;ES_JAVA_OPTS=-Xms512m -Xmx512m\u0026#34; logstash: image: docker.elastic.co/logstash/logstash:8.5.0 volumes: - ./logstash/pipeline:/usr/share/logstash/pipeline:ro kibana: image: docker.elastic.co/kibana/kibana:8.5.0 ports: - \u0026#34;5601:5601\u0026#34; environment: - ELASTICSEARCH_HOSTS=http://elasticsearch:9200 CI/CDé›†æˆ 1. GitHub Actionså·¥ä½œæµ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 # .github/workflows/docker.yml name: Docker Build and Deploy on: push: branches: [main, develop] pull_request: branches: [main] jobs: test: runs-on: ubuntu-latest steps: - uses: actions/checkout@v3 - name: Setup Node.js uses: actions/setup-node@v3 with: node-version: \u0026#39;18\u0026#39; cache: \u0026#39;npm\u0026#39; - name: Install dependencies run: npm ci - name: Run tests run: npm test build-and-push: needs: test runs-on: ubuntu-latest if: github.ref == \u0026#39;refs/heads/main\u0026#39; steps: - uses: actions/checkout@v3 - name: Set up Docker Buildx uses: docker/setup-buildx-action@v2 - name: Login to Docker Hub uses: docker/login-action@v2 with: username: ${{ secrets.DOCKER_USERNAME }} password: ${{ secrets.DOCKER_PASSWORD }} - name: Extract metadata id: meta uses: docker/metadata-action@v4 with: images: myorg/myapp tags: | type=ref,event=branch type=ref,event=pr type=semver,pattern={{version}} type=semver,pattern={{major}}.{{minor}} - name: Build and push Docker image uses: docker/build-push-action@v4 with: context: . platforms: linux/amd64,linux/arm64 push: true tags: ${{ steps.meta.outputs.tags }} labels: ${{ steps.meta.outputs.labels }} cache-from: type=gha cache-to: type=gha,mode=max 2. å®‰å…¨æ‰«æé›†æˆ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 # æ·»åŠ åˆ°CIå·¥ä½œæµä¸­ security-scan: runs-on: ubuntu-latest steps: - uses: actions/checkout@v3 - name: Build Docker image run: docker build -t myapp:test . - name: Run Trivy vulnerability scanner uses: aquasecurity/trivy-action@master with: image-ref: \u0026#39;myapp:test\u0026#39; format: \u0026#39;sarif\u0026#39; output: \u0026#39;trivy-results.sarif\u0026#39; - name: Upload Trivy scan results uses: github/codeql-action/upload-sarif@v2 with: sarif_file: \u0026#39;trivy-results.sarif\u0026#39; ç”Ÿäº§ç¯å¢ƒéƒ¨ç½² 1. å¤šé˜¶æ®µéƒ¨ç½²ç­–ç•¥ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 # docker-compose.prod.yml version: \u0026#39;3.8\u0026#39; services: nginx: image: nginx:alpine ports: - \u0026#34;80:80\u0026#34; - \u0026#34;443:443\u0026#34; volumes: - ./nginx/nginx.conf:/etc/nginx/nginx.conf:ro - ./nginx/ssl:/etc/nginx/ssl:ro - nginx_logs:/var/log/nginx depends_on: - app app: image: myorg/myapp:${VERSION} environment: - NODE_ENV=production - DATABASE_URL=${DATABASE_URL} volumes: - app_data:/app/data - app_logs:/app/logs restart: unless-stopped healthcheck: test: [\u0026#34;CMD\u0026#34;, \u0026#34;curl\u0026#34;, \u0026#34;-f\u0026#34;, \u0026#34;http://localhost:3000/health\u0026#34;] interval: 30s timeout: 10s retries: 3 start_period: 40s redis: image: redis:7-alpine command: redis-server --appendonly yes --requirepass ${REDIS_PASSWORD} volumes: - redis_data:/data restart: unless-stopped database: image: postgres:15 environment: - POSTGRES_DB=${DB_NAME} - POSTGRES_USER=${DB_USER} - POSTGRES_PASSWORD=${DB_PASSWORD} volumes: - postgres_data:/var/lib/postgresql/data - ./backups:/backups restart: unless-stopped volumes: nginx_logs: app_data: app_logs: redis_data: postgres_data: 2. é›¶åœæœºéƒ¨ç½² 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 #!/bin/bash # deploy.sh - é›¶åœæœºéƒ¨ç½²è„šæœ¬ set -e APP_NAME=\u0026#34;myapp\u0026#34; NEW_VERSION=$1 CURRENT_CONTAINER=\u0026#34;${APP_NAME}_current\u0026#34; NEW_CONTAINER=\u0026#34;${APP_NAME}_new\u0026#34; if [ -z \u0026#34;$NEW_VERSION\u0026#34; ]; then echo \u0026#34;Usage: $0 \u0026lt;version\u0026gt;\u0026#34; exit 1 fi echo \u0026#34;Deploying version $NEW_VERSION\u0026#34; # æ‹‰å–æ–°é•œåƒ docker pull myorg/$APP_NAME:$NEW_VERSION # å¯åŠ¨æ–°å®¹å™¨ docker run -d \\ --name $NEW_CONTAINER \\ --env-file ./production.env \\ -e NODE_ENV=production \\ --network app-network \\ myorg/$APP_NAME:$NEW_VERSION # å¥åº·æ£€æŸ¥ echo \u0026#34;Waiting for new container to be healthy...\u0026#34; for i in {1..30}; do if docker exec $NEW_CONTAINER curl -f http://localhost:3000/health; then echo \u0026#34;New container is healthy\u0026#34; break fi if [ $i -eq 30 ]; then echo \u0026#34;Health check failed\u0026#34; docker logs $NEW_CONTAINER docker stop $NEW_CONTAINER docker rm $NEW_CONTAINER exit 1 fi sleep 2 done # åˆ‡æ¢æµé‡ docker stop $CURRENT_CONTAINER docker rename $CURRENT_CONTAINER \u0026#34;${APP_NAME}_old\u0026#34; docker rename $NEW_CONTAINER $CURRENT_CONTAINER # æ¸…ç†æ—§å®¹å™¨ï¼ˆå»¶è¿Ÿåˆ é™¤ï¼Œä¾¿äºå›æ»šï¼‰ sleep 30 docker rm \u0026#34;${APP_NAME}_old\u0026#34; 2\u0026gt;/dev/null || true echo \u0026#34;Deployment completed successfully\u0026#34; 3. å›æ»šç­–ç•¥ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 #!/bin/bash # rollback.sh - å›æ»šè„šæœ¬ set -e APP_NAME=\u0026#34;myapp\u0026#34; TARGET_VERSION=$1 CURRENT_CONTAINER=\u0026#34;${APP_NAME}_current\u0026#34; if [ -z \u0026#34;$TARGET_VERSION\u0026#34; ]; then echo \u0026#34;Usage: $0 \u0026lt;target_version\u0026gt;\u0026#34; echo \u0026#34;Available versions:\u0026#34; docker images myorg/$APP_NAME --format \u0026#34;table {{.Tag}}\u0026#34; exit 1 fi echo \u0026#34;Rolling back to version $TARGET_VERSION\u0026#34; # åˆ›å»ºå›æ»šå®¹å™¨ ROLLBACK_CONTAINER=\u0026#34;${APP_NAME}_rollback\u0026#34; docker run -d \\ --name $ROLLBACK_CONTAINER \\ --env-file ./production.env \\ -e NODE_ENV=production \\ --network app-network \\ myorg/$APP_NAME:$TARGET_VERSION # å¥åº·æ£€æŸ¥ echo \u0026#34;Waiting for rollback container to be healthy...\u0026#34; for i in {1..30}; do if docker exec $ROLLBACK_CONTAINER curl -f http://localhost:3000/health; then echo \u0026#34;Rollback container is healthy\u0026#34; break fi if [ $i -eq 30 ]; then echo \u0026#34;Rollback health check failed\u0026#34; docker stop $ROLLBACK_CONTAINER docker rm $ROLLBACK_CONTAINER exit 1 fi sleep 2 done # æ‰§è¡Œå›æ»š docker stop $CURRENT_CONTAINER docker rename $CURRENT_CONTAINER \u0026#34;${APP_NAME}_failed\u0026#34; docker rename $ROLLBACK_CONTAINER $CURRENT_CONTAINER # æ¸…ç†å¤±è´¥å®¹å™¨ docker rm \u0026#34;${APP_NAME}_failed\u0026#34; 2\u0026gt;/dev/null || true echo \u0026#34;Rollback to $TARGET_VERSION completed successfully\u0026#34; æ€§èƒ½ä¼˜åŒ–æŠ€å·§ 1. é•œåƒå¤§å°ä¼˜åŒ– 1 2 3 4 5 6 7 8 # åˆ†æé•œåƒå±‚å¤§å° docker history myapp:latest # ä½¿ç”¨diveå·¥å…·æ·±å…¥åˆ†æ dive myapp:latest # æŸ¥æ‰¾å¤§æ–‡ä»¶ docker run --rm -it myapp:latest du -ah / | sort -rh | head -n 20 2. å®¹å™¨å¯åŠ¨ä¼˜åŒ– 1 2 3 4 5 6 7 8 9 10 11 12 13 14 # å‡å°‘å¯åŠ¨æ—¶é—´ FROM node:18-alpine # é¢„å®‰è£…å¸¸ç”¨åŒ… RUN apk add --no-cache dumb-init # ä½¿ç”¨dumb-initä½œä¸ºPID 1 ENTRYPOINT [\u0026#34;dumb-init\u0026#34;, \u0026#34;--\u0026#34;] # é¢„çƒ­Node.js ENV NODE_OPTIONS=\u0026#34;--max-old-space-size=512\u0026#34; # ä¼˜åŒ–åº”ç”¨å¯åŠ¨ CMD [\u0026#34;node\u0026#34;, \u0026#34;--max-old-space-size=512\u0026#34;, \u0026#34;dist/index.js\u0026#34;] 3. ç½‘ç»œä¼˜åŒ– 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 # ä½¿ç”¨è‡ªå®šä¹‰ç½‘ç»œ version: \u0026#39;3.8\u0026#39; services: app: image: myapp:latest networks: - app-network # ä¼˜åŒ–DNSè®¾ç½® dns: - 8.8.8.8 - 8.8.4.4 networks: app-network: driver: bridge driver_opts: com.docker.network.bridge.name: app-br com.docker.network.driver.mtu: 1500 æ•…éšœæ’é™¤æŒ‡å— 1. å¸¸è§é—®é¢˜è¯Šæ–­ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 # æŸ¥çœ‹å®¹å™¨æ—¥å¿— docker logs myapp docker logs myapp --tail 100 # æœ€å100è¡Œ docker logs myapp --follow # å®æ—¶æ—¥å¿— # è¿›å…¥å®¹å™¨è°ƒè¯• docker exec -it myapp /bin/sh docker run -it --rm myapp:latest /bin/sh # ä¸´æ—¶å®¹å™¨ # æ£€æŸ¥å®¹å™¨èµ„æºä½¿ç”¨ docker stats myapp docker top myapp # æ£€æŸ¥ç½‘ç»œè¿æ¥ docker exec myapp netstat -tulpn docker network inspect app-network 2. æ€§èƒ½åˆ†æ 1 2 3 4 5 6 7 8 9 10 11 12 13 # åˆ†æå®¹å™¨å¯åŠ¨æ—¶é—´ docker run --rm -v /var/run/docker.sock:/var/run/docker.sock \\ nathanleclaire/docker-image-size-cmp myapp:latest # ä½¿ç”¨cAdvisorç›‘æ§ docker run -d \\ --name=cadvisor \\ -p 8080:8080 \\ -v /:/rootfs:ro \\ -v /var/run:/var/run:ro \\ -v /sys:/sys:ro \\ -v /var/lib/docker/:/var/lib/docker:ro \\ gcr.io/cadvisor/cadvisor:latest æ€»ç»“ Dockeræœ€ä½³å®è·µæ¶µç›–äº†ä»é•œåƒæ„å»ºåˆ°ç”Ÿäº§éƒ¨ç½²çš„æ–¹æ–¹é¢é¢ï¼š\næ ¸å¿ƒè¦ç‚¹ é•œåƒä¼˜åŒ–ï¼šå¤šé˜¶æ®µæ„å»ºã€å‡å°‘å±‚æ•°ã€ä½¿ç”¨è½»é‡çº§åŸºç¡€é•œåƒ å®‰å…¨åŠ å›ºï¼šérootç”¨æˆ·ã€ç½‘ç»œéš”ç¦»ã€èµ„æºé™åˆ¶ ç¯å¢ƒç®¡ç†ï¼šç¯å¢ƒå˜é‡ã€é…ç½®æ–‡ä»¶ã€å¤šç¯å¢ƒæ”¯æŒ æ•°æ®ç®¡ç†ï¼šæŒä¹…åŒ–ç­–ç•¥ã€å¤‡ä»½æ¢å¤ ç›‘æ§æ—¥å¿—ï¼šåº”ç”¨ç›‘æ§ã€æ—¥å¿—èšåˆã€æ€§èƒ½åˆ†æ CI/CDé›†æˆï¼šè‡ªåŠ¨åŒ–æ„å»ºã€å®‰å…¨æ‰«æã€éƒ¨ç½²ç­–ç•¥ ç”Ÿäº§å°±ç»ªæ£€æŸ¥æ¸…å• é•œåƒå®‰å…¨æ‰«æé€šè¿‡ ä½¿ç”¨érootç”¨æˆ·è¿è¡Œ èµ„æºé™åˆ¶å·²é…ç½® å¥åº·æ£€æŸ¥å·²è®¾ç½® æ—¥å¿—ç®¡ç†ç­–ç•¥å·²å®ç° å¤‡ä»½æ¢å¤ç­–ç•¥å·²åˆ¶å®š ç›‘æ§å‘Šè­¦å·²é…ç½® å›æ»šç­–ç•¥å·²æµ‹è¯• é€šè¿‡éµå¾ªè¿™äº›æœ€ä½³å®è·µï¼Œä½ å¯ä»¥æ„å»ºå‡ºå®‰å…¨ã€é«˜æ•ˆã€å¯ç»´æŠ¤çš„Dockerå®¹å™¨åŒ–åº”ç”¨ï¼Œä¸ºç°ä»£åŒ–è½¯ä»¶å¼€å‘å¥ å®šåšå®çš„åŸºç¡€ã€‚è®°ä½ï¼Œå®¹å™¨åŒ–æ˜¯ä¸€ä¸ªæŒç»­ä¼˜åŒ–çš„è¿‡ç¨‹ï¼Œéœ€è¦æ ¹æ®å®é™…éœ€æ±‚å’Œåé¦ˆä¸æ–­è°ƒæ•´å’Œæ”¹è¿›ã€‚\n","permalink":"/blog/articles/docker-best-practices-guide/","summary":"å…¨é¢çš„Dockeræœ€ä½³å®è·µæŒ‡å—ï¼Œæ¶µç›–é•œåƒä¼˜åŒ–ã€å®¹å™¨å®‰å…¨ã€å¤šç¯å¢ƒéƒ¨ç½²ã€ç›‘æ§å‘Šè­¦ç­‰å…³é”®ä¸»é¢˜ï¼Œå¸®åŠ©ä½ æ„å»ºå¯é çš„å®¹å™¨åŒ–åº”ç”¨ã€‚","title":"Dockerå®¹å™¨åŒ–æœ€ä½³å®è·µï¼šä»å¼€å‘åˆ°ç”Ÿäº§çš„å®Œæ•´æŒ‡å—"},{"content":"Vue 3å¸¦æ¥äº†æ˜¾è‘—çš„æ€§èƒ½æå‡ï¼Œä½†è¦æ„å»ºçœŸæ­£é«˜æ€§èƒ½çš„åº”ç”¨ï¼Œä»éœ€è¦æ·±å…¥äº†è§£å…¶å†…éƒ¨æœºåˆ¶å¹¶é‡‡ç”¨æ­£ç¡®çš„ä¼˜åŒ–ç­–ç•¥ã€‚æœ¬æ–‡å°†åˆ†äº«Vue 3æ€§èƒ½ä¼˜åŒ–çš„å®æˆ˜ç»éªŒå’Œæœ€ä½³å®è·µã€‚\nVue 3æ€§èƒ½æå‡æ¦‚è¿° æ ¸å¿ƒæ”¹è¿› ç¼–è¯‘æ—¶ä¼˜åŒ–ï¼šæ¨¡æ¿ç¼–è¯‘æ—¶çš„ä¼˜åŒ–æ ‡è®° å“åº”å¼ç³»ç»Ÿé‡å†™ï¼šåŸºäºProxyçš„å“åº”å¼ç³»ç»Ÿ Tree-shakingå‹å¥½ï¼šæ›´å¥½çš„æ¨¡å—åŒ–è®¾è®¡ åŒ…ä½“ç§¯å‡å°‘ï¼šè¿è¡Œæ—¶ä½“ç§¯æ›´å° æ€§èƒ½åŸºå‡†å¯¹æ¯” Vue 2 vs Vue 3 æ€§èƒ½æå‡ï¼š - åˆå§‹åŒ–æ¸²æŸ“ï¼šå¿«1.3-2å€ - æ›´æ–°æ¸²æŸ“ï¼šå¿«1.3-1.6å€ - å†…å­˜å ç”¨ï¼šå‡å°‘çº¦50% - åŒ…ä½“ç§¯ï¼šå‡å°‘çº¦41% æ¸²æŸ“æ€§èƒ½ä¼˜åŒ– 1. é™æ€æå‡ (Static Hoisting) Vue 3ç¼–è¯‘å™¨ä¼šè‡ªåŠ¨è¯†åˆ«é™æ€èŠ‚ç‚¹å¹¶è¿›è¡Œæå‡ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 \u0026lt;!-- ç¼–è¯‘å‰ --\u0026gt; \u0026lt;template\u0026gt; \u0026lt;div class=\u0026#34;container\u0026#34;\u0026gt; \u0026lt;h1\u0026gt;{{ title }}\u0026lt;/h1\u0026gt; \u0026lt;p\u0026gt;é™æ€å†…å®¹\u0026lt;/p\u0026gt; \u0026lt;span\u0026gt;å¦ä¸€ä¸ªé™æ€å†…å®¹\u0026lt;/span\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/template\u0026gt; \u0026lt;!-- ç¼–è¯‘åä¼˜åŒ– --\u0026gt; \u0026lt;script\u0026gt; // é™æ€èŠ‚ç‚¹è¢«æå–åˆ°æ¸²æŸ“å‡½æ•°å¤–éƒ¨ const _hoisted_1 = { class: \u0026#34;container\u0026#34; } const _hoisted_2 = /*#__PURE__*/createVNode(\u0026#34;p\u0026#34;, null, \u0026#34;é™æ€å†…å®¹\u0026#34;, -1) const _hoisted_3 = /*#__PURE__*/createVNode(\u0026#34;span\u0026#34;, null, \u0026#34;å¦ä¸€ä¸ªé™æ€å†…å®¹\u0026#34;, -1) export function render(_ctx, _cache) { return (openBlock(), createBlock(\u0026#34;div\u0026#34;, _hoisted_1, [ createVNode(\u0026#34;h1\u0026#34;, null, toDisplayString(_ctx.title), 1), _hoisted_2, _hoisted_3 ])) } \u0026lt;/script\u0026gt; 2. è¡¥ä¸æ ‡è®° (Patch Flags) Vue 3ä½¿ç”¨è¡¥ä¸æ ‡è®°å®ç°æ›´ç²¾ç¡®çš„æ›´æ–°ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 \u0026lt;template\u0026gt; \u0026lt;div\u0026gt; \u0026lt;!-- åªæœ‰æ–‡æœ¬ä¼šå˜åŒ– --\u0026gt; \u0026lt;p\u0026gt;{{ message }}\u0026lt;/p\u0026gt; \u0026lt;!-- åªæœ‰classä¼šå˜åŒ– --\u0026gt; \u0026lt;div :class=\u0026#34;activeClass\u0026#34;\u0026gt;å†…å®¹\u0026lt;/div\u0026gt; \u0026lt;!-- åªæœ‰idä¼šå˜åŒ– --\u0026gt; \u0026lt;span :id=\u0026#34;dynamicId\u0026#34;\u0026gt;é™æ€æ–‡æœ¬\u0026lt;/span\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/template\u0026gt; \u0026lt;!-- ç¼–è¯‘å --\u0026gt; \u0026lt;script\u0026gt; export function render(_ctx, _cache) { return (openBlock(), createBlock(\u0026#34;div\u0026#34;, null, [ createVNode(\u0026#34;p\u0026#34;, null, toDisplayString(_ctx.message), 1 /* TEXT */), createVNode(\u0026#34;div\u0026#34;, { class: _ctx.activeClass }, \u0026#34;å†…å®¹\u0026#34;, 2 /* CLASS */), createVNode(\u0026#34;span\u0026#34;, { id: _ctx.dynamicId }, \u0026#34;é™æ€æ–‡æœ¬\u0026#34;, 8 /* PROPS */, [\u0026#34;id\u0026#34;]) ])) } \u0026lt;/script\u0026gt; 3. ç¼“å­˜äº‹ä»¶å¤„ç†å™¨ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 \u0026lt;!-- âŒ æ¯æ¬¡æ¸²æŸ“éƒ½ä¼šåˆ›å»ºæ–°å‡½æ•° --\u0026gt; \u0026lt;button @click=\u0026#34;() =\u0026gt; count++\u0026#34;\u0026gt;å¢åŠ \u0026lt;/button\u0026gt; \u0026lt;!-- âœ… ä½¿ç”¨ç¼“å­˜çš„äº‹ä»¶å¤„ç†å™¨ --\u0026gt; \u0026lt;button @click=\u0026#34;increment\u0026#34;\u0026gt;å¢åŠ \u0026lt;/button\u0026gt; \u0026lt;script\u0026gt; export default { methods: { increment() { this.count++ } } } \u0026lt;/script\u0026gt; 4. åˆç†ä½¿ç”¨v-onceå’Œv-memo 1 2 3 4 5 6 7 8 9 10 11 12 13 14 \u0026lt;template\u0026gt; \u0026lt;!-- v-onceï¼šåªæ¸²æŸ“ä¸€æ¬¡ï¼Œåç»­æ›´æ–°è·³è¿‡ --\u0026gt; \u0026lt;div v-once\u0026gt; \u0026lt;h1\u0026gt;{{ title }}\u0026lt;/h1\u0026gt; \u0026lt;p\u0026gt;{{ description }}\u0026lt;/p\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;!-- v-memoï¼šæ¡ä»¶ç¼“å­˜ï¼Œä¾èµ–å€¼å˜åŒ–æ—¶æ‰é‡æ–°æ¸²æŸ“ --\u0026gt; \u0026lt;div v-memo=\u0026#34;[user.id, user.name]\u0026#34;\u0026gt; \u0026lt;h2\u0026gt;{{ user.name }}\u0026lt;/h2\u0026gt; \u0026lt;p\u0026gt;{{ user.email }}\u0026lt;/p\u0026gt; \u0026lt;p\u0026gt;æ›´æ–°æ—¶é—´ï¼š{{ timestamp }}\u0026lt;/p\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/template\u0026gt; ç»„ä»¶æ€§èƒ½ä¼˜åŒ– 1. ç»„ä»¶æ‡’åŠ è½½ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 // è·¯ç”±çº§æ‡’åŠ è½½ const routes = [ { path: \u0026#39;/dashboard\u0026#39;, component: () =\u0026gt; import(\u0026#39;./views/Dashboard.vue\u0026#39;) } ] // ç»„ä»¶çº§æ‡’åŠ è½½ export default { components: { HeavyComponent: () =\u0026gt; import(\u0026#39;./HeavyComponent.vue\u0026#39;) } } // å¼‚æ­¥ç»„ä»¶withé€‰é¡¹ const AsyncComponent = defineAsyncComponent({ loader: () =\u0026gt; import(\u0026#39;./HeavyComponent.vue\u0026#39;), loadingComponent: LoadingComponent, errorComponent: ErrorComponent, delay: 200, timeout: 3000 }) 2. å‡½æ•°å¼ç»„ä»¶ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 \u0026lt;!-- å¯¹äºæ— çŠ¶æ€ç»„ä»¶ï¼Œä½¿ç”¨å‡½æ•°å¼ç»„ä»¶ --\u0026gt; \u0026lt;script\u0026gt; export default { functional: true, props: [\u0026#39;title\u0026#39;, \u0026#39;content\u0026#39;], render(h, { props }) { return h(\u0026#39;div\u0026#39;, [ h(\u0026#39;h2\u0026#39;, props.title), h(\u0026#39;p\u0026#39;, props.content) ]) } } \u0026lt;/script\u0026gt; \u0026lt;!-- Vue 3 Composition APIç‰ˆæœ¬ --\u0026gt; \u0026lt;script setup\u0026gt; const props = defineProps([\u0026#39;title\u0026#39;, \u0026#39;content\u0026#39;]) \u0026lt;/script\u0026gt; \u0026lt;template\u0026gt; \u0026lt;div\u0026gt; \u0026lt;h2\u0026gt;{{ title }}\u0026lt;/h2\u0026gt; \u0026lt;p\u0026gt;{{ content }}\u0026lt;/p\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/template\u0026gt; 3. åˆç†ä½¿ç”¨è®¡ç®—å±æ€§ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 // âœ… ç¼“å­˜è®¡ç®—ç»“æœï¼Œé¿å…é‡å¤è®¡ç®— const expensiveValue = computed(() =\u0026gt; { // å¤æ‚è®¡ç®—é€»è¾‘ return heavyCalculation(source.value) }) // âŒ é¿å…åœ¨æ¨¡æ¿ä¸­ä½¿ç”¨å¤æ‚è¡¨è¾¾å¼ \u0026lt;template\u0026gt; \u0026lt;div\u0026gt;{{ heavyCalculation(data) }}\u0026lt;/div\u0026gt; \u0026lt;/template\u0026gt; // âœ… ä½¿ç”¨è®¡ç®—å±æ€§ \u0026lt;template\u0026gt; \u0026lt;div\u0026gt;{{ expensiveValue }}\u0026lt;/div\u0026gt; \u0026lt;/template\u0026gt; å“åº”å¼æ€§èƒ½ä¼˜åŒ– 1. åˆç†ä½¿ç”¨reactiveå’Œref 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 // âœ… åŸºç¡€ç±»å‹ä½¿ç”¨ref const count = ref(0) const message = ref(\u0026#39;hello\u0026#39;) // âœ… å¯¹è±¡ä½¿ç”¨reactive const user = reactive({ name: \u0026#39;John\u0026#39;, age: 30, address: { city: \u0026#39;Beijing\u0026#39; } }) // âœ… å¤§å‹æ•°æ®ä½¿ç”¨shallowRefé¿å…æ·±åº¦å“åº”å¼ const largeData = shallowRef({ // å¤§é‡æ•°æ® }) // ä¿®æ”¹æ—¶è§¦å‘æ›´æ–° largeData.value = newData 2. ä½¿ç”¨readonlyä¿æŠ¤æ•°æ® 1 2 3 4 5 6 7 8 9 10 const user = reactive({ name: \u0026#39;John\u0026#39;, age: 30 }) // åˆ›å»ºåªè¯»å‰¯æœ¬ const readonlyUser = readonly(user) // ä¼ é€’ç»™å­ç»„ä»¶ï¼Œé˜²æ­¢æ„å¤–ä¿®æ”¹ provide(\u0026#39;user\u0026#39;, readonlyUser) 3. é¿å…ä¸å¿…è¦çš„å“åº”å¼ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 // âŒ å°†æ•´ä¸ªé…ç½®å¯¹è±¡è®¾ä¸ºå“åº”å¼ const config = reactive({ apiEndpoint: \u0026#39;https://api.example.com\u0026#39;, timeout: 5000, version: \u0026#39;1.0.0\u0026#39; }) // âœ… åªæœ‰åŠ¨æ€éƒ¨åˆ†ä½¿ç”¨å“åº”å¼ const dynamicSettings = reactive({ theme: \u0026#39;light\u0026#39;, language: \u0026#39;en\u0026#39; }) // é™æ€é…ç½®ä¿æŒæ™®é€šå¯¹è±¡ const staticConfig = { apiEndpoint: \u0026#39;https://api.example.com\u0026#39;, timeout: 5000, version: \u0026#39;1.0.0\u0026#39; } åˆ—è¡¨æ¸²æŸ“ä¼˜åŒ– 1. è™šæ‹Ÿæ»šåŠ¨ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 \u0026lt;template\u0026gt; \u0026lt;!-- ä½¿ç”¨vue-virtual-scroller --\u0026gt; \u0026lt;RecycleScroller class=\u0026#34;scroller\u0026#34; :items=\u0026#34;items\u0026#34; :item-size=\u0026#34;50\u0026#34; key-field=\u0026#34;id\u0026#34; v-slot=\u0026#34;{ item }\u0026#34; \u0026gt; \u0026lt;div class=\u0026#34;item\u0026#34; :style=\u0026#34;{ height: \u0026#39;50px\u0026#39; }\u0026#34;\u0026gt; {{ item.name }} \u0026lt;/div\u0026gt; \u0026lt;/RecycleScroller\u0026gt; \u0026lt;/template\u0026gt; \u0026lt;script\u0026gt; import { RecycleScroller } from \u0026#39;vue-virtual-scroller\u0026#39; import \u0026#39;vue-virtual-scroller/dist/vue-virtual-scroller.css\u0026#39; export default { components: { RecycleScroller }, data() { return { items: Array.from({ length: 10000 }, (_, i) =\u0026gt; ({ id: i, name: `Item ${i}` })) } } } \u0026lt;/script\u0026gt; 2. åˆ—è¡¨keyçš„æœ€ä½³å®è·µ 1 2 3 4 5 6 7 8 9 10 11 \u0026lt;!-- âŒ ä½¿ç”¨indexä½œä¸ºkey --\u0026gt; \u0026lt;div v-for=\u0026#34;(item, index) in items\u0026#34; :key=\u0026#34;index\u0026#34;\u0026gt; \u0026lt;!-- âœ… ä½¿ç”¨å”¯ä¸€ç¨³å®šçš„æ ‡è¯†ç¬¦ --\u0026gt; \u0026lt;div v-for=\u0026#34;item in items\u0026#34; :key=\u0026#34;item.id\u0026#34;\u0026gt; \u0026lt;!-- âŒ åŠ¨æ€ç”Ÿæˆçš„key --\u0026gt; \u0026lt;div v-for=\u0026#34;item in items\u0026#34; :key=\u0026#34;`${item.type}-${item.timestamp}`\u0026#34;\u0026gt; \u0026lt;!-- âœ… ç»„åˆå¤šä¸ªå­—æ®µç”Ÿæˆç¨³å®šçš„key --\u0026gt; \u0026lt;div v-for=\u0026#34;item in items\u0026#34; :key=\u0026#34;`${item.id}-${item.version}`\u0026#34;\u0026gt; 3. å‡å°‘åˆ—è¡¨é¡¹çš„å¤æ‚åº¦ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 \u0026lt;!-- âŒ å¤æ‚çš„æ¨¡æ¿é€»è¾‘ --\u0026gt; \u0026lt;template\u0026gt; \u0026lt;div v-for=\u0026#34;user in users\u0026#34; :key=\u0026#34;user.id\u0026#34;\u0026gt; \u0026lt;div class=\u0026#34;user-card\u0026#34;\u0026gt; \u0026lt;h3\u0026gt;{{ formatName(user.firstName, user.lastName) }}\u0026lt;/h3\u0026gt; \u0026lt;p :class=\u0026#34;getStatusClass(user.status)\u0026#34;\u0026gt;{{ getStatusText(user.status) }}\u0026lt;/p\u0026gt; \u0026lt;span v-if=\u0026#34;user.isActive\u0026#34; class=\u0026#34;badge\u0026#34;\u0026gt;æ´»è·ƒ\u0026lt;/span\u0026gt; \u0026lt;button @click=\u0026#34;handleUserAction(user)\u0026#34; :disabled=\u0026#34;!canEdit(user)\u0026#34;\u0026gt; {{ getActionText(user) }} \u0026lt;/button\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/template\u0026gt; \u0026lt;!-- âœ… ç®€åŒ–æ¨¡æ¿ï¼Œä½¿ç”¨è®¡ç®—å±æ€§ --\u0026gt; \u0026lt;template\u0026gt; \u0026lt;div v-for=\u0026#34;user in processedUsers\u0026#34; :key=\u0026#34;user.id\u0026#34;\u0026gt; \u0026lt;UserCard :user=\u0026#34;user\u0026#34; @action=\u0026#34;handleUserAction\u0026#34; /\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/template\u0026gt; \u0026lt;script\u0026gt; const processedUsers = computed(() =\u0026gt; users.map(user =\u0026gt; ({ ...user, formattedName: formatName(user.firstName, user.lastName), statusClass: getStatusClass(user.status), statusText: getStatusText(user.status), actionText: getActionText(user), canEdit: canEdit(user) })) ) \u0026lt;/script\u0026gt; å†…å­˜ç®¡ç†ä¼˜åŒ– 1. åŠæ—¶æ¸…ç†äº‹ä»¶ç›‘å¬å™¨ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 \u0026lt;script\u0026gt; export default { mounted() { // æ·»åŠ å…¨å±€äº‹ä»¶ç›‘å¬ window.addEventListener(\u0026#39;resize\u0026#39;, this.handleResize) document.addEventListener(\u0026#39;click\u0026#39;, this.handleDocumentClick) // æ·»åŠ å®šæ—¶å™¨ this.timer = setInterval(this.updateData, 1000) }, beforeUnmount() { // æ¸…ç†äº‹ä»¶ç›‘å¬å™¨ window.removeEventListener(\u0026#39;resize\u0026#39;, this.handleResize) document.removeEventListener(\u0026#39;click\u0026#39;, this.handleDocumentClick) // æ¸…ç†å®šæ—¶å™¨ if (this.timer) { clearInterval(this.timer) } } } \u0026lt;/script\u0026gt; 2. é¿å…å†…å­˜æ³„æ¼çš„æœ€ä½³å®è·µ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 // âŒ åœ¨ç»„ä»¶å¤–éƒ¨å¼•ç”¨å“åº”å¼æ•°æ® let globalRef export default { setup() { const state = reactive({ count: 0 }) globalRef = state // å†…å­˜æ³„æ¼é£é™© return { state } } } // âœ… æ­£ç¡®çš„å¤„ç†æ–¹å¼ export default { setup() { const state = reactive({ count: 0 }) onBeforeUnmount(() =\u0026gt; { // æ¸…ç†å¼•ç”¨ globalRef = null }) return { state } } } 3. ä½¿ç”¨WeakMapå’ŒWeakSet 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 // WeakMapï¼šé”®ä¸ºå¼±å¼•ç”¨ï¼Œä¸ä¼šé˜»æ­¢åƒåœ¾å›æ”¶ const metadataCache = new WeakMap() function setMetadata(obj, metadata) { metadataCache.set(obj, metadata) } function getMetadata(obj) { return metadataCache.get(obj) } // WeakSetï¼šæˆå‘˜ä¸ºå¼±å¼•ç”¨ const processedObjects = new WeakSet() function processOnce(obj) { if (processedObjects.has(obj)) { return obj } // å¤„ç†é€»è¾‘ processedObjects.add(obj) return obj } ä»£ç åˆ†å‰²å’Œæ‰“åŒ…ä¼˜åŒ– 1. è·¯ç”±çº§åˆ«çš„ä»£ç åˆ†å‰² 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 // router/index.js const routes = [ { path: \u0026#39;/\u0026#39;, name: \u0026#39;Home\u0026#39;, component: () =\u0026gt; import(\u0026#39;../views/Home.vue\u0026#39;) }, { path: \u0026#39;/about\u0026#39;, name: \u0026#39;About\u0026#39;, component: () =\u0026gt; import(\u0026#39;../views/About.vue\u0026#39;) }, { path: \u0026#39;/dashboard\u0026#39;, name: \u0026#39;Dashboard\u0026#39;, component: () =\u0026gt; import(\u0026#39;../views/Dashboard.vue\u0026#39;) } ] // é¢„åŠ è½½ç­–ç•¥ const routes = [ { path: \u0026#39;/\u0026#39;, component: () =\u0026gt; import(\u0026#39;../views/Home.vue\u0026#39;) }, { path: \u0026#39;/about\u0026#39;, component: () =\u0026gt; import( /* webpackPrefetch: true */ /* webpackChunkName: \u0026#34;about\u0026#34; */ \u0026#39;../views/About.vue\u0026#39; ) } ] 2. ç»„ä»¶çº§åˆ«çš„æ‡’åŠ è½½ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 \u0026lt;template\u0026gt; \u0026lt;div\u0026gt; \u0026lt;HeavyComponent v-if=\u0026#34;showHeavy\u0026#34; /\u0026gt; \u0026lt;button @click=\u0026#34;loadHeavyComponent\u0026#34;\u0026gt;åŠ è½½ç»„ä»¶\u0026lt;/button\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/template\u0026gt; \u0026lt;script\u0026gt; export default { data() { return { showHeavy: false, HeavyComponent: null } }, methods: { async loadHeavyComponent() { if (!this.HeavyComponent) { this.HeavyComponent = () =\u0026gt; import(\u0026#39;./HeavyComponent.vue\u0026#39;) } this.showHeavy = true } } } \u0026lt;/script\u0026gt; 3. Tree-shakingä¼˜åŒ– 1 2 3 4 5 6 7 8 9 10 // âœ… ä½¿ç”¨å…·åå¯¼å…¥ï¼Œä¾¿äºtree-shaking import { ref, reactive, computed } from \u0026#39;vue\u0026#39; // âŒ é¿å…å…¨é‡å¯¼å…¥ import * as Vue from \u0026#39;vue\u0026#39; // æŒ‰éœ€å¼•å…¥ç¬¬ä¸‰æ–¹åº“ import { debounce } from \u0026#39;lodash-es/debounce\u0026#39; // è€Œä¸æ˜¯ import _ from \u0026#39;lodash\u0026#39; æ€§èƒ½ç›‘æ§å’Œè°ƒè¯• 1. Vue DevToolsæ€§èƒ½åˆ†æ 1 2 3 4 5 6 7 8 9 10 11 // å®‰è£…Vue DevTools // npm install --save-dev @vue/devtools // åœ¨å¼€å‘ç¯å¢ƒä¸­å¯ç”¨ if (process.env.NODE_ENV === \u0026#39;development\u0026#39;) { const { createApp } = require(\u0026#39;vue\u0026#39;) const app = createApp(App) // å¯ç”¨æ€§èƒ½è¿½è¸ª app.config.performance = true } 2. è‡ªå®šä¹‰æ€§èƒ½ç›‘æ§ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 // æ€§èƒ½ç›‘æ§å·¥å…· class PerformanceMonitor { constructor() { this.metrics = {} } startMeasure(name) { this.metrics[name] = performance.now() } endMeasure(name) { if (this.metrics[name]) { const duration = performance.now() - this.metrics[name] console.log(`${name}: ${duration.toFixed(2)}ms`) delete this.metrics[name] return duration } } measureAsync(name, fn) { return async (...args) =\u0026gt; { this.startMeasure(name) try { const result = await fn(...args) this.endMeasure(name) return result } catch (error) { this.endMeasure(name) throw error } } } } // åœ¨ç»„ä»¶ä¸­ä½¿ç”¨ const monitor = new PerformanceMonitor() export default { async mounted() { await monitor.measureAsync(\u0026#39;dataLoading\u0026#39;, () =\u0026gt; { return this.loadData() }) } } 3. å†…å­˜ä½¿ç”¨ç›‘æ§ 1 2 3 4 5 6 7 8 9 10 11 12 13 // å†…å­˜ä½¿ç”¨ç›‘æ§ function checkMemoryUsage() { if (performance.memory) { const memory = performance.memory console.log(\u0026#39;å†…å­˜ä½¿ç”¨æƒ…å†µ:\u0026#39;) console.log(`å·²ä½¿ç”¨: ${(memory.usedJSHeapSize / 1024 / 1024).toFixed(2)} MB`) console.log(`æ€»è®¡: ${(memory.totalJSHeapSize / 1024 / 1024).toFixed(2)} MB`) console.log(`é™åˆ¶: ${(memory.jsHeapSizeLimit / 1024 / 1024).toFixed(2)} MB`) } } // å®šæœŸæ£€æŸ¥ setInterval(checkMemoryUsage, 30000) // æ¯30ç§’æ£€æŸ¥ä¸€æ¬¡ å®æˆ˜æ¡ˆä¾‹ï¼šä¼˜åŒ–å¤§å‹æ•°æ®è¡¨æ ¼ ä¼˜åŒ–å‰çš„é—®é¢˜ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 \u0026lt;!-- âŒ æ€§èƒ½é—®é¢˜ --\u0026gt; \u0026lt;template\u0026gt; \u0026lt;table\u0026gt; \u0026lt;tr v-for=\u0026#34;item in 10000items\u0026#34; :key=\u0026#34;item.id\u0026#34;\u0026gt; \u0026lt;td\u0026gt;{{ item.name }}\u0026lt;/td\u0026gt; \u0026lt;td\u0026gt;{{ item.email }}\u0026lt;/td\u0026gt; \u0026lt;td\u0026gt;{{ formatDate(item.createdAt) }}\u0026lt;/td\u0026gt; \u0026lt;td\u0026gt;{{ getStatusText(item.status) }}\u0026lt;/td\u0026gt; \u0026lt;td\u0026gt; \u0026lt;button @click=\u0026#34;editItem(item)\u0026#34;\u0026gt;ç¼–è¾‘\u0026lt;/button\u0026gt; \u0026lt;button @click=\u0026#34;deleteItem(item)\u0026#34;\u0026gt;åˆ é™¤\u0026lt;/button\u0026gt; \u0026lt;/td\u0026gt; \u0026lt;/tr\u0026gt; \u0026lt;/table\u0026gt; \u0026lt;/template\u0026gt; ä¼˜åŒ–åçš„è§£å†³æ–¹æ¡ˆ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 \u0026lt;template\u0026gt; \u0026lt;div class=\u0026#34;virtual-table-container\u0026#34;\u0026gt; \u0026lt;!-- ä½¿ç”¨è™šæ‹Ÿæ»šåŠ¨ --\u0026gt; \u0026lt;RecycleScroller class=\u0026#34;scroller\u0026#34; :items=\u0026#34;visibleItems\u0026#34; :item-size=\u0026#34;50\u0026#34; key-field=\u0026#34;id\u0026#34; v-slot=\u0026#34;{ item }\u0026#34; \u0026gt; \u0026lt;TableRow :item=\u0026#34;item\u0026#34; :columns=\u0026#34;columns\u0026#34; @edit=\u0026#34;handleEdit\u0026#34; @delete=\u0026#34;handleDelete\u0026#34; /\u0026gt; \u0026lt;/RecycleScroller\u0026gt; \u0026lt;!-- åˆ†é¡µæ§åˆ¶ --\u0026gt; \u0026lt;div class=\u0026#34;pagination\u0026#34;\u0026gt; \u0026lt;button v-for=\u0026#34;page in visiblePages\u0026#34; :key=\u0026#34;page\u0026#34; @click=\u0026#34;currentPage = page\u0026#34; :class=\u0026#34;{ active: currentPage === page }\u0026#34; \u0026gt; {{ page }} \u0026lt;/button\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/template\u0026gt; \u0026lt;script\u0026gt; import { computed, ref } from \u0026#39;vue\u0026#39; import { RecycleScroller } from \u0026#39;vue-virtual-scroller\u0026#39; import TableRow from \u0026#39;./TableRow.vue\u0026#39; export default { components: { RecycleScroller, TableRow }, props: { items: Array, pageSize: { type: Number, default: 50 } }, setup(props) { const currentPage = ref(1) // è®¡ç®—å½“å‰é¡µçš„æ•°æ® const visibleItems = computed(() =\u0026gt; { const start = (currentPage.value - 1) * props.pageSize const end = start + props.pageSize return props.items.slice(start, end) }) // è®¡ç®—å¯è§é¡µç  const visiblePages = computed(() =\u0026gt; { const totalPages = Math.ceil(props.items.length / props.pageSize) const current = currentPage.value const delta = 2 const range = [] const rangeWithDots = [] for (let i = Math.max(2, current - delta); i \u0026lt;= Math.min(totalPages - 1, current + delta); i++) { range.push(i) } if (current - delta \u0026gt; 2) { rangeWithDots.push(1, \u0026#39;...\u0026#39;) } rangeWithDots.push(...range) if (current + delta \u0026lt; totalPages - 1) { rangeWithDots.push(\u0026#39;...\u0026#39;, totalPages) } return rangeWithDots.filter(Boolean) }) return { currentPage, visibleItems, visiblePages } } } \u0026lt;/script\u0026gt; \u0026lt;style scoped\u0026gt; .virtual-table-container { height: 600px; overflow: hidden; } .scroller { height: 500px; } .pagination { display: flex; justify-content: center; gap: 8px; margin-top: 16px; } .pagination button { padding: 8px 12px; border: 1px solid #ddd; background: white; cursor: pointer; } .pagination button.active { background: #007bff; color: white; border-color: #007bff; } \u0026lt;/style\u0026gt; æ€»ç»“ Vue 3çš„æ€§èƒ½ä¼˜åŒ–éœ€è¦ä»å¤šä¸ªç»´åº¦è€ƒè™‘ï¼š\næ ¸å¿ƒä¼˜åŒ–ç­–ç•¥ æ¸²æŸ“ä¼˜åŒ–ï¼šåˆ©ç”¨ç¼–è¯‘æ—¶ä¼˜åŒ–å’Œè¡¥ä¸æ ‡è®° ç»„ä»¶ä¼˜åŒ–ï¼šåˆç†ä½¿ç”¨æ‡’åŠ è½½å’Œå‡½æ•°å¼ç»„ä»¶ å“åº”å¼ä¼˜åŒ–ï¼šé¿å…ä¸å¿…è¦çš„æ·±åº¦å“åº”å¼ åˆ—è¡¨ä¼˜åŒ–ï¼šè™šæ‹Ÿæ»šåŠ¨å’Œåˆç†çš„keyç­–ç•¥ å†…å­˜ç®¡ç†ï¼šåŠæ—¶æ¸…ç†å’Œé¿å…å†…å­˜æ³„æ¼ å¼€å‘æœ€ä½³å®è·µ æ€§èƒ½ç›‘æ§ï¼šå»ºç«‹å®Œå–„çš„æ€§èƒ½ç›‘æ§ä½“ç³» ä»£ç åˆ†å‰²ï¼šåˆç†æ‹†åˆ†ä»£ç ï¼ŒæŒ‰éœ€åŠ è½½ Bundleä¼˜åŒ–ï¼šå……åˆ†åˆ©ç”¨Tree-shaking å·¥å…·ä½¿ç”¨ï¼šå–„ç”¨Vue DevToolsç­‰è°ƒè¯•å·¥å…· é€šè¿‡åº”ç”¨è¿™äº›ä¼˜åŒ–ç­–ç•¥ï¼Œä½ å¯ä»¥æ„å»ºå‡ºé«˜æ€§èƒ½ã€æµç•…çš„Vue 3åº”ç”¨ï¼Œä¸ºç”¨æˆ·æä¾›å“è¶Šçš„ä½¿ç”¨ä½“éªŒã€‚è®°ä½ï¼Œæ€§èƒ½ä¼˜åŒ–æ˜¯ä¸€ä¸ªæŒç»­çš„è¿‡ç¨‹ï¼Œéœ€è¦æ ¹æ®å®é™…åº”ç”¨åœºæ™¯ä¸æ–­è°ƒæ•´å’Œä¼˜åŒ–ã€‚\n","permalink":"/blog/articles/vue3-performance-optimization/","summary":"æ·±å…¥æ¢è®¨Vue 3åº”ç”¨çš„æ€§èƒ½ä¼˜åŒ–ç­–ç•¥ï¼Œæ¶µç›–æ¸²æŸ“ä¼˜åŒ–ã€ç»„ä»¶æ‡’åŠ è½½ã€å†…å­˜ç®¡ç†ã€è™šæ‹Ÿæ»šåŠ¨ç­‰å¤šä¸ªæ–¹é¢çš„å®æˆ˜æŠ€å·§ã€‚","title":"Vue 3æ€§èƒ½ä¼˜åŒ–å®æˆ˜æŒ‡å—ï¼šä»æ¸²æŸ“åˆ°å†…å­˜ç®¡ç†çš„å…¨æ–¹ä½ä¼˜åŒ–"},{"content":"TypeScriptçš„æ³›å‹ç³»ç»Ÿæ˜¯å…¶æœ€å¼ºå¤§çš„ç‰¹æ€§ä¹‹ä¸€ï¼Œå®ƒè®©æˆ‘ä»¬èƒ½å¤Ÿç¼–å†™å¯é‡ç”¨ã€ç±»å‹å®‰å…¨çš„ä»£ç ã€‚æœ¬æ–‡å°†æ·±å…¥æ¢è®¨TypeScriptæ³›å‹çš„é«˜çº§æŠ€å·§ï¼Œå¸®åŠ©ä½ å……åˆ†å‘æŒ¥è¿™ä¸ªå¼ºå¤§å·¥å…·çš„æ½œåŠ›ã€‚\næ³›å‹åŸºç¡€å›é¡¾ åŸºæœ¬æ³›å‹è¯­æ³• 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 // åŸºæœ¬æ³›å‹å‡½æ•° function identity\u0026lt;T\u0026gt;(arg: T): T { return arg; } // æ³›å‹æ¥å£ interface Box\u0026lt;T\u0026gt; { value: T; } // æ³›å‹ç±» class Container\u0026lt;T\u0026gt; { private value: T; constructor(value: T) { this.value = value; } getValue(): T { return this.value; } } æ¡ä»¶ç±»å‹ (Conditional Types) æ¡ä»¶ç±»å‹å…è®¸æˆ‘ä»¬æ ¹æ®ç±»å‹å…³ç³»æ¥é€‰æ‹©ç±»å‹ï¼Œè¿™æ˜¯TypeScript 2.8å¼•å…¥çš„å¼ºå¤§ç‰¹æ€§ã€‚\nåŸºæœ¬æ¡ä»¶ç±»å‹ 1 2 3 4 5 6 7 8 9 10 11 // åŸºæœ¬è¯­æ³• type IsString\u0026lt;T\u0026gt; = T extends string ? true : false; type Test1 = IsString\u0026lt;string\u0026gt;; // true type Test2 = IsString\u0026lt;number\u0026gt;; // false // å®ç”¨ç¤ºä¾‹ï¼šæå–æ•°ç»„å…ƒç´ ç±»å‹ type ArrayElement\u0026lt;T\u0026gt; = T extends (infer U)[] ? U : never; type StringArray = string[]; type ElementType = ArrayElement\u0026lt;StringArray\u0026gt;; // string æ¡ä»¶ç±»å‹ä¸æ³›å‹çº¦æŸç»“åˆ 1 2 3 4 5 6 7 8 9 10 11 12 // æ³›å‹çº¦æŸ + æ¡ä»¶ç±»å‹ interface HasLength { length: number; } type GetLength\u0026lt;T extends HasLength\u0026gt; = T[\u0026#39;length\u0026#39;]; // å¤æ‚çš„æ¡ä»¶ç±»å‹ type NonNullable\u0026lt;T\u0026gt; = T extends null | undefined ? never : T; type Example1 = NonNullable\u0026lt;string\u0026gt;; // string type Example2 = NonNullable\u0026lt;null\u0026gt;; // never æ˜ å°„ç±»å‹ (Mapped Types) æ˜ å°„ç±»å‹å…è®¸æˆ‘ä»¬åŸºäºæ—§ç±»å‹åˆ›å»ºæ–°ç±»å‹ï¼Œé€šè¿‡éå†å±æ€§æ¥è½¬æ¢ç±»å‹ã€‚\nåŸºæœ¬æ˜ å°„ç±»å‹ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 // å°†æ‰€æœ‰å±æ€§è®¾ä¸ºå¯é€‰ type Partial\u0026lt;T\u0026gt; = { [P in keyof T]?: T[P]; }; interface User { id: number; name: string; email: string; } type PartialUser = Partial\u0026lt;User\u0026gt;; // ç»“æœ: { id?: number; name?: string; email?: string; } // å°†æ‰€æœ‰å±æ€§è®¾ä¸ºå¿…éœ€ type Required\u0026lt;T\u0026gt; = { [P in keyof T]-?: T[P]; }; // åªè¯»æ˜ å°„ type Readonly\u0026lt;T\u0026gt; = { readonly [P in keyof T]: T[P]; }; é«˜çº§æ˜ å°„ç±»å‹ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 // é€‰æ‹©ç‰¹å®šå±æ€§ type Pick\u0026lt;T, K extends keyof T\u0026gt; = { [P in K]: T[P]; }; type UserWithoutEmail = Pick\u0026lt;User, \u0026#39;id\u0026#39; | \u0026#39;name\u0026#39;\u0026gt;; // ç»“æœ: { id: number; name: string; } // æ’é™¤ç‰¹å®šå±æ€§ type Omit\u0026lt;T, K extends keyof T\u0026gt; = Pick\u0026lt;T, Exclude\u0026lt;keyof T, K\u0026gt;\u0026gt;; type UserWithoutId = Omit\u0026lt;User, \u0026#39;id\u0026#39;\u0026gt;; // ç»“æœ: { name: string; email: string; } // è½¬æ¢å±æ€§ç±»å‹ type Stringify\u0026lt;T\u0026gt; = { [K in keyof T]: string; }; type StringifiedUser = Stringify\u0026lt;User\u0026gt;; // ç»“æœ: { id: string; name: string; email: string; } æ¨¡æ¿å­—é¢é‡ç±»å‹ (Template Literal Types) TypeScript 4.1å¼•å…¥äº†æ¨¡æ¿å­—é¢é‡ç±»å‹ï¼Œè®©æˆ‘ä»¬å¯ä»¥æ“ä½œå­—ç¬¦ä¸²ç±»å‹ã€‚\nåŸºæœ¬æ¨¡æ¿å­—é¢é‡ 1 2 3 4 5 6 7 8 9 10 11 12 type Greeting = `Hello, ${string}!`; const message: Greeting = \u0026#34;Hello, World!\u0026#34;; // âœ… const invalid: Greeting = \u0026#34;Hi, World!\u0026#34;; // âŒ // è”åˆç±»å‹ä¸æ¨¡æ¿å­—é¢é‡ type Color = \u0026#34;red\u0026#34; | \u0026#34;green\u0026#34; | \u0026#34;blue\u0026#34;; type Shade = \u0026#34;light\u0026#34; | \u0026#34;dark\u0026#34;; type ColorShade = `${Shade}-${Color}`; // ç»“æœ: \u0026#34;light-red\u0026#34; | \u0026#34;light-green\u0026#34; | \u0026#34;light-blue\u0026#34; | // \u0026#34;dark-red\u0026#34; | \u0026#34;dark-green\u0026#34; | \u0026#34;dark-blue\u0026#34; å®é™…åº”ç”¨ç¤ºä¾‹ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 // CSSå±æ€§ç”Ÿæˆå™¨ type CSSProperty = `padding${\u0026#34;Top\u0026#34; | \u0026#34;Right\u0026#34; | \u0026#34;Bottom\u0026#34; | \u0026#34;Left\u0026#34;}` | `margin${\u0026#34;Top\u0026#34; | \u0026#34;Right\u0026#34; | \u0026#34;Bottom\u0026#34; | \u0026#34;Left\u0026#34;}` | `border${\u0026#34;Top\u0026#34; | \u0026#34;Right\u0026#34; | \u0026#34;Bottom\u0026#34; | \u0026#34;Left\u0026#34;}${\u0026#34;Width\u0026#34; | \u0026#34;Color\u0026#34; | \u0026#34;Style\u0026#34;}`; // å‡½æ•°åç”Ÿæˆå™¨ type Getter\u0026lt;T\u0026gt; = `get${Capitalize\u0026lt;string \u0026amp; T\u0026gt;}`; type Setter\u0026lt;T\u0026gt; = `set${Capitalize\u0026lt;string \u0026amp; T\u0026gt;}`; interface UserInfo { name: string; age: number; } type UserGetter = Getter\u0026lt;keyof UserInfo\u0026gt;; // ç»“æœ: \u0026#34;getName\u0026#34; | \u0026#34;getAge\u0026#34; type UserSetter = Setter\u0026lt;keyof UserInfo\u0026gt;; // ç»“æœ: \u0026#34;setName\u0026#34; | \u0026#34;setAge\u0026#34; é«˜çº§æ³›å‹æ¨¡å¼ é€’å½’ç±»å‹ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 // æ·±åº¦åªè¯» type DeepReadonly\u0026lt;T\u0026gt; = { readonly [P in keyof T]: T[P] extends object ? DeepReadonly\u0026lt;T[P]\u0026gt; : T[P]; }; interface Nested { user: { name: string; address: { city: string; }; }; } type DeepReadonlyNested = DeepReadonly\u0026lt;Nested\u0026gt;; // æ‰€æœ‰åµŒå¥—å±æ€§éƒ½å˜ä¸ºåªè¯» // æ·±åº¦Partial type DeepPartial\u0026lt;T\u0026gt; = { [P in keyof T]?: T[P] extends object ? DeepPartial\u0026lt;T[P]\u0026gt; : T[P]; }; å‡½æ•°é‡è½½ä¸æ³›å‹ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 // æ³›å‹é‡è½½ function createElement\u0026lt;T extends string\u0026gt;( tag: T, props?: Record\u0026lt;string, any\u0026gt;, children?: any[] ): T; function createElement\u0026lt;T\u0026gt;( tag: T, props?: Record\u0026lt;string, any\u0026gt;, children?: any[] ): T; // ç±»å‹å®‰å…¨çš„Redux Action Creator type Action\u0026lt;T extends string, P = {}\u0026gt; = { type: T; payload?: P; }; interface ActionCreators\u0026lt;T\u0026gt; { [K in keyof T]: T[K] extends (...args: any[]) =\u0026gt; infer A ? A : never; } function createAction\u0026lt;T extends string\u0026gt;(type: T): () =\u0026gt; Action\u0026lt;T\u0026gt;; function createAction\u0026lt;T extends string, P\u0026gt;(type: T, payloadCreator: (payload: P) =\u0026gt; P): (payload: P) =\u0026gt; Action\u0026lt;T, P\u0026gt;; é«˜çº§å·¥å…·ç±»å‹ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 // æå–Promiseçš„è§£æç±»å‹ type UnwrapPromise\u0026lt;T\u0026gt; = T extends Promise\u0026lt;infer U\u0026gt; ? U : T; type AsyncFunction = () =\u0026gt; Promise\u0026lt;string\u0026gt;; type Result = UnwrapPromise\u0026lt;AsyncFunction\u0026gt;; // string // æå–å‡½æ•°å‚æ•°ç±»å‹ type Parameters\u0026lt;T\u0026gt; = T extends (...args: infer P) =\u0026gt; any ? P : never; type FunctionType = (x: number, y: string) =\u0026gt; boolean; type Params = Parameters\u0026lt;FunctionType\u0026gt;; // [number, string] // æå–å‡½æ•°è¿”å›ç±»å‹ type ReturnType\u0026lt;T\u0026gt; = T extends (...args: any[]) =\u0026gt; infer R ? R : any; type FuncReturn = ReturnType\u0026lt;FunctionType\u0026gt;; // boolean // æ„é€ å‡½æ•°å‚æ•°æå– type ConstructorParameters\u0026lt;T\u0026gt; = T extends new (...args: infer P) =\u0026gt; any ? P : never; // å®ä¾‹ç±»å‹æå– type InstanceType\u0026lt;T\u0026gt; = T extends new (...args: any[]) =\u0026gt; infer R ? R : any; class MyClass { constructor(public id: number, public name: string) {} } type MyClassParams = ConstructorParameters\u0026lt;typeof MyClass\u0026gt;; // [number, string] type MyClassInstance = InstanceType\u0026lt;typeof MyClass\u0026gt;; // MyClass å®é™…åº”ç”¨åœºæ™¯ 1. ç±»å‹å®‰å…¨çš„APIå®¢æˆ·ç«¯ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 interface ApiResponse\u0026lt;T\u0026gt; { data: T; status: number; message: string; } interface User { id: number; name: string; email: string; } class ApiClient { async get\u0026lt;T\u0026gt;(url: string): Promise\u0026lt;ApiResponse\u0026lt;T\u0026gt;\u0026gt; { const response = await fetch(url); return response.json(); } async getUser(id: number): Promise\u0026lt;ApiResponse\u0026lt;User\u0026gt;\u0026gt; { return this.get\u0026lt;User\u0026gt;(`/api/users/${id}`); } } 2. çŠ¶æ€ç®¡ç†ä¸­çš„æ³›å‹ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 interface State\u0026lt;T\u0026gt; { data: T | null; loading: boolean; error: string | null; } interface Action\u0026lt;T, P\u0026gt; { type: string; payload?: P; } type Reducer\u0026lt;S, A extends Action\u0026lt;string, any\u0026gt;\u0026gt; = ( state: S, action: A ) =\u0026gt; S; // ç±»å‹å®‰å…¨çš„Redux reducer function createReducer\u0026lt;S, A extends Action\u0026lt;string, any\u0026gt;\u0026gt;( initialState: S, handlers: Record\u0026lt;string, (state: S, action: A) =\u0026gt; S\u0026gt; ): Reducer\u0026lt;S, A\u0026gt; { return (state = initialState, action) =\u0026gt; { const handler = handlers[action.type]; return handler ? handler(state, action) : state; }; } 3. è¡¨å•éªŒè¯å™¨ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 interface ValidationRule\u0026lt;T\u0026gt; { validate: (value: T) =\u0026gt; boolean; message: string; } type ValidationSchema\u0026lt;T\u0026gt; = { [K in keyof T]?: ValidationRule\u0026lt;T[K]\u0026gt;[]; }; class FormValidator\u0026lt;T extends Record\u0026lt;string, any\u0026gt;\u0026gt; { constructor(private schema: ValidationSchema\u0026lt;T\u0026gt;) {} validate(data: T): { isValid: boolean; errors: Partial\u0026lt;Record\u0026lt;keyof T, string[]\u0026gt;\u0026gt; } { const errors: Partial\u0026lt;Record\u0026lt;keyof T, string[]\u0026gt;\u0026gt; = {}; for (const key in this.schema) { const rules = this.schema[key]; if (rules \u0026amp;\u0026amp; data[key] !== undefined) { const fieldErrors = rules .filter(rule =\u0026gt; !rule.validate(data[key])) .map(rule =\u0026gt; rule.message); if (fieldErrors.length \u0026gt; 0) { errors[key] = fieldErrors; } } } return { isValid: Object.keys(errors).length === 0, errors }; } } // ä½¿ç”¨ç¤ºä¾‹ interface LoginForm { email: string; password: string; } const loginValidator = new FormValidator\u0026lt;LoginForm\u0026gt;({ email: [ { validate: (email) =\u0026gt; /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/.test(email), message: \u0026#34;é‚®ç®±æ ¼å¼æ— æ•ˆ\u0026#34; } ], password: [ { validate: (password) =\u0026gt; password.length \u0026gt;= 8, message: \u0026#34;å¯†ç è‡³å°‘8ä½\u0026#34; } ] }); æ€§èƒ½ä¼˜åŒ–å»ºè®® 1. é¿å…è¿‡åº¦å¤æ‚çš„æ³›å‹ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 // âŒ è¿‡äºå¤æ‚ï¼Œå½±å“ç¼–è¯‘æ€§èƒ½ type UltraComplex\u0026lt;T\u0026gt; = T extends { [K in keyof T]: infer U } ? U extends { [P in keyof U]: infer V } ? V extends (...args: any[]) =\u0026gt; infer R ? R extends Promise\u0026lt;infer PR\u0026gt; ? PR extends Array\u0026lt;infer A\u0026gt; ? A extends { [Q in keyof A]: infer B } ? B extends string ? B : never : never : never : never : never : never; // âœ… ç®€åŒ–ç±»å‹å®šä¹‰ type SimpleType\u0026lt;T\u0026gt; = T extends (...args: any[]) =\u0026gt; infer R ? R : never; 2. ä½¿ç”¨ç±»å‹åˆ«åå‡å°‘é‡å¤ 1 2 3 4 5 6 7 8 // âŒ é‡å¤çš„ç±»å‹å®šä¹‰ function process1\u0026lt;T extends { id: number }\u0026gt;(item: T): T[\u0026#39;id\u0026#39;] { return item.id; } function process2\u0026lt;T extends { id: number }\u0026gt;(item: T): T[\u0026#39;id\u0026#39;] { return item.id; } // âœ… æå–å…¬å…±ç±»å‹ type WithId\u0026lt;T\u0026gt; = T \u0026amp; { id: number }; function process1\u0026lt;T\u0026gt;(item: WithId\u0026lt;T\u0026gt;): number { return item.id; } function process2\u0026lt;T\u0026gt;(item: WithId\u0026lt;T\u0026gt;): number { return item.id; } 3. åˆç†ä½¿ç”¨æ³›å‹çº¦æŸ 1 2 3 4 5 6 7 8 9 10 11 // âœ… æ˜ç¡®çš„çº¦æŸæé«˜ç±»å‹å®‰å…¨æ€§ interface HasId { id: number; } function getById\u0026lt;T extends HasId\u0026gt;( items: T[], id: number ): T | undefined { return items.find(item =\u0026gt; item.id === id); } æœ€ä½³å®è·µæ€»ç»“ åˆç†ä½¿ç”¨æ³›å‹ï¼šåªåœ¨éœ€è¦ç±»å‹é‡ç”¨æ—¶ä½¿ç”¨æ³›å‹ æä¾›æœ‰æ„ä¹‰çš„çº¦æŸï¼šä½¿ç”¨extendså…³é”®å­—é™åˆ¶æ³›å‹èŒƒå›´ ä¼˜å…ˆä½¿ç”¨å·¥å…·ç±»å‹ï¼šå……åˆ†åˆ©ç”¨TypeScriptå†…ç½®çš„å·¥å…·ç±»å‹ ä¿æŒç®€å•ï¼šé¿å…è¿‡åº¦å¤æ‚çš„æ³›å‹å®šä¹‰ æ–‡æ¡£åŒ–å¤æ‚ç±»å‹ï¼šä¸ºå¤æ‚çš„æ³›å‹ç±»å‹æ·»åŠ æ³¨é‡Šè¯´æ˜ æ€§èƒ½è€ƒè™‘ï¼šé¿å…è¿‡äºå¤æ‚çš„é€’å½’ç±»å‹å®šä¹‰ TypeScriptçš„é«˜çº§æ³›å‹ç‰¹æ€§ä¸ºæˆ‘ä»¬æä¾›äº†å¼ºå¤§çš„ç±»å‹ç³»ç»Ÿå·¥å…·ï¼Œåˆç†ä½¿ç”¨è¿™äº›ç‰¹æ€§å¯ä»¥æ˜¾è‘—æå‡ä»£ç çš„ç±»å‹å®‰å…¨æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚é€šè¿‡æŒæ¡è¿™äº›æŠ€å·§ï¼Œä½ å°†èƒ½å¤Ÿç¼–å†™å‡ºæ›´åŠ ä¼˜é›…ã€ç±»å‹å®‰å…¨çš„TypeScriptä»£ç ã€‚\n","permalink":"/blog/articles/advanced-typescript-generics/","summary":"æ·±å…¥æ¢è®¨TypeScriptæ³›å‹çš„é«˜çº§ç”¨æ³•ï¼ŒåŒ…æ‹¬æ¡ä»¶ç±»å‹ã€æ˜ å°„ç±»å‹ã€æ¨¡æ¿å­—é¢é‡ç±»å‹ç­‰ï¼Œå¸®åŠ©ä½ å†™å‡ºæ›´åŠ ç±»å‹å®‰å…¨ä¸”çµæ´»çš„ä»£ç ã€‚","title":"TypeScripté«˜çº§æ³›å‹æŠ€å·§ï¼šæ„å»ºç±»å‹å®‰å…¨ä¸”çµæ´»çš„ä»£ç "},{"content":"å‰ç«¯æ€§èƒ½ä¼˜åŒ–ç»ˆææŒ‡å— æ¦‚è¿° åœ¨å½“ä»Šå¿«èŠ‚å¥çš„äº’è”ç½‘ç¯å¢ƒä¸­ï¼Œç½‘ç«™æ€§èƒ½ç›´æ¥å½±å“ç”¨æˆ·ä½“éªŒå’Œä¸šåŠ¡æˆæœã€‚ç ”ç©¶è¡¨æ˜ï¼Œé¡µé¢åŠ è½½æ—¶é—´æ¯å¢åŠ 1ç§’ï¼Œè½¬åŒ–ç‡å°±å¯èƒ½ä¸‹é™7%ã€‚æœ¬æŒ‡å—å°†ä¸ºä½ æä¾›15ä¸ªç»è¿‡å®æˆ˜éªŒè¯çš„å‰ç«¯æ€§èƒ½ä¼˜åŒ–æŠ€å·§ã€‚\næ€§èƒ½ä¼˜åŒ–çš„é‡è¦æ€§ ç”¨æˆ·ä½“éªŒå½±å“ï¼š\n53%çš„ç”¨æˆ·ä¼šåœ¨é¡µé¢åŠ è½½è¶…è¿‡3ç§’æ—¶æ”¾å¼ƒè®¿é—® 1ç§’çš„å»¶è¿Ÿå¯èƒ½å¯¼è‡´è½¬åŒ–ç‡ä¸‹é™7% 79%çš„ç”¨æˆ·å¯¹æ€§èƒ½ä¸ä½³çš„ç½‘ç«™ä¸ä¼šå†è®¿é—® ä¸šåŠ¡å½±å“ï¼š\nGoogleå°†é¡µé¢é€Ÿåº¦ä½œä¸ºæœç´¢æ’åå› ç´  å¿«é€Ÿçš„ç½‘ç«™èƒ½è·å¾—æ›´å¥½çš„SEOæ’å ä¼˜åŒ–åçš„ç½‘ç«™èƒ½æ˜¾è‘—æå‡ç”¨æˆ·ç•™å­˜ç‡ æ ¸å¿ƒæ€§èƒ½æŒ‡æ ‡ Web VitalsæŒ‡æ ‡ Largest Contentful Paint (LCP)ï¼šæœ€å¤§å†…å®¹ç»˜åˆ¶æ—¶é—´\n1 2 3 4 5 6 // æµ‹é‡LCP new PerformanceObserver((entryList) =\u0026gt; { for (const entry of entryList.getEntries()) { console.log(\u0026#39;LCP:\u0026#39;, entry.startTime); } }).observe({entryTypes: [\u0026#39;largest-contentful-paint\u0026#39;]}); First Input Delay (FID)ï¼šé¦–æ¬¡è¾“å…¥å»¶è¿Ÿ\n1 2 3 4 5 6 // æµ‹é‡FID new PerformanceObserver((entryList) =\u0026gt; { for (const entry of entryList.getEntries()) { console.log(\u0026#39;FID:\u0026#39;, entry.processingStart - entry.startTime); } }).observe({entryTypes: [\u0026#39;first-input\u0026#39;]}); Cumulative Layout Shift (CLS)ï¼šç´¯ç§¯å¸ƒå±€åç§»\n1 2 3 4 5 6 7 8 9 10 // æµ‹é‡CLS let clsValue = 0; new PerformanceObserver((entryList) =\u0026gt; { for (const entry of entryList.getEntries()) { if (!entry.hadRecentInput) { clsValue += entry.value; } } console.log(\u0026#39;CLS:\u0026#39;, clsValue); }).observe({entryTypes: [\u0026#39;layout-shift\u0026#39;]}); 1. èµ„æºä¼˜åŒ–ç­–ç•¥ å›¾ç‰‡ä¼˜åŒ– WebPæ ¼å¼è½¬æ¢ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 // å›¾ç‰‡æ ¼å¼æ£€æµ‹å’Œè½¬æ¢ function optimizeImage(src, format = \u0026#39;webp\u0026#39;) { return new Promise((resolve) =\u0026gt; { const img = new Image(); img.onload = () =\u0026gt; { const canvas = document.createElement(\u0026#39;canvas\u0026#39;); canvas.width = img.width; canvas.height = img.height; const ctx = canvas.getContext(\u0026#39;2d\u0026#39;); ctx.drawImage(img, 0, 0); canvas.toBlob((blob) =\u0026gt; { const url = URL.createObjectURL(blob); resolve(url); }, `image/${format}`, 0.8); }; img.src = src; }); } å“åº”å¼å›¾ç‰‡ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 \u0026lt;picture\u0026gt; \u0026lt;source srcset=\u0026#34;image-800w.webp 800w, image-1200w.webp 1200w\u0026#34; sizes=\u0026#34;(max-width: 600px) 480px, 800px\u0026#34; type=\u0026#34;image/webp\u0026#34; \u0026gt; \u0026lt;source srcset=\u0026#34;image-800w.jpg 800w, image-1200w.jpg 1200w\u0026#34; sizes=\u0026#34;(max-width: 600px) 480px, 800px\u0026#34; type=\u0026#34;image/jpeg\u0026#34; \u0026gt; \u0026lt;img src=\u0026#34;image-800w.jpg\u0026#34; alt=\u0026#34;ä¼˜åŒ–åçš„å›¾ç‰‡\u0026#34; loading=\u0026#34;lazy\u0026#34; width=\u0026#34;800\u0026#34; height=\u0026#34;600\u0026#34; \u0026gt; \u0026lt;/picture\u0026gt; å›¾ç‰‡æ‡’åŠ è½½å®ç°ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 // Intersection Observerå®ç°å›¾ç‰‡æ‡’åŠ è½½ const imageObserver = new IntersectionObserver((entries, observer) =\u0026gt; { entries.forEach(entry =\u0026gt; { if (entry.isIntersecting) { const img = entry.target; img.src = img.dataset.src; img.classList.remove(\u0026#39;lazy\u0026#39;); observer.unobserve(img); } }); }); document.querySelectorAll(\u0026#39;img[data-src]\u0026#39;).forEach(img =\u0026gt; { imageObserver.observe(img); }); å­—ä½“ä¼˜åŒ– å­—ä½“é¢„åŠ è½½ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 \u0026lt;!-- é¢„åŠ è½½å…³é”®å­—ä½“ --\u0026gt; \u0026lt;link rel=\u0026#34;preload\u0026#34; href=\u0026#34;/fonts/main.woff2\u0026#34; as=\u0026#34;font\u0026#34; type=\u0026#34;font/woff2\u0026#34; crossorigin \u0026gt; \u0026lt;!-- å­—ä½“æ˜¾ç¤ºç­–ç•¥ --\u0026gt; \u0026lt;style\u0026gt; @font-face { font-family: \u0026#39;Custom Font\u0026#39;; src: url(\u0026#39;/fonts/main.woff2\u0026#39;) format(\u0026#39;woff2\u0026#39;); font-display: swap; /* é¿å…å­—ä½“åŠ è½½å»¶è¿Ÿ */ } \u0026lt;/style\u0026gt; å­—ä½“å­é›†åŒ–ï¼š\n1 2 3 4 5 6 7 // ä½¿ç”¨fontkitè¿›è¡Œå­—ä½“å­é›†åŒ– const fontSubset = { // åªåŒ…å«ä¸­æ–‡å­—ç¬¦ unicodeRange: \u0026#39;U+4E00-U+9FFF\u0026#39;, // è‹±æ–‡å­—ç¬¦ unicodeRange: \u0026#39;U+0000-U+007F\u0026#39; }; 2. ä»£ç ä¼˜åŒ–æŠ€æœ¯ JavaScriptä¼˜åŒ– ä»£ç åˆ†å‰²ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 // åŠ¨æ€å¯¼å…¥å®ç°ä»£ç åˆ†å‰² async function loadModule() { const module = await import(\u0026#39;./heavy-module.js\u0026#39;); module.doSomething(); } // è·¯ç”±çº§åˆ«çš„ä»£ç åˆ†å‰² const routes = [ { path: \u0026#39;/dashboard\u0026#39;, component: () =\u0026gt; import(\u0026#39;./views/Dashboard.vue\u0026#39;) }, { path: \u0026#39;/profile\u0026#39;, component: () =\u0026gt; import(\u0026#39;./views/Profile.vue\u0026#39;) } ]; Tree Shakingä¼˜åŒ–ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 // ç¡®ä¿ES6æ¨¡å—å¯¼å…¥ import { debounce, throttle } from \u0026#39;lodash-es\u0026#39;; // è€Œä¸æ˜¯ import _ from \u0026#39;lodash\u0026#39;; // ä½¿ç”¨webpackçš„sideEffectsé…ç½® // package.json { \u0026#34;sideEffects\u0026#34;: [ \u0026#34;*.css\u0026#34;, \u0026#34;./src/style/**\u0026#34; ] } é˜²æŠ–å’ŒèŠ‚æµï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 // é˜²æŠ–å‡½æ•° function debounce(func, wait) { let timeout; return function executedFunction(...args) { const later = () =\u0026gt; { clearTimeout(timeout); func(...args); }; clearTimeout(timeout); timeout = setTimeout(later, wait); }; } // èŠ‚æµå‡½æ•° function throttle(func, limit) { let inThrottle; return function() { const args = arguments; const context = this; if (!inThrottle) { func.apply(context, args); inThrottle = true; setTimeout(() =\u0026gt; inThrottle = false, limit); } }; } // ä½¿ç”¨ç¤ºä¾‹ const handleScroll = throttle(() =\u0026gt; { console.log(\u0026#39;æ»šåŠ¨äº‹ä»¶å¤„ç†\u0026#39;); }, 100); const handleResize = debounce(() =\u0026gt; { console.log(\u0026#39;çª—å£å¤§å°æ”¹å˜\u0026#39;); }, 250); CSSä¼˜åŒ– CSSå‹ç¼©å’Œä¼˜åŒ–ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 // PostCSSé…ç½®ç¤ºä¾‹ module.exports = { plugins: [ require(\u0026#39;cssnano\u0026#39;)({ preset: \u0026#39;default\u0026#39; }), require(\u0026#39;autoprefixer\u0026#39;), require(\u0026#39;@fullhuman/postcss-purgecss\u0026#39;)({ content: [\u0026#39;./src/**/*.{js,jsx,ts,tsx,html}\u0026#39;], defaultExtractor: content =\u0026gt; { const broadMatches = content.match(/[^\u0026lt;\u0026gt;\u0026#34;\u0026#39;`\\s]*[^\u0026lt;\u0026gt;\u0026#34;\u0026#39;`\\s:]/g) || [] const innerMatches = content.match(/[^\u0026lt;\u0026gt;\u0026#34;\u0026#39;`\\s.()]*[^\u0026lt;\u0026gt;\u0026#34;\u0026#39;`\\s.():]/g) || [] return broadMatches.concat(innerMatches) } }) ] } å…³é”®CSSå†…è”ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 // æå–å…³é”®CSS const criticalCSS = ` body { margin: 0; font-family: Arial, sans-serif; } .header { background: #333; color: white; padding: 1rem; } .content { max-width: 1200px; margin: 0 auto; padding: 1rem; } `; // å†…è”åˆ°HTMLå¤´éƒ¨ const html = ` \u0026lt;!DOCTYPE html\u0026gt; \u0026lt;html\u0026gt; \u0026lt;head\u0026gt; \u0026lt;style\u0026gt;${criticalCSS}\u0026lt;/style\u0026gt; \u0026lt;link rel=\u0026#34;preload\u0026#34; href=\u0026#34;/styles/main.css\u0026#34; as=\u0026#34;style\u0026#34; onload=\u0026#34;this.onload=null;this.rel=\u0026#39;stylesheet\u0026#39;\u0026#34;\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body\u0026gt; \u0026lt;!-- é¡µé¢å†…å®¹ --\u0026gt; \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt; `; 3. ç¼“å­˜ç­–ç•¥ æµè§ˆå™¨ç¼“å­˜ Cache-Controlé…ç½®ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 // Express.jsç¤ºä¾‹ app.use(express.static(\u0026#39;public\u0026#39;, { maxAge: \u0026#39;1y\u0026#39;, // é™æ€èµ„æºç¼“å­˜1å¹´ etag: true, lastModified: true })); // ä¸åŒç±»å‹èµ„æºçš„ç¼“å­˜ç­–ç•¥ app.use((req, res, next) =\u0026gt; { if (req.url.endsWith(\u0026#39;.html\u0026#39;)) { res.setHeader(\u0026#39;Cache-Control\u0026#39;, \u0026#39;no-cache\u0026#39;); } else if (req.url.match(/\\.(js|css)$/)) { res.setHeader(\u0026#39;Cache-Control\u0026#39;, \u0026#39;max-age=31536000\u0026#39;); // 1å¹´ } else if (req.url.match(/\\.(jpg|jpeg|png|gif|webp)$/)) { res.setHeader(\u0026#39;Cache-Control\u0026#39;, \u0026#39;max-age=2592000\u0026#39;); // 30å¤© } next(); }); Service Workerç¼“å­˜ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 // Service Workerç¼“å­˜ç­–ç•¥ const CACHE_NAME = \u0026#39;app-cache-v1\u0026#39;; const urlsToCache = [ \u0026#39;/\u0026#39;, \u0026#39;/styles/main.css\u0026#39;, \u0026#39;/scripts/main.js\u0026#39;, \u0026#39;/images/logo.png\u0026#39; ]; // å®‰è£…é˜¶æ®µ self.addEventListener(\u0026#39;install\u0026#39;, event =\u0026gt; { event.waitUntil( caches.open(CACHE_NAME) .then(cache =\u0026gt; cache.addAll(urlsToCache)) ); }); // æ‹¦æˆªè¯·æ±‚ self.addEventListener(\u0026#39;fetch\u0026#39;, event =\u0026gt; { event.respondWith( caches.match(event.request) .then(response =\u0026gt; { // ç¼“å­˜å‘½ä¸­ï¼Œè¿”å›ç¼“å­˜çš„èµ„æº if (response) { return response; } // ç¼“å­˜æœªå‘½ä¸­ï¼Œå‘èµ·ç½‘ç»œè¯·æ±‚ return fetch(event.request).then(response =\u0026gt; { // æ£€æŸ¥æ˜¯å¦æ˜¯æœ‰æ•ˆå“åº” if (!response || response.status !== 200 || response.type !== \u0026#39;basic\u0026#39;) { return response; } // å…‹éš†å“åº”ç”¨äºç¼“å­˜ const responseToCache = response.clone(); caches.open(CACHE_NAME) .then(cache =\u0026gt; { cache.put(event.request, responseToCache); }); return response; }); }) ); }); æœ¬åœ°å­˜å‚¨ä¼˜åŒ– IndexedDBå¤§æ•°æ®å­˜å‚¨ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 // IndexedDBå°è£…ç±» class StorageManager { constructor(dbName = \u0026#39;AppDB\u0026#39;, version = 1) { this.dbName = dbName; this.version = version; this.db = null; } async init() { return new Promise((resolve, reject) =\u0026gt; { const request = indexedDB.open(this.dbName, this.version); request.onerror = () =\u0026gt; reject(request.error); request.onsuccess = () =\u0026gt; { this.db = request.result; resolve(this.db); }; request.onupgradeneeded = event =\u0026gt; { const db = event.target.result; if (!db.objectStoreNames.contains(\u0026#39;cache\u0026#39;)) { db.createObjectStore(\u0026#39;cache\u0026#39;, { keyPath: \u0026#39;id\u0026#39; }); } }; }); } async set(key, data, ttl = 3600000) { // é»˜è®¤1å°æ—¶è¿‡æœŸ const item = { id: key, data: data, timestamp: Date.now(), ttl: ttl }; return new Promise((resolve, reject) =\u0026gt; { const transaction = this.db.transaction([\u0026#39;cache\u0026#39;], \u0026#39;readwrite\u0026#39;); const store = transaction.objectStore(\u0026#39;cache\u0026#39;); const request = store.put(item); request.onsuccess = () =\u0026gt; resolve(request.result); request.onerror = () =\u0026gt; reject(request.error); }); } async get(key) { return new Promise((resolve, reject) =\u0026gt; { const transaction = this.db.transaction([\u0026#39;cache\u0026#39;], \u0026#39;readonly\u0026#39;); const store = transaction.objectStore(\u0026#39;cache\u0026#39;); const request = store.get(key); request.onsuccess = () =\u0026gt; { const item = request.result; if (!item) { resolve(null); return; } // æ£€æŸ¥æ˜¯å¦è¿‡æœŸ if (Date.now() - item.timestamp \u0026gt; item.ttl) { this.delete(key); resolve(null); return; } resolve(item.data); }; request.onerror = () =\u0026gt; reject(request.error); }); } async delete(key) { return new Promise((resolve, reject) =\u0026gt; { const transaction = this.db.transaction([\u0026#39;cache\u0026#39;], \u0026#39;readwrite\u0026#39;); const store = transaction.objectStore(\u0026#39;cache\u0026#39;); const request = store.delete(key); request.onsuccess = () =\u0026gt; resolve(request.result); request.onerror = () =\u0026gt; reject(request.error); }); } } 4. ç½‘ç»œä¼˜åŒ– HTTP/2ä¼˜åŒ– æœåŠ¡å™¨æ¨é€ï¼š\n1 2 3 4 5 # Nginxé…ç½®ç¤ºä¾‹ location = /style.css { http2_push /style.css; http2_push /script.js; } èµ„æºåˆå¹¶å’Œå‹ç¼©ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 // Webpacké…ç½®ä¼˜åŒ– module.exports = { optimization: { splitChunks: { chunks: \u0026#39;all\u0026#39;, cacheGroups: { vendor: { test: /[\\\\/]node_modules[\\\\/]/, name: \u0026#39;vendors\u0026#39;, chunks: \u0026#39;all\u0026#39;, }, common: { name: \u0026#39;common\u0026#39;, minChunks: 2, chunks: \u0026#39;all\u0026#39;, enforce: true } } }, minimizer: [ new TerserPlugin({ terserOptions: { compress: { drop_console: true, drop_debugger: true, }, }, }), ] } } CDNåŠ é€Ÿ é™æ€èµ„æºCDNé…ç½®ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 // æ„å»ºæ—¶é…ç½®CDN const cdnConfig = { development: { publicPath: \u0026#39;/\u0026#39;, }, production: { publicPath: \u0026#39;https://cdn.yourdomain.com/\u0026#39; } }; // åŠ¨æ€èµ„æºCDN function getCdnUrl(path) { const cdnHosts = [ \u0026#39;https://cdn1.yourdomain.com\u0026#39;, \u0026#39;https://cdn2.yourdomain.com\u0026#39;, \u0026#39;https://cdn3.yourdomain.com\u0026#39; ]; const hash = path.split(\u0026#39;\u0026#39;).reduce((a, b) =\u0026gt; { a = ((a \u0026lt;\u0026lt; 5) - a) + b.charCodeAt(0); return a \u0026amp; a; }, 0); const index = Math.abs(hash) % cdnHosts.length; return cdnHosts[index] + path; } 5. æ¸²æŸ“ä¼˜åŒ– è™šæ‹Ÿæ»šåŠ¨ è™šæ‹Ÿæ»šåŠ¨ç»„ä»¶ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 // è™šæ‹Ÿæ»šåŠ¨å®ç° class VirtualScroll { constructor(container, itemHeight, renderItem) { this.container = container; this.itemHeight = itemHeight; this.renderItem = renderItem; this.data = []; this.visibleStart = 0; this.visibleEnd = 0; this.scrollTop = 0; this.init(); } init() { this.container.addEventListener(\u0026#39;scroll\u0026#39;, this.handleScroll.bind(this)); this.updateVisibleRange(); } handleScroll() { this.scrollTop = this.container.scrollTop; this.updateVisibleRange(); this.render(); } updateVisibleRange() { const containerHeight = this.container.clientHeight; const startIndex = Math.floor(this.scrollTop / this.itemHeight); const endIndex = Math.ceil((this.scrollTop + containerHeight) / this.itemHeight); // æ·»åŠ ç¼“å†²åŒº const bufferSize = 5; this.visibleStart = Math.max(0, startIndex - bufferSize); this.visibleEnd = Math.min(this.data.length, endIndex + bufferSize); } render() { const fragment = document.createDocumentFragment(); // åˆ›å»ºå ä½ç©ºé—´ const spacerBefore = document.createElement(\u0026#39;div\u0026#39;); spacerBefore.style.height = `${this.visibleStart * this.itemHeight}px`; fragment.appendChild(spacerBefore); // æ¸²æŸ“å¯è§é¡¹ for (let i = this.visibleStart; i \u0026lt; this.visibleEnd; i++) { const item = this.renderItem(this.data[i], i); item.style.height = `${this.itemHeight}px`; item.style.position = \u0026#39;absolute\u0026#39;; item.style.top = `${i * this.itemHeight}px`; item.style.width = \u0026#39;100%\u0026#39;; fragment.appendChild(item); } // åˆ›å»ºåº•éƒ¨å ä½ç©ºé—´ const spacerAfter = document.createElement(\u0026#39;div\u0026#39;); spacerAfter.style.height = `${(this.data.length - this.visibleEnd) * this.itemHeight}px`; fragment.appendChild(spacerAfter); this.container.innerHTML = \u0026#39;\u0026#39;; this.container.appendChild(fragment); } setData(data) { this.data = data; this.updateVisibleRange(); this.render(); } } éª¨æ¶å±åŠ è½½ éª¨æ¶å±ç»„ä»¶ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 // éª¨æ¶å±ç”Ÿæˆå™¨ class SkeletonLoader { constructor(container) { this.container = container; } generateCardSkeleton() { return ` \u0026lt;div class=\u0026#34;skeleton-card\u0026#34;\u0026gt; \u0026lt;div class=\u0026#34;skeleton-avatar\u0026#34;\u0026gt;\u0026lt;/div\u0026gt; \u0026lt;div class=\u0026#34;skeleton-content\u0026#34;\u0026gt; \u0026lt;div class=\u0026#34;skeleton-title\u0026#34;\u0026gt;\u0026lt;/div\u0026gt; \u0026lt;div class=\u0026#34;skeleton-text\u0026#34;\u0026gt;\u0026lt;/div\u0026gt; \u0026lt;div class=\u0026#34;skeleton-text short\u0026#34;\u0026gt;\u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; `; } generateListSkeleton(count = 5) { let skeleton = \u0026#39;\u0026#39;; for (let i = 0; i \u0026lt; count; i++) { skeleton += this.generateCardSkeleton(); } return skeleton; } show() { this.container.innerHTML = this.generateListSkeleton(); } hide(content) { this.container.innerHTML = content; } } // CSSæ ·å¼ const skeletonCSS = ` .skeleton-card { display: flex; padding: 16px; border: 1px solid #eee; margin-bottom: 8px; } .skeleton-avatar { width: 40px; height: 40px; border-radius: 50%; background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%); background-size: 200% 100%; animation: skeleton-loading 1.5s infinite; } .skeleton-title { height: 20px; width: 60%; margin-bottom: 8px; background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%); background-size: 200% 100%; animation: skeleton-loading 1.5s infinite; } .skeleton-text { height: 16px; width: 100%; margin-bottom: 4px; background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%); background-size: 200% 100%; animation: skeleton-loading 1.5s infinite; } .skeleton-text.short { width: 40%; } @keyframes skeleton-loading { 0% { background-position: 200% 0; } 100% { background-position: -200% 0; } } `; 6. æ€§èƒ½ç›‘æ§ æ€§èƒ½æ•°æ®æ”¶é›† è‡ªå®šä¹‰æ€§èƒ½ç›‘æ§ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 class PerformanceMonitor { constructor() { this.metrics = {}; this.observers = []; } startMonitoring() { // ç›‘æ§é¡µé¢åŠ è½½æ—¶é—´ window.addEventListener(\u0026#39;load\u0026#39;, () =\u0026gt; { this.collectLoadMetrics(); }); // ç›‘æ§ç”¨æˆ·äº¤äº’æ€§èƒ½ this.monitorUserInteractions(); // ç›‘æ§èµ„æºåŠ è½½ this.monitorResourceLoading(); } collectLoadMetrics() { const navigation = performance.getEntriesByType(\u0026#39;navigation\u0026#39;)[0]; this.metrics = { dns: navigation.domainLookupEnd - navigation.domainLookupStart, tcp: navigation.connectEnd - navigation.connectStart, ssl: navigation.secureConnectionStart \u0026gt; 0 ? navigation.connectEnd - navigation.secureConnectionStart : 0, ttfb: navigation.responseStart - navigation.requestStart, download: navigation.responseEnd - navigation.responseStart, domParse: navigation.domContentLoadedEventStart - navigation.responseEnd, domReady: navigation.domContentLoadedEventEnd - navigation.domContentLoadedEventStart, load: navigation.loadEventEnd - navigation.loadEventStart }; this.sendMetrics(); } monitorUserInteractions() { // ç›‘æ§ç‚¹å‡»äº‹ä»¶ document.addEventListener(\u0026#39;click\u0026#39;, (event) =\u0026gt; { const startTime = performance.now(); // ä½¿ç”¨setTimeoutç­‰å¾…äº‹ä»¶å¤„ç†å®Œæˆ setTimeout(() =\u0026gt; { const endTime = performance.now(); this.recordInteraction(\u0026#39;click\u0026#39;, endTime - startTime); }, 0); }); } monitorResourceLoading() { const observer = new PerformanceObserver((list) =\u0026gt; { list.getEntries().forEach((entry) =\u0026gt; { if (entry.entryType === \u0026#39;resource\u0026#39;) { this.recordResourceMetric(entry); } }); }); observer.observe({ entryTypes: [\u0026#39;resource\u0026#39;] }); } recordResourceMetric(entry) { const resourceMetrics = { name: entry.name, type: this.getResourceType(entry.name), size: entry.transferSize, duration: entry.duration, cached: entry.transferSize === 0 \u0026amp;\u0026amp; entry.decodedBodySize \u0026gt; 0 }; // å‘é€èµ„æºæŒ‡æ ‡ this.sendResourceMetrics(resourceMetrics); } getResourceType(url) { if (url.match(/\\.(css)$/)) return \u0026#39;css\u0026#39;; if (url.match(/\\.(js)$/)) return \u0026#39;javascript\u0026#39;; if (url.match(/\\.(png|jpg|jpeg|gif|webp)$/)) return \u0026#39;image\u0026#39;; if (url.match(/\\.(woff|woff2|ttf)$/)) return \u0026#39;font\u0026#39;; return \u0026#39;other\u0026#39;; } sendMetrics() { // å‘é€åˆ°åˆ†ææœåŠ¡ fetch(\u0026#39;/api/performance-metrics\u0026#39;, { method: \u0026#39;POST\u0026#39;, headers: { \u0026#39;Content-Type\u0026#39;: \u0026#39;application/json\u0026#39;, }, body: JSON.stringify({ url: window.location.href, userAgent: navigator.userAgent, timestamp: Date.now(), metrics: this.metrics }) }).catch(error =\u0026gt; { console.error(\u0026#39;Failed to send performance metrics:\u0026#39;, error); }); } } å®æ—¶æ€§èƒ½ä»ªè¡¨æ¿ æ€§èƒ½ä»ªè¡¨æ¿ç»„ä»¶ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 class PerformanceDashboard { constructor(container) { this.container = container; this.charts = {}; this.init(); } init() { this.render(); this.startRealTimeUpdates(); } render() { this.container.innerHTML = ` \u0026lt;div class=\u0026#34;dashboard\u0026#34;\u0026gt; \u0026lt;div class=\u0026#34;dashboard-header\u0026#34;\u0026gt; \u0026lt;h2\u0026gt;æ€§èƒ½ç›‘æ§ä»ªè¡¨æ¿\u0026lt;/h2\u0026gt; \u0026lt;div class=\u0026#34;last-update\u0026#34;\u0026gt;æœ€åæ›´æ–°: \u0026lt;span id=\u0026#34;lastUpdate\u0026#34;\u0026gt;--\u0026lt;/span\u0026gt;\u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;div class=\u0026#34;metrics-grid\u0026#34;\u0026gt; \u0026lt;div class=\u0026#34;metric-card\u0026#34;\u0026gt; \u0026lt;h3\u0026gt;é¡µé¢åŠ è½½æ—¶é—´\u0026lt;/h3\u0026gt; \u0026lt;div class=\u0026#34;metric-value\u0026#34; id=\u0026#34;loadTime\u0026#34;\u0026gt;--\u0026lt;/div\u0026gt; \u0026lt;div class=\u0026#34;metric-unit\u0026#34;\u0026gt;ms\u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;div class=\u0026#34;metric-card\u0026#34;\u0026gt; \u0026lt;h3\u0026gt;é¦–æ¬¡å†…å®¹ç»˜åˆ¶\u0026lt;/h3\u0026gt; \u0026lt;div class=\u0026#34;metric-value\u0026#34; id=\u0026#34;fcp\u0026#34;\u0026gt;--\u0026lt;/div\u0026gt; \u0026lt;div class=\u0026#34;metric-unit\u0026#34;\u0026gt;ms\u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;div class=\u0026#34;metric-card\u0026#34;\u0026gt; \u0026lt;h3\u0026gt;æœ€å¤§å†…å®¹ç»˜åˆ¶\u0026lt;/h3\u0026gt; \u0026lt;div class=\u0026#34;metric-value\u0026#34; id=\u0026#34;lcp\u0026#34;\u0026gt;--\u0026lt;/div\u0026gt; \u0026lt;div class=\u0026#34;metric-unit\u0026#34;\u0026gt;ms\u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;div class=\u0026#34;metric-card\u0026#34;\u0026gt; \u0026lt;h3\u0026gt;ç´¯ç§¯å¸ƒå±€åç§»\u0026lt;/h3\u0026gt; \u0026lt;div class=\u0026#34;metric-value\u0026#34; id=\u0026#34;cls\u0026#34;\u0026gt;--\u0026lt;/div\u0026gt; \u0026lt;div class=\u0026#34;metric-unit\u0026#34;\u0026gt;score\u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;div class=\u0026#34;charts-section\u0026#34;\u0026gt; \u0026lt;div class=\u0026#34;chart-container\u0026#34;\u0026gt; \u0026lt;h3\u0026gt;åŠ è½½æ—¶é—´è¶‹åŠ¿\u0026lt;/h3\u0026gt; \u0026lt;canvas id=\u0026#34;loadTimeChart\u0026#34;\u0026gt;\u0026lt;/canvas\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;div class=\u0026#34;chart-container\u0026#34;\u0026gt; \u0026lt;h3\u0026gt;èµ„æºåŠ è½½åˆ†æ\u0026lt;/h3\u0026gt; \u0026lt;canvas id=\u0026#34;resourceChart\u0026#34;\u0026gt;\u0026lt;/canvas\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; `; } updateMetrics(metrics) { document.getElementById(\u0026#39;loadTime\u0026#39;).textContent = metrics.loadTime; document.getElementById(\u0026#39;fcp\u0026#39;).textContent = metrics.fcp; document.getElementById(\u0026#39;lcp\u0026#39;).textContent = metrics.lcp; document.getElementById(\u0026#39;cls\u0026#39;).textContent = metrics.cls.toFixed(3); document.getElementById(\u0026#39;lastUpdate\u0026#39;).textContent = new Date().toLocaleTimeString(); } startRealTimeUpdates() { // æ¯5ç§’æ›´æ–°ä¸€æ¬¡æ•°æ® setInterval(() =\u0026gt; { this.fetchLatestMetrics(); }, 5000); } fetchLatestMetrics() { fetch(\u0026#39;/api/performance/latest\u0026#39;) .then(response =\u0026gt; response.json()) .then(data =\u0026gt; { this.updateMetrics(data); this.updateCharts(data); }) .catch(error =\u0026gt; { console.error(\u0026#39;Failed to fetch metrics:\u0026#39;, error); }); } } æ€§èƒ½ä¼˜åŒ–æ£€æŸ¥æ¸…å• å‘å¸ƒå‰æ£€æŸ¥ å›¾ç‰‡ä¼˜åŒ–\nä½¿ç”¨WebPæ ¼å¼ å®ç°å“åº”å¼å›¾ç‰‡ æ·»åŠ æ‡’åŠ è½½ å‹ç¼©å›¾ç‰‡å¤§å° ä»£ç ä¼˜åŒ–\nå¯ç”¨ä»£ç å‹ç¼© å®ç°ä»£ç åˆ†å‰² ç§»é™¤æœªä½¿ç”¨çš„ä»£ç  ä¼˜åŒ–ä¾èµ–åŒ…å¤§å° ç¼“å­˜ç­–ç•¥\né…ç½®æµè§ˆå™¨ç¼“å­˜ å®ç°Service Worker ä½¿ç”¨CDNåŠ é€Ÿ ä¼˜åŒ–ç¼“å­˜ç­–ç•¥ ç½‘ç»œä¼˜åŒ–\nå¯ç”¨Gzipå‹ç¼© ä½¿ç”¨HTTP/2 å‡å°‘HTTPè¯·æ±‚ ä¼˜åŒ–DNSæŸ¥è¯¢ æŒç»­ç›‘æ§ æ€§èƒ½æŒ‡æ ‡ç›‘æ§\né¡µé¢åŠ è½½æ—¶é—´ é¦–æ¬¡å†…å®¹ç»˜åˆ¶ æœ€å¤§å†…å®¹ç»˜åˆ¶ ç´¯ç§¯å¸ƒå±€åç§» ç”¨æˆ·ä½“éªŒç›‘æ§\nç”¨æˆ·äº¤äº’å“åº”æ—¶é—´ é”™è¯¯ç‡ç»Ÿè®¡ ç”¨æˆ·è¡Œä¸ºåˆ†æ è®¾å¤‡å…¼å®¹æ€§ å¸¸è§æ€§èƒ½é—®é¢˜è§£å†³ é—®é¢˜1ï¼šJavaScripté˜»å¡æ¸²æŸ“ ç—‡çŠ¶ï¼šé¡µé¢é•¿æ—¶é—´ç™½å±\nè§£å†³æ–¹æ¡ˆï¼š\n1 2 3 4 5 6 7 8 9 10 11 // ä½¿ç”¨asyncå’Œdeferå±æ€§ \u0026lt;script src=\u0026#34;non-critical.js\u0026#34; async\u0026gt;\u0026lt;/script\u0026gt; \u0026lt;script src=\u0026#34;non-critical.js\u0026#34; defer\u0026gt;\u0026lt;/script\u0026gt; // åŠ¨æ€åŠ è½½è„šæœ¬ function loadScript(src, callback) { const script = document.createElement(\u0026#39;script\u0026#39;); script.src = src; script.onload = callback; document.head.appendChild(script); } é—®é¢˜2ï¼šCSSé˜»å¡æ¸²æŸ“ ç—‡çŠ¶ï¼šé¡µé¢æ ·å¼åŠ è½½ç¼“æ…¢\nè§£å†³æ–¹æ¡ˆï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 \u0026lt;!-- å…³é”®CSSå†…è” --\u0026gt; \u0026lt;style\u0026gt; /* å…³é”®æ ·å¼ */ body { margin: 0; font-family: Arial; } .header { background: #333; } \u0026lt;/style\u0026gt; \u0026lt;!-- éå…³é”®CSSå¼‚æ­¥åŠ è½½ --\u0026gt; \u0026lt;link rel=\u0026#34;preload\u0026#34; href=\u0026#34;styles.css\u0026#34; as=\u0026#34;style\u0026#34; onload=\u0026#34;this.onload=null;this.rel=\u0026#39;stylesheet\u0026#39;\u0026#34; \u0026gt; é—®é¢˜3ï¼šå†…å­˜æ³„æ¼ ç—‡çŠ¶ï¼šé¡µé¢ä½¿ç”¨æ—¶é—´è¶Šé•¿è¶Šå¡\nè§£å†³æ–¹æ¡ˆï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 // æ¸…ç†äº‹ä»¶ç›‘å¬å™¨ function cleanup() { window.removeEventListener(\u0026#39;scroll\u0026#39;, handleScroll); window.removeEventListener(\u0026#39;resize\u0026#39;, handleResize); // æ¸…ç†å®šæ—¶å™¨ clearInterval(timerId); clearTimeout(timeoutId); // æ¸…ç†DOMå¼•ç”¨ element = null; } // é¡µé¢å¸è½½æ—¶æ¸…ç† window.addEventListener(\u0026#39;beforeunload\u0026#39;, cleanup); å·¥å…·å’Œèµ„æºæ¨è æ€§èƒ½æµ‹è¯•å·¥å…· Google PageSpeed Insights\nç½‘å€ï¼šhttps://pagespeed.web.dev/ åŠŸèƒ½ï¼šç»¼åˆæ€§èƒ½åˆ†æï¼Œæä¾›ä¼˜åŒ–å»ºè®® WebPageTest\nç½‘å€ï¼šhttps://www.webpagetest.org/ åŠŸèƒ½ï¼šè¯¦ç»†çš„æ€§èƒ½æµ‹è¯•å’Œç€‘å¸ƒå›¾åˆ†æ Lighthouse\nChrome DevToolså†…ç½® åŠŸèƒ½ï¼šå…¨é¢çš„è´¨é‡å’Œæ€§èƒ½å®¡è®¡ å¼€å‘å·¥å…· Bundle Analyzer\n1 npm install --save-dev webpack-bundle-analyzer æ€§èƒ½ç›‘æ§åº“\n1 2 3 4 5 6 7 8 // Web Vitalsåº“ import {getCLS, getFID, getFCP, getLCP, getTTFB} from \u0026#39;web-vitals\u0026#39;; getCLS(console.log); getFID(console.log); getFCP(console.log); getLCP(console.log); getTTFB(console.log); æ€§èƒ½é¢„ç®—å·¥å…·\n1 2 3 4 5 6 7 8 9 10 11 // webpackæ€§èƒ½é¢„ç®—é…ç½® module.exports = { performance: { maxAssetSize: 244 * 1024, // 244KB maxEntrypointSize: 244 * 1024, hints: \u0026#34;warning\u0026#34;, // æˆ– \u0026#34;error\u0026#34; assetFilter: function(assetFilename) { return assetFilename.endsWith(\u0026#39;.js\u0026#39;) || assetFilename.endsWith(\u0026#39;.css\u0026#39;); }, } } æ€»ç»“ å‰ç«¯æ€§èƒ½ä¼˜åŒ–æ˜¯ä¸€ä¸ªæŒç»­çš„è¿‡ç¨‹ï¼Œéœ€è¦ä»å¤šä¸ªç»´åº¦ç»¼åˆè€ƒè™‘ã€‚é€šè¿‡æœ¬æ–‡ä»‹ç»çš„15ä¸ªä¼˜åŒ–æŠ€å·§ï¼Œä½ å¯ä»¥æ˜¾è‘—æå‡Webåº”ç”¨çš„æ€§èƒ½ï¼š\nå…³é”®è¦ç‚¹ èµ„æºä¼˜åŒ–ï¼šå›¾ç‰‡å‹ç¼©ã€ä»£ç åˆ†å‰²ã€ç¼“å­˜ç­–ç•¥ ç½‘ç»œä¼˜åŒ–ï¼šCDNåŠ é€Ÿã€HTTP/2ã€å‡å°‘è¯·æ±‚ æ¸²æŸ“ä¼˜åŒ–ï¼šè™šæ‹Ÿæ»šåŠ¨ã€éª¨æ¶å±ã€æ‡’åŠ è½½ ç›‘æ§ä¼˜åŒ–ï¼šæ€§èƒ½æŒ‡æ ‡ã€å®æ—¶ç›‘æ§ã€é—®é¢˜æ’æŸ¥ æŒç»­æ”¹è¿› å®šæœŸè¿›è¡Œæ€§èƒ½å®¡è®¡ è·Ÿè¸ªæœ€æ–°çš„Webæ€§èƒ½æœ€ä½³å®è·µ æ ¹æ®ç”¨æˆ·åé¦ˆæŒç»­ä¼˜åŒ– å»ºç«‹æ€§èƒ½ç›‘æ§å’Œå‘Šè­¦æœºåˆ¶ è®°ä½ï¼Œæ€§èƒ½ä¼˜åŒ–æ²¡æœ‰ç»ˆç‚¹ï¼Œåªæœ‰ä¸æ–­æ”¹è¿›å’Œä¼˜åŒ–ã€‚ä»ä»Šå¤©å¼€å§‹ï¼Œå°†è¿™äº›æŠ€å·§åº”ç”¨åˆ°ä½ çš„é¡¹ç›®ä¸­ï¼Œä¸ºç”¨æˆ·æä¾›æ›´å¿«çš„ä½“éªŒï¼\nç›¸å…³èµ„æº\nWebæ€§èƒ½æµ‹è¯•å·¥å…· å›¾ç‰‡å‹ç¼©å·¥å…· ä»£ç å‹ç¼©å·¥å…· åˆ†äº«ä½ çš„ä¼˜åŒ–ç»éªŒï¼šæ¬¢è¿åœ¨è¯„è®ºåŒºåˆ†äº«ä½ çš„æ€§èƒ½ä¼˜åŒ–æŠ€å·§å’Œç»éªŒï¼\n","permalink":"/blog/articles/frontend-performance-optimization-guide/","summary":"æŒæ¡15ä¸ªå®ç”¨çš„å‰ç«¯æ€§èƒ½ä¼˜åŒ–æŠ€å·§ï¼Œä»ç½‘ç»œå±‚é¢åˆ°ä»£ç å±‚é¢çš„å…¨æ–¹ä½ä¼˜åŒ–ç­–ç•¥","title":"å‰ç«¯æ€§èƒ½ä¼˜åŒ–ç»ˆææŒ‡å—ï¼šæå‡Webåº”ç”¨åŠ è½½é€Ÿåº¦çš„15ä¸ªå®æˆ˜æŠ€å·§"},{"content":"JSONæ ¼å¼åŒ–å·¥å…·å®Œå…¨æŒ‡å— æ•™ç¨‹æ¦‚è¿° å­¦ä¹ ç›®æ ‡ é€šè¿‡æœ¬æ•™ç¨‹ï¼Œä½ å°†å­¦ä¼šï¼š\nJSONæ•°æ®æ ¼å¼çš„åŸºæœ¬æ¦‚å¿µå’Œè¯­æ³•è§„åˆ™ JSONæ ¼å¼åŒ–å·¥å…·çš„æ ¸å¿ƒåŠŸèƒ½å’Œç”¨æ³• æ•°æ®éªŒè¯å’Œé”™è¯¯æ’æŸ¥æŠ€å·§ JSONå‹ç¼©å’Œä¼˜åŒ–æ–¹æ³• åœ¨å®é™…é¡¹ç›®ä¸­çš„åº”ç”¨åœºæ™¯ é€‚ç”¨äººç¾¤ å‰ç«¯å¼€å‘å·¥ç¨‹å¸ˆ åç«¯å¼€å‘å·¥ç¨‹å¸ˆ APIå¼€å‘å’Œæµ‹è¯•äººå‘˜ æ•°æ®å¤„ç†å·¥ç¨‹å¸ˆ Webå¼€å‘åˆå­¦è€… å‰ç½®çŸ¥è¯† åŸºç¡€çš„ç¼–ç¨‹æ¦‚å¿µ äº†è§£æ•°æ®ç»“æ„çš„åŸºæœ¬æ¦‚å¿µ æœ‰APIè°ƒç”¨ç»éªŒè€…ä¼˜å…ˆ JSONåŸºç¡€æ¦‚å¿µ ä»€ä¹ˆæ˜¯JSONï¼Ÿ JSONï¼ˆJavaScript Object Notationï¼‰æ˜¯ä¸€ç§è½»é‡çº§çš„æ•°æ®äº¤æ¢æ ¼å¼ï¼Œå…·æœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š\næ˜“äºé˜…è¯»å’Œç¼–å†™ï¼šäººç±»å¯è¯»çš„æ–‡æœ¬æ ¼å¼ æ˜“äºæœºå™¨è§£æå’Œç”Ÿæˆï¼šæ ‡å‡†åŒ–çš„æ•°æ®ç»“æ„ è¯­è¨€æ— å…³æ€§ï¼šæ”¯æŒå¤šç§ç¼–ç¨‹è¯­è¨€ æ•°æ®ç±»å‹ä¸°å¯Œï¼šæ”¯æŒå­—ç¬¦ä¸²ã€æ•°å­—ã€å¸ƒå°”å€¼ã€æ•°ç»„ã€å¯¹è±¡ç­‰ JSONåŸºæœ¬è¯­æ³• å¯¹è±¡ï¼ˆObjectï¼‰ 1 2 3 4 5 6 7 8 9 10 { \u0026#34;name\u0026#34;: \u0026#34;å¼ ä¸‰\u0026#34;, \u0026#34;age\u0026#34;: 25, \u0026#34;email\u0026#34;: \u0026#34;zhangsan@example.com\u0026#34;, \u0026#34;isActive\u0026#34;: true, \u0026#34;address\u0026#34;: { \u0026#34;street\u0026#34;: \u0026#34;ç§‘æŠ€è·¯123å·\u0026#34;, \u0026#34;city\u0026#34;: \u0026#34;æ·±åœ³\u0026#34; } } æ•°ç»„ï¼ˆArrayï¼‰ 1 2 3 4 5 6 [ \u0026#34;è‹¹æœ\u0026#34;, \u0026#34;é¦™è•‰\u0026#34;, \u0026#34;æ©™å­\u0026#34;, \u0026#34;è‘¡è„\u0026#34; ] æ··åˆç»“æ„ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 { \u0026#34;users\u0026#34;: [ { \u0026#34;id\u0026#34;: 1, \u0026#34;name\u0026#34;: \u0026#34;å¼ ä¸‰\u0026#34;, \u0026#34;skills\u0026#34;: [\u0026#34;JavaScript\u0026#34;, \u0026#34;Python\u0026#34;, \u0026#34;SQL\u0026#34;] }, { \u0026#34;id\u0026#34;: 2, \u0026#34;name\u0026#34;: \u0026#34;æå››\u0026#34;, \u0026#34;skills\u0026#34;: [\u0026#34;Java\u0026#34;, \u0026#34;Spring\u0026#34;, \u0026#34;MySQL\u0026#34;] } ], \u0026#34;total\u0026#34;: 2, \u0026#34;success\u0026#34;: true } JSONæ ¼å¼åŒ–å·¥å…·è¯¦è§£ æ ¸å¿ƒåŠŸèƒ½ 1. ç¾åŒ–æ ¼å¼åŒ–ï¼ˆBeautifyï¼‰ åŠŸèƒ½æè¿°ï¼šå°†å‹ç¼©çš„JSONæ•°æ®æ ¼å¼åŒ–ä¸ºæ˜“è¯»çš„ç¼©è¿›æ ¼å¼\nè¾“å…¥ç¤ºä¾‹ï¼š\n1 {\u0026#34;name\u0026#34;:\u0026#34;å¼ ä¸‰\u0026#34;,\u0026#34;age\u0026#34;:25,\u0026#34;skills\u0026#34;:[\u0026#34;JavaScript\u0026#34;,\u0026#34;Python\u0026#34;],\u0026#34;address\u0026#34;:{\u0026#34;city\u0026#34;:\u0026#34;æ·±åœ³\u0026#34;,\u0026#34;street\u0026#34;:\u0026#34;ç§‘æŠ€è·¯123å·\u0026#34;}} è¾“å‡ºç»“æœï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 { \u0026#34;name\u0026#34;: \u0026#34;å¼ ä¸‰\u0026#34;, \u0026#34;age\u0026#34;: 25, \u0026#34;skills\u0026#34;: [ \u0026#34;JavaScript\u0026#34;, \u0026#34;Python\u0026#34; ], \u0026#34;address\u0026#34;: { \u0026#34;city\u0026#34;: \u0026#34;æ·±åœ³\u0026#34;, \u0026#34;street\u0026#34;: \u0026#34;ç§‘æŠ€è·¯123å·\u0026#34; } } 2. æ•°æ®éªŒè¯ï¼ˆValidationï¼‰ éªŒè¯è§„åˆ™ï¼š\næ‹¬å·åŒ¹é…æ£€æŸ¥ å¼•å·é…å¯¹éªŒè¯ é€—å·ä½¿ç”¨è§„èŒƒ æ•°æ®ç±»å‹åˆæ³•æ€§ å­—ç¬¦ç¼–ç æ£€æŸ¥ å¸¸è§é”™è¯¯æç¤ºï¼š\n1 2 3 4 5 6 7 8 9 // é”™è¯¯ç¤ºä¾‹ { \u0026#34;name\u0026#34;: \u0026#34;å¼ ä¸‰\u0026#34;, \u0026#34;age\u0026#34;: 25, \u0026#34;skills\u0026#34;: [\u0026#34;JavaScript\u0026#34;, \u0026#34;Python\u0026#34;, // ç¼ºå°‘ç»“æŸå¼•å·å’Œæ‹¬å· } // é”™è¯¯ä¿¡æ¯ Error: Parse error on line 4: Expecting \u0026#39;STRING\u0026#39;, \u0026#39;NUMBER\u0026#39;, \u0026#39;NULL\u0026#39;, \u0026#39;TRUE\u0026#39;, \u0026#39;FALSE\u0026#39;, \u0026#39;{\u0026#39;, \u0026#39;[\u0026#39;, got \u0026#39;undefined\u0026#39; 3. æ•°æ®å‹ç¼©ï¼ˆMinifyï¼‰ åŠŸèƒ½æè¿°ï¼šç§»é™¤æ‰€æœ‰ç©ºæ ¼å’Œæ¢è¡Œç¬¦ï¼Œç”Ÿæˆæœ€å°çš„JSONå­—ç¬¦ä¸²\nåº”ç”¨åœºæ™¯ï¼š\nAPIå“åº”æ•°æ®ä¼ è¾“ é…ç½®æ–‡ä»¶ä¼˜åŒ– ç½‘ç»œä¼ è¾“ä¼˜åŒ– å‹ç¼©æ•ˆæœï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 // åŸå§‹æ•°æ®ï¼ˆ256å­—èŠ‚ï¼‰ { \u0026#34;name\u0026#34;: \u0026#34;å¼ ä¸‰\u0026#34;, \u0026#34;age\u0026#34;: 25, \u0026#34;skills\u0026#34;: [\u0026#34;JavaScript\u0026#34;, \u0026#34;Python\u0026#34;], \u0026#34;address\u0026#34;: { \u0026#34;city\u0026#34;: \u0026#34;æ·±åœ³\u0026#34;, \u0026#34;street\u0026#34;: \u0026#34;ç§‘æŠ€è·¯123å·\u0026#34; } } // å‹ç¼©åï¼ˆ98å­—èŠ‚ï¼ŒèŠ‚çœ62%ï¼‰ {\u0026#34;name\u0026#34;:\u0026#34;å¼ ä¸‰\u0026#34;,\u0026#34;age\u0026#34;:25,\u0026#34;skills\u0026#34;:[\u0026#34;JavaScript\u0026#34;,\u0026#34;Python\u0026#34;],\u0026#34;address\u0026#34;:{\u0026#34;city\u0026#34;:\u0026#34;æ·±åœ³\u0026#34;,\u0026#34;street\u0026#34;:\u0026#34;ç§‘æŠ€è·¯123å·\u0026#34;}} é«˜çº§åŠŸèƒ½ 1. JSONè·¯å¾„æŸ¥è¯¢ ä½¿ç”¨JSONPathè¯­æ³•æŸ¥è¯¢ç‰¹å®šæ•°æ®ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 { \u0026#34;store\u0026#34;: { \u0026#34;book\u0026#34;: [ { \u0026#34;category\u0026#34;: \u0026#34;reference\u0026#34;, \u0026#34;author\u0026#34;: \u0026#34;Nigel Rees\u0026#34;, \u0026#34;title\u0026#34;: \u0026#34;Sayings of the Century\u0026#34;, \u0026#34;price\u0026#34;: 8.95 }, { \u0026#34;category\u0026#34;: \u0026#34;fiction\u0026#34;, \u0026#34;author\u0026#34;: \u0026#34;Evelyn Waugh\u0026#34;, \u0026#34;title\u0026#34;: \u0026#34;Sword of Honour\u0026#34;, \u0026#34;price\u0026#34;: 12.99 } ], \u0026#34;bicycle\u0026#34;: { \u0026#34;color\u0026#34;: \u0026#34;red\u0026#34;, \u0026#34;price\u0026#34;: 19.95 } } } æŸ¥è¯¢ç¤ºä¾‹ï¼š\n$.store.book[*].author - è·å–æ‰€æœ‰ä¹¦ç±ä½œè€… $..book[?(@.price\u0026gt;10)] - è·å–ä»·æ ¼å¤§äº10çš„ä¹¦ç± $.store.* - è·å–storeä¸‹çš„æ‰€æœ‰å­å…ƒç´  2. æ•°æ®ç±»å‹è½¬æ¢ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 // å­—ç¬¦ä¸²è½¬å¯¹è±¡ \u0026#34;{\\\u0026#34;name\\\u0026#34;:\\\u0026#34;å¼ ä¸‰\\\u0026#34;,\\\u0026#34;age\\\u0026#34;:25}\u0026#34; â†’ {\u0026#34;name\u0026#34;:\u0026#34;å¼ ä¸‰\u0026#34;,\u0026#34;age\u0026#34;:25} // å¯¹è±¡è½¬å­—ç¬¦ä¸² {\u0026#34;name\u0026#34;:\u0026#34;å¼ ä¸‰\u0026#34;,\u0026#34;age\u0026#34;:25} â†’ \u0026#34;{\\\u0026#34;name\\\u0026#34;:\\\u0026#34;å¼ ä¸‰\\\u0026#34;,\\\u0026#34;age\\\u0026#34;:25}\u0026#34; // è¡¨æ ¼è½¬JSON |å§“å|å¹´é¾„| |---|---| |å¼ ä¸‰|25| |æå››|30| â†“ [ {\u0026#34;å§“å\u0026#34;:\u0026#34;å¼ ä¸‰\u0026#34;,\u0026#34;å¹´é¾„\u0026#34;:25}, {\u0026#34;å§“å\u0026#34;:\u0026#34;æå››\u0026#34;,\u0026#34;å¹´é¾„\u0026#34;:30} ] å®æˆ˜åº”ç”¨æ¡ˆä¾‹ æ¡ˆä¾‹ä¸€ï¼šAPIå¼€å‘è°ƒè¯• åœºæ™¯ï¼šå¼€å‘RESTful APIæ—¶ï¼Œéœ€è¦è°ƒè¯•JSONå“åº”æ•°æ®\næ­¥éª¤æ¼”ç¤ºï¼š\nåŸå§‹APIå“åº” 1 2 3 4 HTTP/1.1 200 OK Content-Type: application/json {\u0026#34;users\u0026#34;:[{\u0026#34;id\u0026#34;:1,\u0026#34;name\u0026#34;:\u0026#34;å¼ ä¸‰\u0026#34;,\u0026#34;email\u0026#34;:\u0026#34;zhangsan@example.com\u0026#34;,\u0026#34;profile\u0026#34;:{\u0026#34;age\u0026#34;:25,\u0026#34;city\u0026#34;:\u0026#34;æ·±åœ³\u0026#34;,\u0026#34;interests\u0026#34;:[\u0026#34;ç¼–ç¨‹\u0026#34;,\u0026#34;é˜…è¯»\u0026#34;,\u0026#34;è¿åŠ¨\u0026#34;]}},{\u0026#34;id\u0026#34;:2,\u0026#34;name\u0026#34;:\u0026#34;æå››\u0026#34;,\u0026#34;email\u0026#34;:\u0026#34;lisi@example.com\u0026#34;,\u0026#34;profile\u0026#34;:{\u0026#34;age\u0026#34;:30,\u0026#34;city\u0026#34;:\u0026#34;åŒ—äº¬\u0026#34;,\u0026#34;interests\u0026#34;:[\u0026#34;è®¾è®¡\u0026#34;,\u0026#34;æ‘„å½±\u0026#34;]}}],\u0026#34;total\u0026#34;:2,\u0026#34;success\u0026#34;:true} æ ¼å¼åŒ–åçš„æ•°æ® 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 { \u0026#34;users\u0026#34;: [ { \u0026#34;id\u0026#34;: 1, \u0026#34;name\u0026#34;: \u0026#34;å¼ ä¸‰\u0026#34;, \u0026#34;email\u0026#34;: \u0026#34;zhangsan@example.com\u0026#34;, \u0026#34;profile\u0026#34;: { \u0026#34;age\u0026#34;: 25, \u0026#34;city\u0026#34;: \u0026#34;æ·±åœ³\u0026#34;, \u0026#34;interests\u0026#34;: [ \u0026#34;ç¼–ç¨‹\u0026#34;, \u0026#34;é˜…è¯»\u0026#34;, \u0026#34;è¿åŠ¨\u0026#34; ] } }, { \u0026#34;id\u0026#34;: 2, \u0026#34;name\u0026#34;: \u0026#34;æå››\u0026#34;, \u0026#34;email\u0026#34;: \u0026#34;lisi@example.com\u0026#34;, \u0026#34;profile\u0026#34;: { \u0026#34;age\u0026#34;: 30, \u0026#34;city\u0026#34;: \u0026#34;åŒ—äº¬\u0026#34;, \u0026#34;interests\u0026#34;: [ \u0026#34;è®¾è®¡\u0026#34;, \u0026#34;æ‘„å½±\u0026#34; ] } } ], \u0026#34;total\u0026#34;: 2, \u0026#34;success\u0026#34;: true } æ•°æ®æå–å’Œåˆ†æ 1 2 3 4 5 // ä½¿ç”¨JavaScriptæå–ç‰¹å®šæ•°æ® const response = {\u0026#34;users\u0026#34;:[...]}; // APIå“åº”æ•°æ® const users = response.users; const userCities = users.map(user =\u0026gt; user.profile.city); console.log(\u0026#34;ç”¨æˆ·åŸå¸‚åˆ†å¸ƒ:\u0026#34;, userCities); // [\u0026#34;æ·±åœ³\u0026#34;, \u0026#34;åŒ—äº¬\u0026#34;] æ¡ˆä¾‹äºŒï¼šé…ç½®æ–‡ä»¶ç®¡ç† åœºæ™¯ï¼šç®¡ç†åº”ç”¨ç¨‹åºçš„JSONé…ç½®æ–‡ä»¶\né…ç½®æ–‡ä»¶ç¤ºä¾‹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 { \u0026#34;app\u0026#34;: { \u0026#34;name\u0026#34;: \u0026#34;Utilå·¥å…·ç®±\u0026#34;, \u0026#34;version\u0026#34;: \u0026#34;2.0.0\u0026#34;, \u0026#34;debug\u0026#34;: false, \u0026#34;timeout\u0026#34;: 30000 }, \u0026#34;database\u0026#34;: { \u0026#34;host\u0026#34;: \u0026#34;localhost\u0026#34;, \u0026#34;port\u0026#34;: 3306, \u0026#34;username\u0026#34;: \u0026#34;admin\u0026#34;, \u0026#34;password\u0026#34;: \u0026#34;encrypted_password\u0026#34;, \u0026#34;database\u0026#34;: \u0026#34;util_db\u0026#34; }, \u0026#34;api\u0026#34;: { \u0026#34;base_url\u0026#34;: \u0026#34;https://api.util.cn\u0026#34;, \u0026#34;version\u0026#34;: \u0026#34;v1\u0026#34;, \u0026#34;timeout\u0026#34;: 10000, \u0026#34;retry_count\u0026#34;: 3 }, \u0026#34;features\u0026#34;: { \u0026#34;enable_cache\u0026#34;: true, \u0026#34;enable_logging\u0026#34;: true, \u0026#34;enable_analytics\u0026#34;: false } } æ ¼å¼åŒ–ä¼˜åŒ–åçš„é…ç½®ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 { \u0026#34;app\u0026#34;: { \u0026#34;name\u0026#34;: \u0026#34;Utilå·¥å…·ç®±\u0026#34;, \u0026#34;version\u0026#34;: \u0026#34;2.0.0\u0026#34;, \u0026#34;debug\u0026#34;: false, \u0026#34;timeout\u0026#34;: 30000 }, \u0026#34;database\u0026#34;: { \u0026#34;host\u0026#34;: \u0026#34;localhost\u0026#34;, \u0026#34;port\u0026#34;: 3306, \u0026#34;username\u0026#34;: \u0026#34;admin\u0026#34;, \u0026#34;password\u0026#34;: \u0026#34;encrypted_password\u0026#34;, \u0026#34;database\u0026#34;: \u0026#34;util_db\u0026#34; }, \u0026#34;api\u0026#34;: { \u0026#34;base_url\u0026#34;: \u0026#34;https://api.util.cn\u0026#34;, \u0026#34;version\u0026#34;: \u0026#34;v1\u0026#34;, \u0026#34;timeout\u0026#34;: 10000, \u0026#34;retry_count\u0026#34;: 3 }, \u0026#34;features\u0026#34;: { \u0026#34;enable_cache\u0026#34;: true, \u0026#34;enable_logging\u0026#34;: true, \u0026#34;enable_analytics\u0026#34;: false } } æ¡ˆä¾‹ä¸‰ï¼šæ•°æ®è¿ç§»å’Œè½¬æ¢ åœºæ™¯ï¼šå°†ä¸åŒæ ¼å¼çš„æ•°æ®è½¬æ¢ä¸ºJSONæ ¼å¼\nCSVè½¬JSONç¤ºä¾‹ï¼š\nåŸå§‹CSVæ•°æ®ï¼š\n1 2 3 4 id,name,department,salary 001,å¼ ä¸‰,æŠ€æœ¯éƒ¨,15000 002,æå››,å¸‚åœºéƒ¨,12000 003,ç‹äº”,è®¾è®¡éƒ¨,13000 è½¬æ¢åçš„JSONï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 { \u0026#34;employees\u0026#34;: [ { \u0026#34;id\u0026#34;: \u0026#34;001\u0026#34;, \u0026#34;name\u0026#34;: \u0026#34;å¼ ä¸‰\u0026#34;, \u0026#34;department\u0026#34;: \u0026#34;æŠ€æœ¯éƒ¨\u0026#34;, \u0026#34;salary\u0026#34;: 15000 }, { \u0026#34;id\u0026#34;: \u0026#34;002\u0026#34;, \u0026#34;name\u0026#34;: \u0026#34;æå››\u0026#34;, \u0026#34;department\u0026#34;: \u0026#34;å¸‚åœºéƒ¨\u0026#34;, \u0026#34;salary\u0026#34;: 12000 }, { \u0026#34;id\u0026#34;: \u0026#34;003\u0026#34;, \u0026#34;name\u0026#34;: \u0026#34;ç‹äº”\u0026#34;, \u0026#34;department\u0026#34;: \u0026#34;è®¾è®¡éƒ¨\u0026#34;, \u0026#34;salary\u0026#34;: 13000 } ], \u0026#34;total_count\u0026#34;: 3, \u0026#34;export_date\u0026#34;: \u0026#34;2025-12-18\u0026#34; } æœ€ä½³å®è·µ 1. JSONç»“æ„è®¾è®¡åŸåˆ™ å‘½åè§„èŒƒ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 // âœ… æ¨èå‘½åæ–¹å¼ { \u0026#34;userName\u0026#34;: \u0026#34;å¼ ä¸‰\u0026#34;, // é©¼å³°å‘½åæ³• \u0026#34;first_name\u0026#34;: \u0026#34;å¼ ä¸‰\u0026#34;, // ä¸‹åˆ’çº¿å‘½åæ³• \u0026#34;createdAt\u0026#34;: \u0026#34;2025-12-18\u0026#34;, // æ—¶é—´æˆ³å­—æ®µ \u0026#34;isActive\u0026#34;: true // å¸ƒå°”å€¼ä½¿ç”¨iså‰ç¼€ } // âŒ ä¸æ¨èå‘½åæ–¹å¼ { \u0026#34;user-name\u0026#34;: \u0026#34;å¼ ä¸‰\u0026#34;, // é¿å…è¿å­—ç¬¦ \u0026#34;Name\u0026#34;: \u0026#34;å¼ ä¸‰\u0026#34;, // é¿å…å¤§å†™å¼€å¤´ \u0026#34;create time\u0026#34;: \u0026#34;2025-12-18\u0026#34; // é¿å…ç©ºæ ¼ } æ•°æ®ç»“æ„ä¼˜åŒ– 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 // âœ… ä¼˜åŒ–åçš„ç»“æ„ { \u0026#34;user\u0026#34;: { \u0026#34;id\u0026#34;: 1, \u0026#34;name\u0026#34;: \u0026#34;å¼ ä¸‰\u0026#34;, \u0026#34;contact\u0026#34;: { \u0026#34;email\u0026#34;: \u0026#34;zhangsan@example.com\u0026#34;, \u0026#34;phone\u0026#34;: \u0026#34;+86 13800138000\u0026#34; }, \u0026#34;preferences\u0026#34;: { \u0026#34;language\u0026#34;: \u0026#34;zh-CN\u0026#34;, \u0026#34;theme\u0026#34;: \u0026#34;dark\u0026#34;, \u0026#34;notifications\u0026#34;: true } } } // âŒ æ‰å¹³åŒ–ç»“æ„ï¼ˆä¸æ¨èï¼‰ { \u0026#34;user_id\u0026#34;: 1, \u0026#34;user_name\u0026#34;: \u0026#34;å¼ ä¸‰\u0026#34;, \u0026#34;user_email\u0026#34;: \u0026#34;zhangsan@example.com\u0026#34;, \u0026#34;user_phone\u0026#34;: \u0026#34;+86 13800138000\u0026#34;, \u0026#34;user_language\u0026#34;: \u0026#34;zh-CN\u0026#34;, \u0026#34;user_theme\u0026#34;: \u0026#34;dark\u0026#34;, \u0026#34;user_notifications\u0026#34;: true } 2. æ€§èƒ½ä¼˜åŒ–æŠ€å·§ æ•°æ®å‹ç¼© 1 2 3 4 5 6 7 8 9 10 11 12 13 // ä½¿ç”¨JSONå‹ç¼©å‡å°‘ä¼ è¾“å¤§å° function compressJson(jsonData) { return JSON.stringify(jsonData) .replace(/\\s+/g, \u0026#39;\u0026#39;) // ç§»é™¤ç©ºæ ¼ .replace(/,\\s*}/g, \u0026#39;}\u0026#39;) // ç§»é™¤å¯¹è±¡æœ«å°¾é€—å· .replace(/,\\s*]/g, \u0026#39;]\u0026#39;); // ç§»é™¤æ•°ç»„æœ«å°¾é€—å· } // æ£€æµ‹å‹ç¼©æ•ˆæœ const original = JSON.stringify(data); const compressed = compressJson(data); const compressionRatio = ((original.length - compressed.length) / original.length * 100).toFixed(2); console.log(`å‹ç¼©ç‡: ${compressionRatio}%`); ç¼“å­˜ç­–ç•¥ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 // JSONæ•°æ®ç¼“å­˜ç¤ºä¾‹ class JsonCache { constructor() { this.cache = new Map(); } set(key, data, ttl = 3600000) { // é»˜è®¤1å°æ—¶è¿‡æœŸ this.cache.set(key, { data: data, timestamp: Date.now(), ttl: ttl }); } get(key) { const item = this.cache.get(key); if (!item) return null; if (Date.now() - item.timestamp \u0026gt; item.ttl) { this.cache.delete(key); return null; } return item.data; } } 3. å®‰å…¨è€ƒè™‘ æ•æ„Ÿæ•°æ®å¤„ç† 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 // âŒ ä¸å®‰å…¨ï¼šæ˜æ–‡å­˜å‚¨æ•æ„Ÿä¿¡æ¯ { \u0026#34;user\u0026#34;: { \u0026#34;name\u0026#34;: \u0026#34;å¼ ä¸‰\u0026#34;, \u0026#34;password\u0026#34;: \u0026#34;123456\u0026#34;, \u0026#34;creditCard\u0026#34;: \u0026#34;1234-5678-9012-3456\u0026#34; } } // âœ… å®‰å…¨ï¼šåŠ å¯†æˆ–éšè—æ•æ„Ÿä¿¡æ¯ { \u0026#34;user\u0026#34;: { \u0026#34;name\u0026#34;: \u0026#34;å¼ ä¸‰\u0026#34;, \u0026#34;password\u0026#34;: \u0026#34;***encrypted***\u0026#34;, \u0026#34;creditCard\u0026#34;: \u0026#34;***-****-****-3456\u0026#34; } } JSONæ³¨å…¥é˜²æŠ¤ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 // é˜²æ­¢JSONæ³¨å…¥æ”»å‡» function safeJsonParse(jsonString) { try { // éªŒè¯è¾“å…¥æ˜¯å¦ä¸ºæœ‰æ•ˆJSON if (typeof jsonString !== \u0026#39;string\u0026#39;) { throw new Error(\u0026#39;Input must be a string\u0026#39;); } // ç§»é™¤æ½œåœ¨çš„æ¶æ„ä»£ç  const sanitized = jsonString .replace(/\u0026lt;script[^\u0026gt;]*\u0026gt;.*?\u0026lt;\\/script\u0026gt;/gi, \u0026#39;\u0026#39;) .replace(/javascript:/gi, \u0026#39;\u0026#39;) .replace(/on\\w+\\s*=/gi, \u0026#39;\u0026#39;); return JSON.parse(sanitized); } catch (error) { console.error(\u0026#39;JSONè§£æé”™è¯¯:\u0026#39;, error.message); return null; } } å·¥å…·æ¨è åœ¨çº¿å·¥å…· JSON Formatter \u0026amp; Validator\nåœ°å€ï¼šhttps://jsonformatter.curiousconcept.com/ åŠŸèƒ½ï¼šæ ¼å¼åŒ–ã€éªŒè¯ã€å‹ç¼©JSON JSON Editor Online\nåœ°å€ï¼šhttps://jsoneditoronline.org/ åŠŸèƒ½ï¼šå¯è§†åŒ–ç¼–è¾‘ã€æ ‘å½¢ç»“æ„å±•ç¤º å¼€å‘å·¥å…· VS Codeæ’ä»¶\nJSON Toolsï¼šè¯­æ³•é«˜äº®ã€æ ¼å¼åŒ–ã€éªŒè¯ Prettierï¼šä»£ç æ ¼å¼åŒ– ESLintï¼šä»£ç è´¨é‡æ£€æŸ¥ å‘½ä»¤è¡Œå·¥å…·\n1 2 3 4 5 6 7 8 # jq - JSONå¤„ç†å‘½ä»¤è¡Œå·¥å…· # å®‰è£… sudo apt-get install jq # Ubuntu/Debian brew install jq # macOS # ä½¿ç”¨ç¤ºä¾‹ cat data.json | jq \u0026#39;.users[0].name\u0026#39; # æå–ç”¨æˆ·å cat data.json | jq \u0026#39;.\u0026#39; # æ ¼å¼åŒ–è¾“å‡º ç¼–ç¨‹è¯­è¨€åº“ JavaScript 1 2 3 4 5 6 7 // ä½¿ç”¨JSONå¯¹è±¡çš„æ–¹æ³• const jsonString = JSON.stringify(obj, null, 2); // æ ¼å¼åŒ– const parsed = JSON.parse(jsonString); // è§£æ // ä½¿ç”¨ç¬¬ä¸‰æ–¹åº“ import { format } from \u0026#39;prettier\u0026#39;; const formatted = format(jsonString, { parser: \u0026#39;json\u0026#39; }); Python 1 2 3 4 5 6 7 8 9 10 import json from pprint import pprint # JSONæ“ä½œ data = {\u0026#34;name\u0026#34;: \u0026#34;å¼ ä¸‰\u0026#34;, \u0026#34;age\u0026#34;: 25} json_str = json.dumps(data, indent=2, ensure_ascii=False) # æ ¼å¼åŒ– parsed = json.loads(json_str) # è§£æ # ç¾åŒ–è¾“å‡º pprint(data) å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ é—®é¢˜1ï¼šJSONè§£æå¤±è´¥ é”™è¯¯ä¿¡æ¯ï¼šSyntaxError: Unexpected token in JSON at position 0\nå¯èƒ½åŸå› ï¼š\nJSONæ ¼å¼ä¸æ­£ç¡® åŒ…å«å•å¼•å· æœ‰å¤šä½™é€—å· å­—ç¬¦ç¼–ç é—®é¢˜ è§£å†³æ–¹æ¡ˆï¼š\n1 2 3 4 5 6 7 8 function fixJsonString(jsonString) { return jsonString .replace(/\u0026#39;/g, \u0026#39;\u0026#34;\u0026#39;) // å•å¼•å·è½¬åŒå¼•å· .replace(/,\\s*}/g, \u0026#39;}\u0026#39;) // ç§»é™¤å¯¹è±¡æœ«å°¾é€—å· .replace(/,\\s*]/g, \u0026#39;]\u0026#39;) // ç§»é™¤æ•°ç»„æœ«å°¾é€—å· .replace(/(\\w+):/g, \u0026#39;\u0026#34;$1\u0026#34;:\u0026#39;) // å±æ€§ååŠ å¼•å· .trim(); // å»é™¤é¦–å°¾ç©ºæ ¼ } é—®é¢˜2ï¼šä¸­æ–‡å­—ç¬¦æ˜¾ç¤ºå¼‚å¸¸ é—®é¢˜ç°è±¡ï¼šä¸­æ–‡å­—ç¬¦æ˜¾ç¤ºä¸ºä¹±ç æˆ–Unicodeè½¬ä¹‰åºåˆ—\nè§£å†³æ–¹æ¡ˆï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 // ç¡®ä¿æ­£ç¡®å¤„ç†ä¸­æ–‡å­—ç¬¦ const data = { name: \u0026#34;å¼ ä¸‰\u0026#34;, city: \u0026#34;æ·±åœ³\u0026#34; }; // JSON.stringifyæ—¶ä¿ç•™ä¸­æ–‡å­—ç¬¦ const jsonString = JSON.stringify(data, null, 2); console.log(jsonString); // è¾“å‡º: {\u0026#34;name\u0026#34;: \u0026#34;å¼ ä¸‰\u0026#34;, \u0026#34;city\u0026#34;: \u0026#34;æ·±åœ³\u0026#34;} // å¦‚æœéœ€è¦Unicodeè½¬ä¹‰ const unicodeString = JSON.stringify(data); console.log(unicodeString); // è¾“å‡º: {\u0026#34;name\u0026#34;:\u0026#34;\\u5f20\\u4e09\u0026#34;,\u0026#34;city\u0026#34;:\u0026#34;\\u6df1\\u5733\u0026#34;} é—®é¢˜3ï¼šå¤§æ•°æ®é‡å¤„ç†æ€§èƒ½ é—®é¢˜æè¿°ï¼šå¤„ç†å¤§å‹JSONæ–‡ä»¶æ—¶å‡ºç°æ€§èƒ½é—®é¢˜\nä¼˜åŒ–æ–¹æ¡ˆï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 // ä½¿ç”¨æµå¼å¤„ç†å¤§å‹JSONæ–‡ä»¶ const fs = require(\u0026#39;fs\u0026#39;); const JSONStream = require(\u0026#39;JSONStream\u0026#39;); // æµå¼è¯»å–å’Œå¤„ç† fs.createReadStream(\u0026#39;large-data.json\u0026#39;) .pipe(JSONStream.parse(\u0026#39;*\u0026#39;)) .on(\u0026#39;data\u0026#39;, function(data) { // å¤„ç†æ¯ä¸ªå¯¹è±¡ processItem(data); }) .on(\u0026#39;end\u0026#39;, function() { console.log(\u0026#39;å¤„ç†å®Œæˆ\u0026#39;); }); é—®é¢˜4ï¼šJSON SchemaéªŒè¯ ä½¿ç”¨åœºæ™¯ï¼šéœ€è¦éªŒè¯JSONæ•°æ®æ˜¯å¦ç¬¦åˆé¢„å®šä¹‰çš„ç»“æ„\nç¤ºä¾‹å®ç°ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 const Ajv = require(\u0026#39;ajv\u0026#39;); const ajv = new Ajv(); // å®šä¹‰JSON Schema const schema = { type: \u0026#34;object\u0026#34;, properties: { name: { type: \u0026#34;string\u0026#34;, minLength: 1 }, age: { type: \u0026#34;number\u0026#34;, minimum: 0, maximum: 150 }, email: { type: \u0026#34;string\u0026#34;, format: \u0026#34;email\u0026#34; } }, required: [\u0026#34;name\u0026#34;, \u0026#34;age\u0026#34;], additionalProperties: false }; // éªŒè¯æ•°æ® const validate = ajv.compile(schema); const data = { name: \u0026#34;å¼ ä¸‰\u0026#34;, age: 25, email: \u0026#34;zhangsan@example.com\u0026#34; }; if (validate(data)) { console.log(\u0026#39;éªŒè¯é€šè¿‡\u0026#39;); } else { console.log(\u0026#39;éªŒè¯å¤±è´¥:\u0026#39;, validate.errors); } æ€»ç»“ä¸å±•æœ› å­¦ä¹ è¦ç‚¹å›é¡¾ é€šè¿‡æœ¬æ•™ç¨‹ï¼Œæˆ‘ä»¬æ·±å…¥å­¦ä¹ äº†ï¼š\nJSONåŸºç¡€æ¦‚å¿µ\nJSONæ•°æ®æ ¼å¼å’Œè¯­æ³•è§„åˆ™ æ”¯æŒçš„æ•°æ®ç±»å‹å’Œç»“æ„ ä¸å…¶ä»–æ•°æ®æ ¼å¼çš„æ¯”è¾ƒ æ ¼å¼åŒ–å·¥å…·åŠŸèƒ½\nç¾åŒ–æ ¼å¼åŒ–å’Œæ•°æ®éªŒè¯ æ•°æ®å‹ç¼©å’Œä¼˜åŒ– é«˜çº§åŠŸèƒ½å¦‚è·¯å¾„æŸ¥è¯¢ å®é™…åº”ç”¨åœºæ™¯\nAPIå¼€å‘è°ƒè¯• é…ç½®æ–‡ä»¶ç®¡ç† æ•°æ®è¿ç§»å’Œè½¬æ¢ æœ€ä½³å®è·µ\nç»“æ„è®¾è®¡åŸåˆ™ æ€§èƒ½ä¼˜åŒ–æŠ€å·§ å®‰å…¨è€ƒè™‘å’Œé˜²æŠ¤ è¿›é˜¶å­¦ä¹ å»ºè®® æ·±å…¥å­¦ä¹ JSON Schema\nå¤æ‚çš„æ•°æ®ç»“æ„å®šä¹‰ é«˜çº§éªŒè¯è§„åˆ™ è‡ªåŠ¨ä»£ç ç”Ÿæˆ æ¢ç´¢ç›¸å…³æŠ€æœ¯\nGraphQLï¼šæ›´å¼ºå¤§çš„æ•°æ®æŸ¥è¯¢è¯­è¨€ Protocol Buffersï¼šæ›´é«˜æ•ˆçš„åºåˆ—åŒ–æ ¼å¼ YAMLï¼šæ›´å‹å¥½çš„é…ç½®æ–‡ä»¶æ ¼å¼ æ€§èƒ½ä¼˜åŒ–è¿›é˜¶\nå¤§æ•°æ®é‡å¤„ç†æŠ€æœ¯ å®æ—¶æ•°æ®æµå¤„ç† åˆ†å¸ƒå¼JSONå­˜å‚¨ å®è·µé¡¹ç›®å»ºè®® æ„å»ºJSONå·¥å…·é›†\nå¼€å‘è‡ªå®šä¹‰çš„JSONå¤„ç†å·¥å…· é›†æˆå¤šç§æ ¼å¼è½¬æ¢åŠŸèƒ½ æ·»åŠ æ•°æ®å¯è§†åŒ–åŠŸèƒ½ æ•°æ®ç®¡ç†ç³»ç»Ÿ\nåˆ›å»ºJSONæ•°æ®åº“ å®ç°æ•°æ®åŒæ­¥å’Œå¤‡ä»½ å¼€å‘æ•°æ®åˆ†æå’ŒæŠ¥è¡¨åŠŸèƒ½ APIå¼€å‘é¡¹ç›®\nè®¾è®¡RESTful API å®ç°æ•°æ®éªŒè¯å’Œé”™è¯¯å¤„ç† æ·»åŠ APIæ–‡æ¡£å’Œæµ‹è¯• ç›¸å…³èµ„æº å®˜æ–¹æ–‡æ¡£ JSONå®˜æ–¹è§„èŒƒ ECMAScript JSONè§„èŒƒ å¼€å‘å·¥å…· JSON Formatter - åœ¨çº¿JSONæ ¼å¼åŒ–å·¥å…· JSON Validator - JSONæ•°æ®éªŒè¯å·¥å…· JSON Converter - å¤šæ ¼å¼è½¬æ¢å·¥å…· å­¦ä¹ èµ„æº MDN JSONæŒ‡å— JSON Schemaè§„èŒƒ jqæ‰‹å†Œ æŠ€æœ¯ç¤¾åŒº Stack Overflow JSONæ ‡ç­¾ GitHub JSONç›¸å…³é¡¹ç›® æ•™ç¨‹å®Œæˆï¼ğŸ‰\nå¦‚æœä½ è§‰å¾—è¿™ä¸ªæ•™ç¨‹æœ‰å¸®åŠ©ï¼Œæ¬¢è¿ï¼š\nå°è¯•ä½¿ç”¨æˆ‘ä»¬çš„JSONæ ¼å¼åŒ–å·¥å…· åˆ†äº«ç»™å…¶ä»–å¼€å‘è€…æœ‹å‹ åœ¨è¯„è®ºåŒºæå‡ºå®è´µå»ºè®® æœ‰ç–‘é—®æˆ–é‡åˆ°é—®é¢˜ï¼Ÿæ¬¢è¿åœ¨ä¸‹æ–¹ç•™è¨€è®¨è®ºï¼Œæˆ‘ä»¬ä¼šåŠæ—¶ä¸ºä½ è§£ç­”ï¼\n","permalink":"/blog/articles/json-formatter-complete-guide/","summary":"æŒæ¡JSONæ ¼å¼åŒ–å·¥å…·çš„ä½¿ç”¨æ–¹æ³•ï¼Œæå‡æ•°æ®å¤„ç†æ•ˆç‡ï¼ŒåŒ…å«å®æˆ˜æ¡ˆä¾‹å’Œæœ€ä½³å®è·µ","title":"JSONæ ¼å¼åŒ–å·¥å…·å®Œå…¨æŒ‡å—ï¼šä»åŸºç¡€åˆ°è¿›é˜¶çš„å®ç”¨æ•™ç¨‹"},{"content":"ç®—æ³•ä¸æ•°æ®ç»“æ„å­¦ä¹ è·¯å¾„ï¼šä»é›¶åŸºç¡€åˆ°ç®—æ³•å¤§å¸ˆçš„å®Œæ•´æŒ‡å— æŒæ¡ç®—æ³•å’Œæ•°æ®ç»“æ„æ˜¯æ¯ä¸ªç¨‹åºå‘˜æˆé•¿çš„å¿…ç»ä¹‹è·¯ã€‚æ— è®ºæ˜¯æ—¥å¸¸å¼€å‘ä¸­çš„æ€§èƒ½ä¼˜åŒ–ï¼Œè¿˜æ˜¯æŠ€æœ¯é¢è¯•ä¸­çš„ç®—æ³•é¢˜ç›®ï¼Œæ‰å®çš„åŸºç¡€éƒ½æ˜¯å…³é”®ã€‚æœ¬æ–‡å°†æä¾›ä¸€ä¸ªç³»ç»Ÿçš„å­¦ä¹ è·¯å¾„ï¼Œå¸®åŠ©ä½ ä»é›¶å¼€å§‹é€æ­¥æŒæ¡ç®—æ³•ä¸æ•°æ®ç»“æ„ã€‚\nå­¦ä¹ è·¯å¾„æ¦‚è§ˆ é˜¶æ®µåˆ’åˆ† graph TD A[åŸºç¡€å‡†å¤‡é˜¶æ®µ] --\u0026gt; B[åŸºç¡€æ•°æ®ç»“æ„] B --\u0026gt; C[åŸºç¡€ç®—æ³•] C --\u0026gt; D[é«˜çº§æ•°æ®ç»“æ„] D --\u0026gt; E[é«˜çº§ç®—æ³•] E --\u0026gt; F[ä¸“é¡¹è®­ç»ƒ] F --\u0026gt; G[å®æˆ˜åº”ç”¨] A --\u0026gt; A1[æ•°å­¦åŸºç¡€] A --\u0026gt; A2[ç¼–ç¨‹è¯­è¨€] A --\u0026gt; A3[æ—¶é—´å¤æ‚åº¦] B --\u0026gt; B1[æ•°ç»„/é“¾è¡¨] B --\u0026gt; B2[æ ˆ/é˜Ÿåˆ—] B --\u0026gt; B3[å“ˆå¸Œè¡¨] B --\u0026gt; B4[æ ‘/å›¾åŸºç¡€] C --\u0026gt; C1[æ’åºç®—æ³•] C --\u0026gt; C2[æœç´¢ç®—æ³•] C --\u0026gt; C3[é€’å½’/å›æº¯] C --\u0026gt; C4[è´ªå¿ƒç®—æ³•] D --\u0026gt; D1[äºŒå‰æœç´¢æ ‘] D --\u0026gt; D2[å¹³è¡¡æ ‘] D --\u0026gt; D3[å †] D --\u0026gt; D4[å›¾çš„é«˜çº§ç»“æ„] E --\u0026gt; E1[åŠ¨æ€è§„åˆ’] E --\u0026gt; E2[å›¾çš„ç®—æ³•] E --\u0026gt; E3[å­—ç¬¦ä¸²ç®—æ³•] E --\u0026gt; E4[æ•°è®ºç®—æ³•] F --\u0026gt; F1[LeetCodeè®­ç»ƒ] F --\u0026gt; F2[ç®—æ³•ç«èµ›] F --\u0026gt; F3[ç³»ç»Ÿè®¾è®¡] G --\u0026gt; G1[å®é™…é¡¹ç›®] G --\u0026gt; G2[æ€§èƒ½ä¼˜åŒ–] G --\u0026gt; G3[é¢è¯•å‡†å¤‡] ç¬¬ä¸€é˜¶æ®µï¼šåŸºç¡€å‡†å¤‡ï¼ˆ2-3å‘¨ï¼‰ 1. æ•°å­¦åŸºç¡€å¤ä¹  éœ€è¦æŒæ¡çš„æ¦‚å¿µï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 // æ—¶é—´å¤æ‚åº¦è®¡ç®—ç¤ºä¾‹ function example(n) { // O(1) - å¸¸æ•°æ—¶é—´ let x = 1 // O(n) - çº¿æ€§æ—¶é—´ for (let i = 0; i \u0026lt; n; i++) { console.log(i) } // O(nÂ²) - å¹³æ–¹æ—¶é—´ for (let i = 0; i \u0026lt; n; i++) { for (let j = 0; j \u0026lt; n; j++) { console.log(i, j) } } } // å¸¸è§æ—¶é—´å¤æ‚åº¦ // O(1) \u0026lt; O(log n) \u0026lt; O(n) \u0026lt; O(n log n) \u0026lt; O(nÂ²) \u0026lt; O(nÂ³) \u0026lt; O(2^n) \u0026lt; O(n!) å¯¹æ•°è¿ç®—ï¼š\n1 2 3 4 5 6 7 8 // logâ‚‚(8) = 3 å› ä¸º 2Â³ = 8 // logâ‚â‚€(100) = 2 å› ä¸º 10Â² = 100 // åœ¨ç®—æ³•ä¸­ï¼Œé»˜è®¤logè¡¨ç¤ºä»¥2ä¸ºåº•çš„å¯¹æ•° // ä¸ºä»€ä¹ˆäºŒåˆ†æŸ¥æ‰¾æ˜¯O(log n)ï¼Ÿ // æ¯æ¬¡æŸ¥æ‰¾éƒ½å°†æœç´¢ç©ºé—´å‡åŠ // n -\u0026gt; n/2 -\u0026gt; n/4 -\u0026gt; ... -\u0026gt; 1 // éœ€è¦logâ‚‚næ¬¡æ“ä½œ 2. ç¼–ç¨‹è¯­è¨€å‡†å¤‡ JavaScriptåŸºç¡€ç»ƒä¹ ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 // æ•°ç»„æ“ä½œå¿…é¡»ç†Ÿç»ƒ const arr = [1, 2, 3, 4, 5] // æ·»åŠ å…ƒç´  arr.push(6) // å°¾éƒ¨æ·»åŠ  arr.unshift(0) // å¤´éƒ¨æ·»åŠ  arr.splice(2, 0, 2.5) // ä¸­é—´æ’å…¥ // åˆ é™¤å…ƒç´  arr.pop() // å°¾éƒ¨åˆ é™¤ arr.shift() // å¤´éƒ¨åˆ é™¤ arr.splice(2, 1) // åˆ é™¤æŒ‡å®šä½ç½® // éå†æ•°ç»„ arr.forEach(item =\u0026gt; console.log(item)) const doubled = arr.map(x =\u0026gt; x * 2) const evens = arr.filter(x =\u0026gt; x % 2 === 0) const sum = arr.reduce((acc, x) =\u0026gt; acc + x, 0) // å¯¹è±¡æ“ä½œ const map = new Map() map.set(\u0026#39;key1\u0026#39;, \u0026#39;value1\u0026#39;) map.set(\u0026#39;key2\u0026#39;, \u0026#39;value2\u0026#39;) console.log(map.get(\u0026#39;key1\u0026#39;)) console.log(map.has(\u0026#39;key1\u0026#39;)) map.delete(\u0026#39;key1\u0026#39;) // Setæ“ä½œ const set = new Set([1, 2, 3, 3, 4]) console.log(set) // Set {1, 2, 3, 4} 3. å¼€å‘ç¯å¢ƒæ­å»º 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 // æ¨èçš„åœ¨çº¿ç»ƒä¹ å¹³å° const platforms = { leetcode: \u0026#39;https://leetcode.com/\u0026#39;, hackerRank: \u0026#39;https://www.hackerrank.com/\u0026#39;, codeforces: \u0026#39;https://codeforces.com/\u0026#39;, atcoder: \u0026#39;https://atcoder.jp/\u0026#39; } // æœ¬åœ°å¼€å‘ç¯å¢ƒ const setup = { editor: \u0026#39;VS Code\u0026#39;, extensions: [ \u0026#39;LeetCode\u0026#39;, // ç›´æ¥åœ¨VS Codeåˆ·é¢˜ \u0026#39;Code Runner\u0026#39;, // å¿«é€Ÿè¿è¡Œä»£ç  \u0026#39;JavaScript Debugger\u0026#39; ], node: \u0026#39;Node.js 18+\u0026#39;, debugger: \u0026#39;Chrome DevTools æˆ– VS Code Debugger\u0026#39; } ç¬¬äºŒé˜¶æ®µï¼šåŸºç¡€æ•°æ®ç»“æ„ï¼ˆ4-5å‘¨ï¼‰ 1. æ•°ç»„ï¼ˆArraysï¼‰ æ ¸å¿ƒæ¦‚å¿µï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 // æ•°ç»„æ˜¯æœ€åŸºç¡€çš„æ•°æ®ç»“æ„ class MyArray { constructor() { this.data = {} this.length = 0 } get(index) { return this.data[index] } push(item) { this.data[this.length] = item this.length++ return this.length } pop() { const lastItem = this.data[this.length - 1] delete this.data[this.length - 1] this.length-- return lastItem } delete(index) { const item = this.data[index] this.shiftItems(index) return item } shiftItems(index) { for (let i = index; i \u0026lt; this.length - 1; i++) { this.data[i] = this.data[i + 1] } delete this.data[this.length - 1] this.length-- } } å¸¸è§æ•°ç»„ç®—æ³•ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 // ä¸¤æ•°ä¹‹å’Œ function twoSum(nums, target) { const map = new Map() for (let i = 0; i \u0026lt; nums.length; i++) { const complement = target - nums[i] if (map.has(complement)) { return [map.get(complement), i] } map.set(nums[i], i) } return [] } // æœ€å¤§å­æ•°ç»„å’Œ function maxSubArray(nums) { let maxSoFar = -Infinity let currentMax = 0 for (let num of nums) { currentMax = Math.max(num, currentMax + num) maxSoFar = Math.max(maxSoFar, currentMax) } return maxSoFar } 2. é“¾è¡¨ï¼ˆLinked Listsï¼‰ åŸºç¡€å®ç°ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 class ListNode { constructor(val, next = null) { this.val = val this.next = next } } class LinkedList { constructor() { this.head = null this.size = 0 } // åœ¨å¤´éƒ¨æ·»åŠ èŠ‚ç‚¹ prepend(val) { const newNode = new ListNode(val, this.head) this.head = newNode this.size++ } // åœ¨å°¾éƒ¨æ·»åŠ èŠ‚ç‚¹ append(val) { const newNode = new ListNode(val) if (!this.head) { this.head = newNode } else { let current = this.head while (current.next) { current = current.next } current.next = newNode } this.size++ } // åˆ é™¤æŒ‡å®šå€¼çš„èŠ‚ç‚¹ delete(val) { if (!this.head) return if (this.head.val === val) { this.head = this.head.next this.size-- return } let current = this.head while (current.next \u0026amp;\u0026amp; current.next.val !== val) { current = current.next } if (current.next) { current.next = current.next.next this.size-- } } } // åè½¬é“¾è¡¨ function reverseList(head) { let prev = null let current = head while (current) { const next = current.next current.next = prev prev = current current = next } return prev } // æ£€æµ‹ç¯ function hasCycle(head) { let slow = head let fast = head while (fast \u0026amp;\u0026amp; fast.next) { slow = slow.next fast = fast.next.next if (slow === fast) { return true } } return false } 3. æ ˆå’Œé˜Ÿåˆ—ï¼ˆStacks \u0026amp; Queuesï¼‰ æ ˆçš„å®ç°ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 class Stack { constructor() { this.items = [] } push(item) { this.items.push(item) } pop() { return this.items.pop() } peek() { return this.items[this.items.length - 1] } isEmpty() { return this.items.length === 0 } size() { return this.items.length } } // æœ‰æ•ˆæ‹¬å·æ£€æŸ¥ function isValidParentheses(s) { const stack = [] const pairs = { \u0026#39;(\u0026#39;: \u0026#39;)\u0026#39;, \u0026#39;[\u0026#39;: \u0026#39;]\u0026#39;, \u0026#39;{\u0026#39;: \u0026#39;}\u0026#39; } for (let char of s) { if (pairs[char]) { stack.push(char) } else { const top = stack.pop() if (pairs[top] !== char) { return false } } } return stack.length === 0 } // é˜Ÿåˆ—çš„å®ç° class Queue { constructor() { this.items = [] } enqueue(item) { this.items.push(item) } dequeue() { return this.items.shift() } front() { return this.items[0] } isEmpty() { return this.items.length === 0 } } // ç”¨ä¸¤ä¸ªæ ˆå®ç°é˜Ÿåˆ— class QueueWithStacks { constructor() { this.stack1 = [] this.stack2 = [] } enqueue(x) { this.stack1.push(x) } dequeue() { if (this.stack2.length === 0) { while (this.stack1.length \u0026gt; 0) { this.stack2.push(this.stack1.pop()) } } return this.stack2.pop() } } 4. å“ˆå¸Œè¡¨ï¼ˆHash Tablesï¼‰ åŸºç¡€å®ç°ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 class HashTable { constructor(size = 53) { this.keyMap = new Array(size) } _hash(key) { let total = 0 let WEIRD_PRIME = 31 for (let i = 0; i \u0026lt; Math.min(key.length, 100); i++) { let char = key[i] let value = char.charCodeAt(0) - 96 total = (total * WEIRD_PRIME + value) % this.keyMap.length } return total } set(key, value) { const index = this._hash(key) if (!this.keyMap[index]) { this.keyMap[index] = [] } // æ£€æŸ¥æ˜¯å¦å·²å­˜åœ¨ç›¸åŒçš„key for (let i = 0; i \u0026lt; this.keyMap[index].length; i++) { if (this.keyMap[index][i][0] === key) { this.keyMap[index][i][1] = value return } } this.keyMap[index].push([key, value]) } get(key) { const index = this._hash(key) if (this.keyMap[index]) { for (let i = 0; i \u0026lt; this.keyMap[index].length; i++) { if (this.keyMap[index][i][0] === key) { return this.keyMap[index][i][1] } } } return undefined } } // ä¸¤æ•°ä¹‹å’Œï¼ˆä½¿ç”¨å“ˆå¸Œè¡¨ï¼‰ function twoSum(nums, target) { const map = new Map() for (let i = 0; i \u0026lt; nums.length; i++) { const complement = target - nums[i] if (map.has(complement)) { return [map.get(complement), i] } map.set(nums[i], i) } return [] } ç¬¬ä¸‰é˜¶æ®µï¼šåŸºç¡€ç®—æ³•ï¼ˆ4-5å‘¨ï¼‰ 1. æ’åºç®—æ³• å¿«é€Ÿæ’åºï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 function quickSort(arr) { if (arr.length \u0026lt;= 1) return arr const pivot = arr[Math.floor(arr.length / 2)] const left = [] const right = [] const equal = [] for (let element of arr) { if (element \u0026lt; pivot) { left.push(element) } else if (element \u0026gt; pivot) { right.push(element) } else { equal.push(element) } } return [...quickSort(left), ...equal, ...quickSort(right)] } // å½’å¹¶æ’åº function mergeSort(arr) { if (arr.length \u0026lt;= 1) return arr const middle = Math.floor(arr.length / 2) const left = arr.slice(0, middle) const right = arr.slice(middle) return merge(mergeSort(left), mergeSort(right)) } function merge(left, right) { const result = [] let leftIndex = 0 let rightIndex = 0 while (leftIndex \u0026lt; left.length \u0026amp;\u0026amp; rightIndex \u0026lt; right.length) { if (left[leftIndex] \u0026lt; right[rightIndex]) { result.push(left[leftIndex]) leftIndex++ } else { result.push(right[rightIndex]) rightIndex++ } } return result.concat(left.slice(leftIndex)).concat(right.slice(rightIndex)) } 2. æœç´¢ç®—æ³• äºŒåˆ†æŸ¥æ‰¾ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 function binarySearch(arr, target) { let left = 0 let right = arr.length - 1 while (left \u0026lt;= right) { const mid = Math.floor((left + right) / 2) if (arr[mid] === target) { return mid } else if (arr[mid] \u0026lt; target) { left = mid + 1 } else { right = mid - 1 } } return -1 } // æ·±åº¦ä¼˜å…ˆæœç´¢ï¼ˆDFSï¼‰ function dfs(graph, start, visited = new Set()) { visited.add(start) console.log(start) for (let neighbor of graph[start]) { if (!visited.has(neighbor)) { dfs(graph, neighbor, visited) } } } // å¹¿åº¦ä¼˜å…ˆæœç´¢ï¼ˆBFSï¼‰ function bfs(graph, start) { const visited = new Set() const queue = [start] visited.add(start) while (queue.length \u0026gt; 0) { const vertex = queue.shift() console.log(vertex) for (let neighbor of graph[vertex]) { if (!visited.has(neighbor)) { visited.add(neighbor) queue.push(neighbor) } } } } 3. é€’å½’å’Œå›æº¯ é€’å½’åŸºç¡€ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 // é˜¶ä¹˜ function factorial(n) { if (n === 0 || n === 1) return 1 return n * factorial(n - 1) } // æ–æ³¢é‚£å¥‘æ•°åˆ— function fibonacci(n, memo = {}) { if (n in memo) return memo[n] if (n \u0026lt;= 1) return n memo[n] = fibonacci(n - 1, memo) + fibonacci(n - 2, memo) return memo[n] } // å…¨æ’åˆ— function permutations(nums) { const result = [] function backtrack(current, remaining) { if (current.length === nums.length) { result.push([...current]) return } for (let i = 0; i \u0026lt; remaining.length; i++) { current.push(remaining[i]) backtrack(current, remaining.slice(0, i).concat(remaining.slice(i + 1))) current.pop() } } backtrack([], nums) return result } // Nçš‡åé—®é¢˜ function solveNQueens(n) { const result = [] const board = Array(n).fill().map(() =\u0026gt; Array(n).fill(\u0026#39;.\u0026#39;)) function isValid(row, col) { // æ£€æŸ¥åˆ— for (let i = 0; i \u0026lt; row; i++) { if (board[i][col] === \u0026#39;Q\u0026#39;) return false } // æ£€æŸ¥å¯¹è§’çº¿ for (let i = 0; i \u0026lt; row; i++) { const diff = Math.abs(row - i) if (col - diff \u0026gt;= 0 \u0026amp;\u0026amp; board[i][col - diff] === \u0026#39;Q\u0026#39;) return false if (col + diff \u0026lt; n \u0026amp;\u0026amp; board[i][col + diff] === \u0026#39;Q\u0026#39;) return false } return true } function backtrack(row) { if (row === n) { result.push(board.map(row =\u0026gt; row.join(\u0026#39;\u0026#39;))) return } for (let col = 0; col \u0026lt; n; col++) { if (isValid(row, col)) { board[row][col] = \u0026#39;Q\u0026#39; backtrack(row + 1) board[row][col] = \u0026#39;.\u0026#39; } } } backtrack(0) return result } ç¬¬å››é˜¶æ®µï¼šé«˜çº§æ•°æ®ç»“æ„ï¼ˆ3-4å‘¨ï¼‰ 1. äºŒå‰æœç´¢æ ‘ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 class TreeNode { constructor(val, left = null, right = null) { this.val = val this.left = left this.right = right } } class BinarySearchTree { constructor() { this.root = null } insert(val) { const newNode = new TreeNode(val) if (!this.root) { this.root = newNode return } let current = this.root while (true) { if (val \u0026lt; current.val) { if (!current.left) { current.left = newNode return } current = current.left } else { if (!current.right) { current.right = newNode return } current = current.right } } } search(val) { let current = this.root while (current) { if (val === current.val) return current if (val \u0026lt; current.val) { current = current.left } else { current = current.right } } return null } delete(val) { this.root = this.deleteNode(this.root, val) } deleteNode(node, val) { if (!node) return null if (val \u0026lt; node.val) { node.left = this.deleteNode(node.left, val) } else if (val \u0026gt; node.val) { node.right = this.deleteNode(node.right, val) } else { // åˆ é™¤èŠ‚ç‚¹ if (!node.left) return node.right if (!node.right) return node.left // æ‰¾åˆ°å³å­æ ‘çš„æœ€å°å€¼ let minRight = node.right while (minRight.left) { minRight = minRight.left } node.val = minRight.val node.right = this.deleteNode(node.right, minRight.val) } return node } } // ä¸­åºéå† function inorderTraversal(root) { const result = [] function traverse(node) { if (!node) return traverse(node.left) result.push(node.val) traverse(node.right) } traverse(root) return result } 2. å †ï¼ˆHeapï¼‰ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 class MaxHeap { constructor() { this.heap = [] } insert(val) { this.heap.push(val) this.bubbleUp() } bubbleUp() { let index = this.heap.length - 1 while (index \u0026gt; 0) { const parentIndex = Math.floor((index - 1) / 2) if (this.heap[parentIndex] \u0026lt; this.heap[index]) { [this.heap[parentIndex], this.heap[index]] = [this.heap[index], this.heap[parentIndex]] index = parentIndex } else { break } } } extractMax() { const max = this.heap[0] const end = this.heap.pop() if (this.heap.length \u0026gt; 0) { this.heap[0] = end this.sinkDown() } return max } sinkDown() { let index = 0 const length = this.heap.length while (true) { const leftChildIndex = 2 * index + 1 const rightChildIndex = 2 * index + 2 let swapIndex = null if (leftChildIndex \u0026lt; length) { if (this.heap[leftChildIndex] \u0026gt; this.heap[index]) { swapIndex = leftChildIndex } } if (rightChildIndex \u0026lt; length) { if ( (swapIndex === null \u0026amp;\u0026amp; this.heap[rightChildIndex] \u0026gt; this.heap[index]) || (swapIndex !== null \u0026amp;\u0026amp; this.heap[rightChildIndex] \u0026gt; this.heap[leftChildIndex]) ) { swapIndex = rightChildIndex } } if (swapIndex === null) break [this.heap[index], this.heap[swapIndex]] = [this.heap[swapIndex], this.heap[index]] index = swapIndex } } } // å¯»æ‰¾æ•°ç»„ä¸­ç¬¬Kå¤§çš„å…ƒç´  function findKthLargest(nums, k) { const heap = new MaxHeap() for (let num of nums) { heap.insert(num) } for (let i = 0; i \u0026lt; k - 1; i++) { heap.extractMax() } return heap.extractMax() } ç¬¬äº”é˜¶æ®µï¼šé«˜çº§ç®—æ³•ï¼ˆ5-6å‘¨ï¼‰ 1. åŠ¨æ€è§„åˆ’ åŸºç¡€æ¦‚å¿µï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 // æ–æ³¢é‚£å¥‘æ•°åˆ—ï¼ˆDPå®ç°ï¼‰ function fibonacciDP(n) { if (n \u0026lt;= 1) return n const dp = [0, 1] for (let i = 2; i \u0026lt;= n; i++) { dp[i] = dp[i - 1] + dp[i - 2] } return dp[n] } // ç©ºé—´ä¼˜åŒ–ç‰ˆæœ¬ function fibonacciOptimized(n) { if (n \u0026lt;= 1) return n let prev = 0 let curr = 1 for (let i = 2; i \u0026lt;= n; i++) { const next = prev + curr prev = curr curr = next } return curr } // çˆ¬æ¥¼æ¢¯é—®é¢˜ function climbStairs(n) { if (n \u0026lt;= 2) return n const dp = new Array(n + 1) dp[1] = 1 dp[2] = 2 for (let i = 3; i \u0026lt;= n; i++) { dp[i] = dp[i - 1] + dp[i - 2] } return dp[n] } // èƒŒåŒ…é—®é¢˜ï¼ˆ0-1èƒŒåŒ…ï¼‰ function knapsack(weights, values, capacity) { const n = weights.length const dp = Array(n + 1).fill().map(() =\u0026gt; Array(capacity + 1).fill(0)) for (let i = 1; i \u0026lt;= n; i++) { for (let j = 1; j \u0026lt;= capacity; j++) { if (weights[i - 1] \u0026gt; j) { dp[i][j] = dp[i - 1][j] } else { dp[i][j] = Math.max( dp[i - 1][j], dp[i - 1][j - weights[i - 1]] + values[i - 1] ) } } } return dp[n][capacity] } // æœ€é•¿é€’å¢å­åºåˆ— function lengthOfLIS(nums) { if (nums.length === 0) return 0 const dp = new Array(nums.length).fill(1) for (let i = 1; i \u0026lt; nums.length; i++) { for (let j = 0; j \u0026lt; i; j++) { if (nums[i] \u0026gt; nums[j]) { dp[i] = Math.max(dp[i], dp[j] + 1) } } } return Math.max(...dp) } 2. å›¾ç®—æ³• æœ€çŸ­è·¯å¾„ç®—æ³•ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 // Dijkstraç®—æ³• function dijkstra(graph, start) { const distances = {} const visited = new Set() const pq = new PriorityQueue() // åˆå§‹åŒ–è·ç¦» for (let vertex in graph) { distances[vertex] = vertex === start ? 0 : Infinity pq.enqueue(vertex, distances[vertex]) } while (!pq.isEmpty()) { const { element: vertex } = pq.dequeue() if (visited.has(vertex)) continue visited.add(vertex) for (let neighbor in graph[vertex]) { const distance = graph[vertex][neighbor] const newDistance = distances[vertex] + distance if (newDistance \u0026lt; distances[neighbor]) { distances[neighbor] = newDistance pq.enqueue(neighbor, newDistance) } } } return distances } // Floyd-Warshallç®—æ³• function floydWarshall(graph) { const n = graph.length const dist = graph.map(row =\u0026gt; [...row]) for (let k = 0; k \u0026lt; n; k++) { for (let i = 0; i \u0026lt; n; i++) { for (let j = 0; j \u0026lt; n; j++) { if (dist[i][k] + dist[k][j] \u0026lt; dist[i][j]) { dist[i][j] = dist[i][k] + dist[k][j] } } } } return dist } // æœ€å°ç”Ÿæˆæ ‘ï¼ˆPrimç®—æ³•ï¼‰ function primMST(graph) { const n = graph.length const visited = new Set() const minEdge = new Array(n).fill(Infinity) const parent = new Array(n).fill(-1) minEdge[0] = 0 for (let count = 0; count \u0026lt; n - 1; count++) { // æ‰¾åˆ°æœªè®¿é—®çš„é¡¶ç‚¹ä¸­æœ€å°è¾¹ let u = -1 let min = Infinity for (let v = 0; v \u0026lt; n; v++) { if (!visited.has(v) \u0026amp;\u0026amp; minEdge[v] \u0026lt; min) { min = minEdge[v] u = v } } visited.add(u) // æ›´æ–°é‚»æ¥é¡¶ç‚¹çš„æœ€å°è¾¹ for (let v = 0; v \u0026lt; n; v++) { if (graph[u][v] \u0026amp;\u0026amp; !visited.has(v) \u0026amp;\u0026amp; graph[u][v] \u0026lt; minEdge[v]) { minEdge[v] = graph[u][v] parent[v] = u } } } return parent } ç¬¬å…­é˜¶æ®µï¼šä¸“é¡¹è®­ç»ƒï¼ˆ4-6å‘¨ï¼‰ 1. LeetCodeè®­ç»ƒè®¡åˆ’ æŒ‰éš¾åº¦åˆ†ç±»ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 // Easyé¢˜ç›®ï¼ˆå»ºç«‹ä¿¡å¿ƒï¼‰ const easyProblems = [ \u0026#39;Two Sum\u0026#39;, // æ•°ç»„ï¼Œå“ˆå¸Œè¡¨ \u0026#39;Reverse Integer\u0026#39;, // æ•°å­¦ \u0026#39;Palindrome Number\u0026#39;, // å­—ç¬¦ä¸² \u0026#39;Valid Parentheses\u0026#39;, // æ ˆ \u0026#39;Merge Two Sorted Lists\u0026#39;, // é“¾è¡¨ \u0026#39;Maximum Subarray\u0026#39;, // æ•°ç»„ï¼ŒåŠ¨æ€è§„åˆ’ \u0026#39;Climbing Stairs\u0026#39;, // åŠ¨æ€è§„åˆ’ \u0026#39;Best Time to Buy and Sell Stock\u0026#39; // æ•°ç»„ ] // Mediumé¢˜ç›®ï¼ˆæ ¸å¿ƒç»ƒä¹ ï¼‰ const mediumProblems = [ \u0026#39;Add Two Numbers\u0026#39;, // é“¾è¡¨ \u0026#39;Longest Substring Without Repeating Characters\u0026#39;, // æ»‘åŠ¨çª—å£ \u0026#39;Valid Parentheses\u0026#39;, // æ ˆ \u0026#39;Merge K Sorted Lists\u0026#39;, // å † \u0026#39;Valid Sudoku\u0026#39;, // çŸ©é˜µ \u0026#39;Implement Trie (Prefix Tree)\u0026#39;, // å­—å…¸æ ‘ \u0026#39;Coin Change\u0026#39;, // åŠ¨æ€è§„åˆ’ \u0026#39;House Robber II\u0026#39;, // åŠ¨æ€è§„åˆ’ \u0026#39;Unique Paths\u0026#39;, // åŠ¨æ€è§„åˆ’ \u0026#39;Jump Game\u0026#39; // è´ªå¿ƒç®—æ³• ] // Hardé¢˜ç›®ï¼ˆæŒ‘æˆ˜æé™ï¼‰ const hardProblems = [ \u0026#39;Median of Two Sorted Arrays\u0026#39;, // äºŒåˆ†æŸ¥æ‰¾ \u0026#39;Regular Expression Matching\u0026#39;, // åŠ¨æ€è§„åˆ’ \u0026#39;Merge K Sorted Lists\u0026#39;, // å † \u0026#39;Reverse Nodes in k-Group\u0026#39;, // é“¾è¡¨ \u0026#39;Subsets\u0026#39;, // å›æº¯ \u0026#39;Word Break\u0026#39;, // åŠ¨æ€è§„åˆ’ \u0026#39;Binary Tree Maximum Path Sum\u0026#39;, // æ ‘ï¼Œé€’å½’ \u0026#39;Longest Valid Parentheses\u0026#39;, // æ ˆï¼ŒåŠ¨æ€è§„åˆ’ \u0026#39;Best Time to Buy and Sell Stock III\u0026#39;, // åŠ¨æ€è§„åˆ’ \u0026#39;Copy List with Random Pointer\u0026#39; // é“¾è¡¨ ] 2. ç®—æ³•æ¨¡å¼æ€»ç»“ åŒæŒ‡é’ˆæŠ€å·§ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 // ä¸¤æ•°ä¹‹å’Œï¼ˆæœ‰åºæ•°ç»„ï¼‰ function twoSumSorted(nums, target) { let left = 0 let right = nums.length - 1 while (left \u0026lt; right) { const sum = nums[left] + nums[right] if (sum === target) { return [left + 1, right + 1] } else if (sum \u0026lt; target) { left++ } else { right-- } } return [] } // ç§»é™¤é›¶ function moveZeroes(nums) { let lastNonZeroFoundAt = 0 for (let i = 0; i \u0026lt; nums.length; i++) { if (nums[i] !== 0) { [nums[lastNonZeroFoundAt], nums[i]] = [nums[i], nums[lastNonZeroFoundAt]] lastNonZeroFoundAt++ } } } // æ»‘åŠ¨çª—å£ function minWindow(s, t) { const need = new Map() const window = new Map() for (let char of t) { need.set(char, (need.get(char) || 0) + 1) } let left = 0 let right = 0 let valid = 0 let start = 0 let len = Infinity while (right \u0026lt; s.length) { const c = s[right] right++ if (need.has(c)) { window.set(c, (window.get(c) || 0) + 1) if (window.get(c) === need.get(c)) { valid++ } } while (valid === need.size) { if (right - left \u0026lt; len) { start = left len = right - left } const d = s[left] left++ if (need.has(d)) { if (window.get(d) === need.get(d)) { valid-- } window.set(d, window.get(d) - 1) } } } return len === Infinity ? \u0026#34;\u0026#34; : s.slice(start, start + len) } å­¦ä¹ å»ºè®®å’Œèµ„æº 1. å­¦ä¹ è®¡åˆ’æ¨¡æ¿ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 // æ¯å‘¨å­¦ä¹ è®¡åˆ’ç¤ºä¾‹ const weeklyPlan = { monday: { topic: \u0026#39;æ–°çš„æ•°æ®ç»“æ„\u0026#39;, tasks: [ \u0026#39;é˜…è¯»ç†è®º1å°æ—¶\u0026#39;, \u0026#39;å®ç°ä»£ç 2å°æ—¶\u0026#39;, \u0026#39;ç»ƒä¹ é¢˜3é“\u0026#39; ] }, tuesday: { topic: \u0026#39;å¤ä¹ æ˜¨å¤©çš„å†…å®¹\u0026#39;, tasks: [ \u0026#39;é‡å†™å®ç°1å°æ—¶\u0026#39;, \u0026#39;åš5é“ç›¸å…³é¢˜ç›®\u0026#39; ] }, wednesday: { topic: \u0026#39;æ–°çš„ç®—æ³•\u0026#39;, tasks: [ \u0026#39;ç†è§£ç®—æ³•æ€æƒ³1å°æ—¶\u0026#39;, \u0026#39;æ‰‹åŠ¨æ¨æ¼”è¿‡ç¨‹1å°æ—¶\u0026#39;, \u0026#39;ä»£ç å®ç°2å°æ—¶\u0026#39; ] }, thursday: { topic: \u0026#39;ç®—æ³•ç»ƒä¹ \u0026#39;, tasks: [ \u0026#39;ç®€å•é¢˜ç›®5é“\u0026#39;, \u0026#39;ä¸­ç­‰é¢˜ç›®3é“\u0026#39; ] }, friday: { topic: \u0026#39;ç»¼åˆç»ƒä¹ \u0026#39;, tasks: [ \u0026#39;å®Œæˆ1é“å›°éš¾é¢˜ç›®\u0026#39;, \u0026#39;æ€»ç»“æœ¬å‘¨å†…å®¹\u0026#39; ] }, weekend: { topic: \u0026#39;å¤ä¹ å’Œæ‹“å±•\u0026#39;, tasks: [ \u0026#39;é‡åšæœ¬å‘¨é”™é¢˜\u0026#39;, \u0026#39;é˜…è¯»ç›¸å…³åšå®¢\u0026#39;, \u0026#39;å‚åŠ ç®—æ³•ç«èµ›\u0026#39; ] } } 2. æ¨èèµ„æº 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 const resources = { books: [ { title: \u0026#39;ç®—æ³•å¯¼è®º\u0026#39;, difficulty: \u0026#39;é«˜çº§\u0026#39;, description: \u0026#39;ç®—æ³•é¢†åŸŸçš„ç»å…¸æ•™æ\u0026#39; }, { title: \u0026#39;JavaScriptç®—æ³•ä¸æ•°æ®ç»“æ„\u0026#39;, difficulty: \u0026#39;ä¸­çº§\u0026#39;, description: \u0026#39;ä½¿ç”¨JavaScriptå®ç°çš„ç®—æ³•æ•™ç¨‹\u0026#39; }, { title: \u0026#39;ç¼–ç¨‹ç ç‘\u0026#39;, difficulty: \u0026#39;ä¸­çº§\u0026#39;, description: \u0026#39;é€šè¿‡å®é™…é—®é¢˜å­¦ä¹ ç®—æ³•\u0026#39; } ], websites: [ { name: \u0026#39;LeetCode\u0026#39;, url: \u0026#39;https://leetcode.com/\u0026#39;, description: \u0026#39;ç®—æ³•ç»ƒä¹ å¹³å°\u0026#39; }, { name: \u0026#39;VisuAlgo\u0026#39;, url: \u0026#39;https://visualgo.net/en\u0026#39;, description: \u0026#39;ç®—æ³•å¯è§†åŒ–å·¥å…·\u0026#39; }, { name: \u0026#39;GeeksforGeeks\u0026#39;, url: \u0026#39;https://www.geeksforgeeks.org/\u0026#39;, description: \u0026#39;ç®—æ³•æ•™ç¨‹å’Œç»ƒä¹ \u0026#39; } ], channels: [ { name: \u0026#39;MIT OpenCourseWare\u0026#39;, url: \u0026#39;https://ocw.mit.edu/courses/electrical-engineering-and-computer-science/\u0026#39;, description: \u0026#39;MITå…è´¹ç®—æ³•è¯¾ç¨‹\u0026#39; }, { name: \u0026#39;Abdul Bari\u0026#39;, url: \u0026#39;https://www.youtube.com/channel/UCZCFT11CWBi3MHNlGf019nw\u0026#39;, description: \u0026#39;ç®—æ³•æ•™å­¦è§†é¢‘\u0026#39; } ] } é¢è¯•å‡†å¤‡å»ºè®® 1. å¸¸è§é¢è¯•é¢˜å‹ 1 2 3 4 5 6 7 8 9 10 11 12 13 // å¿…ä¼šç®—æ³•åˆ—è¡¨ const mustKnowAlgorithms = [ \u0026#39;æ’åºç®—æ³•\u0026#39;, // å¿«é€Ÿæ’åºï¼Œå½’å¹¶æ’åºï¼Œå †æ’åº \u0026#39;æœç´¢ç®—æ³•\u0026#39;, // äºŒåˆ†æŸ¥æ‰¾ï¼ŒDFSï¼ŒBFS \u0026#39;åŠ¨æ€è§„åˆ’\u0026#39;, // èƒŒåŒ…é—®é¢˜ï¼Œæœ€é•¿å­åºåˆ—ï¼Œç¼–è¾‘è·ç¦» \u0026#39;å›¾ç®—æ³•\u0026#39;, // æœ€çŸ­è·¯å¾„ï¼Œæœ€å°ç”Ÿæˆæ ‘ï¼Œæ‹“æ‰‘æ’åº \u0026#39;æ ‘ç®—æ³•\u0026#39;, // äºŒå‰æœç´¢æ ‘ï¼Œéå†ï¼Œæœ€è¿‘å…¬å…±ç¥–å…ˆ \u0026#39;å­—ç¬¦ä¸²\u0026#39;, // KMPï¼Œæ­£åˆ™è¡¨è¾¾å¼ï¼Œç¼–ç è§£ç  \u0026#39;æ•°ç»„æ“ä½œ\u0026#39;, // åŒæŒ‡é’ˆï¼Œæ»‘åŠ¨çª—å£ï¼ŒçŸ©é˜µæ“ä½œ \u0026#39;é“¾è¡¨æ“ä½œ\u0026#39;, // åè½¬ï¼Œåˆå¹¶ï¼Œç¯æ£€æµ‹ \u0026#39;ä½è¿ç®—\u0026#39;, // å¸¸è§ä½æ“ä½œæŠ€å·§ \u0026#39;æ•°å­¦é—®é¢˜\u0026#39; // è´¨æ•°ï¼Œæœ€å¤§å…¬çº¦æ•°ï¼Œç»„åˆæ•°å­¦ ] 2. é¢è¯•æŠ€å·§ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 // é—®é¢˜è§£å†³æ¡†æ¶ const problemSolvingFramework = { step1: \u0026#39;ç†è§£é—®é¢˜ï¼Œæ¾„æ¸…éœ€æ±‚\u0026#39;, step2: \u0026#39;åˆ†æçº¦æŸå’Œè¾¹ç•Œæ¡ä»¶\u0026#39;, step3: \u0026#39;è€ƒè™‘å¤šç§è§£å†³æ–¹æ¡ˆ\u0026#39;, step4: \u0026#39;é€‰æ‹©æœ€ä¼˜æ–¹æ¡ˆå¹¶è¯´æ˜ç†ç”±\u0026#39;, step5: \u0026#39;å®ç°ä»£ç ï¼Œæ³¨æ„è¾¹ç•Œæƒ…å†µ\u0026#39;, step6: \u0026#39;æµ‹è¯•ç”¨ä¾‹éªŒè¯\u0026#39;, step7: \u0026#39;åˆ†ææ—¶é—´å’Œç©ºé—´å¤æ‚åº¦\u0026#39;, step8: \u0026#39;è®¨è®ºå¯èƒ½çš„ä¼˜åŒ–æ–¹æ¡ˆ\u0026#39; } // ä»£ç æ¨¡æ¿ const codingTemplate = ` function solution(input) { // 1. ç†è§£é—®é¢˜å’Œçº¦æŸ const constraints = { // è¾“å…¥èŒƒå›´ // æ—¶é—´å¤æ‚åº¦è¦æ±‚ // ç©ºé—´å¤æ‚åº¦è¦æ±‚ } // 2. è¾¹ç•Œæƒ…å†µå¤„ç† if (/* è¾¹ç•Œæ¡ä»¶ */) { return /* è¾¹ç•Œæƒ…å†µç»“æœ */ } // 3. æ ¸å¿ƒç®—æ³•å®ç° let result = /* åˆå§‹åŒ–ç»“æœ */ // ç®—æ³•é€»è¾‘ // ... // 4. è¿”å›ç»“æœ return result } // æµ‹è¯•ç”¨ä¾‹ function testSolution() { const testCases = [ // æ­£å¸¸æƒ…å†µ { input: /* æµ‹è¯•è¾“å…¥ */, expected: /* æœŸæœ›è¾“å‡º */ }, // è¾¹ç•Œæƒ…å†µ { input: /* è¾¹ç•Œè¾“å…¥ */, expected: /* è¾¹ç•Œè¾“å‡º */ }, // å¼‚å¸¸æƒ…å†µ { input: /* å¼‚å¸¸è¾“å…¥ */, expected: /* å¼‚å¸¸è¾“å‡º */ } ] testCases.forEach(({ input, expected }) =\u0026gt; { const result = solution(input) console.log(\u0026#39;Input:\u0026#39;, input) console.log(\u0026#39;Expected:\u0026#39;, expected) console.log(\u0026#39;Actual:\u0026#39;, result) console.log(\u0026#39;Pass:\u0026#39;, result === expected) console.log(\u0026#39;---\u0026#39;) }) } ` æ€»ç»“ ç®—æ³•ä¸æ•°æ®ç»“æ„çš„å­¦ä¹ æ˜¯ä¸€ä¸ªå¾ªåºæ¸è¿›çš„è¿‡ç¨‹ï¼Œéœ€è¦ï¼š\næ‰å®çš„åŸºç¡€ï¼šç†è§£åŸºæœ¬æ¦‚å¿µå’Œæ—¶é—´å¤æ‚åº¦åˆ†æ å¤§é‡ç»ƒä¹ ï¼šé€šè¿‡åˆ·é¢˜å·©å›ºçŸ¥è¯†ï¼ŒåŸ¹å…»ç®—æ³•æ€ç»´ æ€»ç»“å½’çº³ï¼šæ•´ç†å¸¸è§çš„è§£é¢˜æ¨¡å¼å’ŒæŠ€å·§ æŒç»­å­¦ä¹ ï¼šè·Ÿè¿›æ–°çš„ç®—æ³•å’ŒæŠ€æœ¯å‘å±• å®é™…åº”ç”¨ï¼šåœ¨é¡¹ç›®ä¸­è¿ç”¨æ‰€å­¦çŸ¥è¯† è®°ä½ï¼Œç®—æ³•èƒ½åŠ›çš„æå‡éœ€è¦æ—¶é—´å’Œè€å¿ƒã€‚åˆ¶å®šåˆç†çš„å­¦ä¹ è®¡åˆ’ï¼ŒåšæŒç»ƒä¹ ï¼Œé€æ­¥æå‡ã€‚ä¸è¦æ€¥äºæ±‚æˆï¼Œé‡è¦çš„æ˜¯ç†è§£ç®—æ³•èƒŒåçš„æ€æƒ³ï¼Œè€Œä¸æ˜¯æ­»è®°ç¡¬èƒŒä»£ç ã€‚\né€šè¿‡ç³»ç»Ÿçš„å­¦ä¹ å’ŒæŒç»­çš„ç»ƒä¹ ï¼Œä½ ä¸€å®šèƒ½å¤ŸæŒæ¡ç®—æ³•ä¸æ•°æ®ç»“æ„ï¼Œæˆä¸ºä¼˜ç§€çš„ç¨‹åºå‘˜ã€‚\n","permalink":"/blog/articles/algorithm-data-structures-learning-path/","summary":"æä¾›ä¸€ä¸ªå®Œæ•´çš„ç®—æ³•ä¸æ•°æ®ç»“æ„å­¦ä¹ è·¯å¾„ï¼Œä»åŸºç¡€æ¦‚å¿µå¼€å§‹ï¼Œé€æ­¥æ·±å…¥åˆ°é«˜çº§ç®—æ³•ï¼ŒåŒ…å«è¯¦ç»†çš„å®è·µé¡¹ç›®å’Œé¢è¯•å‡†å¤‡å»ºè®®","title":"ç®—æ³•ä¸æ•°æ®ç»“æ„å­¦ä¹ è·¯å¾„ï¼šä»é›¶åŸºç¡€åˆ°ç®—æ³•å¤§å¸ˆçš„å®Œæ•´æŒ‡å—"},{"content":"å‰ç«¯å·¥ç¨‹åŒ–å®è·µæŒ‡å—ï¼šä»é›¶æ­å»ºç°ä»£åŒ–çš„å‰ç«¯é¡¹ç›® éšç€å‰ç«¯åº”ç”¨è§„æ¨¡çš„ä¸æ–­æ‰©å¤§ï¼Œå·¥ç¨‹åŒ–å·²æˆä¸ºç°ä»£å‰ç«¯å¼€å‘çš„å¿…å¤‡æŠ€èƒ½ã€‚æœ¬æ–‡å°†æ·±å…¥æ¢è®¨å‰ç«¯å·¥ç¨‹åŒ–çš„æ ¸å¿ƒç†å¿µå’Œå®è·µæ–¹æ³•ï¼Œå¸®åŠ©å›¢é˜Ÿå»ºç«‹è§„èŒƒã€é«˜æ•ˆçš„å‰ç«¯å¼€å‘æµç¨‹ã€‚\nå‰ç«¯å·¥ç¨‹åŒ–æ¦‚è¿° 1. ä»€ä¹ˆæ˜¯å‰ç«¯å·¥ç¨‹åŒ– å‰ç«¯å·¥ç¨‹åŒ–æ˜¯æŒ‡è¿ç”¨å·¥ç¨‹åŒ–æ–¹æ³•å’Œå·¥å…·æ¥è§„èŒƒå‰ç«¯å¼€å‘æµç¨‹ã€æé«˜ä»£ç è´¨é‡ã€ä¼˜åŒ–å¼€å‘æ•ˆç‡çš„ä¸€ç³»åˆ—æ´»åŠ¨ã€‚å®ƒåŒ…æ‹¬ï¼š\næ ¸å¿ƒç†å¿µï¼š\nè§„èŒƒåŒ–ï¼šåˆ¶å®šç»Ÿä¸€çš„ç¼–ç è§„èŒƒå’Œé¡¹ç›®ç»“æ„ è‡ªåŠ¨åŒ–ï¼šè‡ªåŠ¨åŒ–æ„å»ºã€æµ‹è¯•ã€éƒ¨ç½²ç­‰é‡å¤æ€§å·¥ä½œ æ¨¡å—åŒ–ï¼šå°†åº”ç”¨æ‹†åˆ†ä¸ºå¯å¤ç”¨çš„æ¨¡å— ç»„ä»¶åŒ–ï¼šæ„å»ºå¯å¤ç”¨çš„UIç»„ä»¶åº“ å·¥ç¨‹åŒ–å·¥å…·é“¾ï¼šæ„å»ºå·¥å…·ã€è„šæ‰‹æ¶ã€è‡ªåŠ¨åŒ–å·¥å…· 2. å·¥ç¨‹åŒ–çš„ä»·å€¼ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 // ä¼ ç»Ÿå¼€å‘æ–¹å¼çš„é—®é¢˜ // 1. ä»£ç ç»„ç»‡æ··ä¹± â”œâ”€â”€ index.html â”œâ”€â”€ style.css â”œâ”€â”€ script.js â””â”€â”€ lib.js // 2. ç¼ºä¹æ¨¡å—åŒ–ï¼Œå…¨å±€å˜é‡æ±¡æŸ“ var userData = {}; var utils = {}; // 3. æ‰‹åŠ¨ç®¡ç†ä¾èµ– \u0026lt;script src=\u0026#34;jquery.js\u0026#34;\u0026gt;\u0026lt;/script\u0026gt; \u0026lt;script src=\u0026#34;bootstrap.js\u0026#34;\u0026gt;\u0026lt;/script\u0026gt; \u0026lt;script src=\u0026#34;app.js\u0026#34;\u0026gt;\u0026lt;/script\u0026gt; // å·¥ç¨‹åŒ–åçš„é¡¹ç›®ç»“æ„ â”œâ”€â”€ src/ â”‚ â”œâ”€â”€ components/ # å¯å¤ç”¨ç»„ä»¶ â”‚ â”œâ”€â”€ views/ # é¡µé¢ç»„ä»¶ â”‚ â”œâ”€â”€ utils/ # å·¥å…·å‡½æ•° â”‚ â”œâ”€â”€ api/ # APIæ¥å£ â”‚ â”œâ”€â”€ assets/ # é™æ€èµ„æº â”‚ â””â”€â”€ styles/ # æ ·å¼æ–‡ä»¶ â”œâ”€â”€ public/ # å…¬å…±èµ„æº â”œâ”€â”€ tests/ # æµ‹è¯•æ–‡ä»¶ â”œâ”€â”€ docs/ # æ–‡æ¡£ â”œâ”€â”€ build/ # æ„å»ºé…ç½® â””â”€â”€ dist/ # æ„å»ºè¾“å‡º é¡¹ç›®è„šæ‰‹æ¶æ­å»º 1. æŠ€æœ¯æ ˆé€‰æ‹© 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 // æŠ€æœ¯æ ˆå†³ç­–çŸ©é˜µ const techStack = { framework: { options: [\u0026#39;React\u0026#39;, \u0026#39;Vue\u0026#39;, \u0026#39;Angular\u0026#39;, \u0026#39;Svelte\u0026#39;], factors: [\u0026#39;å›¢é˜Ÿç†Ÿæ‚‰åº¦\u0026#39;, \u0026#39;é¡¹ç›®å¤æ‚åº¦\u0026#39;, \u0026#39;ç”Ÿæ€æ”¯æŒ\u0026#39;, \u0026#39;å­¦ä¹ æˆæœ¬\u0026#39;] }, language: { options: [\u0026#39;JavaScript\u0026#39;, \u0026#39;TypeScript\u0026#39;], recommendation: \u0026#39;TypeScriptï¼ˆç±»å‹å®‰å…¨ã€å¤§å‹é¡¹ç›®å‹å¥½ï¼‰\u0026#39; }, buildTool: { options: [\u0026#39;Webpack\u0026#39;, \u0026#39;Vite\u0026#39;, \u0026#39;Rollup\u0026#39;, \u0026#39;Parcel\u0026#39;], recommendation: \u0026#39;Viteï¼ˆå¼€å‘ä½“éªŒå¥½ã€æ„å»ºé€Ÿåº¦å¿«ï¼‰\u0026#39; }, cssSolution: { options: [\u0026#39;CSS Modules\u0026#39;, \u0026#39;CSS-in-JS\u0026#39;, \u0026#39;Tailwind CSS\u0026#39;, \u0026#39;Sass/Less\u0026#39;], recommendation: \u0026#39;æ ¹æ®é¡¹ç›®éœ€æ±‚é€‰æ‹©\u0026#39; } } // æŠ€æœ¯é€‰å‹ç¤ºä¾‹ const projectTechStack = { framework: \u0026#39;Vue 3\u0026#39;, language: \u0026#39;TypeScript\u0026#39;, buildTool: \u0026#39;Vite\u0026#39;, cssSolution: \u0026#39;Tailwind CSS + CSS Modules\u0026#39;, stateManagement: \u0026#39;Pinia\u0026#39;, routing: \u0026#39;Vue Router\u0026#39;, http: \u0026#39;Axios\u0026#39;, testing: \u0026#39;Vitest + Vue Test Utils\u0026#39; } 2. é¡¹ç›®åˆå§‹åŒ– 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 # ä½¿ç”¨å®˜æ–¹è„šæ‰‹æ¶ npm create vue@latest my-vue-app # æˆ–ä½¿ç”¨Viteåˆ›å»ºé¡¹ç›® npm create vite@latest my-vue-app -- --template vue-ts # é¡¹ç›®é…ç½®é€‰æ‹© âœ” Project name: my-vue-app âœ” Add TypeScript? Yes âœ” Add JSX Support? No âœ” Add Vue Router for Single Page Application development? Yes âœ” Add Pinia for state management? Yes âœ” Add Vitest for Unit testing? Yes âœ” Add an End-to-End Testing Solution? No âœ” Add ESLint for code quality? Yes âœ” Add Prettier for code formatting? Yes 3. é¡¹ç›®ç»“æ„è§„èŒƒ my-vue-app/ â”œâ”€â”€ .env # ç¯å¢ƒå˜é‡ â”œâ”€â”€ .env.development # å¼€å‘ç¯å¢ƒå˜é‡ â”œâ”€â”€ .env.production # ç”Ÿäº§ç¯å¢ƒå˜é‡ â”œâ”€â”€ .github/ # GitHub Actionsé…ç½® â”œâ”€â”€ .vscode/ # VS Codeé…ç½® â”œâ”€â”€ public/ # å…¬å…±èµ„æº â”‚ â”œâ”€â”€ favicon.ico â”‚ â””â”€â”€ index.html â”œâ”€â”€ src/ â”‚ â”œâ”€â”€ api/ # APIæ¥å£ â”‚ â”‚ â”œâ”€â”€ index.ts â”‚ â”‚ â”œâ”€â”€ user.ts â”‚ â”‚ â””â”€â”€ types.ts â”‚ â”œâ”€â”€ assets/ # é™æ€èµ„æº â”‚ â”‚ â”œâ”€â”€ images/ â”‚ â”‚ â”œâ”€â”€ icons/ â”‚ â”‚ â””â”€â”€ fonts/ â”‚ â”œâ”€â”€ components/ # å…¬å…±ç»„ä»¶ â”‚ â”‚ â”œâ”€â”€ common/ # é€šç”¨ç»„ä»¶ â”‚ â”‚ â”œâ”€â”€ business/ # ä¸šåŠ¡ç»„ä»¶ â”‚ â”‚ â””â”€â”€ index.ts â”‚ â”œâ”€â”€ composables/ # ç»„åˆå¼å‡½æ•° â”‚ â”œâ”€â”€ constants/ # å¸¸é‡å®šä¹‰ â”‚ â”œâ”€â”€ hooks/ # è‡ªå®šä¹‰Hook â”‚ â”œâ”€â”€ layouts/ # å¸ƒå±€ç»„ä»¶ â”‚ â”œâ”€â”€ router/ # è·¯ç”±é…ç½® â”‚ â”œâ”€â”€ stores/ # çŠ¶æ€ç®¡ç† â”‚ â”œâ”€â”€ styles/ # æ ·å¼æ–‡ä»¶ â”‚ â”œâ”€â”€ types/ # ç±»å‹å®šä¹‰ â”‚ â”œâ”€â”€ utils/ # å·¥å…·å‡½æ•° â”‚ â”œâ”€â”€ views/ # é¡µé¢ç»„ä»¶ â”‚ â”œâ”€â”€ App.vue â”‚ â””â”€â”€ main.ts â”œâ”€â”€ tests/ # æµ‹è¯•æ–‡ä»¶ â”‚ â”œâ”€â”€ unit/ â”‚ â””â”€â”€ e2e/ â”œâ”€â”€ docs/ # é¡¹ç›®æ–‡æ¡£ â”œâ”€â”€ scripts/ # æ„å»ºè„šæœ¬ â”œâ”€â”€ package.json â”œâ”€â”€ tsconfig.json â”œâ”€â”€ vite.config.ts â”œâ”€â”€ tailwind.config.js â”œâ”€â”€ .eslintrc.cjs â”œâ”€â”€ .prettierrc â””â”€â”€ README.md æ„å»ºé…ç½®ä¼˜åŒ– 1. Viteé…ç½®ä¼˜åŒ– 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 // vite.config.ts import { defineConfig } from \u0026#39;vite\u0026#39; import vue from \u0026#39;@vitejs/plugin-vue\u0026#39; import { resolve } from \u0026#39;path\u0026#39; import { visualizer } from \u0026#39;rollup-plugin-visualizer\u0026#39; export default defineConfig(({ command, mode }) =\u0026gt; { const isProduction = mode === \u0026#39;production\u0026#39; return { plugins: [ vue(), // ç”Ÿäº§ç¯å¢ƒæ‰“åŒ…åˆ†æ isProduction \u0026amp;\u0026amp; visualizer({ filename: \u0026#39;dist/stats.html\u0026#39;, open: true, gzipSize: true }) ].filter(Boolean), // è·¯å¾„åˆ«å resolve: { alias: { \u0026#39;@\u0026#39;: resolve(__dirname, \u0026#39;src\u0026#39;), \u0026#39;@/components\u0026#39;: resolve(__dirname, \u0026#39;src/components\u0026#39;), \u0026#39;@/utils\u0026#39;: resolve(__dirname, \u0026#39;src/utils\u0026#39;), \u0026#39;@/api\u0026#39;: resolve(__dirname, \u0026#39;src/api\u0026#39;) } }, // å¼€å‘æœåŠ¡å™¨é…ç½® server: { port: 3000, open: true, cors: true, proxy: { \u0026#39;/api\u0026#39;: { target: \u0026#39;http://localhost:8080\u0026#39;, changeOrigin: true, rewrite: (path) =\u0026gt; path.replace(/^\\/api/, \u0026#39;\u0026#39;) } } }, // æ„å»ºé…ç½® build: { target: \u0026#39;es2015\u0026#39;, outDir: \u0026#39;dist\u0026#39;, assetsDir: \u0026#39;assets\u0026#39;, sourcemap: !isProduction, minify: isProduction ? \u0026#39;terser\u0026#39; : false, terserOptions: { compress: { drop_console: isProduction, drop_debugger: isProduction } }, rollupOptions: { output: { // æ‰‹åŠ¨åˆ†åŒ… manualChunks: { vendor: [\u0026#39;vue\u0026#39;, \u0026#39;vue-router\u0026#39;, \u0026#39;pinia\u0026#39;], ui: [\u0026#39;element-plus\u0026#39;, \u0026#39;@element-plus/icons-vue\u0026#39;], utils: [\u0026#39;axios\u0026#39;, \u0026#39;dayjs\u0026#39;, \u0026#39;lodash-es\u0026#39;] }, // æ–‡ä»¶å‘½å chunkFileNames: \u0026#39;js/[name]-[hash].js\u0026#39;, entryFileNames: \u0026#39;js/[name]-[hash].js\u0026#39;, assetFileNames: \u0026#39;[ext]/[name]-[hash].[ext]\u0026#39; } }, // èµ„æºå†…è”é˜ˆå€¼ assetsInlineLimit: 4096 }, // ç¯å¢ƒå˜é‡é…ç½® define: { __APP_VERSION__: JSON.stringify(process.env.npm_package_version) }, // CSSé…ç½® css: { preprocessorOptions: { scss: { additionalData: `@import \u0026#34;@/styles/variables.scss\u0026#34;;` } }, modules: { localsConvention: \u0026#39;camelCase\u0026#39; } } } }) 2. ç¯å¢ƒå˜é‡ç®¡ç† 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 // .env.development VITE_APP_TITLE=MyApp Development VITE_API_BASE_URL=http://localhost:8080/api VITE_ENABLE_MOCK=true VITE_ENABLE_DEVTOOLS=true // .env.production VITE_APP_TITLE=MyApp VITE_API_BASE_URL=https://api.example.com VITE_ENABLE_MOCK=false VITE_ENABLE_DEVTOOLS=false // ç¯å¢ƒå˜é‡ç±»å‹å®šä¹‰ // src/env.d.ts interface ImportMetaEnv { readonly VITE_APP_TITLE: string readonly VITE_API_BASE_URL: string readonly VITE_ENABLE_MOCK: string readonly VITE_ENABLE_DEVTOOLS: string } interface ImportMeta { readonly env: ImportMetaEnv } // ä½¿ç”¨ç¯å¢ƒå˜é‡ // src/config/index.ts export const config = { appTitle: import.meta.env.VITE_APP_TITLE, apiUrl: import.meta.env.VITE_API_BASE_URL, isDev: import.meta.env.DEV, isProduction: import.meta.env.PROD, enableMock: import.meta.env.VITE_ENABLE_MOCK === \u0026#39;true\u0026#39; } ä»£ç è§„èŒƒä¸è´¨é‡ä¿è¯ 1. ESLinté…ç½® 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 // .eslintrc.cjs module.exports = { root: true, env: { browser: true, es2021: true, node: true }, extends: [ \u0026#39;eslint:recommended\u0026#39;, \u0026#39;plugin:vue/vue3-essential\u0026#39;, \u0026#39;plugin:@typescript-eslint/recommended\u0026#39;, \u0026#39;plugin:vue/vue3-strongly-recommended\u0026#39;, \u0026#39;@vue/eslint-config-typescript\u0026#39;, \u0026#39;@vue/eslint-config-prettier/skip-formatting\u0026#39; ], parser: \u0026#39;vue-eslint-parser\u0026#39;, parserOptions: { ecmaVersion: \u0026#39;latest\u0026#39;, sourceType: \u0026#39;module\u0026#39;, parser: \u0026#39;@typescript-eslint/parser\u0026#39; }, rules: { // Vueè§„åˆ™ \u0026#39;vue/multi-word-component-names\u0026#39;: \u0026#39;off\u0026#39;, \u0026#39;vue/component-tags-order\u0026#39;: [\u0026#39;error\u0026#39;, { order: [\u0026#39;template\u0026#39;, \u0026#39;script\u0026#39;, \u0026#39;style\u0026#39;] }], \u0026#39;vue/component-definition-name-casing\u0026#39;: [\u0026#39;error\u0026#39;, \u0026#39;PascalCase\u0026#39;], \u0026#39;vue/custom-event-name-casing\u0026#39;: [\u0026#39;error\u0026#39;, \u0026#39;camelCase\u0026#39;], \u0026#39;vue/no-multiple-template-root\u0026#39;: \u0026#39;off\u0026#39;, // TypeScriptè§„åˆ™ \u0026#39;@typescript-eslint/no-unused-vars\u0026#39;: [\u0026#39;error\u0026#39;, { argsIgnorePattern: \u0026#39;^_\u0026#39;, varsIgnorePattern: \u0026#39;^_\u0026#39; }], \u0026#39;@typescript-eslint/explicit-function-return-type\u0026#39;: \u0026#39;off\u0026#39;, \u0026#39;@typescript-eslint/no-explicit-any\u0026#39;: \u0026#39;warn\u0026#39;, \u0026#39;@typescript-eslint/prefer-const\u0026#39;: \u0026#39;error\u0026#39;, // é€šç”¨è§„åˆ™ \u0026#39;no-console\u0026#39;: process.env.NODE_ENV === \u0026#39;production\u0026#39; ? \u0026#39;warn\u0026#39; : \u0026#39;off\u0026#39;, \u0026#39;no-debugger\u0026#39;: process.env.NODE_ENV === \u0026#39;production\u0026#39; ? \u0026#39;warn\u0026#39; : \u0026#39;off\u0026#39;, \u0026#39;prefer-const\u0026#39;: \u0026#39;error\u0026#39;, \u0026#39;no-var\u0026#39;: \u0026#39;error\u0026#39;, \u0026#39;object-shorthand\u0026#39;: \u0026#39;error\u0026#39; }, overrides: [ { files: [\u0026#39;*.vue\u0026#39;], rules: { \u0026#39;indent\u0026#39;: \u0026#39;off\u0026#39; } } ] } 2. Prettieré…ç½® 1 2 3 4 5 6 7 8 9 10 11 12 // .prettierrc { \u0026#34;semi\u0026#34;: false, \u0026#34;singleQuote\u0026#34;: true, \u0026#34;tabWidth\u0026#34;: 2, \u0026#34;trailingComma\u0026#34;: \u0026#34;es5\u0026#34;, \u0026#34;printWidth\u0026#34;: 100, \u0026#34;bracketSpacing\u0026#34;: true, \u0026#34;arrowParens\u0026#34;: \u0026#34;always\u0026#34;, \u0026#34;endOfLine\u0026#34;: \u0026#34;lf\u0026#34;, \u0026#34;vueIndentScriptAndStyle\u0026#34;: false } 3. Git Hooksé…ç½® 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 // package.json { \u0026#34;husky\u0026#34;: { \u0026#34;hooks\u0026#34;: { \u0026#34;pre-commit\u0026#34;: \u0026#34;lint-staged\u0026#34;, \u0026#34;commit-msg\u0026#34;: \u0026#34;commitlint -E HUSKY_GIT_PARAMS\u0026#34; } }, \u0026#34;lint-staged\u0026#34;: { \u0026#34;*.{js,jsx,ts,tsx}\u0026#34;: [ \u0026#34;eslint --fix\u0026#34;, \u0026#34;prettier --write\u0026#34; ], \u0026#34;*.{vue}\u0026#34;: [ \u0026#34;eslint --fix\u0026#34;, \u0026#34;prettier --write\u0026#34; ], \u0026#34;*.{css,scss,less}\u0026#34;: [ \u0026#34;prettier --write\u0026#34; ], \u0026#34;*.{json,md}\u0026#34;: [ \u0026#34;prettier --write\u0026#34; ] }, \u0026#34;commitlint\u0026#34;: { \u0026#34;extends\u0026#34;: [\u0026#34;@commitlint/config-conventional\u0026#34;] } } 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 // commitlint.config.js module.exports = { extends: [\u0026#39;@commitlint/config-conventional\u0026#39;], rules: { \u0026#39;type-enum\u0026#39;: [ 2, \u0026#39;always\u0026#39;, [ \u0026#39;feat\u0026#39;, // æ–°åŠŸèƒ½ \u0026#39;fix\u0026#39;, // ä¿®å¤bug \u0026#39;docs\u0026#39;, // æ–‡æ¡£æ›´æ–° \u0026#39;style\u0026#39;, // ä»£ç æ ¼å¼ \u0026#39;refactor\u0026#39;, // é‡æ„ \u0026#39;perf\u0026#39;, // æ€§èƒ½ä¼˜åŒ– \u0026#39;test\u0026#39;, // æµ‹è¯• \u0026#39;chore\u0026#39;, // æ„å»ºè¿‡ç¨‹æˆ–è¾…åŠ©å·¥å…·çš„å˜åŠ¨ \u0026#39;revert\u0026#39; // å›æ»š ] ], \u0026#39;subject-max-length\u0026#39;: [2, \u0026#39;always\u0026#39;, 50], \u0026#39;body-max-line-length\u0026#39;: [2, \u0026#39;always\u0026#39;, 72] } } ç»„ä»¶å¼€å‘è§„èŒƒ 1. ç»„ä»¶å‘½åå’Œç»„ç»‡ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 // ç»„ä»¶å‘½åè§„èŒƒ // 1. ä½¿ç”¨PascalCase // 2. è¯­ä¹‰åŒ–å‘½å // 3. é¿å…ç¼©å†™ // ä¾‹å­ï¼šGood UserProfileCard.tsx DataTableWithPagination.tsx ModalDialog.tsx // ä¾‹å­ï¼šBad UserProfCard.tsx DataTable.tsx Modal.tsx // ç»„ä»¶ç›®å½•ç»“æ„ components/ â”œâ”€â”€ common/ # é€šç”¨ç»„ä»¶ â”‚ â”œâ”€â”€ Button/ â”‚ â”‚ â”œâ”€â”€ index.vue â”‚ â”‚ â”œâ”€â”€ types.ts â”‚ â”‚ â””â”€â”€ README.md â”‚ â”œâ”€â”€ Input/ â”‚ â””â”€â”€ Modal/ â”œâ”€â”€ business/ # ä¸šåŠ¡ç»„ä»¶ â”‚ â”œâ”€â”€ UserCard/ â”‚ â”œâ”€â”€ ProductList/ â”‚ â””â”€â”€ OrderForm/ â””â”€â”€ index.ts # å¯¼å‡ºå…¥å£ // å¯¼å‡ºç»Ÿä¸€ç®¡ç† // components/index.ts export { default as Button } from \u0026#39;./common/Button\u0026#39; export { default as Input } from \u0026#39;./common/Input\u0026#39; export { default as UserCard } from \u0026#39;./business/UserCard\u0026#39; 2. ç»„ä»¶è®¾è®¡åŸåˆ™ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 \u0026lt;!-- BaseButton.vue --\u0026gt; \u0026lt;template\u0026gt; \u0026lt;button :class=\u0026#34;[ \u0026#39;base-button\u0026#39;, `base-button--${type}`, `base-button--${size}`, { \u0026#39;base-button--disabled\u0026#39;: disabled } ]\u0026#34; :disabled=\u0026#34;disabled\u0026#34; @click=\u0026#34;handleClick\u0026#34; \u0026gt; \u0026lt;slot /\u0026gt; \u0026lt;/button\u0026gt; \u0026lt;/template\u0026gt; \u0026lt;script setup lang=\u0026#34;ts\u0026#34;\u0026gt; interface Props { type?: \u0026#39;primary\u0026#39; | \u0026#39;secondary\u0026#39; | \u0026#39;danger\u0026#39; size?: \u0026#39;small\u0026#39; | \u0026#39;medium\u0026#39; | \u0026#39;large\u0026#39; disabled?: boolean loading?: boolean } interface Emits { click: [event: MouseEvent] } const props = withDefaults(defineProps\u0026lt;Props\u0026gt;(), { type: \u0026#39;primary\u0026#39;, size: \u0026#39;medium\u0026#39;, disabled: false, loading: false }) const emit = defineEmits\u0026lt;Emits\u0026gt;() const handleClick = (event: MouseEvent) =\u0026gt; { if (!props.disabled \u0026amp;\u0026amp; !props.loading) { emit(\u0026#39;click\u0026#39;, event) } } \u0026lt;/script\u0026gt; \u0026lt;style scoped lang=\u0026#34;scss\u0026#34;\u0026gt; .base-button { // åŸºç¡€æ ·å¼ padding: 8px 16px; border: none; border-radius: 4px; cursor: pointer; transition: all 0.3s ease; // ç±»å‹å˜ä½“ \u0026amp;--primary { background-color: var(--color-primary); color: white; \u0026amp;:hover { background-color: var(--color-primary-dark); } } \u0026amp;--secondary { background-color: var(--color-secondary); color: var(--color-text); \u0026amp;:hover { background-color: var(--color-secondary-dark); } } // å°ºå¯¸å˜ä½“ \u0026amp;--small { padding: 4px 8px; font-size: 12px; } \u0026amp;--large { padding: 12px 24px; font-size: 16px; } // çŠ¶æ€ \u0026amp;--disabled { opacity: 0.5; cursor: not-allowed; } } \u0026lt;/style\u0026gt; 3. ç»„ä»¶æ–‡æ¡£è§„èŒƒ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 // Button.tsx ç»„ä»¶æ–‡æ¡£ç¤ºä¾‹ /** * Buttonç»„ä»¶ * * @example * ```tsx * \u0026lt;Button * type=\u0026#34;primary\u0026#34; * size=\u0026#34;large\u0026#34; * onClick={handleClick} * loading={isLoading} * \u0026gt; * Submit * \u0026lt;/Button\u0026gt; * ``` */ export interface ButtonProps { /** æŒ‰é’®ç±»å‹ */ type?: \u0026#39;primary\u0026#39; | \u0026#39;secondary\u0026#39; | \u0026#39;danger\u0026#39; /** æŒ‰é’®å°ºå¯¸ */ size?: \u0026#39;small\u0026#39; | \u0026#39;medium\u0026#39; | \u0026#39;large\u0026#39; /** æ˜¯å¦ç¦ç”¨ */ disabled?: boolean /** æ˜¯å¦åŠ è½½ä¸­ */ loading?: boolean /** ç‚¹å‡»äº‹ä»¶å¤„ç†å‡½æ•° */ onClick?: (event: MouseEvent) =\u0026gt; void /** è‡ªå®šä¹‰ç±»å */ className?: string /** å­å…ƒç´  */ children?: React.ReactNode } çŠ¶æ€ç®¡ç†æœ€ä½³å®è·µ 1. PiniaçŠ¶æ€ç®¡ç† 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 // stores/user.ts import { defineStore } from \u0026#39;pinia\u0026#39; import { ref, computed } from \u0026#39;vue\u0026#39; import type { User, UserRole } from \u0026#39;@/types/user\u0026#39; import { userApi } from \u0026#39;@/api/user\u0026#39; export const useUserStore = defineStore(\u0026#39;user\u0026#39;, () =\u0026gt; { // State const currentUser = ref\u0026lt;User | null\u0026gt;(null) const users = ref\u0026lt;User[]\u0026gt;([]) const loading = ref(false) const error = ref\u0026lt;string | null\u0026gt;(null) // Getters const isLoggedIn = computed(() =\u0026gt; !!currentUser.value) const isAdmin = computed(() =\u0026gt; currentUser.value?.role === UserRole.ADMIN ) const activeUsers = computed(() =\u0026gt; users.value.filter(user =\u0026gt; user.isActive) ) // Actions const fetchUser = async (id: string) =\u0026gt; { try { loading.value = true error.value = null const user = await userApi.getById(id) currentUser.value = user return user } catch (err) { error.value = err instanceof Error ? err.message : \u0026#39;Unknown error\u0026#39; throw err } finally { loading.value = false } } const updateUser = async (userData: Partial\u0026lt;User\u0026gt;) =\u0026gt; { if (!currentUser.value) return try { const updatedUser = await userApi.update( currentUser.value.id, userData ) currentUser.value = updatedUser return updatedUser } catch (err) { error.value = err instanceof Error ? err.message : \u0026#39;Update failed\u0026#39; throw err } } const logout = () =\u0026gt; { currentUser.value = null users.value = [] error.value = null } return { // State currentUser, users, loading, error, // Getters isLoggedIn, isAdmin, activeUsers, // Actions fetchUser, updateUser, logout } }) 2. å“åº”å¼æ•°æ®ç®¡ç† 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 // composables/useApi.ts import { ref, type Ref } from \u0026#39;vue\u0026#39; import type { ApiResponse } from \u0026#39;@/types/api\u0026#39; export function useApi\u0026lt;T\u0026gt;( apiCall: () =\u0026gt; Promise\u0026lt;ApiResponse\u0026lt;T\u0026gt;\u0026gt; ) { const data = ref\u0026lt;T | null\u0026gt;(null) const loading = ref(false) const error = ref\u0026lt;string | null\u0026gt;(null) const execute = async () =\u0026gt; { try { loading.value = true error.value = null const response = await apiCall() data.value = response.data return response } catch (err) { error.value = err instanceof Error ? err.message : \u0026#39;API Error\u0026#39; throw err } finally { loading.value = false } } return { data: data as Ref\u0026lt;T | null\u0026gt;, loading, error, execute, reset: () =\u0026gt; { data.value = null error.value = null loading.value = false } } } // ä½¿ç”¨ç¤ºä¾‹ const { data: user, loading, error, execute } = useApi(() =\u0026gt; userApi.getById(\u0026#39;123\u0026#39;) ) è‡ªåŠ¨åŒ–æµ‹è¯• 1. å•å…ƒæµ‹è¯•é…ç½® 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 // vitest.config.ts import { defineConfig } from \u0026#39;vitest/config\u0026#39; import vue from \u0026#39;@vitejs/plugin-vue\u0026#39; import { resolve } from \u0026#39;path\u0026#39; export default defineConfig({ plugins: [vue()], test: { globals: true, environment: \u0026#39;jsdom\u0026#39;, setupFiles: [\u0026#39;./tests/setup.ts\u0026#39;], coverage: { provider: \u0026#39;c8\u0026#39;, reporter: [\u0026#39;text\u0026#39;, \u0026#39;html\u0026#39;, \u0026#39;json\u0026#39;], exclude: [ \u0026#39;node_modules/\u0026#39;, \u0026#39;tests/\u0026#39;, \u0026#39;dist/\u0026#39;, \u0026#39;**/*.d.ts\u0026#39; ] } }, resolve: { alias: { \u0026#39;@\u0026#39;: resolve(__dirname, \u0026#39;src\u0026#39;) } } }) // tests/setup.ts import { config } from \u0026#39;@vue/test-utils\u0026#39; import { vi } from \u0026#39;vitest\u0026#39; // å…¨å±€é…ç½® config.global.stubs = { \u0026#39;font-awesome-icon\u0026#39;: true, \u0026#39;router-link\u0026#39;: true, \u0026#39;router-view\u0026#39;: true } // Mockå…¨å±€å¯¹è±¡ Object.defineProperty(window, \u0026#39;matchMedia\u0026#39;, { writable: true, value: vi.fn().mockImplementation(query =\u0026gt; ({ matches: false, media: query, onchange: null, addListener: vi.fn(), removeListener: vi.fn(), addEventListener: vi.fn(), removeEventListener: vi.fn(), dispatchEvent: vi.fn(), })), }) 2. ç»„ä»¶æµ‹è¯•ç¤ºä¾‹ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 // tests/unit/components/Button.spec.ts import { describe, it, expect, vi } from \u0026#39;vitest\u0026#39; import { mount } from \u0026#39;@vue/test-utils\u0026#39; import BaseButton from \u0026#39;@/components/common/BaseButton.vue\u0026#39; describe(\u0026#39;BaseButton\u0026#39;, () =\u0026gt; { it(\u0026#39;renders correctly with default props\u0026#39;, () =\u0026gt; { const wrapper = mount(BaseButton, { slots: { default: \u0026#39;Click me\u0026#39; } }) expect(wrapper.find(\u0026#39;button\u0026#39;).exists()).toBe(true) expect(wrapper.text()).toBe(\u0026#39;Click me\u0026#39;) expect(wrapper.classes()).toContain(\u0026#39;base-button\u0026#39;) expect(wrapper.classes()).toContain(\u0026#39;base-button--primary\u0026#39;) expect(wrapper.classes()).toContain(\u0026#39;base-button--medium\u0026#39;) }) it(\u0026#39;applies correct type classes\u0026#39;, () =\u0026gt; { const wrapper = mount(BaseButton, { props: { type: \u0026#39;danger\u0026#39; } }) expect(wrapper.classes()).toContain(\u0026#39;base-button--danger\u0026#39;) }) it(\u0026#39;emits click event when clicked\u0026#39;, async () =\u0026gt; { const wrapper = mount(BaseButton) await wrapper.find(\u0026#39;button\u0026#39;).trigger(\u0026#39;click\u0026#39;) expect(wrapper.emitted()).toHaveProperty(\u0026#39;click\u0026#39;) expect(wrapper.emitted(\u0026#39;click\u0026#39;)).toHaveLength(1) }) it(\u0026#39;does not emit click when disabled\u0026#39;, async () =\u0026gt; { const wrapper = mount(BaseButton, { props: { disabled: true } }) await wrapper.find(\u0026#39;button\u0026#39;).trigger(\u0026#39;click\u0026#39;) expect(wrapper.emitted(\u0026#39;click\u0026#39;)).toBeUndefined() }) it(\u0026#39;applies disabled state correctly\u0026#39;, () =\u0026gt; { const wrapper = mount(BaseButton, { props: { disabled: true } }) const button = wrapper.find(\u0026#39;button\u0026#39;) expect(button.attributes(\u0026#39;disabled\u0026#39;)).toBeDefined() expect(button.classes()).toContain(\u0026#39;base-button--disabled\u0026#39;) }) }) 3. APIæµ‹è¯•ç¤ºä¾‹ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 // tests/unit/api/user.spec.ts import { describe, it, expect, beforeEach, vi } from \u0026#39;vitest\u0026#39; import { userApi } from \u0026#39;@/api/user\u0026#39; import { httpClient } from \u0026#39;@/utils/http\u0026#39; vi.mock(\u0026#39;@/utils/http\u0026#39;) describe(\u0026#39;User API\u0026#39;, () =\u0026gt; { beforeEach(() =\u0026gt; { vi.clearAllMocks() }) it(\u0026#39;should fetch user by ID\u0026#39;, async () =\u0026gt; { const mockUser = { id: \u0026#39;123\u0026#39;, name: \u0026#39;John Doe\u0026#39;, email: \u0026#39;john@example.com\u0026#39; } vi.mocked(httpClient.get).mockResolvedValue({ data: mockUser }) const result = await userApi.getById(\u0026#39;123\u0026#39;) expect(httpClient.get).toHaveBeenCalledWith(\u0026#39;/users/123\u0026#39;) expect(result).toEqual(mockUser) }) it(\u0026#39;should handle API errors\u0026#39;, async () =\u0026gt; { const error = new Error(\u0026#39;User not found\u0026#39;) vi.mocked(httpClient.get).mockRejectedValue(error) await expect(userApi.getById(\u0026#39;999\u0026#39;)).rejects.toThrow(\u0026#39;User not found\u0026#39;) }) }) CI/CDé›†æˆ 1. GitHub Actionsé…ç½® 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 # .github/workflows/ci.yml name: CI/CD Pipeline on: push: branches: [main, develop] pull_request: branches: [main] jobs: test: runs-on: ubuntu-latest strategy: matrix: node-version: [18.x, 20.x] steps: - name: Checkout code uses: actions/checkout@v4 - name: Setup Node.js ${{ matrix.node-version }} uses: actions/setup-node@v4 with: node-version: ${{ matrix.node-version }} cache: \u0026#39;npm\u0026#39; - name: Install dependencies run: npm ci - name: Lint run: npm run lint - name: Type check run: npm run type-check - name: Run tests run: npm run test:unit - name: Run E2E tests run: npm run test:e2e - name: Build run: npm run build - name: Upload coverage uses: codecov/codecov-action@v3 with: file: ./coverage/lcov.info deploy: needs: test runs-on: ubuntu-latest if: github.ref == \u0026#39;refs/heads/main\u0026#39; steps: - name: Checkout code uses: actions/checkout@v4 - name: Setup Node.js uses: actions/setup-node@v4 with: node-version: \u0026#39;20.x\u0026#39; cache: \u0026#39;npm\u0026#39; - name: Install dependencies run: npm ci - name: Build for production run: npm run build - name: Deploy to production run: | # éƒ¨ç½²è„šæœ¬ echo \u0026#34;Deploying to production...\u0026#34; 2. ä»£ç è´¨é‡æ£€æŸ¥ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 # .github/workflows/quality.yml name: Code Quality on: pull_request: branches: [main] jobs: quality: runs-on: ubuntu-latest steps: - name: Checkout code uses: actions/checkout@v4 with: fetch-depth: 0 - name: Setup Node.js uses: actions/setup-node@v4 with: node-version: \u0026#39;20.x\u0026#39; cache: \u0026#39;npm\u0026#39; - name: Install dependencies run: npm ci - name: ESLint run: npm run lint - name: Prettier check run: npm run format:check - name: TypeScript check run: npm run type-check - name: Bundle size check run: | npm run build npx bundlesize - name: Security audit run: npm audit --audit-level high æ€§èƒ½ä¼˜åŒ– 1. æ„å»ºä¼˜åŒ– 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 // vite.config.ts ç”Ÿäº§ç¯å¢ƒä¼˜åŒ– export default defineConfig(({ mode }) =\u0026gt; { const isProduction = mode === \u0026#39;production\u0026#39; return { build: { minify: \u0026#39;terser\u0026#39;, terserOptions: { compress: { drop_console: isProduction, drop_debugger: isProduction, pure_funcs: isProduction ? [\u0026#39;console.log\u0026#39;] : [] } }, rollupOptions: { output: { manualChunks: { vendor: [\u0026#39;vue\u0026#39;, \u0026#39;vue-router\u0026#39;, \u0026#39;pinia\u0026#39;], utils: [\u0026#39;axios\u0026#39;, \u0026#39;dayjs\u0026#39;, \u0026#39;lodash-es\u0026#39;] } } }, chunkSizeWarningLimit: 1000 } } }) 2. è¿è¡Œæ—¶æ€§èƒ½ä¼˜åŒ– 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 // composables/useLazyLoad.ts import { ref, onMounted, onUnmounted } from \u0026#39;vue\u0026#39; export function useLazyLoad( callback: () =\u0026gt; void, options?: IntersectionObserverInit ) { const target = ref\u0026lt;HTMLElement\u0026gt;() const observer = ref\u0026lt;IntersectionObserver\u0026gt;() onMounted(() =\u0026gt; { if (\u0026#39;IntersectionObserver\u0026#39; in window) { observer.value = new IntersectionObserver( (entries) =\u0026gt; { entries.forEach((entry) =\u0026gt; { if (entry.isIntersecting) { callback() observer.value?.unobserve(entry.target) } }) }, { threshold: 0.1, ...options } ) if (target.value) { observer.value.observe(target.value) } } else { // é™çº§å¤„ç† callback() } }) onUnmounted(() =\u0026gt; { observer.value?.disconnect() }) return { target } } // å›¾ç‰‡æ‡’åŠ è½½ç»„ä»¶ // components/LazyImage.vue \u0026lt;template\u0026gt; \u0026lt;div ref=\u0026#34;target\u0026#34; class=\u0026#34;lazy-image-container\u0026#34;\u0026gt; \u0026lt;img v-if=\u0026#34;isVisible\u0026#34; :src=\u0026#34;src\u0026#34; :alt=\u0026#34;alt\u0026#34; :class=\u0026#34;imageClass\u0026#34; @load=\u0026#34;onLoad\u0026#34; @error=\u0026#34;onError\u0026#34; /\u0026gt; \u0026lt;div v-else class=\u0026#34;lazy-image-placeholder\u0026#34;\u0026gt; \u0026lt;slot name=\u0026#34;placeholder\u0026#34;\u0026gt; \u0026lt;div class=\u0026#34;loading-spinner\u0026#34;\u0026gt;Loading...\u0026lt;/div\u0026gt; \u0026lt;/slot\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/template\u0026gt; \u0026lt;script setup lang=\u0026#34;ts\u0026#34;\u0026gt; import { ref } from \u0026#39;vue\u0026#39; import { useLazyLoad } from \u0026#39;@/composables/useLazyLoad\u0026#39; interface Props { src: string alt: string imageClass?: string } const props = defineProps\u0026lt;Props\u0026gt;() const isVisible = ref(false) const { target } = useLazyLoad(() =\u0026gt; { isVisible.value = true }) const onLoad = () =\u0026gt; { // å›¾ç‰‡åŠ è½½å®Œæˆ } const onError = () =\u0026gt; { // å›¾ç‰‡åŠ è½½å¤±è´¥ } \u0026lt;/script\u0026gt; ç›‘æ§å’Œé”™è¯¯å¤„ç† 1. é”™è¯¯ç›‘æ§é›†æˆ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 // utils/monitoring.ts import * as Sentry from \u0026#39;@sentry/vue\u0026#39; import { BrowserTracing } from \u0026#39;@sentry/tracing\u0026#39; export function initMonitoring(app: App) { if (import.meta.env.PROD) { Sentry.init({ app, dsn: import.meta.env.VITE_SENTRY_DSN, integrations: [ new BrowserTracing({ routingInstrumentation: Sentry.vueRouterInstrumentation( app.config.globalProperties.$router ) }) ], tracesSampleRate: 0.1, environment: import.meta.env.MODE }) } } // é”™è¯¯è¾¹ç•Œç»„ä»¶ // components/ErrorBoundary.vue \u0026lt;template\u0026gt; \u0026lt;div v-if=\u0026#34;hasError\u0026#34; class=\u0026#34;error-boundary\u0026#34;\u0026gt; \u0026lt;h2\u0026gt;Something went wrong\u0026lt;/h2\u0026gt; \u0026lt;p\u0026gt;{{ error?.message }}\u0026lt;/p\u0026gt; \u0026lt;button @click=\u0026#34;retry\u0026#34;\u0026gt;Retry\u0026lt;/button\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;slot v-else /\u0026gt; \u0026lt;/template\u0026gt; \u0026lt;script setup lang=\u0026#34;ts\u0026#34;\u0026gt; import { ref, onErrorCaptured } from \u0026#39;vue\u0026#39; import { captureException } from \u0026#39;@sentry/vue\u0026#39; const hasError = ref(false) const error = ref\u0026lt;Error | null\u0026gt;(null) onErrorCaptured((err: Error) =\u0026gt; { hasError.value = true error.value = err captureException(err) return false }) const retry = () =\u0026gt; { hasError.value = false error.value = null } \u0026lt;/script\u0026gt; æ€»ç»“ å‰ç«¯å·¥ç¨‹åŒ–æ˜¯ä¸€ä¸ªæŒç»­æ”¹è¿›çš„è¿‡ç¨‹ï¼Œéœ€è¦å›¢é˜Ÿå…±åŒåŠªåŠ›ã€‚é€šè¿‡å®æ–½æœ¬æ–‡ä»‹ç»çš„æœ€ä½³å®è·µï¼Œä½ çš„å›¢é˜Ÿå¯ä»¥ï¼š\næå‡å¼€å‘æ•ˆç‡ï¼šç»Ÿä¸€çš„ä»£ç è§„èŒƒå’Œè‡ªåŠ¨åŒ–æµç¨‹ ä¿è¯ä»£ç è´¨é‡ï¼šè‡ªåŠ¨åŒ–æµ‹è¯•å’Œä»£ç å®¡æŸ¥ ä¼˜åŒ–ç”¨æˆ·ä½“éªŒï¼šæ€§èƒ½ç›‘æ§å’Œé”™è¯¯å¤„ç† ç®€åŒ–éƒ¨ç½²æµç¨‹ï¼šCI/CDè‡ªåŠ¨åŒ– ä¿ƒè¿›å›¢é˜Ÿåä½œï¼šè§„èŒƒçš„é¡¹ç›®ç»“æ„å’Œæ–‡æ¡£ è®°ä½ï¼Œå·¥ç¨‹åŒ–çš„æœ€ç»ˆç›®æ ‡æ˜¯è®©å¼€å‘è€…æ›´ä¸“æ³¨äºä¸šåŠ¡é€»è¾‘ï¼Œè€Œä¸æ˜¯è¢«å·¥å…·å’Œæµç¨‹æ‰€æŸç¼šã€‚é€‰æ‹©é€‚åˆå›¢é˜Ÿçš„å·¥å…·å’Œæµç¨‹ï¼Œå¹¶æŒç»­ä¼˜åŒ–å’Œæ”¹è¿›ã€‚\n","permalink":"/blog/articles/frontend-engineering-practices/","summary":"æ·±å…¥æ¢è®¨å‰ç«¯å·¥ç¨‹åŒ–çš„æ ¸å¿ƒç†å¿µå’Œå®è·µæ–¹æ³•ï¼ŒåŒ…æ‹¬é¡¹ç›®è„šæ‰‹æ¶ã€æ„å»ºä¼˜åŒ–ã€è‡ªåŠ¨åŒ–æµ‹è¯•ã€ä»£ç è´¨é‡ä¿è¯ç­‰ï¼Œå¸®åŠ©å›¢é˜Ÿå»ºç«‹è§„èŒƒçš„å‰ç«¯å¼€å‘æµç¨‹","title":"å‰ç«¯å·¥ç¨‹åŒ–å®è·µæŒ‡å—ï¼šä»é›¶æ­å»ºç°ä»£åŒ–çš„å‰ç«¯é¡¹ç›®"},{"content":"Dockerå®¹å™¨åŒ–éƒ¨ç½²å®Œå…¨æŒ‡å—ï¼šä»å…¥é—¨åˆ°ç”Ÿäº§ç¯å¢ƒ Dockerå·²ç»æˆä¸ºç°ä»£åº”ç”¨éƒ¨ç½²çš„æ ‡å‡†å·¥å…·ï¼Œå®ƒé€šè¿‡å®¹å™¨åŒ–æŠ€æœ¯ç®€åŒ–äº†åº”ç”¨çš„éƒ¨ç½²ã€æ‰©å±•å’Œç®¡ç†ã€‚æœ¬æ–‡å°†å…¨é¢ä»‹ç»Dockerçš„ä½¿ç”¨æ–¹æ³•ï¼Œä»åŸºç¡€æ¦‚å¿µåˆ°ç”Ÿäº§ç¯å¢ƒçš„æœ€ä½³å®è·µã€‚\nDockeråŸºç¡€æ¦‚å¿µ 1. æ ¸å¿ƒæ¦‚å¿µç†è§£ Dockeræ¶æ„ï¼š\n1 2 3 4 5 6 7 # DockeråŒ…å«ä¸‰ä¸ªæ ¸å¿ƒæ¦‚å¿µï¼š # 1. é•œåƒï¼ˆImageï¼‰ï¼šåº”ç”¨çš„é™æ€æ¨¡æ¿ # 2. å®¹å™¨ï¼ˆContainerï¼‰ï¼šé•œåƒçš„è¿è¡Œå®ä¾‹ # 3. ä»“åº“ï¼ˆRepositoryï¼‰ï¼šé•œåƒçš„å­˜å‚¨ä¸­å¿ƒ # Docker Daemonå’ŒDocker Clienté€šä¿¡æµç¨‹ï¼š Client --REST API--\u0026gt; Docker Daemon --containerd--\u0026gt; runc (container runtime) åŸºæœ¬å‘½ä»¤ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 # é•œåƒæ“ä½œ docker images # æŸ¥çœ‹æœ¬åœ°é•œåƒ docker pull nginx:latest # æ‹‰å–é•œåƒ docker build -t myapp:v1 . # æ„å»ºé•œåƒ docker rmi nginx:latest # åˆ é™¤é•œåƒ # å®¹å™¨æ“ä½œ docker run -d nginx # è¿è¡Œå®¹å™¨ docker ps # æŸ¥çœ‹è¿è¡Œä¸­çš„å®¹å™¨ docker ps -a # æŸ¥çœ‹æ‰€æœ‰å®¹å™¨ docker stop container_id # åœæ­¢å®¹å™¨ docker rm container_id # åˆ é™¤å®¹å™¨ docker logs container_id # æŸ¥çœ‹å®¹å™¨æ—¥å¿— docker exec -it container_id bash # è¿›å…¥å®¹å™¨ 2. Dockerfileè¯¦è§£ åŸºç¡€Dockerfileç¤ºä¾‹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 # å¤šé˜¶æ®µæ„å»ºç¤ºä¾‹ FROM node:18-alpine AS builder # è®¾ç½®å·¥ä½œç›®å½• WORKDIR /app # å¤åˆ¶ä¾èµ–æ–‡ä»¶ COPY package*.json ./ # å®‰è£…ä¾èµ– RUN npm ci --only=production # å¤åˆ¶æºä»£ç  COPY . . # æ„å»ºåº”ç”¨ RUN npm run build # ç”Ÿäº§é˜¶æ®µ FROM nginx:alpine # å¤åˆ¶æ„å»ºç»“æœ COPY --from=builder /app/dist /usr/share/nginx/html # å¤åˆ¶é…ç½®æ–‡ä»¶ COPY nginx.conf /etc/nginx/nginx.conf # æš´éœ²ç«¯å£ EXPOSE 80 # å¯åŠ¨å‘½ä»¤ CMD [\u0026#34;nginx\u0026#34;, \u0026#34;-g\u0026#34;, \u0026#34;daemon off;\u0026#34;] Dockerfileæœ€ä½³å®è·µï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 # ä½¿ç”¨å…·ä½“ç‰ˆæœ¬æ ‡ç­¾ï¼Œé¿å…latest FROM node:18.17.0-alpine # åˆ›å»ºérootç”¨æˆ· RUN addgroup -g 1001 -S nodejs \u0026amp;\u0026amp; \\ adduser -S nextjs -u 1001 # è®¾ç½®å·¥ä½œç›®å½• WORKDIR /app # æŒ‰é¡ºåºå¤åˆ¶ï¼Œåˆ©ç”¨ç¼“å­˜å±‚ COPY package*.json ./ RUN npm ci --only=production \u0026amp;\u0026amp; npm cache clean --force # å¤åˆ¶åº”ç”¨ä»£ç  COPY --chown=nextjs:nodejs . . # åˆ‡æ¢åˆ°érootç”¨æˆ· USER nextjs # å¥åº·æ£€æŸ¥ HEALTHCHECK --interval=30s --timeout=3s --start-period=5s --retries=3 \\ CMD curl -f http://localhost:3000 || exit 1 # è®¾ç½®æ ‡ç­¾ LABEL maintainer=\u0026#34;your-email@example.com\u0026#34; \\ version=\u0026#34;1.0.0\u0026#34; \\ description=\u0026#34;My Node.js application\u0026#34; é•œåƒä¼˜åŒ–æŠ€å·§ 1. å¤šé˜¶æ®µæ„å»º 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 # æ„å»ºé˜¶æ®µ FROM node:18-alpine AS builder WORKDIR /app COPY package*.json ./ RUN npm ci COPY . . RUN npm run build # ç”Ÿäº§é˜¶æ®µ FROM node:18-alpine AS production WORKDIR /app # åªå¤åˆ¶ç”Ÿäº§ä¾èµ– COPY package*.json ./ RUN npm ci --only=production \u0026amp;\u0026amp; npm cache clean --force # å¤åˆ¶æ„å»ºç»“æœ COPY --from=builder --chown=node:node /app/dist ./dist # åˆ›å»ºç”¨æˆ· RUN addgroup -g 1001 -S nodejs \u0026amp;\u0026amp; \\ adduser -S nodejs -u 1001 USER nodejs EXPOSE 3000 CMD [\u0026#34;node\u0026#34;, \u0026#34;dist/index.js\u0026#34;] 2. é•œåƒå¤§å°ä¼˜åŒ– 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 # ä½¿ç”¨æ›´å°çš„åŸºç¡€é•œåƒ FROM alpine:3.18 FROM node:18-alpine # è€Œä¸æ˜¯ node:18 # åˆå¹¶RUNæŒ‡ä»¤ RUN apk add --no-cache git curl \u0026amp;\u0026amp; \\ npm install -g nodemon \u0026amp;\u0026amp; \\ npm cache clean --force # ä½¿ç”¨.dockerignore # .dockerignoreæ–‡ä»¶ node_modules npm-debug.log .git .gitignore README.md .env .nyc_output coverage .vscode # æ¸…ç†åŒ…ç®¡ç†å™¨ç¼“å­˜ RUN apt-get update \u0026amp;\u0026amp; \\ apt-get install -y python3 \u0026amp;\u0026amp; \\ apt-get clean \u0026amp;\u0026amp; \\ rm -rf /var/lib/apt/lists/* # ä½¿ç”¨å¤šé˜¶æ®µæ„å»ºå»é™¤æ„å»ºä¾èµ– COPY --from=builder /app/node_modules ./node_modules 3. å®‰å…¨åŠ å›º 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 # ä½¿ç”¨érootç”¨æˆ· FROM node:18-alpine RUN addgroup -g 1001 -S appuser \u0026amp;\u0026amp; \\ adduser -S appuser -u 1001 USER appuser # æœ€å°æƒé™åŸåˆ™ RUN apk add --no-cache dumb-init USER appuser ENTRYPOINT [\u0026#34;dumb-init\u0026#34;, \u0026#34;--\u0026#34;] # å®‰å…¨æ‰«æ FROM node:18-alpine RUN apk add --no-cache dumb-init \u0026amp;\u0026amp; \\ adduser -D -s /bin/sh appuser # ä½¿ç”¨ç‰¹å®šç‰ˆæœ¬æ ‡ç­¾ï¼Œé¿å…å®‰å…¨æ¼æ´ FROM node:18.17.0-alpine@sha256:abc123... Docker Composeåº”ç”¨ 1. åŸºç¡€é…ç½® 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 # docker-compose.yml version: \u0026#39;3.8\u0026#39; services: # Webåº”ç”¨æœåŠ¡ web: build: context: . dockerfile: Dockerfile ports: - \u0026#34;3000:3000\u0026#34; environment: - NODE_ENV=production - DATABASE_URL=postgresql://user:password@db:5432/myapp depends_on: - db - redis volumes: - ./logs:/app/logs restart: unless-stopped networks: - app-network # æ•°æ®åº“æœåŠ¡ db: image: postgres:15-alpine environment: POSTGRES_DB: myapp POSTGRES_USER: user POSTGRES_PASSWORD: password volumes: - postgres_data:/var/lib/postgresql/data - ./init.sql:/docker-entrypoint-initdb.d/init.sql restart: unless-stopped networks: - app-network # Redisç¼“å­˜ redis: image: redis:7-alpine command: redis-server --appendonly yes volumes: - redis_data:/data restart: unless-stopped networks: - app-network # Nginxåå‘ä»£ç† nginx: image: nginx:alpine ports: - \u0026#34;80:80\u0026#34; - \u0026#34;443:443\u0026#34; volumes: - ./nginx.conf:/etc/nginx/nginx.conf - ./ssl:/etc/nginx/ssl depends_on: - web restart: unless-stopped networks: - app-network volumes: postgres_data: redis_data: networks: app-network: driver: bridge 2. å¼€å‘ç¯å¢ƒé…ç½® 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 # docker-compose.dev.yml version: \u0026#39;3.8\u0026#39; services: web: build: context: . dockerfile: Dockerfile.dev volumes: - .:/app - /app/node_modules environment: - NODE_ENV=development - CHOKIDAR_USEPOLLING=true ports: - \u0026#34;3000:3000\u0026#34; - \u0026#34;9229:9229\u0026#34; # Debug port command: npm run dev # çƒ­é‡è½½æ”¯æŒ webpack: build: context: . dockerfile: Dockerfile.webpack volumes: - .:/app - /app/node_modules command: npm run watch # æµ‹è¯•æ•°æ®åº“ db-test: image: postgres:15-alpine environment: POSTGRES_DB: myapp_test POSTGRES_USER: test_user POSTGRES_PASSWORD: test_password ports: - \u0026#34;5433:5432\u0026#34; 3. ç”Ÿäº§ç¯å¢ƒé…ç½® 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 # docker-compose.prod.yml version: \u0026#39;3.8\u0026#39; services: web: image: myapp:latest environment: - NODE_ENV=production deploy: replicas: 3 resources: limits: cpus: \u0026#39;0.5\u0026#39; memory: 512M reservations: cpus: \u0026#39;0.25\u0026#39; memory: 256M restart_policy: condition: on-failure delay: 5s max_attempts: 3 nginx: image: nginx:alpine volumes: - ./nginx.prod.conf:/etc/nginx/nginx.conf - ./ssl:/etc/nginx/ssl ports: - \u0026#34;80:80\u0026#34; - \u0026#34;443:443\u0026#34; å®¹å™¨ç¼–æ’ä¸Kubernetes 1. KubernetesåŸºç¡€é…ç½® 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 # deployment.yaml apiVersion: apps/v1 kind: Deployment metadata: name: myapp-deployment labels: app: myapp spec: replicas: 3 selector: matchLabels: app: myapp template: metadata: labels: app: myapp spec: containers: - name: myapp image: myapp:v1.0.0 ports: - containerPort: 3000 env: - name: NODE_ENV value: \u0026#34;production\u0026#34; - name: DATABASE_URL valueFrom: secretKeyRef: name: myapp-secrets key: database-url resources: requests: memory: \u0026#34;256Mi\u0026#34; cpu: \u0026#34;250m\u0026#34; limits: memory: \u0026#34;512Mi\u0026#34; cpu: \u0026#34;500m\u0026#34; livenessProbe: httpGet: path: /health port: 3000 initialDelaySeconds: 30 periodSeconds: 10 readinessProbe: httpGet: path: /ready port: 3000 initialDelaySeconds: 5 periodSeconds: 5 2. æœåŠ¡å‘ç°å’Œè´Ÿè½½å‡è¡¡ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 # service.yaml apiVersion: v1 kind: Service metadata: name: myapp-service spec: selector: app: myapp ports: - protocol: TCP port: 80 targetPort: 3000 type: ClusterIP --- # ingress.yaml apiVersion: networking.k8s.io/v1 kind: Ingress metadata: name: myapp-ingress annotations: kubernetes.io/ingress.class: nginx cert-manager.io/cluster-issuer: letsencrypt-prod spec: tls: - hosts: - myapp.example.com secretName: myapp-tls rules: - host: myapp.example.com http: paths: - path: / pathType: Prefix backend: service: name: myapp-service port: number: 80 3. é…ç½®ç®¡ç†å’Œå¯†é’¥ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 # configmap.yaml apiVersion: v1 kind: ConfigMap metadata: name: myapp-config data: NODE_ENV: \u0026#34;production\u0026#34; LOG_LEVEL: \u0026#34;info\u0026#34; REDIS_HOST: \u0026#34;redis-service\u0026#34; REDIS_PORT: \u0026#34;6379\u0026#34; --- # secret.yaml apiVersion: v1 kind: Secret metadata: name: myapp-secrets type: Opaque data: database-url: \u0026lt;base64-encoded-url\u0026gt; jwt-secret: \u0026lt;base64-encoded-secret\u0026gt; api-key: \u0026lt;base64-encoded-key\u0026gt; ç›‘æ§å’Œæ—¥å¿—ç®¡ç† 1. å®¹å™¨ç›‘æ§ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 # docker-compose.monitoring.yml version: \u0026#39;3.8\u0026#39; services: # Prometheusç›‘æ§ prometheus: image: prom/prometheus ports: - \u0026#34;9090:9090\u0026#34; volumes: - ./prometheus.yml:/etc/prometheus/prometheus.yml - prometheus_data:/prometheus command: - \u0026#39;--config.file=/etc/prometheus/prometheus.yml\u0026#39; - \u0026#39;--storage.tsdb.path=/prometheus\u0026#39; - \u0026#39;--web.console.libraries=/etc/prometheus/console_libraries\u0026#39; - \u0026#39;--web.console.templates=/etc/prometheus/consoles\u0026#39; # Grafanaå¯è§†åŒ– grafana: image: grafana/grafana ports: - \u0026#34;3001:3000\u0026#34; environment: - GF_SECURITY_ADMIN_PASSWORD=admin volumes: - grafana_data:/var/lib/grafana - ./grafana/dashboards:/etc/grafana/provisioning/dashboards # èŠ‚ç‚¹å¯¼å‡ºå™¨ node-exporter: image: prom/node-exporter ports: - \u0026#34;9100:9100\u0026#34; volumes: - /proc:/host/proc:ro - /sys:/host/sys:ro - /:/rootfs:ro command: - \u0026#39;--path.procfs=/host/proc\u0026#39; - \u0026#39;--path.rootfs=/rootfs\u0026#39; - \u0026#39;--path.sysfs=/host/sys\u0026#39; - \u0026#39;--collector.filesystem.mount-points-exclude=^/(sys|proc|dev|host|etc)($$|/)\u0026#39; # cAdvisorå®¹å™¨ç›‘æ§ cadvisor: image: gcr.io/cadvisor/cadvisor ports: - \u0026#34;8080:8080\u0026#34; volumes: - /:/rootfs:ro - /var/run:/var/run:rw - /sys:/sys:ro - /var/lib/docker/:/var/lib/docker:ro privileged: true volumes: prometheus_data: grafana_data: 2. åº”ç”¨ç›‘æ§é›†æˆ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 // Node.jsåº”ç”¨ç›‘æ§ const prometheus = require(\u0026#39;prom-client\u0026#39;) // åˆ›å»ºæŒ‡æ ‡ const httpRequestDuration = new prometheus.Histogram({ name: \u0026#39;http_request_duration_seconds\u0026#39;, help: \u0026#39;Duration of HTTP requests in seconds\u0026#39;, labelNames: [\u0026#39;method\u0026#39;, \u0026#39;route\u0026#39;, \u0026#39;status_code\u0026#39;] }) const httpRequestTotal = new prometheus.Counter({ name: \u0026#39;http_requests_total\u0026#39;, help: \u0026#39;Total number of HTTP requests\u0026#39;, labelNames: [\u0026#39;method\u0026#39;, \u0026#39;route\u0026#39;, \u0026#39;status_code\u0026#39;] }) // Expressä¸­é—´ä»¶ const metricsMiddleware = (req, res, next) =\u0026gt; { const start = Date.now() res.on(\u0026#39;finish\u0026#39;, () =\u0026gt; { const duration = (Date.now() - start) / 1000 const labels = { method: req.method, route: req.route?.path || req.path, status_code: res.statusCode } httpRequestDuration.observe(labels, duration) httpRequestTotal.inc(labels) }) next() } // ç›‘æ§ç«¯ç‚¹ app.get(\u0026#39;/metrics\u0026#39;, async (req, res) =\u0026gt; { res.set(\u0026#39;Content-Type\u0026#39;, prometheus.register.contentType) res.end(await prometheus.register.metrics()) }) 3. é›†ä¸­åŒ–æ—¥å¿—ç®¡ç† 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 # docker-compose.logging.yml version: \u0026#39;3.8\u0026#39; services: # Elasticsearch elasticsearch: image: docker.elastic.co/elasticsearch/elasticsearch:8.5.0 environment: - discovery.type=single-node - \u0026#34;ES_JAVA_OPTS=-Xms512m -Xmx512m\u0026#34; volumes: - elasticsearch_data:/usr/share/elasticsearch/data ports: - \u0026#34;9200:9200\u0026#34; # Logstash logstash: image: docker.elastic.co/logstash/logstash:8.5.0 volumes: - ./logstash.conf:/usr/share/logstash/pipeline/logstash.conf ports: - \u0026#34;5044:5044\u0026#34; depends_on: - elasticsearch # Kibana kibana: image: docker.elastic.co/kibana/kibana:8.5.0 ports: - \u0026#34;5601:5601\u0026#34; environment: ELASTICSEARCH_HOSTS: http://elasticsearch:9200 depends_on: - elasticsearch # Filebeat filebeat: image: docker.elastic.co/beats/filebeat:8.5.0 user: root volumes: - ./filebeat.yml:/usr/share/filebeat/filebeat.yml - /var/lib/docker/containers:/var/lib/docker/containers:ro - /var/run/docker.sock:/var/run/docker.sock:ro depends_on: - logstash volumes: elasticsearch_data: CI/CDé›†æˆ 1. GitHub Actionsé…ç½® 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 # .github/workflows/docker.yml name: Docker CI/CD on: push: branches: [main, develop] pull_request: branches: [main] jobs: test: runs-on: ubuntu-latest steps: - uses: actions/checkout@v3 - name: Set up Docker Buildx uses: docker/setup-buildx-action@v2 - name: Test run: | docker-compose -f docker-compose.test.yml up --abort-on-container-exit docker-compose -f docker-compose.test.yml down build: needs: test runs-on: ubuntu-latest if: github.ref == \u0026#39;refs/heads/main\u0026#39; steps: - uses: actions/checkout@v3 - name: Set up Docker Buildx uses: docker/setup-buildx-action@v2 - name: Login to Docker Hub uses: docker/login-action@v2 with: username: ${{ secrets.DOCKER_USERNAME }} password: ${{ secrets.DOCKER_PASSWORD }} - name: Extract metadata id: meta uses: docker/metadata-action@v4 with: images: myorg/myapp tags: | type=ref,event=branch type=ref,event=pr type=sha,prefix={{branch}}- - name: Build and push uses: docker/build-push-action@v4 with: context: . file: ./Dockerfile push: true tags: ${{ steps.meta.outputs.tags }} labels: ${{ steps.meta.outputs.labels }} cache-from: type=gha cache-to: type=gha,mode=max deploy: needs: build runs-on: ubuntu-latest if: github.ref == \u0026#39;refs/heads/main\u0026#39; steps: - name: Deploy to production uses: appleboy/ssh-action@v0.1.5 with: host: ${{ secrets.HOST }} username: ${{ secrets.USERNAME }} key: ${{ secrets.SSH_KEY }} script: | cd /opt/myapp docker-compose pull docker-compose up -d docker system prune -f 2. GitLab CIé…ç½® 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 # .gitlab-ci.yml stages: - test - build - deploy variables: DOCKER_REGISTRY: registry.gitlab.com IMAGE_NAME: $CI_REGISTRY_IMAGE:$CI_COMMIT_SHA test: stage: test script: - docker-compose -f docker-compose.test.yml up --abort-on-container-exit - docker-compose -f docker-compose.test.yml down build: stage: build script: - docker login -u $CI_REGISTRY_USER -p $CI_REGISTRY_PASSWORD $CI_REGISTRY - docker build -t $IMAGE_NAME . - docker push $IMAGE_NAME only: - main - develop deploy_staging: stage: deploy script: - docker login -u $CI_REGISTRY_USER -p $CI_REGISTRY_PASSWORD $CI_REGISTRY - docker-compose -f docker-compose.staging.yml pull - docker-compose -f docker-compose.staging.yml up -d environment: name: staging only: - develop deploy_production: stage: deploy script: - docker login -u $CI_REGISTRY_USER -p $CI_REGISTRY_PASSWORD $CI_REGISTRY - docker-compose -f docker-compose.prod.yml pull - docker-compose -f docker-compose.prod.yml up -d environment: name: production only: - main when: manual å®‰å…¨æœ€ä½³å®è·µ 1. å®¹å™¨å®‰å…¨æ‰«æ 1 2 3 4 5 6 7 8 9 # ä½¿ç”¨Trivyæ‰«æé•œåƒæ¼æ´ trivy image myapp:latest # é›†æˆåˆ°CI/CDä¸­ docker run --rm -v /var/run/docker.sock:/var/run/docker.sock \\ aquasec/trivy image --exit-code 0 --severity HIGH,CRITICAL myapp:latest # Docker Scoutï¼ˆDocker Hubï¼‰ docker scout cves myapp:latest 2. å®‰å…¨é…ç½® 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 # docker-compose.security.yml version: \u0026#39;3.8\u0026#39; services: web: image: myapp:latest security_opt: - no-new-privileges:true read_only: true tmpfs: - /tmp - /var/cache user: \u0026#34;1001:1001\u0026#34; cap_drop: - ALL cap_add: - CHOWN - SETGID - SETUID healthcheck: test: [\u0026#34;CMD\u0026#34;, \u0026#34;curl\u0026#34;, \u0026#34;-f\u0026#34;, \u0026#34;http://localhost:3000/health\u0026#34;] interval: 30s timeout: 10s retries: 3 start_period: 40s 3. ç½‘ç»œå®‰å…¨ 1 2 3 4 5 6 7 8 9 # åˆ›å»ºè‡ªå®šä¹‰ç½‘ç»œ docker network create --driver bridge --subnet=192.168.0.0/24 app-network # é™åˆ¶å®¹å™¨é€šä¿¡ docker run --network=app-network --ip=192.168.0.10 myapp # é˜²ç«å¢™è§„åˆ™ iptables -A INPUT -p tcp --dport 2376 -j DROP iptables -A INPUT -s 192.168.0.0/24 -p tcp --dport 2376 -j ACCEPT æ€§èƒ½ä¼˜åŒ– 1. æ„å»ºæ€§èƒ½ä¼˜åŒ– 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 # ä½¿ç”¨BuildKitä¼˜åŒ–æ„å»º # .docker/config.json { \u0026#34;experimental\u0026#34;: \u0026#34;enabled\u0026#34;, \u0026#34;features\u0026#34;: { \u0026#34;buildkit\u0026#34;: true } } # ä½¿ç”¨ç¼“å­˜æŒ‚è½½ FROM node:18-alpine RUN --mount=type=cache,target=/root/.npm \\ npm ci --only=production # å¹¶è¡Œæ„å»º FROM node:18-alpine AS deps COPY package*.json ./ RUN npm ci FROM node:18-alpine AS builder COPY --from=deps /app/node_modules ./node_modules COPY . . RUN npm run build FROM node:18-alpine AS runtime COPY --from=builder /app/dist ./dist COPY --from=deps /app/node_modules ./node_modules 2. è¿è¡Œæ—¶æ€§èƒ½ä¼˜åŒ– 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 # docker-compose.optimized.yml version: \u0026#39;3.8\u0026#39; services: web: image: myapp:latest deploy: resources: limits: cpus: \u0026#39;1.0\u0026#39; memory: 1G reservations: cpus: \u0026#39;0.5\u0026#39; memory: 512M ulimits: nofile: soft: 65536 hard: 65536 sysctls: - net.core.somaxconn=65535 healthcheck: test: [\u0026#34;CMD\u0026#34;, \u0026#34;node\u0026#34;, \u0026#34;healthcheck.js\u0026#34;] interval: 30s timeout: 10s retries: 3 start_period: 40s æ•…éšœæ’é™¤æŒ‡å— 1. å¸¸è§é—®é¢˜è§£å†³ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 # å®¹å™¨æ— æ³•å¯åŠ¨ docker logs container_id # æŸ¥çœ‹æ—¥å¿— docker inspect container_id # æ£€æŸ¥é…ç½® docker exec -it container_id bash # è¿›å…¥å®¹å™¨è°ƒè¯• # å†…å­˜é—®é¢˜ docker stats # æŸ¥çœ‹èµ„æºä½¿ç”¨ docker system df # æŸ¥çœ‹ç£ç›˜ä½¿ç”¨ docker system prune -a # æ¸…ç†æ— ç”¨èµ„æº # ç½‘ç»œé—®é¢˜ docker network ls # æŸ¥çœ‹ç½‘ç»œ docker network inspect network_id # æ£€æŸ¥ç½‘ç»œé…ç½® docker exec container_id ping service_name # æµ‹è¯•è¿é€šæ€§ 2. æ€§èƒ½è°ƒè¯• 1 2 3 4 5 6 7 8 9 10 11 # å®¹å™¨æ€§èƒ½åˆ†æ docker run --rm --pid=host \\ --cap-add=SYS_PTRACE \\ --security-opt=apparmor:unconfined \\ nicolaka/netshoot \\ ss -tuln # æŸ¥çœ‹ç½‘ç»œè¿æ¥ docker run --rm --pid=host \\ --cap-add=SYS_PTRACE \\ brendangregg/flamegraph:latest \\ perf record -p $(pgrep node) -g -- sleep 30 æ€»ç»“ Dockerå®¹å™¨åŒ–éƒ¨ç½²æä¾›äº†å¼ºå¤§çš„åº”ç”¨éš”ç¦»å’Œéƒ¨ç½²èƒ½åŠ›ã€‚é€šè¿‡æŒæ¡æœ¬æ–‡ä»‹ç»çš„æŠ€æœ¯ï¼Œä½ å¯ä»¥ï¼š\næ„å»ºä¼˜åŒ–çš„Dockeré•œåƒï¼šå¤šé˜¶æ®µæ„å»ºã€å®‰å…¨åŠ å›ºã€å¤§å°ä¼˜åŒ– ç®¡ç†å¤æ‚åº”ç”¨ï¼šDocker Composeã€Kubernetesç¼–æ’ å®ç°ç›‘æ§å‘Šè­¦ï¼šPrometheusã€Grafanaã€ELK Stack è‡ªåŠ¨åŒ–éƒ¨ç½²ï¼šCI/CDæµæ°´çº¿é›†æˆ ä¿éšœç³»ç»Ÿå®‰å…¨ï¼šé•œåƒæ‰«æã€è¿è¡Œæ—¶å®‰å…¨ã€ç½‘ç»œå®‰å…¨ ä¼˜åŒ–æ€§èƒ½ï¼šæ„å»ºä¼˜åŒ–ã€èµ„æºé™åˆ¶ã€æ€§èƒ½è°ƒä¼˜ è®°ä½ï¼Œå®¹å™¨åŒ–ä¸ä»…ä»…æ˜¯æ‰“åŒ…åº”ç”¨ï¼Œæ›´æ˜¯æ„å»ºç°ä»£åŒ–ã€å¯æ‰©å±•åº”ç”¨æ¶æ„çš„åŸºç¡€ã€‚æŒç»­å­¦ä¹ å’Œå®è·µè¿™äº›æŠ€æœ¯ï¼Œå°†å¸®åŠ©ä½ æ„å»ºæ›´åŠ å¥å£®å’Œé«˜æ•ˆçš„åº”ç”¨ç³»ç»Ÿã€‚\n","permalink":"/blog/articles/docker-deployment-guide/","summary":"å…¨é¢ä»‹ç»Dockerå®¹å™¨åŒ–æŠ€æœ¯ï¼ŒåŒ…æ‹¬åŸºç¡€æ¦‚å¿µã€é•œåƒæ„å»ºã€å®¹å™¨ç¼–æ’ã€ç›‘æ§æ—¥å¿—ã€å®‰å…¨é…ç½®ç­‰ï¼Œå¹¶æä¾›ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²çš„æœ€ä½³å®è·µ","title":"Dockerå®¹å™¨åŒ–éƒ¨ç½²å®Œå…¨æŒ‡å—ï¼šä»å…¥é—¨åˆ°ç”Ÿäº§ç¯å¢ƒ"},{"content":"Gitè¿›é˜¶ä½¿ç”¨æŠ€å·§ï¼šä»åŸºç¡€åˆ°é«˜çº§çš„å®æˆ˜æŒ‡å— Gitä½œä¸ºç°ä»£è½¯ä»¶å¼€å‘çš„åŸºçŸ³ï¼ŒæŒæ¡å…¶é«˜çº§ç‰¹æ€§å¯¹äºæå‡å¼€å‘æ•ˆç‡è‡³å…³é‡è¦ã€‚æœ¬æ–‡å°†ä»åŸºç¡€å‘½ä»¤å›é¡¾å¼€å§‹ï¼Œé€æ­¥æ·±å…¥åˆ°Gitçš„é«˜çº§æŠ€å·§å’Œæœ€ä½³å®è·µã€‚\nGitåŸºç¡€å›é¡¾ 1. æ ¸å¿ƒæ¦‚å¿µ 1 2 3 4 5 6 7 8 9 10 11 12 13 # åŸºæœ¬å·¥ä½œæµç¨‹ git init # åˆå§‹åŒ–ä»“åº“ git add . # æš‚å­˜æ‰€æœ‰æ›´æ”¹ git commit -m \u0026#34;message\u0026#34; # æäº¤æ›´æ”¹ git push origin main # æ¨é€åˆ°è¿œç¨‹ git pull origin main # æ‹‰å–è¿œç¨‹æ›´æ”¹ # åŸºæœ¬åˆ†æ”¯æ“ä½œ git branch feature-x # åˆ›å»ºåˆ†æ”¯ git checkout feature-x # åˆ‡æ¢åˆ†æ”¯ git checkout -b feature-y # åˆ›å»ºå¹¶åˆ‡æ¢åˆ†æ”¯ git branch -d feature-x # åˆ é™¤æœ¬åœ°åˆ†æ”¯ git push origin --delete feature-x # åˆ é™¤è¿œç¨‹åˆ†æ”¯ 2. æŸ¥çœ‹å’Œæ¯”è¾ƒ 1 2 3 4 5 6 7 8 9 10 11 # æŸ¥çœ‹æäº¤å†å² git log --oneline --graph --all # å›¾å½¢åŒ–æŸ¥çœ‹æ‰€æœ‰åˆ†æ”¯ git log --since=\u0026#34;2 weeks ago\u0026#34; # æŸ¥çœ‹æœ€è¿‘ä¸¤å‘¨çš„æäº¤ git log --author=\u0026#34;John\u0026#34; # æŸ¥çœ‹ç‰¹å®šä½œè€…çš„æäº¤ git log --grep=\u0026#34;fix\u0026#34; # æœç´¢åŒ…å«ç‰¹å®šä¿¡æ¯çš„æäº¤ # æŸ¥çœ‹å·®å¼‚ git diff # æŸ¥çœ‹å·¥ä½œåŒºå’Œæš‚å­˜åŒºçš„å·®å¼‚ git diff --cached # æŸ¥çœ‹æš‚å­˜åŒºå’Œæœ€æ–°æäº¤çš„å·®å¼‚ git diff HEAD~1 HEAD # æŸ¥çœ‹æœ€æ–°ä¸¤ä¸ªæäº¤çš„å·®å¼‚ git diff branch1..branch2 # æ¯”è¾ƒä¸¤ä¸ªåˆ†æ”¯çš„å·®å¼‚ åˆ†æ”¯ç®¡ç†ç­–ç•¥ 1. Git Flowå·¥ä½œæµ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 # ä¸»åˆ†æ”¯ main # ç”Ÿäº§ç¯å¢ƒä»£ç  develop # å¼€å‘ç¯å¢ƒä»£ç  # è¾…åŠ©åˆ†æ”¯ feature/* # åŠŸèƒ½å¼€å‘åˆ†æ”¯ release/* # å‘å¸ƒå‡†å¤‡åˆ†æ”¯ hotfix/* # ç´§æ€¥ä¿®å¤åˆ†æ”¯ # Git Flowç¤ºä¾‹ git checkout develop git checkout -b feature/user-authentication # å¼€å‘å®Œæˆå git checkout develop git merge --no-ff feature/user-authentication git branch -d feature/user-authentication # å‘å¸ƒç‰ˆæœ¬ git checkout develop git checkout -b release/v1.0.0 # å‘å¸ƒååˆå¹¶åˆ°mainå’Œdevelop git checkout main git merge --no-ff release/v1.0.0 git tag -a v1.0.0 -m \u0026#34;Release version 1.0.0\u0026#34; git checkout develop git merge --no-ff release/v1.0.0 2. GitHub Flowå·¥ä½œæµ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 # ç®€åŒ–çš„å·¥ä½œæµç¨‹ï¼Œé€‚åˆæŒç»­éƒ¨ç½² git checkout main git pull origin main git checkout -b feature/new-feature # å¼€å‘å¹¶æäº¤ git add . git commit -m \u0026#34;Add new feature\u0026#34; # æ¨é€å¹¶åˆ›å»ºPull Request git push origin feature/new-feature # å®¡æ ¸é€šè¿‡ååˆå¹¶åˆ°main git checkout main git pull origin main git branch -d feature/new-feature 3. GitLab Flowå·¥ä½œæµ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 # ç¯å¢ƒåˆ†æ”¯ main # ç”Ÿäº§ç¯å¢ƒ staging # é¢„å‘å¸ƒç¯å¢ƒ development # å¼€å‘ç¯å¢ƒ # åŠŸèƒ½åˆ†æ”¯ git checkout development git checkout -b feature/advanced-search # åˆå¹¶åˆ°å¼€å‘ç¯å¢ƒ git checkout development git merge --no-ff feature/advanced-search # éƒ¨ç½²åˆ°é¢„å‘å¸ƒç¯å¢ƒ git checkout staging git merge --no-ff development # éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ git checkout main git merge --no-ff staging é«˜çº§åˆå¹¶æŠ€å·§ 1. å˜åŸºï¼ˆRebaseï¼‰ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 # åŸºæœ¬å˜åŸº git checkout feature-branch git rebase main # å°†feature-branchåŸºäºæœ€æ–°çš„main # äº¤äº’å¼å˜åŸº git rebase -i HEAD~3 # äº¤äº’å¼ä¿®æ”¹æœ€è¿‘3ä¸ªæäº¤ # å˜åŸºè¿‡ç¨‹ä¸­å¯ä»¥ï¼š # pick: ä¿ç•™æäº¤ # reword: ä¿®æ”¹æäº¤ä¿¡æ¯ # edit: ä¿®æ”¹æäº¤å†…å®¹ # squash: åˆå¹¶æäº¤ # fixup: ç±»ä¼¼squashä½†ä¸¢å¼ƒæäº¤ä¿¡æ¯ # drop: åˆ é™¤æäº¤ # ç¤ºä¾‹ï¼šåˆå¹¶å¤šä¸ªæäº¤ pick 1a2b3c4 Add feature A pick 5d6e7f8 Fix bug in A pick 9a0b1c2 Add tests for A # æ”¹ä¸ºï¼š pick 1a2b3c4 Add feature A fixup 5d6e7f8 Fix bug in A squash 9a0b1c2 Add tests for A 2. Cherry-pick 1 2 3 4 5 6 7 8 9 10 11 12 # é€‰æ‹©ç‰¹å®šæäº¤ git checkout feature-branch git cherry-pick 1a2b3c4 # å°†æäº¤1a2b3c4åº”ç”¨åˆ°å½“å‰åˆ†æ”¯ # é€‰æ‹©å¤šä¸ªæäº¤ git cherry-pick 1a2b3c4^..5d6e7f8 # åº”ç”¨ä»1a2b3c4çš„çˆ¶æäº¤åˆ°5d6e7f8 # ä¸æäº¤åªæš‚å­˜ git cherry-pick --no-commit 1a2b3c4 # è§£å†³å†²çªåç»§ç»­ git cherry-pick --continue 3. åˆå¹¶ç­–ç•¥é€‰æ‹© 1 2 3 4 5 6 7 8 9 10 11 12 13 # å¿«è¿›åˆå¹¶ï¼ˆFast-forwardï¼‰ git merge feature-branch # é»˜è®¤ç­–ç•¥ # éå¿«è¿›åˆå¹¶ï¼ˆä¿ç•™åˆ†æ”¯å†å²ï¼‰ git merge --no-ff feature-branch # ä¿ç•™featureåˆ†æ”¯å†å² # å‹ç¼©åˆå¹¶ï¼ˆSquashï¼‰ git merge --squash feature-branch # å°†å¤šä¸ªæäº¤å‹ç¼©ä¸ºä¸€ä¸ª # ç­–ç•¥é€‰æ‹©æŒ‡å—ï¼š # - featureåˆ†æ”¯ä½¿ç”¨--no-ffä¿ç•™å†å² # - bugä¿®å¤ä½¿ç”¨é»˜è®¤fast-forward # - å°åŠŸèƒ½å¯ä»¥ä½¿ç”¨squashåˆå¹¶ å†²çªè§£å†³æŠ€å·§ 1. å†²çªè¯†åˆ«å’Œè§£å†³ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 # æŸ¥çœ‹å†²çªæ–‡ä»¶ git status # æ˜¾ç¤ºå†²çªæ–‡ä»¶ git diff # æ˜¾ç¤ºå…·ä½“å†²çª # æ‰‹åŠ¨è§£å†³å†²çªæ ‡è®° \u0026lt;\u0026lt;\u0026lt;\u0026lt;\u0026lt;\u0026lt;\u0026lt; HEAD // å½“å‰åˆ†æ”¯çš„å†…å®¹ ======= // åˆå¹¶åˆ†æ”¯çš„å†…å®¹ \u0026gt;\u0026gt;\u0026gt;\u0026gt;\u0026gt;\u0026gt;\u0026gt; feature-branch # è§£å†³åæ ‡è®°ä¸ºå·²è§£å†³ git add conflicted-file.txt git commit 2. é«˜çº§å†²çªè§£å†³å·¥å…· 1 2 3 4 5 6 7 8 9 10 # ä½¿ç”¨åˆå¹¶å·¥å…· git mergetool # å¯åŠ¨å›¾å½¢åŒ–åˆå¹¶å·¥å…· # é…ç½®åˆå¹¶å·¥å…· git config --global merge.tool vscode git config --global mergetool.vscode.cmd \u0026#39;code --wait $MERGED\u0026#39; # ä¸‰æ–¹åˆå¹¶ git checkout --conflict=merge file.txt # æ˜¾ç¤ºä¸‰æ–¹ç‰ˆæœ¬ git checkout --conflict=diff3 file.txt # æ˜¾ç¤ºå…±åŒç¥–å…ˆ 3. é¢„é˜²å†²çªçš„æœ€ä½³å®è·µ 1 2 3 4 5 6 7 8 9 10 11 12 13 # é¢‘ç¹åŒæ­¥ä¸»åˆ†æ”¯ git checkout feature-branch git fetch origin git rebase origin/main # å°æ­¥æäº¤ï¼Œé¿å…å¤§å—ä»£ç  git add file1.js git commit -m \u0026#34;Add function A\u0026#34; git add file2.js git commit -m \u0026#34;Add function B\u0026#34; # ä»£ç å®¡æŸ¥åŠæ—¶å‘ç°å†²çª git pull-request # GitHub/GitLab PR Gitå†å²ç®¡ç† 1. æäº¤ä¿¡æ¯è§„èŒƒ 1 2 3 4 5 6 7 8 9 10 11 12 # Conventional Commitsè§„èŒƒ feat: add user authentication fix: resolve login bug docs: update API documentation style: format code refactor: simplify user service test: add unit tests for auth chore: update dependencies # ç¤ºä¾‹ git commit -m \u0026#34;feat(auth): add JWT token validation\u0026#34; git commit -m \u0026#34;fix(api): handle null response in user endpoint\u0026#34; 2. å†å²æŸ¥è¯¢å’Œåˆ†æ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 # æŸ¥çœ‹ç‰¹å®šæ–‡ä»¶çš„ä¿®æ”¹å†å² git log --follow file.txt # è·Ÿè¸ªæ–‡ä»¶é‡å‘½å git log -p file.txt # æ˜¾ç¤ºå…·ä½“ä¿®æ”¹å†…å®¹ git log --stat file.txt # æ˜¾ç¤ºä¿®æ”¹ç»Ÿè®¡ # æŸ¥æ‰¾å¼•å…¥é—®é¢˜çš„æäº¤ git bisect start # å¼€å§‹äºŒåˆ†æŸ¥æ‰¾ git bisect bad # æ ‡è®°å½“å‰ç‰ˆæœ¬æœ‰é—®é¢˜ git bisect good v1.0.0 # æ ‡è®°v1.0.0ç‰ˆæœ¬æ­£å¸¸ git bisect run npm test # è‡ªåŠ¨æµ‹è¯•æ‰¾åˆ°é—®é¢˜æäº¤ # æŸ¥æ‰¾ç‰¹å®šä»£ç çš„æäº¤ git log -S \u0026#34;function_name\u0026#34; # æŸ¥æ‰¾æ·»åŠ /åˆ é™¤è¯¥ä»£ç çš„æäº¤ git log -G \u0026#34;regex_pattern\u0026#34; # ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼æœç´¢ 3. å†å²ä¿®æ”¹å’Œæ¸…ç† 1 2 3 4 5 6 7 8 9 10 11 12 # ä¿®æ”¹æœ€åä¸€æ¬¡æäº¤ git commit --amend # ä¿®æ”¹æäº¤ä¿¡æ¯æˆ–å†…å®¹ git commit --amend --no-edit # åªä¿®æ”¹å†…å®¹ä¸ä¿®æ”¹ä¿¡æ¯ # æ‰¹é‡ä¿®æ”¹æäº¤ä¿¡æ¯ git rebase -i HEAD~3 # é€‰æ‹©rewordä¿®æ”¹æäº¤ä¿¡æ¯ # åˆ é™¤æ•æ„Ÿä¿¡æ¯ git filter-branch --tree-filter \u0026#39;rm -f passwords.txt\u0026#39; -- --all # æˆ–ä½¿ç”¨æ›´å®‰å…¨çš„filter-repo git filter-repo --invert-paths --path passwords.txt Gitæ€§èƒ½ä¼˜åŒ– 1. ä»“åº“ä¼˜åŒ– 1 2 3 4 5 6 7 8 9 10 # åƒåœ¾å›æ”¶ git gc --aggressive # æ¿€è¿›çš„åƒåœ¾å›æ”¶ git gc --prune=now # ç«‹å³æ¸…ç†æ— ç”¨æ–‡ä»¶ # å‹ç¼©å†å² git repack -a -d --depth=250 --window=250 # æ£€æŸ¥ä»“åº“å¥åº· git fsck # æ£€æŸ¥å¯¹è±¡å®Œæ•´æ€§ git count-objects -vH # ç»Ÿè®¡å¯¹è±¡ä¿¡æ¯ 2. å¤§æ–‡ä»¶å¤„ç† 1 2 3 4 5 6 7 8 9 10 11 12 # Git LFSï¼ˆLarge File Storageï¼‰ git lfs track \u0026#34;*.psd\u0026#34; # è·Ÿè¸ªPSDæ–‡ä»¶ git lfs track \u0026#34;*.zip\u0026#34; git add .gitattributes git add file.psd git commit -m \u0026#34;Add large file with LFS\u0026#34; # æŸ¥æ‰¾å¤§æ–‡ä»¶ git rev-list --objects --all | git cat-file --batch-check=\u0026#39;%(objecttype) %(objectname) %(objectsize) %(rest)\u0026#39; | sed -n \u0026#39;s/^blob //p\u0026#39; | sort --numeric-sort --key=2 | tail -10 # ç§»é™¤å¤§æ–‡ä»¶å†å² git filter-branch --tree-filter \u0026#39;rm -rf large_file.zip\u0026#39; --prune-empty HEAD 3. ç½‘ç»œä¼˜åŒ– 1 2 3 4 5 6 7 8 9 10 11 # æµ…å…‹éš† git clone --depth 1 repo_url # åªå…‹éš†æœ€æ–°æäº¤ git clone --depth 10 repo_url # å…‹éš†æœ€è¿‘10ä¸ªæäº¤ # å•åˆ†æ”¯å…‹éš† git clone --single-branch repo_url git clone --branch main --single-branch repo_url # ä¼˜åŒ–æ‹‰å– git fetch --depth=1 # æµ…æ‹‰å– git fetch --prune # åˆ é™¤è¿œç¨‹ä¸å­˜åœ¨çš„åˆ†æ”¯å¼•ç”¨ Gité’©å­è‡ªåŠ¨åŒ– 1. å®¢æˆ·ç«¯é’©å­ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 # é¢„æäº¤é’©å­ï¼ˆpre-commitï¼‰ #!/bin/sh # .git/hooks/pre-commit # è¿è¡Œä»£ç æ ¼å¼æ£€æŸ¥ npm run lint if [ $? -ne 0 ]; then echo \u0026#34;ä»£ç æ ¼å¼æ£€æŸ¥å¤±è´¥ï¼Œè¯·ä¿®å¤åå†æäº¤\u0026#34; exit 1 fi # è¿è¡Œæµ‹è¯• npm run test if [ $? -ne 0 ]; then echo \u0026#34;æµ‹è¯•å¤±è´¥ï¼Œè¯·ä¿®å¤åå†æäº¤\u0026#34; exit 1 fi exit 0 1 2 3 4 5 6 7 8 9 10 11 12 13 # æäº¤ä¿¡æ¯é’©å­ï¼ˆcommit-msgï¼‰ #!/bin/sh # .git/hooks/commit-msg commit_regex=\u0026#39;^(feat|fix|docs|style|refactor|test|chore)(\\(.+\\))?: .{1,50}\u0026#39; if ! grep -qE \u0026#34;$commit_regex\u0026#34; \u0026#34;$1\u0026#34;; then echo \u0026#34;æäº¤ä¿¡æ¯æ ¼å¼ä¸æ­£ç¡®ï¼Œè¯·éµå¾ªConventional Commitsè§„èŒƒ\u0026#34; echo \u0026#34;æ ¼å¼: type(scope): description\u0026#34; exit 1 fi exit 0 2. æœåŠ¡ç«¯é’©å­ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 # é¢„æ¥æ”¶é’©å­ï¼ˆpre-receiveï¼‰ #!/bin/sh # /srv/git/repo.git/hooks/pre-receive while read oldrev newrev refname; do # æ£€æŸ¥åˆ†æ”¯å if echo \u0026#34;$refname\u0026#34; | grep -q \u0026#34;^refs/heads/delete-\u0026#34;; then echo \u0026#34;ä¸å…è®¸ä»¥\u0026#39;delete-\u0026#39;å¼€å¤´çš„åˆ†æ”¯å\u0026#34; exit 1 fi # æ£€æŸ¥æäº¤ä¿¡æ¯æ ¼å¼ commits=$(git rev-list $oldrev..$newrev) for commit in $commits; do message=$(git log --format=%B -n 1 $commit) if ! echo \u0026#34;$message\u0026#34; | grep -qE \u0026#34;^(feat|fix|docs|style|refactor|test|chore)\u0026#34;; then echo \u0026#34;æäº¤ $commit çš„ä¿¡æ¯æ ¼å¼ä¸æ­£ç¡®\u0026#34; exit 1 fi done done exit 0 3. ä½¿ç”¨Huskyç®¡ç†é’©å­ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 // package.json { \u0026#34;husky\u0026#34;: { \u0026#34;hooks\u0026#34;: { \u0026#34;pre-commit\u0026#34;: \u0026#34;lint-staged \u0026amp;\u0026amp; npm run test\u0026#34;, \u0026#34;commit-msg\u0026#34;: \u0026#34;commitlint -E HUSKY_GIT_PARAMS\u0026#34;, \u0026#34;pre-push\u0026#34;: \u0026#34;npm run build\u0026#34; } }, \u0026#34;lint-staged\u0026#34;: { \u0026#34;*.{js,jsx}\u0026#34;: [ \u0026#34;eslint --fix\u0026#34;, \u0026#34;prettier --write\u0026#34;, \u0026#34;git add\u0026#34; ] } } Gitå·¥ä½œæµè‡ªåŠ¨åŒ– 1. Gitåˆ«åé…ç½® 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 # å¸¸ç”¨åˆ«å git config --global alias.co checkout git config --global alias.br branch git config --global alias.cm commit git config --global alias.st status git config --global alias.unstage \u0026#39;reset HEAD --\u0026#39; git config --global alias.last \u0026#39;log -1 HEAD\u0026#39; git config --global alias.visual \u0026#39;!gitk\u0026#39; git config --global alias.graph \u0026#39;log --oneline --graph --decorate --all\u0026#39; # é«˜çº§åˆ«å git config --global alias.amend \u0026#39;commit --amend --no-edit\u0026#39; git config --global alias.undo \u0026#39;reset --soft HEAD~1\u0026#39; git config --global alias.hist \u0026#39;log --pretty=format:\u0026#34;%h %ad | %s%d [%an]\u0026#34; --graph --date=short\u0026#39; git config --global alias.ls \u0026#39;log --pretty=format:\u0026#34;%C(yellow)%h%Cred%d\\\\ %Creset%s%Cblue\\\\ [%cn]\u0026#34; --decorate\u0026#39; 2. è‡ªå®šä¹‰Gitå‘½ä»¤ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 # åˆ›å»ºè‡ªå®šä¹‰è„šæœ¬ #!/bin/bash # git-feature if [ $# -eq 0 ]; then echo \u0026#34;Usage: git feature \u0026lt;feature-name\u0026gt;\u0026#34; exit 1 fi feature_name=$1 git checkout develop git pull origin develop git checkout -b \u0026#34;feature/$feature_name\u0026#34; echo \u0026#34;Created feature branch: feature/$feature_name\u0026#34; 1 2 3 4 # æ·»åŠ åˆ°PATHå¹¶è®¾ç½®ä¸ºGitå‘½ä»¤ chmod +x git-feature sudo mv git-feature /usr/local/bin/ git feature --help 3. å¤šä»“åº“ç®¡ç† 1 2 3 4 5 6 7 8 9 10 # Gitå­æ¨¡å— git submodule add https://github.com/user/repo.git libs/repo git submodule update --init --recursive git submodule foreach git pull origin main # Gitå·¥ä½œæ ‘ git worktree add ../feature-branch feature-branch git worktree add ../hotfix-branch hotfix-branch git worktree list git worktree remove ../feature-branch Gitå®‰å…¨æœ€ä½³å®è·µ 1. æ•æ„Ÿä¿¡æ¯ä¿æŠ¤ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 # å¿½ç•¥æ•æ„Ÿæ–‡ä»¶ echo \u0026#34;.env\u0026#34; \u0026gt;\u0026gt; .gitignore echo \u0026#34;config/production.json\u0026#34; \u0026gt;\u0026gt; .gitignore echo \u0026#34;*.pem\u0026#34; \u0026gt;\u0026gt; .gitignore # æ£€æŸ¥æ˜¯å¦æœ‰æ•æ„Ÿä¿¡æ¯å·²æäº¤ git log --all --full-history -- **/passwords.txt git log --all --full-history -- **/*.pem git log -p | grep -i password # ä½¿ç”¨git-secretså·¥å…· git secrets --register-aws git secrets --install git secrets --scan 2. ç­¾åéªŒè¯ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 # é…ç½®GPGç­¾å git config --global user.signingkey YOUR_GPG_KEY_ID git config --global commit.gpgsign true git config --global tag.gpgsign true # ç­¾åæäº¤ git commit -S -m \u0026#34;Signed commit\u0026#34; # ç­¾åæ ‡ç­¾ git tag -s v1.0.0 -m \u0026#34;Signed tag\u0026#34; # éªŒè¯ç­¾å git verify-commit HEAD git verify-tag v1.0.0 3. è®¿é—®æ§åˆ¶ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 # SSHå¯†é’¥ç®¡ç† ssh-keygen -t ed25519 -C \u0026#34;your_email@example.com\u0026#34; eval \u0026#34;$(ssh-agent -s)\u0026#34; ssh-add ~/.ssh/id_ed25519 # å¤šè´¦æˆ·é…ç½® ~/.ssh/config: Host github.com HostName github.com User git IdentityFile ~/.ssh/id_ed25519_work Host github-personal HostName github.com User git IdentityFile ~/.ssh/id_ed25519_personal Gitæ•…éšœæ’é™¤ 1. å¸¸è§é—®é¢˜è§£å†³ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 # æ’¤é”€æ“ä½œ git reset --soft HEAD~1 # æ’¤é”€æœ€åä¸€æ¬¡æäº¤ï¼Œä¿ç•™æ›´æ”¹ git reset --hard HEAD~1 # æ’¤é”€æœ€åä¸€æ¬¡æäº¤ï¼Œä¸¢å¼ƒæ›´æ”¹ git revert HEAD # åˆ›å»ºæ–°æäº¤æ’¤é”€ä¹‹å‰çš„æ›´æ”¹ # æ¢å¤åˆ é™¤çš„æ–‡ä»¶ git checkout HEAD -- file.txt git restore file.txt # æ‰¾å›ä¸¢å¤±çš„æäº¤ git reflog # æŸ¥çœ‹æ‰€æœ‰æ“ä½œè®°å½• git checkout 1a2b3c4 # æ¢å¤åˆ°æŒ‡å®šæäº¤ # è§£å†³ detached HEAD git checkout main git branch temp-branch 1a2b3c4 git checkout temp-branch 2. ä»“åº“ä¿®å¤ 1 2 3 4 5 6 7 8 9 10 # ä¿®å¤æŸåçš„ä»“åº“ git fsck --full # å®Œæ•´æ£€æŸ¥ git fsck --lost-found # æŸ¥æ‰¾ä¸¢å¤±çš„å¯¹è±¡ # é‡å»ºç´¢å¼• git reset # é‡ç½®ç´¢å¼• git checkout HEAD -- . # æ¢å¤æ‰€æœ‰æ–‡ä»¶ # æ¸…ç†æ— æ•ˆå¼•ç”¨ git remote prune origin # æ¸…ç†æ— æ•ˆçš„è¿œç¨‹åˆ†æ”¯å¼•ç”¨ æ€»ç»“ Gitçš„å¼ºå¤§åŠŸèƒ½è¿œä¸æ­¢äºåŸºç¡€çš„æäº¤å’Œæ¨é€ã€‚é€šè¿‡æŒæ¡è¿™äº›é«˜çº§æŠ€å·§ï¼Œä½ å¯ä»¥ï¼š\næå‡å›¢é˜Ÿåä½œæ•ˆç‡ï¼šåˆç†ä½¿ç”¨åˆ†æ”¯ç®¡ç†ç­–ç•¥ ä¿æŒä»£ç è´¨é‡ï¼šåˆ©ç”¨é’©å­è‡ªåŠ¨åŒ–ä»£ç æ£€æŸ¥ ä¼˜åŒ–æ€§èƒ½ï¼šå¤„ç†å¤§æ–‡ä»¶å’Œä¼˜åŒ–ä»“åº“å¤§å° å¢å¼ºå®‰å…¨æ€§ï¼šä¿æŠ¤æ•æ„Ÿä¿¡æ¯å’ŒéªŒè¯æäº¤ æé«˜å·¥ä½œæ•ˆç‡ï¼šä½¿ç”¨åˆ«åå’Œè‡ªåŠ¨åŒ–è„šæœ¬ è®°ä½ï¼ŒGitæ˜¯ä¸€ä¸ªå¤æ‚çš„å·¥å…·ï¼Œéœ€è¦ä¸æ–­å®è·µå’Œæ¢ç´¢ã€‚å°†è¿™äº›æŠ€å·§åº”ç”¨åˆ°å®é™…é¡¹ç›®ä¸­ï¼Œä½ ä¼šå‘ç°è‡ªå·±çš„å¼€å‘æ•ˆç‡å’Œè´¨é‡éƒ½å¾—åˆ°äº†æ˜¾è‘—æå‡ã€‚\n","permalink":"/blog/articles/git-advanced-techniques/","summary":"æ·±å…¥æ¢è®¨Gitçš„é«˜çº§ä½¿ç”¨æŠ€å·§ï¼ŒåŒ…æ‹¬åˆ†æ”¯ç®¡ç†ç­–ç•¥ã€åˆå¹¶å†²çªè§£å†³ã€æ€§èƒ½ä¼˜åŒ–ã€è‡ªåŠ¨åŒ–å·¥ä½œæµç­‰ï¼Œå¸®åŠ©å¼€å‘è€…æå‡Gitä½¿ç”¨æ•ˆç‡","title":"Gitè¿›é˜¶ä½¿ç”¨æŠ€å·§ï¼šä»åŸºç¡€åˆ°é«˜çº§çš„å®æˆ˜æŒ‡å—"},{"content":"RESTful APIè®¾è®¡æœ€ä½³å®è·µï¼šä»è§„èŒƒåˆ°ç”Ÿäº§ç¯å¢ƒçš„å®Œæ•´æŒ‡å— RESTful APIå·²æˆä¸ºç°ä»£Webåº”ç”¨çš„æ ‡å‡†æ¥å£è®¾è®¡è§„èŒƒã€‚ä¸€ä¸ªè®¾è®¡è‰¯å¥½çš„APIä¸ä»…æ˜“äºä½¿ç”¨å’Œç»´æŠ¤ï¼Œè¿˜èƒ½æä¾›ä¼˜ç§€çš„å¼€å‘è€…ä½“éªŒã€‚æœ¬æ–‡å°†æ·±å…¥æ¢è®¨RESTful APIçš„è®¾è®¡åŸåˆ™å’Œæœ€ä½³å®è·µã€‚\nRESTfulè®¾è®¡åŸåˆ™ 1. èµ„æºå¯¼å‘è®¾è®¡ RESTçš„æ ¸å¿ƒæ˜¯èµ„æºï¼Œæ¯ä¸ªèµ„æºéƒ½æœ‰å”¯ä¸€çš„æ ‡è¯†ç¬¦ï¼š\n1 2 3 4 5 6 7 8 9 10 // è‰¯å¥½çš„èµ„æºå‘½å GET /api/users // è·å–ç”¨æˆ·åˆ—è¡¨ GET /api/users/123 // è·å–ç‰¹å®šç”¨æˆ· POST /api/users // åˆ›å»ºæ–°ç”¨æˆ· PUT /api/users/123 // æ›´æ–°ç”¨æˆ· DELETE /api/users/123 // åˆ é™¤ç”¨æˆ· // é¿å…çš„å‘½åæ–¹å¼ GET /api/getAllUsers // ä¸ç¬¦åˆRESTè§„èŒƒ POST /api/user/create // åŠ¨è¯ä¸åº”å‡ºç°åœ¨URLä¸­ åµŒå¥—èµ„æºè®¾è®¡ï¼š\n1 2 3 4 5 6 7 // ç”¨æˆ·ç›¸å…³çš„è®¢å• GET /api/users/123/orders // è·å–ç”¨æˆ·çš„è®¢å• POST /api/users/123/orders // ä¸ºç”¨æˆ·åˆ›å»ºè®¢å• GET /api/users/123/orders/456 // è·å–ç”¨æˆ·çš„ç‰¹å®šè®¢å• // é¿å…è¿‡æ·±çš„åµŒå¥—ï¼ˆä¸è¶…è¿‡3å±‚ï¼‰ GET /api/orders/456 // æ›´ç®€æ´çš„æ–¹å¼ 2. HTTPæ–¹æ³•è¯­ä¹‰ æ­£ç¡®ä½¿ç”¨HTTPæ–¹æ³•æ˜¯RESTful APIçš„åŸºç¡€ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 // GET - å®‰å…¨ä¸”å¹‚ç­‰ï¼Œç”¨äºè·å–èµ„æº GET /api/users GET /api/users/123 // POST - éå¹‚ç­‰ï¼Œç”¨äºåˆ›å»ºèµ„æº POST /api/users { \u0026#34;name\u0026#34;: \u0026#34;John\u0026#34;, \u0026#34;email\u0026#34;: \u0026#34;john@example.com\u0026#34; } // PUT - å¹‚ç­‰ï¼Œç”¨äºå®Œæ•´æ›¿æ¢èµ„æº PUT /api/users/123 { \u0026#34;name\u0026#34;: \u0026#34;John Updated\u0026#34;, \u0026#34;email\u0026#34;: \u0026#34;john.updated@example.com\u0026#34; } // PATCH - å¹‚ç­‰ï¼Œç”¨äºéƒ¨åˆ†æ›´æ–°èµ„æº PATCH /api/users/123 { \u0026#34;name\u0026#34;: \u0026#34;John Updated\u0026#34; } // DELETE - å¹‚ç­‰ï¼Œç”¨äºåˆ é™¤èµ„æº DELETE /api/users/123 URLè®¾è®¡è§„èŒƒ 1. URLç»“æ„è®¾è®¡ 1 2 3 4 5 6 7 8 9 10 // åŸºæœ¬URLç»“æ„ https://api.example.com/v1/users/123/posts/456?include=author\u0026amp;limit=10 // ç‰ˆæœ¬æ§åˆ¶ /api/v1/users // URLç‰ˆæœ¬æ§åˆ¶ï¼ˆæ¨èï¼‰ /api/users // Headerç‰ˆæœ¬æ§åˆ¶ // æŸ¥è¯¢å‚æ•°è®¾è®¡ GET /api/users?page=2\u0026amp;limit=20\u0026amp;sort=created_at:desc GET /api/users?filter[status]=active\u0026amp;fields=id,name,email 2. åˆ†é¡µå’Œè¿‡æ»¤ åˆ†é¡µå®ç°ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 // åŸºäºåç§»é‡çš„åˆ†é¡µ GET /api/users?page=2\u0026amp;limit=20 // åŸºäºæ¸¸æ ‡çš„åˆ†é¡µï¼ˆæ¨èï¼‰ GET /api/users?after=cursor123\u0026amp;limit=20 // å“åº”æ ¼å¼ { \u0026#34;data\u0026#34;: [...], \u0026#34;pagination\u0026#34;: { \u0026#34;total\u0026#34;: 1000, \u0026#34;page\u0026#34;: 2, \u0026#34;limit\u0026#34;: 20, \u0026#34;next_cursor\u0026#34;: \u0026#34;cursor456\u0026#34;, \u0026#34;has_more\u0026#34;: true } } è¿‡æ»¤å’Œæœç´¢ï¼š\n1 2 3 4 5 6 7 8 9 10 11 // åŸºæœ¬è¿‡æ»¤ GET /api/users?status=active\u0026amp;role=admin // æ—¥æœŸèŒƒå›´è¿‡æ»¤ GET /api/posts?created_at[gte]=2023-01-01\u0026amp;created_at[lte]=2023-12-31 // æ–‡æœ¬æœç´¢ GET /api/users?q=john\u0026amp;search_fields=name,email // é«˜çº§è¿‡æ»¤ GET /api/products?filter[price][gt]=100\u0026amp;filter[category]=electronics è¯·æ±‚å’Œå“åº”æ ¼å¼ 1. è¯·æ±‚ä½“æ ¼å¼ JSONæ ¼å¼æ ‡å‡†ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 // åˆ›å»ºèµ„æº POST /api/users Content-Type: application/json { \u0026#34;data\u0026#34;: { \u0026#34;type\u0026#34;: \u0026#34;users\u0026#34;, \u0026#34;attributes\u0026#34;: { \u0026#34;name\u0026#34;: \u0026#34;John Doe\u0026#34;, \u0026#34;email\u0026#34;: \u0026#34;john@example.com\u0026#34;, \u0026#34;age\u0026#34;: 30 }, \u0026#34;relationships\u0026#34;: { \u0026#34;profile\u0026#34;: { \u0026#34;data\u0026#34;: { \u0026#34;type\u0026#34;: \u0026#34;profiles\u0026#34;, \u0026#34;id\u0026#34;: \u0026#34;123\u0026#34; } } } } } // æˆ–è€…æ›´ç®€æ´çš„æ ¼å¼ { \u0026#34;name\u0026#34;: \u0026#34;John Doe\u0026#34;, \u0026#34;email\u0026#34;: \u0026#34;john@example.com\u0026#34;, \u0026#34;age\u0026#34;: 30, \u0026#34;profile_id\u0026#34;: \u0026#34;123\u0026#34; } æ‰¹é‡æ“ä½œï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 // æ‰¹é‡åˆ›å»º POST /api/users/batch { \u0026#34;users\u0026#34;: [ { \u0026#34;name\u0026#34;: \u0026#34;User1\u0026#34;, \u0026#34;email\u0026#34;: \u0026#34;user1@example.com\u0026#34; }, { \u0026#34;name\u0026#34;: \u0026#34;User2\u0026#34;, \u0026#34;email\u0026#34;: \u0026#34;user2@example.com\u0026#34; } ] } // æ‰¹é‡æ›´æ–° PATCH /api/users/batch { \u0026#34;updates\u0026#34;: [ { \u0026#34;id\u0026#34;: \u0026#34;1\u0026#34;, \u0026#34;email\u0026#34;: \u0026#34;new1@example.com\u0026#34; }, { \u0026#34;id\u0026#34;: \u0026#34;2\u0026#34;, \u0026#34;email\u0026#34;: \u0026#34;new2@example.com\u0026#34; } ] } 2. å“åº”æ ¼å¼æ ‡å‡† æ ‡å‡†å“åº”ç»“æ„ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 // æˆåŠŸå“åº” { \u0026#34;success\u0026#34;: true, \u0026#34;data\u0026#34;: { \u0026#34;id\u0026#34;: \u0026#34;123\u0026#34;, \u0026#34;name\u0026#34;: \u0026#34;John Doe\u0026#34;, \u0026#34;email\u0026#34;: \u0026#34;john@example.com\u0026#34;, \u0026#34;created_at\u0026#34;: \u0026#34;2023-12-17T10:00:00Z\u0026#34;, \u0026#34;updated_at\u0026#34;: \u0026#34;2023-12-17T10:00:00Z\u0026#34; }, \u0026#34;meta\u0026#34;: { \u0026#34;timestamp\u0026#34;: \u0026#34;2023-12-17T10:00:00Z\u0026#34;, \u0026#34;version\u0026#34;: \u0026#34;v1\u0026#34; } } // åˆ—è¡¨å“åº” { \u0026#34;success\u0026#34;: true, \u0026#34;data\u0026#34;: [ { \u0026#34;id\u0026#34;: \u0026#34;1\u0026#34;, \u0026#34;name\u0026#34;: \u0026#34;User1\u0026#34; }, { \u0026#34;id\u0026#34;: \u0026#34;2\u0026#34;, \u0026#34;name\u0026#34;: \u0026#34;User2\u0026#34; } ], \u0026#34;meta\u0026#34;: { \u0026#34;total\u0026#34;: 100, \u0026#34;page\u0026#34;: 1, \u0026#34;limit\u0026#34;: 20 } } é”™è¯¯å“åº”æ ¼å¼ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 // æ ‡å‡†é”™è¯¯å“åº” { \u0026#34;success\u0026#34;: false, \u0026#34;error\u0026#34;: { \u0026#34;code\u0026#34;: \u0026#34;VALIDATION_ERROR\u0026#34;, \u0026#34;message\u0026#34;: \u0026#34;è¯·æ±‚å‚æ•°éªŒè¯å¤±è´¥\u0026#34;, \u0026#34;details\u0026#34;: [ { \u0026#34;field\u0026#34;: \u0026#34;email\u0026#34;, \u0026#34;message\u0026#34;: \u0026#34;é‚®ç®±æ ¼å¼ä¸æ­£ç¡®\u0026#34; }, { \u0026#34;field\u0026#34;: \u0026#34;age\u0026#34;, \u0026#34;message\u0026#34;: \u0026#34;å¹´é¾„å¿…é¡»å¤§äº0\u0026#34; } ] }, \u0026#34;meta\u0026#34;: { \u0026#34;timestamp\u0026#34;: \u0026#34;2023-12-17T10:00:00Z\u0026#34;, \u0026#34;request_id\u0026#34;: \u0026#34;req_123456\u0026#34; } } çŠ¶æ€ç ä½¿ç”¨æŒ‡å— 1. æˆåŠŸçŠ¶æ€ç  1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 // 200 OK - æˆåŠŸè·å–æˆ–æ›´æ–°èµ„æº GET /api/users/123 // è¿”å›ç”¨æˆ·ä¿¡æ¯ PUT /api/users/123 // è¿”å›æ›´æ–°åçš„ç”¨æˆ·ä¿¡æ¯ // 201 Created - æˆåŠŸåˆ›å»ºèµ„æº POST /api/users // è¿”å›æ–°åˆ›å»ºçš„ç”¨æˆ·ä¿¡æ¯ Location: /api/users/456 // 204 No Content - æˆåŠŸåˆ é™¤èµ„æº DELETE /api/users/123 // æ— è¿”å›å†…å®¹ // 202 Accepted - å¼‚æ­¥å¤„ç†ä¸­ POST /api/reports/generate // è¿”å›å¤„ç†çŠ¶æ€ { \u0026#34;message\u0026#34;: \u0026#34;æŠ¥å‘Šç”Ÿæˆä¸­\u0026#34;, \u0026#34;task_id\u0026#34;: \u0026#34;task_123\u0026#34;, \u0026#34;status_url\u0026#34;: \u0026#34;/api/tasks/task_123\u0026#34; } 2. é”™è¯¯çŠ¶æ€ç  1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 // 400 Bad Request - å®¢æˆ·ç«¯è¯·æ±‚é”™è¯¯ { \u0026#34;error\u0026#34;: { \u0026#34;code\u0026#34;: \u0026#34;INVALID_PARAMETER\u0026#34;, \u0026#34;message\u0026#34;: \u0026#34;å‚æ•°pageå¿…é¡»æ˜¯æ­£æ•´æ•°\u0026#34;, \u0026#34;field\u0026#34;: \u0026#34;page\u0026#34; } } // 401 Unauthorized - æœªè®¤è¯ { \u0026#34;error\u0026#34;: { \u0026#34;code\u0026#34;: \u0026#34;UNAUTHORIZED\u0026#34;, \u0026#34;message\u0026#34;: \u0026#34;è¯·å…ˆç™»å½•\u0026#34; } } // 403 Forbidden - æ— æƒé™ { \u0026#34;error\u0026#34;: { \u0026#34;code\u0026#34;: \u0026#34;FORBIDDEN\u0026#34;, \u0026#34;message\u0026#34;: \u0026#34;æ— æƒé™è®¿é—®æ­¤èµ„æº\u0026#34; } } // 404 Not Found - èµ„æºä¸å­˜åœ¨ { \u0026#34;error\u0026#34;: { \u0026#34;code\u0026#34;: \u0026#34;NOT_FOUND\u0026#34;, \u0026#34;message\u0026#34;: \u0026#34;ç”¨æˆ·ä¸å­˜åœ¨\u0026#34; } } // 409 Conflict - èµ„æºå†²çª { \u0026#34;error\u0026#34;: { \u0026#34;code\u0026#34;: \u0026#34;DUPLICATE_EMAIL\u0026#34;, \u0026#34;message\u0026#34;: \u0026#34;é‚®ç®±å·²å­˜åœ¨\u0026#34; } } // 422 Unprocessable Entity - éªŒè¯å¤±è´¥ { \u0026#34;error\u0026#34;: { \u0026#34;code\u0026#34;: \u0026#34;VALIDATION_ERROR\u0026#34;, \u0026#34;message\u0026#34;: \u0026#34;æ•°æ®éªŒè¯å¤±è´¥\u0026#34;, \u0026#34;details\u0026#34;: [ { \u0026#34;field\u0026#34;: \u0026#34;email\u0026#34;, \u0026#34;message\u0026#34;: \u0026#34;é‚®ç®±æ ¼å¼é”™è¯¯\u0026#34; } ] } } // 429 Too Many Requests - è¯·æ±‚è¿‡é¢‘ { \u0026#34;error\u0026#34;: { \u0026#34;code\u0026#34;: \u0026#34;RATE_LIMIT_EXCEEDED\u0026#34;, \u0026#34;message\u0026#34;: \u0026#34;è¯·æ±‚è¿‡äºé¢‘ç¹ï¼Œè¯·ç¨åå†è¯•\u0026#34;, \u0026#34;retry_after\u0026#34;: 60 } } // 500 Internal Server Error - æœåŠ¡å™¨é”™è¯¯ { \u0026#34;error\u0026#34;: { \u0026#34;code\u0026#34;: \u0026#34;INTERNAL_ERROR\u0026#34;, \u0026#34;message\u0026#34;: \u0026#34;æœåŠ¡å™¨å†…éƒ¨é”™è¯¯\u0026#34; } } ç‰ˆæœ¬æ§åˆ¶ç­–ç•¥ 1. URLç‰ˆæœ¬æ§åˆ¶ 1 2 3 4 5 6 7 8 9 10 11 // APIç‰ˆæœ¬1 /api/v1/users /api/v1/posts // APIç‰ˆæœ¬2 /api/v2/users /api/v2/posts // ç‰ˆæœ¬å…¼å®¹å¤„ç† // å‘åå…¼å®¹çš„æ–°å­—æ®µå¯ä»¥åœ¨v1ä¸­æ·»åŠ  // ç ´åæ€§å˜æ›´éœ€è¦å‘å¸ƒv2 2. Headerç‰ˆæœ¬æ§åˆ¶ 1 2 3 4 5 6 7 8 // è¯·æ±‚å¤´æŒ‡å®šç‰ˆæœ¬ GET /api/users Accept: application/vnd.api+json;version=1 API-Version: v1 // æˆ–è€…è‡ªå®šä¹‰å¤´ GET /api/users X-API-Version: v1 3. ç‰ˆæœ¬è¿ç§»ç­–ç•¥ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 // ç‰ˆæœ¬åºŸå¼ƒé€šçŸ¥ { \u0026#34;deprecation\u0026#34;: { \u0026#34;version\u0026#34;: \u0026#34;v1\u0026#34;, \u0026#34;deprecated_at\u0026#34;: \u0026#34;2023-12-01\u0026#34;, \u0026#34;sunset_at\u0026#34;: \u0026#34;2024-06-01\u0026#34;, \u0026#34;migration_guide\u0026#34;: \u0026#34;https://docs.example.com/migration/v1-to-v2\u0026#34; } } // æ¸è¿›å¼è¿ç§» GET /api/users // v1å®¢æˆ·ç«¯è¿”å›v1æ ¼å¼ // v2å®¢æˆ·ç«¯è¿”å›v2æ ¼å¼ å®‰å…¨æœ€ä½³å®è·µ 1. è®¤è¯å’Œæˆæƒ 1 2 3 4 5 6 7 8 9 10 11 // JWT Bearer Tokenè®¤è¯ GET /api/users Authorization: Bearer eyJhbGciOiJIUzI1NiIs... // API Keyè®¤è¯ GET /api/users X-API-Key: sk_1234567890abcdef // OAuth2.0 GET /api/users Authorization: Bearer access_token_here æƒé™æ§åˆ¶ç¤ºä¾‹ï¼š\n1 2 3 4 5 6 7 8 // åŸºäºè§’è‰²çš„æƒé™æ§åˆ¶ GET /api/admin/users // éœ€è¦adminè§’è‰² GET /api/users/profile // éœ€è¦ç”¨æˆ·è®¤è¯ GET /api/public/posts // æ— éœ€è®¤è¯ // åŸºäºèµ„æºçš„æƒé™æ§åˆ¶ GET /api/users/123/orders // åªèƒ½è®¿é—®è‡ªå·±çš„è®¢å• DELETE /api/posts/456 // åªèƒ½åˆ é™¤è‡ªå·±çš„æ–‡ç«  2. è¾“å…¥éªŒè¯å’Œè¿‡æ»¤ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 // è¾“å…¥éªŒè¯ä¸­é—´ä»¶ const validateUserInput = (req, res, next) =\u0026gt; { const { name, email, age } = req.body // åŸºç¡€éªŒè¯ if (!name || name.length \u0026lt; 2) { return res.status(400).json({ error: { code: \u0026#39;INVALID_NAME\u0026#39;, message: \u0026#39;å§“åé•¿åº¦è‡³å°‘2ä¸ªå­—ç¬¦\u0026#39; } }) } // é‚®ç®±æ ¼å¼éªŒè¯ if (!email || !/^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/.test(email)) { return res.status(400).json({ error: { code: \u0026#39;INVALID_EMAIL\u0026#39;, message: \u0026#39;é‚®ç®±æ ¼å¼ä¸æ­£ç¡®\u0026#39; } }) } // å¹´é¾„èŒƒå›´éªŒè¯ if (age \u0026amp;\u0026amp; (age \u0026lt; 0 || age \u0026gt; 150)) { return res.status(400).json({ error: { code: \u0026#39;INVALID_AGE\u0026#39;, message: \u0026#39;å¹´é¾„å¿…é¡»åœ¨0-150ä¹‹é—´\u0026#39; } }) } // SQLæ³¨å…¥é˜²æŠ¤ req.body.name = sanitizeHtml(req.body.name) req.body.email = sanitizeHtml(req.body.email) next() } 3. é€Ÿç‡é™åˆ¶ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 // é€Ÿç‡é™åˆ¶å®ç° const rateLimit = require(\u0026#39;express-rate-limit\u0026#39;) const limiter = rateLimit({ windowMs: 15 * 60 * 1000, // 15åˆ†é’Ÿ max: 100, // æœ€å¤š100ä¸ªè¯·æ±‚ message: { error: { code: \u0026#39;RATE_LIMIT_EXCEEDED\u0026#39;, message: \u0026#39;è¯·æ±‚è¿‡äºé¢‘ç¹ï¼Œè¯·ç¨åå†è¯•\u0026#39; } }, standardHeaders: true, legacyHeaders: false, }) // ä¸åŒAPIä¸åŒé™åˆ¶ const strictLimiter = rateLimit({ windowMs: 15 * 60 * 1000, max: 10, // ç™»å½•æ¥å£æ›´ä¸¥æ ¼çš„é™åˆ¶ }) app.use(\u0026#39;/api/\u0026#39;, limiter) app.use(\u0026#39;/api/auth/login\u0026#39;, strictLimiter) ç¼“å­˜ç­–ç•¥ 1. HTTPç¼“å­˜ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 // å¼ºç¼“å­˜ GET /api/users/123 Cache-Control: max-age=3600, public ETag: \u0026#34;abc123\u0026#34; Last-Modified: Wed, 17 Dec 2023 10:00:00 GMT // æ¡ä»¶è¯·æ±‚ GET /api/users/123 If-None-Match: \u0026#34;abc123\u0026#34; If-Modified-Since: Wed, 17 Dec 2023 10:00:00 GMT // å“åº” 304 Not Modified // å¦‚æœèµ„æºæœªä¿®æ”¹ 200 OK // å¦‚æœèµ„æºå·²ä¿®æ”¹ï¼Œè¿”å›æ–°å†…å®¹ 2. åº”ç”¨å±‚ç¼“å­˜ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 // Redisç¼“å­˜å®ç° const redis = require(\u0026#39;redis\u0026#39;) const client = redis.createClient() const cachedResponse = async (key, fetchFunction, ttl = 300) =\u0026gt; { try { // å°è¯•ä»ç¼“å­˜è·å– const cached = await client.get(key) if (cached) { return JSON.parse(cached) } // ç¼“å­˜æœªå‘½ä¸­ï¼Œæ‰§è¡Œå‡½æ•° const result = await fetchFunction() // å­˜å…¥ç¼“å­˜ await client.setex(key, ttl, JSON.stringify(result)) return result } catch (error) { console.error(\u0026#39;Cache error:\u0026#39;, error) return fetchFunction() // å‡ºé”™æ—¶ç›´æ¥æ‰§è¡Œå‡½æ•° } } // ä½¿ç”¨ç¤ºä¾‹ app.get(\u0026#39;/api/users/:id\u0026#39;, async (req, res) =\u0026gt; { const userId = req.params.id const cacheKey = `user:${userId}` const user = await cachedResponse(cacheKey, async () =\u0026gt; { return await User.findById(userId) }, 600) // ç¼“å­˜10åˆ†é’Ÿ res.json({ success: true, data: user }) }) APIæ–‡æ¡£å’Œæµ‹è¯• 1. OpenAPIè§„èŒƒ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 # openapi.yaml openapi: 3.0.0 info: title: User Management API version: 1.0.0 description: ç”¨æˆ·ç®¡ç†APIæ–‡æ¡£ paths: /api/users: get: summary: è·å–ç”¨æˆ·åˆ—è¡¨ parameters: - name: page in: query schema: type: integer minimum: 1 default: 1 - name: limit in: query schema: type: integer minimum: 1 maximum: 100 default: 20 responses: \u0026#39;200\u0026#39;: description: æˆåŠŸè¿”å›ç”¨æˆ·åˆ—è¡¨ content: application/json: schema: type: object properties: success: type: boolean data: type: array items: $ref: \u0026#39;#/components/schemas/User\u0026#39; post: summary: åˆ›å»ºæ–°ç”¨æˆ· requestBody: required: true content: application/json: schema: $ref: \u0026#39;#/components/schemas/CreateUserRequest\u0026#39; responses: \u0026#39;201\u0026#39;: description: ç”¨æˆ·åˆ›å»ºæˆåŠŸ content: application/json: schema: $ref: \u0026#39;#/components/schemas/UserResponse\u0026#39; components: schemas: User: type: object properties: id: type: string name: type: string email: type: string format: email created_at: type: string format: date-time 2. APIæµ‹è¯•ç­–ç•¥ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 // å•å…ƒæµ‹è¯•ç¤ºä¾‹ describe(\u0026#39;User API\u0026#39;, () =\u0026gt; { test(\u0026#39;should create user successfully\u0026#39;, async () =\u0026gt; { const userData = { name: \u0026#39;Test User\u0026#39;, email: \u0026#39;test@example.com\u0026#39;, age: 25 } const response = await request(app) .post(\u0026#39;/api/users\u0026#39;) .send(userData) .expect(201) expect(response.body.success).toBe(true) expect(response.body.data.name).toBe(userData.name) expect(response.body.data.email).toBe(userData.email) }) test(\u0026#39;should validate email format\u0026#39;, async () =\u0026gt; { const userData = { name: \u0026#39;Test User\u0026#39;, email: \u0026#39;invalid-email\u0026#39;, age: 25 } const response = await request(app) .post(\u0026#39;/api/users\u0026#39;) .send(userData) .expect(400) expect(response.body.success).toBe(false) expect(response.body.error.code).toBe(\u0026#39;VALIDATION_ERROR\u0026#39;) }) }) // é›†æˆæµ‹è¯• describe(\u0026#39;User API Integration\u0026#39;, () =\u0026gt; { test(\u0026#39;complete user workflow\u0026#39;, async () =\u0026gt; { // åˆ›å»ºç”¨æˆ· const createResponse = await request(app) .post(\u0026#39;/api/users\u0026#39;) .send({ name: \u0026#39;Integration Test\u0026#39;, email: \u0026#39;integration@example.com\u0026#39; }) .expect(201) const userId = createResponse.body.data.id // è·å–ç”¨æˆ· const getResponse = await request(app) .get(`/api/users/${userId}`) .expect(200) expect(getResponse.body.data.id).toBe(userId) // æ›´æ–°ç”¨æˆ· await request(app) .patch(`/api/users/${userId}`) .send({ name: \u0026#39;Updated Name\u0026#39; }) .expect(200) // åˆ é™¤ç”¨æˆ· await request(app) .delete(`/api/users/${userId}`) .expect(204) }) }) ç›‘æ§å’Œæ—¥å¿— 1. APIç›‘æ§æŒ‡æ ‡ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 // æ€§èƒ½ç›‘æ§ä¸­é—´ä»¶ const apiMetrics = (req, res, next) =\u0026gt; { const start = Date.now() res.on(\u0026#39;finish\u0026#39;, () =\u0026gt; { const duration = Date.now() - start // è®°å½•æŒ‡æ ‡ metrics.counter(\u0026#39;api_requests_total\u0026#39;, { method: req.method, route: req.route?.path || req.path, status: res.statusCode }).inc() metrics.histogram(\u0026#39;api_request_duration_ms\u0026#39;, { method: req.method, route: req.route?.path || req.path }).observe(duration) // è®°å½•æ…¢æŸ¥è¯¢ if (duration \u0026gt; 1000) { logger.warn(\u0026#39;Slow API request\u0026#39;, { method: req.method, path: req.path, duration, user_id: req.user?.id }) } }) next() } // å¥åº·æ£€æŸ¥ç«¯ç‚¹ app.get(\u0026#39;/health\u0026#39;, async (req, res) =\u0026gt; { const health = { status: \u0026#39;ok\u0026#39;, timestamp: new Date().toISOString(), services: { database: \u0026#39;ok\u0026#39;, redis: \u0026#39;ok\u0026#39;, external_api: \u0026#39;ok\u0026#39; } } try { // æ£€æŸ¥æ•°æ®åº“è¿æ¥ await database.query(\u0026#39;SELECT 1\u0026#39;) // æ£€æŸ¥Redisè¿æ¥ await redis.ping() res.json(health) } catch (error) { health.status = \u0026#39;error\u0026#39; health.error = error.message res.status(503).json(health) } }) 2. ç»“æ„åŒ–æ—¥å¿— 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 // ç»“æ„åŒ–æ—¥å¿—è®°å½• const logger = winston.createLogger({ format: winston.format.combine( winston.format.timestamp(), winston.format.errors({ stack: true }), winston.format.json() ), transports: [ new winston.transports.File({ filename: \u0026#39;error.log\u0026#39;, level: \u0026#39;error\u0026#39; }), new winston.transports.File({ filename: \u0026#39;combined.log\u0026#39; }) ] }) // è¯·æ±‚æ—¥å¿—ä¸­é—´ä»¶ const requestLogger = (req, res, next) =\u0026gt; { const requestId = req.headers[\u0026#39;x-request-id\u0026#39;] || generateRequestId() req.requestId = requestId logger.info(\u0026#39;API request\u0026#39;, { request_id: requestId, method: req.method, path: req.path, user_agent: req.get(\u0026#39;User-Agent\u0026#39;), ip: req.ip, user_id: req.user?.id }) const start = Date.now() res.on(\u0026#39;finish\u0026#39;, () =\u0026gt; { logger.info(\u0026#39;API response\u0026#39;, { request_id: requestId, status: res.statusCode, duration: Date.now() - start, user_id: req.user?.id }) }) next() } ç”Ÿäº§ç¯å¢ƒéƒ¨ç½² 1. APIç½‘å…³é…ç½® 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 # API Gatewayé…ç½®ç¤ºä¾‹ gateway: routes: - path: /api/v1/users/* service: user-service methods: [GET, POST, PUT, DELETE] rate_limit: requests_per_minute: 100 authentication: required - path: /api/v1/posts/* service: post-service methods: [GET, POST] rate_limit: requests_per_minute: 200 cache: ttl: 300 # 5åˆ†é’Ÿç¼“å­˜ 2. è´Ÿè½½å‡è¡¡å’Œæ‰©å±• 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 // é›†ç¾¤éƒ¨ç½²é…ç½® const cluster = require(\u0026#39;cluster\u0026#39;) const numCPUs = require(\u0026#39;os\u0026#39;).cpus().length if (cluster.isMaster) { console.log(`Master ${process.pid} is running`) // åˆ›å»ºå·¥ä½œè¿›ç¨‹ for (let i = 0; i \u0026lt; numCPUs; i++) { cluster.fork() } cluster.on(\u0026#39;exit\u0026#39;, (worker, code, signal) =\u0026gt; { console.log(`Worker ${worker.process.pid} died`) cluster.fork() // é‡å¯å·¥ä½œè¿›ç¨‹ }) } else { // å¯åŠ¨APIæœåŠ¡å™¨ require(\u0026#39;./app\u0026#39;) console.log(`Worker ${process.pid} started`) } æ€»ç»“ è®¾è®¡ä¼˜ç§€çš„RESTful APIéœ€è¦è€ƒè™‘å¤šä¸ªæ–¹é¢ï¼š\néµå¾ªRESTåŸåˆ™ï¼šèµ„æºå¯¼å‘ã€æ­£ç¡®çš„HTTPæ–¹æ³•ä½¿ç”¨ ä¸€è‡´çš„URLè®¾è®¡ï¼šæ¸…æ™°çš„å‘½åè§„èŒƒã€åˆç†çš„åµŒå¥—ç»“æ„ æ ‡å‡†åŒ–çš„å“åº”æ ¼å¼ï¼šç»Ÿä¸€çš„æˆåŠŸå’Œé”™è¯¯å“åº”ç»“æ„ å®Œå–„çš„å®‰å…¨æœºåˆ¶ï¼šè®¤è¯ã€æˆæƒã€è¾“å…¥éªŒè¯ã€é€Ÿç‡é™åˆ¶ é«˜æ•ˆçš„ç¼“å­˜ç­–ç•¥ï¼šåˆç†ä½¿ç”¨HTTPç¼“å­˜å’Œåº”ç”¨å±‚ç¼“å­˜ è¯¦ç»†çš„APIæ–‡æ¡£ï¼šOpenAPIè§„èŒƒã€æ¸…æ™°çš„è¯´æ˜å’Œç¤ºä¾‹ å…¨é¢çš„ç›‘æ§æ—¥å¿—ï¼šæ€§èƒ½æŒ‡æ ‡ã€é”™è¯¯è¿½è¸ªã€ç»“æ„åŒ–æ—¥å¿— å¯é çš„éƒ¨ç½²æ–¹æ¡ˆï¼šè´Ÿè½½å‡è¡¡ã€å¥åº·æ£€æŸ¥ã€è‡ªåŠ¨æ‰©å±• é€šè¿‡éµå¾ªè¿™äº›æœ€ä½³å®è·µï¼Œä½ å¯ä»¥æ„å»ºå‡ºæ˜“äºä½¿ç”¨ã€ç»´æŠ¤å’Œæ‰©å±•çš„RESTful APIï¼Œä¸ºå¼€å‘è€…æä¾›ä¼˜ç§€çš„APIä½“éªŒã€‚\n","permalink":"/blog/articles/restful-api-design-best-practices/","summary":"æ·±å…¥æ¢è®¨RESTful APIçš„è®¾è®¡åŸåˆ™å’Œæœ€ä½³å®è·µï¼ŒåŒ…æ‹¬èµ„æºå‘½åã€HTTPæ–¹æ³•ä½¿ç”¨ã€é”™è¯¯å¤„ç†ã€ç‰ˆæœ¬æ§åˆ¶ç­‰ï¼Œå¹¶æä¾›å®é™…é¡¹ç›®ä¸­çš„è®¾è®¡ç»éªŒ","title":"RESTful APIè®¾è®¡æœ€ä½³å®è·µï¼šä»è§„èŒƒåˆ°ç”Ÿäº§ç¯å¢ƒçš„å®Œæ•´æŒ‡å—"},{"content":"JavaScriptå¼‚æ­¥ç¼–ç¨‹æœ€ä½³å®è·µï¼šä»å›è°ƒåˆ°async/awaitçš„å®Œæ•´æŒ‡å— JavaScriptçš„å¼‚æ­¥ç¼–ç¨‹æ˜¯ç°ä»£Webå¼€å‘çš„æ ¸å¿ƒæŠ€èƒ½ã€‚ä»æ—©æœŸçš„å›è°ƒå‡½æ•°åˆ°Promiseï¼Œå†åˆ°async/awaitï¼ŒJavaScriptçš„å¼‚æ­¥ç¼–ç¨‹æ¨¡å¼ç»å†äº†æ˜¾è‘—çš„æ¼”è¿›ã€‚æœ¬æ–‡å°†æ·±å…¥æ¢è®¨è¿™äº›æ¨¡å¼ï¼Œå¹¶æä¾›å®é™…å¼€å‘ä¸­çš„æœ€ä½³å®è·µã€‚\nå¼‚æ­¥ç¼–ç¨‹çš„æ¼”è¿›å†ç¨‹ 1. å›è°ƒå‡½æ•°æ—¶ä»£ åŸºç¡€å›è°ƒæ¨¡å¼\n1 2 3 4 5 6 7 8 9 10 // ç®€å•çš„å¼‚æ­¥å›è°ƒ function fetchData(callback) { setTimeout(() =\u0026gt; { callback(\u0026#39;Hello, World!\u0026#39;) }, 1000) } fetchData((result) =\u0026gt; { console.log(result) }) å›è°ƒåœ°ç‹±é—®é¢˜\n1 2 3 4 5 6 7 8 9 10 // å›è°ƒåœ°ç‹±ç¤ºä¾‹ fetchUser((user) =\u0026gt; { fetchPosts(user.id, (posts) =\u0026gt; { fetchComments(posts[0].id, (comments) =\u0026gt; { processComments(comments, (result) =\u0026gt; { console.log(\u0026#39;å¤„ç†å®Œæˆ:\u0026#39;, result) }) }) }) }) å›è°ƒè§£å†³æ–¹æ¡ˆ\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 // ä½¿ç”¨å‘½åå‡½æ•°é¿å…å›è°ƒåœ°ç‹± function fetchUser(callback) { setTimeout(() =\u0026gt; { callback({ id: 1, name: \u0026#39;John\u0026#39; }) }, 1000) } function fetchPosts(userId, callback) { setTimeout(() =\u0026gt; { callback([{ id: 1, title: \u0026#39;Post 1\u0026#39; }]) }, 1000) } function fetchComments(postId, callback) { setTimeout(() =\u0026gt; { callback([\u0026#39;Comment 1\u0026#39;, \u0026#39;Comment 2\u0026#39;]) }, 1000) } function processComments(comments, callback) { setTimeout(() =\u0026gt; { callback(comments.length) }, 1000) } // çº¿æ€§å›è°ƒé“¾ fetchUser((user) =\u0026gt; { fetchPosts(user.id, (posts) =\u0026gt; { fetchComments(posts[0].id, (comments) =\u0026gt; { processComments(comments, (result) =\u0026gt; { console.log(\u0026#39;å¤„ç†å®Œæˆ:\u0026#39;, result) }) }) }) }) 2. Promiseæ—¶ä»£ åŸºç¡€Promise\n1 2 3 4 5 6 7 8 9 10 11 12 // åˆ›å»ºPromise const fetchData = () =\u0026gt; { return new Promise((resolve, reject) =\u0026gt; { setTimeout(() =\u0026gt; { resolve(\u0026#39;Hello, World!\u0026#39;) }, 1000) }) } fetchData() .then(result =\u0026gt; console.log(result)) .catch(error =\u0026gt; console.error(error)) Promiseé“¾å¼è°ƒç”¨\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 function fetchUser() { return new Promise((resolve, reject) =\u0026gt; { setTimeout(() =\u0026gt; { resolve({ id: 1, name: \u0026#39;John\u0026#39; }) }, 1000) }) } function fetchPosts(userId) { return new Promise((resolve, reject) =\u0026gt; { setTimeout(() =\u0026gt; { resolve([{ id: 1, title: \u0026#39;Post 1\u0026#39; }]) }, 1000) }) } function fetchComments(postId) { return new Promise((resolve, reject) =\u0026gt; { setTimeout(() =\u0026gt; { resolve([\u0026#39;Comment 1\u0026#39;, \u0026#39;Promise Comment 2\u0026#39;]) }, 1000) }) } // Promiseé“¾é¿å…å›è°ƒåœ°ç‹± fetchUser() .then(user =\u0026gt; fetchPosts(user.id)) .then(posts =\u0026gt; fetchComments(posts[0].id)) .then(comments =\u0026gt; processComments(comments)) .then(result =\u0026gt; console.log(\u0026#39;å¤„ç†å®Œæˆ:\u0026#39;, result)) .catch(error =\u0026gt; console.error(\u0026#39;é”™è¯¯:\u0026#39;, error)) Promiseé™æ€æ–¹æ³•\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 // Promise.all - å¹¶è¡Œæ‰§è¡Œï¼Œå…¨éƒ¨æˆåŠŸæ‰æˆåŠŸ const promises = [ fetchData(\u0026#39;/api/user\u0026#39;), fetchData(\u0026#39;/api/posts\u0026#39;), fetchData(\u0026#39;/api/comments\u0026#39;) ] Promise.all(promises) .then(results =\u0026gt; { console.log(\u0026#39;æ‰€æœ‰è¯·æ±‚æˆåŠŸ:\u0026#39;, results) }) .catch(error =\u0026gt; { console.error(\u0026#39;æœ‰è¯·æ±‚å¤±è´¥:\u0026#39;, error) }) // Promise.race - ç«äº‰æ‰§è¡Œï¼Œç¬¬ä¸€ä¸ªå®Œæˆå°±è¿”å› const racePromises = [ fetchData(\u0026#39;/api/fast\u0026#39;), fetchData(\u0026#39;/api/slow\u0026#39;), fetchData(\u0026#39;/api/medium\u0026#39;) ] Promise.race(racePromises) .then(result =\u0026gt; { console.log(\u0026#39;æœ€å¿«çš„å“åº”:\u0026#39;, result) }) .catch(error =\u0026gt; { console.error(\u0026#39;æ‰€æœ‰è¯·æ±‚éƒ½å¤±è´¥:\u0026#39;, error) }) // Promise.allSettled - å…¨éƒ¨å®Œæˆï¼Œä¸ç®¡æˆåŠŸå¤±è´¥ const settledPromises = [ fetchData(\u0026#39;/api/success1\u0026#39;), fetchData(\u0026#39;/api/fail1\u0026#39;), fetchData(\u0026#39;/api/success2\u0026#39;) ] Promise.allSettled(settledPromises) .then(results =\u0026gt; { results.forEach((result, index) =\u0026gt; { if (result.status === \u0026#39;fulfilled\u0026#39;) { console.log(`è¯·æ±‚${index}æˆåŠŸ:`, result.value) } else { console.log(`è¯·æ±‚${index}å¤±è´¥:`, result.reason) } }) }) 3. async/awaitæ—¶ä»£ åŸºæœ¬async/awaitè¯­æ³•\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 async function fetchData() { try { const response = await fetch(\u0026#39;/api/data\u0026#39;) const data = await response.json() return data } catch (error) { console.error(\u0026#39;è·å–æ•°æ®å¤±è´¥:\u0026#39;, error) throw error } } // ä½¿ç”¨ fetchData() .then(data =\u0026gt; console.log(data)) .catch(error =\u0026gt; console.error(error)) é¡ºåºæ‰§è¡Œå¼‚æ­¥æ“ä½œ\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 async function processUserData() { const user = await fetchUser() const posts = await fetchPosts(user.id) const comments = await fetchComments(posts[0].id) return { user, posts, comments } } // å¹¶è¡Œæ‰§è¡Œå¼‚æ­¥æ“ä½œ async function fetchAllData() { const [user, posts, comments] = await Promise.all([ fetchUser(), fetchPosts(1), fetchComments(1) ]) return { user, posts, comments } } Promiseæ·±å…¥ç†è§£ 1. PromiseçŠ¶æ€ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 const promise = new Promise((resolve, reject) =\u0026gt; { // pending -\u0026gt; fulfilled/rejected }) // çŠ¶æ€æ£€æŸ¥ console.log(promise) // Promise { \u0026lt;pending\u0026gt; } // çŠ¶æ€å¤„ç† promise .then(value =\u0026gt; { console.log(\u0026#39;fulfilled:\u0026#39;, value) // fulfilledçŠ¶æ€ }) .catch(error =\u0026gt; { console.log(\u0026#39;rejected:\u0026#39;, error) // rejectedçŠ¶æ€ }) .finally(() =\u0026gt; { console.log(\u0026#39;settled:\u0026#39;) // æ— è®ºæˆåŠŸå¤±è´¥éƒ½ä¼šæ‰§è¡Œ }) 2. Promiseé”™è¯¯å¤„ç† 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 // é”™è¯¯ä¼ æ’­ function fetchWithRetry(url, maxRetries = 3) { return new Promise((resolve, reject) =\u0026gt; { let retries = 0 const attempt = () =\u0026gt; { fetch(url) .then(response =\u0026gt; { if (!response.ok) { throw new Error(`HTTP ${response.status}`) } return response.json() }) .then(data =\u0026gt; resolve(data)) .catch(error =\u0026gt; { retries++ if (retries \u0026lt;= maxRetries) { console.log(`é‡è¯•ç¬¬${retries}æ¬¡`) setTimeout(attempt, 1000 * retries) } else { reject(error) } }) } attempt() }) } // é”™è¯¯å¤„ç†æœ€ä½³å®è·µ function robustFetch(url, options = {}) { return fetch(url, options) .then(response =\u0026gt; { if (!response.ok) { // åˆ›å»ºåŒ…å«æ›´å¤šé”™è¯¯ä¿¡æ¯çš„Errorå¯¹è±¡ const error = new Error(`HTTP ${response.status}: ${response.statusText}`) error.status = response.status error.statusText = response.statusText error.response = response throw error } return response.json() }) .catch(error =\u0026gt; { // åŒºåˆ†ç½‘ç»œé”™è¯¯å’Œå…¶ä»–é”™è¯¯ if (error.name === \u0026#39;TypeError\u0026#39; || error.message.includes(\u0026#39;Failed to fetch\u0026#39;)) { throw new Error(\u0026#39;ç½‘ç»œé”™è¯¯ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥\u0026#39;) } throw error }) } async/awaitæœ€ä½³å®è·µ 1. é”™è¯¯å¤„ç†ç­–ç•¥ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 // ç»Ÿä¸€é”™è¯¯å¤„ç† class ApiError extends Error { constructor(message, statusCode, data) { super(message) this.name = \u0026#39;ApiError\u0026#39; this.statusCode = statusCode this.data = data } } async function apiCall(url, options = {}) { try { const response = await fetch(url, { headers: { \u0026#39;Content-Type\u0026#39;: \u0026#39;application/json\u0026#39;, \u0026#39;Authorization\u0026#39;: `Bearer ${getAuthToken()}` }, ...options }) if (!response.ok) { throw new ApiError( `APIè¯·æ±‚å¤±è´¥: ${response.status} ${response.statusText}`, response.status ) } return await response.json() } catch (error) { if (error instanceof ApiError) { throw error // é‡æ–°æŠ›å‡ºAPIé”™è¯¯ } // å¤„ç†ç½‘ç»œé”™è¯¯ if (error.name === \u0026#39;TypeError\u0026#39;) { throw new ApiError(\u0026#39;ç½‘ç»œè¿æ¥å¤±è´¥\u0026#39;, 0) } throw error // é‡æ–°æŠ›å‡ºå…¶ä»–é”™è¯¯ } } 2. å¹¶å‘æ§åˆ¶ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 // é™åˆ¶å¹¶å‘æ•°é‡ class ConcurrencyLimiter { constructor(limit = 3) { this.limit = limit this.running = 0 this.queue = [] } async add(async fn) { return new Promise((resolve, reject) =\u0026gt; { this.queue.push({ fn, resolve, reject }) this.processQueue() }) } async processQueue() { if (this.running \u0026gt;= this.limit || this.queue.length === 0) { return } this.running++ const { fn, resolve, reject } = this.queue.shift() try { const result = await fn() resolve(result) } catch (error) { reject(error) } finally { this.running-- this.processQueue() } } } // ä½¿ç”¨ç¤ºä¾‹ const limiter = new ConcurrencyLimiter(5) async function fetchMultipleUrls(urls) { const promises = urls.map(url =\u0026gt; limiter.add(() =\u0026gt; fetch(url).then(res =\u0026gt; res.json()) ) return Promise.all(promises) } 3. è¶…æ—¶æ§åˆ¶ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 // è¶…æ—¶åŒ…è£…å™¨ function timeout(promise, delay) { return Promise.race([ promise, new Promise((_, reject) =\u0026gt; setTimeout(() =\u0026gt; reject(new Error(\u0026#39;æ“ä½œè¶…æ—¶\u0026#39;)), delay) ) ]) } // ä½¿ç”¨ç¤ºä¾‹ async function fetchWithTimeout(url, delay = 5000) { try { const response = await timeout( fetch(url), delay ) return response.json() } catch (error) { if (error.message === \u0026#39;æ“ä½œè¶…æ—¶\u0026#39;) { console.log(`è¯·æ±‚${url}è¶…æ—¶`) } throw error } } å®é™…åº”ç”¨åœºæ™¯ 1. æ•°æ®è·å–å’Œç¼“å­˜ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 class DataCache { constructor(ttl = 300000) { // 5åˆ†é’Ÿ this.cache = new Map() this.ttl = ttl } async get(key, fetchFn) { const cached = this.cache.get(key) if (cached \u0026amp;\u0026amp; Date.now() - cached.timestamp \u0026lt; this.ttl) { console.log(\u0026#39;ä½¿ç”¨ç¼“å­˜æ•°æ®:\u0026#39;, key) return cached.data } console.log(\u0026#39;è·å–æ–°æ•°æ®:\u0026#39;, key) try { const data = await fetchFn() this.cache.set(key, { data, timestamp: Date.now() }) return data } catch (error) { console.error(\u0026#39;è·å–æ•°æ®å¤±è´¥:\u0026#39;, error) throw error } } } // ä½¿ç”¨ç¤ºä¾‹ const cache = new DataCache() async function getUserData(userId) { return cache.get(`user-${userId}`, () =\u0026gt; fetch(`/api/users/${userId}`).then(res =\u0026gt; res.json()) ) } 2. æ–‡ä»¶ä¸Šä¼ è¿›åº¦ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 async function uploadFile(file, onProgress) { return new Promise((resolve, reject) =\u0026gt; { const xhr = new XMLHttpRequest() const formData = new FormData() formData.append(\u0026#39;file\u0026#39;, file) xhr.upload.onprogress = (event) =\u0026gt; { if (event.lengthComputable) { const progress = Math.round((event.loaded / event.total) * 100) onProgress(progress) } } xhr.onload = () =\u0026gt; { if (xhr.status === 200) { resolve(xhr.response) } else { reject(new Error(`ä¸Šä¼ å¤±è´¥: ${xhr.status}`)) } } xhr.onerror = () =\u0026gt; reject(new Error(\u0026#39;ç½‘ç»œé”™è¯¯\u0026#39;)) xhr.open(\u0026#39;POST\u0026#39;, \u0026#39;/api/upload\u0026#39;) xhr.send(formData) }) } 3. è½®è¯¢å’Œå®æ—¶æ•°æ® 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 // æ™ºèƒ½è½®è¯¢ class SmartPoller { constructor(fetchFn, options = {}) { this.fetchFn = fetchFn this.interval = options.interval || 5000 this.maxInterval = options.maxInterval || 30000 this.backoffFactor = options.backoffFactor || 1.5 this.maxRetries = options.maxRetries || 10 this.currentInterval = this.interval this.retryCount = 0 this.timeoutId = null } start(callback) { const poll = async () =\u0026gt; { try { const result = await this.fetchFn() this.retryCount = 0 this.currentInterval = this.interval callback(null, result) } catch (error) { this.retryCount++ if (this.retryCount \u0026gt; this.maxRetries) { callback(error, null) return } this.currentInterval = Math.min( this.currentInterval * this.backoffFactor, this.maxInterval ) console.log(`ç¬¬${this.retryCount}æ¬¡é‡è¯•ï¼Œ${this.currentInterval}msåé‡è¯•`) this.timeoutId = setTimeout(poll, this.currentInterval) } } this.timeoutId = setTimeout(poll, 0) } stop() { if (this.timeoutId) { clearTimeout(this.timeoutId) this.timeoutId = null } } } é”™è¯¯å¤„ç†å’Œè°ƒè¯• 1. é”™è¯¯åˆ†ç±»å’Œå¤„ç† 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 // è‡ªå®šä¹‰é”™è¯¯ç±»å‹ class NetworkError extends Error { constructor(message, code) { super(message) this.name = \u0026#39;NetworkError\u0026#39; this.code = code } } class ValidationError extends Error { constructor(message, field) { super(message) this.name = \u0026#39;ValidationError\u0026#39; this.field = field } } // é”™è¯¯å¤„ç†ä¸­é—´ä»¶ function errorHandler(error, req, res, next) { if (error instanceof NetworkError) { res.status(503).json({ error: \u0026#39;ç½‘ç»œæœåŠ¡ä¸å¯ç”¨\u0026#39;, code: error.code, message: error.message }) } else if (error instanceof ValidationError) { res.status(400).json({ error: \u0026#39;éªŒè¯å¤±è´¥\u0026#39;, field: error.field, message: error.message }) } else { res.status(500).json({ error: \u0026#39;æœåŠ¡å™¨å†…éƒ¨é”™è¯¯\u0026#39;, message: error.message }) } } 2. å¼‚æ­¥é”™è¯¯è¿½è¸ª 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 // é”™è¯¯è¿½è¸ªåŒ…è£…å™¨ function withErrorTracking(fn) { return async (...args) =\u0026gt; { try { return await fn(...args) } catch (error) { // è®°å½•é”™è¯¯ä¸Šä¸‹æ–‡ console.error(\u0026#39;å¼‚æ­¥æ“ä½œå¤±è´¥:\u0026#39;, { error: error.message, stack: error.stack, args: args, timestamp: new Date().toISOString() }) // å‘é€é”™è¯¯åˆ°ç›‘æ§æœåŠ¡ trackError(error) throw error } } } // ä½¿ç”¨ç¤ºä¾‹ const safeFetch = withErrorTracking(fetch) async function fetchUserData(userId) { const response = await safeFetch(`/api/users/${userId}`) return response.json() } æ€§èƒ½ä¼˜åŒ– 1. é¿å…ä¸å¿…è¦çš„Promiseåˆ›å»º 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 // ä¸å¥½çš„åšæ³•ï¼šæ¯æ¬¡è°ƒç”¨éƒ½åˆ›å»ºæ–°çš„Promise function getData() { return new Promise((resolve) =\u0026gt; { resolve(\u0026#39;data\u0026#39;) }) } // å¥½çš„åšæ³•ï¼šç¼“å­˜Promiseæˆ–ä½¿ç”¨å‡½æ•° const dataPromise = new Promise((resolve) =\u0026gt; { resolve(\u0026#39;data\u0026#39;) }) function getData() { return dataPromise } 2. åˆå¹¶å¼‚æ­¥æ“ä½œ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 // ä¸å¥½çš„åšæ³•ï¼šä¸²è¡Œæ‰§è¡Œ async function getDataSerial() { const user = await fetchUser() const posts = await fetchPosts(user.id) const comments = await fetchComments(posts[0].id) return { user, posts, comments } } // å¥½çš„åšæ³•ï¼šå¹¶è¡Œæ‰§è¡Œ async function getDataParallel() { const [user, posts, comments] = await Promise.all([ fetchUser(), fetchPosts(1), fetchComments(1) ]) return { user, posts, comments } } // éƒ¨åˆ†å¹¶è¡Œæ‰§è¡Œ async function getDataMixed() { const [user, posts] = await Promise.all([ fetchUser(), fetchPosts(1) ]) // ç­‰postsåŠ è½½å®Œæˆåå†è·å–comments const comments = await fetchComments(posts[0].id) return { user, posts, comments } } æµ‹è¯•å¼‚æ­¥ä»£ç  1. æµ‹è¯•Promise 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 // Jestæµ‹è¯•Promise test(\u0026#39;Promise resolves with correct data\u0026#39;, async () =\u0026gt; { const result = await fetchData() expect(result).toBe(\u0026#39;Hello, World!\u0026#39;) }) test(\u0026#39;Promise rejects with error\u0026#39;, async () =\u0026gt; { await expect(fetchData()).rejects.toThrow(\u0026#39;Network error\u0026#39;) }) // æµ‹è¯•Promise.all test(\u0026#39;Promise.all resolves when all promises resolve\u0026#39;, async () =\u0026gt; { const promises = [ Promise.resolve(1), Promise.resolve(2), Promise.resolve(3) ] const result = await Promise.all(promises) expect(result).toEqual([1, 2, 3]) }) 2. æµ‹è¯•async/await 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 // Jestæµ‹è¯•asyncå‡½æ•° describe(\u0026#39;User API\u0026#39;, () =\u0026gt; { test(\u0026#39;should fetch user data\u0026#39;, async () =\u0026gt; { const userData = await fetchUser(1) expect(userData).toHaveProperty(\u0026#39;id\u0026#39;) expect(userData).toHaveProperty(\u0026#39;name\u0026#39;) }) test(\u0026#39;should handle network errors\u0026#39;, async () =\u0026gt; { await expect(fetchUser(999)).rejects.toThrow(\u0026#39;User not found\u0026#39;) }) }) // Mockæµ‹è¯•å¼‚æ­¥æ“ä½œ jest.mock(\u0026#39;./api\u0026#39;) test(\u0026#39;should call API with correct parameters\u0026#39;, async () =\u0026gt; { const result = await fetchUser(1) expect(api.fetchUser).toHaveBeenCalledWith(1) expect(result).toEqual(mockUserData) }) æ€»ç»“ JavaScriptå¼‚æ­¥ç¼–ç¨‹çš„æ¼”è¿›ä¸ºæˆ‘ä»¬æä¾›äº†è¶Šæ¥è¶Šä¼˜é›…å’Œå¼ºå¤§çš„å·¥å…·ï¼š\nå›è°ƒå‡½æ•°ï¼šåŸºç¡€ä½†å®¹æ˜“äº§ç”Ÿå›è°ƒåœ°ç‹± Promiseï¼šè§£å†³äº†å›è°ƒåœ°ç‹±ï¼Œæ”¯æŒé“¾å¼è°ƒç”¨å’Œé”™è¯¯å¤„ç† async/awaitï¼šè®©å¼‚æ­¥ä»£ç çœ‹èµ·æ¥åƒåŒæ­¥ä»£ç ï¼Œæ›´æ˜“è¯»æ˜“ç»´æŠ¤ æœ€ä½³å®è·µè¦ç‚¹ï¼š\nä¼˜å…ˆä½¿ç”¨async/awaitç¼–å†™å¼‚æ­¥ä»£ç  åˆç†ä½¿ç”¨Promise.allã€Promise.raceç­‰å¹¶å‘æ§åˆ¶æ–¹æ³• å®ç°å®Œå–„çš„é”™è¯¯å¤„ç†å’Œè¶…æ—¶æœºåˆ¶ æ³¨æ„æ€§èƒ½ä¼˜åŒ–ï¼Œé¿å…ä¸å¿…è¦çš„Promiseåˆ›å»º ç¼–å†™å¯æµ‹è¯•çš„å¼‚æ­¥ä»£ç  æŒæ¡è¿™äº›å¼‚æ­¥ç¼–ç¨‹æŠ€å·§ï¼Œå°†å¸®åŠ©ä½ æ„å»ºæ›´åŠ å¥å£®ã€é«˜æ•ˆçš„JavaScriptåº”ç”¨ã€‚\n","permalink":"/blog/articles/javascript-async-programming-best-practices/","summary":"å…¨é¢ä»‹ç»JavaScriptå¼‚æ­¥ç¼–ç¨‹çš„æ¼”è¿›å†ç¨‹ï¼Œä»å›è°ƒå‡½æ•°åˆ°Promiseå†åˆ°async/awaitï¼Œä»¥åŠåœ¨å®é™…å¼€å‘ä¸­çš„æœ€ä½³å®è·µ","title":"JavaScriptå¼‚æ­¥ç¼–ç¨‹æœ€ä½³å®è·µï¼šä»å›è°ƒåˆ°async/awaitçš„å®Œæ•´æŒ‡å—"},{"content":"ç°ä»£CSSå¸ƒå±€æŠ€å·§ï¼šFlexboxã€Gridä¸å®¹å™¨çš„å®Œç¾ç»“åˆ CSSå¸ƒå±€æŠ€æœ¯åœ¨è¿‡å»å‡ å¹´ä¸­å‘ç”Ÿäº†é©å‘½æ€§çš„å˜åŒ–ã€‚ä»ä¼ ç»Ÿçš„floatå’Œpositionå¸ƒå±€ï¼Œåˆ°ç°ä»£çš„Flexboxå’ŒGridï¼Œå†åˆ°æœ€æ–°çš„Container Queriesï¼ŒCSSä¸ºæˆ‘ä»¬æä¾›äº†å¼ºå¤§è€Œçµæ´»çš„å¸ƒå±€èƒ½åŠ›ã€‚æœ¬æ–‡å°†æ·±å…¥æ¢è®¨è¿™äº›ç°ä»£CSSå¸ƒå±€æŠ€æœ¯ï¼Œå¹¶å±•ç¤ºå¦‚ä½•åœ¨å®é™…é¡¹ç›®ä¸­çµæ´»è¿ç”¨ã€‚\nFlexboxï¼šä¸€ç»´å¸ƒå±€çš„å¼ºå¤§å·¥å…· 1. FlexboxåŸºç¡€æ¦‚å¿µ Flexboxï¼ˆå¼¹æ€§ç›’å­ï¼‰æ˜¯ä¸€ç»´å¸ƒå±€æ¨¡å‹ï¼Œé€‚ç”¨äºå¤„ç†å®¹å™¨ä¸­é¡¹ç›®åœ¨ä¸»è½´å’Œäº¤å‰è½´ä¸Šçš„æ’åˆ—ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 /* Flexboxå®¹å™¨åŸºç¡€è®¾ç½® */ .flex-container { display: flex; flex-direction: row; /* ä¸»è½´æ–¹å‘ï¼šrow | column | row-reverse | column-reverse */ justify-content: center; /* ä¸»è½´å¯¹é½ï¼šflex-start | flex-end | center | space-between | space-around | space-evenly */ align-items: center; /* äº¤å‰è½´å¯¹é½ï¼šstretch | flex-start | flex-end | center | baseline */ flex-wrap: wrap; /* æ¢è¡Œï¼šnowrap | wrap | wrap-reverse */ gap: 16px; /* é—´è· */ } /* Flexé¡¹ç›®è®¾ç½® */ .flex-item { flex: 1; /* flex-grow: 1; flex-shrink: 1; flex-basis: 0% */ min-width: 0; /* é˜²æ­¢å†…å®¹æº¢å‡º */ } 2. å¸¸ç”¨Flexboxå¸ƒå±€æ¨¡å¼ æ°´å¹³å±…ä¸­\n1 2 3 4 5 6 7 8 9 10 11 12 .center-horizontal { display: flex; justify-content: center; align-items: center; } .center-vertical { display: flex; flex-direction: column; justify-content: center; align-items: center; } ä¸¤åˆ—å¸ƒå±€\n1 2 3 4 5 6 7 8 9 10 11 12 13 .two-column-layout { display: flex; gap: 20px; } .sidebar { flex: 0 0 250px; /* ä¸ä¼¸ç¼©ï¼Œå›ºå®šå®½åº¦ */ } .main-content { flex: 1; /* å æ®å‰©ä½™ç©ºé—´ */ min-width: 0; } åœ£æ¯å¸ƒå±€\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 .holy-grail { display: flex; min-height: 100vh; flex-direction: column; } .header, .footer { flex: 0 0 60px; } .main-content { display: flex; flex: 1; } .sidebar { flex: 0 0 200px; } .center { flex: 1; display: flex; flex-direction: column; } 3. Flexboxé«˜çº§æŠ€å·§ ç­‰é«˜åˆ—\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 .equal-height-columns { display: flex; gap: 20px; } .column { flex: 1; display: flex; flex-direction: column; } .column-content { flex: 1; } ç²˜æ€§åº•éƒ¨\n1 2 3 4 5 6 7 8 9 10 11 12 13 .sticky-footer-container { display: flex; flex-direction: column; min-height: 100vh; } .main-content { flex: 1; } .sticky-footer { flex: 0 0 auto; } CSS Gridï¼šäºŒç»´å¸ƒå±€çš„é©å‘½ 1. GridåŸºç¡€æ¦‚å¿µ Gridï¼ˆç½‘æ ¼ï¼‰æ˜¯äºŒç»´å¸ƒå±€æ¨¡å‹ï¼Œå¯ä»¥åŒæ—¶å¤„ç†è¡Œå’Œåˆ—çš„å¸ƒå±€ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 .grid-container { display: grid; grid-template-columns: repeat(3, 1fr) | 200px 1fr 300px | minmax(200px, 1fr); grid-template-rows: auto 1fr auto; grid-template-areas: \u0026#34;header header header\u0026#34; \u0026#34;sidebar main aside\u0026#34; \u0026#34;footer footer footer\u0026#34;; gap: 20px; padding: 20px; } .grid-item { padding: 20px; border: 1px solid #ddd; border-radius: 8px; } .header { grid-area: header; } .sidebar { grid-area: sidebar; } .main { grid-area: main; } .aside { grid-area: aside; } .footer { grid-area: footer; } 2. Gridå¸ƒå±€æ¨¡å¼ å“åº”å¼ç½‘æ ¼\n1 2 3 4 5 6 7 8 9 10 11 12 13 .responsive-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; } /* å›ºå®šæ•°é‡çš„å“åº”å¼ç½‘æ ¼ */ .fixed-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)) repeat(auto-fill, minmax(200px, 1fr)); } ä¸è§„åˆ™ç½‘æ ¼\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 .irregular-grid { display: grid; grid-template-columns: 1fr 2fr 1fr 2fr; grid-template-rows: auto; gap: 10px; } .grid-item:nth-child(1) { grid-column: span 2; } .grid-item:nth-child(3) { grid-row: span 2; } 3. Gridé«˜çº§æŠ€å·§ å¡ç‰‡ç½‘æ ¼å¸ƒå±€\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 .card-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 24px; padding: 24px; } .card { display: grid; grid-template-rows: auto 1fr auto; gap: 16px; padding: 20px; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); } .card-header { font-size: 1.2rem; font-weight: 600; } .card-content { color: #666; } .card-footer { display: flex; justify-content: space-between; align-items: center; } æ‚å¿—å¼å¸ƒå±€\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 .magazine-layout { display: grid; grid-template-columns: repeat(12, 1fr); grid-template-rows: auto; gap: 20px; } .hero-image { grid-column: span 12; grid-row: span 2; } .feature-story { grid-column: span 8; } .sidebar-item { grid-column: span 4; } .small-item { grid-column: span 4; } Container Queriesï¼šå“åº”å¼è®¾è®¡çš„æ–°çºªå…ƒ 1. ContaineråŸºç¡€ Container Querieså…è®¸æˆ‘ä»¬åŸºäºå®¹å™¨çš„å¤§å°è€Œéè§†å£å¤§å°æ¥åº”ç”¨æ ·å¼ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 /* ä¼ ç»Ÿåª’ä½“æŸ¥è¯¢ */ @media (min-width: 768px) { .card { display: grid; grid-template-columns: 1fr 1fr; } } /* Container Queries */ .card-container { container-type: inline-size; } @container (min-width: 400px) { .card { display: grid; grid-template-columns: 1fr 1fr; } } @container (min-width: 600px) { .card { grid-template-columns: 1fr 2fr 1fr; } } 2. å®¹å™¨å•ä½ 1 2 3 4 5 6 7 8 /* å®¹å™¨å•ä½ */ .container { container-type: inline-size; width: 100cqw; /* 100% container width */ height: 50cqh; /* 50% container height */ min-block-size: 200cqb; /* 200px in container block size */ font-size: 16cqi; /* 16px relative to container */ } 3. å®é™…åº”ç”¨åœºæ™¯ å“åº”å¼ç»„ä»¶\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 .product-grid { container-type: inline-size; } .product-grid { display: grid; grid-template-columns: 1fr; gap: 20px; } @container (min-width: 400px) { .product-grid { grid-template-columns: repeat(2, 1fr); } } @container (min-width: 800px) { .product-grid { grid-template-columns: repeat(4, 1fr); } } @container (min-width: 1200px) { .product-grid { grid-template-columns: repeat(6, 1fr); } } ç°ä»£CSSå¸ƒå±€æœ€ä½³å®è·µ 1. å¸ƒå±€é€‰æ‹©æŒ‡å— é€‰æ‹©Flexboxçš„åœºæ™¯ï¼š\nä¸€ç»´å¸ƒå±€ï¼ˆæ°´å¹³æˆ–å‚ç›´æ’åˆ—ï¼‰ å†…å®¹å¯¹é½å’Œåˆ†å¸ƒ å¯¼èˆªæ ã€æŒ‰é’®ç»„ç­‰å°ç»„ä»¶ éœ€è¦çµæ´»çš„ç­‰é«˜åˆ— é€‰æ‹©Gridçš„åœºæ™¯ï¼š\näºŒç»´å¸ƒå±€ï¼ˆåŒæ—¶å¤„ç†è¡Œå’Œåˆ—ï¼‰ å¤æ‚çš„ç½‘æ ¼ç³»ç»Ÿ æ•´ä½“é¡µé¢å¸ƒå±€ éœ€è¦ç²¾ç¡®æ§åˆ¶å…ƒç´ ä½ç½® 2. æ€§èƒ½ä¼˜åŒ– 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 /* ä½¿ç”¨will-changeä¼˜åŒ– */ .animation-element { will-change: transform, opacity; } /* é¿å…ä¸å¿…è¦çš„é‡æ’ */ .optimized-layout { contain: layout; } /* ä½¿ç”¨transformè¿›è¡ŒåŠ¨ç”» */ .smooth-animation { transform: translateX(0); transition: transform 0.3s ease; } .smooth-animation:hover { transform: translateX(100px); } 3. å¯è®¿é—®æ€§è€ƒè™‘ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 /* ç¡®ä¿å¸ƒå±€åœ¨ä¸åŒå±å¹•å°ºå¯¸ä¸‹éƒ½èƒ½æ­£å¸¸å·¥ä½œ */ .responsive-layout { display: flex; flex-direction: column; gap: 1rem; } @media (min-width: 768px) { .responsive-layout { flex-direction: row; } } /* æ”¯æŒæ–‡æœ¬ç¼©æ”¾ */ .scalable-text { font-size: clamp(1rem, 2.5vw, 2rem); line-height: 1.5; } å®æˆ˜é¡¹ç›®ï¼šå“åº”å¼ä»ªè¡¨ç›˜ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 .dashboard { display: grid; grid-template-columns: 1fr; gap: 20px; padding: 20px; } @media (min-width: 768px) { .dashboard { grid-template-columns: 250px 1fr; } } @media (min-width: 1200px) { .dashboard { grid-template-columns: 250px 1fr 300px; } } .sidebar { display: flex; flex-direction: column; gap: 20px; } .main-content { display: grid; gap: 20px; } .widgets { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; } .widget { padding: 20px; border-radius: 8px; background: white; box-shadow: 0 2px 8px rgba(0,0,0,0.1); } .widget-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px; } .widget-content { min-height: 200px; } å¸ƒå±€è°ƒè¯•æŠ€å·§ 1. å¯è§†åŒ–è°ƒè¯• 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 /* å¯è§†åŒ–ç½‘æ ¼å¸ƒå±€ */ .debug-grid { display: grid; gap: 1px; background: linear-gradient(90deg, #f0f0f0 1px, transparent 1px), linear-gradient(180deg, #f0f0f0 1px, transparent 1px); } .debug-flex { background: repeating-linear-gradient( 45deg, transparent, transparent 10px, rgba(255, 0, 0, 0.1) 10px, transparent 20px ); } 2. å¼€å‘å·¥å…·æ”¯æŒ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 /* å¼€å‘è€…å·¥å…·ä¸­çš„CSSå‘½å */ .debug-layout::before { content: \u0026#34;Debug Mode\u0026#34;; position: fixed; top: 0; right: 0; background: #ff0; color: #000; padding: 4px 8px; z-index: 9999; font-size: 12px; } /* ä½¿ç”¨CSSå˜é‡è¿›è¡Œè°ƒè¯• */ :root { --debug-border: 1px solid red; --debug-bg: rgba(255, 0, 0, 0.1); } .debug-element { border: var(--debug-border); background: var(--debug-bg); } æ€»ç»“ ç°ä»£CSSå¸ƒå±€æŠ€æœ¯ä¸ºæˆ‘ä»¬æä¾›äº†å¼ºå¤§è€Œçµæ´»çš„å·¥å…·æ¥åˆ›å»ºå“åº”å¼ã€å¯è®¿é—®çš„ç½‘é¡µå¸ƒå±€ã€‚é€šè¿‡åˆç†é€‰æ‹©å’Œä½¿ç”¨Flexboxã€Gridå’ŒContainer Queriesï¼Œæˆ‘ä»¬å¯ä»¥ï¼š\næ„å»ºå“åº”å¼è®¾è®¡ï¼šåŸºäºå†…å®¹è€Œéè§†å£å¤§å°åˆ›å»ºçœŸæ­£çš„å“åº”å¼ç»„ä»¶ æå‡å¼€å‘æ•ˆç‡ï¼šå‡å°‘å¯¹JavaScriptçš„ä¾èµ–ï¼Œç”¨çº¯CSSå®ç°å¤æ‚å¸ƒå±€ æ”¹å–„æ€§èƒ½è¡¨ç°ï¼šé¿å…ä¸å¿…è¦çš„é‡æ’å’Œé‡ç»˜ï¼Œä¼˜åŒ–æ¸²æŸ“æ€§èƒ½ å¢å¼ºå¯è®¿é—®æ€§ï¼šç¡®ä¿å¸ƒå±€åœ¨ä¸åŒè®¾å¤‡å’Œæµè§ˆå™¨ä¸­éƒ½èƒ½æ­£å¸¸å·¥ä½œ æŒæ¡è¿™äº›ç°ä»£CSSå¸ƒå±€æŠ€å·§ï¼Œå°†å¸®åŠ©ä½ æ„å»ºæ›´åŠ ç°ä»£åŒ–ã€æ›´åŠ çµæ´»çš„Webç•Œé¢ã€‚\n","permalink":"/blog/articles/modern-css-layout-techniques/","summary":"æ·±å…¥æ¢è®¨ç°ä»£CSSå¸ƒå±€æŠ€æœ¯ï¼ŒåŒ…æ‹¬Flexboxã€Gridã€Container Queriesç­‰ï¼Œä»¥åŠå¦‚ä½•åœ¨å®é™…é¡¹ç›®ä¸­çµæ´»è¿ç”¨è¿™äº›å¸ƒå±€æŠ€å·§","title":"ç°ä»£CSSå¸ƒå±€æŠ€å·§ï¼šFlexboxã€Gridä¸å®¹å™¨çš„å®Œç¾ç»“åˆ"},{"content":"å‰ç«¯æ€§èƒ½ä¼˜åŒ–å®æˆ˜æŒ‡å—ï¼šä»åŠ è½½åˆ°æ¸²æŸ“çš„å…¨æ–¹ä½ä¼˜åŒ– åœ¨å½“ä»Šçš„Webåº”ç”¨ä¸­ï¼Œæ€§èƒ½ä¼˜åŒ–å·²ç»æˆä¸ºäº†å¼€å‘è¿‡ç¨‹ä¸­çš„å¿…å¤‡æŠ€èƒ½ã€‚ä¸€ä¸ªæ€§èƒ½ä¼˜ç§€çš„åº”ç”¨ä¸ä»…èƒ½æä¾›æ›´å¥½çš„ç”¨æˆ·ä½“éªŒï¼Œè¿˜èƒ½æé«˜è½¬åŒ–ç‡å’Œç”¨æˆ·ç•™å­˜ç‡ã€‚æœ¬æ–‡å°†ä»å¤šä¸ªç»´åº¦ä»‹ç»å‰ç«¯æ€§èƒ½ä¼˜åŒ–çš„å®æˆ˜æŠ€å·§ã€‚\nåŠ è½½æ€§èƒ½ä¼˜åŒ– 1. èµ„æºå‹ç¼©å’Œåˆå¹¶ JavaScriptå‹ç¼©\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 // webpack.config.js module.exports = { optimization: { minimize: true, splitChunks: { chunks: \u0026#39;all\u0026#39;, cacheGroups: { vendor: { test: /[\\\\/]node_modules[\\\\/]/, name: \u0026#39;vendors\u0026#39;, chunks: \u0026#39;all\u0026#39;, } } } } } CSSå‹ç¼©å’Œä¼˜åŒ–\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 /* ä½¿ç”¨CSSå˜é‡å‡å°‘é‡å¤ä»£ç  */ :root { --primary-color: #1890ff; --font-size-base: 14px; --spacing-sm: 8px; } /* é¿å…ä½¿ç”¨@import */ /* ä¸æ¨è */ @import url(\u0026#34;reset.css\u0026#34;); @import url(\u0026#34;components.css\u0026#34;); /* æ¨è */ \u0026lt;link rel=\u0026#34;stylesheet\u0026#34; href=\u0026#34;reset.css\u0026#34;\u0026gt; \u0026lt;link rel=\u0026#34;stylesheet\u0026#34; href=\u0026#34;components.css\u0026#34;\u0026gt; 2. å›¾ç‰‡ä¼˜åŒ– ç°ä»£å›¾ç‰‡æ ¼å¼ä½¿ç”¨\n1 2 3 4 5 6 \u0026lt;!-- WebPæ ¼å¼ï¼Œæä¾›æ›´å¥½çš„å‹ç¼©ç‡ --\u0026gt; \u0026lt;picture\u0026gt; \u0026lt;source srcset=\u0026#34;image.webp\u0026#34; type=\u0026#34;image/webp\u0026#34;\u0026gt; \u0026lt;source srcset=\u0026#34;image.avif\u0026#34; type=\u0026#34;image/avif\u0026#34;\u0026gt; \u0026lt;img src=\u0026#34;image.jpg\u0026#34; alt=\u0026#34;æè¿°\u0026#34; loading=\u0026#34;lazy\u0026#34;\u0026gt; \u0026lt;/picture\u0026gt; å›¾ç‰‡æ‡’åŠ è½½\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 // Intersection Observer API const imageObserver = new IntersectionObserver((entries) =\u0026gt; { entries.forEach(entry =\u0026gt; { if (entry.isIntersecting) { const img = entry.target img.src = img.dataset.src imageObserver.unobserve(img) } }) }) document.querySelectorAll(\u0026#39;img[data-src]\u0026#39;).forEach(img =\u0026gt; { imageObserver.observe(img) }) å“åº”å¼å›¾ç‰‡\n1 2 3 4 5 \u0026lt;!-- æ ¹æ®è®¾å¤‡åƒç´ æ¯”é€‰æ‹©åˆé€‚çš„å›¾ç‰‡ --\u0026gt; \u0026lt;img src=\u0026#34;image-small.jpg\u0026#34; srcset=\u0026#34;image-medium.jpg 2x, image-large.jpg 3x\u0026#34; alt=\u0026#34;å“åº”å¼å›¾ç‰‡\u0026#34;\u0026gt; 3. ç¼“å­˜ç­–ç•¥ HTTPç¼“å­˜å¤´è®¾ç½®\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 // æœåŠ¡ç«¯é…ç½® const cacheConfig = { static: { maxAge: 31536000, // 1å¹´ mustRevalidate: false }, html: { maxAge: 0, mustRevalidate: true }, api: { maxAge: 300, // 5åˆ†é’Ÿ mustRevalidate: true } } // Service Workerç¼“å­˜ self.addEventListener(\u0026#39;fetch\u0026#39;, event =\u0026gt; { if (event.request.destination === \u0026#39;image\u0026#39;) { event.respondWith( caches.match(event.request).then(response =\u0026gt; { return response || fetch(event.request) }) ) } }) æ¸²æŸ“æ€§èƒ½ä¼˜åŒ– 1. å‡å°‘é‡æ’å’Œé‡ç»˜ æ‰¹é‡DOMæ“ä½œ\n1 2 3 4 5 6 7 8 9 10 11 12 13 // ä¸æ¨èï¼šé¢‘ç¹æ“ä½œDOM for (let i = 0; i \u0026lt; 1000; i++) { document.body.innerHTML += `\u0026lt;div\u0026gt;${i}\u0026lt;/div\u0026gt;` } // æ¨èï¼šä½¿ç”¨DocumentFragment const fragment = document.createDocumentFragment() for (let i = 0; i \u0026lt; 1000; i++) { const div = document.createElement(\u0026#39;div\u0026#39;) div.textContent = i fragment.appendChild(div) } document.body.appendChild(fragment) ä½¿ç”¨è™šæ‹Ÿæ»šåŠ¨\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 class VirtualList { constructor(container, itemHeight, renderItem) { this.container = container this.itemHeight = itemHeight this.renderItem = renderItem this.visibleCount = Math.ceil(container.clientHeight / itemHeight) this.bufferSize = 5 this.init() } init() { this.container.addEventListener(\u0026#39;scroll\u0026#39;, this.handleScroll.bind(this)) this.render() } handleScroll() { this.render() } render() { const scrollTop = this.container.scrollTop const startIndex = Math.floor(scrollTop / this.itemHeight) const endIndex = startIndex + this.visibleCount + this.bufferSize // åªæ¸²æŸ“å¯è§åŒºåŸŸçš„å…ƒç´  this.renderItems(startIndex, endIndex) } } 2. CSSä¼˜åŒ– é¿å…å¤æ‚é€‰æ‹©å™¨\n1 2 3 4 5 6 7 8 9 /* ä¸æ¨èï¼šè¿‡æ·±çš„åµŒå¥— */ .header .nav .menu .item .link .icon { color: blue; } /* æ¨èï¼šæ‰å¹³çš„é€‰æ‹©å™¨ */ .nav-link-icon { color: blue; } ä½¿ç”¨CSS Containment\n1 2 3 4 5 6 7 8 .item { contain: layout style paint; /* layout: å…ƒç´ å†…éƒ¨çš„å¸ƒå±€å˜åŒ–ä¸ä¼šå½±å“å¤–éƒ¨ style: å…ƒç´ çš„æ ·å¼å˜åŒ–ä¸ä¼šå½±å“å¤–éƒ¨ paint: å…ƒç´ çš„ç»˜åˆ¶å˜åŒ–ä¸ä¼šå½±å“å¤–éƒ¨ */ } ä¼˜åŒ–åŠ¨ç”»æ€§èƒ½\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 /* ä½¿ç”¨transformå’Œopacityè¿›è¡ŒåŠ¨ç”» */ .animate-element { transform: translateX(0); opacity: 1; transition: transform 0.3s, opacity 0.3s; } .animate-element:hover { transform: translateX(100px); opacity: 0.8; } /* é¿å…è§¦å‘å¸ƒå±€ */ .animate-element { will-change: transform, opacity; /* æå‰å‘ŠçŸ¥æµè§ˆå™¨å°†è¦å˜åŒ–çš„å±æ€§ */ } JavaScriptæ€§èƒ½ä¼˜åŒ– 1. ä»£ç åˆ†å‰²å’Œæ‡’åŠ è½½ è·¯ç”±çº§åˆ«çš„ä»£ç åˆ†å‰²\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 // åŠ¨æ€å¯¼å…¥ç»„ä»¶ const LazyComponent = React.lazy(() =\u0026gt; import(\u0026#39;./LazyComponent\u0026#39;)) // è·¯ç”±é…ç½® const routes = [ { path: \u0026#39;/dashboard\u0026#39;, component: () =\u0026gt; import(\u0026#39;./Dashboard\u0026#39;) }, { path: \u0026#39;/settings\u0026#39;, component: () =\u0026gt; import(\u0026#39;./Settings\u0026#39;) } ] ç»„ä»¶æ‡’åŠ è½½\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 class LazyLoader { constructor() { this.observer = new IntersectionObserver((entries) =\u0026gt; { entries.forEach(entry =\u0026gt; { if (entry.isIntersecting) { this.loadComponent(entry.target) } }) }) } observe(element) { this.observer.observe(element) } async loadComponent(element) { const componentName = element.dataset.component const module = await import(`./components/${componentName}.js`) const Component = module.default new Component(element) } } 2. ç®—æ³•ä¼˜åŒ– é˜²æŠ–å’ŒèŠ‚æµ\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 // é˜²æŠ–ï¼šå»¶è¿Ÿæ‰§è¡Œï¼Œåœ¨æŒ‡å®šæ—¶é—´å†…æ²¡æœ‰å†æ¬¡è§¦å‘æ‰æ‰§è¡Œ function debounce(func, delay) { let timeoutId return function (...args) { clearTimeout(timeoutId) timeoutId = setTimeout(() =\u0026gt; func.apply(this, args), delay) } } // èŠ‚æµï¼šæŒ‡å®šæ—¶é—´å†…åªæ‰§è¡Œä¸€æ¬¡ function throttle(func, delay) { let lastCall = 0 return function (...args) { const now = Date.now() if (now - lastCall \u0026gt;= delay) { lastCall = now func.apply(this, args) } } } // ä½¿ç”¨ç¤ºä¾‹ const handleResize = debounce(() =\u0026gt; { console.log(\u0026#39;Window resized\u0026#39;) }, 300) const handleScroll = throttle(() =\u0026gt; { console.log(\u0026#39;Page scrolled\u0026#39;) }, 100) å¤§æ•°æ®å¤„ç†ä¼˜åŒ–\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 // ä½¿ç”¨requestAnimationFrameå¤„ç†å¤§é‡æ•°æ® function processLargeData(data, callback) { const chunkSize = 1000 let index = 0 function processChunk() { const endIndex = Math.min(index + chunkSize, data.length) for (let i = index; i \u0026lt; endIndex; i++) { callback(data[i]) } index = endIndex if (index \u0026lt; data.length) { requestAnimationFrame(processChunk) } } processChunk() } // ä½¿ç”¨Web Workerå¤„ç†CPUå¯†é›†å‹ä»»åŠ¡ const worker = new Worker(\u0026#39;data-processor.js\u0026#39;) worker.postMessage({ type: \u0026#39;process\u0026#39;, data: largeData }) worker.onmessage = (event) =\u0026gt; { const result = event.data console.log(\u0026#39;å¤„ç†ç»“æœ:\u0026#39;, result) } å†…å­˜ç®¡ç†ä¼˜åŒ– 1. å†…å­˜æ³„æ¼æ£€æµ‹ å¸¸è§å†…å­˜æ³„æ¼åœºæ™¯\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 // 1. äº‹ä»¶ç›‘å¬å™¨æœªæ¸…ç† class Component { constructor(element) { this.element = element this.handleClick = this.handleClick.bind(this) this.element.addEventListener(\u0026#39;click\u0026#39;, this.handleClick) } handleClick(e) { console.log(\u0026#39;Clicked\u0026#39;, e) } destroy() { this.element.removeEventListener(\u0026#39;click\u0026#39;, this.handleClick) this.element = null } } // 2. å®šæ—¶å™¨æœªæ¸…ç† class Timer { constructor() { this.timers = [] } setTimer(callback, delay) { const timerId = setTimeout(() =\u0026gt; { callback() this.timers = this.timers.filter(id =\u0026gt; id !== timerId) }, delay) this.timers.push(timerId) return timerId } clearAllTimers() { this.timers.forEach(timerId =\u0026gt; clearTimeout(timerId)) this.timers = [] } } 2. å¯¹è±¡æ± æ¨¡å¼ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 class ObjectPool { constructor(createFn, resetFn) { this.pool = [] this.createFn = createFn this.resetFn = resetFn } acquire() { if (this.pool.length \u0026gt; 0) { return this.pool.pop() } return this.createFn() } release(obj) { this.resetFn(obj) this.pool.push(obj) } } // ä½¿ç”¨ç¤ºä¾‹ const vectorPool = new ObjectPool( () =\u0026gt; ({ x: 0, y: 0, z: 0 }), (obj) =\u0026gt; { obj.x = 0; obj.y = 0; obj.z = 0 } ) function processVectors() { const vectors = [] for (let i = 0; i \u0026lt; 1000; i++) { const vector = vectorPool.acquire() // å¤„ç†vector... vectors.push(vector) } // é‡Šæ”¾å›å¯¹è±¡æ±  vectors.forEach(vector =\u0026gt; vectorPool.release(vector)) } æ€§èƒ½ç›‘æ§ 1. æ€§èƒ½æŒ‡æ ‡æ”¶é›† Web Vitals\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 import { getCLS, getFID, getFCP, getLCP } from \u0026#39;web-vitals\u0026#39; // æ”¶é›†æ ¸å¿ƒæ€§èƒ½æŒ‡æ ‡ function collectMetrics() { getCLS(console.log) getFID(console.log) getFCP(console.log) getLCP(console.log) } // è‡ªå®šä¹‰æ€§èƒ½æŒ‡æ ‡ function measurePerformance(name, fn) { const startTime = performance.now() const result = fn() const endTime = performance.now() console.log(`${name}: ${endTime - startTime}ms`) return result } 2. æ€§èƒ½åˆ†æå·¥å…· Chrome DevTools Performance\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 // æ ‡è®°æ€§èƒ½å…³é”®ç‚¹ performance.mark(\u0026#39;start-operation\u0026#39;) // æ‰§è¡Œä¸€äº›æ“ä½œ doSomeWork() performance.mark(\u0026#39;end-operation\u0026#39;) performance.measure(\u0026#39;operation-duration\u0026#39;, \u0026#39;start-operation\u0026#39;, \u0026#39;end-operation\u0026#39;) // åˆ†ææ€§èƒ½æ•°æ® const measures = performance.getEntriesByType(\u0026#39;measure\u0026#39;) measures.forEach(measure =\u0026gt; { console.log(`${measure.name}: ${measure.duration}ms`) }) å®é™…é¡¹ç›®ä¼˜åŒ–æ¡ˆä¾‹ æ¡ˆä¾‹1ï¼šç”µå•†ç½‘ç«™ä¼˜åŒ– 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 // å›¾ç‰‡æ‡’åŠ è½½å’Œé¢„åŠ è½½ç­–ç•¥ class ImageOptimizer { constructor() { this.observer = new IntersectionObserver(this.handleIntersection.bind(this)) this.preloadQueue = [] } handleIntersection(entries) { entries.forEach(entry =\u0026gt; { if (entry.isIntersecting) { this.loadImage(entry.target) } }) } loadImage(img) { if (img.dataset.src) { img.src = img.dataset.src this.observer.unobserve(img) } } preloadImages(urls) { urls.forEach(url =\u0026gt; { const link = document.createElement(\u0026#39;link\u0026#39;) link.rel = \u0026#39;preload\u0026#39; link.as = \u0026#39;image\u0026#39; link.href = url document.head.appendChild(link) }) } } æ¡ˆä¾‹2ï¼šæ•°æ®è¡¨æ ¼ä¼˜åŒ– 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 // è™šæ‹Ÿæ»šåŠ¨è¡¨æ ¼ class VirtualTable { constructor(container, data, renderItem) { this.container = container this.data = data this.renderItem = renderItem this.rowHeight = 50 this.visibleRows = Math.ceil(container.clientHeight / this.rowHeight) this.bufferSize = 10 this.init() } init() { this.container.addEventListener(\u0026#39;scroll\u0026#39;, this.handleScroll.bind(this)) this.render() } handleScroll() { this.render() } render() { const scrollTop = this.container.scrollTop const startIndex = Math.floor(scrollTop / this.rowHeight) const endIndex = startIndex + this.visibleRows + this.bufferSize this.renderRows(startIndex, endIndex) } renderRows(startIndex, endIndex) { const fragment = document.createDocumentFragment() for (let i = startIndex; i \u0026lt;= endIndex \u0026amp;\u0026amp; i \u0026lt; this.data.length; i++) { const row = this.renderItem(this.data[i], i) fragment.appendChild(row) } this.container.innerHTML = \u0026#39;\u0026#39; this.container.appendChild(fragment) } } æ€§èƒ½ä¼˜åŒ–æ£€æŸ¥æ¸…å• åŠ è½½æ€§èƒ½ å‹ç¼©å’Œåˆå¹¶CSS/JSæ–‡ä»¶ ä¼˜åŒ–å›¾ç‰‡æ ¼å¼å’Œå¤§å° å®ç°èµ„æºæ‡’åŠ è½½ é…ç½®åˆç†çš„ç¼“å­˜ç­–ç•¥ ä½¿ç”¨CDNåŠ é€Ÿ æ¸²æŸ“æ€§èƒ½ å‡å°‘DOMæ“ä½œæ¬¡æ•° é¿å…å¼ºåˆ¶åŒæ­¥å¸ƒå±€ ä¼˜åŒ–CSSé€‰æ‹©å™¨ ä½¿ç”¨CSSåŠ¨ç”»æ›¿ä»£JSåŠ¨ç”» å®ç°è™šæ‹Ÿæ»šåŠ¨ JavaScriptæ€§èƒ½ å®ç°ä»£ç åˆ†å‰² ä½¿ç”¨é˜²æŠ–å’ŒèŠ‚æµ ä¼˜åŒ–ç®—æ³•å¤æ‚åº¦ é¿å…å†…å­˜æ³„æ¼ ä½¿ç”¨Web Workerå¤„ç†è®¡ç®—å¯†é›†å‹ä»»åŠ¡ ç›‘æ§å’Œåˆ†æ é›†æˆWeb Vitals è®¾ç½®æ€§èƒ½é¢„ç®— å®šæœŸè¿›è¡Œæ€§èƒ½æµ‹è¯• ä½¿ç”¨æ€§èƒ½åˆ†æå·¥å…· å»ºç«‹æ€§èƒ½ç›‘æ§ä½“ç³» æ€»ç»“ å‰ç«¯æ€§èƒ½ä¼˜åŒ–æ˜¯ä¸€ä¸ªæŒç»­çš„è¿‡ç¨‹ï¼Œéœ€è¦æˆ‘ä»¬åœ¨å¼€å‘çš„æ¯ä¸ªé˜¶æ®µéƒ½è€ƒè™‘åˆ°æ€§èƒ½å½±å“ã€‚é€šè¿‡åˆç†çš„ä¼˜åŒ–ç­–ç•¥å’ŒæŒç»­çš„æ€§èƒ½ç›‘æ§ï¼Œæˆ‘ä»¬å¯ä»¥æ„å»ºå‡ºæ›´å¿«é€Ÿã€æ›´æµç•…çš„Webåº”ç”¨ã€‚\nè®°ä½ï¼Œæ€§èƒ½ä¼˜åŒ–çš„æœ€ç»ˆç›®æ ‡æ˜¯æå‡ç”¨æˆ·ä½“éªŒï¼Œè€Œä¸æ˜¯ç›²ç›®è¿½æ±‚æè‡´çš„æ€§èƒ½æŒ‡æ ‡ã€‚åœ¨ä¼˜åŒ–æ—¶ï¼Œè¦å¹³è¡¡æ€§èƒ½ã€å¼€å‘æˆæœ¬å’Œç»´æŠ¤æˆæœ¬ï¼Œé€‰æ‹©æœ€é€‚åˆé¡¹ç›®çš„ä¼˜åŒ–æ–¹æ¡ˆã€‚\n","permalink":"/blog/articles/frontend-performance-optimization/","summary":"å…¨é¢ä»‹ç»å‰ç«¯æ€§èƒ½ä¼˜åŒ–çš„æ–¹æ³•å’ŒæŠ€å·§ï¼Œæ¶µç›–åŠ è½½ã€æ¸²æŸ“ã€åŠ¨ç”»ã€å†…å­˜ç®¡ç†ç­‰å¤šä¸ªæ–¹é¢çš„å®æˆ˜ç»éªŒ","title":"å‰ç«¯æ€§èƒ½ä¼˜åŒ–å®æˆ˜æŒ‡å—ï¼šä»åŠ è½½åˆ°æ¸²æŸ“çš„å…¨æ–¹ä½ä¼˜åŒ–"},{"content":"TypeScriptç±»å‹ä½“æ“ï¼šä»åŸºç¡€åˆ°é«˜çº§çš„30ä¸ªç»ƒä¹  TypeScriptçš„ç±»å‹ç³»ç»Ÿæ˜¯å…¶æœ€å¼ºå¤§çš„ç‰¹æ€§ä¹‹ä¸€ã€‚é€šè¿‡\u0026quot;ç±»å‹ä½“æ“\u0026quot;ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨ç±»å‹ç³»ç»Ÿæ¥è§£å†³å¤æ‚çš„é—®é¢˜ï¼Œç”šè‡³åœ¨ç¼–è¯‘é˜¶æ®µå°±å‘ç°æ½œåœ¨çš„é”™è¯¯ã€‚æœ¬æ–‡å°†é€šè¿‡30ä¸ªç”±æµ…å…¥æ·±çš„ç»ƒä¹ ï¼Œå¸®åŠ©ä½ æŒæ¡TypeScriptç±»å‹ç¼–ç¨‹çš„ç²¾é«“ã€‚\nåŸºç¡€ç±»å‹æ“ä½œï¼ˆ1-10ï¼‰ ç»ƒä¹ 1ï¼šåŸºç¡€ç±»å‹æå– 1 2 3 4 5 type MyType = string | number | boolean // æå–stringç±»å‹ type ExtractString\u0026lt;T\u0026gt; = T extends string ? T : never type StringOnly = ExtractString\u0026lt;MyType\u0026gt; // string ç»ƒä¹ 2ï¼šç±»å‹æ’é™¤ 1 2 3 4 5 type AllTypes = string | number | boolean | object | undefined | null // æ’é™¤undefinedå’Œnull type NonNullable\u0026lt;T\u0026gt; = T extends null | undefined ? never : T type DefinedTypes = NonNullable\u0026lt;AllTypes\u0026gt; // string | number | boolean | object ç»ƒä¹ 3ï¼šå‡½æ•°å‚æ•°ç±»å‹æå– 1 2 3 4 5 type MyFunction = (a: number, b: string) =\u0026gt; boolean // æå–å‡½æ•°å‚æ•°ç±»å‹ type GetParams\u0026lt;T\u0026gt; = T extends (...args: infer P) =\u0026gt; any ? P : never type Params = GetParams\u0026lt;MyFunction\u0026gt; // [number, string] ç»ƒä¹ 4ï¼šå‡½æ•°è¿”å›ç±»å‹æå– 1 2 3 4 5 type GetUserFn = (id: number) =\u0026gt; { name: string; age: number } // æå–å‡½æ•°è¿”å›ç±»å‹ type GetReturnType\u0026lt;T\u0026gt; = T extends (...args: any[]) =\u0026gt; infer R ? R : never type UserType = GetReturnType\u0026lt;GetUserFn\u0026gt; // { name: string; age: number } ç»ƒä¹ 5ï¼šæ•°ç»„å…ƒç´ ç±»å‹æå– 1 2 3 4 5 6 7 8 type StringArray = Array\u0026lt;string\u0026gt; type NumberTuple = [number, number, number] // æå–æ•°ç»„å…ƒç´ ç±»å‹ type ArrayElement\u0026lt;T\u0026gt; = T extends (infer U)[] ? U : never type TupleElement\u0026lt;T\u0026gt; = T extends [infer U] extends T ? U : never type ArrayItem = ArrayElement\u0026lt;StringArray\u0026gt; // string type TupleItem = TupleElement\u0026lt;NumberTuple\u0026gt; // number ç»ƒä¹ 6ï¼šé¦–å°¾å…ƒç´ ç±»å‹æå– 1 2 3 4 5 6 7 8 9 type Tuple = [string, number, boolean] // æå–é¦–å…ƒç´  type First\u0026lt;T\u0026gt; = T extends [infer F, ...any[]] ? F : never // æå–å°¾å…ƒç´  type Last\u0026lt;T\u0026gt; = T extends [...any[], infer L] ? L : never type FirstElement = First\u0026lt;Tuple\u0026gt; // string type LastElement = Last\u0026lt;Tuple\u0026gt; // boolean ç»ƒä¹ 7ï¼šå¯¹è±¡å±æ€§ç±»å‹æå– 1 2 3 4 5 6 7 8 9 interface User { name: string age: number email: string } // æå–æ‰€æœ‰å€¼çš„ç±»å‹ type Values\u0026lt;T\u0026gt; = T[keyof T] type UserValues = Values\u0026lt;User\u0026gt; // string | number ç»ƒä¹ 8ï¼šå¯é€‰å±æ€§ç±»å‹ 1 2 3 4 5 6 7 8 9 10 11 12 13 interface Config { required: string optional?: number } // å°†æ‰€æœ‰å±æ€§å˜ä¸ºå¯é€‰ type Partial\u0026lt;T\u0026gt; = { [P in keyof T]?: T[P] } // å°†æ‰€æœ‰å±æ€§å˜ä¸ºå¿…éœ€ type Required\u0026lt;T\u0026gt; = { [P in keyof T]-?: T[P] } ç»ƒä¹ 9ï¼šåªè¯»/å¯å†™å±æ€§ 1 2 3 4 5 6 7 type ReadOnly\u0026lt;T\u0026gt; = { readonly [P in keyof T]: T[P] } type WriteOnly\u0026lt;T\u0026gt; = { -readonly [P in keyof T]: T[P] } ç»ƒä¹ 10ï¼šå­—ç¬¦ä¸²å­—é¢é‡æ“ä½œ 1 2 3 4 5 type Status = \u0026#39;pending\u0026#39; | \u0026#39;success\u0026#39; | \u0026#39;failed\u0026#39; // è½¬æ¢ä¸ºå¤§å†™ type UpperCase\u0026lt;T\u0026gt; = T extends string ? Uppercase\u0026lt;T\u0026gt; : never type UpperStatus = UpperCase\u0026lt;Status\u0026gt; // \u0026#39;PENDING\u0026#39; | \u0026#39;SUCCESS\u0026#39; | \u0026#39;FAILED\u0026#39; ä¸­çº§ç±»å‹æ“ä½œï¼ˆ11-20ï¼‰ ç»ƒä¹ 11ï¼šæ·±åº¦åªè¯» 1 2 3 4 5 6 7 8 9 10 11 12 13 14 type DeepReadonly\u0026lt;T\u0026gt; = { readonly [P in keyof T]: T[P] extends object ? DeepReadonly\u0026lt;T[P]\u0026gt; : T[P] } interface NestedObject { user: { name: string details: { age: number } } } type ReadOnlyNested = DeepReadonly\u0026lt;NestedObject\u0026gt; ç»ƒä¹ 12ï¼šæ¡ä»¶ç±»å‹æ¨æ–­ 1 2 3 type IsString\u0026lt;T\u0026gt; = T extends string ? true : false type TestString = IsString\u0026lt;\u0026#34;hello\u0026#34;\u0026gt; // true type TestNumber = IsString\u0026lt;123\u0026gt; // false ç»ƒä¹ 13ï¼šå…ƒç»„è½¬è”åˆç±»å‹ 1 2 3 4 type Tuple = [string, number, boolean] type TupleToUnion\u0026lt;T\u0026gt; = T extends (infer U)[] ? U : never type Union = TupleToUnion\u0026lt;Tuple\u0026gt; // string | number | boolean ç»ƒä¹ 14ï¼šè”åˆç±»å‹è½¬å…ƒç»„ 1 2 3 4 5 type Union = string | number | boolean type UnionToTuple\u0026lt;T, A extends readonly unknown[] = []\u0026gt; = T extends infer U ? [...A, U] : never type Tuple = UnionToTuple\u0026lt;Union\u0026gt; // [string, number, boolean] é¡ºåºå¯èƒ½ä¸åŒ ç»ƒä¹ 15ï¼šåµŒå¥—æ•°ç»„æ‰å¹³åŒ– 1 2 3 4 type Flatten\u0026lt;T\u0026gt; = T extends readonly (infer U)[] ? Flatten\u0026lt;U\u0026gt; : T type DeepArray = [1, [2, [3, 4], 5], 6] type FlatArray = Flatten\u0026lt;DeepArray\u0026gt; // 1 | 2 | 3 | 4 | 5 | 6 ç»ƒä¹ 16ï¼šå¯¹è±¡é”®åæ“ä½œ 1 2 3 4 5 6 7 8 9 10 11 interface User { userName: string userAge: number userActive: boolean } // ç§»é™¤å‰ç¼€ type RemovePrefix\u0026lt;T, P extends string\u0026gt; = T extends `${P}${infer R}` ? R : T type CleanKeys = RemovePrefix\u0026lt;keyof User, \u0026#39;user\u0026#39;\u0026gt; // \u0026#39;Name\u0026#39; | \u0026#39;Age\u0026#39; | \u0026#39;Active\u0026#39; ç»ƒä¹ 17ï¼šå¯¹è±¡ç±»å‹é‡æ˜ å°„ 1 2 3 4 5 6 7 8 9 10 11 type MapTypes\u0026lt;T, TFrom, TTo\u0026gt; = { [K in keyof T]: T[K] extends TFrom ? TTo : T[K] } interface Response { id: number data: string timestamp: number } type StringifiedResponse = MapTypes\u0026lt;Response, number | string, string\u0026gt; ç»ƒä¹ 18ï¼šå‡½æ•°ç±»å‹ç»„åˆ 1 2 3 4 5 6 7 8 9 type Fn1 = (a: number) =\u0026gt; string type Fn2 = (b: string) =\u0026gt; boolean // å‡½æ•°ç»„åˆ type Compose\u0026lt;T, U\u0026gt; = T extends (...args: any[]) =\u0026gt; infer R ? U extends (arg: R) =\u0026gt; infer S ? (...args: Parameters\u0026lt;T\u0026gt;) =\u0026gt; S : never type ComposedFn = Compose\u0026lt;Fn1, Fn2\u0026gt; ç»ƒä¹ 19ï¼šæ•°å­—èŒƒå›´é™åˆ¶ 1 2 3 4 5 6 // é™åˆ¶æ•°å­—åœ¨æŸä¸ªèŒƒå›´å†… type Range\u0026lt;N extends number, Min extends number, Max extends number\u0026gt; = N extends Min ? (N extends Max ? N : never) : never type TestRange = Range\u0026lt;50, 10, 100\u0026gt; // 50 type TestOutOfRange = Range\u0026lt;5, 10, 100\u0026gt; // never ç»ƒä¹ 20ï¼šé€’å½’ç±»å‹æ“ä½œ 1 2 3 4 5 6 // è®¡ç®—æ–æ³¢é‚£å¥‘æ•°åˆ— type Fibonacci\u0026lt;N extends number, A extends number = 0, B extends number = 1\u0026gt; = N extends 0 ? A : N extends 1 ? B : Fibonacci\u0026lt;N - 1, B, A + B\u0026gt; type Fib5 = Fibonacci\u0026lt;5\u0026gt; // 5 type Fib10 = Fibonacci\u0026lt;10\u0026gt; // 55 é«˜çº§ç±»å‹æ“ä½œï¼ˆ21-30ï¼‰ ç»ƒä¹ 21ï¼šç±»å‹çº§è·¯ç”±åŒ¹é… 1 2 3 4 5 6 7 8 9 10 type Route = \u0026#39;/users/:id\u0026#39; | \u0026#39;/posts/:postId/comments/:commentId\u0026#39; type ExtractParams\u0026lt;T extends string\u0026gt; = T extends `${infer Start}:${infer Param}/${infer Rest}` ? Param | ExtractParams\u0026lt;Rest\u0026gt; : T extends `${infer Start}:${infer Param}` ? Param : never type RouteParams = ExtractParams\u0026lt;Route\u0026gt; // \u0026#39;id\u0026#39; | \u0026#39;postId\u0026#39; | \u0026#39;commentId\u0026#39; ç»ƒä¹ 22ï¼šJSONè§£æå™¨ 1 2 3 4 5 6 7 8 9 10 11 type JsonString = string type ParseJson\u0026lt;T extends JsonString\u0026gt; = T extends `{${infer Key}:${infer Value}` ? Key extends infer K ? Value extends infer V ? { [P in K]: ParseJson\u0026lt;V\u0026gt; } : never : never : T extends `[]` ? any[] : T extends `${infer Val}` ? Val : never ç»ƒä¹ 23ï¼šç±»å‹çº§è®¡ç®—å™¨ 1 2 3 4 5 6 7 8 // åŠ æ³•è¿ç®— type Add\u0026lt;A extends number, B extends number\u0026gt; = [...TupleOf\u0026lt;A\u0026gt;, ...TupleOf\u0026lt;B\u0026gt;][\u0026#39;length\u0026#39;] type TupleOf\u0026lt;T extends number, R extends readonly unknown[] = []\u0026gt; = R[\u0026#39;length\u0026#39;] extends T ? R : TupleOf\u0026lt;T, [...R, unknown]\u0026gt; type Result = Add\u0026lt;3, 5\u0026gt; // 8 ç»ƒä¹ 24ï¼šç±»å‹éªŒè¯å™¨ 1 2 3 4 5 type ValidateEmail\u0026lt;T extends string\u0026gt; = T extends `${string}@${string}.${string}` ? true : false type ValidEmail = ValidateEmail\u0026lt;\u0026#34;test@example.com\u0026#34;\u0026gt; // true type InvalidEmail = ValidateEmail\u0026lt;\u0026#34;invalid\u0026#34;\u0026gt; // false ç»ƒä¹ 25ï¼šç±»å‹çº§SQLæŸ¥è¯¢æ„å»º 1 2 3 4 5 6 7 8 9 10 11 12 13 interface User { id: number name: string age: number email: string } type Select\u0026lt;T, K extends keyof T\u0026gt; = { [P in K]: T[P] } type UserSelect = Select\u0026lt;User, \u0026#39;id\u0026#39; | \u0026#39;name\u0026#39;\u0026gt; // { id: number; name: number } ç»ƒä¹ 26ï¼šç±»å‹çº§CSSç”Ÿæˆ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 type CSSValue = string | number type CSSProperty\u0026lt;T extends CSSValue\u0026gt; = { value: T unit: T extends number ? \u0026#39;px\u0026#39; | \u0026#39;em\u0026#39; | \u0026#39;%\u0026#39; : never } type CreateStyle\u0026lt;P extends Record\u0026lt;string, CSSValue\u0026gt;\u0026gt; = { [K in keyof P]: CSSProperty\u0026lt;P[K]\u0026gt; } type StyleProps = { width: 100 height: 200 color: \u0026#39;red\u0026#39; } type StyleObject = CreateStyle\u0026lt;StyleProps\u0026gt; ç»ƒä¹ 27ï¼šç±»å‹çº§æ—¥æœŸæ ¼å¼åŒ– 1 2 3 4 5 6 type FormatDate\u0026lt;T extends string\u0026gt; = T extends `${infer Year}-${infer Month}-${infer Day}` ? `${Year}/${Month}/${Day}` : never type FormattedDate = FormatDate\u0026lt;\u0026#34;2023-12-25\u0026#34;\u0026gt; // \u0026#34;2023/12/25\u0026#34; ç»ƒä¹ 28ï¼šç±»å‹çº§æ•°ç»„æ“ä½œ 1 2 3 4 5 6 7 8 9 10 11 // æ•°ç»„é•¿åº¦ type Length\u0026lt;T extends readonly unknown[]\u0026gt; = T[\u0026#39;length\u0026#39;] // æ•°ç»„å»é‡ type Unique\u0026lt;T\u0026gt; = T extends readonly [infer First, ...infer Rest] ? First extends Rest[number] ? Unique\u0026lt;Rest\u0026gt; : [First, ...Unique\u0026lt;Rest\u0026gt;] : T type LengthResult = Length\u0026lt;[1, 2, 3, 4, 5]\u0026gt; // 5 ç»ƒä¹ 29ï¼šç±»å‹çº§çŠ¶æ€æœº 1 2 3 4 5 6 7 8 9 10 11 12 type State = \u0026#39;idle\u0026#39; | \u0026#39;loading\u0026#39; | \u0026#39;success\u0026#39; | \u0026#39;error\u0026#39; type Transitions = { idle: \u0026#39;loading\u0026#39; loading: \u0026#39;success\u0026#39; | \u0026#39;error\u0026#39; success: \u0026#39;idle\u0026#39; error: \u0026#39;idle\u0026#39; } type NextState\u0026lt;T extends State\u0026gt; = Transitions[T] type FromLoading = NextState\u0026lt;\u0026#39;loading\u0026#39;\u0026gt; // \u0026#39;success\u0026#39; | \u0026#39;error\u0026#39; ç»ƒä¹ 30ï¼šç±»å‹çº§ç±»å‹æ£€æŸ¥å™¨ 1 2 3 4 5 6 7 8 type IsEqual\u0026lt;A, B\u0026gt; = (\u0026lt;T\u0026gt;() =\u0026gt; T extends A ? 1 : 2) extends (\u0026lt;T\u0026gt;() =\u0026gt; T extends B ? 1 : 2) ? true : false type Test1 = IsEqual\u0026lt;string, string\u0026gt; // true type Test2 = IsEqual\u0026lt;string, number\u0026gt; // false å®é™…åº”ç”¨åœºæ™¯ åœºæ™¯1ï¼šAPIå“åº”ç±»å‹éªŒè¯ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 interface ApiResponse\u0026lt;T, E\u0026gt; { data?: T error?: E status: \u0026#39;success\u0026#39; | \u0026#39;error\u0026#39; } type ValidateResponse\u0026lt;T, E\u0026gt; = ApiResponse\u0026lt;T, E\u0026gt; extends infer R ? R extends { status: \u0026#39;success\u0026#39; } ? R[\u0026#39;data\u0026#39;] extends T ? true : false : false : false type IsValid = ValidateResponse\u0026lt;{ id: number }, string\u0026gt; åœºæ™¯2ï¼šè¡¨å•éªŒè¯å™¨ 1 2 3 4 5 6 7 8 9 10 11 interface FormRules { [field: string]: (value: any) =\u0026gt; boolean | string } type ValidateForm\u0026lt;T\u0026gt; = { [K in keyof T]: T[K] extends (value: infer V) =\u0026gt; infer R ? V extends R ? true : false : false } æ€»ç»“ TypeScriptç±»å‹ä½“æ“ä¸ä»…ä»…æ˜¯æŠ€æœ¯æŒ‘æˆ˜ï¼Œæ›´æ˜¯ç¼–ç¨‹æ€ç»´çš„é”»ç‚¼ã€‚é€šè¿‡è¿™äº›ç»ƒä¹ ï¼Œä½ å¯ä»¥ï¼š\næ·±å…¥ç†è§£ç±»å‹ç³»ç»Ÿï¼šæŒæ¡TypeScriptç±»å‹ç³»ç»Ÿçš„å·¥ä½œåŸç† æå‡ä»£ç è´¨é‡ï¼šåœ¨ç¼–è¯‘é˜¶æ®µå‘ç°æ›´å¤šæ½œåœ¨é”™è¯¯ ç¼–å†™æ›´ç²¾ç¡®çš„APIï¼šæä¾›æ›´å¥½çš„ç±»å‹æç¤ºå’Œè‡ªåŠ¨è¡¥å…¨ è§£å†³å¤æ‚é—®é¢˜ï¼šç”¨ç±»å‹ç³»ç»Ÿè§£å†³åŸæœ¬éœ€è¦è¿è¡Œæ—¶æ£€æŸ¥çš„é—®é¢˜ è®°ä½ï¼Œç±»å‹ç¼–ç¨‹çš„ç›®çš„æ˜¯è®©ä»£ç æ›´å®‰å…¨ã€æ›´æ¸…æ™°ã€‚åœ¨è¿½æ±‚ç±»å‹æŠ€å·§çš„åŒæ—¶ï¼Œä¹Ÿè¦ä¿æŒä»£ç çš„å¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚\n","permalink":"/blog/articles/typescript-type-gymnastics/","summary":"é€šè¿‡30ä¸ªç²¾å¿ƒè®¾è®¡çš„TypeScriptç±»å‹ç»ƒä¹ ï¼ŒæŒæ¡ç±»å‹ç¼–ç¨‹çš„ç²¾é«“ï¼Œæå‡ç±»å‹æ¨å¯¼å’Œç±»å‹æ“ä½œèƒ½åŠ›","title":"TypeScriptç±»å‹ä½“æ“ï¼šä»åŸºç¡€åˆ°é«˜çº§çš„30ä¸ªç»ƒä¹ "},{"content":"Vue 3å“åº”å¼åŸç†æ·±å…¥è§£æï¼šä»Proxyåˆ°Composition API Vue 3çš„å‘å¸ƒå¸¦æ¥äº†è®¸å¤šæ¿€åŠ¨äººå¿ƒçš„ç‰¹æ€§ï¼Œå…¶ä¸­æœ€æ ¸å¿ƒçš„å˜åŒ–ä¹‹ä¸€å°±æ˜¯å…¨æ–°çš„å“åº”å¼ç³»ç»Ÿã€‚æœ¬æ–‡å°†æ·±å…¥æ¢è®¨Vue 3å“åº”å¼ç³»ç»Ÿçš„å·¥ä½œåŸç†ï¼Œä»åº•å±‚å®ç°åˆ°ä¸Šå±‚åº”ç”¨ã€‚\nVue 2 vs Vue 3å“åº”å¼ç³»ç»Ÿå¯¹æ¯” Vue 2çš„Object.defineProperty Vue 2ä½¿ç”¨Object.definePropertyæ¥å®ç°å“åº”å¼ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 function defineReactive(obj, key, value) { Object.defineProperty(obj, key, { enumerable: true, configurable: true, get() { // ä¾èµ–æ”¶é›† return value }, set(newValue) { // æ´¾å‘æ›´æ–° value = newValue } }) } é™åˆ¶ï¼š\næ— æ³•æ£€æµ‹æ•°ç»„ç´¢å¼•å’Œé•¿åº¦çš„å˜åŒ– æ— æ³•æ£€æµ‹å¯¹è±¡å±æ€§çš„æ·»åŠ æˆ–åˆ é™¤ æ·±å±‚åµŒå¥—å¯¹è±¡éœ€è¦é€’å½’éå†ï¼Œæ€§èƒ½å¼€é”€å¤§ Vue 3çš„Proxy Vue 3ä½¿ç”¨ES6çš„Proxyæ¥é‡å†™å“åº”å¼ç³»ç»Ÿï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 function reactive(target) { return new Proxy(target, { get(target, key, receiver) { const result = Reflect.get(target, key, receiver) // ä¾èµ–æ”¶é›† track(target, key) return result }, set(target, key, value, receiver) { const result = Reflect.set(target, key, value, receiver) // æ´¾å‘æ›´æ–° trigger(target, key) return result } }) } ä¼˜åŠ¿ï¼š\nå¯ä»¥æ‹¦æˆªæ‰€æœ‰ç±»å‹çš„å¯¹è±¡æ“ä½œ æ— éœ€é¢„å…ˆéå†æ‰€æœ‰å±æ€§ æ”¯æŒæ•°ç»„ã€Mapã€Setç­‰é›†åˆç±»å‹ æ€§èƒ½æ›´ä¼˜ï¼ŒæŒ‰éœ€ä»£ç† å“åº”å¼æ ¸å¿ƒå®ç° 1. ä¾èµ–æ”¶é›†ï¼ˆDependency Collectionï¼‰ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 // å…¨å±€ä¾èµ–æ”¶é›†æ ˆ let activeEffect = null const targetMap = new WeakMap() function track(target, key) { if (!activeEffect) return let depsMap = targetMap.get(target) if (!depsMap) { targetMap.set(target, (depsMap = new Map())) } let deps = depsMap.get(key) if (!deps) { depsMap.set(key, (deps = new Set())) } deps.add(activeEffect) } 2. æ´¾å‘æ›´æ–°ï¼ˆTriggerï¼‰ 1 2 3 4 5 6 7 8 9 10 11 function trigger(target, key) { const depsMap = targetMap.get(target) if (!depsMap) return const deps = depsMap.get(key) if (deps) { deps.forEach(effect =\u0026gt; { effect() }) } } 3. Effectå‰¯ä½œç”¨ 1 2 3 4 5 6 7 8 9 10 11 12 13 function effect(fn, options = {}) { const effect = () =\u0026gt; { try { activeEffect = effect return fn() } finally { activeEffect = null } } effect() return effect } Refå’ŒReactiveçš„åŒºåˆ« refçš„å®ç° 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 class RefImpl { constructor(value) { this._value = value this._rawValue = value this._v_isRef = true } get value() { track(this, \u0026#39;value\u0026#39;) return this._value } set value(newVal) { if (hasChanged(newVal, this._rawValue)) { this._rawValue = newVal this._value = newVal trigger(this, \u0026#39;value\u0026#39;) } } } function ref(value) { return new RefImpl(value) } reactiveçš„å®ç° 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 function reactive(target) { if (!isObject(target)) { return target } return createReactiveObject(target) } function createReactiveObject(target) { if (!Object.isExtensible(target)) { return target } const proxy = new Proxy(target, baseHandlers) return proxy } Composition APIçš„è®¾è®¡æ€æƒ³ 1. å‡½æ•°å¼ç¼–ç¨‹æ€æƒ³ Composition APIé‡‡ç”¨äº†å‡½æ•°å¼ç¼–ç¨‹çš„æ€æƒ³ï¼Œå°†ç›¸å…³çš„é€»è¾‘ç»„ç»‡åœ¨ä¸€èµ·ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 // Vue 2 Options API export default { data() { return { count: 0, name: \u0026#39;Vue\u0026#39; } }, methods: { increment() { this.count++ } }, computed: { doubleCount() { return this.count * 2 } } } // Vue 3 Composition API import { ref, computed } from \u0026#39;vue\u0026#39; export default { setup() { const count = ref(0) const name = ref(\u0026#39;Vue\u0026#39;) const increment = () =\u0026gt; count.value++ const doubleCount = computed(() =\u0026gt; count.value * 2) return { count, name, increment, doubleCount } } } 2. æ›´å¥½çš„é€»è¾‘å¤ç”¨ Composition APIè®©é€»è¾‘å¤ç”¨å˜å¾—æ›´åŠ ç®€å•ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 // è‡ªå®šä¹‰Hook function useCounter(initialValue = 0) { const count = ref(initialValue) const increment = () =\u0026gt; count.value++ const decrement = () =\u0026gt; count.value-- const reset = () =\u0026gt; count.value = initialValue return { count, increment, decrement, reset } } // åœ¨ç»„ä»¶ä¸­ä½¿ç”¨ export default { setup() { const { count, increment } = useCounter(10) return { count, increment } } } æ€§èƒ½ä¼˜åŒ–ç­–ç•¥ 1. æ‡’å“åº”å¼ï¼ˆLazy Reactivityï¼‰ 1 2 3 4 5 6 7 8 9 // åªæœ‰åœ¨è®¿é—®æ—¶æ‰ä¼šåˆ›å»ºä»£ç† function shallowReactive(target) { return createReactiveObject(target, true) } // åªå¯¹ç¬¬ä¸€å±‚å±æ€§è¿›è¡Œå“åº”å¼å¤„ç† function readonly(target) { return createReactiveObject(target, false, true) } 2. æ‰¹é‡æ›´æ–°ä¼˜åŒ– 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 // å°†å¤šä¸ªæ›´æ–°åˆå¹¶ä¸ºä¸€ä¸ªæ‰¹æ¬¡ const queue = [] let isFlushing = false function queueJob(job) { if (!queue.includes(job)) { queue.push(job) } if (!isFlushing) { isFlushing = true Promise.resolve().then(flushJobs) } } function flushJobs() { for (let i = 0; i \u0026lt; queue.length; i++) { queue[i]() } queue.length = 0 isFlushing = false } å®é™…åº”ç”¨åœºæ™¯ 1. å¤æ‚è¡¨å•çš„çŠ¶æ€ç®¡ç† 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 import { reactive, computed } from \u0026#39;vue\u0026#39; export function useFormState(initialState) { const state = reactive(initialState) const errors = reactive({}) const validate = () =\u0026gt; { // éªŒè¯é€»è¾‘ Object.keys(state).forEach(key =\u0026gt; { if (!state[key]) { errors[key] = `${key} is required` } else { delete errors[key] } }) return Object.keys(errors).length === 0 } return { state, errors, validate } } 2. æ•°æ®è·å–å’Œç¼“å­˜ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 import { ref, reactive } from \u0026#39;vue\u0026#39; export function useApi(url) { const data = ref(null) const loading = ref(false) const error = ref(null) const cache = reactive(new Map()) const fetch = async () =\u0026gt; { if (cache.has(url)) { data.value = cache.get(url) return } loading.value = true error.value = null try { const response = await fetch(url) const result = await response.json() data.value = result cache.set(url, result) } catch (err) { error.value = err.message } finally { loading.value = false } } return { data, loading, error, fetch } } æ€»ç»“ Vue 3çš„å“åº”å¼ç³»ç»Ÿé€šè¿‡Proxyå¸¦æ¥äº†ä»¥ä¸‹æ”¹è¿›ï¼š\næ›´å¥½çš„æ€§èƒ½ï¼šæŒ‰éœ€ä»£ç†ï¼Œé¿å…äº†ä¸å¿…è¦çš„æ€§èƒ½å¼€é”€ æ›´å¼ºçš„åŠŸèƒ½ï¼šæ”¯æŒæ›´å¤šæ•°æ®ç±»å‹å’Œæ“ä½œ æ›´ç®€æ´çš„APIï¼šComposition APIæä¾›äº†æ›´çµæ´»çš„ä»£ç ç»„ç»‡æ–¹å¼ æ›´å¥½çš„TypeScriptæ”¯æŒï¼šç±»å‹æ¨æ–­æ›´åŠ å‡†ç¡® ç†è§£Vue 3å“åº”å¼åŸç†ä¸ä»…èƒ½å¸®åŠ©æˆ‘ä»¬æ›´å¥½åœ°ä½¿ç”¨Vueï¼Œä¹Ÿèƒ½å¯å‘æˆ‘ä»¬åœ¨æ—¥å¸¸å¼€å‘ä¸­è®¾è®¡å‡ºæ›´ä¼˜ç§€çš„å“åº”å¼ç³»ç»Ÿã€‚\n","permalink":"/blog/articles/vue3-reactive-system-deep-dive/","summary":"æ·±å…¥è§£æVue 3çš„å“åº”å¼ç³»ç»ŸåŸç†ï¼Œäº†è§£Proxyå¦‚ä½•å®ç°å“åº”å¼ï¼Œä»¥åŠComposition APIèƒŒåçš„è®¾è®¡æ€æƒ³","title":"Vue 3å“åº”å¼åŸç†æ·±å…¥è§£æï¼šä»Proxyåˆ°Composition API"},{"content":"AIåº”ç”¨çš„æ—¶ä»£å·²ç»åˆ°æ¥ äººå·¥æ™ºèƒ½æŠ€æœ¯æ­£ä»¥å‰æ‰€æœªæœ‰çš„é€Ÿåº¦æ”¹å˜ç€æˆ‘ä»¬çš„ç”Ÿæ´»å’Œå·¥ä½œæ–¹å¼ã€‚ä»æ™ºèƒ½æ‰‹æœºçš„è¯­éŸ³åŠ©æ‰‹åˆ°è‡ªåŠ¨é©¾é©¶æ±½è½¦ï¼Œä»åŒ»ç–—è¯Šæ–­åˆ°é‡‘èé£æ§ï¼ŒAIåº”ç”¨å·²ç»æ¸—é€åˆ°å„ä¸ªè¡Œä¸šé¢†åŸŸã€‚\nä»€ä¹ˆæ˜¯AIåº”ç”¨ AIåº”ç”¨æ˜¯æŒ‡åˆ©ç”¨äººå·¥æ™ºèƒ½æŠ€æœ¯ï¼ˆå¦‚æœºå™¨å­¦ä¹ ã€æ·±åº¦å­¦ä¹ ã€è‡ªç„¶è¯­è¨€å¤„ç†ç­‰ï¼‰æ¥è§£å†³å®é™…é—®é¢˜çš„è½¯ä»¶ç³»ç»Ÿæˆ–æœåŠ¡ã€‚è¿™äº›åº”ç”¨èƒ½å¤Ÿæ¨¡æ‹Ÿäººç±»æ™ºèƒ½ï¼Œæ‰§è¡Œéœ€è¦è®¤çŸ¥èƒ½åŠ›çš„ä»»åŠ¡ã€‚\nAIåº”ç”¨çš„æ ¸å¿ƒç‰¹å¾ è‡ªä¸»å­¦ä¹ ï¼šç³»ç»Ÿèƒ½å¤Ÿä»æ•°æ®ä¸­å­¦ä¹ å¹¶ä¸æ–­æ”¹è¿›æ€§èƒ½ æ™ºèƒ½å†³ç­–ï¼šåŸºäºç®—æ³•å’Œæ¨¡å‹åšå‡ºæœ€ä¼˜å†³ç­– è‡ªç„¶äº¤äº’ï¼šæ”¯æŒè¯­éŸ³ã€å›¾åƒã€æ–‡æœ¬ç­‰è‡ªç„¶äº¤äº’æ–¹å¼ å¤§è§„æ¨¡å¤„ç†ï¼šèƒ½å¤Ÿå¤„ç†æµ·é‡æ•°æ®å’Œå¤æ‚è®¡ç®— ä¸»æµAIåº”ç”¨é¢†åŸŸ 1. è‡ªç„¶è¯­è¨€å¤„ç†ï¼ˆNLPï¼‰ è‡ªç„¶è¯­è¨€å¤„ç†æ˜¯AIåº”ç”¨æœ€å¹¿æ³›çš„é¢†åŸŸä¹‹ä¸€ï¼ŒåŒ…æ‹¬ï¼š\næœºå™¨ç¿»è¯‘ï¼šGoogleç¿»è¯‘ã€DeepLç­‰å®æ—¶ç¿»è¯‘æœåŠ¡ æ™ºèƒ½å®¢æœï¼šåŸºäºèŠå¤©æœºå™¨äººçš„å®¢æˆ·æœåŠ¡ç³»ç»Ÿ å†…å®¹ç”Ÿæˆï¼šGPTã€Claudeç­‰å¤§è¯­è¨€æ¨¡å‹åº”ç”¨ æƒ…æ„Ÿåˆ†æï¼šç¤¾äº¤åª’ä½“æƒ…æ„Ÿå€¾å‘åˆ†æ 2. è®¡ç®—æœºè§†è§‰ è®¡ç®—æœºè§†è§‰è®©æœºå™¨èƒ½å¤Ÿç†è§£å’Œè§£é‡Šè§†è§‰ä¿¡æ¯ï¼š\nå›¾åƒè¯†åˆ«ï¼šäººè„¸è¯†åˆ«ã€ç‰©ä½“æ£€æµ‹ã€åœºæ™¯åˆ†ç±» è‡ªåŠ¨é©¾é©¶ï¼šTesla Autopilotã€Waymoç­‰è‡ªåŠ¨é©¾é©¶ç³»ç»Ÿ åŒ»ç–—å½±åƒï¼šXå…‰ç‰‡ã€CTæ‰«æçš„æ™ºèƒ½è¯Šæ–­ å®‰é˜²ç›‘æ§ï¼šæ™ºèƒ½ç›‘æ§ã€å¼‚å¸¸è¡Œä¸ºæ£€æµ‹ 3. æ¨èç³»ç»Ÿ ä¸ªæ€§åŒ–æ¨èå·²ç»æˆä¸ºAIåº”ç”¨çš„æ€æ‰‹çº§åº”ç”¨ï¼š\nç”µå•†æ¨èï¼šæ·˜å®ã€Amazonçš„å•†å“æ¨è å†…å®¹æ¨èï¼šNetflixã€YouTubeçš„å†…å®¹ä¸ªæ€§åŒ– éŸ³ä¹æ¨èï¼šSpotifyã€ç½‘æ˜“äº‘éŸ³ä¹çš„æ™ºèƒ½æ¨è å¦‚ä½•å¼€å§‹æ„å»ºAIåº”ç”¨ ç¬¬ä¸€æ­¥ï¼šæ˜ç¡®é—®é¢˜å®šä¹‰ è¯†åˆ«éœ€è¦è§£å†³çš„ä¸šåŠ¡é—®é¢˜ ç¡®å®šAIæŠ€æœ¯æ˜¯å¦é€‚åˆè¯¥é—®é¢˜ å®šä¹‰æˆåŠŸçš„è¡¡é‡æŒ‡æ ‡ ç¬¬äºŒæ­¥ï¼šæ•°æ®å‡†å¤‡ æ”¶é›†ç›¸å…³æ•°æ®é›† è¿›è¡Œæ•°æ®æ¸…æ´—å’Œé¢„å¤„ç† æ ‡æ³¨å’Œå¢å¼ºæ•°æ® ç¬¬ä¸‰æ­¥ï¼šæŠ€æœ¯é€‰å‹ æ ¹æ®å…·ä½“éœ€æ±‚é€‰æ‹©åˆé€‚çš„æŠ€æœ¯æ ˆï¼š\nä¼ ç»Ÿæœºå™¨å­¦ä¹ ï¼šé€‚ç”¨äºç»“æ„åŒ–æ•°æ®é¢„æµ‹é—®é¢˜ æ·±åº¦å­¦ä¹ ï¼šé€‚åˆå›¾åƒã€è¯­éŸ³ã€æ–‡æœ¬ç­‰éç»“æ„åŒ–æ•°æ® é¢„è®­ç»ƒæ¨¡å‹ï¼šåˆ©ç”¨GPTã€BERTç­‰å¤§æ¨¡å‹å¿«é€Ÿæ„å»ºåº”ç”¨ ç¬¬å››æ­¥ï¼šæ¨¡å‹å¼€å‘ä¸è®­ç»ƒ é€‰æ‹©åˆé€‚çš„ç®—æ³•æˆ–æ¨¡å‹æ¶æ„ è¿›è¡Œæ¨¡å‹è®­ç»ƒå’Œè°ƒä¼˜ éªŒè¯æ¨¡å‹æ€§èƒ½ ç¬¬äº”æ­¥ï¼šéƒ¨ç½²ä¸ç»´æŠ¤ å°†æ¨¡å‹éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ å»ºç«‹ç›‘æ§å’Œåé¦ˆæœºåˆ¶ æŒç»­ä¼˜åŒ–å’Œæ›´æ–°æ¨¡å‹ AIåº”ç”¨å¼€å‘å·¥å…·å’Œå¹³å° å¼€å‘æ¡†æ¶ TensorFlowï¼šGoogleå¼€æºçš„æœºå™¨å­¦ä¹ æ¡†æ¶ PyTorchï¼šFacebookå¼€å‘çš„æ·±åº¦å­¦ä¹ æ¡†æ¶ Scikit-learnï¼šPythonæœºå™¨å­¦ä¹ åº“ Kerasï¼šé«˜çº§ç¥ç»ç½‘ç»œAPI äº‘æœåŠ¡å¹³å° AWS AIæœåŠ¡ï¼šAmazonæä¾›çš„ä¸€ç³»åˆ—AIæœåŠ¡ Azure MLï¼šå¾®è½¯çš„æœºå™¨å­¦ä¹ å¹³å° Google Cloud AIï¼šGoogleäº‘çš„AIå’Œæœºå™¨å­¦ä¹ æœåŠ¡ é˜¿é‡Œäº‘AIï¼šé˜¿é‡Œå·´å·´çš„AIæœåŠ¡ç”Ÿæ€ AIåº”ç”¨é¢ä¸´çš„æŒ‘æˆ˜ æŠ€æœ¯æŒ‘æˆ˜ æ•°æ®è´¨é‡ï¼šåƒåœ¾è¿›åƒåœ¾å‡ºï¼Œæ•°æ®è´¨é‡ç›´æ¥å½±å“æ¨¡å‹æ•ˆæœ æ¨¡å‹å¯è§£é‡Šæ€§ï¼šé»‘ç›’æ¨¡å‹å†³ç­–è¿‡ç¨‹éš¾ä»¥è§£é‡Š è®¡ç®—èµ„æºï¼šæ·±åº¦å­¦ä¹ éœ€è¦å¤§é‡è®¡ç®—èµ„æº ä¼¦ç†å’Œç¤¾ä¼šé—®é¢˜ éšç§ä¿æŠ¤ï¼šAIç³»ç»Ÿå¯¹ä¸ªäººæ•°æ®çš„æ”¶é›†å’Œä½¿ç”¨ ç®—æ³•åè§ï¼šè®­ç»ƒæ•°æ®ä¸­çš„åè§å¯èƒ½è¢«æ¨¡å‹æ”¾å¤§ å°±ä¸šå½±å“ï¼šè‡ªåŠ¨åŒ–å¯èƒ½å–ä»£æŸäº›å·¥ä½œå²—ä½ AIåº”ç”¨çš„æœªæ¥è¶‹åŠ¿ 1. å¤šæ¨¡æ€AI ç»“åˆæ–‡æœ¬ã€å›¾åƒã€éŸ³é¢‘ç­‰å¤šç§ä¿¡æ¯æ¨¡æ€çš„AIç³»ç»Ÿå°†æˆä¸ºä¸»æµã€‚\n2. è¾¹ç¼˜AI å°†AIè®¡ç®—èƒ½åŠ›éƒ¨ç½²åˆ°è¾¹ç¼˜è®¾å¤‡ï¼Œå®ç°ä½å»¶è¿Ÿã€éšç§ä¿æŠ¤çš„æ™ºèƒ½åº”ç”¨ã€‚\n3. è‡ªç›‘ç£å­¦ä¹  å‡å°‘å¯¹æ ‡æ³¨æ•°æ®çš„ä¾èµ–ï¼Œé€šè¿‡è‡ªç›‘ç£æ–¹å¼å­¦ä¹ æ•°æ®è¡¨ç¤ºã€‚\n4. AI for Science AIæŠ€æœ¯åœ¨ç§‘å­¦ç ”ç©¶ä¸­çš„åº”ç”¨ï¼Œå¦‚è¯ç‰©å‘ç°ã€ææ–™è®¾è®¡ã€æ°”å€™é¢„æµ‹ç­‰ã€‚\nç»“è®º AIåº”ç”¨æ­£åœ¨æ·±åˆ»æ”¹å˜ç€æˆ‘ä»¬çš„ç”Ÿæ´»å’Œå·¥ä½œæ–¹å¼ã€‚æŒæ¡AIåº”ç”¨å¼€å‘æŠ€èƒ½ï¼Œä¸ä»…èƒ½å¤Ÿæå‡ä¸ªäººç«äº‰åŠ›ï¼Œæ›´èƒ½å¤Ÿå‚ä¸å¡‘é€ æœªæ¥æŠ€æœ¯å‘å±•æ–¹å‘ã€‚æ— è®ºæ˜¯å¼€å‘è€…ã€äº§å“ç»ç†è¿˜æ˜¯ä¼ä¸šç®¡ç†è€…ï¼Œéƒ½éœ€è¦äº†è§£AIåº”ç”¨çš„åŸºæœ¬åŸç†å’Œå®è·µæ–¹æ³•ã€‚\nåœ¨AIæ—¶ä»£ï¼Œå…³é”®æ˜¯è¦ä¿æŒå­¦ä¹ çš„çƒ­æƒ…ï¼ŒåŒæ—¶ä¹Ÿè¦ç†æ€§çœ‹å¾…AIçš„èƒ½åŠ›è¾¹ç•Œï¼Œå°†AIæŠ€æœ¯åº”ç”¨åˆ°çœŸæ­£æœ‰ä»·å€¼çš„åœ°æ–¹ï¼Œè®©æŠ€æœ¯æ›´å¥½åœ°æœåŠ¡äºäººç±»ç¤¾ä¼šã€‚\n","permalink":"/blog/articles/ai-applications-guide/","summary":"å…¨é¢ä»‹ç»AIåº”ç”¨çš„å‘å±•ç°çŠ¶ã€æ ¸å¿ƒæŠ€æœ¯å’Œå®è·µæ¡ˆä¾‹ï¼Œå¸®åŠ©è¯»è€…äº†è§£å¦‚ä½•åœ¨å®é™…åœºæ™¯ä¸­åº”ç”¨äººå·¥æ™ºèƒ½æŠ€æœ¯","title":"AIåº”ç”¨æŒ‡å—ï¼šä»å…¥é—¨åˆ°å®è·µ"},{"content":"åœ¨æ„å»ºæŠ€æœ¯åšå®¢çš„è¿‡ç¨‹ä¸­ï¼Œè‰¯å¥½çš„URLç»“æ„å’Œæ–‡ç« ç®¡ç†ç»„ç»‡å¯¹äºSEOä¼˜åŒ–å’Œç”¨æˆ·ä½“éªŒéƒ½è‡³å…³é‡è¦ã€‚æœ¬æ–‡åˆ†äº«äº†é‡æ„Hugoåšå®¢çš„å®Œæ•´å®è·µæ–¹æ¡ˆã€‚\nèƒŒæ™¯ä¸éœ€æ±‚ åŸå§‹çš„åšå®¢ç»“æ„å­˜åœ¨ä»¥ä¸‹é—®é¢˜ï¼š\nURLä¸å¤Ÿè¯­ä¹‰åŒ– æ–‡ç« ç®¡ç†æ··ä¹± SEOä¼˜åŒ–ä¸å……åˆ† æ–°çš„URLç»“æ„è®¾è®¡ 1. æ–‡ç« é¡µé¢URL /articles/[æ–‡ç« åˆ«å]/ ä¾‹å¦‚ï¼š /articles/hugo-url-best-practices/ 2. æ–‡ç« åˆ—è¡¨é¡µ /posts/ # æ‰€æœ‰æ–‡ç« åˆ—è¡¨ /posts/page/2/ # åˆ†é¡µé¡µé¢ å®æ–½æ­¥éª¤ 1. é…ç½®æ–‡ä»¶æ›´æ–° åœ¨ hugo.toml ä¸­è®¾ç½®URLåˆ«åï¼š\n1 2 3 [permalinks] posts = \u0026#34;/articles/:slug/\u0026#34; articles = \u0026#34;/articles/:slug/\u0026#34; 2. ç›®å½•ç»“æ„é‡ç»„ content/ articles/ # æ–‡ç« ä¸»ç›®å½• 2024/ # æŒ‰å¹´ä»½ç»„ç»‡ 12-december/ # æŒ‰æœˆä»½ç»„ç»‡ hugo-url-best-practices.md 2025/ 01-january/ æŠ€æœ¯å®ç°ç»†èŠ‚ æ¨¡æ¿æ–‡ä»¶é…ç½® åˆ›å»ºè‡ªå®šä¹‰æ¨¡æ¿æ”¯æŒæ–°çš„URLç»“æ„ï¼š\nlayouts/posts/list.html - æ–‡ç« åˆ—è¡¨é¡µ layouts/articles/single.html - æ–‡ç« è¯¦æƒ…é¡µ layouts/archives/list.html - å½’æ¡£é¡µé¢ æ ·å¼ä¼˜åŒ– æ›´æ–°CSSæ ·å¼æ”¯æŒæ–°çš„é¡µé¢å¸ƒå±€ï¼ŒåŒ…æ‹¬ï¼š\nå½’æ¡£é¡µé¢çš„æ—¶é—´è½´æ ·å¼ æ–‡ç« è¯¦æƒ…é¡µçš„æ’ç‰ˆä¼˜åŒ– åˆ†é¡µå¯¼èˆªçš„æ ·å¼ç¾åŒ– æœ€ä½³å®è·µæ€»ç»“ URLè®¾è®¡åŸåˆ™\nä½¿ç”¨ç®€æ´çš„è‹±æ–‡slug é¿å…ä¸­æ–‡ç›´æ¥æ˜¾ç¤ºåœ¨URLä¸­ ä¿æŒURLå±‚çº§æ¸…æ™° æ–‡ä»¶ç»„ç»‡\næŒ‰æ—¥æœŸåˆ†å±‚ç®¡ç† ä¿æŒæ–‡ä»¶åä¸slugä¸€è‡´ åŠæ—¶å½’æ¡£æ—§æ–‡ç«  SEOä¼˜åŒ–\né…ç½®åˆé€‚çš„metaä¿¡æ¯ æ·»åŠ ç»“æ„åŒ–æ•°æ® ç¡®ä¿URLå¯è¢«æœç´¢å¼•æ“å‹å¥½æ”¶å½• æ•ˆæœè¯„ä¼° é‡æ„åçš„åšå®¢å…·æœ‰ä»¥ä¸‹ä¼˜åŠ¿ï¼š\nâœ… æ›´å‹å¥½çš„URLç»“æ„ âœ… æ›´æ¸…æ™°çš„æ–‡ä»¶ç®¡ç† âœ… æ›´å¥½çš„SEOè¡¨ç° âœ… æ›´ä¼˜çš„ç”¨æˆ·ä½“éªŒ è¿™æ¬¡é‡æ„å®è·µè¯æ˜ï¼Œåˆç†çš„æ¶æ„è®¾è®¡èƒ½å¤Ÿæ˜¾è‘—æå‡åšå®¢çš„å¯ç»´æŠ¤æ€§å’Œç”¨æˆ·ä½“éªŒã€‚\n","permalink":"/blog/articles/hugo-url-best-practices/","summary":"ä»‹ç»å¦‚ä½•é‡æ„Hugoåšå®¢çš„URLè·¯å¾„å’Œæ–‡ç« ç®¡ç†ç»“æ„ï¼Œå®ç°æ›´å‹å¥½çš„SEOå’Œæ›´æ¸…æ™°çš„æ–‡ä»¶ç»„ç»‡æ–¹å¼ã€‚","title":"Hugoåšå®¢URLä¼˜åŒ–ï¼šé‡æ„æ–‡ç« ç®¡ç†ç»“æ„çš„æœ€ä½³å®è·µ"},{"content":"CSS Gridå’ŒFlexboxæ˜¯ç°ä»£CSSå¸ƒå±€çš„ä¸¤å¤§æ”¯æŸ±ã€‚è™½ç„¶ä¸¤è€…éƒ½èƒ½å®ç°å¤æ‚çš„å¸ƒå±€æ•ˆæœï¼Œä½†å„è‡ªæœ‰ä¸åŒçš„ç‰¹ç‚¹å’Œé€‚ç”¨åœºæ™¯ã€‚æœ¬æ–‡å°†é€šè¿‡ä¸°å¯Œçš„å®ä¾‹å¯¹æ¯”ï¼Œå¸®åŠ©ä½ æŒæ¡è¿™ä¸¤ä¸ªå¼ºå¤§çš„å¸ƒå±€å·¥å…·ã€‚\n1. ç†è§£Gridå’ŒFlexboxçš„æœ¬è´¨åŒºåˆ« ä¸€ç»´ vs äºŒç»´å¸ƒå±€ 1 2 3 4 5 6 7 8 9 10 11 /* Flexbox - ä¸€ç»´å¸ƒå±€ */ .flex-container { display: flex; /* åªèƒ½åœ¨ä¸€ä¸ªæ–¹å‘ä¸Šæ’åˆ—é¡¹ç›® */ } /* Grid - äºŒç»´å¸ƒå±€ */ .grid-container { display: grid; /* å¯ä»¥åŒæ—¶åœ¨è¡Œå’Œåˆ—ä¸Šæ§åˆ¶é¡¹ç›® */ } æ ¸å¿ƒåŒºåˆ«ï¼š\nFlexboxï¼šä¸€ç»´å¸ƒå±€ï¼ˆè¡Œæˆ–åˆ—ï¼‰ Gridï¼šäºŒç»´å¸ƒå±€ï¼ˆè¡Œå’Œåˆ—ï¼‰ å†…å®¹é©±åŠ¨ vs å¸ƒå±€é©±åŠ¨ 1 2 3 4 5 6 7 8 9 10 11 /* Flexbox - å†…å®¹é©±åŠ¨ */ /* é¡¹ç›®çš„å¤§å°å’Œä½ç½®ä¸»è¦ç”±å†…å®¹å†³å®š */ .flex-item { flex: 1 1 200px; /* åŸºäºå†…å®¹çš„å¼¹æ€§ä¼¸ç¼© */ } /* Grid - å¸ƒå±€é©±åŠ¨ */ /* ç½‘æ ¼çš„å°ºå¯¸å’Œä½ç½®ç”±å®¹å™¨å®šä¹‰ */ .grid-container { grid-template-columns: 1fr 2fr 1fr; /* æ˜ç¡®çš„åˆ—å®šä¹‰ */ } 2. Flexboxå®æˆ˜æŠ€å·§ å¼¹æ€§å¯¼èˆªæ  1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 .navbar { display: flex; align-items: center; justify-content: space-between; padding: 0 2rem; height: 60px; background: #2c3e50; color: white; } .navbar-brand { flex: 0 0 auto; font-size: 1.5rem; font-weight: bold; } .navbar-menu { display: flex; gap: 2rem; list-style: none; margin: 0; padding: 0; } .navbar-actions { display: flex; gap: 1rem; align-items: center; } /* å“åº”å¼å¯¼èˆª */ @media (max-width: 768px) { .navbar { flex-wrap: wrap; height: auto; padding: 1rem; } .navbar-menu { flex: 0 0 100%; order: 3; flex-direction: column; gap: 0; margin-top: 1rem; background: #34495e; padding: 1rem; border-radius: 0.5rem; } } å‚ç›´å±…ä¸­è§£å†³æ–¹æ¡ˆ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 /* æ–¹æ¡ˆ1ï¼šFlexboxå‚ç›´å±…ä¸­ */ .center-container { display: flex; align-items: center; /* å‚ç›´å±…ä¸­ */ justify-content: center; /* æ°´å¹³å±…ä¸­ */ height: 100vh; } /* æ–¹æ¡ˆ2ï¼šFlexbox + margin:auto */ .center-container { display: flex; height: 100vh; } .center-item { margin: auto; } /* æ–¹æ¡ˆ3ï¼šåµŒå¥—Flexbox */ .vertical-center { display: flex; align-items: center; } .horizontal-center { display: flex; justify-content: center; width: 100%; } ç­‰é«˜åˆ—å¸ƒå±€ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 .card-container { display: flex; gap: 2rem; margin: 2rem 0; } .card { flex: 1; display: flex; flex-direction: column; border: 1px solid #ddd; border-radius: 0.5rem; overflow: hidden; } .card-header { padding: 1rem; background: #f8f9fa; border-bottom: 1px solid #ddd; } .card-content { padding: 1rem; flex: 1; /* å¡«å……å‰©ä½™ç©ºé—´ */ } .card-footer { padding: 1rem; background: #f8f9fa; border-top: 1px solid #ddd; margin-top: auto; /* æ¨åˆ°åº•éƒ¨ */ } è‡ªé€‚åº”è¡¨å•å¸ƒå±€ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 .form-group { display: flex; flex-direction: column; gap: 0.5rem; margin-bottom: 1.5rem; } .form-row { display: flex; gap: 1rem; flex-wrap: wrap; } .form-field { flex: 1 1 250px; /* åŸºç¡€å®½åº¦250pxï¼Œå¯ä¼¸ç¼© */ min-width: 200px; /* æœ€å°å®½åº¦ */ } .form-label { display: block; font-weight: 500; margin-bottom: 0.25rem; color: #374151; } .form-input { width: 100%; padding: 0.5rem 0.75rem; border: 1px solid #d1d5db; border-radius: 0.375rem; font-size: 1rem; } .form-actions { display: flex; gap: 1rem; justify-content: flex-end; margin-top: 2rem; } .btn { padding: 0.5rem 1.5rem; border: none; border-radius: 0.375rem; font-size: 1rem; cursor: pointer; transition: all 0.2s; } .btn-primary { background: #3b82f6; color: white; } .btn-secondary { background: #6b7280; color: white; } 3. Gridå®æˆ˜æŠ€å·§ ç»å…¸çš„12åˆ—ç½‘æ ¼ç³»ç»Ÿ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 .grid-container { display: grid; grid-template-columns: repeat(12, 1fr); gap: 1rem; max-width: 1200px; margin: 0 auto; padding: 0 1rem; } /* åˆ—è·¨åº¦å·¥å…·ç±» */ .col-1 { grid-column: span 1; } .col-2 { grid-column: span 2; } .col-3 { grid-column: span 3; } .col-4 { grid-column: span 4; } .col-6 { grid-column: span 6; } .col-8 { grid-column: span 8; } .col-12 { grid-column: span 12; } /* è¡Œè·¨åº¦å·¥å…·ç±» */ .row-1 { grid-row: span 1; } .row-2 { grid-row: span 2; } /* å“åº”å¼åˆ— */ @media (max-width: 768px) { .col-sm-12 { grid-column: span 12; } .col-sm-6 { grid-column: span 6; } .col-sm-4 { grid-column: span 4; } } /* ä½¿ç”¨ç¤ºä¾‹ */ .layout-example { display: grid; grid-template-columns: repeat(12, 1fr); gap: 1rem; } .header { grid-column: 1 / -1; /* ä»ç¬¬1åˆ—åˆ°æœ€åä¸€åˆ— */ height: 80px; } .sidebar { grid-column: span 3; /* å 3åˆ— */ } .main-content { grid-column: span 9; /* å 9åˆ— */ } å¤æ‚çš„é¡µé¢å¸ƒå±€ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 .page-layout { display: grid; grid-template-areas: \u0026#34;header header header\u0026#34; \u0026#34;sidebar main aside\u0026#34; \u0026#34;footer footer footer\u0026#34;; grid-template-columns: 250px 1fr 200px; grid-template-rows: auto 1fr auto; min-height: 100vh; gap: 1rem; } .header { grid-area: header; background: #1f2937; color: white; padding: 1rem 2rem; } .sidebar { grid-area: sidebar; background: #f3f4f6; padding: 1.5rem; } .main-content { grid-area: main; padding: 1.5rem; overflow-y: auto; } .aside { grid-area: aside; background: #f9fafb; padding: 1.5rem; } .footer { grid-area: footer; background: #374151; color: white; padding: 1rem 2rem; text-align: center; } /* å“åº”å¼å¸ƒå±€è°ƒæ•´ */ @media (max-width: 1024px) { .page-layout { grid-template-areas: \u0026#34;header header\u0026#34; \u0026#34;main main\u0026#34; \u0026#34;sidebar sidebar\u0026#34; \u0026#34;aside aside\u0026#34; \u0026#34;footer footer\u0026#34;; grid-template-columns: 1fr; grid-template-rows: auto 1fr auto auto auto; } } å¡ç‰‡ç½‘æ ¼å¸ƒå±€ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 .card-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 2rem; padding: 2rem 0; } .product-card { background: white; border-radius: 0.5rem; box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); overflow: hidden; transition: transform 0.2s, box-shadow 0.2s; } .product-card:hover { transform: translateY(-4px); box-shadow: 0 8px 12px rgba(0, 0, 0, 0.15); } .card-image { width: 100%; height: 200px; object-fit: cover; } .card-body { padding: 1.5rem; } .card-title { font-size: 1.25rem; font-weight: 600; margin-bottom: 0.5rem; color: #1f2937; } .card-price { font-size: 1.5rem; font-weight: bold; color: #059669; margin: 1rem 0; } .card-actions { display: flex; gap: 0.5rem; } /* è‡ªé€‚åº”åˆ—æ•°æ§åˆ¶ */ .card-grid-2 { grid-template-columns: repeat(2, 1fr); } .card-grid-3 { grid-template-columns: repeat(3, 1fr); } .card-grid-4 { grid-template-columns: repeat(4, 1fr); } å›¾ç‰‡ç”»å»Šå¸ƒå±€ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 .gallery { display: grid; grid-template-rows: auto 200px 150px; grid-template-columns: repeat(4, 1fr); gap: 0.5rem; height: 500px; } .gallery-item { overflow: hidden; border-radius: 0.5rem; } .gallery-item img { width: 100%; height: 100%; object-fit: cover; transition: transform 0.3s; } .gallery-item:hover img { transform: scale(1.05); } /* ç‰¹è‰²å›¾ç‰‡ */ .gallery-item:nth-child(1) { grid-column: span 2; grid-row: span 2; } .gallery-item:nth-child(2) { grid-column: span 2; grid-row: span 1; } /* ç€‘å¸ƒæµå¸ƒå±€ */ .masonry { display: grid; grid-template-rows: masonry; gap: 1rem; } /* ä½¿ç”¨CSS columnså®ç°çš„ç€‘å¸ƒæµ */ .masonry-fallback { column-count: 4; column-gap: 1rem; } .masonry-item { break-inside: avoid; margin-bottom: 1rem; } 4. æ··åˆå¸ƒå±€æŠ€å·§ Grid + Flexboxç»„åˆ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 /* ä½¿ç”¨Gridå®šä¹‰æ•´ä½“å¸ƒå±€ï¼ŒFlexboxå¤„ç†å†…éƒ¨å¯¹é½ */ .dashboard { display: grid; grid-template-columns: 250px 1fr; grid-template-rows: 60px 1fr; grid-template-areas: \u0026#34;sidebar header\u0026#34; \u0026#34;sidebar main\u0026#34;; height: 100vh; } .sidebar { grid-area: sidebar; background: #1f2937; color: white; } .header { grid-area: header; background: white; border-bottom: 1px solid #e5e7eb; } .main { grid-area: main; background: #f9fafb; overflow-y: auto; } /* åœ¨Gridå†…éƒ¨ä½¿ç”¨Flexbox */ .widget { background: white; border-radius: 0.5rem; padding: 1.5rem; box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1); } .widget-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem; padding-bottom: 0.5rem; border-bottom: 1px solid #e5e7eb; } .widget-title { font-size: 1.125rem; font-weight: 600; color: #1f2937; } .widget-actions { display: flex; gap: 0.5rem; } å“åº”å¼å¸ƒå±€ç­–ç•¥ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 /* ç§»åŠ¨ä¼˜å…ˆçš„å“åº”å¼è®¾è®¡ */ .responsive-layout { display: grid; gap: 1rem; /* ç§»åŠ¨ç«¯é»˜è®¤å•åˆ— */ grid-template-columns: 1fr; } /* å¹³æ¿è®¾å¤‡ */ @media (min-width: 768px) { .responsive-layout { grid-template-columns: repeat(2, 1fr); } } /* æ¡Œé¢è®¾å¤‡ */ @media (min-width: 1024px) { .responsive-layout { grid-template-columns: repeat(3, 1fr); } } /* å¤§å±è®¾å¤‡ */ @media (min-width: 1280px) { .responsive-layout { grid-template-columns: repeat(4, 1fr); } } /* ä½¿ç”¨CSSå˜é‡å®ç°çµæ´»å¸ƒå±€ */ .dynamic-grid { --columns: 1; --gap: 1rem; display: grid; grid-template-columns: repeat(var(--columns), 1fr); gap: var(--gap); } /* JavaScriptæ§åˆ¶å˜é‡ */ // document.documentElement.style.setProperty(\u0026#39;--columns\u0026#39;, \u0026#39;3\u0026#39;); 5. é«˜çº§å¸ƒå±€æ¨¡å¼ Holy Grailå¸ƒå±€ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 .holy-grail { display: grid; grid-template-columns: auto 1fr auto; grid-template-rows: auto 1fr auto; grid-template-areas: \u0026#34;header header header\u0026#34; \u0026#34;nav main aside\u0026#34; \u0026#34;footer footer footer\u0026#34;; min-height: 100vh; gap: 1rem; } .holy-grail \u0026gt; header { grid-area: header; background: #1f2937; color: white; padding: 1rem; } .holy-grail \u0026gt; nav { grid-area: nav; background: #f3f4f6; padding: 1rem; } .holy-grail \u0026gt; main { grid-area: main; background: white; padding: 1rem; } .holy-grail \u0026gt; aside { grid-area: aside; background: #f9fafb; padding: 1rem; } .holy-grail \u0026gt; footer { grid-area: footer; background: #374151; color: white; padding: 1rem; text-align: center; } åœ£æ¯å¸ƒå±€çš„Flexboxå®ç° 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 .holy-grail-flex { display: flex; flex-direction: column; min-height: 100vh; } .holy-grail-flex \u0026gt; header, .holy-grail-flex \u0026gt; footer { flex: 0 0 auto; } .holy-grail-flex \u0026gt; .content { flex: 1 1 auto; display: flex; } .holy-grail-flex \u0026gt; .content \u0026gt; nav { flex: 0 0 200px; order: -1; } .holy-grail-flex \u0026gt; .content \u0026gt; main { flex: 1 1 auto; } .holy-grail-flex \u0026gt; .content \u0026gt; aside { flex: 0 0 200px; } é‡å å¸ƒå±€æ•ˆæœ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 .stack-layout { display: grid; grid-template-areas: \u0026#34;stack\u0026#34;; place-items: center; height: 400px; } .stack-item { grid-area: stack; } /* åˆ›å»ºå¤šå±‚é‡å æ•ˆæœ */ .stack-item:nth-child(1) { z-index: 3; transform: scale(0.9); opacity: 0.9; } .stack-item:nth-child(2) { z-index: 2; transform: scale(0.95); opacity: 0.95; } .stack-item:nth-child(3) { z-index: 1; transform: scale(1); opacity: 1; } 6. æ€§èƒ½ä¼˜åŒ–æŠ€å·§ å‡å°‘é‡æ’é‡ç»˜ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 /* ä½¿ç”¨transformä»£æ›¿left/top */ .animation-container { position: relative; width: 100px; height: 100px; } .animated-element { position: absolute; left: 0; /* å¥½çš„åšæ³•ï¼šä½¿ç”¨transform */ transform: translateX(0); transition: transform 0.3s ease; } .animated-element.active { transform: translateX(100px); /* é¿å…ï¼šä¿®æ”¹leftå±æ€§ */ /* left: 100px; */ } /* ä½¿ç”¨will-changeæç¤ºæµè§ˆå™¨ */ .optimize-performance { will-change: transform, opacity; } /* åŠ¨ç”»ç»“æŸåç§»é™¤will-change */ .animation-complete { will-change: auto; } å¸ƒå±€æ€§èƒ½è€ƒè™‘ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 /* é¿å…å¤æ‚çš„Gridè®¡ç®— */ .simple-grid { /* å¥½çš„åšæ³•ï¼šæ˜ç¡®å°ºå¯¸ */ display: grid; grid-template-columns: 200px 1fr 200px; } .complex-grid { /* é¿å…ï¼šå¤æ‚çš„frè®¡ç®— */ display: grid; grid-template-columns: minmax(100px, max-content) repeat(auto-fit, minmax(200px, 1fr)) minmax(100px, max-content); } /* ä½¿ç”¨containå±æ€§ä¼˜åŒ– */ .optimized-element { contain: layout; /* å‘Šè¯‰æµè§ˆå™¨å…ƒç´ çš„å­æ ‘ä¸ä¼šå½±å“é¡µé¢å…¶ä»–éƒ¨åˆ† */ } 7. è°ƒè¯•å’Œå·¥å…· å¯è§†åŒ–è°ƒè¯• 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 /* Gridè°ƒè¯•æ ·å¼ */ .grid-debug { display: grid; gap: 1rem; } .grid-debug::before { content: \u0026#39;\u0026#39;; position: absolute; top: 0; left: 0; right: 0; bottom: 0; background-image: linear-gradient(rgba(255, 0, 0, 0.1) 1px, transparent 1px), linear-gradient(90deg, rgba(255, 0, 0, 0.1) 1px, transparent 1px); background-size: 50px 50px; pointer-events: none; z-index: 1000; } /* Flexboxè°ƒè¯• */ .flex-debug { outline: 2px solid rgba(0, 255, 0, 0.5); } .flex-debug \u0026gt; * { outline: 1px solid rgba(0, 0, 255, 0.3); } æµè§ˆå™¨å¼€å‘è€…å·¥å…· 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 /* åœ¨Chrome DevToolsä¸­æµ‹è¯• */ .test-layout { display: grid; /* å³é”®æ£€æŸ¥ -\u0026gt; Layout -\u0026gt; Grid */ grid-template-columns: repeat(3, 1fr); grid-template-rows: auto 1fr auto; gap: 1rem; } /* Flexboxè°ƒè¯• */ .test-flex { display: flex; /* åœ¨DevToolsä¸­å¯ä»¥æŸ¥çœ‹Flexboxä¿¡æ¯ */ justify-content: space-between; align-items: center; } é€‰æ‹©å»ºè®® ä½•æ—¶ä½¿ç”¨Flexbox 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 /* âœ… æ¨èä½¿ç”¨Flexboxçš„åœºæ™¯ */ /* 1. å¯¼èˆªæ å¸ƒå±€ */ .navbar { display: flex; justify-content: space-between; align-items: center; } /* 2. è¡¨å•æ§ä»¶å¯¹é½ */ .form-group { display: flex; align-items: center; gap: 0.5rem; } /* 3. å‚ç›´å±…ä¸­ */ .center { display: flex; align-items: center; justify-content: center; } /* 4. ç­‰é«˜åˆ— */ .equal-height { display: flex; } .equal-height \u0026gt; * { flex: 1; } ä½•æ—¶ä½¿ç”¨Grid 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 /* âœ… æ¨èä½¿ç”¨Gridçš„åœºæ™¯ */ /* 1. é¡µé¢æ•´ä½“å¸ƒå±€ */ .page-layout { display: grid; grid-template-areas: \u0026#34;header header header\u0026#34; \u0026#34;sidebar main aside\u0026#34; \u0026#34;footer footer footer\u0026#34;; } /* 2. å¡ç‰‡ç½‘æ ¼ */ .card-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1rem; } /* 3. å¤æ‚çš„äºŒç»´å¸ƒå±€ */ .dashboard { display: grid; grid-template-columns: repeat(12, 1fr); grid-template-rows: auto 1fr auto; gap: 1rem; } /* 4. å›¾ç‰‡ç”»å»Š */ .gallery { display: grid; grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: 0.5rem; } æ€»ç»“ CSS Gridå’ŒFlexboxéƒ½æ˜¯å¼ºå¤§çš„å¸ƒå±€å·¥å…·ï¼Œå®ƒä»¬ä¸æ˜¯ç«äº‰å…³ç³»ï¼Œè€Œæ˜¯äº’è¡¥å…³ç³»ï¼š\nFlexboxæ“…é•¿ï¼š\nä¸€ç»´å¸ƒå±€ï¼ˆè¡Œæˆ–åˆ—ï¼‰ å†…å®¹å¯¹é½å’Œåˆ†å¸ƒ ç»„ä»¶çº§å¸ƒå±€ å‚ç›´å±…ä¸­ Gridæ“…é•¿ï¼š\näºŒç»´å¸ƒå±€ï¼ˆè¡Œå’Œåˆ—ï¼‰ é¡µé¢çº§å¸ƒå±€ å¤æ‚çš„ç½‘æ ¼ç³»ç»Ÿ å“åº”å¼å¸ƒå±€ æŒæ¡è¿™ä¸¤ä¸ªå·¥å…·ï¼Œå¹¶æ ¹æ®å…·ä½“éœ€æ±‚é€‰æ‹©åˆé€‚çš„æ–¹æ¡ˆï¼Œæ‰èƒ½æ„å»ºå‡ºçµæ´»ã€é«˜æ•ˆçš„ç°ä»£ç½‘é¡µå¸ƒå±€ã€‚\nç›¸å…³å·¥å…·æ¨èï¼š\nCSS å¸ƒå±€ç”Ÿæˆå™¨ CSSå‹ç¼©å·¥å…· ","permalink":"/blog/articles/css-grid-flexbox-guide/","summary":"æ·±å…¥å¯¹æ¯”CSS Gridå’ŒFlexboxçš„ä½¿ç”¨åœºæ™¯ï¼Œé€šè¿‡å®æˆ˜æ¡ˆä¾‹æ¼”ç¤ºå¦‚ä½•é€‰æ‹©åˆé€‚çš„å¸ƒå±€æ–¹æ¡ˆï¼ŒæŒæ¡ç°ä»£CSSå¸ƒå±€çš„æ ¸å¿ƒæŠ€å·§ã€‚","title":"CSS Gridä¸Flexboxå®Œå…¨æŒ‡å—ï¼šç°ä»£å¸ƒå±€å®æˆ˜æŠ€å·§"},{"content":"Dockerå·²ç»æˆä¸ºç°ä»£è½¯ä»¶å¼€å‘å’Œéƒ¨ç½²çš„æ ‡å‡†å·¥å…·ã€‚ç„¶è€Œï¼Œä»…ä»…ä¼šä½¿ç”¨Dockeræ˜¯ä¸å¤Ÿçš„ï¼Œæ„å»ºå®‰å…¨ã€é«˜æ•ˆçš„å®¹å™¨åº”ç”¨éœ€è¦éµå¾ªä¸€ç³»åˆ—æœ€ä½³å®è·µã€‚æœ¬æ–‡å°†åˆ†äº«ç»è¿‡å®é™…é¡¹ç›®éªŒè¯çš„Dockerå®¹å™¨åŒ–æŒ‡å—ã€‚\n1. å¤šé˜¶æ®µæ„å»ºä¼˜åŒ–é•œåƒå¤§å° å¤šé˜¶æ®µæ„å»ºæ˜¯å‡å°‘æœ€ç»ˆé•œåƒä½“ç§¯çš„æœ‰æ•ˆæ–¹æ³•ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 # ç¬¬ä¸€é˜¶æ®µï¼šæ„å»ºé˜¶æ®µ FROM node:18-alpine AS builder WORKDIR /app # åªå¤åˆ¶ä¾èµ–ç›¸å…³æ–‡ä»¶ COPY package.json package-lock.json ./ RUN npm ci --only=production # å¤åˆ¶æºä»£ç å¹¶æ„å»º COPY . . RUN npm run build # ç¬¬äºŒé˜¶æ®µï¼šè¿è¡Œé˜¶æ®µ FROM node:18-alpine AS runtime # åˆ›å»ºérootç”¨æˆ· RUN addgroup -g 1001 -S nodejs \u0026amp;\u0026amp; \\ adduser -S nodejs -u 1001 WORKDIR /app # åªå¤åˆ¶æ„å»ºäº§ç‰©å’Œå¿…è¦æ–‡ä»¶ COPY --from=builder --chown=nodejs:nodejs /app/dist ./dist COPY --from=builder --chown=nodejs:nodejs /app/node_modules ./node_modules COPY --from=builder --chown=nodejs:nodejs /app/package.json ./package.json USER nodejs EXPOSE 3000 # å¥åº·æ£€æŸ¥ HEALTHCHECK --interval=30s --timeout=3s --start-period=5s --retries=3 \\ CMD curl -f http://localhost:3000/health || exit 1 CMD [\u0026#34;node\u0026#34;, \u0026#34;dist/server.js\u0026#34;] å…³é”®ä¼˜åŠ¿ï¼š\næ˜¾è‘—å‡å°‘æœ€ç»ˆé•œåƒä½“ç§¯ é¿å…åŒ…å«æ„å»ºå·¥å…·å’Œä¾èµ– æé«˜å®‰å…¨æ€§ï¼Œå‡å°‘æ”»å‡»é¢ 2. .dockerignoreæ–‡ä»¶ä¼˜åŒ– åˆç†é…ç½®.dockerignoreæ–‡ä»¶ï¼Œé¿å…ä¸å¿…è¦çš„æ–‡ä»¶ï¼š\n# æ’é™¤å¼€å‘ä¾èµ–æ–‡ä»¶ node_modules npm-debug.log* yarn-debug.log* yarn-error.log* # æ’é™¤å¼€å‘å·¥å…·é…ç½® .vscode .idea .eslintrc.js .prettierrc # æ’é™¤æµ‹è¯•æ–‡ä»¶ coverage/ .nyc_output/ test/ tests/ __tests__/ # æ’é™¤æ–‡æ¡£å’Œç¤ºä¾‹ README.md docs/ examples/ # æ’é™¤ç¯å¢ƒé…ç½®æ–‡ä»¶ .env .env.local .env.*.local # æ’é™¤ç³»ç»Ÿæ–‡ä»¶ .DS_Store Thumbs.db # æ’é™¤ä¸´æ—¶æ–‡ä»¶ *.tmp *.temp .cache # æ’é™¤æºç ç®¡ç†æ–‡ä»¶ .git .gitignore 3. å®‰å…¨é…ç½®æœ€ä½³å®è·µ å®¹å™¨å®‰å…¨æ˜¯ç”Ÿäº§ç¯å¢ƒçš„é‡è¦è€ƒè™‘å› ç´ ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 FROM alpine:3.18 # ä½¿ç”¨æœ€å°æƒé™ç”¨æˆ· RUN addgroup -g 1001 -S appuser \u0026amp;\u0026amp; \\ adduser -S appuser -u 1001 # å®‰è£…å¿…è¦çš„å®‰å…¨æ›´æ–° RUN apk update \u0026amp;\u0026amp; \\ apk upgrade \u0026amp;\u0026amp; \\ apk add --no-cache \\ dumb-init \\ \u0026amp;\u0026amp; rm -rf /var/cache/apk/* # è®¾ç½®å®‰å…¨çš„å·¥ä½œç›®å½• WORKDIR /app # å¤åˆ¶åº”ç”¨æ–‡ä»¶ COPY --chown=appuser:appuser . . # åˆ‡æ¢åˆ°érootç”¨æˆ· USER appuser # ä½¿ç”¨dumb-initä½œä¸ºPID 1 ENTRYPOINT [\u0026#34;dumb-init\u0026#34;, \u0026#34;--\u0026#34;] # åº”ç”¨å¯åŠ¨å‘½ä»¤ CMD [\u0026#34;./app\u0026#34;] å®‰å…¨æ£€æŸ¥æ¸…å•ï¼š\nä½¿ç”¨érootç”¨æˆ·è¿è¡Œ æœ€å°åŒ–å®‰è£…åŒ… å®šæœŸæ›´æ–°åŸºç¡€é•œåƒ æ‰«æå®‰å…¨æ¼æ´ ç¦ç”¨ä¸å¿…è¦çš„åŠŸèƒ½ 4. ä¼˜åŒ–å±‚ç¼“å­˜ç­–ç•¥ åˆç†å®‰æ’DockerfileæŒ‡ä»¤é¡ºåºï¼Œæœ€å¤§åŒ–å±‚ç¼“å­˜åˆ©ç”¨ç‡ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 FROM node:18-alpine AS builder # è®¾ç½®å·¥ä½œç›®å½• WORKDIR /app # å…ˆå¤åˆ¶ä¾èµ–æ–‡ä»¶ï¼Œåˆ©ç”¨ç¼“å­˜ COPY package*.json ./ RUN npm ci --only=production \u0026amp;\u0026amp; npm cache clean --force # ç„¶åå¤åˆ¶æºä»£ç  COPY . . # æ„å»ºåº”ç”¨ RUN npm run build # ç”Ÿäº§é•œåƒ FROM node:18-alpine WORKDIR /app # åªå¤åˆ¶å¿…è¦æ–‡ä»¶ COPY --from=builder /app/dist ./dist COPY --from=builder /app/node_modules ./node_modules COPY --from=builder /app/package.json ./package.json EXPOSE 3000 CMD [\u0026#34;node\u0026#34;, \u0026#34;dist/server.js\u0026#34;] ç¼“å­˜ä¼˜åŒ–åŸåˆ™ï¼š\né¢‘ç¹å˜åŒ–çš„æ–‡ä»¶åå¤åˆ¶ ä¾èµ–æ–‡ä»¶ä¼˜å…ˆå¤åˆ¶ åˆå¹¶ç›¸å…³çš„RUNæŒ‡ä»¤ ä½¿ç”¨å¤šé˜¶æ®µæ„å»ºåˆ†ç¦»å…³æ³¨ç‚¹ 5. å¥åº·æ£€æŸ¥æœºåˆ¶ ä¸ºå®¹å™¨é…ç½®å…¨é¢çš„å¥åº·æ£€æŸ¥ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 FROM nginx:alpine # å¤åˆ¶å¥åº·æ£€æŸ¥è„šæœ¬ COPY healthcheck.sh /usr/local/bin/ RUN chmod +x /usr/local/bin/healthcheck.sh # é…ç½®å¥åº·æ£€æŸ¥ HEALTHCHECK --interval=30s --timeout=10s --start-period=5s --retries=3 \\ CMD /usr/local/bin/healthcheck.sh # å¤åˆ¶é…ç½®æ–‡ä»¶ COPY nginx.conf /etc/nginx/nginx.conf COPY app/ /usr/share/nginx/html/ EXPOSE 80 CMD [\u0026#34;nginx\u0026#34;, \u0026#34;-g\u0026#34;, \u0026#34;daemon off;\u0026#34;] å¥åº·æ£€æŸ¥è„šæœ¬ç¤ºä¾‹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 #!/bin/sh # healthcheck.sh # æ£€æŸ¥Nginxè¿›ç¨‹ if ! pgrep nginx \u0026gt; /dev/null; then echo \u0026#34;Nginx process not running\u0026#34; exit 1 fi # æ£€æŸ¥HTTPå“åº” response=$(curl -s -o /dev/null -w \u0026#34;%{http_code}\u0026#34; http://localhost:80/health) if [ \u0026#34;$response\u0026#34; != \u0026#34;200\u0026#34; ]; then echo \u0026#34;Health check failed: HTTP $response\u0026#34; exit 1 fi echo \u0026#34;Health check passed\u0026#34; exit 0 6. ç¯å¢ƒå˜é‡ç®¡ç† åˆç†ç®¡ç†ä¸åŒç¯å¢ƒçš„é…ç½®ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 FROM node:18-alpine WORKDIR /app # åˆ›å»ºé…ç½®ç›®å½• RUN mkdir -p /app/config # å¤åˆ¶é»˜è®¤é…ç½® COPY config/default.json /app/config/ # è®¾ç½®ç¯å¢ƒå˜é‡ ENV NODE_ENV=production ENV PORT=3000 ENV LOG_LEVEL=info # åˆ›å»ºérootç”¨æˆ· RUN addgroup -g 1001 -S nodejs \u0026amp;\u0026amp; \\ adduser -S nodejs -u 1001 USER nodejs COPY --chown=nodejs:nodejs package*.json ./ RUN npm ci --only=production COPY --chown=nodejs:nodejs . . # ä½¿ç”¨å¯åŠ¨è„šæœ¬å¤„ç†é…ç½® COPY --chown=nodejs:nodejs docker-entrypoint.sh /usr/local/bin/ RUN chmod +x /usr/local/bin/docker-entrypoint.sh ENTRYPOINT [\u0026#34;/usr/local/bin/docker-entrypoint.sh\u0026#34;] CMD [\u0026#34;node\u0026#34;, \u0026#34;server.js\u0026#34;] å¯åŠ¨è„šæœ¬ç¤ºä¾‹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 #!/bin/sh # docker-entrypoint.sh # è®¾ç½®é»˜è®¤å€¼ export NODE_ENV=${NODE_ENV:-production} export PORT=${PORT:-3000} export LOG_LEVEL=${LOG_LEVEL:-info} # åŠ è½½ç¯å¢ƒç‰¹å®šé…ç½® if [ -f \u0026#34;/app/config/${NODE_ENV}.json\u0026#34; ]; then echo \u0026#34;Loading ${NODE_ENV} configuration\u0026#34; cp \u0026#34;/app/config/${NODE_ENV}.json\u0026#34; /app/config/current.json else echo \u0026#34;Using default configuration\u0026#34; cp /app/config/default.json /app/config/current.json fi # æ‰§è¡Œä¼ å…¥çš„å‘½ä»¤ exec \u0026#34;$@\u0026#34; 7. æ—¥å¿—ç®¡ç†æœ€ä½³å®è·µ åˆç†é…ç½®å®¹å™¨æ—¥å¿—è¾“å‡ºï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 FROM node:18-alpine # å®‰è£…æ—¥å¿—è½®è½¬å·¥å…· RUN apk add --no-cache logrotate # åˆ›å»ºæ—¥å¿—é…ç½® COPY logrotate.conf /etc/logrotate.d/app # åˆ›å»ºæ—¥å¿—ç›®å½• RUN mkdir -p /app/logs \u0026amp;\u0026amp; \\ chown -R nodejs:nodejs /app/logs # åˆ›å»ºérootç”¨æˆ· RUN addgroup -g 1001 -S nodejs \u0026amp;\u0026amp; \\ adduser -S nodejs -u 1001 WORKDIR /app COPY --chown=nodejs:nodejs . . USER nodejs # è®¾ç½®æ—¥å¿—è½®è½¬ CMD [\u0026#34;sh\u0026#34;, \u0026#34;-c\u0026#34;, \u0026#34;logrotate /etc/logrotate.d/app \u0026amp;\u0026amp; node server.js\u0026#34;] æ—¥å¿—è½®è½¬é…ç½®ï¼š\n# logrotate.conf /app/logs/*.log { daily rotate 7 compress delaycompress missingok notifempty create 0644 nodejs nodejs } 8. ç½‘ç»œå’Œå®‰å…¨é…ç½® é…ç½®å®‰å…¨çš„ç½‘ç»œé€šä¿¡ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 # docker-compose.yml version: \u0026#39;3.8\u0026#39; services: web: build: . ports: - \u0026#34;3000:3000\u0026#34; networks: - app-network environment: - NODE_ENV=production depends_on: - db - redis security_opt: - no-new-privileges:true cap_drop: - ALL cap_add: - NET_BIND_SERVICE ulimits: nofile: soft: 65536 hard: 65536 db: image: postgres:15-alpine environment: POSTGRES_DB: myapp POSTGRES_USER: ${DB_USER} POSTGRES_PASSWORD: ${DB_PASSWORD} volumes: - postgres_data:/var/lib/postgresql/data - ./init.sql:/docker-entrypoint-initdb.d/init.sql networks: - app-network security_opt: - no-new-privileges:true cap_drop: - ALL redis: image: redis:7-alpine command: redis-server --requirepass ${REDIS_PASSWORD} networks: - app-network security_opt: - no-new-privileges:true cap_drop: - ALL volumes: postgres_data: networks: app-network: driver: bridge 9. ç›‘æ§å’Œå¯è§‚æµ‹æ€§ ä¸ºå®¹å™¨æ·»åŠ ç›‘æ§èƒ½åŠ›ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 FROM node:18-alpine # å®‰è£…ç›‘æ§å·¥å…· RUN apk add --no-cache \\ curl \\ \u0026amp;\u0026amp; rm -rf /var/cache/apk/* # åˆ›å»ºérootç”¨æˆ· RUN addgroup -g 1001 -S nodejs \u0026amp;\u0026amp; \\ adduser -S nodejs -u 1001 WORKDIR /app COPY --chown=nodejs:nodejs package*.json ./ RUN npm ci --only=production COPY --chown=nodejs:nodejs . . # å¤åˆ¶ç›‘æ§è„šæœ¬ COPY --chown=nodejs:nodejs scripts/monitor.sh /usr/local/bin/ RUN chmod +x /usr/local/bin/monitor.sh USER nodejs # æ·»åŠ æ ‡ç­¾ LABEL maintainer=\u0026#34;dev-team@company.com\u0026#34; LABEL version=\u0026#34;1.0.0\u0026#34; LABEL description=\u0026#34;Node.js application\u0026#34; # æš´éœ²æŒ‡æ ‡ç«¯å£ EXPOSE 3000 9090 # å¯åŠ¨ç›‘æ§å’Œåº”ç”¨ CMD [\u0026#34;sh\u0026#34;, \u0026#34;-c\u0026#34;, \u0026#34;/usr/local/bin/monitor.sh \u0026amp; node server.js\u0026#34;] ç›‘æ§è„šæœ¬ç¤ºä¾‹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 #!/bin/sh # monitor.sh METRICS_PORT=9090 METRICS_ENDPOINT=\u0026#34;/metrics\u0026#34; # ç®€å•çš„HTTPæœåŠ¡å™¨æä¾›æŒ‡æ ‡ while true; do # æ”¶é›†ç³»ç»ŸæŒ‡æ ‡ CPU_USAGE=$(top -bn1 | grep \u0026#34;Cpu(s)\u0026#34; | awk \u0026#39;{print $2}\u0026#39; | awk -F\u0026#39;%\u0026#39; \u0026#39;{print $1}\u0026#39;) MEMORY_USAGE=$(free | grep Mem | awk \u0026#39;{printf \u0026#34;%.2f\u0026#34;, $3/$2 * 100.0}\u0026#39;) # ç”ŸæˆPrometheusæ ¼å¼çš„æŒ‡æ ‡ METRICS=\u0026#34;# HELP nodejs_cpu_usage CPU usage percentage # TYPE nodejs_cpu_usage gauge nodejs_cpu_usage ${CPU_USAGE} # HELP nodejs_memory_usage Memory usage percentage # TYPE nodejs_memory_usage gauge nodejs_memory_usage ${MEMORY_USAGE}\u0026#34; # å¯åŠ¨ä¸´æ—¶HTTPæœåŠ¡å™¨æä¾›æŒ‡æ ‡ echo -e \u0026#34;HTTP/1.1 200 OK\\nContent-Type: text/plain\\n\\n${METRICS}\u0026#34; | nc -l -p ${METRICS_PORT} sleep 30 done 10. CI/CDé›†æˆä¼˜åŒ– åœ¨CI/CDæµæ°´çº¿ä¸­ä¼˜åŒ–Dockeræ„å»ºï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 # .github/workflows/docker.yml name: Build and Push Docker Image on: push: branches: [ main, develop ] pull_request: branches: [ main ] env: REGISTRY: ghcr.io IMAGE_NAME: ${{ github.repository }} jobs: build-and-push: runs-on: ubuntu-latest permissions: contents: read packages: write steps: - name: Checkout repository uses: actions/checkout@v3 - name: Set up Docker Buildx uses: docker/setup-buildx-action@v2 - name: Log in to Container Registry if: github.event_name != \u0026#39;pull_request\u0026#39; uses: docker/login-action@v2 with: registry: ${{ env.REGISTRY }} username: ${{ github.actor }} password: ${{ secrets.GITHUB_TOKEN }} - name: Extract metadata id: meta uses: docker/metadata-action@v4 with: images: ${{ env.REGISTRY }}/${{ env.IMAGE_NAME }} tags: | type=ref,event=branch type=ref,event=pr type=sha,prefix={{branch}}- - name: Build and push Docker image uses: docker/build-push-action@v4 with: context: . push: ${{ github.event_name != \u0026#39;pull_request\u0026#39; }} tags: ${{ steps.meta.outputs.tags }} labels: ${{ steps.meta.outputs.labels }} cache-from: type=gha cache-to: type=gha,mode=max platforms: linux/amd64,linux/arm64 - name: Run security scan if: github.event_name != \u0026#39;pull_request\u0026#39; uses: aquasecurity/trivy-action@master with: image-ref: ${{ env.REGISTRY }}/${{ env.IMAGE_NAME }}:${{ steps.meta.outputs.tags }} format: \u0026#39;sarif\u0026#39; output: \u0026#39;trivy-results.sarif\u0026#39; - name: Upload Trivy scan results to GitHub Security tab if: github.event_name != \u0026#39;pull_request\u0026#39; uses: github/codeql-action/upload-sarif@v2 with: sarif_file: \u0026#39;trivy-results.sarif\u0026#39; æœ€ä½³å®è·µæ£€æŸ¥æ¸…å• åœ¨æ„å»ºå®¹å™¨æ—¶ï¼Œè¯·æ£€æŸ¥ä»¥ä¸‹é¡¹ç›®ï¼š\nâœ… å®‰å…¨æ€§ ä½¿ç”¨érootç”¨æˆ· æœ€å°åŒ–å®‰è£…åŒ… å®šæœŸæ›´æ–°åŸºç¡€é•œåƒ æ‰«æå®‰å…¨æ¼æ´ ç¦ç”¨ä¸å¿…è¦åŠŸèƒ½ âœ… æ€§èƒ½ä¼˜åŒ– å¤šé˜¶æ®µæ„å»º ä¼˜åŒ–å±‚ç¼“å­˜ .dockerignoreé…ç½® èµ„æºé™åˆ¶è®¾ç½® å¥åº·æ£€æŸ¥é…ç½® âœ… è¿ç»´å‹å¥½ ç»“æ„åŒ–æ—¥å¿— æŒ‡æ ‡æ”¶é›† ä¼˜é›…å…³é—­ ç¯å¢ƒå˜é‡ç®¡ç† é…ç½®å¤–éƒ¨åŒ– âœ… CI/CDé›†æˆ è‡ªåŠ¨åŒ–æ„å»º å¤šæ¶æ„æ”¯æŒ é•œåƒæ‰«æ ç‰ˆæœ¬æ ‡ç­¾ç®¡ç† éƒ¨ç½²ç­–ç•¥ æ€»ç»“ Dockerå®¹å™¨åŒ–æœ€ä½³å®è·µæ¶µç›–äº†å®‰å…¨æ€§ã€æ€§èƒ½ã€å¯ç»´æŠ¤æ€§ç­‰å¤šä¸ªæ–¹é¢ã€‚é€šè¿‡éµå¾ªè¿™äº›å®è·µï¼Œå¯ä»¥æ„å»ºå‡ºæ›´åŠ å®‰å…¨ã€é«˜æ•ˆçš„å®¹å™¨åº”ç”¨ã€‚è®°ä½ï¼Œå®¹å™¨åŒ–æ˜¯ä¸€ä¸ªæŒç»­ä¼˜åŒ–çš„è¿‡ç¨‹ï¼Œéœ€è¦æ ¹æ®é¡¹ç›®éœ€æ±‚å’Œæœ€ä½³å®è·µä¸æ–­è°ƒæ•´å’Œæ”¹è¿›ã€‚\n","permalink":"/blog/articles/docker-best-practices/","summary":"æ·±å…¥æ¢è®¨Dockerå®¹å™¨åŒ–çš„æœ€ä½³å®è·µï¼ŒåŒ…æ‹¬å¤šé˜¶æ®µæ„å»ºã€å®‰å…¨é…ç½®ã€æ€§èƒ½ä¼˜åŒ–ç­‰å…³é”®æŠ€æœ¯ï¼Œå¸®åŠ©å¼€å‘è€…æ„å»ºä¼ä¸šçº§å®¹å™¨åº”ç”¨ã€‚","title":"Dockerå®¹å™¨åŒ–æœ€ä½³å®è·µï¼šæ„å»ºé«˜æ•ˆå®‰å…¨çš„å®¹å™¨åº”ç”¨"},{"content":"Gitæ˜¯ç°ä»£è½¯ä»¶å¼€å‘ä¸­ä¸å¯æˆ–ç¼ºçš„ç‰ˆæœ¬æ§åˆ¶å·¥å…·ã€‚æŒæ¡Gitä¸ä»…èƒ½å¤Ÿæé«˜ä¸ªäººå¼€å‘æ•ˆç‡ï¼Œæ›´èƒ½ä¿ƒè¿›å›¢é˜Ÿåä½œã€‚æœ¬æ–‡å°†æ·±å…¥ä»‹ç»Gitçš„æ ¸å¿ƒæ¦‚å¿µã€å·¥ä½œæµç¨‹å’Œæœ€ä½³å®è·µã€‚\n1. GitåŸºç¡€æ¦‚å¿µ ç†è§£Gitçš„æ ¸å¿ƒæ¦‚å¿µæ˜¯é«˜æ•ˆä½¿ç”¨çš„åŸºç¡€ï¼š\nä»“åº“ï¼ˆRepositoryï¼‰ 1 2 3 4 5 6 7 8 9 10 11 12 13 # åˆå§‹åŒ–æ–°ä»“åº“ git init my-project cd my-project # å…‹éš†ç°æœ‰ä»“åº“ git clone https://github.com/user/repo.git git clone git@github.com:user/repo.git # SSHæ–¹å¼ # æŸ¥çœ‹ä»“åº“çŠ¶æ€ git status # æŸ¥çœ‹é…ç½®ä¿¡æ¯ git config --list ä¸‰ä¸ªå·¥ä½œåŒºåŸŸ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 # å·¥ä½œç›®å½• â†’ æš‚å­˜åŒº git add file.txt # æ·»åŠ å•ä¸ªæ–‡ä»¶ git add . # æ·»åŠ æ‰€æœ‰æ–‡ä»¶ git add *.js # æ·»åŠ ç‰¹å®šç±»å‹æ–‡ä»¶ git add src/ # æ·»åŠ ç›®å½• git add -p # äº¤äº’å¼æ·»åŠ ï¼ˆéƒ¨åˆ†æ–‡ä»¶ï¼‰ # æš‚å­˜åŒº â†’ æœ¬åœ°ä»“åº“ git commit -m \u0026#34;æäº¤ä¿¡æ¯\u0026#34; git commit -am \u0026#34;æäº¤ä¿¡æ¯\u0026#34; # æ·»åŠ å¹¶æäº¤å·²è·Ÿè¸ªæ–‡ä»¶ # æŸ¥çœ‹å·®å¼‚ git diff # å·¥ä½œç›®å½• vs æš‚å­˜åŒº git diff --cached # æš‚å­˜åŒº vs æœ¬åœ°ä»“åº“ git diff HEAD # å·¥ä½œç›®å½• vs æœ¬åœ°ä»“åº“ 2. åˆ†æ”¯ç®¡ç†ç­–ç•¥ åˆç†çš„åˆ†æ”¯ç­–ç•¥æ˜¯å›¢é˜Ÿåä½œçš„æ ¸å¿ƒï¼š\nGit Flowå·¥ä½œæµ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 # ä¸»åˆ†æ”¯ # master - ç”Ÿäº§ç¯å¢ƒä»£ç  # develop - å¼€å‘ç¯å¢ƒä»£ç  # åŠŸèƒ½åˆ†æ”¯ git checkout develop git pull origin develop git checkout -b feature/user-authentication # å®ŒæˆåŠŸèƒ½å¼€å‘ git add . git commit -m \u0026#34;feat: å®ç°ç”¨æˆ·è®¤è¯åŠŸèƒ½\u0026#34; # åˆå¹¶åˆ°developåˆ†æ”¯ git checkout develop git merge --no-ff feature/user-authentication git branch -d feature/user-authentication # æ¨é€è¿œç¨‹ä»“åº“ git push origin develop GitHub Flowå·¥ä½œæµ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 # ç®€åŒ–çš„å·¥ä½œæµ # main - ä¸»åˆ†æ”¯ # feature/* - åŠŸèƒ½åˆ†æ”¯ # åˆ›å»ºåŠŸèƒ½åˆ†æ”¯ git checkout main git pull origin main git checkout -b feature/payment-system # å¼€å‘å¹¶æ¨é€ git add . git commit -m \u0026#34;feat: æ·»åŠ æ”¯ä»˜åŠŸèƒ½\u0026#34; git push origin feature/payment-system # åˆ›å»ºPull Request # ä»£ç å®¡æŸ¥é€šè¿‡ååˆå¹¶åˆ°main GitLab Flowå·¥ä½œæµ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 # ç¯å¢ƒåˆ†æ”¯ç­–ç•¥ # main â† develop â† feature/* # â† production # åˆ›å»ºåŠŸèƒ½åˆ†æ”¯ git checkout -b feature/dashboard-chart main git push -u origin feature/dashboard-chart # åˆ›å»ºMerge Requeståˆ°mainåˆ†æ”¯ # å®¡æŸ¥é€šè¿‡åè‡ªåŠ¨éƒ¨ç½²åˆ°stagingç¯å¢ƒ # æ‰‹åŠ¨éƒ¨ç½²åˆ°productionç¯å¢ƒ git checkout production git merge --no-ff main git push origin production 3. æäº¤ä¿¡æ¯è§„èŒƒ è‰¯å¥½çš„æäº¤ä¿¡æ¯ä¾¿äºä»£ç è¿½è¸ªå’Œåä½œï¼š\nConventional Commitsè§„èŒƒ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 # æäº¤ä¿¡æ¯æ ¼å¼ # \u0026lt;type\u0026gt;[optional scope]: \u0026lt;description\u0026gt; # åŠŸèƒ½æ€§æäº¤ git commit -m \u0026#34;feat(auth): æ·»åŠ ç”¨æˆ·ç™»å½•åŠŸèƒ½\u0026#34; git commit -m \u0026#34;feat(api): æ–°å¢ç”¨æˆ·æ•°æ®æ¥å£\u0026#34; # ä¿®å¤æ€§æäº¤ git commit -m \u0026#34;fix: ä¿®å¤ç™»å½•é¡µé¢å“åº”å¼å¸ƒå±€é—®é¢˜\u0026#34; git commit -m \u0026#34;fix(api): ä¿®å¤ç”¨æˆ·æŸ¥è¯¢æ¥å£çš„ç©ºæŒ‡é’ˆå¼‚å¸¸\u0026#34; # æ–‡æ¡£æäº¤ git commit -m \u0026#34;docs: æ›´æ–°APIæ–‡æ¡£\u0026#34; git commit -m \u0026#34;docs(readme): æ·»åŠ å®‰è£…è¯´æ˜\u0026#34; # æ ·å¼æäº¤ git commit -m \u0026#34;style: æ ¼å¼åŒ–ä»£ç \u0026#34; git commit -m \u0026#34;style: è°ƒæ•´æŒ‰é’®é¢œè‰²\u0026#34; # é‡æ„æäº¤ git commit -m \u0026#34;refactor: é‡æ„ç”¨æˆ·æœåŠ¡ç±»\u0026#34; git commit -m \u0026#34;refactor(utils): æå–é€šç”¨å·¥å…·å‡½æ•°\u0026#34; # æ€§èƒ½ä¼˜åŒ– git commit -m \u0026#34;perf: ä¼˜åŒ–æ•°æ®åº“æŸ¥è¯¢æ€§èƒ½\u0026#34; git commit -m \u0026#34;perf: å‡å°‘é¦–é¡µåŠ è½½æ—¶é—´\u0026#34; # æµ‹è¯•æäº¤ git commit -m \u0026#34;test: æ·»åŠ ç”¨æˆ·æœåŠ¡å•å…ƒæµ‹è¯•\u0026#34; git commit -m \u0026#34;test: ä¿®å¤æµ‹è¯•ç”¨ä¾‹\u0026#34; # æ„å»ºç›¸å…³ git commit -m \u0026#34;build: æ›´æ–°ä¾èµ–ç‰ˆæœ¬\u0026#34; git commit -m \u0026#34;build: æ·»åŠ ç”Ÿäº§ç¯å¢ƒæ„å»ºé…ç½®\u0026#34; # å›æ»šæäº¤ git commit -m \u0026#34;revert: å›æ»šç”¨æˆ·è®¤è¯åŠŸèƒ½\u0026#34; æäº¤ä¿¡æ¯æ¨¡æ¿ 1 2 3 4 5 6 7 8 9 10 11 12 13 # é…ç½®æäº¤æ¨¡æ¿ git config --global commit.template ~/.gitmessage.txt # ~/.gitmessage.txt å†…å®¹ç¤ºä¾‹ # åŠŸèƒ½æè¿° (50å­—ç¬¦ä»¥å†…) # # è¯¦ç»†æè¿° (ä¸ºä»€ä¹ˆåšè¿™ä¸ªæ”¹åŠ¨ï¼Œè§£å†³äº†ä»€ä¹ˆé—®é¢˜) # # ç›¸å…³Issue: #123 # å½±å“èŒƒå›´: auth, api # æµ‹è¯•æƒ…å†µ: å·²æ·»åŠ å•å…ƒæµ‹è¯• 4. åˆ†æ”¯æ“ä½œæŠ€å·§ æŒæ¡å¸¸ç”¨åˆ†æ”¯æ“ä½œæé«˜æ•ˆç‡ï¼š\nåˆ†æ”¯åˆ›å»ºå’Œåˆ‡æ¢ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 # åˆ›å»ºæ–°åˆ†æ”¯ git branch feature/new-feature git checkout feature/new-feature # æˆ–è€…ä¸€æ­¥å®Œæˆ git checkout -b feature/new-feature # ä»è¿œç¨‹åˆ†æ”¯åˆ›å»ºæœ¬åœ°åˆ†æ”¯ git checkout -b local-branch origin/remote-branch # æŸ¥çœ‹æ‰€æœ‰åˆ†æ”¯ git branch # æœ¬åœ°åˆ†æ”¯ git branch -r # è¿œç¨‹åˆ†æ”¯ git branch -a # æ‰€æœ‰åˆ†æ”¯ # æŸ¥çœ‹åˆ†æ”¯æœ€åæäº¤ git branch -v # é‡å‘½ååˆ†æ”¯ git branch -m old-name new-name # åˆ é™¤åˆ†æ”¯ git branch -d branch-name # å®‰å…¨åˆ é™¤ï¼ˆå·²åˆå¹¶ï¼‰ git branch -D branch-name # å¼ºåˆ¶åˆ é™¤ åˆ†æ”¯åˆå¹¶ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 # æ™®é€šåˆå¹¶ git checkout main git merge feature-branch # å¿«è¿›åˆå¹¶ï¼ˆæ— å†²çªæ—¶ï¼‰ git merge --ff-only feature-branch # éå¿«è¿›åˆå¹¶ï¼ˆä¿ç•™åˆå¹¶å†å²ï¼‰ git merge --no-ff feature-branch # å‹ç¼©åˆå¹¶ï¼ˆå°†å¤šä¸ªæäº¤å‹ç¼©ä¸ºä¸€ä¸ªï¼‰ git merge --squash feature-branch # å˜åŸºåˆå¹¶ git checkout feature-branch git rebase main # äº¤äº’å¼å˜åŸº git rebase -i HEAD~3 # å˜åŸºç¤ºä¾‹ï¼šæ•´ç†æäº¤å†å² # pick 1234567 feat: å®ç°åŠŸèƒ½A # squash 2345678 fix: ä¿®å¤åŠŸèƒ½Açš„bug # squash 3456789 style: æ ¼å¼åŒ–åŠŸèƒ½Aä»£ç  # pick 4567890 feat: å®ç°åŠŸèƒ½B 5. è¿œç¨‹ä»“åº“æ“ä½œ é«˜æ•ˆçš„è¿œç¨‹ä»“åº“ç®¡ç†ï¼š\nè¿œç¨‹åˆ†æ”¯ç®¡ç† 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 # æŸ¥çœ‹è¿œç¨‹ä»“åº“ git remote -v # æ·»åŠ è¿œç¨‹ä»“åº“ git remote add origin https://github.com/user/repo.git # æ¨é€åˆ†æ”¯åˆ°è¿œç¨‹ git push origin main git push origin feature-branch git push -u origin feature-branch # è®¾ç½®ä¸Šæ¸¸åˆ†æ”¯ # æ‹‰å–è¿œç¨‹æ›´æ–° git fetch origin # è·å–è¿œç¨‹æ›´æ–°ï¼ˆä¸åˆå¹¶ï¼‰ git pull origin main # æ‹‰å–å¹¶åˆå¹¶ # ä»è¿œç¨‹è·å–ç‰¹å®šåˆ†æ”¯ git checkout -b local-branch origin/remote-branch # åˆ é™¤è¿œç¨‹åˆ†æ”¯ git push origin --delete branch-name git push origin :branch-name # ç®€å†™å½¢å¼ æ ‡ç­¾ç®¡ç† 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 # åˆ›å»ºæ ‡ç­¾ git tag v1.0.0 git tag -a v1.0.0 -m \u0026#34;ç‰ˆæœ¬1.0.0å‘å¸ƒ\u0026#34; # æ¨é€æ ‡ç­¾ git push origin v1.0.0 git push origin --tags # æ¨é€æ‰€æœ‰æ ‡ç­¾ # åˆ é™¤æ ‡ç­¾ git tag -d v1.0.0 # åˆ é™¤æœ¬åœ°æ ‡ç­¾ git push origin --delete v1.0.0 # åˆ é™¤è¿œç¨‹æ ‡ç­¾ # æŸ¥çœ‹æ ‡ç­¾ä¿¡æ¯ git show v1.0.0 git tag -n # æ˜¾ç¤ºæ ‡ç­¾å’Œæ³¨é‡Š 6. å†²çªè§£å†³ Gitå†²çªæ˜¯åä½œå¼€å‘ä¸­çš„å¸¸è§é—®é¢˜ï¼š\nè¯†åˆ«å†²çª 1 2 3 4 5 6 7 8 9 # åˆå¹¶å†²çª git merge feature-branch Auto-merging file.txt CONFLICT (content): Merge conflict in file.txt Automatic merge failed; fix conflicts and then commit the result. # å˜åŸºå†²çª git rebase main error: could not apply 1234567... commit message è§£å†³å†²çªæ­¥éª¤ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 # 1. æŸ¥çœ‹å†²çªæ–‡ä»¶ git status # 2. ç¼–è¾‘å†²çªæ–‡ä»¶ # å†²çªæ ‡è®°ç¤ºä¾‹ï¼š # \u0026lt;\u0026lt;\u0026lt;\u0026lt;\u0026lt;\u0026lt;\u0026lt; HEAD # å½“å‰åˆ†æ”¯çš„å†…å®¹ # ======= # åˆå¹¶åˆ†æ”¯çš„å†…å®¹ # \u0026gt;\u0026gt;\u0026gt;\u0026gt;\u0026gt;\u0026gt;\u0026gt; feature-branch # 3. æ‰‹åŠ¨è§£å†³å†²çª # åˆ é™¤å†²çªæ ‡è®°ï¼Œä¿ç•™æ­£ç¡®å†…å®¹ # 4. æ ‡è®°å†²çªå·²è§£å†³ git add conflicted-file.txt # 5. ç»§ç»­åˆå¹¶æˆ–å˜åŸº # åˆå¹¶å†²çª git commit # å˜åŸºå†²çª git rebase --continue # æ”¾å¼ƒå˜åŸº git rebase --abort # æŸ¥çœ‹å†²çªå·®å¼‚ git diff --name-only --diff-filter=U å†²çªè§£å†³å·¥å…· 1 2 3 4 5 6 7 8 9 10 11 # ä½¿ç”¨åˆå¹¶å·¥å…· git mergetool # é…ç½®åˆå¹¶å·¥å…· git config --global merge.tool vscode git config --global mergetool.vscode.cmd \u0026#39;code --wait $MERGED\u0026#39; # ä¸‰è·¯åˆå¹¶æ¯”è¾ƒ git diff --ours file.txt # æŸ¥çœ‹å½“å‰åˆ†æ”¯ç‰ˆæœ¬ git diff --theirs file.txt # æŸ¥çœ‹åˆå¹¶åˆ†æ”¯ç‰ˆæœ¬ git diff --base file.txt # æŸ¥çœ‹å…±åŒç¥–å…ˆç‰ˆæœ¬ 7. ä»£ç å®¡æŸ¥æµç¨‹ Pull Requestæ˜¯ä»£ç è´¨é‡çš„é‡è¦ä¿éšœï¼š\nåˆ›å»ºPull Request 1 2 3 4 5 6 7 # åŠŸèƒ½å¼€å‘å®Œæˆå git checkout -b feature/new-feature main # ... å¼€å‘å·¥ä½œ ... git push origin feature/new-feature # åœ¨GitHub/GitLabä¸Šåˆ›å»ºPR # å¡«å†™PRæ¨¡æ¿ PRæ¨¡æ¿ç¤ºä¾‹ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 ## å˜æ›´æè¿° ç®€è¦æè¿°æœ¬æ¬¡å˜æ›´çš„å†…å®¹å’Œç›®çš„ ## å˜æ›´ç±»å‹ - [ ] æ–°åŠŸèƒ½ (feature) - [ ] ä¿®å¤ (fix) - [ ] æ–‡æ¡£ (docs) - [ ] æ ·å¼ (style) - [ ] é‡æ„ (refactor) - [ ] æ€§èƒ½ä¼˜åŒ– (perf) - [ ] æµ‹è¯• (test) ## æµ‹è¯• - [ ] å•å…ƒæµ‹è¯•é€šè¿‡ - [ ] é›†æˆæµ‹è¯•é€šè¿‡ - [ ] æ‰‹åŠ¨æµ‹è¯•å®Œæˆ ## æ£€æŸ¥æ¸…å• - [ ] ä»£ç ç¬¦åˆé¡¹ç›®è§„èŒƒ - [ ] å·²æ›´æ–°ç›¸å…³æ–‡æ¡£ - [ ] æ— å®‰å…¨æ¼æ´ - [ ] æ€§èƒ½å½±å“è¯„ä¼° ## ç›¸å…³Issue Closes #123 ## æˆªå›¾ï¼ˆå¦‚é€‚ç”¨ï¼‰ \u0026lt;!-- æ·»åŠ ç›¸å…³æˆªå›¾ --\u0026gt; ## è¡¥å……è¯´æ˜ \u0026lt;!-- å…¶ä»–éœ€è¦è¯´æ˜çš„å†…å®¹ --\u0026gt; ä»£ç å®¡æŸ¥æŠ€å·§ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 # æŸ¥çœ‹PRå˜æ›´ git fetch origin pull/123/head:pr-123 git checkout pr-123 # æŸ¥çœ‹å·®å¼‚ git diff main...pr-123 git diff --stat main...pr-123 # æŸ¥çœ‹ç‰¹å®šæ–‡ä»¶çš„å˜æ›´å†å² git log -p main..pr-123 -- file.txt # ä½¿ç”¨å·¥å…·è¿›è¡Œä»£ç å®¡æŸ¥ # GitHub/GitLabçš„Webç•Œé¢ # å‘½ä»¤è¡Œå·¥å…·ï¼šgh pr view, lab mr show 8. å›æ»šå’Œæ¢å¤ Gitæä¾›å¤šç§å›æ»šæœºåˆ¶ï¼š\næ’¤é”€æœªæäº¤çš„ä¿®æ”¹ 1 2 3 4 5 6 7 8 9 10 11 # æ’¤é”€å·¥ä½œç›®å½•çš„ä¿®æ”¹ git checkout -- file.txt # æ’¤é”€å•ä¸ªæ–‡ä»¶ git checkout -- . # æ’¤é”€æ‰€æœ‰æ–‡ä»¶ # æ’¤é”€æš‚å­˜åŒºçš„ä¿®æ”¹ git reset HEAD file.txt # ä»æš‚å­˜åŒºç§»é™¤ git reset HEAD # ç§»é™¤æ‰€æœ‰æš‚å­˜æ–‡ä»¶ # æ¸…ç†æœªè·Ÿè¸ªçš„æ–‡ä»¶ git clean -fd # åˆ é™¤æœªè·Ÿè¸ªçš„æ–‡ä»¶å’Œç›®å½• git clean -nfd # é¢„è§ˆå°†è¦åˆ é™¤çš„æ–‡ä»¶ æ’¤é”€å·²æäº¤çš„ä¿®æ”¹ 1 2 3 4 5 6 7 8 9 10 11 12 # è½¯å›æ»šï¼ˆä¿ç•™ä¿®æ”¹ï¼Œæ’¤é”€æäº¤ï¼‰ git reset --soft HEAD~1 # æ··åˆå›æ»šï¼ˆæ’¤é”€æäº¤å’Œæš‚å­˜ï¼Œä¿ç•™å·¥ä½œç›®å½•ï¼‰ git reset --mixed HEAD~1 git reset HEAD~1 # é»˜è®¤è¡Œä¸º # ç¡¬å›æ»šï¼ˆæ’¤é”€æ‰€æœ‰ä¿®æ”¹ï¼Œå›åˆ°æŒ‡å®šæäº¤ï¼‰ git reset --hard HEAD~1 # åˆ›å»ºåå‘æäº¤ï¼ˆæ¨èç”¨äºå…¬å…±åˆ†æ”¯ï¼‰ git revert HEAD # åˆ›å»ºæ’¤é”€ä¸Šæ¬¡æäº¤çš„æ–°æäº¤ æ¢å¤ä¸¢å¤±çš„æäº¤ 1 2 3 4 5 6 7 8 9 10 11 # æŸ¥çœ‹æ“ä½œå†å² git reflog # æ¢å¤ä¸¢å¤±çš„æäº¤ git reset --hard HEAD@{2} git checkout -b recover-branch HEAD@{2} # æŸ¥æ‰¾ç‰¹å®šæäº¤ git log --grep=\u0026#34;å…³é”®è¯\u0026#34; git log --author=\u0026#34;ä½œè€…å\u0026#34; git log --since=\u0026#34;2024-01-01\u0026#34; 9. é«˜çº§GitæŠ€å·§ æŒæ¡Gité«˜çº§åŠŸèƒ½æå‡æ•ˆç‡ï¼š\nGit Hooks 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 # æŸ¥çœ‹å¯ç”¨hooks ls .git/hooks/ # å¯ç”¨pre-commit hookï¼ˆç¤ºä¾‹ï¼šä»£ç æ ¼å¼æ£€æŸ¥ï¼‰ #!/bin/sh # .git/hooks/pre-commit npm run lint if [ $? -ne 0 ]; then echo \u0026#34;ä»£ç æ ¼å¼æ£€æŸ¥å¤±è´¥ï¼Œè¯·ä¿®å¤åå†æäº¤\u0026#34; exit 1 fi echo \u0026#34;ä»£ç æ ¼å¼æ£€æŸ¥é€šè¿‡\u0026#34; exit 0 # è®¾ç½®æ‰§è¡Œæƒé™ chmod +x .git/hooks/pre-commit å­æ¨¡å—ç®¡ç† 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 # æ·»åŠ å­æ¨¡å— git submodule add https://github.com/user/repo.git path/to/submodule # å…‹éš†åŒ…å«å­æ¨¡å—çš„ä»“åº“ git clone --recursive https://github.com/user/main-repo.git # æˆ–è€… git clone https://github.com/user/main-repo.git cd main-repo git submodule init git submodule update # æ›´æ–°å­æ¨¡å— git submodule update --remote # åˆ é™¤å­æ¨¡å— git submodule deinit path/to/submodule git rm path/to/submodule git commit -m \u0026#34;ç§»é™¤å­æ¨¡å—\u0026#34; Git Stash 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 # æš‚å­˜å½“å‰å·¥ä½œ git stash git stash push -m \u0026#34;å·¥ä½œæè¿°\u0026#34; # æŸ¥çœ‹æš‚å­˜åˆ—è¡¨ git stash list # åº”ç”¨æš‚å­˜ git stash apply git stash apply stash@{1} # åº”ç”¨å¹¶åˆ é™¤æš‚å­˜ git stash pop # åˆ é™¤æš‚å­˜ git stash drop git stash clear Git Alias 1 2 3 4 5 6 7 8 9 10 11 12 13 14 # é…ç½®å¸¸ç”¨åˆ«å git config --global alias.co checkout git config --global alias.br branch git config --global alias.ci commit git config --global alias.st status git config --global alias.unstage \u0026#39;reset HEAD --\u0026#39; git config --global alias.last \u0026#39;log -1 HEAD\u0026#39; git config --global alias.visual \u0026#39;!gitk\u0026#39; git config --global alias.graph \u0026#39;log --oneline --graph --decorate --all\u0026#39; git config --global alias.amend \u0026#39;commit --amend\u0026#39; git config --global alias.undo \u0026#39;reset --soft HEAD~1\u0026#39; # æŸ¥çœ‹æ‰€æœ‰åˆ«å git config --global --get-regexp alias 10. æ€§èƒ½ä¼˜åŒ– ä¼˜åŒ–Gitæ“ä½œæå‡æ€§èƒ½ï¼š\nå¤§æ–‡ä»¶å¤„ç† 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 # ä½¿ç”¨Git LFSï¼ˆLarge File Storageï¼‰ # å®‰è£…Git LFS git lfs install # è·Ÿè¸ªå¤§æ–‡ä»¶ git lfs track \u0026#34;*.zip\u0026#34; git lfs track \u0026#34;*.pdf\u0026#34; git lfs track \u0026#34;*.mov\u0026#34; # æŸ¥çœ‹LFSè·Ÿè¸ªçš„æ–‡ä»¶ git lfs ls-files # Git LFSé…ç½® cat .gitattributes # *.zip filter=lfs diff=lfs merge=lfs -text # *.pdf filter=lfs diff=lfs merge=lfs -text ä»“åº“æ¸…ç† 1 2 3 4 5 6 7 8 9 10 11 12 13 14 # åƒåœ¾å›æ”¶ git gc # å‹ç¼©ä»“åº“å†å² git gc --aggressive # æ¸…ç†ä¸å¿…è¦çš„æ–‡ä»¶ git prune # ç§»é™¤å¤§æ–‡ä»¶å†å² git filter-branch --tree-filter \u0026#39;rm -rf large-file.zip\u0026#39; HEAD # ä½¿ç”¨BFG Repo-Cleanerï¼ˆæ›´é«˜æ•ˆï¼‰ # java -jar bfg.jar --delete-files large-file.zip my-repo.git æµ…å…‹éš†å’Œéƒ¨åˆ†å…‹éš† 1 2 3 4 5 6 7 8 # æµ…å…‹éš†ï¼ˆåªè·å–æœ€æ–°æäº¤ï¼‰ git clone --depth 1 https://github.com/user/repo.git # éƒ¨åˆ†å…‹éš†ï¼ˆåªå…‹éš†ç‰¹å®šç›®å½•ï¼‰ git clone --filter=blob:none --sparse https://github.com/user/repo.git cd repo git sparse-checkout init --cone git sparse-checkout set src/main å›¢é˜Ÿåä½œæœ€ä½³å®è·µ åˆ†æ”¯ç­–ç•¥é€‰æ‹© 1 2 3 4 5 6 7 8 # å°å›¢é˜Ÿæ¨èï¼šGitHub Flow # main + feature/* åˆ†æ”¯ # ä¸­ç­‰å›¢é˜Ÿæ¨èï¼šGit Flow # master + develop + feature/* + release/* + hotfix/* # å¤§å‹å›¢é˜Ÿæ¨èï¼šGitLab Flow # main + develop + environment/* + feature/* æäº¤è§„èŒƒ 1 2 3 4 5 6 7 8 9 # ä½¿ç”¨commitizenå·¥å…·è§„èŒƒåŒ–æäº¤ npm install -g commitizen git cz # äº¤äº’å¼æäº¤ # ä½¿ç”¨huskyè‡ªåŠ¨æ£€æŸ¥ npm install husky --save-dev npx husky install npx husky add .husky/commit-msg \u0026#39;npx commitlint --edit $1\u0026#39; npx husky add .husky/pre-commit \u0026#39;npm test\u0026#39; æŒç»­é›†æˆé…ç½® 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 # .github/workflows/ci.yml name: CI on: push: branches: [ main, develop ] pull_request: branches: [ main ] jobs: test: runs-on: ubuntu-latest steps: - uses: actions/checkout@v3 - name: Setup Node.js uses: actions/setup-node@v3 with: node-version: \u0026#39;18\u0026#39; - name: Install dependencies run: npm ci - name: Run tests run: npm test - name: Run linting run: npm run lint - name: Check commit messages run: npx commitlint --from=origin/main --to HEAD æ€»ç»“ Gitæ˜¯å¼ºå¤§çš„ç‰ˆæœ¬æ§åˆ¶å·¥å…·ï¼ŒæŒæ¡å…¶æ ¸å¿ƒæ¦‚å¿µå’Œæœ€ä½³å®è·µå¯¹ç°ä»£è½¯ä»¶å¼€å‘è‡³å…³é‡è¦ã€‚é€šè¿‡åˆç†çš„å·¥ä½œæµç¨‹ã€è§„èŒƒçš„æäº¤ä¿¡æ¯ã€æœ‰æ•ˆçš„åˆ†æ”¯ç®¡ç†å’Œå›¢é˜Ÿåä½œï¼ŒGitèƒ½å¤Ÿæ˜¾è‘—æå‡å¼€å‘æ•ˆç‡å’Œä»£ç è´¨é‡ã€‚\nè®°ä½ï¼ŒGitçš„å­¦ä¹ æ˜¯ä¸€ä¸ªæŒç»­çš„è¿‡ç¨‹ã€‚ä»åŸºç¡€æ“ä½œå¼€å§‹ï¼Œé€æ­¥æŒæ¡é«˜çº§åŠŸèƒ½ï¼Œæ ¹æ®å›¢é˜Ÿéœ€æ±‚é€‰æ‹©åˆé€‚çš„å·¥ä½œæµç¨‹ï¼Œæ‰èƒ½å……åˆ†å‘æŒ¥Gitçš„å¨åŠ›ã€‚\n","permalink":"/blog/articles/git-workflow-guide/","summary":"å…¨é¢ä»‹ç»Gitç‰ˆæœ¬æ§åˆ¶çš„æ ¸å¿ƒæ¦‚å¿µå’Œæœ€ä½³å®è·µï¼ŒåŒ…æ‹¬åˆ†æ”¯ç­–ç•¥ã€åä½œæµç¨‹ã€å†²çªè§£å†³ã€ä»£ç å®¡æŸ¥ç­‰ï¼Œå¸®åŠ©å›¢é˜Ÿå»ºç«‹é«˜æ•ˆçš„Gitå·¥ä½œæµç¨‹ã€‚","title":"Gitå·¥ä½œæµå®Œå…¨æŒ‡å—ï¼šä»å…¥é—¨åˆ°ç²¾é€šçš„ç‰ˆæœ¬æ§åˆ¶å®è·µ"},{"content":"Node.jsåº”ç”¨çš„å®‰å…¨æ€§æ˜¯ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²çš„é‡è¦è€ƒè™‘å› ç´ ã€‚éšç€Node.jsåœ¨æœåŠ¡ç«¯å¼€å‘ä¸­çš„å¹¿æ³›åº”ç”¨ï¼Œå®‰å…¨é—®é¢˜ä¹Ÿæ—¥ç›Šçªå‡ºã€‚æœ¬æ–‡å°†ä»‹ç»Node.jså®‰å…¨å¼€å‘çš„æœ€ä½³å®è·µå’Œé˜²æŠ¤ç­–ç•¥ã€‚\n1. è¾“å…¥éªŒè¯å’Œæ•°æ®æ¸…ç† é˜²æ­¢æ³¨å…¥æ”»å‡» 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 // ä½¿ç”¨helmetè®¾ç½®å®‰å…¨HTTPå¤´ const helmet = require(\u0026#39;helmet\u0026#39;); app.use(helmet()); // è‡ªå®šä¹‰å®‰å…¨å¤´é…ç½® app.use(helmet({ contentSecurityPolicy: { directives: { defaultSrc: [\u0026#34;\u0026#39;self\u0026#39;\u0026#34;], styleSrc: [\u0026#34;\u0026#39;self\u0026#39;\u0026#34;, \u0026#34;\u0026#39;unsafe-inline\u0026#39;\u0026#34;], scriptSrc: [\u0026#34;\u0026#39;self\u0026#39;\u0026#34;], imgSrc: [\u0026#34;\u0026#39;self\u0026#39;\u0026#34;, \u0026#34;data:\u0026#34;, \u0026#34;https:\u0026#34;], }, }, hsts: { maxAge: 31536000, includeSubDomains: true, preload: true } })); // è¾“å…¥éªŒè¯ä¸­é—´ä»¶ const { body, validationResult, check } = require(\u0026#39;express-validator\u0026#39;); // ç”¨æˆ·æ³¨å†ŒéªŒè¯ const validateUserRegistration = [ check(\u0026#39;username\u0026#39;) .isLength({ min: 3, max: 30 }) .withMessage(\u0026#39;ç”¨æˆ·åé•¿åº¦å¿…é¡»åœ¨3-30ä¸ªå­—ç¬¦ä¹‹é—´\u0026#39;) .matches(/^[a-zA-Z0-9_]+$/) .withMessage(\u0026#39;ç”¨æˆ·ååªèƒ½åŒ…å«å­—æ¯ã€æ•°å­—å’Œä¸‹åˆ’çº¿\u0026#39;), check(\u0026#39;email\u0026#39;) .isEmail() .normalizeEmail() .withMessage(\u0026#39;è¯·è¾“å…¥æœ‰æ•ˆçš„é‚®ç®±åœ°å€\u0026#39;), check(\u0026#39;password\u0026#39;) .isLength({ min: 8 }) .withMessage(\u0026#39;å¯†ç é•¿åº¦è‡³å°‘8ä¸ªå­—ç¬¦\u0026#39;) .matches(/^(?=.*[a-z])(?=.*[A-Z])(?=.*\\d)(?=.*[@$!%*?\u0026amp;])[A-Za-z\\d@$!%*?\u0026amp;]/) .withMessage(\u0026#39;å¯†ç å¿…é¡»åŒ…å«å¤§å°å†™å­—æ¯ã€æ•°å­—å’Œç‰¹æ®Šå­—ç¬¦\u0026#39;), check(\u0026#39;age\u0026#39;) .isInt({ min: 18, max: 120 }) .withMessage(\u0026#39;å¹´é¾„å¿…é¡»åœ¨18-120ä¹‹é—´\u0026#39;), ]; // éªŒè¯ä¸­é—´ä»¶å¤„ç† app.post(\u0026#39;/api/users/register\u0026#39;, validateUserRegistration, (req, res) =\u0026gt; { const errors = validationResult(req); if (!errors.isEmpty()) { return res.status(400).json({ success: false, errors: errors.array() }); } // å¤„ç†æ³¨å†Œé€»è¾‘ const { username, email, password, age } = req.body; // ... }); // SQLæ³¨å…¥é˜²æŠ¤ const mysql = require(\u0026#39;mysql2/promise\u0026#39;); const getUserById = async (userId) =\u0026gt; { const connection = await mysql.createConnection(dbConfig); try { // âœ… ä½¿ç”¨å‚æ•°åŒ–æŸ¥è¯¢ const [rows] = await connection.execute( \u0026#39;SELECT * FROM users WHERE id = ?\u0026#39;, [userId] ); return rows[0]; // âŒ å±é™©çš„å­—ç¬¦ä¸²æ‹¼æ¥ // const query = `SELECT * FROM users WHERE id = ${userId}`; // const [rows] = await connection.execute(query); } finally { await connection.end(); } }; // NoSQLæ³¨å…¥é˜²æŠ¤ const mongoSanitize = require(\u0026#39;express-mongo-sanitize\u0026#39;); app.use(mongoSanitize()); // ä½¿ç”¨mongooseçš„éªŒè¯å’Œå®‰å…¨æŸ¥è¯¢ const User = require(\u0026#39;./models/User\u0026#39;); const findUsers = async (criteria) =\u0026gt; { // âœ… ä½¿ç”¨mongooseçš„æŸ¥è¯¢æ„å»ºå™¨ const query = {}; if (criteria.name) { query.name = new RegExp(criteria.name, \u0026#39;i\u0026#39;); } if (criteria.age) { query.age = criteria.age; } return await User.find(query).select(\u0026#39;-password\u0026#39;); // âŒ å±é™©çš„ç›´æ¥æŸ¥è¯¢ // return await User.find(JSON.parse(criteria)); }; XSSé˜²æŠ¤ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 const xss = require(\u0026#39;xss\u0026#39;); // HTMLå†…å®¹æ¸…ç† const sanitizeHTML = (html) =\u0026gt; { return xss(html, { whiteList: { a: [\u0026#39;href\u0026#39;, \u0026#39;title\u0026#39;, \u0026#39;target\u0026#39;], b: [], i: [], em: [], strong: [], p: [], br: [] }, stripIgnoreTag: true, stripIgnoreTagBody: [\u0026#39;script\u0026#39;] }); }; // ç”¨æˆ·å†…å®¹å¤„ç† app.post(\u0026#39;/api/posts\u0026#39;, (req, res) =\u0026gt; { const { title, content } = req.body; // æ¸…ç†ç”¨æˆ·è¾“å…¥ const sanitizedContent = sanitizeHTML(content); // ä¿å­˜åˆ°æ•°æ®åº“ const post = new Post({ title: xss(title), content: sanitizedContent, author: req.user.id }); await post.save(); res.json({ success: true, post: post }); }); // è¾“å‡ºæ—¶è½¬ä¹‰ app.set(\u0026#39;view engine\u0026#39;, \u0026#39;ejs\u0026#39;); app.get(\u0026#39;/posts/:id\u0026#39;, async (req, res) =\u0026gt; { const post = await Post.findById(req.params.id); res.render(\u0026#39;post\u0026#39;, { post }); // EJSæ¨¡æ¿å¼•æ“ä¼šè‡ªåŠ¨è½¬ä¹‰ }); 2. è®¤è¯å’Œæˆæƒ JWTä»¤ç‰Œå®‰å…¨ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 const jwt = require(\u0026#39;jsonwebtoken\u0026#39;); const crypto = require(\u0026#39;crypto\u0026#39;); // JWTé…ç½® const JWT_CONFIG = { secret: process.env.JWT_SECRET || crypto.randomBytes(64).toString(\u0026#39;hex\u0026#39;), expiresIn: \u0026#39;15m\u0026#39;, refreshExpiresIn: \u0026#39;7d\u0026#39; }; // ç”ŸæˆJWTä»¤ç‰Œ const generateTokens = (user) =\u0026gt; { const payload = { id: user.id, email: user.email, role: user.role, type: \u0026#39;access\u0026#39; }; const accessToken = jwt.sign(payload, JWT_CONFIG.secret, { expiresIn: JWT_CONFIG.expiresIn, issuer: \u0026#39;your-app\u0026#39;, audience: \u0026#39;your-app-users\u0026#39; }); const refreshToken = jwt.sign( { id: user.id, type: \u0026#39;refresh\u0026#39;, tokenVersion: user.tokenVersion || 0 }, JWT_CONFIG.secret, { expiresIn: JWT_CONFIG.refreshExpiresIn } ); return { accessToken, refreshToken }; }; // éªŒè¯JWTä¸­é—´ä»¶ const authenticateToken = (req, res, next) =\u0026gt; { const authHeader = req.headers[\u0026#39;authorization\u0026#39;]; const token = authHeader \u0026amp;\u0026amp; authHeader.split(\u0026#39; \u0026#39;)[1]; if (!token) { return res.status(401).json({ success: false, message: \u0026#39;è®¿é—®ä»¤ç‰Œç¼ºå¤±\u0026#39; }); } jwt.verify(token, JWT_CONFIG.secret, (err, user) =\u0026gt; { if (err) { return res.status(403).json({ success: false, message: \u0026#39;æ— æ•ˆçš„è®¿é—®ä»¤ç‰Œ\u0026#39; }); } if (user.type !== \u0026#39;access\u0026#39;) { return res.status(403).json({ success: false, message: \u0026#39;ä»¤ç‰Œç±»å‹é”™è¯¯\u0026#39; }); } req.user = user; next(); }); }; // åˆ·æ–°ä»¤ç‰Œ const refreshAccessToken = async (refreshToken) =\u0026gt; { try { const decoded = jwt.verify(refreshToken, JWT_CONFIG.secret); if (decoded.type !== \u0026#39;refresh\u0026#39;) { throw new Error(\u0026#39;æ— æ•ˆçš„åˆ·æ–°ä»¤ç‰Œ\u0026#39;); } const user = await User.findById(decoded.id); if (!user || user.tokenVersion !== decoded.tokenVersion) { throw new Error(\u0026#39;ç”¨æˆ·ä¿¡æ¯å·²æ›´æ–°ï¼Œè¯·é‡æ–°ç™»å½•\u0026#39;); } const tokens = generateTokens(user); // ä¿å­˜æ–°çš„refresh token user.refreshToken = tokens.refreshToken; await user.save(); return tokens; } catch (error) { throw new Error(\u0026#39;ä»¤ç‰Œåˆ·æ–°å¤±è´¥\u0026#39;); } }; åŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶ï¼ˆRBACï¼‰ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 // æƒé™æ£€æŸ¥ä¸­é—´ä»¶ const authorize = (...roles) =\u0026gt; { return (req, res, next) =\u0026gt; { if (!req.user) { return res.status(401).json({ success: false, message: \u0026#39;æœªè®¤è¯ç”¨æˆ·\u0026#39; }); } if (!roles.includes(req.user.role)) { return res.status(403).json({ success: false, message: \u0026#39;æƒé™ä¸è¶³\u0026#39; }); } next(); }; }; // ç²¾ç»†åŒ–æƒé™æ§åˆ¶ const checkPermission = (resource, action) =\u0026gt; { return (req, res, next) =\u0026gt; { const user = req.user; const permission = `${resource}:${action}`; // ç®¡ç†å‘˜æ‹¥æœ‰æ‰€æœ‰æƒé™ if (user.role === \u0026#39;admin\u0026#39;) { return next(); } // æ£€æŸ¥ç”¨æˆ·æƒé™ if (!user.permissions || !user.permissions.includes(permission)) { return res.status(403).json({ success: false, message: \u0026#39;æ“ä½œæƒé™ä¸è¶³\u0026#39; }); } next(); }; }; // èµ„æºæ‰€æœ‰è€…æ£€æŸ¥ const checkOwnership = (resourceModel, resourceIdParam = \u0026#39;id\u0026#39;) =\u0026gt; { return async (req, res, next) =\u0026gt; { try { const resourceId = req.params[resourceIdParam]; const resource = await resourceModel.findById(resourceId); if (!resource) { return res.status(404).json({ success: false, message: \u0026#39;èµ„æºä¸å­˜åœ¨\u0026#39; }); } // ç®¡ç†å‘˜æˆ–èµ„æºæ‰€æœ‰è€…å¯ä»¥è®¿é—® if (req.user.role === \u0026#39;admin\u0026#39; || resource.owner.toString() === req.user.id) { req.resource = resource; return next(); } res.status(403).json({ success: false, message: \u0026#39;æ— æƒè®¿é—®æ­¤èµ„æº\u0026#39; }); } catch (error) { res.status(500).json({ success: false, message: \u0026#39;æƒé™æ£€æŸ¥å¤±è´¥\u0026#39; }); } }; }; // ä½¿ç”¨ç¤ºä¾‹ app.get(\u0026#39;/api/users/profile\u0026#39;, authenticateToken, (req, res) =\u0026gt; { // ç”¨æˆ·åªèƒ½æŸ¥çœ‹è‡ªå·±çš„èµ„æ–™ }); app.get(\u0026#39;/api/users/:id\u0026#39;, authenticateToken, authorize(\u0026#39;admin\u0026#39;), (req, res) =\u0026gt; { // åªæœ‰ç®¡ç†å‘˜å¯ä»¥æŸ¥çœ‹å…¶ä»–ç”¨æˆ·ä¿¡æ¯ } ); app.put(\u0026#39;/api/posts/:id\u0026#39;, authenticateToken, checkOwnership(Post), (req, res) =\u0026gt; { // åªæœ‰æ–‡ç« ä½œè€…æˆ–ç®¡ç†å‘˜å¯ä»¥ä¿®æ”¹ } ); 3. æ•°æ®åŠ å¯†å’Œå­˜å‚¨å®‰å…¨ å¯†ç åŠ å¯† 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 const bcrypt = require(\u0026#39;bcrypt\u0026#39;); const crypto = require(\u0026#39;crypto\u0026#39;); // å¯†ç å“ˆå¸Œ const hashPassword = async (password) =\u0026gt; { const saltRounds = 12; return await bcrypt.hash(password, saltRounds); }; // å¯†ç éªŒè¯ const verifyPassword = async (password, hashedPassword) =\u0026gt; { return await bcrypt.compare(password, hashedPassword); }; // ç”¨æˆ·æ³¨å†Œç¤ºä¾‹ app.post(\u0026#39;/api/auth/register\u0026#39;, async (req, res) =\u0026gt; { try { const { username, email, password } = req.body; // æ£€æŸ¥ç”¨æˆ·æ˜¯å¦å·²å­˜åœ¨ const existingUser = await User.findOne({ $or: [{ email }, { username }] }); if (existingUser) { return res.status(409).json({ success: false, message: \u0026#39;ç”¨æˆ·åæˆ–é‚®ç®±å·²å­˜åœ¨\u0026#39; }); } // åŠ å¯†å¯†ç  const hashedPassword = await hashPassword(password); // åˆ›å»ºç”¨æˆ· const user = new User({ username, email, password: hashedPassword, tokenVersion: 0 }); await user.save(); res.status(201).json({ success: true, message: \u0026#39;æ³¨å†ŒæˆåŠŸ\u0026#39; }); } catch (error) { res.status(500).json({ success: false, message: \u0026#39;æ³¨å†Œå¤±è´¥\u0026#39; }); } }); æ•æ„Ÿæ•°æ®åŠ å¯† 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 const crypto = require(\u0026#39;crypto\u0026#39;); // å¯¹ç§°åŠ å¯† class DataEncryption { constructor(secretKey) { this.algorithm = \u0026#39;aes-256-gcm\u0026#39;; this.secretKey = crypto.scryptSync(secretKey, \u0026#39;salt\u0026#39;, 32); } encrypt(text) { const iv = crypto.randomBytes(16); const cipher = crypto.createCipher(this.algorithm, this.secretKey); cipher.setAAD(Buffer.from(\u0026#39;additional-data\u0026#39;)); let encrypted = cipher.update(text, \u0026#39;utf8\u0026#39;, \u0026#39;hex\u0026#39;); encrypted += cipher.final(\u0026#39;hex\u0026#39;); const authTag = cipher.getAuthTag(); return { encrypted, iv: iv.toString(\u0026#39;hex\u0026#39;), authTag: authTag.toString(\u0026#39;hex\u0026#39;) }; } decrypt(encryptedData) { const decipher = crypto.createDecipher(this.algorithm, this.secretKey); decipher.setAAD(Buffer.from(\u0026#39;additional-data\u0026#39;)); decipher.setAuthTag(Buffer.from(encryptedData.authTag, \u0026#39;hex\u0026#39;)); let decrypted = decipher.update(encryptedData.encrypted, \u0026#39;hex\u0026#39;, \u0026#39;utf8\u0026#39;); decrypted += decipher.final(\u0026#39;utf8\u0026#39;); return decrypted; } } const encryption = new DataEncryption(process.env.ENCRYPTION_KEY); // æ•æ„Ÿä¿¡æ¯å­˜å‚¨ const saveSensitiveData = async (userId, sensitiveInfo) =\u0026gt; { const encrypted = encryption.encrypt(JSON.stringify(sensitiveInfo)); const sensitiveData = new SensitiveData({ userId, data: encrypted.encrypted, iv: encrypted.iv, authTag: encrypted.authTag }); await sensitiveData.save(); }; // APIå¯†é’¥ç®¡ç† class APIKeyManager { static generateAPIKey() { return crypto.randomBytes(32).toString(\u0026#39;hex\u0026#39;); } static hashAPIKey(apiKey) { return crypto.createHash(\u0026#39;sha256\u0026#39;).update(apiKey).digest(\u0026#39;hex\u0026#39;); } static verifyAPIKey(apiKey, hashedKey) { const hashed = this.hashAPIKey(apiKey); return crypto.timingSafeEqual( Buffer.from(hashed), Buffer.from(hashedKey) ); } } 4. ä¼šè¯å’ŒCookieå®‰å…¨ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 const session = require(\u0026#39;express-session\u0026#39;); const cookieParser = require(\u0026#39;cookie-parser\u0026#39;); // å®‰å…¨çš„ä¼šè¯é…ç½® app.use(session({ secret: process.env.SESSION_SECRET || crypto.randomBytes(64).toString(\u0026#39;hex\u0026#39;), resave: false, saveUninitialized: false, name: \u0026#39;sessionId\u0026#39;, // è‡ªå®šä¹‰cookieåç§° cookie: { secure: process.env.NODE_ENV === \u0026#39;production\u0026#39;, // HTTPS only httpOnly: true, // é˜²æ­¢XSS maxAge: 24 * 60 * 60 * 1000, // 24å°æ—¶ sameSite: \u0026#39;strict\u0026#39;, // CSRFé˜²æŠ¤ path: \u0026#39;/\u0026#39; } })); // ä¼šè¯ä¸­é—´ä»¶ const sessionMiddleware = (req, res, next) =\u0026gt; { if (!req.session.userId) { req.session.userId = req.user.id; req.session.createdAt = Date.now(); } // ä¼šè¯è¶…æ—¶æ£€æŸ¥ const sessionAge = Date.now() - req.session.createdAt; const maxSessionAge = 24 * 60 * 60 * 1000; // 24å°æ—¶ if (sessionAge \u0026gt; maxSessionAge) { req.session.destroy(); return res.status(401).json({ success: false, message: \u0026#39;ä¼šè¯å·²è¿‡æœŸï¼Œè¯·é‡æ–°ç™»å½•\u0026#39; }); } next(); }; // ç™»å‡ºå¤„ç† app.post(\u0026#39;/api/auth/logout\u0026#39;, (req, res) =\u0026gt; { req.session.destroy((err) =\u0026gt; { if (err) { return res.status(500).json({ success: false, message: \u0026#39;ç™»å‡ºå¤±è´¥\u0026#39; }); } res.clearCookie(\u0026#39;sessionId\u0026#39;); res.json({ success: true, message: \u0026#39;å·²æˆåŠŸç™»å‡º\u0026#39; }); }); }); 5. é™æµå’Œé˜²æŠ¤ è¯·æ±‚é™æµ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 const rateLimit = require(\u0026#39;express-rate-limit\u0026#39;); // é€šç”¨é™æµ const generalLimiter = rateLimit({ windowMs: 15 * 60 * 1000, // 15åˆ†é’Ÿ max: 100, // é™åˆ¶æ¯ä¸ªIP 15åˆ†é’Ÿå†…æœ€å¤š100ä¸ªè¯·æ±‚ message: { success: false, message: \u0026#39;è¯·æ±‚è¿‡äºé¢‘ç¹ï¼Œè¯·ç¨åå†è¯•\u0026#39; }, standardHeaders: true, legacyHeaders: false, }); // ç™»å½•é™æµ const loginLimiter = rateLimit({ windowMs: 15 * 60 * 1000, // 15åˆ†é’Ÿ max: 5, // é™åˆ¶æ¯ä¸ªIP 15åˆ†é’Ÿå†…æœ€å¤š5æ¬¡ç™»å½•å°è¯• message: { success: false, message: \u0026#39;ç™»å½•å°è¯•æ¬¡æ•°è¿‡å¤šï¼Œè¯·15åˆ†é’Ÿåå†è¯•\u0026#39; }, skipSuccessfulRequests: true, }); // APIé™æµ const apiLimiter = rateLimit({ windowMs: 1 * 60 * 1000, // 1åˆ†é’Ÿ max: 30, // é™åˆ¶æ¯ä¸ªIP 1åˆ†é’Ÿå†…æœ€å¤š30ä¸ªAPIè¯·æ±‚ keyGenerator: (req) =\u0026gt; { return req.user ? `user_${req.user.id}` : req.ip; }, }); // åº”ç”¨é™æµä¸­é—´ä»¶ app.use(\u0026#39;/api/\u0026#39;, apiLimiter); app.post(\u0026#39;/api/auth/login\u0026#39;, loginLimiter); // è‡ªå®šä¹‰é™æµé€»è¾‘ const createCustomLimiter = (maxRequests, windowMs) =\u0026gt; { const requests = new Map(); return (req, res, next) =\u0026gt; { const key = req.user ? `user_${req.user.id}` : req.ip; const now = Date.now(); const windowStart = now - windowMs; // æ¸…ç†è¿‡æœŸè®°å½• if (requests.has(key)) { const userRequests = requests.get(key).filter( timestamp =\u0026gt; timestamp \u0026gt; windowStart ); requests.set(key, userRequests); } // æ£€æŸ¥è¯·æ±‚æ•°é‡ const currentRequests = requests.get(key) || []; if (currentRequests.length \u0026gt;= maxRequests) { return res.status(429).json({ success: false, message: \u0026#39;è¯·æ±‚è¿‡äºé¢‘ç¹ï¼Œè¯·ç¨åå†è¯•\u0026#39; }); } // è®°å½•å½“å‰è¯·æ±‚ currentRequests.push(now); requests.set(key, currentRequests); next(); }; }; CSRFé˜²æŠ¤ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 const csrf = require(\u0026#39;csurf\u0026#39;); const csrfProtection = csrf({ cookie: { httpOnly: true, secure: process.env.NODE_ENV === \u0026#39;production\u0026#39;, sameSite: \u0026#39;strict\u0026#39; } }); app.use(csrfProtection); // æä¾›CSRFä»¤ç‰Œ app.get(\u0026#39;/api/csrf-token\u0026#39;, (req, res) =\u0026gt; { res.json({ csrfToken: req.csrfToken() }); }); // é”™è¯¯å¤„ç† app.use((err, req, res, next) =\u0026gt; { if (err.code !== \u0026#39;EBADCSRFTOKEN\u0026#39;) return next(err); res.status(403).json({ success: false, message: \u0026#39;CSRFä»¤ç‰ŒéªŒè¯å¤±è´¥\u0026#39; }); }); 6. æ—¥å¿—å’Œç›‘æ§ å®‰å…¨æ—¥å¿—è®°å½• 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 const winston = require(\u0026#39;winston\u0026#39;); // å®‰å…¨æ—¥å¿—é…ç½® const securityLogger = winston.createLogger({ level: \u0026#39;info\u0026#39;, format: winston.format.combine( winston.format.timestamp(), winston.format.json() ), transports: [ new winston.transports.File({ filename: \u0026#39;security.log\u0026#39;, maxsize: 5242880, // 5MB maxFiles: 5 }), new winston.transports.Console({ format: winston.format.simple() }) ] }); // å®‰å…¨äº‹ä»¶è®°å½• const logSecurityEvent = (event, details) =\u0026gt; { securityLogger.info({ event, timestamp: new Date().toISOString(), ...details }); }; // ç™»å½•å¤±è´¥ç›‘æ§ const failedLoginAttempts = new Map(); const MAX_FAILED_ATTEMPTS = 5; const LOCKOUT_TIME = 15 * 60 * 1000; // 15åˆ†é’Ÿ const monitorFailedLogin = (email, ip) =\u0026gt; { const key = `${email}_${ip}`; const attempts = failedLoginAttempts.get(key) || { count: 0, lastAttempt: 0 }; attempts.count++; attempts.lastAttempt = Date.now(); failedLoginAttempts.set(key, attempts); // è®°å½•å®‰å…¨äº‹ä»¶ logSecurityEvent(\u0026#39;LOGIN_FAILED\u0026#39;, { email, ip, attempts: attempts.count }); // æ£€æŸ¥æ˜¯å¦éœ€è¦é”å®šè´¦æˆ· if (attempts.count \u0026gt;= MAX_FAILED_ATTEMPTS) { logSecurityEvent(\u0026#39;ACCOUNT_LOCKED\u0026#39;, { email, ip, attempts: attempts.count, lockoutDuration: LOCKOUT_TIME / 60000 }); return true; // éœ€è¦é”å®š } return false; // ä¸éœ€è¦é”å®š }; // æ¸…ç†è¿‡æœŸçš„å¤±è´¥è®°å½• setInterval(() =\u0026gt; { const now = Date.now(); for (const [key, attempts] of failedLoginAttempts.entries()) { if (now - attempts.lastAttempt \u0026gt; LOCKOUT_TIME) { failedLoginAttempts.delete(key); } } }, 60000); // æ¯åˆ†é’Ÿæ¸…ç†ä¸€æ¬¡ å…¥ä¾µæ£€æµ‹ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 // å¼‚å¸¸è¯·æ±‚æ£€æµ‹ const detectSuspiciousActivity = (req, res, next) =\u0026gt; { const suspiciousPatterns = [ /\\.\\./, // è·¯å¾„éå† /\u0026lt;script/i, // XSSå°è¯• /union.*select/i, // SQLæ³¨å…¥å°è¯• /javascript:/i, // JavaScriptåè®® /data:/i // Dataåè®® ]; const url = req.url; const userAgent = req.get(\u0026#39;User-Agent\u0026#39;) || \u0026#39;\u0026#39;; // æ£€æŸ¥å¯ç–‘URLæ¨¡å¼ for (const pattern of suspiciousPatterns) { if (pattern.test(url)) { logSecurityEvent(\u0026#39;SUSPICIOUS_REQUEST\u0026#39;, { url, userAgent, ip: req.ip, pattern: pattern.toString() }); return res.status(400).json({ success: false, message: \u0026#39;è¯·æ±‚åŒ…å«æ¶æ„å†…å®¹\u0026#39; }); } } // æ£€æŸ¥å¼‚å¸¸User-Agent if (!userAgent || userAgent.length \u0026lt; 10) { logSecurityEvent(\u0026#39;SUSPICIOUS_USER_AGENT\u0026#39;, { userAgent, ip: req.ip }); } next(); }; // æ–‡ä»¶ä¸Šä¼ å®‰å…¨æ£€æŸ¥ const multer = require(\u0026#39;multer\u0026#39;); const path = require(\u0026#39;path\u0026#39;); const fileFilter = (req, file, cb) =\u0026gt; { const allowedExtensions = [\u0026#39;.jpg\u0026#39;, \u0026#39;.jpeg\u0026#39;, \u0026#39;.png\u0026#39;, \u0026#39;.gif\u0026#39;, \u0026#39;.pdf\u0026#39;, \u0026#39;.doc\u0026#39;, \u0026#39;.docx\u0026#39;]; const fileExtension = path.extname(file.originalname).toLowerCase(); if (!allowedExtensions.includes(fileExtension)) { logSecurityEvent(\u0026#39;SUSPICIOUS_FILE_UPLOAD\u0026#39;, { filename: file.originalname, mimetype: file.mimetype, ip: req.ip }); return cb(new Error(\u0026#39;ä¸æ”¯æŒçš„æ–‡ä»¶ç±»å‹\u0026#39;), false); } cb(null, true); }; const upload = multer({ dest: \u0026#39;uploads/\u0026#39;, fileFilter, limits: { fileSize: 5 * 1024 * 1024 // 5MBé™åˆ¶ } }); 7. ç¯å¢ƒå’Œéƒ¨ç½²å®‰å…¨ ç¯å¢ƒå˜é‡å®‰å…¨ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 // .envæ–‡ä»¶ç¤ºä¾‹ï¼ˆä¸æäº¤åˆ°ç‰ˆæœ¬æ§åˆ¶ï¼‰ NODE_ENV=production PORT=3000 JWT_SECRET=your-super-secret-jwt-key-here ENCRYPTION_KEY=your-encryption-key-here DATABASE_URL=postgresql://username:password@localhost:5432/dbname REDIS_URL=redis://localhost:6379 // ç¯å¢ƒå˜é‡éªŒè¯ const requiredEnvVars = [ \u0026#39;JWT_SECRET\u0026#39;, \u0026#39;ENCRYPTION_KEY\u0026#39;, \u0026#39;DATABASE_URL\u0026#39; ]; const validateEnvironment = () =\u0026gt; { const missingVars = requiredEnvVars.filter( varName =\u0026gt; !process.env[varName] ); if (missingVars.length \u0026gt; 0) { throw new Error(`ç¼ºå°‘å¿…éœ€çš„ç¯å¢ƒå˜é‡: ${missingVars.join(\u0026#39;, \u0026#39;)}`); } // æ£€æŸ¥å¯†é’¥é•¿åº¦ if (process.env.JWT_SECRET.length \u0026lt; 32) { throw new Error(\u0026#39;JWT_SECRETé•¿åº¦è‡³å°‘32ä¸ªå­—ç¬¦\u0026#39;); } if (process.env.ENCRYPTION_KEY.length \u0026lt; 16) { throw new Error(\u0026#39;ENCRYPTION_KEYé•¿åº¦è‡³å°‘16ä¸ªå­—ç¬¦\u0026#39;); } }; // åº”ç”¨å¯åŠ¨æ—¶éªŒè¯ validateEnvironment(); Dockerå®‰å…¨é…ç½® 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 # ä½¿ç”¨érootç”¨æˆ·è¿è¡Œ FROM node:18-alpine # åˆ›å»ºåº”ç”¨ç”¨æˆ· RUN addgroup -g 1001 -S nodejs \u0026amp;\u0026amp; \\ adduser -S nodejs -u 1001 WORKDIR /app # å¤åˆ¶packageæ–‡ä»¶å¹¶å®‰è£…ä¾èµ– COPY package*.json ./ RUN npm ci --only=production \u0026amp;\u0026amp; npm cache clean --force # å¤åˆ¶åº”ç”¨ä»£ç  COPY --chown=nodejs:nodejs . . # è®¾ç½®æ–‡ä»¶æƒé™ RUN chmod -R 755 /app # åˆ‡æ¢åˆ°érootç”¨æˆ· USER nodejs # æš´éœ²ç«¯å£ EXPOSE 3000 # å¥åº·æ£€æŸ¥ HEALTHCHECK --interval=30s --timeout=3s --start-period=5s --retries=3 \\ CMD node healthcheck.js # å¯åŠ¨åº”ç”¨ CMD [\u0026#34;node\u0026#34;, \u0026#34;server.js\u0026#34;] HTTPSé…ç½® 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 const https = require(\u0026#39;https\u0026#39;); const fs = require(\u0026#39;fs\u0026#39;); // HTTPSæœåŠ¡å™¨é…ç½® const httpsOptions = { key: fs.readFileSync(\u0026#39;/path/to/private.key\u0026#39;), cert: fs.readFileSync(\u0026#39;/path/to/certificate.crt\u0026#39;), ca: fs.readFileSync(\u0026#39;/path/to/ca_bundle.crt\u0026#39;), minVersion: \u0026#39;TLSv1.2\u0026#39;, ciphers: [ \u0026#39;ECDHE-ECDSA-AES256-GCM-SHA384\u0026#39;, \u0026#39;ECDHE-RSA-AES256-GCM-SHA384\u0026#39;, \u0026#39;ECDHE-ECDSA-CHACHA20-POLY1305\u0026#39;, \u0026#39;ECDHE-RSA-CHACHA20-POLY1305\u0026#39;, \u0026#39;ECDHE-ECDSA-AES128-GCM-SHA256\u0026#39;, \u0026#39;ECDHE-RSA-AES128-GCM-SHA256\u0026#39; ].join(\u0026#39;:\u0026#39;), honorCipherOrder: true }; // åˆ›å»ºHTTPSæœåŠ¡å™¨ const server = https.createServer(httpsOptions, app); // HSTSå¼ºåˆ¶HTTPS app.use((req, res, next) =\u0026gt; { if (req.protocol === \u0026#39;http\u0026#39;) { return res.redirect(301, `https://${req.headers.host}${req.url}`); } next(); }); // å¯åŠ¨æœåŠ¡å™¨ server.listen(443, () =\u0026gt; { console.log(\u0026#39;HTTPSæœåŠ¡å™¨è¿è¡Œåœ¨ç«¯å£443\u0026#39;); }); 8. å®‰å…¨æ£€æŸ¥æ¸…å• å¼€å‘é˜¶æ®µ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 // å®‰å…¨æ£€æŸ¥è„šæœ¬ const securityChecklist = { inputValidation: { isUserInputSanitized: true, isParameterizedQueryUsed: true, isXSSProtectionEnabled: true, isCSRFTokenImplemented: true }, authentication: { isPasswordHashed: true, isSessionSecure: true, isJWTSecure: true, isRateLimitingEnabled: true }, dataProtection: { isSensitiveDataEncrypted: true, isHTTPSUsed: true, isDatabaseSecure: true, isBackupEncrypted: true }, infrastructure: { isEnvironmentSecure: true, AreDependenciesUpdated: true, isLoggingEnabled: true, isMonitoringSetup: true } }; // è‡ªåŠ¨åŒ–å®‰å…¨æµ‹è¯• const runSecurityTests = async () =\u0026gt; { const tests = [ testSQLInjectionProtection, testXSSProtection, testCSRFProtection, testAuthentication, testAuthorization, testRateLimiting, testInputValidation, testDataEncryption ]; for (const test of tests) { try { await test(); console.log(`âœ… ${test.name} é€šè¿‡`); } catch (error) { console.error(`âŒ ${test.name} å¤±è´¥:`, error.message); } } }; ç”Ÿäº§éƒ¨ç½²æ£€æŸ¥ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 // ç”Ÿäº§ç¯å¢ƒå®‰å…¨æ£€æŸ¥ const productionSecurityCheck = () =\u0026gt; { const checks = [ { name: \u0026#39;ç¯å¢ƒå˜é‡å®‰å…¨\u0026#39;, check: () =\u0026gt; process.env.NODE_ENV === \u0026#39;production\u0026#39; }, { name: \u0026#39;HTTPSå¯ç”¨\u0026#39;, check: () =\u0026gt; process.env.HTTPS === \u0026#39;true\u0026#39; }, { name: \u0026#39;å¯†é’¥å¼ºåº¦\u0026#39;, check: () =\u0026gt; process.env.JWT_SECRET \u0026amp;\u0026amp; process.env.JWT_SECRET.length \u0026gt;= 32 }, { name: \u0026#39;æ•°æ®åº“è¿æ¥å®‰å…¨\u0026#39;, check: () =\u0026gt; !process.env.DATABASE_URL.includes(\u0026#39;password\u0026#39;) }, { name: \u0026#39;æ—¥å¿—çº§åˆ«\u0026#39;, check: () =\u0026gt; process.env.LOG_LEVEL === \u0026#39;warn\u0026#39; || process.env.LOG_LEVEL === \u0026#39;error\u0026#39; } ]; const results = checks.map(({ name, check }) =\u0026gt; ({ name, passed: check() })); const failedChecks = results.filter(r =\u0026gt; !r.passed); if (failedChecks.length \u0026gt; 0) { console.error(\u0026#39;å®‰å…¨æ£€æŸ¥å¤±è´¥:\u0026#39;, failedChecks); process.exit(1); } console.log(\u0026#39;æ‰€æœ‰å®‰å…¨æ£€æŸ¥é€šè¿‡\u0026#39;); }; // åº”ç”¨å¯åŠ¨å‰æ‰§è¡Œ productionSecurityCheck(); æ€»ç»“ Node.jsåº”ç”¨å®‰å…¨éœ€è¦ä»å¤šä¸ªå±‚é¢è€ƒè™‘ï¼š\nè¾“å…¥å®‰å…¨ï¼š\nä¸¥æ ¼çš„è¾“å…¥éªŒè¯ SQLæ³¨å…¥é˜²æŠ¤ XSSæ”»å‡»é˜²æŠ¤ æ–‡ä»¶ä¸Šä¼ å®‰å…¨ è®¤è¯æˆæƒï¼š\nå¼ºå¯†ç ç­–ç•¥ JWTä»¤ç‰Œå®‰å…¨ RBACæƒé™æ§åˆ¶ ä¼šè¯ç®¡ç† æ•°æ®ä¿æŠ¤ï¼š\nå¯†ç åŠ å¯†å­˜å‚¨ æ•æ„Ÿæ•°æ®åŠ å¯† HTTPSä¼ è¾“ æ•°æ®åº“å®‰å…¨ è¿è¡Œå®‰å…¨ï¼š\nç¯å¢ƒå˜é‡ä¿æŠ¤ ä¾èµ–å®‰å…¨ç®¡ç† æ—¥å¿—ç›‘æ§ é™æµé˜²æŠ¤ å®‰å…¨æ˜¯ä¸€ä¸ªæŒç»­çš„è¿‡ç¨‹ï¼Œéœ€è¦å®šæœŸæ›´æ–°å®‰å…¨ç­–ç•¥ã€ç›‘æ§å®‰å…¨äº‹ä»¶ã€åŠæ—¶ä¿®å¤æ¼æ´ã€‚è®°ä½ï¼Œå®‰å…¨æ²¡æœ‰ç»ˆç‚¹ï¼Œåªæœ‰æŒç»­æ”¹è¿›ã€‚\n","permalink":"/blog/articles/node-security-best-practices/","summary":"å…¨é¢ä»‹ç»Node.jsåº”ç”¨çš„å®‰å…¨é˜²æŠ¤ç­–ç•¥ï¼ŒåŒ…æ‹¬è¾“å…¥éªŒè¯ã€è®¤è¯æˆæƒã€æ•°æ®åŠ å¯†ã€å®‰å…¨é…ç½®ç­‰å…³é”®æŠ€æœ¯ï¼Œå¸®åŠ©å¼€å‘è€…æ„å»ºå®‰å…¨çš„æœåŠ¡ç«¯åº”ç”¨ã€‚","title":"Node.jså®‰å…¨æœ€ä½³å®è·µï¼šæ„å»ºå®‰å…¨å¯é çš„æœåŠ¡ç«¯åº”ç”¨"},{"content":"Reactæ€§èƒ½ä¼˜åŒ–æ˜¯æ„å»ºé«˜è´¨é‡Webåº”ç”¨çš„å…³é”®ã€‚éšç€åº”ç”¨è§„æ¨¡çš„å¢é•¿ï¼Œæ€§èƒ½é—®é¢˜ä¼šé€æ¸æ˜¾ç°ã€‚æœ¬æ–‡å°†å…¨é¢ä»‹ç»Reactæ€§èƒ½ä¼˜åŒ–çš„å„ç§æŠ€å·§å’Œæœ€ä½³å®è·µã€‚\n1. ç»„ä»¶ä¼˜åŒ–åŸºç¡€ React.memoä¼˜åŒ–å‡½æ•°ç»„ä»¶ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 // æ™®é€šç»„ä»¶ - æ¯æ¬¡çˆ¶ç»„ä»¶æ›´æ–°éƒ½ä¼šé‡æ–°æ¸²æŸ“ const UserProfile = ({ name, age, avatar }) =\u0026gt; { console.log(\u0026#39;UserProfile re-rendered\u0026#39;); return ( \u0026lt;div className=\u0026#34;user-profile\u0026#34;\u0026gt; \u0026lt;img src={avatar} alt={name} /\u0026gt; \u0026lt;div\u0026gt; \u0026lt;h2\u0026gt;{name}\u0026lt;/h2\u0026gt; \u0026lt;p\u0026gt;Age: {age}\u0026lt;/p\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; ); }; // ä¼˜åŒ–å - åªæœ‰propså˜åŒ–æ—¶æ‰é‡æ–°æ¸²æŸ“ const OptimizedUserProfile = React.memo(({ name, age, avatar }) =\u0026gt; { console.log(\u0026#39;OptimizedUserProfile re-rendered\u0026#39;); return ( \u0026lt;div className=\u0026#34;user-profile\u0026#34;\u0026gt; \u0026lt;img src={avatar} alt={name} /\u0026gt; \u0026lt;div\u0026gt; \u0026lt;h2\u0026gt;{name}\u0026lt;/h2\u0026gt; \u0026lt;p\u0026gt;Age: {age}\u0026lt;/p\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; ); }); // è‡ªå®šä¹‰æ¯”è¾ƒå‡½æ•° const CustomUserProfile = React.memo(({ user }) =\u0026gt; { return ( \u0026lt;div className=\u0026#34;user-profile\u0026#34;\u0026gt; \u0026lt;h2\u0026gt;{user.name}\u0026lt;/h2\u0026gt; \u0026lt;p\u0026gt;{user.email}\u0026lt;/p\u0026gt; \u0026lt;/div\u0026gt; ); }, (prevProps, nextProps) =\u0026gt; { // åªæœ‰IDæˆ–åŸºæœ¬ä¿¡æ¯å˜åŒ–æ—¶æ‰é‡æ–°æ¸²æŸ“ return prevProps.user.id === nextProps.user.id \u0026amp;\u0026amp; prevProps.user.name === nextProps.user.name \u0026amp;\u0026amp; prevProps.user.email === nextProps.user.email; }); useMemoç¼“å­˜è®¡ç®—ç»“æœ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 const ExpensiveComponent = ({ items, filter }) =\u0026gt; { // âŒ æ¯æ¬¡æ¸²æŸ“éƒ½ä¼šé‡æ–°è®¡ç®— const filteredItems = items.filter(item =\u0026gt; item.name.toLowerCase().includes(filter.toLowerCase()) ); // âœ… ä½¿ç”¨useMemoç¼“å­˜è®¡ç®—ç»“æœ const expensiveValue = useMemo(() =\u0026gt; { console.log(\u0026#39;Expensive calculation running...\u0026#39;); return items .filter(item =\u0026gt; item.price \u0026gt; 100) .reduce((sum, item) =\u0026gt; sum + item.price, 0); }, [items]); // æ›´å¤æ‚çš„è®¡ç®—ç¤ºä¾‹ const chartData = useMemo(() =\u0026gt; { const data = items.map(item =\u0026gt; ({ name: item.name, value: calculateComplexMetrics(item), category: categorizeItem(item) })); return processDataForChart(data); }, [items]); return ( \u0026lt;div\u0026gt; \u0026lt;h3\u0026gt;Total Value: ${expensiveValue}\u0026lt;/h3\u0026gt; \u0026lt;Chart data={chartData} /\u0026gt; \u0026lt;/div\u0026gt; ); }; useCallbackç¼“å­˜å‡½æ•° 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 const ParentComponent = ({ items }) =\u0026gt; { const [selectedItem, setSelectedItem] = useState(null); // âŒ æ¯æ¬¡æ¸²æŸ“éƒ½åˆ›å»ºæ–°å‡½æ•° const handleSelect = (item) =\u0026gt; { setSelectedItem(item); }; // âœ… ä½¿ç”¨useMemoç¼“å­˜è®¡ç®— const expensiveValue = useMemo(() =\u0026gt; { return items.reduce((sum, item) =\u0026gt; sum + item.value, 0); }, [items]); // âœ… ä½¿ç”¨useCallbackç¼“å­˜å‡½æ•° const handleSelect = useCallback((item) =\u0026gt; { setSelectedItem(item); // ä¾èµ–é¡¹ä¸ºç©ºæ•°ç»„ï¼Œå‡½æ•°å†…éƒ¨ä¸ä¾èµ–å¤–éƒ¨å˜é‡ }, []); // âœ… å‡½æ•°ä¾èµ–å¤–éƒ¨å˜é‡ const handleAction = useCallback((itemId) =\u0026gt; { const item = items.find(i =\u0026gt; i.id === itemId); if (item) { setSelectedItem(item); } }, [items]); return ( \u0026lt;div\u0026gt; \u0026lt;p\u0026gt;Total: {expensiveValue}\u0026lt;/p\u0026gt; \u0026lt;ItemList items={items} onSelect={handleSelect} onAction={handleAction} selectedItem={selectedItem} /\u0026gt; \u0026lt;/div\u0026gt; ); }; 2. çŠ¶æ€ç®¡ç†ä¼˜åŒ– é¿å…ä¸å¿…è¦çš„çŠ¶æ€æå‡ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 // âŒ é”™è¯¯çš„çŠ¶æ€ç®¡ç† const BadExample = () =\u0026gt; { const [formData, setFormData] = useState({ name: \u0026#39;\u0026#39;, email: \u0026#39;\u0026#39;, password: \u0026#39;\u0026#39;, confirmPassword: \u0026#39;\u0026#39; }); const handleInputChange = (field) =\u0026gt; (e) =\u0026gt; { setFormData(prev =\u0026gt; ({ ...prev, [field]: e.target.value })); }; return ( \u0026lt;form\u0026gt; \u0026lt;input value={formData.name} onChange={handleInputChange(\u0026#39;name\u0026#39;)} placeholder=\u0026#34;Name\u0026#34; /\u0026gt; \u0026lt;input value={formData.email} onChange={handleInputChange(\u0026#39;email\u0026#39;)} placeholder=\u0026#34;Email\u0026#34; /\u0026gt; \u0026lt;input value={formData.password} onChange={handleInputChange(\u0026#39;password\u0026#39;)} type=\u0026#34;password\u0026#34; placeholder=\u0026#34;Password\u0026#34; /\u0026gt; \u0026lt;/form\u0026gt; ); }; // âœ… ä¼˜åŒ–åçš„çŠ¶æ€ç®¡ç† const GoodExample = () =\u0026gt; { // å°†ç›¸å…³çš„çŠ¶æ€åˆ†ç»„ const [user, setUser] = useState({ name: \u0026#39;\u0026#39;, email: \u0026#39;\u0026#39; }); const [password, setPassword] = useState(\u0026#39;\u0026#39;); const [confirmPassword, setConfirmPassword] = useState(\u0026#39;\u0026#39;); // ä½¿ç”¨reducerç®¡ç†å¤æ‚çŠ¶æ€ const [formData, dispatch] = useReducer(formReducer, initialFormState); // ä½¿ç”¨useReducerç®¡ç†è¡¨å•çŠ¶æ€ const formReducer = (state, action) =\u0026gt; { switch (action.type) { case \u0026#39;SET_FIELD\u0026#39;: return { ...state, [action.field]: action.value }; case \u0026#39;RESET_FORM\u0026#39;: return initialFormState; default: return state; } }; const handleInputChange = (field) =\u0026gt; (e) =\u0026gt; { dispatch({ type: \u0026#39;SET_FIELD\u0026#39;, field, value: e.target.value }); }; return ( \u0026lt;form\u0026gt; \u0026lt;input value={formData.name} onChange={handleInputChange(\u0026#39;name\u0026#39;)} placeholder=\u0026#34;Name\u0026#34; /\u0026gt; \u0026lt;input value={formData.email} onChange={handleInputChange(\u0026#39;email\u0026#39;)} placeholder=\u0026#34;Email\u0026#34; /\u0026gt; \u0026lt;/form\u0026gt; ); }; çŠ¶æ€åˆ†ç¦»å’Œç»„åˆ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 // âœ… çŠ¶æ€åˆ†ç¦» const UserDashboard = ({ userId }) =\u0026gt; { // ç”¨æˆ·ä¿¡æ¯çŠ¶æ€ const [user, setUser] = useState(null); const [userLoading, setUserLoading] = useState(false); // æ–‡ç« åˆ—è¡¨çŠ¶æ€ const [articles, setArticles] = useState([]); const [articleLoading, setArticleLoading] = useState(false); // è®¾ç½®çŠ¶æ€çŠ¶æ€ const [settings, setSettings] = useState({}); const [settingsLoading, setSettingsLoading] = useState(false); // è‡ªå®šä¹‰Hookç®¡ç†ç›¸å…³çŠ¶æ€ const { user, loading: userLoading } = useUser(userId); const { articles, loading: articleLoading } = useUserArticles(userId); const { settings, loading: settingsLoading } = useSettings(); return ( \u0026lt;div\u0026gt; {userLoading ? \u0026lt;UserSkeleton /\u0026gt; : \u0026lt;UserProfile user={user} /\u0026gt;} {articleLoading ? \u0026lt;ArticleSkeleton /\u0026gt; : \u0026lt;ArticleList articles={articles} /\u0026gt;} {settingsLoading ? \u0026lt;SettingsSkeleton /\u0026gt; : \u0026lt;SettingsPanel settings={settings} /\u0026gt;} \u0026lt;/div\u0026gt; ); }; // è‡ªå®šä¹‰Hookç¤ºä¾‹ const useUserArticles = (userId) =\u0026gt; { const [articles, setArticles] = useState([]); const [loading, setLoading] = useState(false); const [error, setError] = useState(null); useEffect(() =\u0026gt; { if (!userId) return; setLoading(true); fetchUserArticles(userId) .then(setArticles) .catch(setError) .finally(() =\u0026gt; setLoading(false)); }, [userId]); return { articles, loading, error }; }; Contextä¼˜åŒ– 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 // âŒ æœªä¼˜åŒ–çš„Context - ä¼šå¯¼è‡´æ‰€æœ‰æ¶ˆè´¹è€…é‡æ–°æ¸²æŸ“ const BadContext = React.createContext(); const BadProvider = ({ children }) =\u0026gt; { const [user, setUser] = useState(null); const [theme, setTheme] = useState(\u0026#39;light\u0026#39;); const [notifications, setNotifications] = useState([]); // ä»»ä½•çŠ¶æ€å˜åŒ–éƒ½ä¼šå¯¼è‡´æ‰€æœ‰æ¶ˆè´¹è€…é‡æ–°æ¸²æŸ“ const value = { user, setUser, theme, setTheme, notifications, setNotifications }; return ( \u0026lt;BadContext.Provider value={value}\u0026gt; {children} \u0026lt;/BadContext.Provider\u0026gt; ); }; // âœ… ä¼˜åŒ–åçš„Context - åˆ†ç¦»ä¸åŒå…³æ³¨ç‚¹ const UserContext = React.createContext(); const ThemeContext = React.createContext(); const NotificationContext = React.createContext(); const UserProvider = ({ children }) =\u0026gt; { const [user, setUser] = useState(null); // ä½¿ç”¨memoé˜²æ­¢ä¸å¿…è¦çš„é‡æ–°æ¸²æŸ“ const value = useMemo(() =\u0026gt; ({ user, setUser }), [user]); return ( \u0026lt;UserContext.Provider value={value}\u0026gt; {children} \u0026lt;/UserContext.Provider\u0026gt; ); }; // ä½¿ç”¨Contexté€‰æ‹©å™¨æ¨¡å¼ const useUser = () =\u0026gt; { const context = useContext(UserContext); if (!context) { throw new Error(\u0026#39;useUser must be used within UserProvider\u0026#39;); } return context; }; const useUserName = () =\u0026gt; { const { user } = useUser(); return user?.name; }; 3. æ¸²æŸ“ä¼˜åŒ– è™šæ‹Ÿåˆ—è¡¨å®ç° 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 import { FixedSizeList as List } from \u0026#39;react-window\u0026#39;; // è™šæ‹ŸåŒ–é•¿åˆ—è¡¨ const VirtualizedList = ({ items }) =\u0026gt; { const Row = ({ index, style }) =\u0026gt; ( \u0026lt;div style={style}\u0026gt; \u0026lt;ListItem item={items[index]} /\u0026gt; \u0026lt;/div\u0026gt; ); return ( \u0026lt;List height={600} itemCount={items.length} itemSize={80} width=\u0026#34;100%\u0026#34; \u0026gt; {Row} \u0026lt;/List\u0026gt; ); }; // è‡ªå®šä¹‰è™šæ‹ŸåŒ–ç»„ä»¶ const CustomVirtualList = ({ items, itemHeight = 50, containerHeight = 400 }) =\u0026gt; { const [scrollTop, setScrollTop] = useState(0); const containerRef = useRef(null); const visibleStart = Math.floor(scrollTop / itemHeight); const visibleEnd = Math.min( visibleStart + Math.ceil(containerHeight / itemHeight) + 1, items.length ); const visibleItems = items.slice(visibleStart, visibleEnd); const handleScroll = useCallback((e) =\u0026gt; { setScrollTop(e.target.scrollTop); }, []); return ( \u0026lt;div ref={containerRef} style={{ height: containerHeight, overflow: \u0026#39;auto\u0026#39; }} onScroll={handleScroll} \u0026gt; \u0026lt;div style={{ height: items.length * itemHeight, position: \u0026#39;relative\u0026#39; }}\u0026gt; {visibleItems.map((item, index) =\u0026gt; ( \u0026lt;div key={visibleStart + index} style={{ position: \u0026#39;absolute\u0026#39;, top: (visibleStart + index) * itemHeight, height: itemHeight, width: \u0026#39;100%\u0026#39; }} \u0026gt; \u0026lt;ListItem item={item} /\u0026gt; \u0026lt;/div\u0026gt; ))} \u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; ); }; æ‡’åŠ è½½å’Œä»£ç åˆ†å‰² 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 import { lazy, Suspense } from \u0026#39;react\u0026#39;; // è·¯ç”±çº§åˆ«çš„ä»£ç åˆ†å‰² const HomePage = lazy(() =\u0026gt; import(\u0026#39;./pages/HomePage\u0026#39;)); const AboutPage = lazy(() =\u0026gt; import(\u0026#39;./pages/AboutPage\u0026#39;)); const ContactPage = lazy(() =\u0026gt; import(\u0026#39;./pages/ContactPage\u0026#39;)); const App = () =\u0026gt; ( \u0026lt;Router\u0026gt; \u0026lt;Suspense fallback={\u0026lt;div\u0026gt;Loading...\u0026lt;/div\u0026gt;}\u0026gt; \u0026lt;Routes\u0026gt; \u0026lt;Route path=\u0026#34;/\u0026#34; element={\u0026lt;HomePage /\u0026gt;} /\u0026gt; \u0026lt;Route path=\u0026#34;/about\u0026#34; element={\u0026lt;AboutPage /\u0026gt;} /\u0026gt; \u0026lt;Route path=\u0026#34;/contact\u0026#34; element={\u0026lt;ContactPage /\u0026gt;} /\u0026gt; \u0026lt;/Routes\u0026gt; \u0026lt;/Suspense\u0026gt; \u0026lt;/Router\u0026gt; ); // ç»„ä»¶çº§åˆ«çš„æ‡’åŠ è½½ const LazyChart = lazy(() =\u0026gt; import(\u0026#39;./components/Chart\u0026#39;).then(module =\u0026gt; ({ default: module.Chart })) ); const Dashboard = ({ data }) =\u0026gt; ( \u0026lt;div\u0026gt; \u0026lt;h2\u0026gt;Dashboard\u0026lt;/h2\u0026gt; \u0026lt;Suspense fallback={\u0026lt;div\u0026gt;Loading chart...\u0026lt;/div\u0026gt;}\u0026gt; \u0026lt;LazyChart data={data} /\u0026gt; \u0026lt;/Suspense\u0026gt; \u0026lt;/div\u0026gt; ); // åŠ¨æ€å¯¼å…¥å·¥å…·å‡½æ•° const loadComponent = (importFunc, fallback = null) =\u0026gt; { const LazyComponent = lazy(importFunc); return (props) =\u0026gt; ( \u0026lt;Suspense fallback={fallback || \u0026lt;div\u0026gt;Loading...\u0026lt;/div\u0026gt;}\u0026gt; \u0026lt;LazyComponent {...props} /\u0026gt; ); }; // ä½¿ç”¨ç¤ºä¾‹ const AsyncAdminPanel = loadComponent( () =\u0026gt; import(\u0026#39;./AdminPanel\u0026#39;), \u0026lt;div\u0026gt;Loading admin panel...\u0026lt;/div\u0026gt; ); å›¾ç‰‡ä¼˜åŒ–å’Œæ‡’åŠ è½½ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 import { useState, useRef, useEffect } from \u0026#39;react\u0026#39;; const LazyImage = ({ src, alt, placeholder, className }) =\u0026gt; { const [isLoaded, setIsLoaded] = useState(false); const [isInView, setIsInView] = useState(false); const imgRef = useRef(); useEffect(() =\u0026gt; { const observer = new IntersectionObserver( ([entry]) =\u0026gt; { if (entry.isIntersecting) { setIsInView(true); observer.disconnect(); } }, { threshold: 0.1 } ); if (imgRef.current) { observer.observe(imgRef.current); } return () =\u0026gt; observer.disconnect(); }, []); const handleLoad = () =\u0026gt; { setIsLoaded(true); }; return ( \u0026lt;div ref={imgRef} className={className}\u0026gt; {isInView \u0026amp;\u0026amp; ( \u0026lt;img src={src} alt={alt} onLoad={handleLoad} style={{ opacity: isLoaded ? 1 : 0, transition: \u0026#39;opacity 0.3s ease\u0026#39; }} /\u0026gt; )} {!isLoaded \u0026amp;\u0026amp; ( \u0026lt;div className=\u0026#34;image-placeholder\u0026#34; style={{ backgroundColor: \u0026#39;#f0f0f0\u0026#39;, backgroundImage: placeholder ? `url(${placeholder})` : \u0026#39;none\u0026#39;, backgroundSize: \u0026#39;cover\u0026#39;, backgroundPosition: \u0026#39;center\u0026#39; }} /\u0026gt; )} \u0026lt;/div\u0026gt; ); }; // å“åº”å¼å›¾ç‰‡ç»„ä»¶ const ResponsiveImage = ({ sources, alt, className }) =\u0026gt; { const [loadedSources, setLoadedSources] = useState(new Set()); const handleSourceLoad = (src) =\u0026gt; { setLoadedSources(prev =\u0026gt; new Set(prev).add(src)); }; return ( \u0026lt;picture className={className}\u0026gt; {sources.map(({ srcSet, media, type }) =\u0026gt; ( \u0026lt;source key={srcSet} srcSet={srcSet} media={media} type={type} onLoad={() =\u0026gt; handleSourceLoad(srcSet)} /\u0026gt; ))} \u0026lt;img src={sources[sources.length - 1].fallback} alt={alt} loading=\u0026#34;lazy\u0026#34; /\u0026gt; \u0026lt;/picture\u0026gt; ); }; 4. Bundleä¼˜åŒ– åŠ¨æ€å¯¼å…¥å’ŒTree Shaking 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 // utils.js export const heavyFunction = () =\u0026gt; { // å¤æ‚çš„è®¡ç®—é€»è¾‘ console.log(\u0026#39;This is a heavy function\u0026#39;); }; export const lightFunction = () =\u0026gt; { // ç®€å•çš„é€»è¾‘ console.log(\u0026#39;This is a light function\u0026#39;); }; export default { heavyFunction, lightFunction }; // ä½¿ç”¨åŠ¨æ€å¯¼å…¥ const loadHeavyModule = async () =\u0026gt; { const { heavyFunction } = await import(\u0026#39;./utils\u0026#39;); heavyFunction(); }; // æ¡ä»¶å¯¼å…¥ const useFeature = (featureEnabled) =\u0026gt; { const [module, setModule] = useState(null); useEffect(() =\u0026gt; { if (featureEnabled) { import(\u0026#39;./heavyFeature\u0026#39;).then(setModule); } }, [featureEnabled]); return module; }; // Webpacké­”æ³•æ³¨é‡Š const loadModuleByLanguage = (language) =\u0026gt; { switch (language) { case \u0026#39;en\u0026#39;: return import(/* webpackChunkName: \u0026#34;lang-en\u0026#34; */ \u0026#39;./locales/en.json\u0026#39;); case \u0026#39;zh\u0026#39;: return import(/* webpackChunkName: \u0026#34;lang-zh\u0026#34; */ \u0026#39;./locales/zh.json\u0026#39;); default: return import(/* webpackChunkName: \u0026#34;lang-en\u0026#34; */ \u0026#39;./locales/en.json\u0026#39;); } }; Bundleåˆ†æå’Œä¼˜åŒ– 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 // webpack.config.js module.exports = { optimization: { splitChunks: { chunks: \u0026#39;all\u0026#39;, cacheGroups: { vendor: { test: /[\\\\/]node_modules[\\\\/]/, name: \u0026#39;vendors\u0026#39;, chunks: \u0026#39;all\u0026#39;, }, common: { name: \u0026#39;common\u0026#39;, minChunks: 2, chunks: \u0026#39;all\u0026#39;, enforce: true }, components: { test: /[\\\\/]src[\\\\/]components[\\\\/]/, name: \u0026#39;components\u0026#39;, chunks: \u0026#39;all\u0026#39;, minSize: 0 } } } } }; // ä½¿ç”¨webpack-bundle-analyzeråˆ†æBundle const BundleAnalyzerPlugin = require(\u0026#39;webpack-bundle-analyzer\u0026#39;).BundleAnalyzerPlugin; module.exports = { plugins: [ new BundleAnalyzerPlugin({ analyzerMode: \u0026#39;static\u0026#39;, openAnalyzer: false }) ] }; 5. æ€§èƒ½ç›‘æ§ æ€§èƒ½æµ‹é‡å·¥å…· 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 import { useProfiler, unstable_trace as trace } from \u0026#39;react\u0026#39;; // React Profiler API const ProfiledComponent = ({ id, onRender, ...props }) =\u0026gt; { return ( \u0026lt;Profiler id={id} onRender={onRender}\u0026gt; \u0026lt;ExpensiveComponent {...props} /\u0026gt; \u0026lt;/Profiler\u0026gt; ); }; const App = () =\u0026gt; { const handleRender = (id, phase, actualDuration) =\u0026gt; { console.log(`${id} ${phase} took ${actualDuration}ms`); }; return ( \u0026lt;div\u0026gt; \u0026lt;ProfiledComponent id=\u0026#34;UserProfile\u0026#34; onRender={handleRender}\u0026gt; \u0026lt;UserProfile user={user} /\u0026gt; \u0026lt;/ProfiledComponent\u0026gt; \u0026lt;/div\u0026gt; ); }; // è‡ªå®šä¹‰æ€§èƒ½Hook const usePerformanceMeasure = (name) =\u0026gt; { useEffect(() =\u0026gt; { const startTime = performance.now(); return () =\u0026gt; { const endTime = performance.now(); console.log(`${name} took ${endTime - startTime}ms`); }; }, [name]); }; // ä½¿ç”¨ç¤ºä¾‹ const ExpensiveComponent = ({ data }) =\u0026gt; { usePerformanceMeasure(\u0026#39;ExpensiveComponent\u0026#39;); const processedData = useMemo(() =\u0026gt; { return expensiveDataProcessing(data); }, [data]); return \u0026lt;div\u0026gt;{/* ç»„ä»¶å†…å®¹ */}\u0026lt;/div\u0026gt;; }; Web Vitalsç›‘æ§ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 // ä½¿ç”¨web-vitalsåº“ import { getCLS, getFID, getFCP, getLCP, getTTFB } from \u0026#39;web-vitals\u0026#39;; const reportWebVitals = (onPerfEntry) =\u0026gt; { if (onPerfEntry \u0026amp;\u0026amp; onPerfEntry instanceof Function) { import(\u0026#39;web-vitals\u0026#39;).then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) =\u0026gt; { getCLS(onPerfEntry); getFID(onPerfEntry); getFCP(onPerfEntry); getLCP(onPerfEntry); getTTFB(onPerfEntry); }); } }; // åœ¨åº”ç”¨ä¸­ä½¿ç”¨ const App = () =\u0026gt; { useEffect(() =\u0026gt; { reportWebVitals(console.log); // æˆ–è€…å‘é€åˆ°åˆ†ææœåŠ¡ reportWebVitals((metric) =\u0026gt; { analytics.track(\u0026#39;Web Vitals\u0026#39;, { name: metric.name, value: metric.value, id: metric.id, delta: metric.delta, }); }); }, []); return \u0026lt;div\u0026gt; {/* åº”ç”¨å†…å®¹ */} \u0026lt;/div\u0026gt;; }; 6. é«˜çº§ä¼˜åŒ–æŠ€å·§ æ¸²æŸ“æ‰¹æ¬¡è°ƒåº¦ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 import { unstable_batchedUpdates } from \u0026#39;react-dom\u0026#39;; // æ‰¹é‡æ›´æ–°çŠ¶æ€ const batchUpdateExample = () =\u0026gt; { // è¿™äº›æ›´æ–°ä¼šè¢«æ‰¹é‡å¤„ç†ï¼Œåªè§¦å‘ä¸€æ¬¡é‡æ–°æ¸²æŸ“ unstable_batchedUpdates(() =\u0026gt; { setCount(prev =\u0026gt; prev + 1); setName(\u0026#39;New Name\u0026#39;); setAge(25); }); }; // åœ¨äº‹ä»¶å¤„ç†å™¨ä¸­è‡ªåŠ¨æ‰¹é‡æ›´æ–°ï¼ˆReact 18+ï¼‰ const handleClick = () =\u0026gt; { // React 18ä¸­è¿™äº›æ›´æ–°ä¼šè‡ªåŠ¨æ‰¹é‡å¤„ç† setCount(prev =\u0026gt; prev + 1); setName(\u0026#39;New Name\u0026#39;); setAge(25); }; // å¼‚æ­¥æ“ä½œä¸­çš„æ‰¹é‡æ›´æ–° const fetchData = async () =\u0026gt; { const response = await fetch(\u0026#39;/api/data\u0026#39;); const data = await response.json(); // æ‰¹é‡æ›´æ–°çŠ¶æ€ unstable_batchedUpdates(() =\u0026gt; { setData(data); setLoading(false); setError(null); }); }; Concurrent Modeå’ŒSuspense 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 import { Suspense, startTransition } from \u0026#39;react\u0026#39;; const SearchResults = ({ query }) =\u0026gt; { const [results, setResults] = useState([]); const [isPending, startTransition] = useTransition(); const handleSearch = (searchQuery) =\u0026gt; { // æ ‡è®°æ›´æ–°ä¸ºè¿‡æ¸¡ startTransition(() =\u0026gt; { // éç´§æ€¥æ›´æ–° setResults(searchData(searchQuery)); }); // ç´§æ€¥æ›´æ–° setSearchQuery(searchQuery); }; return ( \u0026lt;div\u0026gt; \u0026lt;input type=\u0026#34;text\u0026#34; onChange={(e) =\u0026gt; handleSearch(e.target.value)} placeholder=\u0026#34;Search...\u0026#34; /\u0026gt; {isPending \u0026amp;\u0026amp; \u0026lt;div\u0026gt;Searching...\u0026lt;/div\u0026gt;} \u0026lt;Suspense fallback={\u0026lt;div\u0026gt;Loading results...\u0026lt;/div\u0026gt;}\u0026gt; \u0026lt;ResultsList results={results} /\u0026gt; \u0026lt;/Suspense\u0026gt; \u0026lt;/div\u0026gt; ); }; // æ•°æ®è·å–ç»„ä»¶ const DataFetcher = ({ url }) =\u0026gt; { const [data, setData] = useState(null); useEffect(() =\u0026gt; { let isMounted = true; fetchData(url).then(response =\u0026gt; { if (isMounted) { setData(response); } }); return () =\u0026gt; { isMounted = false; }; }, [url]); if (!data) { throw new Promise(resolve =\u0026gt; { setTimeout(() =\u0026gt; resolve(fetchData(url)), 1000); }); } return \u0026lt;div\u0026gt;{/* æ¸²æŸ“æ•°æ® */}\u0026lt;/div\u0026gt;; }; 7. å®æˆ˜æ¡ˆä¾‹ ç”µå•†äº§å“åˆ—è¡¨ä¼˜åŒ– 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 const ProductList = ({ products, filters, sortBy }) =\u0026gt; { // ä½¿ç”¨useMemoç¼“å­˜è¿‡æ»¤å’Œæ’åºç»“æœ const filteredAndSortedProducts = useMemo(() =\u0026gt; { let result = [...products]; // åº”ç”¨è¿‡æ»¤å™¨ if (filters.category) { result = result.filter(p =\u0026gt; p.category === filters.category); } if (filters.minPrice) { result = result.filter(p =\u0026gt; p.price \u0026gt;= filters.minPrice); } if (filters.maxPrice) { result = result.filter(p =\u0026gt; p.price \u0026lt;= filters.maxPrice); } // åº”ç”¨æ’åº result.sort((a, b) =\u0026gt; { switch (sortBy) { case \u0026#39;price-low\u0026#39;: return a.price - b.price; case \u0026#39;price-high\u0026#39;: return b.price - a.price; case \u0026#39;name\u0026#39;: return a.name.localeCompare(b.name); default: return 0; } }); return result; }, [products, filters, sortBy]); // è™šæ‹ŸåŒ–é•¿åˆ—è¡¨ const Row = React.memo(({ index, style }) =\u0026gt; ( \u0026lt;div style={style}\u0026gt; \u0026lt;ProductCard product={filteredAndSortedProducts[index]} /\u0026gt; \u0026lt;/div\u0026gt; )); return ( \u0026lt;div\u0026gt; \u0026lt;div className=\u0026#34;filters\u0026#34;\u0026gt; \u0026lt;ProductFilters filters={filters} onChange={setFilters} /\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;div className=\u0026#34;results-count\u0026#34;\u0026gt; Showing {filteredAndSortedProducts.length} products \u0026lt;/div\u0026gt; \u0026lt;List height={600} itemCount={filteredAndSortedProducts.length} itemSize={200} width=\u0026#34;100%\u0026#34; \u0026gt; {Row} \u0026lt;/List\u0026gt; \u0026lt;/div\u0026gt; ); }; // ä¼˜åŒ–çš„äº§å“å¡ç‰‡ç»„ä»¶ const ProductCard = React.memo(({ product }) =\u0026gt; { const [isImageLoaded, setIsImageLoaded] = useState(false); const [isInView, setIsInView] = useState(false); const imgRef = useRef(); useEffect(() =\u0026gt; { const observer = new IntersectionObserver( ([entry]) =\u0026gt; setIsInView(entry.isIntersecting), { threshold: 0.1 } ); if (imgRef.current) { observer.observe(imgRef.current); } return () =\u0026gt; observer.disconnect(); }, []); return ( \u0026lt;div className=\u0026#34;product-card\u0026#34;\u0026gt; \u0026lt;div ref={imgRef} className=\u0026#34;product-image\u0026#34;\u0026gt; {isInView \u0026amp;\u0026amp; ( \u0026lt;img src={product.imageUrl} alt={product.name} onLoad={() =\u0026gt; setIsImageLoaded(true)} style={{ opacity: isImageLoaded ? 1 : 0 }} /\u0026gt; )} \u0026lt;/div\u0026gt; \u0026lt;h3\u0026gt;{product.name}\u0026lt;/h3\u0026gt; \u0026lt;p className=\u0026#34;price\u0026#34;\u0026gt;${product.price}\u0026lt;/p\u0026gt; \u0026lt;button onClick={() =\u0026gt; addToCart(product)} className=\u0026#34;add-to-cart\u0026#34; \u0026gt; Add to Cart \u0026lt;/button\u0026gt; \u0026lt;/div\u0026gt; ); }); æ€»ç»“ Reactæ€§èƒ½ä¼˜åŒ–éœ€è¦ä»å¤šä¸ªå±‚é¢è€ƒè™‘ï¼š\nç»„ä»¶çº§ä¼˜åŒ–ï¼š\nä½¿ç”¨React.memoã€useMemoã€useCallback é¿å…ä¸å¿…è¦çš„é‡æ–°æ¸²æŸ“ åˆç†æ‹†åˆ†ç»„ä»¶ çŠ¶æ€ç®¡ç†ä¼˜åŒ–ï¼š\né¿å…çŠ¶æ€è¿‡åº¦æå‡ ä½¿ç”¨Contextåˆ†ç¦»å…³æ³¨ç‚¹ åˆç†ä½¿ç”¨æœ¬åœ°çŠ¶æ€å’Œå…¨å±€çŠ¶æ€ æ¸²æŸ“ä¼˜åŒ–ï¼š\nè™šæ‹ŸåŒ–é•¿åˆ—è¡¨ æ‡’åŠ è½½å’Œä»£ç åˆ†å‰² å›¾ç‰‡ä¼˜åŒ– æ„å»ºä¼˜åŒ–ï¼š\nä»£ç åˆ†å‰²å’ŒTree Shaking Bundleåˆ†æå’Œä¼˜åŒ– èµ„æºå‹ç¼©å’Œç¼“å­˜ è®°ä½ï¼Œæ€§èƒ½ä¼˜åŒ–åº”è¯¥åŸºäºå®é™…æµ‹é‡ï¼Œè¿‡æ—©ä¼˜åŒ–æ˜¯ä¸‡æ¶ä¹‹æºã€‚ä½¿ç”¨React DevTools Profilerã€Web Vitalsç­‰å·¥å…·è¯†åˆ«æ€§èƒ½ç“¶é¢ˆï¼Œç„¶åæœ‰é’ˆå¯¹æ€§åœ°è¿›è¡Œä¼˜åŒ–ã€‚\n","permalink":"/blog/articles/react-performance-optimization/","summary":"æ·±å…¥æ¢è®¨Reactåº”ç”¨æ€§èƒ½ä¼˜åŒ–çš„æ ¸å¿ƒç­–ç•¥ï¼ŒåŒ…æ‹¬ç»„ä»¶ä¼˜åŒ–ã€çŠ¶æ€ç®¡ç†ã€æ¸²æŸ“ä¼˜åŒ–ã€Bundleä¼˜åŒ–ç­‰ï¼Œå¸®åŠ©æ„å»ºé«˜æ€§èƒ½çš„Reactåº”ç”¨ã€‚","title":"Reactæ€§èƒ½ä¼˜åŒ–å®Œå…¨æŒ‡å—ï¼šä»åŸºç¡€åˆ°é«˜çº§çš„æ€§èƒ½æå‡æŠ€å·§"},{"content":"Redisä½œä¸ºé«˜æ€§èƒ½çš„å†…å­˜æ•°æ®åº“ï¼Œåœ¨ç°ä»£åº”ç”¨æ¶æ„ä¸­æ‰®æ¼”ç€é‡è¦è§’è‰²ã€‚æœ¬æ–‡å°†å…¨é¢ä»‹ç»Redisçš„æœ€ä½³å®è·µï¼Œå¸®åŠ©ä½ æ„å»ºç¨³å®šã€é«˜æ•ˆçš„Redisåº”ç”¨ã€‚\n1. RedisåŸºç¡€é…ç½® å†…å­˜ä¼˜åŒ–é…ç½® # redis.conf # è®¾ç½®æœ€å¤§å†…å­˜é™åˆ¶ maxmemory 2gb # å†…å­˜æ·˜æ±°ç­–ç•¥ # volatile-lru: åœ¨è®¾ç½®äº†TTLçš„keyä¸­ï¼Œæ·˜æ±°æœ€è¿‘æœ€å°‘ä½¿ç”¨çš„key # allkeys-lru: åœ¨æ‰€æœ‰keyä¸­ï¼Œæ·˜æ±°æœ€è¿‘æœ€å°‘ä½¿ç”¨çš„key # volatile-random: åœ¨è®¾ç½®äº†TTLçš„keyä¸­ï¼Œéšæœºæ·˜æ±°key # allkeys-random: åœ¨æ‰€æœ‰keyä¸­ï¼Œéšæœºæ·˜æ±°key # volatile-ttl: æ·˜æ±°å³å°†è¿‡æœŸçš„key # noeviction: ä¸æ·˜æ±°keyï¼Œå†…å­˜ä¸è¶³æ—¶è¿”å›é”™è¯¯ maxmemory-policy allkeys-lru # å¯ç”¨AOFæŒä¹…åŒ– appendonly yes appendfsync everysec # RDBå¿«ç…§é…ç½® save 900 1 # 15åˆ†é’Ÿå†…æœ‰1ä¸ªkeyæ”¹å˜å°±ä¿å­˜ save 300 10 # 5åˆ†é’Ÿå†…æœ‰10ä¸ªkeyæ”¹å˜å°±ä¿å­˜ save 60 10000 # 1åˆ†é’Ÿå†…æœ‰10000ä¸ªkeyæ”¹å˜å°±ä¿å­˜ # å‹ç¼©RDBæ–‡ä»¶ rdbcompression yes rdbchecksum yes ç½‘ç»œå’Œå®‰å…¨é…ç½® # ç½‘ç»œé…ç½® bind 127.0.0.1 192.168.1.100 port 6379 timeout 300 tcp-keepalive 300 # å®‰å…¨é…ç½® requirepass your-strong-password-here # æˆ–ä½¿ç”¨ACL (Redis 6.0+) aclfile /etc/redis/users.acl # ç¦ç”¨å±é™©å‘½ä»¤ rename-command FLUSHDB \u0026#34;\u0026#34; rename-command FLUSHALL \u0026#34;\u0026#34; rename-command KEYS \u0026#34;\u0026#34; rename-command CONFIG \u0026#34;CONFIG_b835c3f8a5d6e7f2e8c1d9a0b4c5f6e\u0026#34; rename-command SHUTDOWN SHUTDOWN_b835c3f8a5d6e7f2e8c1d9a0b4c5f6e rename-command DEBUG DEBUG_b835c3f8a5d6e7f2e8c1d9a0b4c5f6e # å®¢æˆ·ç«¯è¿æ¥é™åˆ¶ maxclients 10000 2. æ•°æ®ç»“æ„é€‰æ‹©ç­–ç•¥ Stringç±»å‹ä¼˜åŒ– 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 // åŸå­è®¡æ•°å™¨ const incrementCounter = async (key, increment = 1) =\u0026gt; { return await redis.incrBy(key, increment); }; // è®¾ç½®å¸¦TTLçš„ç¼“å­˜ const setCacheWithTTL = async (key, value, ttl = 3600) =\u0026gt; { await redis.setex(key, ttl, JSON.stringify(value)); }; // æ‰¹é‡è·å– const mGetCached = async (keys) =\u0026gt; { const values = await redis.mget(keys); return values.map(value =\u0026gt; value ? JSON.parse(value) : null); }; // ä½¿ç”¨Hashä»£æ›¿å¤šä¸ªStringï¼ˆå½“å­—æ®µè¾ƒå¤šæ—¶ï¼‰ const userInfo = { name: \u0026#39;John Doe\u0026#39;, email: \u0026#39;john@example.com\u0026#39;, age: 30, city: \u0026#39;New York\u0026#39; }; // âŒ ä¸æ¨èï¼šå¤šä¸ªStringé”® await redis.mset([ \u0026#39;user:1:name\u0026#39;, userInfo.name, \u0026#39;user:1:email\u0026#39;, userInfo.email, \u0026#39;user:1:age\u0026#39;, userInfo.age, \u0026#39;user:1:city\u0026#39;, userInfo.city ]); // âœ… æ¨èï¼šå•ä¸ªHash await redis.hset(\u0026#39;user:1\u0026#39;, userInfo); Hashç±»å‹ä¼˜åŒ– 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 // ç”¨æˆ·ä¿¡æ¯å­˜å‚¨ const setUserProfile = async (userId, profile) =\u0026gt; { const hashKey = `user:${userId}:profile`; await redis.hset(hashKey, { name: profile.name, email: profile.email, bio: profile.bio, lastUpdate: Date.now() }); // è®¾ç½®è¿‡æœŸæ—¶é—´ await redis.expire(hashKey, 86400); // 24å°æ—¶ }; // è·å–éƒ¨åˆ†å­—æ®µ const getUserFields = async (userId, fields) =\u0026gt; { const hashKey = `user:${userId}:profile`; return await redis.hmget(hashKey, fields); }; // æ›´æ–°å•ä¸ªå­—æ®µ const updateUserField = async (userId, field, value) =\u0026gt; { const hashKey = `user:${userId}:profile`; await redis.hset(hashKey, field, value); await redis.hset(hashKey, \u0026#39;lastUpdate\u0026#39;, Date.now()); }; // Hashè®¡æ•°å™¨ï¼ˆé€‚ç”¨äºå°è§„æ¨¡è®¡æ•°ï¼‰ const hashIncrement = async (key, field, increment = 1) =\u0026gt; { return await redis.hincrby(key, field, increment); }; Listç±»å‹ä¼˜åŒ– 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 // æ¶ˆæ¯é˜Ÿåˆ—ï¼ˆç®€å•å®ç°ï¼‰ class MessageQueue { constructor(redis, queueName) { this.redis = redis; this.queueName = queueName; this.processingName = `${queueName}:processing`; } async enqueue(message) { return await this.redis.lpush(this.queueName, JSON.stringify(message)); } async dequeue() { return await this.redis.brpoplpush( this.queueName, this.processingName, 0 ); } async complete(messageId) { // ä»å¤„ç†é˜Ÿåˆ—ä¸­ç§»é™¤ return await this.redis.lrem(this.processingName, 1, messageId); } async getQueueLength() { return await this.redis.llen(this.queueName); } async getProcessingLength() { return await this.redis.llen(this.processingName); } } // æ—¶é—´çº¿ï¼ˆæœ€æ–°æ¶ˆæ¯ï¼‰ const addTimelineEvent = async (userId, event) =\u0026gt; { const key = `timeline:${userId}`; const eventData = { id: generateId(), type: event.type, data: event.data, timestamp: Date.now() }; // æ·»åŠ åˆ°æ—¶é—´çº¿å¤´éƒ¨ await redis.lpush(key, JSON.stringify(eventData)); // ä¿æŒæœ€è¿‘100æ¡æ¶ˆæ¯ await redis.ltrim(key, 0, 99); // è®¾ç½®è¿‡æœŸæ—¶é—´ await redis.expire(key, 86400 * 7); // 7å¤© }; const getTimeline = async (userId, limit = 20) =\u0026gt; { const key = `timeline:${userId}`; const events = await redis.lrange(key, 0, limit - 1); return events.map(event =\u0026gt; JSON.parse(event)); }; Setç±»å‹ä¼˜åŒ– 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 // ç”¨æˆ·æ ‡ç­¾ç³»ç»Ÿ class UserTags { constructor(redis) { this.redis = redis; } async addTag(userId, tag) { const key = `user:${userId}:tags`; await redis.sadd(key, tag); return await redis.expire(key, 86400 * 30); // 30å¤© } async removeTag(userId, tag) { const key = `user:${userId}:tags`; return await redis.srem(key, tag); } async getUserTags(userId) { const key = `user:${userId}:tags`; return await redis.smembers(key); } async getTagUsers(tag) { const key = `tag:${tag}:users`; return await redis.smembers(key); } // åŒå‘ç´¢å¼•ï¼šåŒæ—¶ç»´æŠ¤ç”¨æˆ·æ ‡ç­¾å’Œæ ‡ç­¾ç”¨æˆ· async addTagToUser(userId, tag) { const userTagsKey = `user:${userId}:tags`; const tagUsersKey = `tag:${tag}:users`; await this.redis.multi() .sadd(userTagsKey, tag) .sadd(tagUsersKey, userId) .expire(userTagsKey, 86400 * 30) .expire(tagUsersKey, 86400 * 30) .exec(); } } // é›†åˆæ“ä½œï¼šæ‰¾å‡ºå…±åŒæ ‡ç­¾ const findCommonTags = async (userIds) =\u0026gt; { const keys = userIds.map(id =\u0026gt; `user:${id}:tags`); // å¦‚æœåªæœ‰ä¸€ä¸ªç”¨æˆ·ï¼Œè¿”å›å…¶æ‰€æœ‰æ ‡ç­¾ if (keys.length === 1) { return await this.redis.smembers(keys[0]); } // ä½¿ç”¨SINTERæ‰¾å‡ºå…±åŒæ ‡ç­¾ return await this.redis.sinter(keys); }; // æ¨èç›¸ä¼¼ç”¨æˆ· const findSimilarUsers = async (userId, threshold = 0.3) =\u0026gt; { const userTagsKey = `user:${userId}:tags`; const userTags = await this.redis.smembers(userTagsKey); if (userTags.length === 0) return []; const similarUsers = []; // è¿™é‡Œéœ€è¦è·å–æ‰€æœ‰ç”¨æˆ·æ ‡ç­¾è¿›è¡Œæ¯”è¾ƒ // åœ¨å®é™…åº”ç”¨ä¸­ï¼Œå¯èƒ½éœ€è¦ä½¿ç”¨å…¶ä»–æ•°æ®ç»“æ„æ¥ä¼˜åŒ– return similarUsers; }; Sorted Setä¼˜åŒ– 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 // æ’è¡Œæ¦œç³»ç»Ÿ class Leaderboard { constructor(redis, leaderboardName) { this.redis = redis; this.leaderboardName = leaderboardName; this.ttl = 86400 * 7; // 7å¤© } async addScore(member, score, memberData = {}) { // æ·»åŠ åˆ†æ•° await this.redis.zadd(this.leaderboardName, score, member); // å­˜å‚¨æˆå‘˜è¯¦ç»†ä¿¡æ¯ if (Object.keys(memberData).length \u0026gt; 0) { const dataKey = `${this.leaderboardName}:data:${member}`; await this.redis.hset(dataKey, memberData); await this.redis.expire(dataKey, this.ttl); } // è®¾ç½®è¿‡æœŸæ—¶é—´ await this.redis.expire(this.leaderboardName, this.ttl); } async getTopRank(limit = 10) { // è·å–æ’è¡Œæ¦œå‰Nå const topUsers = await this.redis.zrevrange( this.leaderboardName, 0, limit - 1, \u0026#39;WITHSCORES\u0026#39; ); const result = []; for (let i = 0; i \u0026lt; topUsers.length; i += 2) { const member = topUsers[i]; const score = topUsers[i + 1]; const rank = i / 2 + 1; // è·å–ç”¨æˆ·è¯¦ç»†ä¿¡æ¯ const dataKey = `${this.leaderboardName}:data:${member}`; const userData = await this.redis.hgetall(dataKey); result.push({ rank, member, score: parseFloat(score), ...userData }); } return result; } async getUserRank(member) { const rank = await this.redis.zrevrank(this.leaderboardName, member); return rank !== null ? rank + 1 : null; } async getScore(member) { return await this.redis.zscore(this.leaderboardName, member); } async updateScore(member, newScore) { return await this.redis.zadd(this.leaderboardName, newScore, member); } } // å»¶è¿Ÿé˜Ÿåˆ—ï¼ˆSorted Setå®ç°ï¼‰ class DelayedQueue { constructor(redis, queueName) { this.redis = redis; this.queueName = queueName; this.processing = false; } async addTask(taskId, taskData, delaySeconds) { const executeAt = Date.now() + delaySeconds * 1000; const task = { id: taskId, data: taskData, executeAt, addedAt: Date.now() }; return await this.redis.zadd( this.queueName, executeAt, JSON.stringify(task) ); } async processNext() { if (this.processing) return; this.processing = true; try { const now = Date.now(); // è·å–åˆ°æœŸçš„ä»»åŠ¡ const tasks = await this.redis.zrangebyscore( this.queueName, 0, now, \u0026#39;LIMIT\u0026#39;, 1 ); if (tasks.length === 0) { this.processing = false; return null; } const task = JSON.parse(tasks[0]); // ä»é˜Ÿåˆ—ä¸­ç§»é™¤ await this.redis.zrem(this.queueName, tasks[0]); // å¤„ç†ä»»åŠ¡ await this.handleTask(task); return task; } finally { this.processing = false; } } async handleTask(task) { console.log(`Processing task ${task.id}:`, task.data); // å®ç°å…·ä½“çš„ä»»åŠ¡å¤„ç†é€»è¾‘ } } 3. æ€§èƒ½ä¼˜åŒ–æŠ€å·§ Pipelineæ‰¹å¤„ç† 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 // æ‰¹é‡æ“ä½œä¼˜åŒ– class RedisBatch { constructor(redis) { this.redis = redis; } async batchSet(keyValues) { const pipeline = this.redis.pipeline(); for (const [key, value] of Object.entries(keyValues)) { pipeline.set(key, JSON.stringify(value)); } return await pipeline.exec(); } async batchUpdateScores(leaderboard, updates) { const pipeline = this.redis.pipeline(); for (const [member, score] of updates) { pipeline.zadd(leaderboard, score, member); } return await pipeline.exec(); } // åŸå­æ€§æ‰¹é‡æ“ä½œ async atomicUpdate(userData) { const key = `user:${userData.id}`; return await this.redis.multi() .hset(key, userData) .expire(key, 3600) .sadd(\u0026#39;users\u0026#39;, userData.id) .exec(); } } å†…å­˜ä¼˜åŒ– 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 // Keyè®¾è®¡æœ€ä½³å®è·µ class KeyNaming { // ä½¿ç”¨å†’å·åˆ†éš”çš„å±‚çº§ç»“æ„ static user(userId) { return `user:${userId}`; } static userProfile(userId) { return `user:${userId}:profile`; } static userSessions(userId) { return `user:${userId}:sessions`; } static cache(namespace, key) { return `cache:${namespace}:${key}`; } static lock(resource) { return `lock:${resource}`; } static counter(name) { return `counter:${name}`; } } // å‹ç¼©å­˜å‚¨ const compressData = (data) =\u0026gt; { if (typeof data === \u0026#39;string\u0026#39;) { return data; // å·²ç»æ˜¯å­—ç¬¦ä¸² } return JSON.stringify(data); }; // é€‰æ‹©åˆé€‚çš„æ•°æ®ç»“æ„ const chooseDataStructure = (useCase) =\u0026gt; { switch (useCase) { case \u0026#39;simpleCache\u0026#39;: return \u0026#39;String\u0026#39;; // ç®€å•é”®å€¼ç¼“å­˜ case \u0026#39;userProfile\u0026#39;: return \u0026#39;Hash\u0026#39;; // ç”¨æˆ·æ¡£æ¡ˆåŒ…å«å¤šä¸ªå­—æ®µ case \u0026#39;messageQueue\u0026#39;: return \u0026#39;List\u0026#39;; // æ¶ˆæ¯é˜Ÿåˆ— case \u0026#39;userTags\u0026#39;: return \u0026#39;Set\u0026#39;; // ç”¨æˆ·æ ‡ç­¾é›†åˆ case \u0026#39;leaderboard\u0026#39;: return \u0026#39;Sorted Set\u0026#39;; // æ’è¡Œæ¦œ case \u0026#39;rateLimit\u0026#39;: return \u0026#39;String + Expire\u0026#39;; // é™æµå™¨ default: return \u0026#39;String\u0026#39;; } }; 4. ç¼“å­˜ç­–ç•¥ å¤šçº§ç¼“å­˜ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 class MultiLevelCache { constructor(redis, localCache) { this.redis = redis; this.localCache = localCache; // ä¾‹å¦‚ï¼šMapæˆ–LRU Cache } async get(key) { // L1ï¼šæœ¬åœ°ç¼“å­˜ let value = this.localCache.get(key); if (value !== undefined) { return value; } // L2ï¼šRedisç¼“å­˜ value = await this.redis.get(key); if (value !== null) { const parsedValue = JSON.parse(value); // å›å¡«æœ¬åœ°ç¼“å­˜ this.localCache.set(key, parsedValue, 300); // 5åˆ†é’Ÿ return parsedValue; } // L3ï¼šæ•°æ®åº“æˆ–å…¶ä»–å­˜å‚¨ value = await this.fetchFromDatabase(key); if (value !== null) { // å†™å…¥æ‰€æœ‰ç¼“å­˜å±‚ await this.set(key, value); } return value; } async set(key, value, ttl = 3600) { // åŒæ—¶å†™å…¥æ‰€æœ‰ç¼“å­˜å±‚ this.localCache.set(key, value, Math.min(ttl, 300)); // æœ¬åœ°ç¼“å­˜æœ€å¤š5åˆ†é’Ÿ await this.redis.setex(key, ttl, JSON.stringify(value)); } async invalidate(key) { this.localCache.delete(key); await this.redis.del(key); } async fetchFromDatabase(key) { // å®é™…çš„æ•°æ®åº“æŸ¥è¯¢é€»è¾‘ console.log(`Fetching ${key} from database`); return null; // ç¤ºä¾‹ } } // ç¼“å­˜ç©¿é€ä¿æŠ¤ const cacheWithProtection = async (key, fetcher) =\u0026gt; { // æ£€æŸ¥æ˜¯å¦å­˜åœ¨\u0026#34;ç©º\u0026#34;ç¼“å­˜ const nullKey = `${key}:null`; const isNull = await redis.exists(nullKey); if (isNull) { return null; // å·²çŸ¥ä¸ºç©º } let value = await redis.get(key); if (value !== null) { return JSON.parse(value); } // å¹¶å‘æ§åˆ¶ const lockKey = `lock:${key}`; const lockValue = generateUUID(); const lockAcquired = await redis.setnx(lockKey, lockValue, 10); // 10ç§’é” if (lockAcquired) { try { value = await fetcher(); if (value === null) { // è®¾ç½®\u0026#34;ç©º\u0026#34;ç¼“å­˜ï¼Œé˜²æ­¢ç©¿é€ await redis.setex(nullKey, 60, \u0026#39;null\u0026#39;); // 1åˆ†é’Ÿ } else { await redis.setex(key, 3600, JSON.stringify(value)); } return value; } finally { // é‡Šæ”¾é” const script = ` if redis.call(\u0026#34;get\u0026#34;, KEYS[1]) == ARGV[1] then return redis.call(\u0026#34;del\u0026#34;, KEYS[1]) else return 0 end `; await redis.eval(script, 1, lockKey, lockValue); } } else { // ç­‰å¾…é”é‡Šæ”¾åé‡è¯• await new Promise(resolve =\u0026gt; setTimeout(resolve, 100)); return cacheWithProtection(key, fetcher); } }; ç¼“å­˜æ›´æ–°ç­–ç•¥ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 // Cache-Asideæ¨¡å¼ class CacheAside { constructor(redis) { this.redis = redis; } async get(key, fetcher) { let data = await this.redis.get(key); if (data !== null) { return JSON.parse(data); } data = await fetcher(); if (data !== null) { await this.redis.setex(key, 3600, JSON.stringify(data)); } return data; } async update(key, data, ttl = 3600) { // å…ˆæ›´æ–°æ•°æ®åº“ await this.updateDatabase(key, data); // ç„¶åæ›´æ–°ç¼“å­˜ await this.redis.setex(key, ttl, JSON.stringify(data)); } async invalidate(key) { await this.redis.del(key); } } // Write-Throughæ¨¡å¼ class WriteThrough { constructor(redis) { this.redis = redis; } async set(key, data, ttl = 3600) { // åŒæ—¶å†™å…¥æ•°æ®åº“å’Œç¼“å­˜ await Promise.all([ this.updateDatabase(key, data), this.redis.setex(key, ttl, JSON.stringify(data)) ]); } } // Write-Behindæ¨¡å¼ class WriteBehind { constructor(redis) { this.redis = redis; this.writeQueue = []; this.batchSize = 100; this.flushInterval = 5000; // 5ç§’ this.startFlushTimer(); } async set(key, data, ttl = 3600) { // ç«‹å³å†™å…¥ç¼“å­˜ await this.redis.setex(key, ttl, JSON.stringify(data)); // åŠ å…¥å†™é˜Ÿåˆ— this.writeQueue.push({ key, data, timestamp: Date.now() }); // å¦‚æœé˜Ÿåˆ—æ»¡äº†ï¼Œç«‹å³åˆ·æ–° if (this.writeQueue.length \u0026gt;= this.batchSize) { await this.flushQueue(); } } async flushQueue() { if (this.writeQueue.length === 0) return; const batch = this.writeQueue.splice(0); try { // æ‰¹é‡å†™å…¥æ•°æ®åº“ await this.batchWriteToDatabase(batch); } catch (error) { console.error(\u0026#39;Write-behind batch failed:\u0026#39;, error); // é‡æ–°åŠ å…¥é˜Ÿåˆ— this.writeQueue.unshift(...batch); } } startFlushTimer() { setInterval(() =\u0026gt; { this.flushQueue(); }, this.flushInterval); } async batchWriteToDatabase(batch) { // å®ç°æ‰¹é‡æ•°æ®åº“å†™å…¥é€»è¾‘ console.log(`Writing ${batch.length} items to database`); } } 5. åˆ†å¸ƒå¼é” 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 // ç®€å•åˆ†å¸ƒå¼é” class DistributedLock { constructor(redis) { this.redis = redis; } async acquire(key, ttl = 30) { const lockValue = generateUUID(); const result = await this.redis.setnx(key, lockValue, ttl); if (result === 1) { return { acquired: true, value: lockValue }; } return { acquired: false, value: null }; } async release(key, lockValue) { const script = ` if redis.call(\u0026#34;get\u0026#34;, KEYS[1]) == ARGV[1] then return redis.call(\u0026#34;del\u0026#34;, KEYS[1]) else return 0 end `; const result = await this.redis.eval(script, 1, key, lockValue); return result === 1; } async extend(key, lockValue, ttl) { const script = ` if redis.call(\u0026#34;get\u0026#34;, KEYS[1]) == ARGV[1] then return redis.call(\u0026#34;expire\u0026#34;, KEYS[1], ARGV[2]) else return 0 end `; return await this.redis.eval(script, 1, key, lockValue, ttl); } } // å¯é‡å…¥é” class ReentrantLock { constructor(redis) { this.redis = redis; } async acquire(key, lockId, ttl = 30) { const lockKey = `reentrant:${key}:${lockId}`; const counterKey = `reentrant:${key}:counter`; const script = ` local counter = redis.call(\u0026#34;incr\u0026#34;, KEYS[2]) redis.call(\u0026#34;expire\u0026#34;, KEYS[2], ARGV[1]) redis.call(\u0026#34;set\u0026#34;, KEYS[1], \u0026#34;1\u0026#34;, \u0026#34;EX\u0026#34;, ARGV[1]) return counter `; return await this.redis.eval(script, 2, lockKey, counterKey, ttl); } async release(key, lockId) { const lockKey = `reentrant:${key}:${lockId}`; const counterKey = `reentrant:${key}:counter`; const script = ` local count = redis.call(\u0026#34;get\u0026#34;, KEYS[1]) if count == \u0026#34;0\u0026#34; then return 0 end redis.call(\u0026#34;decr\u0026#34;, KEYS[2]) if tonumber(redis.call(\u0026#34;get\u0026#34;, KEYS[2])) == 0 then redis.call(\u0026#34;del\u0026#34;, KEYS[1]) redis.call(\u0026#34;del\u0026#34;, KEYS[2]) end return 1 `; return await this.redis.eval(script, 2, lockKey, counterKey); } } 6. ç›‘æ§å’Œè¯Šæ–­ æ€§èƒ½ç›‘æ§ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 class RedisMonitor { constructor(redis) { this.redis = redis; } async getMetrics() { const info = await this.redis.info(); const lines = info.split(\u0026#39;\\r\\n\u0026#39;); const metrics = {}; for (const line of lines) { if (line.includes(\u0026#39;:\u0026#39;)) { const [key, value] = line.split(\u0026#39;:\u0026#39;); metrics[key] = value; } } return { connected_clients: parseInt(metrics.connected_clients) || 0, used_memory: metrics.used_memory_human || \u0026#39;0B\u0026#39;, total_commands_processed: parseInt(metrics.total_commands_processed) || 0, keyspace_hits: parseInt(metrics.keyspace_hits) || 0, keyspace_misses: parseInt(metrics.keyspace_misses) || 0, instantaneous_ops_per_sec: parseFloat(metrics.instantaneous_ops_per_sec) || 0, memory_usage_ratio: parseFloat(metrics.mem_fragmentation_ratio) || 0 }; } async getSlowLog(count = 10) { return await this.redis.slowlog(\u0026#39;GET\u0026#39;, count); } async getMemoryUsage() { const memoryInfo = await this.redis.memory(\u0026#39;usage\u0026#39;); return { peak: memoryInfo.peak, used: memoryInfo.used, rss: memoryInfo.rss, overhead: memoryInfo.overhead, startup: memoryInfo.startup, dataset: memoryInfo.dataset }; } async checkHealth() { try { await this.redis.ping(); const metrics = await this.getMetrics(); return { status: \u0026#39;healthy\u0026#39;, timestamp: new Date().toISOString(), metrics }; } catch (error) { return { status: \u0026#39;unhealthy\u0026#39;, timestamp: new Date().toISOString(), error: error.message }; } } // å®šæœŸç›‘æ§ startMonitoring(interval = 60000) { // 1åˆ†é’Ÿ setInterval(async () =\u0026gt; { const health = await this.checkHealth(); if (health.status === \u0026#39;unhealthy\u0026#39;) { console.error(\u0026#39;Redis health check failed:\u0026#39;, health.error); // å‘é€å‘Šè­¦ this.sendAlert(health); } // è®°å½•æŒ‡æ ‡ console.log(\u0026#39;Redis metrics:\u0026#39;, health.metrics); }, interval); } sendAlert(health) { // å®ç°å‘Šè­¦é€»è¾‘ console.error(\u0026#39;Redis Alert:\u0026#39;, health); } } // ä½¿ç”¨ç¤ºä¾‹ const monitor = new RedisMonitor(redis); monitor.startMonitoring(); æ€§èƒ½åˆ†æ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 // æ…¢æŸ¥è¯¢æ£€æµ‹ class SlowQueryDetector { constructor(redis, threshold = 100) { this.redis = redis; this.threshold = threshold; this.slowQueries = []; } async detectSlowQuery(command, startTime, endTime) { const duration = endTime - startTime; if (duration \u0026gt; this.threshold) { const slowQuery = { command, duration, timestamp: new Date().toISOString() }; this.slowQueries.push(slowQuery); console.warn(`Slow query detected: ${command} took ${duration}ms`); // å‘é€åˆ°ç›‘æ§ç³»ç»Ÿ this.reportSlowQuery(slowQuery); // ä¿æŒæœ€è¿‘100ä¸ªæ…¢æŸ¥è¯¢ if (this.slowQueries.length \u0026gt; 100) { this.slowQueries.shift(); } } } async reportSlowQuery(query) { // å®ç°æ…¢æŸ¥è¯¢æŠ¥å‘Šé€»è¾‘ } getSlowQueries() { return this.slowQueries; } // è£…é¥°å™¨å‡½æ•° wrapRedisFunction(originalFunction, functionName) { return async (...args) =\u0026gt; { const startTime = Date.now(); try { const result = await originalFunction.apply(this.redis, args); const endTime = Date.now(); await this.detectSlowQuery( `${functionName}(${args.join(\u0026#39;, \u0026#39;)})`, startTime, endTime ); return result; } catch (error) { const endTime = Date.now(); await this.detectSlowQuery( `${functionName}(${args.join(\u0026#39;, \u0026#39;)}) - ERROR`, startTime, endTime ); throw error; } }; } } 7. é›†ç¾¤å’Œå¤åˆ¶ ä¸»ä»å¤åˆ¶é…ç½® # ä¸»æœåŠ¡å™¨é…ç½® port 6379 bind 0.0.0.0 # ä»æœåŠ¡å™¨é…ç½® port 6380 bind 0.0.0.0 replicaof 192.168.1.100 6379 replica-priority 100 Redis Cluster 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 // Redisé›†ç¾¤å®¢æˆ·ç«¯ class RedisClusterClient { constructor(nodes) { this.nodes = nodes; this.connections = new Map(); this.keySlotCount = 16384; this.initializeConnections(); } initializeConnections() { for (const node of this.nodes) { const redis = new Redis({ host: node.host, port: node.port, retryDelayOnFailover: 100, enableReadyCheck: true, maxRetriesPerRequest: 3 }); this.connections.set(`${node.host}:${node.port}`, redis); } } getSlot(key) { return this.crc16(key) % this.keySlotCount; } getNodeForSlot(slot) { // ç®€åŒ–ç‰ˆæœ¬ï¼Œå®é™…åº”è¯¥æ ¹æ®slotèŒƒå›´é€‰æ‹©èŠ‚ç‚¹ const nodeIndex = Math.floor(slot / (this.keySlotCount / this.nodes.length)); return this.nodes[nodeIndex]; } getConnectionForKey(key) { const slot = this.getSlot(key); const node = this.getNodeForSlot(slot); return this.connections.get(`${node.host}:${node.port}`); } async get(key) { const connection = this.getConnectionForKey(key); return await connection.get(key); } async set(key, value, ttl) { const connection = this.getConnectionForKey(key); if (ttl) { return await connection.setex(key, ttl, value); } else { return await connection.set(key, value); } } crc16(str) { let crc = 0xFFFF; for (let i = 0; i \u0026lt; str.length; i++) { crc = ((crc \u0026lt;\u0026lt; 8) \u0026amp; 0xFF00) | (crc \u0026gt;\u0026gt; 8); crc ^= str.charCodeAt(i) \u0026amp; 0xFF; crc ^= ((crc \u0026amp; 0xFF) \u0026lt;\u0026lt; 4) \u0026lt;\u0026lt; 8; crc = ((crc \u0026lt;\u0026lt; 8) \u0026amp; 0xFF00) | (crc \u0026gt;\u0026gt; 8); crc ^= ((crc \u0026amp; 0xFF) \u0026gt;\u0026gt; 4) \u0026lt;\u0026lt; 8; } return crc ^ 0xFFFF; } } 8. æ•…éšœæ¢å¤å’Œå¤‡ä»½ è‡ªåŠ¨æ•…éšœæ¢å¤ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 class RedisFailover { constructor(primaryConfig, replicaConfigs) { this.primaryConfig = primaryConfig; this.replicaConfigs = replicaConfigs; this.currentPrimary = null; this.replicas = []; this.initializeConnections(); } async initializeConnections() { try { // å°è¯•è¿æ¥ä¸»æœåŠ¡å™¨ this.currentPrimary = new Redis(this.primaryConfig); await this.currentPrimary.ping(); console.log(\u0026#39;Connected to primary server\u0026#39;); } catch (error) { console.error(\u0026#39;Primary server unavailable:\u0026#39;, error); await this.promoteReplica(); } // è¿æ¥ä»æœåŠ¡å™¨ for (const config of this.replicaConfigs) { try { const replica = new Redis(config); await replica.ping(); this.replicas.push(replica); console.log(`Connected to replica server: ${config.host}:${config.port}`); } catch (error) { console.warn(`Replica server unavailable: ${config.host}:${config.port}`); } } } async promoteReplica() { for (let i = 0; i \u0026lt; this.replicas.length; i++) { try { // å°è¯•æå‡ä»æœåŠ¡å™¨ä¸ºä¸»æœåŠ¡å™¨ const replica = this.replicas[i]; await replica.replica(\u0026#39;NO ONE\u0026#39;); // ç­‰å¾…ä»æœåŠ¡å™¨å®Œæˆè§’è‰²åˆ‡æ¢ await new Promise(resolve =\u0026gt; setTimeout(resolve, 1000)); this.currentPrimary = replica; console.log(`Promoted replica ${i} to primary`); // é‡æ–°é…ç½®å…¶ä»–ä»æœåŠ¡å™¨ await this.reconfigureReplicas(); break; } catch (error) { console.error(`Failed to promote replica ${i}:`, error); } } if (!this.currentPrimary) { throw new Error(\u0026#39;No available replicas to promote\u0026#39;); } } async reconfigureReplicas() { for (const replica of this.replicas) { if (replica !== this.currentPrimary) { try { await replica.replica(this.primaryConfig.host, this.primaryConfig.port); } catch (error) { console.error(\u0026#39;Failed to reconfigure replica:\u0026#39;, error); } } } } async handleFailover() { if (this.currentPrimary) { try { await this.currentPrimary.ping(); return; // ä¸»æœåŠ¡å™¨æ­£å¸¸ } catch (error) { console.error(\u0026#39;Primary server failed:\u0026#39;, error); } } await this.promoteReplica(); } startHealthCheck() { setInterval(async () =\u0026gt; { await this.handleFailover(); }, 5000); // æ¯5ç§’æ£€æŸ¥ä¸€æ¬¡ } } æ•°æ®å¤‡ä»½ç­–ç•¥ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 class RedisBackup { constructor(redis) { this.redis = redis; } async createSnapshot(backupDir) { const timestamp = new Date().toISOString().replace(/[:.]/g, \u0026#39;-\u0026#39;); const filename = `redis-backup-${timestamp}.rdb`; const filePath = path.join(backupDir, filename); try { // è§¦å‘Redis RDBå¿«ç…§ await this.redis.save(); // ç­‰å¾…å¿«ç…§å®Œæˆ await this.waitForSaveCompletion(); // å¤åˆ¶å¿«ç…§æ–‡ä»¶åˆ°å¤‡ä»½ç›®å½• await this.copyRdbFile(filePath); console.log(`Backup created: ${filePath}`); return filename; } catch (error) { console.error(\u0026#39;Backup failed:\u0026#39;, error); throw error; } } async waitForSaveCompletion() { let saveInProgress = true; while (saveInProgress) { const info = await this.redis.info(\u0026#39;persistence\u0026#39;); if (info.includes(\u0026#39;saving: 0\u0026#39;)) { saveInProgress = false; } else { await new Promise(resolve =\u0026gt; setTimeout(resolve, 1000)); } } } async copyRdbFile(destination) { const rdbPath = \u0026#39;/var/lib/redis/dump.rdb\u0026#39;; // é»˜è®¤RDBè·¯å¾„ try { await fs.copyFile(rdbPath, destination); } catch (error) { throw new Error(`Failed to copy RDB file: ${error.message}`); } } async scheduleBackups(backupDir, interval = 24 * 60 * 60 * 1000) { // 24å°æ—¶ setInterval(async () =\u0026gt; { try { await this.createSnapshot(backupDir); // æ¸…ç†æ—§å¤‡ä»½ï¼ˆä¿ç•™æœ€è¿‘7å¤©ï¼‰ await this.cleanupOldBackups(backupDir, 7); } catch (error) { console.error(\u0026#39;Scheduled backup failed:\u0026#39;, error); } }, interval); } async cleanupOldBackups(backupDir, daysToKeep) { const files = await fs.readdir(backupDir); const now = Date.now(); for (const file of files) { if (file.startsWith(\u0026#39;redis-backup-\u0026#39;) \u0026amp;\u0026amp; file.endsWith(\u0026#39;.rdb\u0026#39;)) { const filePath = path.join(backupDir, file); const stats = await fs.stat(filePath); const ageInDays = (now - stats.mtime.getTime()) / (24 * 60 * 60 * 1000); if (ageInDays \u0026gt; daysToKeep) { await fs.unlink(filePath); console.log(`Removed old backup: ${file}`); } } } } } 9. å®‰å…¨æœ€ä½³å®è·µ è¿æ¥å®‰å…¨ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 // TLSè¿æ¥é…ç½® class SecureRedisClient { constructor(config) { this.config = { host: config.host || \u0026#39;localhost\u0026#39;, port: config.port || 6379, tls: config.tls || {}, password: config.password, database: config.database || 0, retryDelayOnFailover: 100, maxRetriesPerRequest: 3, enableReadyCheck: true, lazyConnect: true }; } createClient() { const client = new Redis(this.config); // è¿æ¥é”™è¯¯å¤„ç† client.on(\u0026#39;error\u0026#39;, (err) =\u0026gt; { console.error(\u0026#39;Redis Client Error:\u0026#39;, err); }); client.on(\u0026#39;connect\u0026#39;, () =\u0026gt; { console.log(\u0026#39;Redis Client Connected\u0026#39;); }); client.on(\u0026#39;reconnecting\u0026#39;, () =\u0026gt; { console.log(\u0026#39;Redis Client Reconnecting...\u0026#39;); }); return client; } } // è¿æ¥æ± ç®¡ç† class RedisConnectionPool { constructor(config, poolSize = 10) { this.config = config; this.poolSize = poolSize; this.connections = []; this.waitingQueue = []; this.initializePool(); } async initializePool() { for (let i = 0; i \u0026lt; this.poolSize; i++) { const client = new Redis(this.config); this.connections.push({ client, inUse: false, id: i }); } } async getConnection() { return new Promise((resolve, reject) =\u0026gt; { // æŸ¥æ‰¾å¯ç”¨è¿æ¥ const available = this.connections.find(conn =\u0026gt; !conn.inUse); if (available) { available.inUse = true; resolve(available.client); } else { // åŠ å…¥ç­‰å¾…é˜Ÿåˆ— this.waitingQueue.push({ resolve, reject }); } }); } releaseConnection(client) { const connection = this.connections.find(conn =\u0026gt; conn.client === client); if (connection) { connection.inUse = false; // å¤„ç†ç­‰å¾…é˜Ÿåˆ— if (this.waitingQueue.length \u0026gt; 0) { const waiter = this.waitingQueue.shift(); connection.inUse = true; waiter.resolve(connection.client); } } } // è¿æ¥å¥åº·æ£€æŸ¥ async healthCheck() { const client = await this.getConnection(); try { await client.ping(); this.releaseConnection(client); return { status: \u0026#39;healthy\u0026#39; }; } catch (error) { this.releaseConnection(client); return { status: \u0026#39;unhealthy\u0026#39;, error: error.message }; } } } æ€»ç»“ Redisæœ€ä½³å®è·µæ¶µç›–äº†å¤šä¸ªæ–¹é¢ï¼š\né…ç½®ä¼˜åŒ–ï¼š\nåˆç†çš„å†…å­˜é…ç½® é€‚å½“çš„æ·˜æ±°ç­–ç•¥ ç½‘ç»œå’Œå®‰å…¨è®¾ç½® æ•°æ®ç»“æ„é€‰æ‹©ï¼š\næ ¹æ®ä½¿ç”¨åœºæ™¯é€‰æ‹©åˆé€‚çš„æ•°æ®ç±»å‹ ä¼˜åŒ–Keyå‘½åè§„èŒƒ åˆç†çš„æ•°æ®ç»“æ„è®¾è®¡ æ€§èƒ½ä¼˜åŒ–ï¼š\nPipelineæ‰¹å¤„ç† å¤šçº§ç¼“å­˜ç­–ç•¥ å†…å­˜ä½¿ç”¨ä¼˜åŒ– é«˜å¯ç”¨æ€§ï¼š\nåˆ†å¸ƒå¼é”å®ç° ä¸»ä»å¤åˆ¶é…ç½® é›†ç¾¤å’Œæ•…éšœè½¬ç§» è¿ç»´ç›‘æ§ï¼š\næ€§èƒ½æŒ‡æ ‡ç›‘æ§ æ…¢æŸ¥è¯¢æ£€æµ‹ å¥åº·æ£€æŸ¥æœºåˆ¶ å®‰å…¨é˜²æŠ¤ï¼š\nè¿æ¥åŠ å¯† è®¿é—®æ§åˆ¶ å¤‡ä»½æ¢å¤ é€šè¿‡éµå¾ªè¿™äº›æœ€ä½³å®è·µï¼Œå¯ä»¥æ„å»ºå‡ºé«˜æ€§èƒ½ã€é«˜å¯ç”¨çš„Redisåº”ç”¨ç³»ç»Ÿï¼Œä¸ºä½ çš„åº”ç”¨æä¾›å¼ºå¤§çš„ç¼“å­˜å’Œæ•°æ®å­˜å‚¨èƒ½åŠ›ã€‚\n","permalink":"/blog/articles/redis-best-practices/","summary":"æ·±å…¥æ¢è®¨Redisçš„ä½¿ç”¨æœ€ä½³å®è·µï¼ŒåŒ…æ‹¬æ•°æ®ç»“æ„é€‰æ‹©ã€æ€§èƒ½ä¼˜åŒ–ã€é›†ç¾¤é…ç½®ã€æŒä¹…åŒ–ç­–ç•¥ç­‰ï¼Œå¸®åŠ©å¼€å‘è€…æ„å»ºé«˜å¯ç”¨çš„Redisåº”ç”¨ã€‚","title":"Redisæœ€ä½³å®è·µæŒ‡å—ï¼šé«˜æ€§èƒ½å†…å­˜æ•°æ®åº“å®æˆ˜æŠ€å·§"},{"content":"APIè®¾è®¡æ˜¯ç°ä»£Webåº”ç”¨çš„æ ¸å¿ƒï¼Œä¸€ä¸ªå¥½çš„APIè®¾è®¡èƒ½å¤Ÿæé«˜å¼€å‘æ•ˆç‡ã€é™ä½ç»´æŠ¤æˆæœ¬ï¼Œå¹¶ä¸ºæœªæ¥çš„æ‰©å±•å¥ å®šåŸºç¡€ã€‚æœ¬æ–‡å°†æ·±å…¥æ¢è®¨RESTful APIçš„è®¾è®¡åŸåˆ™å’Œæœ€ä½³å®è·µã€‚\n1. èµ„æºå¯¼å‘çš„è®¾è®¡ RESTful APIçš„æ ¸å¿ƒæ˜¯èµ„æºï¼Œä¸€åˆ‡å›´ç»•èµ„æºå±•å¼€ï¼š\nèµ„æºå‘½åè§„èŒƒ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 // âœ… å¥½çš„èµ„æºå‘½å GET /api/v1/users // è·å–ç”¨æˆ·åˆ—è¡¨ GET /api/v1/users/{id} // è·å–ç‰¹å®šç”¨æˆ· POST /api/v1/users // åˆ›å»ºç”¨æˆ· PUT /api/v1/users/{id} // æ›´æ–°ç”¨æˆ· DELETE /api/v1/users/{id} // åˆ é™¤ç”¨æˆ· GET /api/v1/users/{id}/orders // è·å–ç”¨æˆ·çš„è®¢å• POST /api/v1/users/{id}/orders // ä¸ºç”¨æˆ·åˆ›å»ºè®¢å• // âŒ é¿å…çš„å‘½åæ–¹å¼ GET /api/v1/getAllUsers // åŠ¨è¯åœ¨URLä¸­ POST /api/v1/createUser // åŠ¨è¯åœ¨URLä¸­ GET /api/v1/users?getAll=1 // åŠ¨ä½œå‚æ•°åŒ– èµ„æºå…³ç³»è¡¨è¾¾ 1 2 3 4 5 6 7 8 9 10 11 // ç”¨æˆ·ä¸è®¢å•çš„å…³ç³» GET /api/v1/users/{userId}/orders // ç”¨æˆ·çš„è®¢å• GET /api/v1/orders/{orderId}/user // è®¢å•çš„å½’å±ç”¨æˆ· GET /api/v1/users/{userId}/orders/{orderId} // ç‰¹å®šç”¨æˆ·çš„ç‰¹å®šè®¢å• // åµŒå¥—èµ„æºçš„é™åˆ¶ // âœ… æ¨è GET /api/v1/orders?userId={userId} // é€šè¿‡å‚æ•°è¿‡æ»¤ // âŒ é¿å…è¿‡æ·±çš„åµŒå¥— // GET /api/v1/users/{userId}/orders/{orderId}/items/{itemId} 2. HTTPæ–¹æ³•çš„æ­£ç¡®ä½¿ç”¨ ç†è§£å¹¶æ­£ç¡®ä½¿ç”¨HTTPæ–¹æ³•æ˜¯RESTful APIçš„åŸºç¡€ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 // GETæ–¹æ³• - è·å–èµ„æº GET /api/v1/users GET /api/v1/users/{id} // POSTæ–¹æ³• - åˆ›å»ºèµ„æº POST /api/v1/users // è¯·æ±‚ä½“ï¼š{ \u0026#34;name\u0026#34;: \u0026#34;å¼ ä¸‰\u0026#34;, \u0026#34;email\u0026#34;: \u0026#34;zhangsan@example.com\u0026#34; } // PUTæ–¹æ³• - å®Œæ•´æ›´æ–°èµ„æº PUT /api/v1/users/{id} // è¯·æ±‚ä½“ï¼š{ \u0026#34;name\u0026#34;: \u0026#34;æå››\u0026#34;, \u0026#34;email\u0026#34;: \u0026#34;lisi@example.com\u0026#34;, \u0026#34;age\u0026#34;: 30 } // PATCHæ–¹æ³• - éƒ¨åˆ†æ›´æ–°èµ„æº PATCH /api/v1/users/{id} // è¯·æ±‚ä½“ï¼š{ \u0026#34;email\u0026#34;: \u0026#34;newemail@example.com\u0026#34; } // DELETEæ–¹æ³• - åˆ é™¤èµ„æº DELETE /api/v1/users/{id} // ç‰¹æ®Šæ“ä½œä½¿ç”¨POST POST /api/v1/users/{id}/activate // æ¿€æ´»ç”¨æˆ· POST /api/v1/orders/{id}/cancel // å–æ¶ˆè®¢å• POST /api/v1/files/{id}/share // åˆ†äº«æ–‡ä»¶ å¹‚ç­‰æ€§è€ƒè™‘ 1 2 3 4 5 6 7 8 9 10 11 12 13 // å¹‚ç­‰æ“ä½œï¼šå¤šæ¬¡æ‰§è¡Œç»“æœç›¸åŒ GET /api/v1/users/{id} // âœ… å¹‚ç­‰ PUT /api/v1/users/{id} // âœ… å¹‚ç­‰ DELETE /api/v1/users/{id} // âœ… å¹‚ç­‰ // éå¹‚ç­‰æ“ä½œï¼šæ¯æ¬¡æ‰§è¡Œå¯èƒ½äº§ç”Ÿä¸åŒç»“æœ POST /api/v1/users // âŒ éå¹‚ç­‰ï¼ˆåˆ›å»ºå¤šä¸ªç”¨æˆ·ï¼‰ POST /api/v1/orders/{id}/pay // âŒ éå¹‚ç­‰ï¼ˆå¤šæ¬¡ä»˜æ¬¾ï¼‰ // è®¾è®¡å¹‚ç­‰çš„POSTæ“ä½œ POST /api/v1/users/{id}/activation-token // è¯·æ±‚ä½“ï¼š{ \u0026#34;token\u0026#34;: \u0026#34;abc123\u0026#34; } // æ— è®ºè°ƒç”¨å¤šå°‘æ¬¡ï¼Œç»“æœéƒ½æ˜¯æ¿€æ´»ç”¨æˆ·ä¸€æ¬¡ 3. HTTPçŠ¶æ€ç çš„æœ€ä½³å®è·µ åˆç†ä½¿ç”¨HTTPçŠ¶æ€ç èƒ½å¤Ÿæ¸…æ™°ä¼ è¾¾APIå“åº”çš„å«ä¹‰ï¼š\næˆåŠŸçŠ¶æ€ç  1 2 3 4 5 6 7 8 9 10 11 12 // 200 OK - è¯·æ±‚æˆåŠŸ GET /api/v1/users/{id} // è¿”å›ï¼š200 + ç”¨æˆ·æ•°æ® // 201 Created - èµ„æºåˆ›å»ºæˆåŠŸ POST /api/v1/users // è¿”å›ï¼š201 + æ–°ç”¨æˆ·æ•°æ® + Locationå¤´ // 202 Accepted - è¯·æ±‚å·²æ¥å—ï¼Œæ­£åœ¨å¤„ç† POST /api/v1/data-import // è¿”å›ï¼š202 + ä»»åŠ¡ID // 204 No Content - æ“ä½œæˆåŠŸï¼Œæ— è¿”å›å†…å®¹ DELETE /api/v1/users/{id} // è¿”å›ï¼š204 PUT /api/v1/users/{id}/profile // è¿”å›ï¼š204 å®¢æˆ·ç«¯é”™è¯¯çŠ¶æ€ç  1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 // 400 Bad Request - è¯·æ±‚å‚æ•°é”™è¯¯ POST /api/v1/users // è¯·æ±‚ä½“ï¼š{ \u0026#34;email\u0026#34;: \u0026#34;invalid-email\u0026#34; } // è¿”å›ï¼š400 + { \u0026#34;error\u0026#34;: \u0026#34;é‚®ç®±æ ¼å¼ä¸æ­£ç¡®\u0026#34; } // 401 Unauthorized - æœªè®¤è¯ GET /api/v1/profile // è¿”å›ï¼š401 + { \u0026#34;error\u0026#34;: \u0026#34;è¯·å…ˆç™»å½•\u0026#34; } // 403 Forbidden - æ— æƒé™ DELETE /api/v1/admin/users/{id} // è¿”å›ï¼š403 + { \u0026#34;error\u0026#34;: \u0026#34;æƒé™ä¸è¶³\u0026#34; } // 404 Not Found - èµ„æºä¸å­˜åœ¨ GET /api/v1/users/{nonexistentId} // è¿”å›ï¼š404 + { \u0026#34;error\u0026#34;: \u0026#34;ç”¨æˆ·ä¸å­˜åœ¨\u0026#34; } // 409 Conflict - èµ„æºå†²çª POST /api/v1/users // è¯·æ±‚ä½“ï¼š{ \u0026#34;email\u0026#34;: \u0026#34;existing@example.com\u0026#34; } // è¿”å›ï¼š409 + { \u0026#34;error\u0026#34;: \u0026#34;é‚®ç®±å·²è¢«ä½¿ç”¨\u0026#34; } // 422 Unprocessable Entity - è¯·æ±‚æ ¼å¼æ­£ç¡®ä½†è¯­ä¹‰é”™è¯¯ POST /api/v1/orders // è¯·æ±‚ä½“ï¼š{ \u0026#34;items\u0026#34;: [] } // è¿”å›ï¼š422 + { \u0026#34;error\u0026#34;: \u0026#34;è®¢å•å•†å“ä¸èƒ½ä¸ºç©º\u0026#34; } æœåŠ¡å™¨é”™è¯¯çŠ¶æ€ç  1 2 3 4 5 6 // 500 Internal Server Error - æœåŠ¡å™¨å†…éƒ¨é”™è¯¯ // è¿”å›ï¼š500 + { \u0026#34;error\u0026#34;: \u0026#34;æœåŠ¡å™¨å†…éƒ¨é”™è¯¯\u0026#34;, \u0026#34;requestId\u0026#34;: \u0026#34;uuid\u0026#34; } // 502 Bad Gateway - ç½‘å…³é”™è¯¯ // 503 Service Unavailable - æœåŠ¡ä¸å¯ç”¨ // 504 Gateway Timeout - ç½‘å…³è¶…æ—¶ 4. APIç‰ˆæœ¬ç®¡ç† è‰¯å¥½çš„ç‰ˆæœ¬ç®¡ç†ç­–ç•¥ç¡®ä¿APIçš„å‘åå…¼å®¹æ€§ï¼š\nURLç‰ˆæœ¬æ§åˆ¶ 1 2 3 4 5 6 7 // æ¨èï¼šURLè·¯å¾„ç‰ˆæœ¬æ§åˆ¶ GET /api/v1/users GET /api/v2/users // ç‰ˆæœ¬è¿ç§»ç­–ç•¥ // v1: GET /api/v1/users (ç®€å•ç”¨æˆ·åˆ—è¡¨) // v2: GET /api/v2/users (åŒ…å«è¯¦ç»†ä¿¡æ¯çš„ç”¨æˆ·åˆ—è¡¨) è¯·æ±‚å¤´ç‰ˆæœ¬æ§åˆ¶ 1 2 3 4 5 6 7 8 9 // è¯·æ±‚å¤´ç‰ˆæœ¬æ§åˆ¶ GET /api/users Headers: Accept: application/vnd.myapi.v1+json // ä¼˜å…ˆçº§ç­–ç•¥ // 1. è¯·æ±‚å¤´ç‰ˆæœ¬ // 2. URLè·¯å¾„ç‰ˆæœ¬ // 3. æŸ¥è¯¢å‚æ•°ç‰ˆæœ¬ ç‰ˆæœ¬å…¼å®¹æ€§ç­–ç•¥ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 // å‘åå…¼å®¹çš„å­—æ®µæ·»åŠ  // v1 å“åº” { \u0026#34;id\u0026#34;: 1, \u0026#34;name\u0026#34;: \u0026#34;å¼ ä¸‰\u0026#34; } // v2 å“åº”ï¼ˆå‘åå…¼å®¹ï¼‰ { \u0026#34;id\u0026#34;: 1, \u0026#34;name\u0026#34;: \u0026#34;å¼ ä¸‰\u0026#34;, \u0026#34;firstName\u0026#34;: \u0026#34;å¼ \u0026#34;, // æ–°å­—æ®µ \u0026#34;lastName\u0026#34;: \u0026#34;ä¸‰\u0026#34;, // æ–°å­—æ®µ \u0026#34;avatar\u0026#34;: \u0026#34;http://...\u0026#34; // æ–°å­—æ®µ } // åºŸå¼ƒå­—æ®µçš„å¤„ç† { \u0026#34;id\u0026#34;: 1, \u0026#34;name\u0026#34;: \u0026#34;å¼ ä¸‰\u0026#34;, \u0026#34;email\u0026#34;: \u0026#34;zhangsan@example.com\u0026#34;, \u0026#34;age\u0026#34;: 30, \u0026#34;legacyField\u0026#34;: \u0026#34;deprecated\u0026#34;, // æ ‡è®°ä¸ºåºŸå¼ƒ \u0026#34;_deprecated\u0026#34;: [\u0026#34;legacyField\u0026#34;] // æ˜ç¡®æ ‡è®°åºŸå¼ƒå­—æ®µ } 5. åˆ†é¡µã€è¿‡æ»¤å’Œæ’åº æä¾›çµæ´»çš„æ•°æ®æŸ¥è¯¢æœºåˆ¶ï¼š\nåˆ†é¡µå®ç° 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 // åŸºç¡€åˆ†é¡µ GET /api/v1/users?page=1\u0026amp;limit=20 // å“åº”ç»“æ„ { \u0026#34;data\u0026#34;: [...], \u0026#34;pagination\u0026#34;: { \u0026#34;page\u0026#34;: 1, \u0026#34;limit\u0026#34;: 20, \u0026#34;total\u0026#34;: 150, \u0026#34;totalPages\u0026#34;: 8, \u0026#34;hasNext\u0026#34;: true, \u0026#34;hasPrev\u0026#34;: false } } // åŸºäºæ¸¸æ ‡çš„åˆ†é¡µï¼ˆé€‚åˆå¤§æ•°æ®é›†ï¼‰ GET /api/v1/users?cursor=abc123\u0026amp;limit=20 // å“åº”ç»“æ„ { \u0026#34;data\u0026#34;: [...], \u0026#34;pagination\u0026#34;: { \u0026#34;nextCursor\u0026#34;: \u0026#34;def456\u0026#34;, \u0026#34;hasNext\u0026#34;: true, \u0026#34;limit\u0026#34;: 20 } } è¿‡æ»¤å’Œæœç´¢ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 // åŸºç¡€è¿‡æ»¤ GET /api/v1/users?status=active\u0026amp;role=admin // æ—¥æœŸèŒƒå›´è¿‡æ»¤ GET /api/v1/orders?createdAfter=2024-01-01\u0026amp;createdBefore=2024-12-31 // æ•°ç»„è¿‡æ»¤ GET /api/v1/products?tags=electronics,premium // å…¨æ–‡æœç´¢ GET /api/v1/users?q=zhangsan GET /api/v1/products?search=iPhone // å¤æ‚è¿‡æ»¤ï¼ˆPOSTæ–¹å¼ï¼‰ POST /api/v1/users/search // è¯·æ±‚ä½“ { \u0026#34;filters\u0026#34;: { \u0026#34;status\u0026#34;: \u0026#34;active\u0026#34;, \u0026#34;age\u0026#34;: { \u0026#34;min\u0026#34;: 18, \u0026#34;max\u0026#34;: 65 }, \u0026#34;tags\u0026#34;: [\u0026#34;developer\u0026#34;, \u0026#34;javascript\u0026#34;], \u0026#34;createdAfter\u0026#34;: \u0026#34;2024-01-01\u0026#34; }, \u0026#34;sort\u0026#34;: [ { \u0026#34;field\u0026#34;: \u0026#34;createdAt\u0026#34;, \u0026#34;order\u0026#34;: \u0026#34;desc\u0026#34; }, { \u0026#34;field\u0026#34;: \u0026#34;name\u0026#34;, \u0026#34;order\u0026#34;: \u0026#34;asc\u0026#34; } ], \u0026#34;pagination\u0026#34;: { \u0026#34;page\u0026#34;: 1, \u0026#34;limit\u0026#34;: 20 } } æ’åºåŠŸèƒ½ 1 2 3 4 5 6 7 8 9 // å•å­—æ®µæ’åº GET /api/v1/users?sort=createdAt GET /api/v1/users?sort=createdAt:desc // å¤šå­—æ®µæ’åº GET /api/v1/users?sort=createdAt:desc,name:asc // æ’åºå‚æ•°æ ‡å‡†åŒ– // ?sort=-createdAt,name // ç­‰åŒäº createdAt:desc,name:asc 6. è¯·æ±‚å’Œå“åº”æ ¼å¼è®¾è®¡ ç»Ÿä¸€çš„è¯·æ±‚å“åº”æ ¼å¼æé«˜APIçš„ä¸€è‡´æ€§ï¼š\nè¯·æ±‚æ ¼å¼ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 // åˆ›å»ºèµ„æºè¯·æ±‚ POST /api/v1/users Content-Type: application/json { \u0026#34;name\u0026#34;: \u0026#34;å¼ ä¸‰\u0026#34;, \u0026#34;email\u0026#34;: \u0026#34;zhangsan@example.com\u0026#34;, \u0026#34;profile\u0026#34;: { \u0026#34;age\u0026#34;: 30, \u0026#34;city\u0026#34;: \u0026#34;åŒ—äº¬\u0026#34; }, \u0026#34;preferences\u0026#34;: { \u0026#34;language\u0026#34;: \u0026#34;zh-CN\u0026#34;, \u0026#34;timezone\u0026#34;: \u0026#34;Asia/Shanghai\u0026#34; } } // æ‰¹é‡æ“ä½œè¯·æ±‚ POST /api/v1/users/batch Content-Type: application/json { \u0026#34;operation\u0026#34;: \u0026#34;create\u0026#34;, \u0026#34;items\u0026#34;: [ { \u0026#34;name\u0026#34;: \u0026#34;å¼ ä¸‰\u0026#34;, \u0026#34;email\u0026#34;: \u0026#34;zhangsan@example.com\u0026#34; }, { \u0026#34;name\u0026#34;: \u0026#34;æå››\u0026#34;, \u0026#34;email\u0026#34;: \u0026#34;lisi@example.com\u0026#34; } ] } å“åº”æ ¼å¼ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 // æˆåŠŸå“åº”æ ¼å¼ { \u0026#34;success\u0026#34;: true, \u0026#34;data\u0026#34;: { \u0026#34;id\u0026#34;: 1, \u0026#34;name\u0026#34;: \u0026#34;å¼ ä¸‰\u0026#34;, \u0026#34;email\u0026#34;: \u0026#34;zhangsan@example.com\u0026#34;, \u0026#34;createdAt\u0026#34;: \u0026#34;2024-12-16T10:00:00Z\u0026#34; }, \u0026#34;meta\u0026#34;: { \u0026#34;timestamp\u0026#34;: \u0026#34;2024-12-16T10:00:00Z\u0026#34;, \u0026#34;requestId\u0026#34;: \u0026#34;req_abc123\u0026#34; } } // åˆ—è¡¨å“åº”æ ¼å¼ { \u0026#34;success\u0026#34;: true, \u0026#34;data\u0026#34;: [ { \u0026#34;id\u0026#34;: 1, \u0026#34;name\u0026#34;: \u0026#34;å¼ ä¸‰\u0026#34; }, { \u0026#34;id\u0026#34;: 2, \u0026#34;name\u0026#34;: \u0026#34;æå››\u0026#34; } ], \u0026#34;pagination\u0026#34;: { \u0026#34;page\u0026#34;: 1, \u0026#34;limit\u0026#34;: 20, \u0026#34;total\u0026#34;: 100 }, \u0026#34;meta\u0026#34;: { \u0026#34;timestamp\u0026#34;: \u0026#34;2024-12-16T10:00:00Z\u0026#34; } } // é”™è¯¯å“åº”æ ¼å¼ { \u0026#34;success\u0026#34;: false, \u0026#34;error\u0026#34;: { \u0026#34;code\u0026#34;: \u0026#34;VALIDATION_ERROR\u0026#34;, \u0026#34;message\u0026#34;: \u0026#34;è¯·æ±‚å‚æ•°éªŒè¯å¤±è´¥\u0026#34;, \u0026#34;details\u0026#34;: [ { \u0026#34;field\u0026#34;: \u0026#34;email\u0026#34;, \u0026#34;message\u0026#34;: \u0026#34;é‚®ç®±æ ¼å¼ä¸æ­£ç¡®\u0026#34; }, { \u0026#34;field\u0026#34;: \u0026#34;age\u0026#34;, \u0026#34;message\u0026#34;: \u0026#34;å¹´é¾„å¿…é¡»åœ¨1-120ä¹‹é—´\u0026#34; } ] }, \u0026#34;meta\u0026#34;: { \u0026#34;timestamp\u0026#34;: \u0026#34;2024-12-16T10:00:00Z\u0026#34;, \u0026#34;requestId\u0026#34;: \u0026#34;req_def456\u0026#34; } } 7. å®‰å…¨æ€§è®¾è®¡ APIå®‰å…¨æ€§æ˜¯ä¸å¯å¿½è§†çš„é‡è¦æ–¹é¢ï¼š\nè®¤è¯æœºåˆ¶ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 // JWT Bearer Tokenè®¤è¯ GET /api/v1/users/profile Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9... // API Keyè®¤è¯ GET /api/v1/data X-API-Key: abc123def456 // OAuth2è®¤è¯ GET /api/v1/users Authorization: Bearer \u0026lt;access_token\u0026gt; // å¤šå› ç´ è®¤è¯ POST /api/v1/auth/mfa // è¯·æ±‚ä½“ { \u0026#34;userId\u0026#34;: \u0026#34;user123\u0026#34;, \u0026#34;code\u0026#34;: \u0026#34;123456\u0026#34;, \u0026#34;backupCode\u0026#34;: null } æƒé™æ§åˆ¶ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 // åŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶ï¼ˆRBACï¼‰ // ç”¨æˆ·è§’è‰²ï¼šadmin, manager, user // èµ„æºæƒé™ï¼šread, write, delete // æƒé™æ£€æŸ¥ä¸­é—´ä»¶ç¤ºä¾‹ function checkPermission(resource, action) { return (req, res, next) =\u0026gt; { const user = req.user; const hasPermission = user.permissions.some( perm =\u0026gt; perm.resource === resource \u0026amp;\u0026amp; perm.actions.includes(action) ); if (!hasPermission) { return res.status(403).json({ success: false, error: { code: \u0026#39;INSUFFICIENT_PERMISSIONS\u0026#39;, message: \u0026#39;æƒé™ä¸è¶³\u0026#39; } }); } next(); }; } // ä½¿ç”¨ç¤ºä¾‹ app.delete(\u0026#39;/api/v1/users/:id\u0026#39;, authenticate, checkPermission(\u0026#39;user\u0026#39;, \u0026#39;delete\u0026#39;), deleteUser ); å®‰å…¨å¤´éƒ¨ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 // å®‰å…¨å“åº”å¤´è®¾ç½® app.use((req, res, next) =\u0026gt; { // HTTPSå¼ºåˆ¶ res.setHeader(\u0026#39;Strict-Transport-Security\u0026#39;, \u0026#39;max-age=31536000; includeSubDomains\u0026#39;); // é˜²æ­¢XSSæ”»å‡» res.setHeader(\u0026#39;X-XSS-Protection\u0026#39;, \u0026#39;1; mode=block\u0026#39;); // é˜²æ­¢MIMEç±»å‹å—…æ¢ res.setHeader(\u0026#39;X-Content-Type-Options\u0026#39;, \u0026#39;nosniff\u0026#39;); // æ§åˆ¶iframeåµŒå…¥ res.setHeader(\u0026#39;X-Frame-Options\u0026#39;, \u0026#39;DENY\u0026#39;); // å†…å®¹å®‰å…¨ç­–ç•¥ res.setHeader(\u0026#39;Content-Security-Policy\u0026#39;, \u0026#34;default-src \u0026#39;self\u0026#39;\u0026#34;); // CORSé…ç½® res.setHeader(\u0026#39;Access-Control-Allow-Origin\u0026#39;, \u0026#39;https://trusted-domain.com\u0026#39;); res.setHeader(\u0026#39;Access-Control-Allow-Methods\u0026#39;, \u0026#39;GET, POST, PUT, DELETE, OPTIONS\u0026#39;); res.setHeader(\u0026#39;Access-Control-Allow-Headers\u0026#39;, \u0026#39;Content-Type, Authorization\u0026#39;); next(); }); 8. é”™è¯¯å¤„ç†å’Œæ—¥å¿— å®Œå–„çš„é”™è¯¯å¤„ç†å’Œæ—¥å¿—è®°å½•ï¼š\nå…¨å±€é”™è¯¯å¤„ç† 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 // Express.jså…¨å±€é”™è¯¯å¤„ç†ä¸­é—´ä»¶ app.use((err, req, res, next) =\u0026gt; { // è®°å½•é”™è¯¯æ—¥å¿— logger.error(\u0026#39;API Error\u0026#39;, { error: err.message, stack: err.stack, url: req.url, method: req.method, ip: req.ip, userAgent: req.get(\u0026#39;User-Agent\u0026#39;), requestId: req.id }); // é”™è¯¯å“åº” const errorResponse = { success: false, error: { code: err.code || \u0026#39;INTERNAL_ERROR\u0026#39;, message: err.message || \u0026#39;æœåŠ¡å™¨å†…éƒ¨é”™è¯¯\u0026#39; }, meta: { timestamp: new Date().toISOString(), requestId: req.id } }; // å¼€å‘ç¯å¢ƒè¿”å›å †æ ˆä¿¡æ¯ if (process.env.NODE_ENV === \u0026#39;development\u0026#39;) { errorResponse.error.stack = err.stack; } res.status(err.status || 500).json(errorResponse); }); è¯·æ±‚æ—¥å¿— 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 // è¯·æ±‚æ—¥å¿—ä¸­é—´ä»¶ app.use((req, res, next) =\u0026gt; { const requestId = generateRequestId(); req.id = requestId; const startTime = Date.now(); // è®°å½•è¯·æ±‚å¼€å§‹ logger.info(\u0026#39;Request started\u0026#39;, { requestId, method: req.method, url: req.url, ip: req.ip, userAgent: req.get(\u0026#39;User-Agent\u0026#39;), timestamp: new Date().toISOString() }); // å“åº”ç»“æŸæ—¶è®°å½•æ—¥å¿— res.on(\u0026#39;finish\u0026#39;, () =\u0026gt; { const duration = Date.now() - startTime; logger.info(\u0026#39;Request completed\u0026#39;, { requestId, method: req.method, url: req.url, statusCode: res.statusCode, duration: `${duration}ms`, contentLength: res.get(\u0026#39;Content-Length\u0026#39;), timestamp: new Date().toISOString() }); }); next(); }); 9. APIæ–‡æ¡£å’Œæµ‹è¯• å®Œå–„çš„æ–‡æ¡£å’Œæµ‹è¯•ç¡®ä¿APIè´¨é‡ï¼š\nOpenAPIæ–‡æ¡£è§„èŒƒ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 # openapi.yaml openapi: 3.0.3 info: title: ç”¨æˆ·ç®¡ç†API description: RESTful API for user management version: 1.0.0 contact: name: API Support email: api-support@example.com servers: - url: https://api.example.com/v1 description: ç”Ÿäº§ç¯å¢ƒ - url: https://staging-api.example.com/v1 description: æµ‹è¯•ç¯å¢ƒ paths: /users: get: summary: è·å–ç”¨æˆ·åˆ—è¡¨ description: åˆ†é¡µè·å–ç”¨æˆ·åˆ—è¡¨ parameters: - name: page in: query schema: type: integer default: 1 - name: limit in: query schema: type: integer default: 20 responses: \u0026#39;200\u0026#39;: description: æˆåŠŸè¿”å›ç”¨æˆ·åˆ—è¡¨ content: application/json: schema: type: object properties: success: type: boolean data: type: array items: $ref: \u0026#39;#/components/schemas/User\u0026#39; pagination: $ref: \u0026#39;#/components/schemas/Pagination\u0026#39; post: summary: åˆ›å»ºç”¨æˆ· requestBody: required: true content: application/json: schema: $ref: \u0026#39;#/components/schemas/CreateUserRequest\u0026#39; responses: \u0026#39;201\u0026#39;: description: ç”¨æˆ·åˆ›å»ºæˆåŠŸ content: application/json: schema: type: object properties: success: type: boolean data: $ref: \u0026#39;#/components/schemas/User\u0026#39; components: schemas: User: type: object required: - id - name - email properties: id: type: integer example: 1 name: type: string example: \u0026#34;å¼ ä¸‰\u0026#34; email: type: string format: email example: \u0026#34;zhangsan@example.com\u0026#34; createdAt: type: string format: date-time example: \u0026#34;2024-12-16T10:00:00Z\u0026#34; CreateUserRequest: type: object required: - name - email properties: name: type: string example: \u0026#34;å¼ ä¸‰\u0026#34; email: type: string format: email example: \u0026#34;zhangsan@example.com\u0026#34; age: type: integer minimum: 1 maximum: 120 example: 30 Pagination: type: object properties: page: type: integer example: 1 limit: type: integer example: 20 total: type: integer example: 100 totalPages: type: integer example: 5 APIæµ‹è¯• 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 // Jest + Supertest APIæµ‹è¯•ç¤ºä¾‹ const request = require(\u0026#39;supertest\u0026#39;); const app = require(\u0026#39;../app\u0026#39;); describe(\u0026#39;User API\u0026#39;, () =\u0026gt; { describe(\u0026#39;GET /api/v1/users\u0026#39;, () =\u0026gt; { it(\u0026#39;should return users list\u0026#39;, async () =\u0026gt; { const response = await request(app) .get(\u0026#39;/api/v1/users\u0026#39;) .expect(200); expect(response.body.success).toBe(true); expect(response.body.data).toBeInstanceOf(Array); expect(response.body.pagination).toBeDefined(); }); it(\u0026#39;should support pagination\u0026#39;, async () =\u0026gt; { const response = await request(app) .get(\u0026#39;/api/v1/users?page=1\u0026amp;limit=5\u0026#39;) .expect(200); expect(response.body.data).toHaveLength(5); expect(response.body.pagination.page).toBe(1); expect(response.body.pagination.limit).toBe(5); }); }); describe(\u0026#39;POST /api/v1/users\u0026#39;, () =\u0026gt; { it(\u0026#39;should create a new user\u0026#39;, async () =\u0026gt; { const userData = { name: \u0026#39;æµ‹è¯•ç”¨æˆ·\u0026#39;, email: \u0026#39;test@example.com\u0026#39;, age: 25 }; const response = await request(app) .post(\u0026#39;/api/v1/users\u0026#39;) .send(userData) .expect(201); expect(response.body.success).toBe(true); expect(response.body.data.name).toBe(userData.name); expect(response.body.data.email).toBe(userData.email); }); it(\u0026#39;should return validation error for invalid data\u0026#39;, async () =\u0026gt; { const invalidData = { name: \u0026#39;\u0026#39;, email: \u0026#39;invalid-email\u0026#39;, age: 150 }; const response = await request(app) .post(\u0026#39;/api/v1/users\u0026#39;) .send(invalidData) .expect(422); expect(response.body.success).toBe(false); expect(response.body.error.code).toBe(\u0026#39;VALIDATION_ERROR\u0026#39;); expect(response.body.error.details).toBeInstanceOf(Array); }); }); }); 10. æ€§èƒ½ä¼˜åŒ– APIæ€§èƒ½ä¼˜åŒ–ç­–ç•¥ï¼š\nç¼“å­˜ç­–ç•¥ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 // Redisç¼“å­˜å®ç° const redis = require(\u0026#39;redis\u0026#39;); const client = redis.createClient(); const cacheMiddleware = (ttl = 300) =\u0026gt; { return async (req, res, next) =\u0026gt; { const key = `cache:${req.method}:${req.originalUrl}`; try { // å°è¯•ä»ç¼“å­˜è·å–æ•°æ® const cachedData = await client.get(key); if (cachedData) { return res.json(JSON.parse(cachedData)); } // ä¿®æ”¹res.jsonæ–¹æ³•ä»¥ç¼“å­˜å“åº” const originalJson = res.json; res.json = function(data) { // ç¼“å­˜å“åº”æ•°æ® client.setex(key, ttl, JSON.stringify(data)); return originalJson.call(this, data); }; next(); } catch (error) { next(); } }; }; // ä½¿ç”¨ç¼“å­˜ app.get(\u0026#39;/api/v1/users\u0026#39;, cacheMiddleware(600), getUsers); æ•°æ®åº“æŸ¥è¯¢ä¼˜åŒ– 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 // åˆ†é¡µæŸ¥è¯¢ä¼˜åŒ– async function getUsers(page = 1, limit = 20) { const offset = (page - 1) * limit; // ä½¿ç”¨ç´¢å¼•ä¼˜åŒ–çš„æŸ¥è¯¢ const query = ` SELECT u.id, u.name, u.email, u.created_at, p.avatar_url, p.bio FROM users u LEFT JOIN user_profiles p ON u.id = p.user_id WHERE u.status = \u0026#39;active\u0026#39; ORDER BY u.created_at DESC LIMIT ? OFFSET ? `; // è®¡æ•°æŸ¥è¯¢ï¼ˆé¿å…COUNT(*)çš„æ€§èƒ½é—®é¢˜ï¼‰ const countQuery = ` SELECT COUNT(*) as total FROM users u WHERE u.status = \u0026#39;active\u0026#39; `; const [users, countResult] = await Promise.all([ db.query(query, [limit, offset]), db.query(countQuery) ]); return { data: users, pagination: { page, limit, total: countResult[0].total, totalPages: Math.ceil(countResult[0].total / limit) } }; } å“åº”å‹ç¼© 1 2 3 4 5 6 7 8 9 10 11 12 13 // Gzipå‹ç¼©ä¸­é—´ä»¶ const compression = require(\u0026#39;compression\u0026#39;); app.use(compression({ filter: (req, res) =\u0026gt; { // åªå‹ç¼©æ–‡æœ¬å†…å®¹ if (req.headers[\u0026#39;x-no-compression\u0026#39;]) { return false; } return compression.filter(req, res); }, threshold: 1024 // åªå‹ç¼©å¤§äº1KBçš„å“åº” })); æ€»ç»“ RESTful APIè®¾è®¡éœ€è¦è€ƒè™‘å¤šä¸ªæ–¹é¢ï¼ŒåŒ…æ‹¬èµ„æºå®šä¹‰ã€HTTPæ–¹æ³•ä½¿ç”¨ã€çŠ¶æ€ç é€‰æ‹©ã€ç‰ˆæœ¬ç®¡ç†ç­‰ã€‚é€šè¿‡éµå¾ªè¿™äº›æœ€ä½³å®è·µï¼Œå¯ä»¥æ„å»ºå‡ºæ¸…æ™°ã€å¯ç»´æŠ¤ã€é«˜æ€§èƒ½çš„APIæ¥å£ã€‚\nè®°ä½ï¼ŒAPIè®¾è®¡æ˜¯ä¸€ä¸ªè¿­ä»£çš„è¿‡ç¨‹ï¼Œéœ€è¦æ ¹æ®å®é™…éœ€æ±‚å’Œç”¨æˆ·åé¦ˆä¸æ–­ä¼˜åŒ–ã€‚è‰¯å¥½çš„APIè®¾è®¡ä¸ä»…èƒ½å¤Ÿæé«˜å¼€å‘æ•ˆç‡ï¼Œè¿˜èƒ½ä¸ºç³»ç»Ÿçš„é•¿æœŸå‘å±•å¥ å®šåšå®çš„åŸºç¡€ã€‚\nç›¸å…³å·¥å…·æ¨èï¼š\nAPIæµ‹è¯•å·¥å…· JSONæ ¼å¼åŒ–å·¥å…· ","permalink":"/blog/articles/api-design-principles/","summary":"æ·±å…¥æ¢è®¨RESTful APIçš„æ ¸å¿ƒè®¾è®¡åŸåˆ™ï¼ŒåŒ…æ‹¬èµ„æºå®šä¹‰ã€HTTPæ–¹æ³•ä½¿ç”¨ã€çŠ¶æ€ç é€‰æ‹©ã€ç‰ˆæœ¬ç®¡ç†ç­‰å…³é”®æŠ€æœ¯ï¼Œå¸®åŠ©å¼€å‘è€…è®¾è®¡å‡ºæ¸…æ™°ã€å¯ç»´æŠ¤çš„APIæ¥å£ã€‚","title":"RESTful APIè®¾è®¡åŸåˆ™ï¼šæ„å»ºå¯æ‰©å±•çš„WebæœåŠ¡æ¥å£"},{"content":"Visual Studio Codeå› å…¶å¼ºå¤§çš„æ‰©å±•ç”Ÿæ€ç³»ç»Ÿè€Œæ·±å—å¼€å‘è€…å–œçˆ±ã€‚é€šè¿‡åˆ›å»ºè‡ªå®šä¹‰æ‰©å±•ï¼Œå¯ä»¥è¿›ä¸€æ­¥æå‡å¼€å‘æ•ˆç‡ã€‚æœ¬æ–‡å°†è¯¦ç»†ä»‹ç»VS Codeæ‰©å±•å¼€å‘çš„å…¨è¿‡ç¨‹ã€‚\n1. å¼€å‘ç¯å¢ƒæ­å»º åŸºç¡€å·¥å…·å®‰è£… 1 2 3 4 5 6 7 8 9 10 11 # å®‰è£…Node.js (æ¨èv16+) node --version # å®‰è£…Yeomanå’ŒVS Codeæ‰©å±•ç”Ÿæˆå™¨ npm install -g yo generator-code # å®‰è£…TypeScriptç¼–è¯‘å™¨ npm install -g typescript # å®‰è£…vsce (VS Codeæ‰©å±•æ‰“åŒ…å·¥å…·) npm install -g vsce åˆ›å»ºæ‰©å±•é¡¹ç›® 1 2 3 4 5 6 7 8 9 10 11 12 # ä½¿ç”¨ç”Ÿæˆå™¨åˆ›å»ºæ–°æ‰©å±• yo code # é€‰æ‹©æ‰©å±•ç±»å‹ï¼š # ? What type of extension do you want to create? # â¯ New Extension (TypeScript) # New Extension (JavaScript) # New Color Theme # New Language Support # New Code Snippets # New Keymap # New Extension Pack ç”Ÿæˆçš„é¡¹ç›®ç»“æ„ï¼š\nmy-extension/ â”œâ”€â”€ .vscode/ â”‚ â”œâ”€â”€ launch.json # è°ƒè¯•é…ç½® â”‚ â”œâ”€â”€ tasks.json # æ„å»ºä»»åŠ¡ â”‚ â””â”€â”€ settings.json # VS Codeè®¾ç½® â”œâ”€â”€ src/ â”‚ â”œâ”€â”€ extension.ts # ä¸»æ‰©å±•æ–‡ä»¶ â”‚ â””â”€â”€ test/ â”‚ â””â”€â”€ extension.test.ts # æµ‹è¯•æ–‡ä»¶ â”œâ”€â”€ package.json # æ‰©å±•é…ç½® â”œâ”€â”€ tsconfig.json # TypeScripté…ç½® â”œâ”€â”€ README.md # æ‰©å±•è¯´æ˜ â””â”€â”€ CHANGELOG.md # æ›´æ–°æ—¥å¿— 2. æ‰©å±•é…ç½®æ–‡ä»¶ package.jsonè¯¦è§£ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 { \u0026#34;name\u0026#34;: \u0026#34;my-awesome-extension\u0026#34;, \u0026#34;displayName\u0026#34;: \u0026#34;My Awesome Extension\u0026#34;, \u0026#34;description\u0026#34;: \u0026#34;A helpful description of what this extension does\u0026#34;, \u0026#34;version\u0026#34;: \u0026#34;0.0.1\u0026#34;, \u0026#34;engines\u0026#34;: { \u0026#34;vscode\u0026#34;: \u0026#34;^1.75.0\u0026#34; }, \u0026#34;categories\u0026#34;: [ \u0026#34;Other\u0026#34;, \u0026#34;Snippets\u0026#34;, \u0026#34;Linters\u0026#34; ], \u0026#34;activationEvents\u0026#34;: [ \u0026#34;onCommand:extension.myCommand\u0026#34;, \u0026#34;onLanguage:javascript\u0026#34; ], \u0026#34;main\u0026#34;: \u0026#34;./out/extension.js\u0026#34;, \u0026#34;contributes\u0026#34;: { \u0026#34;commands\u0026#34;: [ { \u0026#34;command\u0026#34;: \u0026#34;extension.myCommand\u0026#34;, \u0026#34;title\u0026#34;: \u0026#34;My Command\u0026#34;, \u0026#34;category\u0026#34;: \u0026#34;My Extension\u0026#34; } ], \u0026#34;keybindings\u0026#34;: [ { \u0026#34;command\u0026#34;: \u0026#34;extension.myCommand\u0026#34;, \u0026#34;key\u0026#34;: \u0026#34;ctrl+shift+u\u0026#34;, \u0026#34;mac\u0026#34;: \u0026#34;cmd+shift+u\u0026#34; } ], \u0026#34;menus\u0026#34;: { \u0026#34;editor/context\u0026#34;: [ { \u0026#34;command\u0026#34;: \u0026#34;extension.myCommand\u0026#34;, \u0026#34;group\u0026#34;: \u0026#34;navigation\u0026#34; } ] }, \u0026#34;configuration\u0026#34;: { \u0026#34;title\u0026#34;: \u0026#34;My Extension\u0026#34;, \u0026#34;properties\u0026#34;: { \u0026#34;myExtension.enable\u0026#34;: { \u0026#34;type\u0026#34;: \u0026#34;boolean\u0026#34;, \u0026#34;default\u0026#34;: true, \u0026#34;description\u0026#34;: \u0026#34;Enable my extension\u0026#34; } } } }, \u0026#34;scripts\u0026#34;: { \u0026#34;vscode:prepublish\u0026#34;: \u0026#34;npm run compile\u0026#34;, \u0026#34;compile\u0026#34;: \u0026#34;tsc -p ./\u0026#34;, \u0026#34;watch\u0026#34;: \u0026#34;tsc -watch -p ./\u0026#34;, \u0026#34;pretest\u0026#34;: \u0026#34;npm run compile \u0026amp;\u0026amp; npm run lint\u0026#34;, \u0026#34;lint\u0026#34;: \u0026#34;eslint src --ext ts\u0026#34;, \u0026#34;test\u0026#34;: \u0026#34;node ./out/test/runTest.js\u0026#34; }, \u0026#34;devDependencies\u0026#34;: { \u0026#34;@types/vscode\u0026#34;: \u0026#34;^1.75.0\u0026#34;, \u0026#34;@types/mocha\u0026#34;: \u0026#34;^10.0.1\u0026#34;, \u0026#34;@types/node\u0026#34;: \u0026#34;16.x\u0026#34;, \u0026#34;typescript\u0026#34;: \u0026#34;^4.9.4\u0026#34;, \u0026#34;eslint\u0026#34;: \u0026#34;^8.28.0\u0026#34;, \u0026#34;@typescript-eslint/eslint-plugin\u0026#34;: \u0026#34;^5.45.0\u0026#34;, \u0026#34;@typescript-eslint/parser\u0026#34;: \u0026#34;^5.45.0\u0026#34;, \u0026#34;mocha\u0026#34;: \u0026#34;^10.1.0\u0026#34; }, \u0026#34;publisher\u0026#34;: \u0026#34;your-publisher-name\u0026#34; } TypeScripté…ç½® 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 { \u0026#34;compilerOptions\u0026#34;: { \u0026#34;module\u0026#34;: \u0026#34;commonjs\u0026#34;, \u0026#34;target\u0026#34;: \u0026#34;ES2020\u0026#34;, \u0026#34;outDir\u0026#34;: \u0026#34;out\u0026#34;, \u0026#34;lib\u0026#34;: [\u0026#34;ES2020\u0026#34;], \u0026#34;sourceMap\u0026#34;: true, \u0026#34;rootDir\u0026#34;: \u0026#34;src\u0026#34;, \u0026#34;strict\u0026#34;: true, \u0026#34;esModuleInterop\u0026#34;: true, \u0026#34;skipLibCheck\u0026#34;: true, \u0026#34;forceConsistentCasingInFileNames\u0026#34;: true }, \u0026#34;exclude\u0026#34;: [\u0026#34;node_modules\u0026#34;, \u0026#34;.vscode-test\u0026#34;] } 3. æ‰©å±•æ ¸å¿ƒAPI åŸºç¡€å‘½ä»¤æ³¨å†Œ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 // src/extension.ts import * as vscode from \u0026#39;vscode\u0026#39;; // æ¿€æ´»å‡½æ•° export function activate(context: vscode.ExtensionContext) { console.log(\u0026#39;Extension \u0026#34;my-extension\u0026#34; is now active!\u0026#39;); // æ³¨å†Œå‘½ä»¤ const disposable = vscode.commands.registerCommand( \u0026#39;extension.helloWorld\u0026#39;, () =\u0026gt; { vscode.window.showInformationMessage(\u0026#39;Hello World from My Extension!\u0026#39;); } ); context.subscriptions.push(disposable); // æ³¨å†Œå¤æ‚å‘½ä»¤ const advancedCommand = vscode.commands.registerCommand( \u0026#39;extension.openFile\u0026#39;, async (uri?: vscode.Uri) =\u0026gt; { if (uri) { const document = await vscode.workspace.openTextDocument(uri); await vscode.window.showTextDocument(document); } else { const fileUri = await vscode.window.showOpenDialog({ canSelectMany: false, openLabel: \u0026#39;Select a file to open\u0026#39; }); if (fileUri) { const document = await vscode.workspace.openTextDocument(fileUri[0]); await vscode.window.showTextDocument(document); } } } ); context.subscriptions.push(advancedCommand); } // åœç”¨å‡½æ•° export function deactivate() {} çŠ¶æ€æ å’ŒçŠ¶æ€é¡¹ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 // æ·»åŠ çŠ¶æ€æ é¡¹ const statusBarItem = vscode.window.createStatusBarItem( vscode.StatusBarAlignment.Right, 100 ); statusBarItem.text = \u0026#39;$(sync~spin) Loading...\u0026#39;; statusBarItem.tooltip = \u0026#39;My Extension Status\u0026#39;; statusBarItem.command = \u0026#39;extension.showStatus\u0026#39;; context.subscriptions.push(statusBarItem); // æ›´æ–°çŠ¶æ€æ  function updateStatus(text: string, tooltip?: string) { statusBarItem.text = text; if (tooltip) { statusBarItem.tooltip = tooltip; } } // å®šæ—¶æ›´æ–°çŠ¶æ€ let updateInterval: NodeJS.Timer; function startStatusUpdates() { updateInterval = setInterval(() =\u0026gt; { const time = new Date().toLocaleTimeString(); updateStatus(`$(clock) ${time}`, `å½“å‰æ—¶é—´: ${time}`); }, 1000); } // æ¸…ç†èµ„æº function stopStatusUpdates() { if (updateInterval) { clearInterval(updateInterval); } } è¾“å‡ºé€šé“ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 // åˆ›å»ºè¾“å‡ºé€šé“ const outputChannel = vscode.window.createOutputChannel( \u0026#39;My Extension\u0026#39;, { log: true } ); context.subscriptions.push(outputChannel); // å†™å…¥è¾“å‡º outputChannel.appendLine(\u0026#39;Extension started\u0026#39;); outputChannel.appendLine(`Timestamp: ${new Date().toISOString()}`); // æ˜¾ç¤ºè¾“å‡ºé€šé“ vscode.commands.registerCommand(\u0026#39;extension.showOutput\u0026#39;, () =\u0026gt; { outputChannel.show(); }); // ä¸åŒçº§åˆ«çš„æ—¥å¿— function log(level: \u0026#39;info\u0026#39; | \u0026#39;warn\u0026#39; | \u0026#39;error\u0026#39;, message: string) { const timestamp = new Date().toISOString(); const logMessage = `[${timestamp}] [${level.toUpperCase()}] ${message}`; outputChannel.appendLine(logMessage); if (level === \u0026#39;error\u0026#39;) { vscode.window.showErrorMessage(message); } else if (level === \u0026#39;warn\u0026#39;) { vscode.window.showWarningMessage(message); } } é…ç½®å’Œè®¾ç½® 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 // è·å–æ‰©å±•é…ç½® function getConfig\u0026lt;T\u0026gt;(key: string): T | undefined { const config = vscode.workspace.getConfiguration(\u0026#39;myExtension\u0026#39;); return config.get\u0026lt;T\u0026gt;(key); } // ç›‘å¬é…ç½®å˜åŒ– vscode.workspace.onDidChangeConfiguration(event =\u0026gt; { if (event.affectsConfiguration(\u0026#39;myExtension\u0026#39;)) { const newConfig = getConfig(\u0026#39;enable\u0026#39;); vscode.window.showInformationMessage( `Extension ${newConfig ? \u0026#39;enabled\u0026#39; : \u0026#39;disabled\u0026#39;}` ); } }); // è®¾ç½®é…ç½® function setConfig(key: string, value: any) { const config = vscode.workspace.getConfiguration(\u0026#39;myExtension\u0026#39;); return config.update(key, value, vscode.ConfigurationTarget.Global); } 4. ç¼–è¾‘å™¨åŠŸèƒ½æ‰©å±• æ–‡æ¡£ç¼–è¾‘å™¨ä¿®æ”¹ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 // æ³¨å†Œæ–‡æœ¬ç¼–è¾‘å™¨å‘½ä»¤ vscode.commands.registerCommand( \u0026#39;extension.insertCurrentTime\u0026#39;, () =\u0026gt; { const editor = vscode.window.activeTextEditor; if (editor) { const currentTime = new Date().toLocaleString(); editor.edit(editBuilder =\u0026gt; { const position = editor.selection.active; editBuilder.insert(position, currentTime); }); } } ); // æ–‡æ¡£å†…å®¹ä¿®æ”¹ vscode.commands.registerCommand( \u0026#39;extension.formatDocument\u0026#39;, async () =\u0026gt; { const editor = vscode.window.activeTextEditor; if (editor) { const document = editor.document; const fullRange = new vscode.Range( document.positionAt(0), document.positionAt(document.getText().length) ); const formattedText = formatCode(document.getText()); await editor.edit(editBuilder =\u0026gt; { editBuilder.replace(fullRange, formattedText); }); } } ); function formatCode(code: string): string { // ç®€å•çš„æ ¼å¼åŒ–é€»è¾‘ return code .split(\u0026#39;\\n\u0026#39;) .map(line =\u0026gt; line.trim()) .join(\u0026#39;\\n\u0026#39;); } è£…é¥°å™¨ï¼ˆDecorationsï¼‰ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 // åˆ›å»ºè£…é¥°ç±»å‹ const decorationType = vscode.window.createTextEditorDecorationType({ backgroundColor: new vscode.ThemeColor(\u0026#39;editor.wordHighlightBackground\u0026#39;), border: \u0026#39;1px solid\u0026#39;, borderColor: new vscode.ThemeColor(\u0026#39;editor.wordHighlightBorder\u0026#39;), borderRadius: \u0026#39;3px\u0026#39; }); // åº”ç”¨è£…é¥° function highlightWords(editor: vscode.TextEditor, words: string[]) { const text = editor.document.getText(); const decorations: vscode.DecorationOptions[] = []; words.forEach(word =\u0026gt; { const regex = new RegExp(word, \u0026#39;gi\u0026#39;); let match; while ((match = regex.exec(text)) !== null) { const startPos = editor.document.positionAt(match.index); const endPos = editor.document.positionAt(match.index + match[0].length); decorations.push({ range: new vscode.Range(startPos, endPos), hoverMessage: `Found word: ${word}`, isWholeLine: false }); } }); editor.setDecorations(decorationType, decorations); } // æ¸…é™¤è£…é¥° function clearDecorations(editor: vscode.TextEditor) { editor.setDecorations(decorationType, []); } ä»£ç å®Œæˆæä¾›è€… 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 // æ³¨å†Œä»£ç å®Œæˆæä¾›è€… const completionProvider = vscode.languages.registerCompletionItemProvider( { scheme: \u0026#39;file\u0026#39;, language: \u0026#39;javascript\u0026#39; }, { provideCompletionItems( document: vscode.TextDocument, position: vscode.Position, token: vscode.CancellationToken, context: vscode.CompletionContext ): vscode.CompletionItem[] { const completions: vscode.CompletionItem[] = []; // è‡ªå®šä¹‰ä»£ç ç‰‡æ®µ const snippet = new vscode.CompletionItem( \u0026#39;myFunction\u0026#39;, vscode.CompletionItemKind.Snippet ); snippet.insertText = new vscode.SnippetString( \u0026#39;function ${1:functionName}(${2:parameters}) {\\n\\t${3:// function body}\\n}\u0026#39; ); snippet.documentation = \u0026#39;Creates a new function\u0026#39;; snippet.detail = \u0026#39;Custom function template\u0026#39;; completions.push(snippet); // æ ¹æ®ä¸Šä¸‹æ–‡æä¾›ä¸åŒçš„å®Œæˆé¡¹ const linePrefix = document.getText( new vscode.Range(position.line, 0, position.line, position.character) ); if (linePrefix.includes(\u0026#39;console.\u0026#39;)) { completions.push( new vscode.CompletionItem( \u0026#39;logCustom\u0026#39;, vscode.CompletionItemKind.Method ) ); } return completions; } } ); context.subscriptions.push(completionProvider); æ‚¬åœæç¤º 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 // æ³¨å†Œæ‚¬åœæç¤ºæä¾›è€… const hoverProvider = vscode.languages.registerHoverProvider( { scheme: \u0026#39;file\u0026#39;, language: \u0026#39;typescript\u0026#39; }, { provideHover( document: vscode.TextDocument, position: vscode.Position, token: vscode.CancellationToken ): vscode.Hover | null { const word = document.getText( document.getWordRangeAtPosition(position) ); if (word \u0026amp;\u0026amp; [\u0026#39;API\u0026#39;, \u0026#39;HTTP\u0026#39;, \u0026#39;JSON\u0026#39;].includes(word)) { const markdown = new vscode.MarkdownString(); markdown.appendMarkdown(`### ${word}\\n\\n`); switch (word) { case \u0026#39;API\u0026#39;: markdown.appendMarkdown( \u0026#39;Application Programming Interface\\n\\n\u0026#39; + \u0026#39;åº”ç”¨ç¨‹åºç¼–ç¨‹æ¥å£ï¼Œå®šä¹‰äº†è½¯ä»¶ç»„ä»¶ä¹‹é—´çš„é€šä¿¡æ–¹å¼\u0026#39; ); break; case \u0026#39;HTTP\u0026#39;: markdown.appendMarkdown( \u0026#39;HyperText Transfer Protocol\\n\\n\u0026#39; + \u0026#39;è¶…æ–‡æœ¬ä¼ è¾“åè®®ï¼Œç”¨äºä¼ è¾“è¶…åª’ä½“æ–‡æ¡£\u0026#39; ); break; case \u0026#39;JSON\u0026#39;: markdown.appendMarkdown( \u0026#39;JavaScript Object Notation\\n\\n\u0026#39; + \u0026#39;è½»é‡çº§çš„æ•°æ®äº¤æ¢æ ¼å¼\u0026#39; ); break; } return new vscode.Hover(markdown); } return null; } } ); context.subscriptions.push(hoverProvider); 5. WebViewæ‰©å±• åˆ›å»ºWebView 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 // WebView Panelç±» class MyWebView { private readonly _panel: vscode.WebviewPanel; private readonly _extensionUri: vscode.Uri; constructor(extensionUri: vscode.Uri) { this._extensionUri = extensionUri; // åˆ›å»ºWebviewé¢æ¿ this._panel = vscode.window.createWebviewPanel( \u0026#39;myWebView\u0026#39;, \u0026#39;My WebView\u0026#39;, vscode.ViewColumn.One, { enableScripts: true, retainContextWhenHidden: true } ); // è®¾ç½®HTMLå†…å®¹ this._panel.webview.html = this._getHtmlForWebview(); // ç›‘å¬æ¶ˆæ¯ this._panel.webview.onDidReceiveMessage( message =\u0026gt; this._onMessage(message) ); } private _getHtmlForWebview(): string { return `\u0026lt;!DOCTYPE html\u0026gt; \u0026lt;html lang=\u0026#34;en\u0026#34;\u0026gt; \u0026lt;head\u0026gt; \u0026lt;meta charset=\u0026#34;UTF-8\u0026#34;\u0026gt; \u0026lt;meta name=\u0026#34;viewport\u0026#34; content=\u0026#34;width=device-width, initial-scale=1.0\u0026#34;\u0026gt; \u0026lt;title\u0026gt;My WebView\u0026lt;/title\u0026gt; \u0026lt;style\u0026gt; body { font-family: Arial, sans-serif; padding: 20px; } .container { max-width: 800px; margin: 0 auto; } button { background: #007acc; color: white; border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer; } button:hover { background: #005a9e; } \u0026lt;/style\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body\u0026gt; \u0026lt;div class=\u0026#34;container\u0026#34;\u0026gt; \u0026lt;h1\u0026gt;My WebView\u0026lt;/h1\u0026gt; \u0026lt;p\u0026gt;This is a custom WebView panel.\u0026lt;/p\u0026gt; \u0026lt;button onclick=\u0026#34;sendMessage()\u0026#34;\u0026gt;Send Message\u0026lt;/button\u0026gt; \u0026lt;div id=\u0026#34;response\u0026#34;\u0026gt;\u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;script\u0026gt; const vscode = acquireVsCodeApi(); function sendMessage() { vscode.postMessage({ command: \u0026#39;hello\u0026#39;, text: \u0026#39;Hello from WebView!\u0026#39; }); } window.addEventListener(\u0026#39;message\u0026#39;, event =\u0026gt; { const message = event.data; switch (message.command) { case \u0026#39;update\u0026#39;: document.getElementById(\u0026#39;response\u0026#39;).textContent = message.text; break; } }); \u0026lt;/script\u0026gt; \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt;`; } private _onMessage(message: any) { switch (message.command) { case \u0026#39;hello\u0026#39;: vscode.window.showInformationMessage( `WebView says: ${message.text}` ); // å‘é€å“åº”åˆ°WebView this._panel.webview.postMessage({ command: \u0026#39;update\u0026#39;, text: \u0026#39;Extension received your message!\u0026#39; }); break; } } } // æ³¨å†ŒWebViewå‘½ä»¤ vscode.commands.registerCommand( \u0026#39;extension.openWebView\u0026#39;, () =\u0026gt; { const webView = new MyWebView(context.extensionUri); } ); WebViewä¸æ‰©å±•é€šä¿¡ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 // æ›´å¤æ‚çš„WebViewé€šä¿¡ class AdvancedWebView { private _panel: vscode.WebviewPanel; constructor(extensionUri: vscode.Uri) { this._panel = vscode.window.createWebviewPanel( \u0026#39;advancedWebView\u0026#39;, \u0026#39;Advanced WebView\u0026#39;, vscode.ViewColumn.One, { enableScripts: true, retainContextWhenHidden: true } ); this._panel.webview.html = this._getHtml(); this._setupMessageHandlers(); } private _setupMessageHandlers() { this._panel.webview.onDidReceiveMessage( async message =\u0026gt; { switch (message.command) { case \u0026#39;openFile\u0026#39;: const fileUri = await vscode.window.showOpenDialog({ canSelectMany: false, openLabel: \u0026#39;Select a file\u0026#39; }); if (fileUri) { this._panel.webview.postMessage({ command: \u0026#39;fileOpened\u0026#39;, path: fileUri[0].fsPath }); } break; case \u0026#39;saveData\u0026#39;: try { await vscode.workspace.fs.writeFile( vscode.Uri.file(message.path), Buffer.from(message.content, \u0026#39;utf8\u0026#39;) ); this._panel.webview.postMessage({ command: \u0026#39;dataSaved\u0026#39;, success: true }); } catch (error) { this._panel.webview.postMessage({ command: \u0026#39;dataSaved\u0026#39;, success: false, error: error.message }); } break; } } ); } // å…¬å¼€æ–¹æ³•ä¾›å¤–éƒ¨è°ƒç”¨ public updateContent(data: any) { this._panel.webview.postMessage({ command: \u0026#39;updateContent\u0026#39;, data }); } } 6. æ–‡ä»¶ç³»ç»Ÿæ“ä½œ å·¥ä½œåŒºæ–‡ä»¶æ“ä½œ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 // è¯»å–æ–‡ä»¶å†…å®¹ async function readFile(uri: vscode.Uri): Promise\u0026lt;string\u0026gt; { const content = await vscode.workspace.fs.readFile(uri); return Buffer.from(content).toString(\u0026#39;utf8\u0026#39;); } // å†™å…¥æ–‡ä»¶ async function writeFile(uri: vscode.Uri, content: string): Promise\u0026lt;void\u0026gt; { await vscode.workspace.fs.writeFile( uri, Buffer.from(content, \u0026#39;utf8\u0026#39;) ); } // åˆ›å»ºæ–‡ä»¶ vscode.commands.registerCommand( \u0026#39;extension.createFile\u0026#39;, async () =\u0026gt; { const fileName = await vscode.window.showInputBox({ prompt: \u0026#39;Enter file name\u0026#39;, placeHolder: \u0026#39;example.txt\u0026#39; }); if (fileName) { const workspaceFolders = vscode.workspace.workspaceFolders; if (workspaceFolders) { const fileUri = vscode.Uri.joinPath( workspaceFolders[0].uri, fileName ); await writeFile(fileUri, \u0026#39;\u0026#39;); const document = await vscode.workspace.openTextDocument(fileUri); await vscode.window.showTextDocument(document); } } } ); // æ‰¹é‡æ–‡ä»¶æ“ä½œ async function processFilesInDirectory(directoryUri: vscode.Uri) { const entries = await vscode.workspace.fs.readDirectory(directoryUri); for (const [name, type] of entries) { const entryUri = vscode.Uri.joinPath(directoryUri, name); if (type === vscode.FileType.File) { // å¤„ç†æ–‡ä»¶ const content = await readFile(entryUri); console.log(`Processing file: ${name}, size: ${content.length}`); } else if (type === vscode.FileType.Directory) { // é€’å½’å¤„ç†ç›®å½• await processFilesInDirectory(entryUri); } } } å·¥ä½œåŒºç›‘å¬ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 // ç›‘å¬æ–‡ä»¶å˜åŒ– const fileWatcher = vscode.workspace.createFileSystemWatcher( \u0026#39;**/*.{js,ts,json}\u0026#39; ); fileWatcher.onDidCreate(uri =\u0026gt; { console.log(`File created: ${uri.fsPath}`); }); fileWatcher.onDidChange(uri =\u0026gt; { console.log(`File changed: ${uri.fsPath}`); }); fileWatcher.onDidDelete(uri =\u0026gt; { console.log(`File deleted: ${uri.fsPath}`); }); // ç›‘å¬æ–‡æ¡£ä¿å­˜ vscode.workspace.onDidSaveTextDocument( (document) =\u0026gt; { if (document.languageId === \u0026#39;javascript\u0026#39;) { // è‡ªåŠ¨æ ¼å¼åŒ–JavaScriptæ–‡ä»¶ formatDocument(document); } } ); // ç›‘å¬æ–‡æœ¬ç¼–è¾‘å™¨å˜åŒ– vscode.window.onDidChangeActiveTextEditor( (editor) =\u0026gt; { if (editor) { console.log(`Active editor: ${editor.document.fileName}`); } } ); 7. æµ‹è¯•å’Œè°ƒè¯• å•å…ƒæµ‹è¯• 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 // src/test/extension.test.ts import * as assert from \u0026#39;assert\u0026#39;; import * as vscode from \u0026#39;vscode\u0026#39;; import * as extension from \u0026#39;../extension\u0026#39;; suite(\u0026#39;Extension Test Suite\u0026#39;, () =\u0026gt; { vscode.window.showInformationMessage(\u0026#39;Start all tests.\u0026#39;); test(\u0026#39;Extension should be present\u0026#39;, () =\u0026gt; { assert.ok(extension); }); test(\u0026#39;Command should register\u0026#39;, async () =\u0026gt; { const command = \u0026#39;extension.helloWorld\u0026#39;; const result = await vscode.commands.executeCommand(command); assert.strictEqual(result, undefined); }); test(\u0026#39;Command should show message\u0026#39;, async () =\u0026gt; { let messageShown = false; const disposable = vscode.window.onDidShowInformationMessage(() =\u0026gt; { messageShown = true; }); await vscode.commands.executeCommand(\u0026#39;extension.helloWorld\u0026#39;); assert.ok(messageShown); disposable.dispose(); }); }); // é›†æˆæµ‹è¯• suite(\u0026#39;Integration Tests\u0026#39;, () =\u0026gt; { test(\u0026#39;Should create and open file\u0026#39;, async () =\u0026gt; { const fileName = \u0026#39;test-file.txt\u0026#39;; const fileContent = \u0026#39;Hello, World!\u0026#39;; const workspaceFolders = vscode.workspace.workspaceFolders; assert.ok(workspaceFolders, \u0026#39;No workspace folder found\u0026#39;); const fileUri = vscode.Uri.joinPath( workspaceFolders[0].uri, fileName ); // å†™å…¥æ–‡ä»¶ await vscode.workspace.fs.writeFile( fileUri, Buffer.from(fileContent) ); // æ‰“å¼€æ–‡ä»¶ const document = await vscode.workspace.openTextDocument(fileUri); await vscode.window.showTextDocument(document); assert.strictEqual(document.getText(), fileContent); }); }); è°ƒè¯•é…ç½® 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 // .vscode/launch.json { \u0026#34;version\u0026#34;: \u0026#34;0.2.0\u0026#34;, \u0026#34;configurations\u0026#34;: [ { \u0026#34;name\u0026#34;: \u0026#34;Run Extension\u0026#34;, \u0026#34;type\u0026#34;: \u0026#34;extensionHost\u0026#34;, \u0026#34;request\u0026#34;: \u0026#34;launch\u0026#34;, \u0026#34;args\u0026#34;: [ \u0026#34;--extensionDevelopmentPath=${workspaceFolder}\u0026#34; ], \u0026#34;outFiles\u0026#34;: [ \u0026#34;${workspaceFolder}/out/**/*.js\u0026#34; ], \u0026#34;preLaunchTask\u0026#34;: \u0026#34;${workspaceFolder}/npm: compile\u0026#34; }, { \u0026#34;name\u0026#34;: \u0026#34;Extension Tests\u0026#34;, \u0026#34;type\u0026#34;: \u0026#34;extensionHost\u0026#34;, \u0026#34;request\u0026#34;: \u0026#34;launch\u0026#34;, \u0026#34;args\u0026#34;: [ \u0026#34;--extensionDevelopmentPath=${workspaceFolder}\u0026#34;, \u0026#34;--extensionTestsPath=${workspaceFolder}/out/test/suite/index\u0026#34; ], \u0026#34;outFiles\u0026#34;: [ \u0026#34;${workspaceFolder}/out/test/**/*.js\u0026#34; ], \u0026#34;preLaunchTask\u0026#34;: \u0026#34;${workspaceFolder}/npm: compile\u0026#34; } ] } 8. å‘å¸ƒå’Œæ‰“åŒ… å‡†å¤‡å‘å¸ƒ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 # å®‰è£…vsceå·¥å…· npm install -g vsce # æ›´æ–°package.jsonç‰ˆæœ¬ npm version patch # æˆ– minor, major # æ„å»ºæ‰©å±• npm run vscode:prepublish # æ£€æŸ¥åŒ… vsce ls --publish # å‘å¸ƒåˆ°å¸‚åœº vsce publish # æ‰“åŒ…ä¸º.vsixæ–‡ä»¶ vsce package å‘å¸ƒé…ç½® 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 // package.jsonä¸­çš„å‘å¸ƒç›¸å…³é…ç½® { \u0026#34;name\u0026#34;: \u0026#34;my-extension\u0026#34;, \u0026#34;displayName\u0026#34;: \u0026#34;My Awesome Extension\u0026#34;, \u0026#34;description\u0026#34;: \u0026#34;A helpful description\u0026#34;, \u0026#34;version\u0026#34;: \u0026#34;1.0.0\u0026#34;, \u0026#34;publisher\u0026#34;: \u0026#34;your-publisher-name\u0026#34;, \u0026#34;repository\u0026#34;: { \u0026#34;type\u0026#34;: \u0026#34;git\u0026#34;, \u0026#34;url\u0026#34;: \u0026#34;https://github.com/your-username/my-extension.git\u0026#34; }, \u0026#34;bugs\u0026#34;: { \u0026#34;url\u0026#34;: \u0026#34;https://github.com/your-username/my-extension/issues\u0026#34; }, \u0026#34;homepage\u0026#34;: \u0026#34;https://github.com/your-username/my-extension#readme\u0026#34;, \u0026#34;keywords\u0026#34;: [ \u0026#34;vscode\u0026#34;, \u0026#34;extension\u0026#34;, \u0026#34;tool\u0026#34; ], \u0026#34;engines\u0026#34;: { \u0026#34;vscode\u0026#34;: \u0026#34;^1.75.0\u0026#34; }, \u0026#34;categories\u0026#34;: [ \u0026#34;Other\u0026#34; ], \u0026#34;icon\u0026#34;: \u0026#34;images/icon.png\u0026#34;, \u0026#34;gallery\u0026#34;: [ { \u0026#34;feature\u0026#34;: \u0026#34;images/screenshot1.png\u0026#34;, \u0026#34;label\u0026#34;: \u0026#34;Feature 1\u0026#34; }, { \u0026#34;feature\u0026#34;: \u0026#34;images/screenshot2.png\u0026#34;, \u0026#34;label\u0026#34;: \u0026#34;Feature 2\u0026#34; } ] } 9. æœ€ä½³å®è·µ ä»£ç ç»„ç»‡ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 // æ¨¡å—åŒ–å‘½ä»¤ class CommandManager { private commands: vscode.Disposable[] = []; constructor(private context: vscode.ExtensionContext) {} register(command: string, callback: (...args: any[]) =\u0026gt; any) { const disposable = vscode.commands.registerCommand(command, callback); this.commands.push(disposable); return disposable; } dispose() { this.commands.forEach(disposable =\u0026gt; disposable.dispose()); this.commands = []; } } // æ¨¡å—åŒ–é…ç½® class ConfigManager { constructor(private configSection: string) {} get\u0026lt;T\u0026gt;(key: string): T | undefined { return vscode.workspace.getConfiguration(this.configSection).get\u0026lt;T\u0026gt;(key); } async set(key: string, value: any): Promise\u0026lt;void\u0026gt; { const config = vscode.workspace.getConfiguration(this.configSection); await config.update(key, value, vscode.ConfigurationTarget.Global); } } // ä½¿ç”¨ç¤ºä¾‹ export function activate(context: vscode.ExtensionContext) { const commandManager = new CommandManager(context); const configManager = new ConfigManager(\u0026#39;myExtension\u0026#39;); commandManager.register(\u0026#39;extension.myCommand\u0026#39;, () =\u0026gt; { const setting = configManager.get\u0026lt;boolean\u0026gt;(\u0026#39;enable\u0026#39;); vscode.window.showInformationMessage(`Setting: ${setting}`); }); } æ€§èƒ½ä¼˜åŒ– 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 // æ‡’åŠ è½½åŠŸèƒ½ let featureModule: any; async function loadFeatureModule() { if (!featureModule) { featureModule = await import(\u0026#39;./feature-module\u0026#39;); } return featureModule; } vscode.commands.registerCommand( \u0026#39;extension.feature\u0026#39;, async () =\u0026gt; { const module = await loadFeatureModule(); module.execute(); } ); // ç¼“å­˜è®¡ç®—ç»“æœ const cache = new Map\u0026lt;string, any\u0026gt;(); function expensiveCalculation(input: string): any { if (cache.has(input)) { return cache.get(input); } const result = performExpensiveCalculation(input); cache.set(input, result); return result; } // äº‹ä»¶é˜²æŠ– function debounce\u0026lt;T extends (...args: any[]) =\u0026gt; void\u0026gt;( fn: T, delay: number ): T { let timeoutId: NodeJS.Timeout; return ((...args: any[]) =\u0026gt; { clearTimeout(timeoutId); timeoutId = setTimeout(() =\u0026gt; fn(...args), delay); }) as T; } // ä½¿ç”¨ç¤ºä¾‹ const debouncedCommand = debounce( (args: string[]) =\u0026gt; { vscode.window.showInformationMessage(args.join(\u0026#39;, \u0026#39;)); }, 300 ); 10. å¸¸è§é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ å¸¸è§é”™è¯¯å¤„ç† 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 // å¤„ç†æ‰©å±•æ¿€æ´»å¤±è´¥ export function activate(context: vscode.ExtensionContext) { try { // æ‰©å±•åˆå§‹åŒ–é€»è¾‘ initializeExtension(context); } catch (error) { console.error(\u0026#39;Extension activation failed:\u0026#39;, error); vscode.window.showErrorMessage( `Extension activation failed: ${error.message}` ); } } // å®‰å…¨çš„ç±»å‹æ£€æŸ¥ function getActiveEditor(): vscode.TextEditor | undefined { const editor = vscode.window.activeTextEditor; if (!editor) { vscode.window.showWarningMessage(\u0026#39;No active editor\u0026#39;); return undefined; } return editor; } // ç‰ˆæœ¬å…¼å®¹æ€§æ£€æŸ¥ function checkVSCodeVersion() { const vscodeVersion = vscode.version; const requiredVersion = \u0026#39;1.75.0\u0026#39;; if (vscode.version \u0026lt; requiredVersion) { vscode.window.showErrorMessage( `This extension requires VS Code ${requiredVersion} or higher. ` + `Current version: ${vscodeVersion}` ); return false; } return true; } æ€»ç»“ VS Codeæ‰©å±•å¼€å‘ä¸ºå¼€å‘è€…æä¾›äº†å¼ºå¤§çš„å®šåˆ¶åŒ–èƒ½åŠ›ã€‚é€šè¿‡æœ¬æ–‡ä»‹ç»çš„æŠ€æœ¯å’Œæœ€ä½³å®è·µï¼Œä½ å¯ä»¥ï¼š\næ ¸å¿ƒæŠ€èƒ½ï¼š\næŒæ¡æ‰©å±•APIçš„ä½¿ç”¨ ç†è§£æ‰©å±•ç”Ÿå‘½å‘¨æœŸç®¡ç† å®ç°ä¸°å¯Œçš„ç¼–è¾‘å™¨åŠŸèƒ½ é«˜çº§ç‰¹æ€§ï¼š\nå¼€å‘è‡ªå®šä¹‰WebView åˆ›å»ºå¤æ‚çš„è¯­è¨€æ”¯æŒ å®ç°é«˜æ•ˆçš„æ–‡ä»¶æ“ä½œ å¼€å‘æµç¨‹ï¼š\nå»ºç«‹å®Œæ•´çš„æµ‹è¯•ä½“ç³» å®ç°æŒç»­é›†æˆ/éƒ¨ç½² éµå¾ªå‘å¸ƒæœ€ä½³å®è·µ è®°ä½ï¼Œå¥½çš„æ‰©å±•åº”è¯¥è§£å†³å®é™…é—®é¢˜ã€æä¾›è‰¯å¥½çš„ç”¨æˆ·ä½“éªŒï¼Œå¹¶ä¸”ä¿æŒç¨³å®šå’Œé«˜æ•ˆã€‚å¼€å§‹ä½ çš„VS Codeæ‰©å±•å¼€å‘ä¹‹æ—…å§ï¼\n","permalink":"/blog/articles/vscode-extensions-guide/","summary":"æ·±å…¥ä»‹ç»VS Codeæ‰©å±•å¼€å‘çš„å®Œæ•´æµç¨‹ï¼ŒåŒ…æ‹¬APIä½¿ç”¨ã€å‘å¸ƒæµç¨‹ã€æœ€ä½³å®è·µç­‰ï¼Œå¸®åŠ©å¼€å‘è€…åˆ›å»ºå¼ºå¤§å®ç”¨çš„VS Codeæ‰©å±•ã€‚","title":"VS Codeæ‰©å±•å¼€å‘å®Œå…¨æŒ‡å—ï¼šæ‰“é€ ä¸ªæ€§åŒ–çš„å¼€å‘ç¯å¢ƒ"},{"content":"Webæ— éšœç¢(Accessibilityï¼Œç®€ç§°A11y)ç¡®ä¿æ‰€æœ‰ç”¨æˆ·ï¼ŒåŒ…æ‹¬æ®‹éšœäººå£«ï¼Œéƒ½èƒ½å¹³ç­‰åœ°è®¿é—®å’Œä½¿ç”¨ç½‘ç«™å†…å®¹ã€‚è¿™ä¸ä»…æ˜¯ä¸€é¡¹ç¤¾ä¼šè´£ä»»ï¼Œä¹Ÿæ˜¯æ³•å¾‹è¦æ±‚ï¼Œæ›´èƒ½æå‡æ‰€æœ‰ç”¨æˆ·çš„ä½¿ç”¨ä½“éªŒã€‚æœ¬æ–‡å°†ä»‹ç»Webæ— éšœç¢çš„æ ¸å¿ƒåŸåˆ™å’Œå®æ–½æ–¹æ³•ã€‚\n1. æ— éšœç¢åŸºç¡€æ¦‚å¿µ WCAGåŸåˆ™ WCAG (Web Content Accessibility Guidelines) æå‡ºäº†å››ä¸ªæ ¸å¿ƒåŸåˆ™ï¼š\n1. æ„ŸçŸ¥æ€§ (Perceivable)\nä¿¡æ¯å’Œç”¨æˆ·ç•Œé¢ç»„ä»¶å¿…é¡»ä»¥ç”¨æˆ·å¯ä»¥æ„ŸçŸ¥çš„æ–¹å¼å‘ˆç° 1 2 3 4 5 6 7 8 9 10 11 \u0026lt;!-- âœ… æä¾›æ›¿ä»£æ–‡æœ¬ --\u0026gt; \u0026lt;img src=\u0026#34;chart.png\u0026#34; alt=\u0026#34;2024å¹´é”€å”®æ•°æ®å›¾è¡¨ï¼Œæ˜¾ç¤ºQ1å¢é•¿15%ï¼ŒQ2å¢é•¿20%\u0026#34;\u0026gt; \u0026lt;!-- âœ… ä¸ºè§†é¢‘æä¾›å­—å¹• --\u0026gt; \u0026lt;video controls\u0026gt; \u0026lt;source src=\u0026#34;demo.mp4\u0026#34; type=\u0026#34;video/mp4\u0026#34;\u0026gt; \u0026lt;track kind=\u0026#34;captions\u0026#34; src=\u0026#34;demo-captions.vtt\u0026#34; srclang=\u0026#34;zh\u0026#34; label=\u0026#34;ä¸­æ–‡å­—å¹•\u0026#34;\u0026gt; \u0026lt;/video\u0026gt; \u0026lt;!-- âŒ ç¼ºå°‘æ›¿ä»£æ–‡æœ¬ --\u0026gt; \u0026lt;img src=\u0026#34;chart.png\u0026#34;\u0026gt; 2. å¯æ“ä½œæ€§ (Operable)\nç”¨æˆ·ç•Œé¢ç»„ä»¶å’Œå¯¼èˆªå¿…é¡»æ˜¯å¯æ“ä½œçš„ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 \u0026lt;!-- âœ… é”®ç›˜å¯è®¿é—® --\u0026gt; \u0026lt;button onclick=\u0026#34;toggleMenu()\u0026#34; onkeydown=\u0026#34;handleKeydown(event)\u0026#34;\u0026gt; åˆ‡æ¢èœå• \u0026lt;/button\u0026gt; \u0026lt;!-- âœ… è¶³å¤Ÿå¤§çš„ç‚¹å‡»ç›®æ ‡ --\u0026gt; \u0026lt;a href=\u0026#34;/contact\u0026#34; class=\u0026#34;large-link\u0026#34;\u0026gt;è”ç³»æˆ‘ä»¬\u0026lt;/a\u0026gt; \u0026lt;style\u0026gt; .large-link { display: inline-block; padding: 12px 24px; min-height: 44px; min-width: 44px; } \u0026lt;/style\u0026gt; 3. å¯ç†è§£æ€§ (Understandable)\nä¿¡æ¯å’Œç”¨æˆ·ç•Œé¢çš„æ“ä½œå¿…é¡»æ˜¯å¯ç†è§£çš„ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 \u0026lt;!-- âœ… æ¸…æ™°çš„è¡¨å•æ ‡ç­¾ --\u0026gt; \u0026lt;label for=\u0026#34;email\u0026#34;\u0026gt;é‚®ç®±åœ°å€\u0026lt;/label\u0026gt; \u0026lt;input type=\u0026#34;email\u0026#34; id=\u0026#34;email\u0026#34; name=\u0026#34;email\u0026#34; required aria-required=\u0026#34;true\u0026#34;\u0026gt; \u0026lt;!-- âœ… é”™è¯¯æç¤ºæ˜ç¡® --\u0026gt; \u0026lt;div class=\u0026#34;error\u0026#34; role=\u0026#34;alert\u0026#34;\u0026gt; é‚®ç®±åœ°å€æ ¼å¼ä¸æ­£ç¡®ï¼Œè¯·é‡æ–°è¾“å…¥ \u0026lt;/div\u0026gt; \u0026lt;!-- âœ… æä¾›å¸®åŠ©ä¿¡æ¯ --\u0026gt; \u0026lt;div class=\u0026#34;help-text\u0026#34; id=\u0026#34;password-help\u0026#34;\u0026gt; å¯†ç å¿…é¡»åŒ…å«è‡³å°‘8ä¸ªå­—ç¬¦ï¼ŒåŒ…æ‹¬å¤§å°å†™å­—æ¯å’Œæ•°å­— \u0026lt;/div\u0026gt; \u0026lt;input type=\u0026#34;password\u0026#34; id=\u0026#34;password\u0026#34; aria-describedby=\u0026#34;password-help\u0026#34;\u0026gt; 4. å¥å£®æ€§ (Robust)\nå†…å®¹å¿…é¡»è¶³å¤Ÿå¥å£®ï¼Œèƒ½å¤Ÿè¢«å„ç§ç”¨æˆ·ä»£ç†ï¼ˆåŒ…æ‹¬è¾…åŠ©æŠ€æœ¯ï¼‰å¯é åœ°è§£æ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 \u0026lt;!-- âœ… ä½¿ç”¨è¯­ä¹‰åŒ–HTML --\u0026gt; \u0026lt;main\u0026gt; \u0026lt;article\u0026gt; \u0026lt;h1\u0026gt;æ–‡ç« æ ‡é¢˜\u0026lt;/h1\u0026gt; \u0026lt;p\u0026gt;æ–‡ç« å†…å®¹...\u0026lt;/p\u0026gt; \u0026lt;/article\u0026gt; \u0026lt;/main\u0026gt; \u0026lt;!-- âœ… æœ‰æ•ˆçš„HTMLç»“æ„ --\u0026gt; \u0026lt;!DOCTYPE html\u0026gt; \u0026lt;html lang=\u0026#34;zh-CN\u0026#34;\u0026gt; \u0026lt;head\u0026gt; \u0026lt;meta charset=\u0026#34;UTF-8\u0026#34;\u0026gt; \u0026lt;meta name=\u0026#34;viewport\u0026#34; content=\u0026#34;width=device-width, initial-scale=1.0\u0026#34;\u0026gt; \u0026lt;title\u0026gt;é¡µé¢æ ‡é¢˜\u0026lt;/title\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body\u0026gt; \u0026lt;!-- å†…å®¹ --\u0026gt; \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt; 2. è¯­ä¹‰åŒ–HTML æ­£ç¡®çš„æ ‡é¢˜å±‚çº§ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 \u0026lt;!-- âœ… æ­£ç¡®çš„æ ‡é¢˜å±‚çº§ --\u0026gt; \u0026lt;h1\u0026gt;ç½‘ç«™ä¸»æ ‡é¢˜\u0026lt;/h1\u0026gt; \u0026lt;h2\u0026gt;å…³äºæˆ‘ä»¬\u0026lt;/h2\u0026gt; \u0026lt;h3\u0026gt;å…¬å¸å†å²\u0026lt;/h3\u0026gt; \u0026lt;h3\u0026gt;å›¢é˜Ÿä»‹ç»\u0026lt;/h3\u0026gt; \u0026lt;h2\u0026gt;äº§å“æœåŠ¡\u0026lt;/h2\u0026gt; \u0026lt;h3\u0026gt;äº§å“åˆ—è¡¨\u0026lt;/h3\u0026gt; \u0026lt;h3\u0026gt;ä»·æ ¼æ–¹æ¡ˆ\u0026lt;/h3\u0026gt; \u0026lt;h2\u0026gt;è”ç³»æ–¹å¼\u0026lt;/h2\u0026gt; \u0026lt;!-- âŒ è·³çº§æ ‡é¢˜ --\u0026gt; \u0026lt;h1\u0026gt;ç½‘ç«™ä¸»æ ‡é¢˜\u0026lt;/h1\u0026gt; \u0026lt;h3\u0026gt;å…³äºæˆ‘ä»¬\u0026lt;/h3\u0026gt; \u0026lt;!-- è·³è¿‡äº†h2 --\u0026gt; \u0026lt;h4\u0026gt;å…¬å¸å†å²\u0026lt;/h4\u0026gt; \u0026lt;!-- æ ‡é¢˜å¯¼èˆªå·¥å…· --\u0026gt; \u0026lt;nav class=\u0026#34;skip-links\u0026#34; aria-label=\u0026#34;é¡µé¢å¯¼èˆª\u0026#34;\u0026gt; \u0026lt;h2 class=\u0026#34;sr-only\u0026#34;\u0026gt;é¡µé¢å¯¼èˆª\u0026lt;/h2\u0026gt; \u0026lt;ul\u0026gt; \u0026lt;li\u0026gt;\u0026lt;a href=\u0026#34;#main\u0026#34;\u0026gt;è·³è½¬åˆ°ä¸»å†…å®¹\u0026lt;/a\u0026gt;\u0026lt;/li\u0026gt; \u0026lt;li\u0026gt;\u0026lt;a href=\u0026#34;#navigation\u0026#34;\u0026gt;è·³è½¬åˆ°å¯¼èˆª\u0026lt;/a\u0026gt;\u0026lt;/li\u0026gt; \u0026lt;li\u0026gt;\u0026lt;a href=\u0026#34;#search\u0026#34;\u0026gt;è·³è½¬åˆ°æœç´¢\u0026lt;/a\u0026gt;\u0026lt;/li\u0026gt; \u0026lt;/ul\u0026gt; \u0026lt;/nav\u0026gt; åˆ—è¡¨å’Œå¯¼èˆª 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 \u0026lt;!-- âœ… è¯­ä¹‰åŒ–å¯¼èˆª --\u0026gt; \u0026lt;nav role=\u0026#34;navigation\u0026#34; aria-label=\u0026#34;ä¸»å¯¼èˆª\u0026#34;\u0026gt; \u0026lt;ul\u0026gt; \u0026lt;li\u0026gt;\u0026lt;a href=\u0026#34;/\u0026#34; aria-current=\u0026#34;page\u0026#34;\u0026gt;é¦–é¡µ\u0026lt;/a\u0026gt;\u0026lt;/li\u0026gt; \u0026lt;li\u0026gt;\u0026lt;a href=\u0026#34;/about\u0026#34;\u0026gt;å…³äºæˆ‘ä»¬\u0026lt;/a\u0026gt;\u0026lt;/li\u0026gt; \u0026lt;li\u0026gt;\u0026lt;a href=\u0026#34;/products\u0026#34;\u0026gt;äº§å“\u0026lt;/a\u0026gt;\u0026lt;/li\u0026gt; \u0026lt;li\u0026gt;\u0026lt;a href=\u0026#34;/contact\u0026#34;\u0026gt;è”ç³»æˆ‘ä»¬\u0026lt;/a\u0026gt;\u0026lt;/li\u0026gt; \u0026lt;/ul\u0026gt; \u0026lt;/nav\u0026gt; \u0026lt;!-- âœ… é¢åŒ…å±‘å¯¼èˆª --\u0026gt; \u0026lt;nav aria-label=\u0026#34;é¢åŒ…å±‘å¯¼èˆª\u0026#34;\u0026gt; \u0026lt;ol\u0026gt; \u0026lt;li\u0026gt;\u0026lt;a href=\u0026#34;/\u0026#34;\u0026gt;é¦–é¡µ\u0026lt;/a\u0026gt;\u0026lt;/li\u0026gt; \u0026lt;li\u0026gt;\u0026lt;a href=\u0026#34;/products\u0026#34;\u0026gt;äº§å“\u0026lt;/a\u0026gt;\u0026lt;/li\u0026gt; \u0026lt;li aria-current=\u0026#34;page\u0026#34;\u0026gt;äº§å“è¯¦æƒ…\u0026lt;/li\u0026gt; \u0026lt;/ol\u0026gt; \u0026lt;/nav\u0026gt; \u0026lt;!-- âœ… å®šä¹‰åˆ—è¡¨ --\u0026gt; \u0026lt;dl\u0026gt; \u0026lt;dt\u0026gt;HTML\u0026lt;/dt\u0026gt; \u0026lt;dd\u0026gt;è¶…æ–‡æœ¬æ ‡è®°è¯­è¨€ï¼Œç”¨äºåˆ›å»ºç½‘é¡µçš„æ ‡å‡†æ ‡è®°è¯­è¨€\u0026lt;/dd\u0026gt; \u0026lt;dt\u0026gt;CSS\u0026lt;/dt\u0026gt; \u0026lt;dd\u0026gt;å±‚å æ ·å¼è¡¨ï¼Œç”¨äºè®¾ç½®ç½‘é¡µçš„è§†è§‰æ ·å¼\u0026lt;/dd\u0026gt; \u0026lt;dt\u0026gt;JavaScript\u0026lt;/dt\u0026gt; \u0026lt;dd\u0026gt;è„šæœ¬è¯­è¨€ï¼Œç”¨äºå®ç°ç½‘é¡µçš„äº¤äº’åŠŸèƒ½\u0026lt;/dd\u0026gt; \u0026lt;/dl\u0026gt; è¡¨å•è¯­ä¹‰åŒ– 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 \u0026lt;!-- âœ… å®Œæ•´çš„è¡¨å•ç»“æ„ --\u0026gt; \u0026lt;form action=\u0026#34;/submit\u0026#34; method=\u0026#34;post\u0026#34; novalidate\u0026gt; \u0026lt;fieldset\u0026gt; \u0026lt;legend\u0026gt;ç”¨æˆ·ä¿¡æ¯\u0026lt;/legend\u0026gt; \u0026lt;div class=\u0026#34;form-group\u0026#34;\u0026gt; \u0026lt;label for=\u0026#34;name\u0026#34;\u0026gt; å§“å \u0026lt;span aria-label=\u0026#34;å¿…å¡«é¡¹\u0026#34;\u0026gt;*\u0026lt;/span\u0026gt; \u0026lt;/label\u0026gt; \u0026lt;input type=\u0026#34;text\u0026#34; id=\u0026#34;name\u0026#34; name=\u0026#34;name\u0026#34; required aria-required=\u0026#34;true\u0026#34; aria-describedby=\u0026#34;name-help\u0026#34; autocomplete=\u0026#34;name\u0026#34; \u0026gt; \u0026lt;div id=\u0026#34;name-help\u0026#34; class=\u0026#34;help-text\u0026#34;\u0026gt; è¯·è¾“å…¥æ‚¨çš„çœŸå®å§“å \u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;div class=\u0026#34;form-group\u0026#34;\u0026gt; \u0026lt;label for=\u0026#34;email\u0026#34;\u0026gt;é‚®ç®±åœ°å€\u0026lt;/label\u0026gt; \u0026lt;input type=\u0026#34;email\u0026#34; id=\u0026#34;email\u0026#34; name=\u0026#34;email\u0026#34; required aria-required=\u0026#34;true\u0026#34; autocomplete=\u0026#34;email\u0026#34; \u0026gt; \u0026lt;/div\u0026gt; \u0026lt;fieldset\u0026gt; \u0026lt;legend\u0026gt;æ€§åˆ«\u0026lt;/legend\u0026gt; \u0026lt;div class=\u0026#34;radio-group\u0026#34;\u0026gt; \u0026lt;input type=\u0026#34;radio\u0026#34; id=\u0026#34;male\u0026#34; name=\u0026#34;gender\u0026#34; value=\u0026#34;male\u0026#34;\u0026gt; \u0026lt;label for=\u0026#34;male\u0026#34;\u0026gt;ç”·æ€§\u0026lt;/label\u0026gt; \u0026lt;input type=\u0026#34;radio\u0026#34; id=\u0026#34;female\u0026#34; name=\u0026#34;gender\u0026#34; value=\u0026#34;female\u0026#34;\u0026gt; \u0026lt;label for=\u0026#34;female\u0026#34;\u0026gt;å¥³æ€§\u0026lt;/label\u0026gt; \u0026lt;input type=\u0026#34;radio\u0026#34; id=\u0026#34;other\u0026#34; name=\u0026#34;gender\u0026#34; value=\u0026#34;other\u0026#34;\u0026gt; \u0026lt;label for=\u0026#34;other\u0026#34;\u0026gt;å…¶ä»–\u0026lt;/label\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/fieldset\u0026gt; \u0026lt;/fieldset\u0026gt; \u0026lt;div class=\u0026#34;form-actions\u0026#34;\u0026gt; \u0026lt;button type=\u0026#34;submit\u0026#34;\u0026gt;æäº¤\u0026lt;/button\u0026gt; \u0026lt;button type=\u0026#34;reset\u0026#34;\u0026gt;é‡ç½®\u0026lt;/button\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/form\u0026gt; 3. ARIAå±æ€§ä½¿ç”¨ ARIAè§’è‰² 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 \u0026lt;!-- âœ… æ ‡è¯†åœ°æ ‡åŒºåŸŸ --\u0026gt; \u0026lt;header role=\u0026#34;banner\u0026#34;\u0026gt; \u0026lt;h1\u0026gt;ç½‘ç«™æ ‡é¢˜\u0026lt;/h1\u0026gt; \u0026lt;/header\u0026gt; \u0026lt;nav role=\u0026#34;navigation\u0026#34; aria-label=\u0026#34;ä¸»å¯¼èˆª\u0026#34;\u0026gt; \u0026lt;!-- å¯¼èˆªå†…å®¹ --\u0026gt; \u0026lt;/nav\u0026gt; \u0026lt;main role=\u0026#34;main\u0026#34;\u0026gt; \u0026lt;!-- ä¸»è¦å†…å®¹ --\u0026gt; \u0026lt;/main\u0026gt; \u0026lt;aside role=\u0026#34;complementary\u0026#34; aria-label=\u0026#34;ä¾§è¾¹æ \u0026#34;\u0026gt; \u0026lt;!-- è¡¥å……å†…å®¹ --\u0026gt; \u0026lt;/aside\u0026gt; \u0026lt;footer role=\u0026#34;contentinfo\u0026#34;\u0026gt; \u0026lt;!-- ç‰ˆæƒä¿¡æ¯ --\u0026gt; \u0026lt;/footer\u0026gt; \u0026lt;!-- âœ… åŠ¨æ€å†…å®¹åŒºåŸŸ --\u0026gt; \u0026lt;div role=\u0026#34;region\u0026#34; aria-live=\u0026#34;polite\u0026#34; aria-label=\u0026#34;çŠ¶æ€æ¶ˆæ¯\u0026#34;\u0026gt; \u0026lt;p id=\u0026#34;status-message\u0026#34;\u0026gt;æ“ä½œæˆåŠŸå®Œæˆ\u0026lt;/p\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;div role=\u0026#34;alert\u0026#34; aria-live=\u0026#34;assertive\u0026#34;\u0026gt; \u0026lt;p\u0026gt;é‡è¦ï¼šæ‚¨çš„ä¼šè¯å³å°†è¿‡æœŸ\u0026lt;/p\u0026gt; \u0026lt;/div\u0026gt; ARIAçŠ¶æ€å’Œå±æ€§ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 \u0026lt;!-- âœ… æŒ‰é’®çŠ¶æ€ --\u0026gt; \u0026lt;button aria-pressed=\u0026#34;false\u0026#34; aria-label=\u0026#34;åˆ‡æ¢é™éŸ³\u0026#34; onclick=\u0026#34;toggleMute(this)\u0026#34; \u0026gt; \u0026lt;span aria-hidden=\u0026#34;true\u0026#34;\u0026gt;ğŸ”Š\u0026lt;/span\u0026gt; \u0026lt;/button\u0026gt; \u0026lt;!-- âœ… è¿›åº¦æŒ‡ç¤ºå™¨ --\u0026gt; \u0026lt;div role=\u0026#34;progressbar\u0026#34; aria-valuenow=\u0026#34;75\u0026#34; aria-valuemin=\u0026#34;0\u0026#34; aria-valuemax=\u0026#34;100\u0026#34; aria-label=\u0026#34;æ–‡ä»¶ä¸Šä¼ è¿›åº¦\u0026#34; \u0026gt; 75% \u0026lt;/div\u0026gt; \u0026lt;!-- âœ… é€‰é¡¹å¡ç•Œé¢ --\u0026gt; \u0026lt;div role=\u0026#34;tablist\u0026#34; aria-label=\u0026#34;äº§å“é€‰é¡¹å¡\u0026#34;\u0026gt; \u0026lt;button role=\u0026#34;tab\u0026#34; aria-selected=\u0026#34;true\u0026#34; aria-controls=\u0026#34;panel1\u0026#34; id=\u0026#34;tab1\u0026#34; \u0026gt; äº§å“è¯¦æƒ… \u0026lt;/button\u0026gt; \u0026lt;button role=\u0026#34;tab\u0026#34; aria-selected=\u0026#34;false\u0026#34; aria-controls=\u0026#34;panel2\u0026#34; id=\u0026#34;tab2\u0026#34; \u0026gt; ç”¨æˆ·è¯„ä»· \u0026lt;/button\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;div role=\u0026#34;tabpanel\u0026#34; id=\u0026#34;panel1\u0026#34; aria-labelledby=\u0026#34;tab1\u0026#34; tabindex=\u0026#34;0\u0026#34; \u0026gt; \u0026lt;!-- äº§å“è¯¦æƒ…å†…å®¹ --\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;div role=\u0026#34;tabpanel\u0026#34; id=\u0026#34;panel2\u0026#34; aria-labelledby=\u0026#34;tab2\u0026#34; hidden tabindex=\u0026#34;0\u0026#34; \u0026gt; \u0026lt;!-- ç”¨æˆ·è¯„ä»·å†…å®¹ --\u0026gt; \u0026lt;/div\u0026gt; 4. é”®ç›˜å¯¼èˆª ç„¦ç‚¹ç®¡ç† 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 \u0026lt;!-- âœ… è‡ªå®šä¹‰å¯èšç„¦å…ƒç´  --\u0026gt; \u0026lt;div tabindex=\u0026#34;0\u0026#34; role=\u0026#34;button\u0026#34; onclick=\u0026#34;handleClick()\u0026#34; onkeydown=\u0026#34;handleKeydown(event)\u0026#34; aria-label=\u0026#34;è‡ªå®šä¹‰æŒ‰é’®\u0026#34; \u0026gt; ç‚¹å‡»æˆ‘ \u0026lt;/div\u0026gt; \u0026lt;script\u0026gt; function handleKeydown(event) { if (event.key === \u0026#39;Enter\u0026#39; || event.key === \u0026#39; \u0026#39;) { event.preventDefault(); handleClick(); } } \u0026lt;/script\u0026gt; \u0026lt;!-- âœ… æ¨¡æ€æ¡†ç„¦ç‚¹ç®¡ç† --\u0026gt; \u0026lt;div id=\u0026#34;modal\u0026#34; class=\u0026#34;modal\u0026#34; role=\u0026#34;dialog\u0026#34; aria-labelledby=\u0026#34;modal-title\u0026#34; hidden\u0026gt; \u0026lt;div class=\u0026#34;modal-content\u0026#34;\u0026gt; \u0026lt;h2 id=\u0026#34;modal-title\u0026#34;\u0026gt;å¯¹è¯æ¡†æ ‡é¢˜\u0026lt;/h2\u0026gt; \u0026lt;button onclick=\u0026#34;closeModal()\u0026#34; aria-label=\u0026#34;å…³é—­å¯¹è¯æ¡†\u0026#34;\u0026gt;Ã—\u0026lt;/button\u0026gt; \u0026lt;p\u0026gt;å¯¹è¯æ¡†å†…å®¹\u0026lt;/p\u0026gt; \u0026lt;button onclick=\u0026#34;confirmModal()\u0026#34;\u0026gt;ç¡®è®¤\u0026lt;/button\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;script\u0026gt; let previousFocusElement; function openModal() { const modal = document.getElementById(\u0026#39;modal\u0026#39;); previousFocusElement = document.activeElement; modal.hidden = false; modal.setAttribute(\u0026#39;aria-hidden\u0026#39;, \u0026#39;false\u0026#39;); // ç„¦ç‚¹ç§»åˆ°æ¨¡æ€æ¡†å†…ç¬¬ä¸€ä¸ªå¯èšç„¦å…ƒç´  modal.querySelector(\u0026#39;button\u0026#39;).focus(); // é™åˆ¶Tabé”®åœ¨æ¨¡æ€æ¡†å†…å¾ªç¯ modal.addEventListener(\u0026#39;keydown\u0026#39;, trapFocus); } function closeModal() { const modal = document.getElementById(\u0026#39;modal\u0026#39;); modal.hidden = true; modal.setAttribute(\u0026#39;aria-hidden\u0026#39;, \u0026#39;true\u0026#39;); modal.removeEventListener(\u0026#39;keydown\u0026#39;, trapFocus); // æ¢å¤ä¹‹å‰çš„ç„¦ç‚¹ if (previousFocusElement) { previousFocusElement.focus(); } } function trapFocus(event) { if (event.key === \u0026#39;Tab\u0026#39;) { const focusableElements = event.currentTarget.querySelectorAll( \u0026#39;button, [href], input, select, textarea, [tabindex]:not([tabindex=\u0026#34;-1\u0026#34;])\u0026#39; ); const firstElement = focusableElements[0]; const lastElement = focusableElements[focusableElements.length - 1]; if (event.shiftKey) { if (document.activeElement === firstElement) { event.preventDefault(); lastElement.focus(); } } else { if (document.activeElement === lastElement) { event.preventDefault(); firstElement.focus(); } } } } \u0026lt;/script\u0026gt; è·³è¿‡é“¾æ¥ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 \u0026lt;!-- âœ… è·³è¿‡é“¾æ¥ï¼ˆå¯¹å±å¹•é˜…è¯»å™¨ç”¨æˆ·é‡è¦ï¼‰ --\u0026gt; \u0026lt;a href=\u0026#34;#main-content\u0026#34; class=\u0026#34;skip-link\u0026#34;\u0026gt; è·³è½¬åˆ°ä¸»å†…å®¹ \u0026lt;/a\u0026gt; \u0026lt;style\u0026gt; .skip-link { position: absolute; top: -40px; left: 6px; background: #000; color: #fff; padding: 8px; text-decoration: none; border-radius: 4px; z-index: 1000; } .skip-link:focus { top: 6px; } \u0026lt;/style\u0026gt; \u0026lt;main id=\u0026#34;main-content\u0026#34;\u0026gt; \u0026lt;!-- ä¸»è¦å†…å®¹ --\u0026gt; \u0026lt;/main\u0026gt; 5. è‰²å½©å’Œå¯¹æ¯”åº¦ å¯¹æ¯”åº¦è¦æ±‚ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 /* âœ… è¶³å¤Ÿçš„å¯¹æ¯”åº¦ï¼ˆè‡³å°‘4.5:1ï¼‰ */ .text-high-contrast { color: #000000; /* é»‘è‰²æ–‡å­— */ background-color: #ffffff; /* ç™½è‰²èƒŒæ™¯ */ } .text-medium-contrast { color: #333333; /* æ·±ç°è‰²æ–‡å­— */ background-color: #ffffff; /* ç™½è‰²èƒŒæ™¯ */ } /* âœ… å¤§æ–‡æœ¬å¯¹æ¯”åº¦è¦æ±‚ï¼ˆè‡³å°‘3:1ï¼‰ */ .heading-large { font-size: 24px; color: #666666; /* å¯ä»¥ä½¿ç”¨è¾ƒä½çš„å¯¹æ¯”åº¦ */ background-color: #ffffff; } /* âŒ å¯¹æ¯”åº¦ä¸è¶³ */ .poor-contrast { color: #cccccc; /* æµ…ç°è‰²æ–‡å­— */ background-color: #ffffff; /* ç™½è‰²èƒŒæ™¯ */ } è‰²å½©æ— éšœç¢ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 \u0026lt;!-- âœ… ä¸ä¾èµ–é¢œè‰²ä¼ è¾¾ä¿¡æ¯ --\u0026gt; \u0026lt;div class=\u0026#34;status-indicators\u0026#34;\u0026gt; \u0026lt;div class=\u0026#34;indicator success\u0026#34;\u0026gt; \u0026lt;span class=\u0026#34;icon\u0026#34;\u0026gt;âœ“\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026#34;text\u0026#34;\u0026gt;æ“ä½œæˆåŠŸ\u0026lt;/span\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;div class=\u0026#34;indicator error\u0026#34;\u0026gt; \u0026lt;span class=\u0026#34;icon\u0026#34;\u0026gt;âœ—\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026#34;text\u0026#34;\u0026gt;æ“ä½œå¤±è´¥\u0026lt;/span\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;style\u0026gt; .indicator { display: flex; align-items: center; gap: 8px; padding: 8px; border-radius: 4px; } .success { background-color: #d4edda; border: 1px solid #c3e6cb; color: #155724; } .error { background-color: #f8d7da; border: 1px solid #f5c6cb; color: #721c24; } /* âœ… é«˜å¯¹æ¯”åº¦æ¨¡å¼æ”¯æŒ */ @media (prefers-contrast: high) { .success { background-color: #000; color: #fff; border: 2px solid #fff; } .error { background-color: #000; color: #fff; border: 2px solid #fff; } } /* âœ… ç”¨æˆ·åå¥½æ”¯æŒ */ @media (prefers-reduced-motion: reduce) { * { animation-duration: 0.01ms !important; animation-iteration-count: 1 !important; transition-duration: 0.01ms !important; } } @media (prefers-color-scheme: dark) { body { background-color: #121212; color: #ffffff; } .card { background-color: #1e1e1e; color: #ffffff; } } 6. å¤šåª’ä½“æ— éšœç¢ å›¾ç‰‡æè¿° 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 \u0026lt;!-- âœ… è£…é¥°æ€§å›¾ç‰‡ --\u0026gt; \u0026lt;img src=\u0026#34;decorative-border.png\u0026#34; alt=\u0026#34;\u0026#34; role=\u0026#34;presentation\u0026#34;\u0026gt; \u0026lt;!-- âœ… ä¿¡æ¯æ€§å›¾ç‰‡ --\u0026gt; \u0026lt;img src=\u0026#34;company-logo.png\u0026#34; alt=\u0026#34;ABCå…¬å¸\u0026#34;\u0026gt; \u0026lt;!-- âœ… å¤æ‚å›¾ç‰‡çš„è¯¦ç»†æè¿° --\u0026gt; \u0026lt;img src=\u0026#34;complex-chart.png\u0026#34; alt=\u0026#34;é”€å”®è¶‹åŠ¿å›¾æ˜¾ç¤º2024å¹´å„å­£åº¦é”€å”®æ•°æ®\u0026#34; longdesc=\u0026#34;/charts/description.html\u0026#34;\u0026gt; \u0026lt;!-- âœ… å›¾ç‰‡åœ°å›¾ --\u0026gt; \u0026lt;img src=\u0026#34;workspace.jpg\u0026#34; alt=\u0026#34;å·¥ä½œåŒºåŸŸå¹³é¢å›¾\u0026#34; usemap=\u0026#34;#workspacemap\u0026#34;\u0026gt; \u0026lt;map name=\u0026#34;workspacemap\u0026#34;\u0026gt; \u0026lt;area shape=\u0026#34;rect\u0026#34; coords=\u0026#34;0,0,50,50\u0026#34; alt=\u0026#34;ä¼šè®®å®¤A\u0026#34; href=\u0026#34;/room-a\u0026#34;\u0026gt; \u0026lt;area shape=\u0026#34;rect\u0026#34; coords=\u0026#34;60,0,110,50\u0026#34; alt=\u0026#34;ä¼šè®®å®¤B\u0026#34; href=\u0026#34;/room-b\u0026#34;\u0026gt; \u0026lt;/map\u0026gt; è§†é¢‘æ— éšœç¢ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 \u0026lt;!-- âœ… å®Œæ•´çš„è§†é¢‘æ— éšœç¢æ”¯æŒ --\u0026gt; \u0026lt;video controls width=\u0026#34;640\u0026#34; height=\u0026#34;360\u0026#34; poster=\u0026#34;video-poster.jpg\u0026#34; \u0026gt; \u0026lt;!-- å¤šç§è§†é¢‘æ ¼å¼æ”¯æŒ --\u0026gt; \u0026lt;source src=\u0026#34;video.mp4\u0026#34; type=\u0026#34;video/mp4\u0026#34;\u0026gt; \u0026lt;source src=\u0026#34;video.webm\u0026#34; type=\u0026#34;video/webm\u0026#34;\u0026gt; \u0026lt;!-- å­—å¹•è½¨é“ --\u0026gt; \u0026lt;track kind=\u0026#34;subtitles\u0026#34; src=\u0026#34;subtitles-zh.vtt\u0026#34; srclang=\u0026#34;zh\u0026#34; label=\u0026#34;ä¸­æ–‡å­—å¹•\u0026#34; \u0026gt; \u0026lt;track kind=\u0026#34;subtitles\u0026#34; src=\u0026#34;subtitles-en.vtt\u0026#34; srclang=\u0026#34;en\u0026#34; label=\u0026#34;English Subtitles\u0026#34; \u0026gt; \u0026lt;!-- æè¿°éŸ³è½¨ --\u0026gt; \u0026lt;track kind=\u0026#34;descriptions\u0026#34; src=\u0026#34;descriptions.vtt\u0026#34; srclang=\u0026#34;zh\u0026#34; label=\u0026#34;éŸ³é¢‘æè¿°\u0026#34; \u0026gt; \u0026lt;!-- ç« èŠ‚æ ‡è®° --\u0026gt; \u0026lt;track kind=\u0026#34;chapters\u0026#34; src=\u0026#34;chapters.vtt\u0026#34; srclang=\u0026#34;zh\u0026#34; label=\u0026#34;ç« èŠ‚\u0026#34; \u0026gt; \u0026lt;!-- ä¸æ”¯æŒè§†é¢‘çš„æ›¿ä»£å†…å®¹ --\u0026gt; \u0026lt;div class=\u0026#34;video-fallback\u0026#34;\u0026gt; \u0026lt;p\u0026gt;æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒè§†é¢‘æ’­æ”¾ã€‚\u0026lt;/p\u0026gt; \u0026lt;p\u0026gt;\u0026lt;a href=\u0026#34;video.mp4\u0026#34;\u0026gt;ä¸‹è½½è§†é¢‘æ–‡ä»¶\u0026lt;/a\u0026gt;\u0026lt;/p\u0026gt; \u0026lt;div class=\u0026#34;video-transcript\u0026#34;\u0026gt; \u0026lt;h3\u0026gt;è§†é¢‘æ–‡å­—è®°å½•\u0026lt;/h3\u0026gt; \u0026lt;p\u0026gt;è¿™é‡Œæ˜¯è§†é¢‘çš„å®Œæ•´æ–‡å­—è®°å½•...\u0026lt;/p\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/video\u0026gt; 7. JavaScriptæ— éšœç¢ äº‹ä»¶å¤„ç† 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 // âœ… æ— éšœç¢çš„äº‹ä»¶å¤„ç† class AccessibleButton { constructor(element) { this.element = element; this.init(); } init() { // è®¾ç½®ARIAå±æ€§ this.element.setAttribute(\u0026#39;role\u0026#39;, \u0026#39;button\u0026#39;); this.element.setAttribute(\u0026#39;tabindex\u0026#39;, \u0026#39;0\u0026#39;); // æ·»åŠ äº‹ä»¶ç›‘å¬å™¨ this.element.addEventListener(\u0026#39;click\u0026#39;, this.handleClick.bind(this)); this.element.addEventListener(\u0026#39;keydown\u0026#39;, this.handleKeydown.bind(this)); } handleClick(event) { event.preventDefault(); this.activate(); } handleKeydown(event) { // æ”¯æŒEnterå’Œç©ºæ ¼é”® if (event.key === \u0026#39;Enter\u0026#39; || event.key === \u0026#39; \u0026#39;) { event.preventDefault(); this.activate(); } } activate() { // æ‰§è¡ŒæŒ‰é’®åŠ¨ä½œ console.log(\u0026#39;æŒ‰é’®è¢«æ¿€æ´»\u0026#39;); // æä¾›åé¦ˆç»™å±å¹•é˜…è¯»å™¨ this.announceToScreenReader(\u0026#39;æ“ä½œå·²æ‰§è¡Œ\u0026#39;); } announceToScreenReader(message) { // åˆ›å»ºä¸´æ—¶é€šçŸ¥å…ƒç´  const announcement = document.createElement(\u0026#39;div\u0026#39;); announcement.setAttribute(\u0026#39;role\u0026#39;, \u0026#39;status\u0026#39;); announcement.setAttribute(\u0026#39;aria-live\u0026#39;, \u0026#39;polite\u0026#39;); announcement.className = \u0026#39;sr-only\u0026#39;; announcement.textContent = message; document.body.appendChild(announcement); // æ¸…ç†é€šçŸ¥å…ƒç´  setTimeout(() =\u0026gt; { document.body.removeChild(announcement); }, 1000); } } // å±å¹•é˜…è¯»å™¨ä¸“ç”¨CSS const style = document.createElement(\u0026#39;style\u0026#39;); style.textContent = ` .sr-only { position: absolute; width: 1px; height: 1px; padding: 0; margin: -1px; overflow: hidden; clip: rect(0, 0, 0, 0); white-space: nowrap; border: 0; } `; document.head.appendChild(style); // ä½¿ç”¨ç¤ºä¾‹ const customButton = document.getElementById(\u0026#39;custom-button\u0026#39;); new AccessibleButton(customButton); åŠ¨æ€å†…å®¹æ›´æ–° 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 // âœ… æ— éšœç¢çš„åŠ¨æ€å†…å®¹æ›´æ–° class AccessibleContent { constructor() { this.liveRegion = document.getElementById(\u0026#39;live-region\u0026#39;); this.statusRegion = document.getElementById(\u0026#39;status-region\u0026#39;); } // æ›´æ–°å†…å®¹å¹¶é€šçŸ¥å±å¹•é˜…è¯»å™¨ updateContent(content, type = \u0026#39;polite\u0026#39;) { const region = type === \u0026#39;assertive\u0026#39; ? this.statusRegion : this.liveRegion; // æ›´æ–°å†…å®¹ region.textContent = content; // ç¡®ä¿å†…å®¹è¢«è¯»å– setTimeout(() =\u0026gt; { region.textContent = \u0026#39;\u0026#39;; region.textContent = content; }, 100); } // é‡è¦é€šçŸ¥ï¼ˆæ‰“æ–­å½“å‰é˜…è¯»ï¼‰ announceImportant(message) { this.updateContent(message, \u0026#39;assertive\u0026#39;); } // ä¸€èˆ¬é€šçŸ¥ï¼ˆä¸æ‰“æ–­ï¼‰ announcePolite(message) { this.updateContent(message, \u0026#39;polite\u0026#39;); } } // ä½¿ç”¨ç¤ºä¾‹ const accessibleContent = new AccessibleContent(); // AJAXè¯·æ±‚å®Œæˆåçš„é€šçŸ¥ fetch(\u0026#39;/api/data\u0026#39;) .then(response =\u0026gt; response.json()) .then(data =\u0026gt; { // æ›´æ–°é¡µé¢å†…å®¹ document.getElementById(\u0026#39;content\u0026#39;).innerHTML = data.html; // é€šçŸ¥å±å¹•é˜…è¯»å™¨ accessibleContent.announcePolite(\u0026#39;å†…å®¹å·²æ›´æ–°\u0026#39;); }) .catch(error =\u0026gt; { accessibleContent.announceImportant(\u0026#39;åŠ è½½å¤±è´¥ï¼Œè¯·é‡è¯•\u0026#39;); }); 8. ç§»åŠ¨ç«¯æ— éšœç¢ è§¦æ‘¸ç›®æ ‡å¤§å° 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 /* âœ… è¶³å¤Ÿå¤§çš„è§¦æ‘¸ç›®æ ‡ */ .touch-target { min-height: 44px; min-width: 44px; padding: 12px; margin: 8px; } /* âœ… æŒ‰é’®é—´è· */ .button-group button { margin: 8px; min-height: 44px; min-width: 44px; } /* âœ… è¾“å…¥æ¡†å°ºå¯¸ */ input, textarea, select { min-height: 44px; font-size: 16px; /* é˜²æ­¢iOSç¼©æ”¾ */ padding: 12px; margin: 8px 0; } ç§»åŠ¨ç«¯å¯¼èˆª 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 \u0026lt;!-- âœ… ç§»åŠ¨ç«¯å‹å¥½å¯¼èˆª --\u0026gt; \u0026lt;nav class=\u0026#34;mobile-nav\u0026#34; role=\u0026#34;navigation\u0026#34; aria-label=\u0026#34;ç§»åŠ¨ç«¯å¯¼èˆª\u0026#34;\u0026gt; \u0026lt;button class=\u0026#34;nav-toggle\u0026#34; aria-expanded=\u0026#34;false\u0026#34; aria-controls=\u0026#34;nav-menu\u0026#34; onclick=\u0026#34;toggleNavigation()\u0026#34; \u0026gt; \u0026lt;span class=\u0026#34;hamburger-icon\u0026#34;\u0026gt;\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026#34;sr-only\u0026#34;\u0026gt;åˆ‡æ¢èœå•\u0026lt;/span\u0026gt; \u0026lt;/button\u0026gt; \u0026lt;ul id=\u0026#34;nav-menu\u0026#34; class=\u0026#34;nav-menu\u0026#34; hidden\u0026gt; \u0026lt;li\u0026gt;\u0026lt;a href=\u0026#34;/\u0026#34;\u0026gt;é¦–é¡µ\u0026lt;/a\u0026gt;\u0026lt;/li\u0026gt; \u0026lt;li\u0026gt;\u0026lt;a href=\u0026#34;/about\u0026#34;\u0026gt;å…³äº\u0026lt;/a\u0026gt;\u0026lt;/li\u0026gt; \u0026lt;li\u0026gt;\u0026lt;a href=\u0026#34;/contact\u0026#34;\u0026gt;è”ç³»\u0026lt;/a\u0026gt;\u0026lt;/li\u0026gt; \u0026lt;/ul\u0026gt; \u0026lt;/nav\u0026gt; \u0026lt;script\u0026gt; function toggleNavigation() { const menu = document.getElementById(\u0026#39;nav-menu\u0026#39;); const toggle = document.querySelector(\u0026#39;.nav-toggle\u0026#39;); const isExpanded = menu.hidden === false; menu.hidden = isExpanded; toggle.setAttribute(\u0026#39;aria-expanded\u0026#39;, !isExpanded); // å¦‚æœèœå•æ‰“å¼€ï¼Œç„¦ç‚¹ç§»åˆ°ç¬¬ä¸€ä¸ªé“¾æ¥ if (!isExpanded) { menu.querySelector(\u0026#39;a\u0026#39;).focus(); } } \u0026lt;/script\u0026gt; 9. æµ‹è¯•å’ŒéªŒè¯ è‡ªåŠ¨åŒ–æµ‹è¯•å·¥å…· 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 // âœ… ä½¿ç”¨axe-coreè¿›è¡Œæ— éšœç¢æµ‹è¯• const axe = require(\u0026#39;axe-core\u0026#39;); async function testAccessibility() { const results = await axe.run(document); if (results.violations.length === 0) { console.log(\u0026#39;âœ… æ— éšœç¢æµ‹è¯•é€šè¿‡\u0026#39;); return true; } console.log(\u0026#39;âŒ å‘ç°æ— éšœç¢é—®é¢˜:\u0026#39;); results.violations.forEach(violation =\u0026gt; { console.log(`- ${violation.description}`); console.log(` å½±å“: ${violation.impact}`); console.log(` å…ƒç´ : ${violation.nodes.map(node =\u0026gt; node.target).join(\u0026#39;, \u0026#39;)}`); }); return false; } // åœ¨é¡µé¢åŠ è½½åè¿è¡Œæµ‹è¯• document.addEventListener(\u0026#39;DOMContentLoaded\u0026#39;, testAccessibility); æ‰‹åŠ¨æµ‹è¯•æ¸…å• 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 \u0026lt;!-- æ— éšœç¢æµ‹è¯•æ¸…å• --\u0026gt; \u0026lt;div class=\u0026#34;accessibility-checklist\u0026#34;\u0026gt; \u0026lt;h2\u0026gt;æ— éšœç¢æµ‹è¯•æ¸…å•\u0026lt;/h2\u0026gt; \u0026lt;fieldset\u0026gt; \u0026lt;legend\u0026gt;é”®ç›˜å¯¼èˆªæµ‹è¯•\u0026lt;/legend\u0026gt; \u0026lt;ul\u0026gt; \u0026lt;li\u0026gt; \u0026lt;label\u0026gt; \u0026lt;input type=\u0026#34;checkbox\u0026#34;\u0026gt; å¯ä»¥ä½¿ç”¨Tabé”®å¯¼èˆªåˆ°æ‰€æœ‰äº¤äº’å…ƒç´  \u0026lt;/label\u0026gt; \u0026lt;/li\u0026gt; \u0026lt;li\u0026gt; \u0026lt;label\u0026gt; \u0026lt;input type=\u0026#34;checkbox\u0026#34;\u0026gt; ç„¦ç‚¹é¡ºåºé€»è¾‘æ¸…æ™° \u0026lt;/label\u0026gt; \u0026lt;/li\u0026gt; \u0026lt;li\u0026gt; \u0026lt;label\u0026gt; \u0026lt;input type=\u0026#34;checkbox\u0026#34;\u0026gt; å¯ä»¥ä½¿ç”¨Enter/ç©ºæ ¼é”®æ¿€æ´»æŒ‰é’®å’Œé“¾æ¥ \u0026lt;/label\u0026gt; \u0026lt;/li\u0026gt; \u0026lt;/ul\u0026gt; \u0026lt;/fieldset\u0026gt; \u0026lt;fieldset\u0026gt; \u0026lt;legend\u0026gt;å±å¹•é˜…è¯»å™¨æµ‹è¯•\u0026lt;/legend\u0026gt; \u0026lt;ul\u0026gt; \u0026lt;li\u0026gt; \u0026lt;label\u0026gt; \u0026lt;input type=\u0026#34;checkbox\u0026#34;\u0026gt; å›¾ç‰‡æœ‰åˆé€‚çš„æ›¿ä»£æ–‡æœ¬ \u0026lt;/label\u0026gt; \u0026lt;/li\u0026gt; \u0026lt;li\u0026gt; \u0026lt;label\u0026gt; \u0026lt;input type=\u0026#34;checkbox\u0026#34;\u0026gt; è¡¨å•å­—æ®µæœ‰æ˜ç¡®çš„æ ‡ç­¾ \u0026lt;/label\u0026gt; \u0026lt;/li\u0026gt; \u0026lt;li\u0026gt; \u0026lt;label\u0026gt; \u0026lt;input type=\u0026#34;checkbox\u0026#34;\u0026gt; åŠ¨æ€å†…å®¹å˜åŒ–æ—¶æœ‰é€šçŸ¥ \u0026lt;/label\u0026gt; \u0026lt;/li\u0026gt; \u0026lt;/ul\u0026gt; \u0026lt;/fieldset\u0026gt; \u0026lt;/div\u0026gt; 10. æ— éšœç¢æœ€ä½³å®è·µ å¼€å‘æµç¨‹é›†æˆ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 // webpacké…ç½®ä¸­çš„æ— éšœç¢æ£€æŸ¥ const ESLintPlugin = require(\u0026#39;eslint-webpack-plugin\u0026#39;); module.exports = { plugins: [ new ESLintPlugin({ extensions: [\u0026#39;js\u0026#39;, \u0026#39;jsx\u0026#39;], failOnError: true, eslintOptions: { extends: [\u0026#39;plugin:jsx-a11y/recommended\u0026#39;], rules: { \u0026#39;jsx-a11y/alt-text\u0026#39;: \u0026#39;error\u0026#39;, \u0026#39;jsx-a11y/anchor-is-valid\u0026#39;: \u0026#39;error\u0026#39;, \u0026#39;jsx-a11y/click-events-have-key-events\u0026#39;: \u0026#39;error\u0026#39; } } }) ] }; // CI/CDä¸­çš„æ— éšœç¢æµ‹è¯• const { execSync } = require(\u0026#39;child_process\u0026#39;); function runAccessibilityTests() { try { // ä½¿ç”¨pa11yè¿›è¡Œè‡ªåŠ¨åŒ–æµ‹è¯• execSync(\u0026#39;pa11y http://localhost:3000\u0026#39;, { stdio: \u0026#39;inherit\u0026#39; }); console.log(\u0026#39;âœ… æ— éšœç¢æµ‹è¯•é€šè¿‡\u0026#39;); } catch (error) { console.error(\u0026#39;âŒ æ— éšœç¢æµ‹è¯•å¤±è´¥\u0026#39;); process.exit(1); } } // åœ¨CI/CDç®¡é“ä¸­è¿è¡Œ if (process.env.CI) { runAccessibilityTests(); } å›¢é˜ŸåŸ¹è®­ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 # æ— éšœç¢å¼€å‘æŒ‡å— ## æ ¸å¿ƒåŸåˆ™ 1. **è¯­ä¹‰åŒ–HTMLä¼˜å…ˆ**ï¼šä½¿ç”¨æ­£ç¡®çš„HTMLå…ƒç´ è¡¨è¾¾å†…å®¹ç»“æ„ 2. **é”®ç›˜å¯è®¿é—®**ï¼šç¡®ä¿æ‰€æœ‰åŠŸèƒ½éƒ½å¯ä»¥é€šè¿‡é”®ç›˜æ“ä½œ 3. **é¢œè‰²ä¸æ˜¯å”¯ä¸€æ ‡è¯†**ï¼šä¸è¦ä»…ä¾èµ–é¢œè‰²ä¼ è¾¾ä¿¡æ¯ 4. **æä¾›æ›¿ä»£æ–‡æœ¬**ï¼šä¸ºéæ–‡æœ¬å†…å®¹æä¾›æ–‡å­—æè¿° ## å¼€å‘æ£€æŸ¥ç‚¹ - [ ] æ‰€æœ‰äº¤äº’å…ƒç´ éƒ½æœ‰é”®ç›˜æ”¯æŒ - [ ] å›¾ç‰‡éƒ½æœ‰altå±æ€§ - [ ] è¡¨å•éƒ½æœ‰æ ‡ç­¾ - [ ] è‰²å½©å¯¹æ¯”åº¦ç¬¦åˆæ ‡å‡† - [ ] ä½¿ç”¨ARIAå¢å¼ºå¯è®¿é—®æ€§ æ€»ç»“ Webæ— éšœç¢æ˜¯æ¯ä¸ªå¼€å‘è€…éƒ½åº”è¯¥é‡è§†çš„è´£ä»»ã€‚é€šè¿‡å®æ–½è¿™äº›æœ€ä½³å®è·µï¼Œæˆ‘ä»¬èƒ½å¤Ÿï¼š\næå‡ç”¨æˆ·ä½“éªŒï¼š\næ›´å¥½çš„SEOæ’å æ›´å¹¿æ³›çš„ç”¨æˆ·è¦†ç›– æå‡æ‰€æœ‰ç”¨æˆ·çš„å¯ç”¨æ€§ å±¥è¡Œç¤¾ä¼šè´£ä»»ï¼š\nç¡®ä¿æ•°å­—åŒ…å®¹æ€§ ç¬¦åˆæ³•å¾‹æ³•è§„è¦æ±‚ ä½“ç°æŠ€æœ¯é“å¾· é•¿æœŸæ”¶ç›Šï¼š\nå‡å°‘ç»´æŠ¤æˆæœ¬ æé«˜ä»£ç è´¨é‡ å»ºç«‹è‰¯å¥½çš„æŠ€æœ¯å“ç‰Œ è®°ä½ï¼Œæ— éšœç¢ä¸æ˜¯é”¦ä¸Šæ·»èŠ±ï¼Œè€Œæ˜¯åŸºæœ¬è¦æ±‚ã€‚ä»é¡¹ç›®å¼€å§‹å°±è€ƒè™‘æ— éšœç¢ï¼Œä¼šæ¯”åæœŸä¿®å¤æˆæœ¬ä½å¾—å¤šã€‚è®©æˆ‘ä»¬ä¸€èµ·æ„å»ºäººäººå¯è®¿é—®çš„Webä¸–ç•Œï¼\n","permalink":"/blog/articles/web-accessibility-guide/","summary":"å…¨é¢ä»‹ç»Webæ— éšœç¢(WA)çš„æ ¸å¿ƒåŸåˆ™å’Œå®æ–½æ–¹æ³•ï¼ŒåŒ…æ‹¬è¯­ä¹‰åŒ–HTMLã€ARIAã€é”®ç›˜å¯¼èˆªã€è‰²å½©å¯¹æ¯”ç­‰ï¼Œå¸®åŠ©å¼€å‘è€…æ„å»ºåŒ…å®¹æ€§çš„ç½‘ç«™åº”ç”¨ã€‚","title":"Webæ— éšœç¢å®Œå…¨æŒ‡å—ï¼šæ„å»ºäººäººå¯è®¿é—®çš„ç½‘ç«™"},{"content":"åšå®¢ä¸Šçº¿å•¦ï¼ å¾ˆé«˜å…´å‘å¤§å®¶å®£å¸ƒï¼Œæœ‰æ¡å·¥å…·æŠ€æœ¯åšå®¢æ­£å¼ä¸Šçº¿äº†ï¼\nä¸ºä»€ä¹ˆè¦åšè¿™ä¸ªåšå®¢ï¼Ÿ ä½œä¸ºå¼€å‘è€…å·¥å…·å¹³å°ï¼Œæˆ‘ä»¬æ¯å¤©éƒ½åœ¨ä¸å„ç§å¼€å‘å·¥å…·å’ŒæŠ€æœ¯æ‰“äº¤é“ã€‚åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬ç§¯ç´¯äº†å¾ˆå¤šç»éªŒï¼Œä¹Ÿå‘ç°äº†å¾ˆå¤šæœ‰è¶£çš„æŠ€æœ¯å’Œå·¥å…·ã€‚æˆ‘ä»¬å¸Œæœ›é€šè¿‡è¿™ä¸ªåšå®¢å¹³å°ï¼š\nåˆ†äº«å®ç”¨æŠ€å·§ - å°†æ—¥å¸¸å¼€å‘ä¸­å‘ç°çš„å®ç”¨æŠ€å·§åˆ†äº«ç»™å¤§å®¶ è®°å½•æŠ€æœ¯æˆé•¿ - è®°å½•æˆ‘ä»¬åœ¨æŠ€æœ¯æ¢ç´¢è¿‡ç¨‹ä¸­çš„å­¦ä¹ å’Œæˆé•¿ è¿æ¥å¼€å‘è€…ç¤¾åŒº - ä¸æ›´å¤šå¼€å‘è€…äº¤æµï¼Œå…±åŒè¿›æ­¥ åšå®¢å†…å®¹è§„åˆ’ æˆ‘ä»¬å°†åœ¨è¿™ä¸ªåšå®¢ä¸Šåˆ†äº«ï¼š\nğŸ› ï¸ å¼€å‘å·¥å…·ä»‹ç» - å„ç§å®ç”¨å¼€å‘å·¥å…·çš„ä½¿ç”¨å¿ƒå¾— ğŸ’» æŠ€æœ¯æ•™ç¨‹ - ä»åŸºç¡€åˆ°è¿›é˜¶çš„æŠ€æœ¯å®ç°æ•™ç¨‹ ğŸš€ é¡¹ç›®ç»éªŒ - æˆ‘ä»¬åœ¨é¡¹ç›®å¼€å‘ä¸­çš„ç»éªŒæ€»ç»“ ğŸ” æºç åˆ†æ - ä¼˜ç§€å¼€æºé¡¹ç›®çš„æºç å­¦ä¹ ç¬”è®° ğŸ“Š æ€§èƒ½ä¼˜åŒ– - å‰ç«¯å’Œåç«¯çš„æ€§èƒ½ä¼˜åŒ–å®è·µ äº’åŠ¨ä¸åé¦ˆ æˆ‘ä»¬éå¸¸æœŸå¾…ä¸å¤§å®¶äº’åŠ¨ï¼š\nåœ¨æ–‡ç« ä¸‹æ–¹ç•™è¨€è®¨è®º åœ¨ GitHub ä¸Šæäº¤ Issue æˆ– PR åˆ†äº«æ‚¨æƒ³äº†è§£çš„æŠ€æœ¯è¯é¢˜ å…³äºæœ‰æ¡å·¥å…· æœ‰æ¡å·¥å…· æ˜¯ä¸€ä¸ªé¢å‘å¼€å‘è€…çš„åœ¨çº¿å·¥å…·å¹³å°ï¼Œæä¾›äº†å„ç§å®ç”¨å·¥å…·ï¼ŒåŒ…æ‹¬ï¼š\næ ¼å¼åŒ–å·¥å…·ï¼ˆJSONã€XMLã€YAMLç­‰ï¼‰ åŠ å¯†è§£å¯†å·¥å…· ç¼–ç è§£ç å·¥å…· æ–‡æœ¬å¤„ç†å·¥å…· å›¾ç‰‡å¤„ç†å·¥å…· å¼€å‘è¾…åŠ©å·¥å…· æ‰€æœ‰å·¥å…·éƒ½æ— å¹¿å‘Šã€æœ¬åœ°è®¡ç®—ã€å³å¼€å³ç”¨ï¼Œä¿æŠ¤æ‚¨çš„æ•°æ®éšç§ã€‚\næ¬¢è¿å¸¸æ¥çœ‹çœ‹ï¼Œä¹Ÿæ¬¢è¿å…³æ³¨æˆ‘ä»¬çš„ GitHubï¼\nç¥å¤§å®¶ç¼–ç æ„‰å¿«ï¼ ğŸ‰\n","permalink":"/blog/articles/welcome-to-util-tech-blog/","summary":"æˆ‘ä»¬çš„æŠ€æœ¯åšå®¢æ­£å¼ä¸Šçº¿ï¼Œè¿™é‡Œå°†åˆ†äº«å¼€å‘ç»éªŒã€æŠ€æœ¯è§è§£å’Œå·¥å…·ä½¿ç”¨æŠ€å·§","title":"æ¬¢è¿æ¥åˆ°æœ‰æ¡å·¥å…·æŠ€æœ¯åšå®¢"},{"content":"å‰è¨€ åœ¨å‰ç«¯å·¥ç¨‹åŒ–çš„æµªæ½®ä¸­ï¼Œæ„å»ºå·¥å…·æ‰®æ¼”ç€è‡³å…³é‡è¦çš„è§’è‰²ã€‚ä»æ—©æœŸçš„ Gruntã€Gulp åˆ°åæ¥çš„ Webpackï¼Œå†åˆ°æ–°å…´çš„ Viteï¼Œæ¯ä¸€æ¬¡å·¥å…·çš„æ¼”è¿›éƒ½å¸¦æ¥äº†å¼€å‘ä½“éªŒçš„å·¨å¤§æå‡ã€‚æœ¬æ–‡å°†æ·±å…¥å¯¹æ¯”å½“å‰æœ€ä¸»æµçš„ä¸¤ä¸ªæ„å»ºå·¥å…·ï¼šVite å’Œ Webpackã€‚\nWebpackï¼šæ¨¡å—æ‰“åŒ…çš„ç‹è€… Webpack çš„ä¼˜åŠ¿ ç”Ÿæ€æˆç†Ÿç¨³å®š\næ‹¥æœ‰åºå¤§çš„æ’ä»¶ç”Ÿæ€ç³»ç»Ÿ ç¤¾åŒºæ”¯æŒå®Œå–„ï¼Œè§£å†³æ–¹æ¡ˆä¸°å¯Œ é€‚ç”¨äºå„ç§å¤æ‚çš„é¡¹ç›®éœ€æ±‚ é«˜åº¦å¯å®šåˆ¶\nçµæ´»çš„é…ç½®é€‰é¡¹ å¼ºå¤§çš„ loader å’Œ plugin æœºåˆ¶ å¯ä»¥å¤„ç†å„ç§ç±»å‹çš„èµ„æºæ–‡ä»¶ ç”Ÿäº§ç¯å¢ƒä¼˜åŒ–\nä¼˜ç§€çš„ä»£ç åˆ†å‰²å’Œ tree shaking æˆç†Ÿçš„ç”Ÿäº§ç¯å¢ƒä¼˜åŒ–ç­–ç•¥ æ”¯æŒå¤šç§è¾“å‡ºæ ¼å¼ Webpack çš„æŒ‘æˆ˜ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 // webpack.config.js å¤æ‚çš„é…ç½®ç¤ºä¾‹ const path = require(\u0026#39;path\u0026#39;); const HtmlWebpackPlugin = require(\u0026#39;html-webpack-plugin\u0026#39;); const MiniCssExtractPlugin = require(\u0026#39;mini-css-extract-plugin\u0026#39;); module.exports = { entry: \u0026#39;./src/index.js\u0026#39;, output: { path: path.resolve(__dirname, \u0026#39;dist\u0026#39;), filename: \u0026#39;[name].[contenthash].js\u0026#39;, chunkFilename: \u0026#39;[name].[contenthash].chunk.js\u0026#39; }, module: { rules: [ { test: /\\.js$/, use: \u0026#39;babel-loader\u0026#39;, exclude: /node_modules/ }, { test: /\\.css$/, use: [MiniCssExtractPlugin.loader, \u0026#39;css-loader\u0026#39;] } ] }, plugins: [ new HtmlWebpackPlugin(), new MiniCssExtractPlugin() ], optimization: { splitChunks: { chunks: \u0026#39;all\u0026#39;, cacheGroups: { vendor: { test: /[\\\\/]node_modules[\\\\/]/, name: \u0026#39;vendors\u0026#39;, chunks: \u0026#39;all\u0026#39; } } } } }; Viteï¼šä¸‹ä¸€ä»£æ„å»ºå·¥å…· Vite çš„é©æ–°ç‰¹æ€§ æé€Ÿçš„å¼€å‘æœåŠ¡å™¨\nåŸºäº ES modules çš„æŒ‰éœ€ç¼–è¯‘ æ¯«ç§’çº§çš„çƒ­æ›´æ–° æ— éœ€æ‰“åŒ…å³å¯å¯åŠ¨å¼€å‘ç¯å¢ƒ å¼€ç®±å³ç”¨çš„ä½“éªŒ\nå†…ç½® TypeScript æ”¯æŒ é¢„é…ç½®çš„ CSS é¢„å¤„ç†å™¨æ”¯æŒ ç°ä»£åŒ–çš„é»˜è®¤é…ç½® ä¼˜åŒ–çš„ç”Ÿäº§æ„å»º\nåŸºäº Rollup çš„ç”Ÿäº§æ‰“åŒ… ä¼˜ç§€çš„é»˜è®¤ä»£ç åˆ†å‰² è‡ªåŠ¨åŒ–çš„èµ„æºä¼˜åŒ– Vite é…ç½®ç¤ºä¾‹ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 // vite.config.js - ç®€æ´çš„é…ç½® import { defineConfig } from \u0026#39;vite\u0026#39;; import vue from \u0026#39;@vitejs/plugin-vue\u0026#39;; export default defineConfig({ plugins: [vue()], build: { rollupOptions: { output: { manualChunks: { vendor: [\u0026#39;vue\u0026#39;, \u0026#39;vue-router\u0026#39;], utils: [\u0026#39;lodash\u0026#39;, \u0026#39;axios\u0026#39;] } } } } }); æ€§èƒ½å¯¹æ¯” å¼€å‘ç¯å¢ƒå¯åŠ¨é€Ÿåº¦ å·¥å…· å†·å¯åŠ¨æ—¶é—´ çƒ­æ›´æ–°æ—¶é—´ å†…å­˜å ç”¨ Webpack 3-10ç§’ 100-500ms è¾ƒé«˜ Vite \u0026lt;1ç§’ \u0026lt;50ms è¾ƒä½ ç”Ÿäº§æ„å»ºè´¨é‡ æŒ‡æ ‡ Webpack Vite æ„å»ºé€Ÿåº¦ ä¸­ç­‰ è¾ƒå¿« åŒ…ä½“ç§¯ ä¼˜ç§€ ä¼˜ç§€ æµè§ˆå™¨å…¼å®¹æ€§ æ›´å¥½ éœ€è¦é¢å¤–é…ç½® å¦‚ä½•é€‰æ‹©ï¼Ÿ é€‰æ‹© Webpack çš„åœºæ™¯ å¤§å‹ä¼ä¸šé¡¹ç›®\néœ€è¦é«˜åº¦å®šåˆ¶åŒ–é…ç½® å¤æ‚çš„æ„å»ºéœ€æ±‚ ä¸¥æ ¼çš„å…¼å®¹æ€§è¦æ±‚ é—ç•™é¡¹ç›®è¿ç§»\nå·²ç»æœ‰æˆç†Ÿçš„ Webpack é…ç½® å›¢é˜Ÿç†Ÿæ‚‰ Webpack ç”Ÿæ€ é€‰æ‹© Vite çš„åœºæ™¯ æ–°é¡¹ç›®å¼€å‘\nè¿½æ±‚æè‡´çš„å¼€å‘ä½“éªŒ ç°ä»£åŒ–çš„æŠ€æœ¯æ ˆ å¿«é€ŸåŸå‹å¼€å‘ ä¸­å°å‹é¡¹ç›®\né…ç½®ç®€å•ï¼Œç»´æŠ¤æˆæœ¬ä½ ç¤¾åŒºæ´»è·ƒï¼Œæ›´æ–°é¢‘ç¹ è¿ç§»å»ºè®® ä» Webpack è¿ç§»åˆ° Vite è¯„ä¼°ä¾èµ–å…¼å®¹æ€§\n1 2 # ä½¿ç”¨ @vitejs/plugin-legacy æ”¯æŒæ—§æµè§ˆå™¨ npm install @vitejs/plugin-legacy é€æ­¥è¿ç§»é…ç½®\né¦–å…ˆè¿ç§»å¼€å‘ç¯å¢ƒ ç„¶åè°ƒæ•´ç”Ÿäº§æ„å»ºé…ç½® æœ€åä¼˜åŒ–æ„å»ºç»“æœ æœ€ä½³å®è·µ ç»Ÿä¸€æ„å»ºå·¥å…·\nå›¢é˜Ÿå†…éƒ¨ç»Ÿä¸€ä½¿ç”¨ä¸€ç§æ„å»ºå·¥å…· å»ºç«‹æœ€ä½³å®è·µæ–‡æ¡£ æŒç»­å…³æ³¨å·¥å…·ç”Ÿæ€å‘å±• æ€§èƒ½ç›‘æ§\n1 2 3 4 5 6 7 8 9 10 // æ·»åŠ æ„å»ºæ€§èƒ½åˆ†æ // webpack-bundle-analyzer const BundleAnalyzerPlugin = require(\u0026#39;webpack-bundle-analyzer\u0026#39;).BundleAnalyzerPlugin; plugins: [ new BundleAnalyzerPlugin({ analyzerMode: \u0026#39;static\u0026#39;, openAnalyzer: false }) ] æ€»ç»“ Vite å’Œ Webpack éƒ½æ˜¯ä¼˜ç§€çš„æ„å»ºå·¥å…·ï¼Œå„æœ‰å…¶é€‚ç”¨çš„åœºæ™¯ï¼š\nVite é€‚åˆæ–°é¡¹ç›®ã€è¿½æ±‚å¼€å‘ä½“éªŒçš„å›¢é˜Ÿ Webpack é€‚åˆå¤§å‹é¡¹ç›®ã€éœ€è¦é«˜åº¦å®šåˆ¶åŒ–çš„åœºæ™¯ é€‰æ‹©æ—¶éœ€è¦è€ƒè™‘é¡¹ç›®è§„æ¨¡ã€å›¢é˜ŸæŠ€æœ¯æ ˆã€é•¿æœŸç»´æŠ¤ç­‰å› ç´ ã€‚æ— è®ºé€‰æ‹©å“ªä¸ªå·¥å…·ï¼Œå…³æ³¨æ„å»ºæ€§èƒ½å’Œå¼€å‘æ•ˆç‡æ‰æ˜¯æœ€é‡è¦çš„ã€‚\nç›¸å…³å·¥å…·æ¨èï¼š\nJSON æ ¼å¼åŒ–å·¥å…· CSS æ ¼å¼åŒ–å·¥å…· Markdown ç¼–è¾‘å™¨ ","permalink":"/blog/articles/vite-vs-webpack-comparison/","summary":"æ·±å…¥å¯¹æ¯” Vite å’Œ Webpack ä¸¤å¤§ä¸»æµå‰ç«¯æ„å»ºå·¥å…·ï¼Œåˆ†æå„è‡ªçš„ä¼˜åŠ¿å’Œé€‚ç”¨åœºæ™¯","title":"Vite vs Webpackï¼šç°ä»£å‰ç«¯æ„å»ºå·¥å…·å¯¹æ¯”"},{"content":"å‰è¨€ TypeScript å·²ç»æˆä¸ºç°ä»£å‰ç«¯å¼€å‘çš„æ ‡é…ï¼Œå®ƒä¸º JavaScript æ·»åŠ äº†é™æ€ç±»å‹æ£€æŸ¥ï¼Œå¤§å¤§æå‡äº†ä»£ç çš„å¯ç»´æŠ¤æ€§å’Œå¼€å‘æ•ˆç‡ã€‚ç„¶è€Œï¼Œä»…ä»…ä½¿ç”¨ TypeScript æ˜¯ä¸å¤Ÿçš„ï¼ŒæŒæ¡æœ€ä½³å®è·µæ‰èƒ½çœŸæ­£å‘æŒ¥å®ƒçš„å¨åŠ›ã€‚\nç±»å‹å®šä¹‰æœ€ä½³å®è·µ 1. ä¼˜å…ˆä½¿ç”¨ç±»å‹è€Œéæ¥å£ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 // âœ… æ¨èï¼šä½¿ç”¨ type type User = { id: number; name: string; email: string; createdAt: Date; }; // âŒ é¿å…ï¼šé™¤ééœ€è¦ç»§æ‰¿æˆ–å£°æ˜åˆå¹¶ interface IUser { id: number; name: string; email: string; } 2. åˆç†ä½¿ç”¨æ³›å‹ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 // âœ… è‰¯å¥½çš„æ³›å‹è®¾è®¡ interface ApiResponse\u0026lt;T\u0026gt; { data: T; status: number; message: string; } async function fetchUser\u0026lt;T\u0026gt;(url: string): Promise\u0026lt;ApiResponse\u0026lt;T\u0026gt;\u0026gt; { const response = await fetch(url); return response.json(); } // ä½¿ç”¨ç¤ºä¾‹ type User = { id: number; name: string }; const userResponse = await fetchUser\u0026lt;User\u0026gt;(\u0026#39;/api/user/1\u0026#39;); 3. ä½¿ç”¨è”åˆç±»å‹å’Œå­—é¢é‡ç±»å‹ 1 2 3 4 5 6 7 8 9 10 11 12 13 // å®šä¹‰çŠ¶æ€ç±»å‹ type Status = \u0026#39;pending\u0026#39; | \u0026#39;success\u0026#39; | \u0026#39;error\u0026#39;; type ButtonProps = { variant: \u0026#39;primary\u0026#39; | \u0026#39;secondary\u0026#39; | \u0026#39;danger\u0026#39;; size: \u0026#39;small\u0026#39; | \u0026#39;medium\u0026#39; | \u0026#39;large\u0026#39;; onClick?: () =\u0026gt; void; }; // ä½¿ç”¨ const MyButton: React.FC\u0026lt;ButtonProps\u0026gt; = ({ variant, size, onClick }) =\u0026gt; { // å®ç°... }; é«˜çº§ç±»å‹æŠ€å·§ 1. æ¡ä»¶ç±»å‹ 1 2 3 4 5 6 7 8 // æ ¹æ®ç±»å‹å†³å®šè¿”å›ç±»å‹ type ApiResponse\u0026lt;T\u0026gt; = T extends string ? { message: T } : { data: T }; // ä½¿ç”¨ç¤ºä¾‹ type StringResponse = ApiResponse\u0026lt;string\u0026gt;; // { message: string } type DataResponse = ApiResponse\u0026lt;{ id: number }\u0026gt;; // { data: { id: number } } 2. æ˜ å°„ç±»å‹ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 // åˆ›å»ºæ‰€æœ‰å±æ€§ä¸ºå¯é€‰çš„ç±»å‹ type Partial\u0026lt;T\u0026gt; = { [P in keyof T]?: T[P]; }; // åˆ›å»ºæ‰€æœ‰å±æ€§ä¸ºåªè¯»çš„ç±»å‹ type Readonly\u0026lt;T\u0026gt; = { readonly [P in keyof T]: T[P]; }; // è‡ªå®šä¹‰æ˜ å°„ç±»å‹ type StringifyProperties\u0026lt;T\u0026gt; = { [K in keyof T]: string; }; type User = { id: number; name: string; age: number; }; type StringifiedUser = StringifyProperties\u0026lt;User\u0026gt;; // { id: string; name: string; age: string; } 3. æ¨¡æ¿å­—é¢é‡ç±»å‹ 1 2 3 4 5 6 7 8 9 10 // åŠ¨æ€ç”Ÿæˆå±æ€§å type EventNames = `on${Capitalize\u0026lt;string\u0026gt;}`; type UserEventNames = EventNames \u0026amp; `${string}UserChanged`; // ä½¿ç”¨ç¤ºä¾‹ const events: Record\u0026lt;UserEventNames, Function\u0026gt; = { onUserChanged: () =\u0026gt; {}, onUserDeleted: () =\u0026gt; {}, onUserCreated: () =\u0026gt; {} }; å·¥ç¨‹åŒ–é…ç½® 1. ä¸¥æ ¼çš„ tsconfig.json 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 { \u0026#34;compilerOptions\u0026#34;: { \u0026#34;strict\u0026#34;: true, \u0026#34;noImplicitAny\u0026#34;: true, \u0026#34;strictNullChecks\u0026#34;: true, \u0026#34;strictFunctionTypes\u0026#34;: true, \u0026#34;noImplicitReturns\u0026#34;: true, \u0026#34;noImplicitThis\u0026#34;: true, \u0026#34;noUnusedLocals\u0026#34;: true, \u0026#34;noUnusedParameters\u0026#34;: true, \u0026#34;exactOptionalPropertyTypes\u0026#34;: true, \u0026#34;noImplicitOverride\u0026#34;: true, \u0026#34;noPropertyAccessFromIndexSignature\u0026#34;: false, \u0026#34;noUncheckedIndexedAccess\u0026#34;: true }, \u0026#34;include\u0026#34;: [\u0026#34;src/**/*\u0026#34;], \u0026#34;exclude\u0026#34;: [\u0026#34;node_modules\u0026#34;] } 2. ESLint é›†æˆ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 // .eslintrc.js module.exports = { extends: [ \u0026#39;@typescript-eslint/recommended\u0026#39;, \u0026#39;@typescript-eslint/recommended-requiring-type-checking\u0026#39; ], rules: { \u0026#39;@typescript-eslint/no-unused-vars\u0026#39;: \u0026#39;error\u0026#39;, \u0026#39;@typescript-eslint/explicit-function-return-type\u0026#39;: \u0026#39;warn\u0026#39;, \u0026#39;@typescript-eslint/no-explicit-any\u0026#39;: \u0026#39;warn\u0026#39;, \u0026#39;@typescript-eslint/prefer-nullish-coalescing\u0026#39;: \u0026#39;error\u0026#39;, \u0026#39;@typescript-eslint/prefer-optional-chain\u0026#39;: \u0026#39;error\u0026#39; } }; å¸¸è§é™·é˜±å’Œè§£å†³æ–¹æ¡ˆ 1. ç±»å‹æ–­è¨€æ»¥ç”¨ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 // âŒ é¿å…ï¼šè¿‡åº¦ä½¿ç”¨ç±»å‹æ–­è¨€ const user = response as User; // âœ… æ¨èï¼šç±»å‹å®ˆå« function isUser(obj: any): obj is User { return typeof obj.id === \u0026#39;number\u0026#39; \u0026amp;\u0026amp; typeof obj.name === \u0026#39;string\u0026#39; \u0026amp;\u0026amp; typeof obj.email === \u0026#39;string\u0026#39;; } if (isUser(response)) { // TypeScript çŸ¥é“è¿™é‡Œ response æ˜¯ User ç±»å‹ console.log(response.name); } 2. any ç±»å‹çš„æ›¿ä»£æ–¹æ¡ˆ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 // âŒ é¿å…ï¼šä½¿ç”¨ any function processData(data: any) { return data.map((item: any) =\u0026gt; item.name); } // âœ… æ¨èï¼šä½¿ç”¨æ³›å‹ function processData\u0026lt;T extends { name: string }\u0026gt;(data: T[]): string[] { return data.map(item =\u0026gt; item.name); } // æˆ–è€…ä½¿ç”¨ unknown function processUnknownData(data: unknown) { if (Array.isArray(data)) { return data.filter((item): item is { name: string } =\u0026gt; typeof item === \u0026#39;object\u0026#39; \u0026amp;\u0026amp; item !== null \u0026amp;\u0026amp; \u0026#39;name\u0026#39; in item ).map(item =\u0026gt; item.name); } return []; } 3. å¤„ç†å¼‚æ­¥ä»£ç  1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 // âœ… è‰¯å¥½çš„å¼‚æ­¥ç±»å‹å®šä¹‰ type FetchOptions = { method?: \u0026#39;GET\u0026#39; | \u0026#39;POST\u0026#39; | \u0026#39;PUT\u0026#39; | \u0026#39;DELETE\u0026#39;; headers?: Record\u0026lt;string, string\u0026gt;; body?: unknown; }; async function apiRequest\u0026lt;T\u0026gt;( url: string, options: FetchOptions = {} ): Promise\u0026lt;{ data: T; success: boolean }\u0026gt; { const response = await fetch(url, { ...options, headers: { \u0026#39;Content-Type\u0026#39;: \u0026#39;application/json\u0026#39;, ...options.headers }, body: options.body ? JSON.stringify(options.body) : undefined }); if (!response.ok) { throw new Error(`API request failed: ${response.statusText}`); } const data = await response.json(); return { data, success: true }; } // ä½¿ç”¨ç¤ºä¾‹ type User = { id: number; name: string }; const { data: user, success } = await apiRequest\u0026lt;User\u0026gt;(\u0026#39;/api/user\u0026#39;); æ€§èƒ½ä¼˜åŒ– 1. ç±»å‹æ¨æ–­ä¼˜åŒ– 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 // âŒ é¿å…å¤æ‚çš„ç±»å‹è®¡ç®— type ComplexType\u0026lt;T\u0026gt; = { [K in keyof T]: T[K] extends string ? T[K] extends `${infer Prefix}_${infer Suffix}` ? { prefix: Prefix; suffix: Suffix } : T[K] : never; }; // âœ… ç®€åŒ–ç±»å‹å®šä¹‰ interface User { firstName: string; lastName: string; email: string; } type UserNameParts = { first: string; last: string; }; 2. æ¨¡å—åŒ–ç±»å‹ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 // types/user.ts export interface User { id: number; name: string; email: string; } export type UserDto = Omit\u0026lt;User, \u0026#39;id\u0026#39;\u0026gt; \u0026amp; { password: string; }; // types/api.ts import type { User } from \u0026#39;./user\u0026#39;; export interface ApiResponse\u0026lt;T\u0026gt; { data: T; status: number; message: string; } export type UserResponse = ApiResponse\u0026lt;User\u0026gt;; æµ‹è¯•å’Œç±»å‹ 1. ç±»å‹å®‰å…¨çš„æµ‹è¯• 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 // ä½¿ç”¨ç±»å‹æ–­è¨€è¿›è¡Œæµ‹è¯• import { expect, TypeOf } from \u0026#39;zod\u0026#39;; const UserSchema = z.object({ id: z.number(), name: z.string(), email: z.string().email() }); type User = TypeOf\u0026lt;typeof UserSchema\u0026gt;; // åœ¨æµ‹è¯•ä¸­ä½¿ç”¨ test(\u0026#39;user validation\u0026#39;, () =\u0026gt; { const userData = { id: 1, name: \u0026#39;John\u0026#39;, email: \u0026#39;john@example.com\u0026#39; }; const result = UserSchema.safeParse(userData); expect(result.success).toBe(true); if (result.success) { // result.data çš„ç±»å‹è¢«æ­£ç¡®æ¨æ–­ expectTypeOf(result.data).toEqualTypeOf\u0026lt;User\u0026gt;(); } }); æ€»ç»“ TypeScript çš„æœ€ä½³å®è·µå¯ä»¥å¸®åŠ©æˆ‘ä»¬æ„å»ºæ›´å®‰å…¨ã€æ›´å¯ç»´æŠ¤çš„åº”ç”¨ï¼š\nç±»å‹ä¼˜å…ˆï¼šåœ¨ç¼–å†™ä»£ç å‰å…ˆå®šä¹‰å¥½ç±»å‹ ä¸¥æ ¼æ¨¡å¼ï¼šå¯ç”¨æ‰€æœ‰ä¸¥æ ¼çš„ç±»å‹æ£€æŸ¥é€‰é¡¹ é¿å…ç±»å‹æ–­è¨€ï¼šä¼˜å…ˆä½¿ç”¨ç±»å‹å®ˆå«å’Œç±»å‹æ¨æ–­ æ¨¡å—åŒ–è®¾è®¡ï¼šåˆç†ç»„ç»‡ç±»å‹å®šä¹‰å’Œæ¥å£ æŒç»­å­¦ä¹ ï¼šå…³æ³¨ TypeScript æ–°ç‰¹æ€§å’Œæœ€ä½³å®è·µ é€šè¿‡éµå¾ªè¿™äº›æœ€ä½³å®è·µï¼Œæˆ‘ä»¬å¯ä»¥å……åˆ†å‘æŒ¥ TypeScript çš„ä¼˜åŠ¿ï¼Œæ„å»ºé«˜è´¨é‡çš„ TypeScript åº”ç”¨ã€‚\nç›¸å…³å·¥å…·ï¼š\nTypeScript Playground JSON è½¬ TypeScript æ¥å£å·¥å…· ","permalink":"/blog/articles/typescript-best-practices/","summary":"åˆ†äº« TypeScript å¼€å‘ä¸­çš„æœ€ä½³å®è·µï¼Œå¸®åŠ©å›¢é˜Ÿæ„å»ºç±»å‹å®‰å…¨ã€å¯ç»´æŠ¤çš„å‰ç«¯åº”ç”¨","title":"TypeScript æœ€ä½³å®è·µï¼šæ„å»ºç±»å‹å®‰å…¨çš„å‰ç«¯åº”ç”¨"},{"content":"å‰è¨€ React åº”ç”¨çš„æ€§èƒ½ä¼˜åŒ–æ˜¯æ¯ä¸ªå‰ç«¯å¼€å‘è€…éƒ½éœ€è¦æŒæ¡çš„æ ¸å¿ƒæŠ€èƒ½ã€‚éšç€åº”ç”¨å¤æ‚åº¦çš„å¢åŠ ï¼Œæ€§èƒ½é—®é¢˜ä¼šé€æ¸æ˜¾ç°ã€‚æœ¬æ–‡å°†ä»ç†è®ºå’Œå®è·µä¸¤ä¸ªç»´åº¦ï¼Œå…¨é¢ä»‹ç» React æ€§èƒ½ä¼˜åŒ–çš„å„ç§æŠ€å·§ã€‚\nReact æ¸²æŸ“æœºåˆ¶å›é¡¾ è™šæ‹Ÿ DOM çš„å·¥ä½œåŸç† React ä½¿ç”¨è™šæ‹Ÿ DOM æ¥é«˜æ•ˆæ›´æ–°çœŸå® DOMï¼Œä½†è¿™ä¸ªè¿‡ç¨‹ä¸­ä»æœ‰å¯èƒ½å‡ºç°æ€§èƒ½ç“¶é¢ˆï¼š\nç»„ä»¶é‡æ–°æ¸²æŸ“ï¼šå½“ state æˆ– props æ”¹å˜æ—¶ Diff ç®—æ³•ï¼šæ¯”è¾ƒæ–°æ—§è™šæ‹Ÿ DOM æ ‘ æ‰¹é‡æ›´æ–°ï¼šReact 18 çš„è‡ªåŠ¨æ‰¹å¤„ç†æœºåˆ¶ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 // ç†è§£ React çš„æ¸²æŸ“è§¦å‘ function MyComponent() { const [count, setCount] = useState(0); const [name, setName] = useState(\u0026#39;\u0026#39;); // æ¯æ¬¡ count æˆ– name æ”¹å˜éƒ½ä¼šè§¦å‘é‡æ–°æ¸²æŸ“ console.log(\u0026#39;ç»„ä»¶é‡æ–°æ¸²æŸ“\u0026#39;); return ( \u0026lt;div\u0026gt; \u0026lt;button onClick={() =\u0026gt; setCount(c =\u0026gt; c + 1)}\u0026gt; ç‚¹å‡»æ¬¡æ•°: {count} \u0026lt;/button\u0026gt; \u0026lt;input value={name} onChange={(e) =\u0026gt; setName(e.target.value)} /\u0026gt; \u0026lt;/div\u0026gt; ); } ç»„ä»¶çº§ä¼˜åŒ– 1. React.memo ä¼˜åŒ– 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 // âŒ æ²¡æœ‰ä¼˜åŒ–ï¼šæ¯æ¬¡çˆ¶ç»„ä»¶æ¸²æŸ“éƒ½ä¼šé‡æ–°åˆ›å»º const ExpensiveComponent = ({ data }) =\u0026gt; { const processedData = useMemo(() =\u0026gt; { // è€—æ—¶çš„æ•°æ®å¤„ç† return data.map(item =\u0026gt; ({ ...item, processed: heavyProcessing(item) })); }, [data]); return \u0026lt;div\u0026gt;{/* æ¸²æŸ“å¤„ç†åçš„æ•°æ® */}\u0026lt;/div\u0026gt;; }; // âœ… ä½¿ç”¨ React.memo ä¼˜åŒ– const OptimizedExpensiveComponent = React.memo(({ data }) =\u0026gt; { const processedData = useMemo(() =\u0026gt; { return data.map(item =\u0026gt; ({ ...item, processed: heavyProcessing(item) })); }, [data]); return \u0026lt;div\u0026gt;{/* æ¸²æŸ“å¤„ç†åçš„æ•°æ® */}\u0026lt;/div\u0026gt;; }, (prevProps, nextProps) =\u0026gt; { // è‡ªå®šä¹‰æ¯”è¾ƒå‡½æ•° return prevProps.data.length === nextProps.data.length \u0026amp;\u0026amp; prevProps.data.every((item, index) =\u0026gt; item.id === nextProps.data[index].id ); }); 2. useMemo å’Œ useCallback 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 function ParentComponent() { const [count, setCount] = useState(0); const [items, setItems] = useState([]); // âœ… ä½¿ç”¨ useMemo ç¼“å­˜è®¡ç®—ç»“æœ const expensiveValue = useMemo(() =\u0026gt; { console.log(\u0026#39;æ‰§è¡Œæ˜‚è´µè®¡ç®—...\u0026#39;); return items.reduce((sum, item) =\u0026gt; sum + item.value, 0); }, [items]); // âœ… ä½¿ç”¨ useCallback ç¼“å­˜å‡½æ•° const handleItemClick = useCallback((itemId) =\u0026gt; { setItems(prevItems =\u0026gt; prevItems.map(item =\u0026gt; item.id === itemId ? { ...item, clicked: !item.clicked } : item ) ); }, []); // ç©ºä¾èµ–æ•°ç»„ï¼Œå‡½æ•°æ°¸è¿œä¸ä¼šæ”¹å˜ return ( \u0026lt;div\u0026gt; \u0026lt;button onClick={() =\u0026gt; setCount(c =\u0026gt; c + 1)}\u0026gt; Count: {count} \u0026lt;/button\u0026gt; \u0026lt;ChildComponent total={expensiveValue} onItemClick={handleItemClick} /\u0026gt; \u0026lt;/div\u0026gt; ); } const ChildComponent = React.memo(({ total, onItemClick }) =\u0026gt; { console.log(\u0026#39;å­ç»„ä»¶é‡æ–°æ¸²æŸ“\u0026#39;); return ( \u0026lt;div\u0026gt; \u0026lt;p\u0026gt;æ€»è®¡: {total}\u0026lt;/p\u0026gt; {/* æ¸²æŸ“é¡¹ç›®åˆ—è¡¨ */} \u0026lt;/div\u0026gt; ); }); 3. ç»„ä»¶æ‹†åˆ†å’Œæ‡’åŠ è½½ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 // âœ… å°†å¤§ç»„ä»¶æ‹†åˆ†æˆå°ç»„ä»¶ const UserProfile = ({ user }) =\u0026gt; ( \u0026lt;div\u0026gt; \u0026lt;Avatar src={user.avatar} /\u0026gt; \u0026lt;UserInfo name={user.name} email={user.email} /\u0026gt; \u0026lt;UserStats stats={user.stats} /\u0026gt; \u0026lt;/div\u0026gt; ); // ä½¿ç”¨ React.lazy è¿›è¡Œä»£ç åˆ†å‰² const LazyChart = React.lazy(() =\u0026gt; import(\u0026#39;./Chart\u0026#39;)); function Dashboard() { const [showChart, setShowChart] = useState(false); return ( \u0026lt;div\u0026gt; \u0026lt;h1\u0026gt;ä»ªè¡¨æ¿\u0026lt;/h1\u0026gt; {/* å…¶ä»–å†…å®¹ */} {showChart \u0026amp;\u0026amp; ( \u0026lt;React.Suspense fallback={\u0026lt;div\u0026gt;åŠ è½½å›¾è¡¨...\u0026lt;/div\u0026gt;}\u0026gt; \u0026lt;LazyChart data={chartData} /\u0026gt; \u0026lt;/React.Suspense\u0026gt; )} \u0026lt;button onClick={() =\u0026gt; setShowChart(true)}\u0026gt; æ˜¾ç¤ºå›¾è¡¨ \u0026lt;/button\u0026gt; \u0026lt;/div\u0026gt; ); } çŠ¶æ€ç®¡ç†ä¼˜åŒ– 1. Context ä¼˜åŒ– 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 // âŒ é¿å…å°†é¢‘ç¹å˜åŒ–çš„çŠ¶æ€æ”¾åœ¨ Context ä¸­ const BadContext = createContext(); function BadProvider({ children }) { const [mousePosition, setMousePosition] = useState({ x: 0, y: 0 }); useEffect(() =\u0026gt; { const handleMouseMove = (e) =\u0026gt; { setMousePosition({ x: e.clientX, y: e.clientY }); }; window.addEventListener(\u0026#39;mousemove\u0026#39;, handleMouseMove); return () =\u0026gt; window.removeEventListener(\u0026#39;mousemove\u0026#39;, handleMouseMove); }, []); return ( \u0026lt;BadContext.Provider value={mousePosition}\u0026gt; {children} \u0026lt;/BadContext.Provider\u0026gt; ); } // âœ… ä½¿ç”¨åˆ†ç¦»çš„ Context const UserContext = createContext(); const ThemeContext = createContext(); function GoodProvider({ children }) { const [user, setUser] = useState(null); const [theme, setTheme] = useState(\u0026#39;light\u0026#39;); // å°†çŠ¶æ€åˆ†ç¦»åˆ°ä¸åŒçš„ Context ä¸­ return ( \u0026lt;UserContext.Provider value={{ user, setUser }}\u0026gt; \u0026lt;ThemeContext.Provider value={{ theme, setTheme }}\u0026gt; {children} \u0026lt;/ThemeContext.Provider\u0026gt; \u0026lt;/UserContext.Provider\u0026gt; ); } // ä½¿ç”¨è‡ªå®šä¹‰ Hook æ¥æ¶ˆè´¹ Context function useUser() { const context = useContext(UserContext); if (!context) { throw new Error(\u0026#39;useUser must be used within UserProvider\u0026#39;); } return context; } 2. çŠ¶æ€å½’ä¸€åŒ– 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 // âŒ åµŒå¥—çŠ¶æ€éš¾ä»¥ç»´æŠ¤ const [badState, setBadState] = useState({ users: { \u0026#39;1\u0026#39;: { id: \u0026#39;1\u0026#39;, name: \u0026#39;John\u0026#39;, posts: [ { id: \u0026#39;1\u0026#39;, title: \u0026#39;Hello\u0026#39;, comments: [] }, { id: \u0026#39;2\u0026#39;, title: \u0026#39;World\u0026#39;, comments: [] } ] } } }); // âœ… å½’ä¸€åŒ–çŠ¶æ€ç»“æ„ const [goodState, setGoodState] = useState({ users: { \u0026#39;1\u0026#39;: { id: \u0026#39;1\u0026#39;, name: \u0026#39;John\u0026#39;, postIds: [\u0026#39;1\u0026#39;, \u0026#39;2\u0026#39;] } }, posts: { \u0026#39;1\u0026#39;: { id: \u0026#39;1\u0026#39;, title: \u0026#39;Hello\u0026#39;, userId: \u0026#39;1\u0026#39;, commentIds: [] }, \u0026#39;2\u0026#39;: { id: \u0026#39;2\u0026#39;, title: \u0026#39;World\u0026#39;, userId: \u0026#39;1\u0026#39;, commentIds: [] } }, comments: {} }); // ä½¿ç”¨ Immer ç®€åŒ–çŠ¶æ€æ›´æ–° import { produce } from \u0026#39;immer\u0026#39;; const addUserPost = (userId, post) =\u0026gt; { setGoodState(prevState =\u0026gt; produce(prevState, draft =\u0026gt; { draft.posts[post.id] = post; draft.users[userId].postIds.push(post.id); }) ); }; æ¸²æŸ“ä¼˜åŒ– 1. è™šæ‹Ÿåˆ—è¡¨ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 // ä½¿ç”¨ react-window å®ç°è™šæ‹Ÿåˆ—è¡¨ import { FixedSizeList as List } from \u0026#39;react-window\u0026#39;; const VirtualizedList = ({ items }) =\u0026gt; { const Row = ({ index, style }) =\u0026gt; ( \u0026lt;div style={style}\u0026gt; \u0026lt;ListItem item={items[index]} /\u0026gt; \u0026lt;/div\u0026gt; ); return ( \u0026lt;List height={600} itemCount={items.length} itemSize={80} width=\u0026#34;100%\u0026#34; \u0026gt; {Row} \u0026lt;/List\u0026gt; ); }; // æˆ–è€…è‡ªå·±å®ç°ç®€å•çš„è™šæ‹Ÿåˆ—è¡¨ function SimpleVirtualList({ items, itemHeight, containerHeight }) { const [scrollTop, setScrollTop] = useState(0); const startIndex = Math.floor(scrollTop / itemHeight); const endIndex = Math.min( startIndex + Math.ceil(containerHeight / itemHeight) + 1, items.length - 1 ); const visibleItems = items.slice(startIndex, endIndex + 1); return ( \u0026lt;div style={{ height: containerHeight, overflow: \u0026#39;auto\u0026#39; }} onScroll={(e) =\u0026gt; setScrollTop(e.target.scrollTop)} \u0026gt; \u0026lt;div style={{ height: items.length * itemHeight, position: \u0026#39;relative\u0026#39; }}\u0026gt; {visibleItems.map((item, index) =\u0026gt; ( \u0026lt;div key={startIndex + index} style={{ position: \u0026#39;absolute\u0026#39;, top: (startIndex + index) * itemHeight, height: itemHeight, width: \u0026#39;100%\u0026#39; }} \u0026gt; \u0026lt;ListItem item={item} /\u0026gt; \u0026lt;/div\u0026gt; ))} \u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; ); } 2. å›¾ç‰‡ä¼˜åŒ– 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 // å›¾ç‰‡æ‡’åŠ è½½ç»„ä»¶ const LazyImage = ({ src, alt, placeholder, ...props }) =\u0026gt; { const [isLoaded, setIsLoaded] = useState(false); const [isInView, setIsInView] = useState(false); const imgRef = useRef(); useEffect(() =\u0026gt; { const observer = new IntersectionObserver( ([entry]) =\u0026gt; { if (entry.isIntersecting) { setIsInView(true); observer.disconnect(); } }, { threshold: 0.1 } ); if (imgRef.current) { observer.observe(imgRef.current); } return () =\u0026gt; observer.disconnect(); }, []); return ( \u0026lt;div ref={imgRef} {...props}\u0026gt; {isInView \u0026amp;\u0026amp; ( \u0026lt;img src={src} alt={alt} onLoad={() =\u0026gt; setIsLoaded(true)} style={{ opacity: isLoaded ? 1 : 0, transition: \u0026#39;opacity 0.3s ease\u0026#39; }} /\u0026gt; )} {!isLoaded \u0026amp;\u0026amp; placeholder \u0026amp;\u0026amp; ( \u0026lt;div\u0026gt;{placeholder}\u0026lt;/div\u0026gt; )} \u0026lt;/div\u0026gt; ); }; // å“åº”å¼å›¾ç‰‡ç»„ä»¶ const ResponsiveImage = ({ sources, alt, ...props }) =\u0026gt; { return ( \u0026lt;picture\u0026gt; {sources.map((source, index) =\u0026gt; ( \u0026lt;source key={index} srcSet={source.srcSet} media={source.media} type={source.type} /\u0026gt; ))} \u0026lt;img src={sources[sources.length - 1].src} alt={alt} loading=\u0026#34;lazy\u0026#34; {...props} /\u0026gt; \u0026lt;/picture\u0026gt; ); }; æ€§èƒ½ç›‘æ§å’Œè°ƒè¯• 1. React DevTools Profiler 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 // ä½¿ç”¨ Profiler API è¿›è¡Œæ€§èƒ½ç›‘æ§ import { Profiler } from \u0026#39;react\u0026#39;; const onRenderCallback = (id, phase, actualDuration) =\u0026gt; { console.log(\u0026#39;ç»„ä»¶æ¸²æŸ“æ€§èƒ½:\u0026#39;, { id, phase, // \u0026#39;mount\u0026#39; or \u0026#39;update\u0026#39; actualDuration // å®é™…æ¸²æŸ“æ—¶é—´ }); }; function App() { return ( \u0026lt;Profiler id=\u0026#34;App\u0026#34; onRender={onRenderCallback}\u0026gt; \u0026lt;MyComponent /\u0026gt; \u0026lt;/Profiler\u0026gt; ); } 2. è‡ªå®šä¹‰æ€§èƒ½ Hook 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 // æ€§èƒ½ç›‘æ§ Hook function useRenderCounter(componentName) { const renderCount = useRef(0); useEffect(() =\u0026gt; { renderCount.current += 1; console.log(`${componentName} æ¸²æŸ“æ¬¡æ•°:`, renderCount.current); }); return renderCount.current; } // ä½¿ç”¨ç¤ºä¾‹ function MyComponent() { const renderCount = useRenderCounter(\u0026#39;MyComponent\u0026#39;); return \u0026lt;div\u0026gt;æ¸²æŸ“æ¬¡æ•°: {renderCount}\u0026lt;/div\u0026gt;; } // æ€§èƒ½æ—¶é—´æµ‹é‡ Hook function usePerformanceLog(name, deps) { useEffect(() =\u0026gt; { const startTime = performance.now(); return () =\u0026gt; { const endTime = performance.now(); console.log(`${name} è€—æ—¶:`, endTime - startTime, \u0026#39;ms\u0026#39;); }; }, deps); } æœ€ä½³å®è·µæ€»ç»“ 1. ç»„ä»¶è®¾è®¡åŸåˆ™ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 // âœ… å•ä¸€èŒè´£åŸåˆ™ const UserAvatar = ({ user, size }) =\u0026gt; ( \u0026lt;img src={user.avatar} alt={user.name} width={size} height={size} /\u0026gt; ); const UserInfo = ({ user }) =\u0026gt; ( \u0026lt;div\u0026gt; \u0026lt;h3\u0026gt;{user.name}\u0026lt;/h3\u0026gt; \u0026lt;p\u0026gt;{user.email}\u0026lt;/p\u0026gt; \u0026lt;/div\u0026gt; ); // âœ… ç»„åˆè€Œéç»§æ‰¿ const Card = ({ children, className, ...props }) =\u0026gt; ( \u0026lt;div className={`card ${className}`} {...props}\u0026gt; {children} \u0026lt;/div\u0026gt; ); const UserCard = ({ user }) =\u0026gt; ( \u0026lt;Card\u0026gt; \u0026lt;UserAvatar user={user} size={64} /\u0026gt; \u0026lt;UserInfo user={user} /\u0026gt; \u0026lt;/Card\u0026gt; ); 2. æ€§èƒ½ä¼˜åŒ–æ£€æŸ¥æ¸…å• ç»„ä»¶æ˜¯å¦è¿‡åº¦æ¸²æŸ“ï¼Ÿ æ˜¯å¦æ­£ç¡®ä½¿ç”¨ React.memoï¼Ÿ æ˜¯å¦éœ€è¦ä½¿ç”¨ useMemo/useCallbackï¼Ÿ çŠ¶æ€ç»“æ„æ˜¯å¦åˆç†ï¼Ÿ æ˜¯å¦ä½¿ç”¨äº†ä»£ç åˆ†å‰²ï¼Ÿ å›¾ç‰‡å’Œèµ„æºæ˜¯å¦ä¼˜åŒ–ï¼Ÿ æ˜¯å¦æœ‰å†…å­˜æ³„æ¼ï¼Ÿ 3. æŒç»­ä¼˜åŒ–ç­–ç•¥ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 // æ€§èƒ½é¢„ç®—è®¾ç½® const PERFORMANCE_BUDGET = { firstContentfulPaint: 1.5, // ç§’ largestContentfulPaint: 2.5, firstInputDelay: 100, // æ¯«ç§’ cumulativeLayoutShift: 0.1 }; // æ€§èƒ½ç›‘æ§å·¥å…· function usePerformanceMonitoring() { useEffect(() =\u0026gt; { if (\u0026#39;PerformanceObserver\u0026#39; in window) { const observer = new PerformanceObserver((list) =\u0026gt; { for (const entry of list.getEntries()) { if (entry.entryType === \u0026#39;largest-contentful-paint\u0026#39;) { console.log(\u0026#39;LCP:\u0026#39;, entry.startTime); } } }); observer.observe({ entryTypes: [\u0026#39;largest-contentful-paint\u0026#39;] }); return () =\u0026gt; observer.disconnect(); } }, []); } æ€»ç»“ React æ€§èƒ½ä¼˜åŒ–æ˜¯ä¸€ä¸ªæŒç»­çš„è¿‡ç¨‹ï¼Œéœ€è¦ä»å¤šä¸ªç»´åº¦è€ƒè™‘ï¼š\nç»„ä»¶å±‚é¢ï¼šåˆç†ä½¿ç”¨ memoã€useMemoã€useCallback çŠ¶æ€ç®¡ç†ï¼šä¼˜åŒ– Context ä½¿ç”¨ï¼Œå½’ä¸€åŒ–çŠ¶æ€ç»“æ„ æ¸²æŸ“ä¼˜åŒ–ï¼šè™šæ‹Ÿåˆ—è¡¨ã€å›¾ç‰‡æ‡’åŠ è½½ã€ä»£ç åˆ†å‰² ç›‘æ§è°ƒè¯•ï¼šä½¿ç”¨ Profiler å’Œæ€§èƒ½å·¥å…·æŒç»­ä¼˜åŒ– è®°ä½ï¼Œè¿‡æ—©ä¼˜åŒ–æ˜¯ä¸‡æ¶ä¹‹æºã€‚å…ˆç¡®ä¿ä»£ç æ­£ç¡®æ€§ï¼Œå†åœ¨æœ‰æ€§èƒ½ç“¶é¢ˆçš„åœ°æ–¹è¿›è¡Œé’ˆå¯¹æ€§ä¼˜åŒ–ã€‚\nç›¸å…³å·¥å…·æ¨èï¼š\nReact æ€§èƒ½åˆ†æå·¥å…· Bundle Analyzer Lighthouse ","permalink":"/blog/articles/react-performance-optimization/","summary":"æ·±å…¥æ¢è®¨ React åº”ç”¨æ€§èƒ½ä¼˜åŒ–çš„å„ç§æŠ€å·§ï¼ŒåŒ…æ‹¬ç»„ä»¶ä¼˜åŒ–ã€çŠ¶æ€ç®¡ç†ä¼˜åŒ–å’Œæ¸²æŸ“ä¼˜åŒ–","title":"React æ€§èƒ½ä¼˜åŒ–å®æˆ˜ï¼šä»ç†è®ºåˆ°å®è·µ"},{"content":"å‰è¨€ Vue 3 å¼•å…¥çš„ Composition API æ˜¯ä¸€ä¸ªé©å‘½æ€§çš„ç‰¹æ€§ï¼Œå®ƒæä¾›äº†ä¸€ç§æ›´çµæ´»ã€æ›´å¼ºå¤§çš„ç»„ä»¶é€»è¾‘ç»„ç»‡æ–¹å¼ã€‚ç›¸æ¯” Options APIï¼ŒComposition API å…·æœ‰æ›´å¥½çš„ç±»å‹æ¨å¯¼ã€é€»è¾‘å¤ç”¨å’Œä»£ç ç»„ç»‡èƒ½åŠ›ã€‚\nä¸ºä»€ä¹ˆéœ€è¦ Composition APIï¼Ÿ Options API çš„å±€é™æ€§ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 // Options API - é€»è¾‘åˆ†æ•£ export default { data() { return { count: 0, loading: false, items: [] } }, methods: { increment() { this.count++ }, async fetchItems() { this.loading = true try { this.items = await api.getItems() } finally { this.loading = false } } }, mounted() { this.fetchItems() } } Composition API çš„ä¼˜åŠ¿ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 // Composition API - é€»è¾‘é›†ä¸­ import { ref, onMounted } from \u0026#39;vue\u0026#39; export default { setup() { // è®¡æ•°å™¨é€»è¾‘ const count = ref(0) const increment = () =\u0026gt; count.value++ // æ•°æ®è·å–é€»è¾‘ const loading = ref(false) const items = ref([]) const fetchItems = async () =\u0026gt; { loading.value = true try { items.value = await api.getItems() } finally { loading.value = false } } onMounted(fetchItems) return { count, increment, loading, items, fetchItems } } } æ ¸å¿ƒ API è¯¦è§£ 1. ref å’Œ reactive 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 import { ref, reactive, isRef, unref } from \u0026#39;vue\u0026#39; // ref - é€‚ç”¨äºåŸºæœ¬ç±»å‹ const count = ref(0) const message = ref(\u0026#39;Hello\u0026#39;) // è®¿é—®å€¼éœ€è¦ .value console.log(count.value) // 0 count.value = 1 // reactive - é€‚ç”¨äºå¯¹è±¡ const state = reactive({ count: 0, user: { name: \u0026#39;John\u0026#39;, age: 30 } }) // ç›´æ¥è®¿é—®å±æ€§ï¼Œæ— éœ€ .value console.log(state.count) // 0 state.user.name = \u0026#39;Jane\u0026#39; // ç±»å‹æ£€æŸ¥ if (isRef(count)) { console.log(\u0026#39;è¿™æ˜¯ä¸€ä¸ª ref\u0026#39;) } // è·å– ref çš„åŸå§‹å€¼ const rawValue = unref(count) 2. computed å’Œ watch 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 import { ref, computed, watch, watchEffect } from \u0026#39;vue\u0026#39; export default { setup() { const firstName = ref(\u0026#39;John\u0026#39;) const lastName = ref(\u0026#39;Doe\u0026#39;) // è®¡ç®—å±æ€§ const fullName = computed(() =\u0026gt; `${firstName.value} ${lastName.value}`) // å¯å†™çš„è®¡ç®—å±æ€§ const fullNameWritable = computed({ get: () =\u0026gt; `${firstName.value} ${lastName.value}`, set: (value) =\u0026gt; { const names = value.split(\u0026#39; \u0026#39;) firstName.value = names[0] lastName.value = names[1] } }) // ç›‘å¬å•ä¸ª ref watch(firstName, (newVal, oldVal) =\u0026gt; { console.log(`firstName changed from ${oldVal} to ${newVal}`) }) // ç›‘å¬å¤šä¸ªæº watch( [firstName, lastName], ([newFirst, newLast], [oldFirst, oldLast]) =\u0026gt; { console.log(\u0026#39;Names changed:\u0026#39;, { newFirst, newLast }) } ) // æ·±åº¦ç›‘å¬å¯¹è±¡ const user = reactive({ name: \u0026#39;John\u0026#39;, details: { age: 30 } }) watch( user, (newUser, oldUser) =\u0026gt; { console.log(\u0026#39;User changed:\u0026#39;, newUser) }, { deep: true } ) // ç«‹å³æ‰§è¡Œçš„ watch watchEffect(() =\u0026gt; { console.log(`Current full name: ${fullName.value}`) }) return { firstName, lastName, fullName, fullNameWritable } } } 3. ç”Ÿå‘½å‘¨æœŸé’©å­ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 import { onMounted, onUnmounted, onBeforeMount, onBeforeUnmount, onUpdated, onBeforeUpdate, onErrorCaptured } from \u0026#39;vue\u0026#39; export default { setup() { // ç»„ä»¶æŒ‚è½½å‰ onBeforeMount(() =\u0026gt; { console.log(\u0026#39;Component is about to mount\u0026#39;) }) // ç»„ä»¶æŒ‚è½½å onMounted(() =\u0026gt; { console.log(\u0026#39;Component mounted\u0026#39;) // DOM æ“ä½œã€API è°ƒç”¨ç­‰ }) // ç»„ä»¶æ›´æ–°å‰ onBeforeUpdate(() =\u0026gt; { console.log(\u0026#39;Component is about to update\u0026#39;) }) // ç»„ä»¶æ›´æ–°å onUpdated(() =\u0026gt; { console.log(\u0026#39;Component updated\u0026#39;) }) // ç»„ä»¶å¸è½½å‰ onBeforeUnmount(() =\u0026gt; { console.log(\u0026#39;Component is about to unmount\u0026#39;) }) // ç»„ä»¶å¸è½½å onUnmounted(() =\u0026gt; { console.log(\u0026#39;Component unmounted\u0026#39;) // æ¸…ç†å®šæ—¶å™¨ã€äº‹ä»¶ç›‘å¬å™¨ç­‰ }) // é”™è¯¯æ•è· onErrorCaptured((err, instance, info) =\u0026gt; { console.error(\u0026#39;Error captured:\u0026#39;, err) return false // é˜»æ­¢é”™è¯¯ç»§ç»­å‘ä¸Šä¼ æ’­ }) } } è‡ªå®šä¹‰ Hooks 1. åˆ›å»ºå¯å¤ç”¨çš„é€»è¾‘ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 // composables/useCounter.js import { ref, computed } from \u0026#39;vue\u0026#39; export function useCounter(initialValue = 0) { const count = ref(initialValue) const increment = (delta = 1) =\u0026gt; { count.value += delta } const decrement = (delta = 1) =\u0026gt; { count.value -= delta } const reset = () =\u0026gt; { count.value = initialValue } const isEven = computed(() =\u0026gt; count.value % 2 === 0) const isOdd = computed(() =\u0026gt; !isEven.value) return { count, increment, decrement, reset, isEven, isOdd } } // ä½¿ç”¨è‡ªå®šä¹‰ Hook import { useCounter } from \u0026#39;@/composables/useCounter\u0026#39; export default { setup() { const { count, increment, decrement, isEven } = useCounter(10) return { count, increment, decrement, isEven } } } 2. æ•°æ®è·å– Hook 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 // composables/useFetch.js import { ref, onMounted, onUnmounted } from \u0026#39;vue\u0026#39; export function useFetch(url, options = {}) { const data = ref(null) const error = ref(null) const loading = ref(false) let controller = null const execute = async (requestUrl = url, requestOptions = options) =\u0026gt; { loading.value = true error.value = null try { // å–æ¶ˆä¹‹å‰çš„è¯·æ±‚ if (controller) { controller.abort() } controller = new AbortController() const response = await fetch(requestUrl, { ...requestOptions, signal: controller.signal }) if (!response.ok) { throw new Error(`HTTP error! status: ${response.status}`) } data.value = await response.json() } catch (err) { if (err.name !== \u0026#39;AbortError\u0026#39;) { error.value = err.message } } finally { loading.value = false } } onMounted(() =\u0026gt; { execute() }) onUnmounted(() =\u0026gt; { if (controller) { controller.abort() } }) return { data, error, loading, execute } } // ä½¿ç”¨æ•°æ®è·å– Hook import { useFetch } from \u0026#39;@/composables/useFetch\u0026#39; export default { setup() { const { data: users, loading, error } = useFetch(\u0026#39;/api/users\u0026#39;) return { users, loading, error } } } 3. æœ¬åœ°å­˜å‚¨ Hook 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 // composables/useLocalStorage.js import { ref, watch } from \u0026#39;vue\u0026#39; export function useLocalStorage(key, defaultValue) { const storedValue = localStorage.getItem(key) const value = ref(storedValue ? JSON.parse(storedValue) : defaultValue) // ç›‘å¬å€¼çš„å˜åŒ–ï¼ŒåŒæ­¥åˆ° localStorage watch( value, (newValue) =\u0026gt; { if (newValue === null || newValue === undefined) { localStorage.removeItem(key) } else { localStorage.setItem(key, JSON.stringify(newValue)) } }, { deep: true } ) return value } // ä½¿ç”¨ç¤ºä¾‹ export default { setup() { const theme = useLocalStorage(\u0026#39;theme\u0026#39;, \u0026#39;light\u0026#39;) const userPreferences = useLocalStorage(\u0026#39;preferences\u0026#39;, { language: \u0026#39;zh-CN\u0026#39;, fontSize: 16 }) return { theme, userPreferences } } } ä¸ TypeScript çš„å®Œç¾ç»“åˆ 1. ç±»å‹å®šä¹‰ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 import { ref, reactive, computed, Ref } from \u0026#39;vue\u0026#39; // å®šä¹‰æ¥å£ interface User { id: number name: string email: string avatar?: string } interface Post { id: number title: string content: string authorId: number createdAt: Date } // ä½¿ç”¨ç±»å‹æ³¨è§£ export default { setup() { const user: Ref\u0026lt;User | null\u0026gt; = ref(null) const users = ref\u0026lt;User[]\u0026gt;([]) const currentUser = computed((): User | null =\u0026gt; { return user.value }) const state = reactive\u0026lt;{ loading: boolean error: string | null selectedUserId: number | null }\u0026gt;({ loading: false, error: null, selectedUserId: null }) return { user, users, currentUser, state } } } 2. æ³›å‹ Hooks 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 // composables/useApi.ts import { ref } from \u0026#39;vue\u0026#39; interface ApiResponse\u0026lt;T\u0026gt; { data: T message: string status: number } export function useApi\u0026lt;T\u0026gt;(url: string) { const data = ref\u0026lt;T | null\u0026gt;(null) const loading = ref(false) const error = ref\u0026lt;string | null\u0026gt;(null) const execute = async (): Promise\u0026lt;void\u0026gt; =\u0026gt; { loading.value = true error.value = null try { const response = await fetch(url) const result: ApiResponse\u0026lt;T\u0026gt; = await response.json() if (result.status === 200) { data.value = result.data } else { error.value = result.message } } catch (err) { error.value = err instanceof Error ? err.message : \u0026#39;Unknown error\u0026#39; } finally { loading.value = false } } return { data, loading, error, execute } } // ä½¿ç”¨æ³›å‹ Hook interface Todo { id: number title: string completed: boolean } export default { setup() { const { data: todos, loading } = useApi\u0026lt;Todo[]\u0026gt;(\u0026#39;/api/todos\u0026#39;) return { todos, loading } } } æ€§èƒ½ä¼˜åŒ–æŠ€å·§ 1. é¿å…ä¸å¿…è¦çš„å“åº”å¼ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 import { ref, markRaw, shallowRef } from \u0026#39;vue\u0026#39; // ä½¿ç”¨ markRaw æ ‡è®°ä¸éœ€è¦å“åº”å¼çš„å¯¹è±¡ const bigStaticData = markRaw({ // å¤§å‹é™æ€æ•°æ®ï¼Œä¸éœ€è¦å“åº”å¼ items: Array(10000).fill(0).map((_, i) =\u0026gt; ({ id: i })) }) // ä½¿ç”¨ shallowRef åˆ›å»ºæµ…å±‚å“åº”å¼ const shallowState = shallowRef({ count: 0, deep: { nested: \u0026#39;value\u0026#39; } }) // åªæœ‰æ•´ä¸ªå¯¹è±¡çš„æ›¿æ¢ä¼šè§¦å‘æ›´æ–° shallowState.value = { count: 1, deep: { nested: \u0026#39;new\u0026#39; } } // shallowState.value.count = 2 ä¸ä¼šè§¦å‘æ›´æ–° 2. è®¡ç®—å±æ€§ç¼“å­˜ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 import { computed } from \u0026#39;vue\u0026#39; export default { setup() { const items = ref([]) const filter = ref(\u0026#39;\u0026#39;) // ç¼“å­˜è®¡ç®—ç»“æœï¼Œåªæœ‰ä¾èµ–å˜åŒ–æ—¶é‡æ–°è®¡ç®— const filteredItems = computed(() =\u0026gt; { console.log(\u0026#39;Filtering items...\u0026#39;) return items.value.filter(item =\u0026gt; item.name.toLowerCase().includes(filter.value.toLowerCase()) ) }) return { items, filter, filteredItems } } } 3. æ‡’åŠ è½½ç»„ä»¶ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 import { defineAsyncComponent } from \u0026#39;vue\u0026#39; // å¼‚æ­¥ç»„ä»¶ const AsyncComponent = defineAsyncComponent(() =\u0026gt; import(\u0026#39;./HeavyComponent.vue\u0026#39;) ) // å¸¦åŠ è½½çŠ¶æ€çš„å¼‚æ­¥ç»„ä»¶ const AsyncComponentWithLoading = defineAsyncComponent({ loader: () =\u0026gt; import(\u0026#39;./HeavyComponent.vue\u0026#39;), loadingComponent: LoadingComponent, errorComponent: ErrorComponent, delay: 200, timeout: 3000 }) æœ€ä½³å®è·µ 1. é€»è¾‘ç»„ç»‡ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 // æŒ‰åŠŸèƒ½ç»„ç»‡ä»£ç  export default { setup() { // ç”¨æˆ·ç›¸å…³é€»è¾‘ const { user, login, logout } = useAuth() // æ•°æ®è·å–é€»è¾‘ const { data: posts, loading, refresh } = useFetch(\u0026#39;/api/posts\u0026#39;) // UI çŠ¶æ€é€»è¾‘ const { sidebarOpen, toggleSidebar } = useSidebar() // å·¥å…·å‡½æ•° const formatDate = (date) =\u0026gt; new Date(date).toLocaleDateString() return { user, login, logout, posts, loading, refresh, sidebarOpen, toggleSidebar, formatDate } } } 2. çŠ¶æ€ç®¡ç† 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 // ä½¿ç”¨ Pinia è¿›è¡ŒçŠ¶æ€ç®¡ç† import { defineStore } from \u0026#39;pinia\u0026#39; export const useUserStore = defineStore(\u0026#39;user\u0026#39;, () =\u0026gt; { const user = ref(null) const isLoggedIn = computed(() =\u0026gt; !!user.value) const login = async (credentials) =\u0026gt; { try { user.value = await api.login(credentials) } catch (error) { throw error } } const logout = () =\u0026gt; { user.value = null } return { user, isLoggedIn, login, logout } }) æ€»ç»“ Vue 3 Composition API æä¾›äº†ï¼š\næ›´å¥½çš„é€»è¾‘ç»„ç»‡ï¼šç›¸å…³é€»è¾‘å¯ä»¥ç»„ç»‡åœ¨ä¸€èµ· ä¼˜ç§€çš„ TypeScript æ”¯æŒï¼šæ›´å¥½çš„ç±»å‹æ¨å¯¼å’Œæ£€æŸ¥ çµæ´»çš„ç»„åˆèƒ½åŠ›ï¼šé€šè¿‡è‡ªå®šä¹‰ Hook å®ç°é€»è¾‘å¤ç”¨ æ›´å°çš„åŒ…ä½“ç§¯ï¼šæŒ‰éœ€å¼•å…¥ï¼ŒTree-shaking å‹å¥½ æ›´å¥½çš„æ€§èƒ½ï¼šæ›´ç²¾ç¡®çš„å“åº”å¼è·Ÿè¸ª æŒæ¡ Composition API æ˜¯ç°ä»£ Vue å¼€å‘çš„å¿…å¤‡æŠ€èƒ½ï¼Œå®ƒèƒ½å¸®åŠ©æˆ‘ä»¬æ„å»ºæ›´æ¸…æ™°ã€æ›´å¯ç»´æŠ¤çš„åº”ç”¨ã€‚\nç›¸å…³èµ„æºï¼š\nVue 3 å®˜æ–¹æ–‡æ¡£ Vue 3 è¿ç§»æŒ‡å— ","permalink":"/blog/articles/vue3-composition-api-guide/","summary":"å…¨é¢ä»‹ç» Vue 3 Composition API çš„ä½¿ç”¨æ–¹æ³•å’Œæœ€ä½³å®è·µ","title":"Vue 3 Composition API å®Œå…¨æŒ‡å—"},{"content":"å‰è¨€ CSS Grid æ˜¯ä¸€ä¸ªäºŒç»´å¸ƒå±€ç³»ç»Ÿï¼Œä¸“é—¨ç”¨äºè§£å†³å¤æ‚çš„ç½‘é¡µå¸ƒå±€é—®é¢˜ã€‚ç›¸æ¯” Flexboxï¼ˆä¸€ç»´å¸ƒå±€ï¼‰ï¼ŒGrid èƒ½å¤ŸåŒæ—¶å¤„ç†è¡Œå’Œåˆ—ï¼Œä¸ºç½‘é¡µè®¾è®¡æä¾›äº†å‰æ‰€æœªæœ‰çš„çµæ´»æ€§ã€‚\nGrid åŸºç¡€æ¦‚å¿µ 1. Grid å®¹å™¨å’Œé¡¹ç›® 1 2 3 4 5 6 7 8 9 10 11 /* å®šä¹‰ Grid å®¹å™¨ */ .container { display: grid; /* æˆ–è€… */ display: inline-grid; } /* Grid é¡¹ç›®ä¼šè‡ªåŠ¨æˆä¸ºå­å…ƒç´  */ .container \u0026gt; div { /* è¿™äº› div è‡ªåŠ¨æˆä¸º Grid é¡¹ç›® */ } 2. ç½‘æ ¼çº¿å’Œè½¨é“ 1 2 3 4 5 6 .container { display: grid; grid-template-columns: 100px 200px 100px; /* 3åˆ— */ grid-template-rows: 50px 100px; /* 2è¡Œ */ gap: 10px; /* ç½‘æ ¼é—´è· */ } å®šä¹‰ç½‘æ ¼ç»“æ„ 1. å›ºå®šå’Œå¼¹æ€§ç½‘æ ¼ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 /* å›ºå®šå°ºå¯¸ */ .grid-fixed { display: grid; grid-template-columns: 200px 1fr 200px; /* 1fr = 1ä¸ªå¼¹æ€§å•ä½ */ grid-template-rows: 60px 1fr 40px; height: 100vh; } /* å“åº”å¼ç½‘æ ¼ */ .grid-responsive { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; } /* æ··åˆå•ä½ */ .grid-mixed { display: grid; grid-template-columns: 200px 1fr 100px; grid-template-rows: auto 1fr auto; } 2. å‘½åç½‘æ ¼çº¿ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 .container { display: grid; grid-template-columns: [sidebar-start] 200px [main-start] 1fr [main-end sidebar-end]; grid-template-rows: [header-start] 60px [main-start] 1fr [main-end footer-start] 40px [footer-end]; } /* ä½¿ç”¨å‘½åç½‘æ ¼çº¿æ”¾ç½®é¡¹ç›® */ .header { grid-column: sidebar-start / sidebar-end; grid-row: header-start; } 3. å‘½åç½‘æ ¼åŒºåŸŸ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 .container { display: grid; grid-template-areas: \u0026#34;header header header\u0026#34; \u0026#34;sidebar main aside\u0026#34; \u0026#34;footer footer footer\u0026#34;; grid-template-columns: 200px 1fr 200px; grid-template-rows: 60px 1fr 40px; gap: 10px; } .header { grid-area: header; } .sidebar { grid-area: sidebar; } .main { grid-area: main; } .aside { grid-area: aside; } .footer { grid-area: footer; } Grid é¡¹ç›®å®šä½ 1. åŸºäºç½‘æ ¼çº¿å®šä½ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 .item { /* ä»ç¬¬2æ¡åˆ—çº¿åˆ°ç¬¬4æ¡åˆ—çº¿ */ grid-column: 2 / 4; /* ä»ç¬¬1æ¡è¡Œçº¿åˆ°ç¬¬3æ¡è¡Œçº¿ */ grid-row: 1 / 3; } /* ä½¿ç”¨ span å…³é”®å­— */ .item-span { /* å æ®2åˆ— */ grid-column: span 2; /* å æ®3è¡Œ */ grid-row: span 3; } /* æ›´ç®€æ´çš„å†™æ³• */ .item-compact { /* ä»ç¬¬2åˆ—å¼€å§‹ï¼Œå æ®2åˆ— */ grid-column: 2 / span 2; } 2. åŸºäºåŒºåŸŸå®šä½ 1 2 3 4 5 6 7 8 9 .item-area { grid-area: 2 / 2 / 4 / 4; /* ç­‰åŒäºï¼š grid-row-start: 2; grid-column-start: 2; grid-row-end: 4; grid-column-end: 4; */ } 3. è‡ªåŠ¨å®šä½ 1 2 3 4 5 6 7 8 9 .container { display: grid; grid-template-columns: repeat(3, 1fr); grid-auto-flow: row; /* æˆ– column */ } .item { /* Grid ä¼šè‡ªåŠ¨æ”¾ç½®é¡¹ç›® */ } é«˜çº§ Grid ç‰¹æ€§ 1. è‡ªåŠ¨ç½‘æ ¼ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 .container { display: grid; grid-template-columns: repeat(3, 1fr); grid-auto-rows: 100px; /* è‡ªåŠ¨åˆ›å»ºçš„è¡Œé«˜ */ grid-auto-flow: dense; /* å¯†é›†å¡«å……ç®—æ³• */ } /* å®šä¹‰è‡ªåŠ¨åˆ— */ .auto-columns { display: grid; grid-template-rows: repeat(3, 100px); grid-auto-columns: 150px; /* è‡ªåŠ¨åˆ›å»ºçš„åˆ—å®½ */ grid-auto-flow: column; /* æŒ‰åˆ—å¡«å…… */ } 2. å­ç½‘æ ¼ï¼ˆSubgridï¼‰ 1 2 3 4 5 6 7 8 9 10 11 12 .parent { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 20px; } .child { display: grid; grid-template-columns: subgrid; /* ç»§æ‰¿çˆ¶å®¹å™¨çš„åˆ—å®šä¹‰ */ grid-column: span 2; gap: inherit; /* ç»§æ‰¿çˆ¶å®¹å™¨çš„é—´è· */ } 3. ç½‘æ ¼å¯¹é½ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 .container { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; height: 400px; /* æ•´ä¸ªç½‘æ ¼åœ¨å®¹å™¨ä¸­çš„å¯¹é½ */ justify-content: center; /* æ°´å¹³å¯¹é½ */ align-content: center; /* å‚ç›´å¯¹é½ */ /* æ‰€æœ‰é¡¹ç›®çš„é»˜è®¤å¯¹é½ */ justify-items: stretch; /* é¡¹ç›®æ°´å¹³æ‹‰ä¼¸ */ align-items: stretch; /* é¡¹ç›®å‚ç›´æ‹‰ä¼¸ */ } /* å•ä¸ªé¡¹ç›®çš„å¯¹é½ */ .item { justify-self: start; /* è¦†ç›–é»˜è®¤çš„ justify-items */ align-self: end; /* è¦†ç›–é»˜è®¤çš„ align-items */ } å®é™…åº”ç”¨ç¤ºä¾‹ 1. åœ£æ¯å¸ƒå±€ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 .holy-grail { display: grid; grid-template-columns: 200px 1fr 200px; grid-template-rows: 60px 1fr 40px; grid-template-areas: \u0026#34;header header header\u0026#34; \u0026#34;nav main aside\u0026#34; \u0026#34;footer footer footer\u0026#34;; min-height: 100vh; gap: 10px; } .header { grid-area: header; background: #e3f2fd; } .nav { grid-area: nav; background: #f3e5f5; } .main { grid-area: main; background: #e8f5e8; } .aside { grid-area: aside; background: #fff3e0; } .footer { grid-area: footer; background: #fce4ec; } /* å“åº”å¼è°ƒæ•´ */ @media (max-width: 768px) { .holy-grail { grid-template-columns: 1fr; grid-template-areas: \u0026#34;header\u0026#34; \u0026#34;nav\u0026#34; \u0026#34;main\u0026#34; \u0026#34;aside\u0026#34; \u0026#34;footer\u0026#34;; } } 2. å¡ç‰‡å¸ƒå±€ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 .card-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 20px; padding: 20px; } .card { display: grid; grid-template-rows: auto 1fr auto; gap: 15px; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); } .card-image { width: 100%; height: 200px; object-fit: cover; border-radius: 4px; } 3. ä»ªè¡¨æ¿å¸ƒå±€ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 .dashboard { display: grid; grid-template-columns: 250px 1fr; grid-template-rows: 60px 1fr; grid-template-areas: \u0026#34;sidebar header\u0026#34; \u0026#34;sidebar main\u0026#34;; height: 100vh; gap: 1px; background: #e0e0e0; } .sidebar { grid-area: sidebar; background: white; padding: 20px; } .header { grid-area: header; background: white; display: flex; align-items: center; padding: 0 20px; } .main { grid-area: main; background: #f5f5f5; padding: 20px; overflow-y: auto; } /* ä¸»å†…å®¹åŒºåŸŸçš„ç½‘æ ¼ */ .widgets { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; } .widget { background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); } ä¸ Flexbox çš„é…åˆä½¿ç”¨ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 .container { display: grid; grid-template-columns: 1fr 2fr; gap: 20px; } .sidebar { display: flex; flex-direction: column; gap: 10px; } .main { display: flex; flex-direction: column; } .header { display: flex; justify-content: space-between; align-items: center; } .content { flex: 1; display: flex; flex-direction: column; } æ€§èƒ½ä¼˜åŒ–æŠ€å·§ 1. é¿å…é¢‘ç¹é‡æ’ 1 2 3 4 5 6 7 .container { display: grid; /* ä½¿ç”¨å›ºå®šå€¼å‡å°‘é‡æ’ */ grid-template-columns: 200px 1fr 200px; /* ä½¿ç”¨ contain å±æ€§ä¼˜åŒ– */ contain: layout; } 2. åˆç†ä½¿ç”¨ minmax() 1 2 3 4 5 6 7 8 /* æ›´å¥½çš„å“åº”å¼è®¾è®¡ */ .responsive-grid { display: grid; grid-template-columns: repeat( auto-fill, minmax(min(100%, 300px), 1fr) ); } æµè§ˆå™¨å…¼å®¹æ€§ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 /* å¸¦å‰ç¼€çš„å†™æ³• */ .grid { display: -ms-grid; display: grid; -ms-grid-columns: 200px 1fr 200px; grid-template-columns: 200px 1fr 200px; } /* ä½¿ç”¨ @supports */ @supports (display: grid) { .modern-layout { display: grid; /* ç°ä»£ Grid å¸ƒå±€ */ } } è°ƒè¯•æŠ€å·§ 1. å¯è§†åŒ–ç½‘æ ¼ 1 2 3 4 5 6 7 8 9 10 11 12 13 .container { display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; } /* å¼€å‘æ—¶æ·»åŠ çš„è°ƒè¯•æ ·å¼ */ .container.debug { background-image: linear-gradient(rgba(255,0,0,0.1) 1px, transparent 1px), linear-gradient(90deg, rgba(255,0,0,0.1) 1px, transparent 1px); background-size: 50px 50px; } 2. ä½¿ç”¨æµè§ˆå™¨å¼€å‘å·¥å…· 1 2 3 4 /* åœ¨ Chrome DevTools ä¸­ */ /* é€‰æ‹© Grid å®¹å™¨ */ /* åœ¨ Styles é¢æ¿ä¸­ç‚¹å‡» Grid å›¾æ ‡ */ /* å¯ä»¥å¯è§†åŒ–ç½‘æ ¼çº¿å’Œç½‘æ ¼åŒºåŸŸ */ æ€»ç»“ CSS Grid æ˜¯ä¸€ä¸ªå¼ºå¤§çš„å¸ƒå±€å·¥å…·ï¼Œå®ƒæä¾›äº†ï¼š\näºŒç»´å¸ƒå±€èƒ½åŠ›ï¼šåŒæ—¶æ§åˆ¶è¡Œå’Œåˆ— çµæ´»çš„å°ºå¯¸æ§åˆ¶ï¼šå›ºå®šã€å¼¹æ€§ã€è‡ªåŠ¨å°ºå¯¸ ç›´è§‚çš„å‘½åç³»ç»Ÿï¼šç½‘æ ¼çº¿å‘½åã€åŒºåŸŸå‘½å ä¼˜ç§€çš„å“åº”å¼æ”¯æŒï¼šauto-fitã€auto-fillã€minmax() ä¸å…¶ä»– CSS ç‰¹æ€§çš„è‰¯å¥½é›†æˆï¼šFlexboxã€è‡ªå®šä¹‰å±æ€§ç­‰ æŒæ¡ Grid å¸ƒå±€å°†å¤§å¤§æå‡ä½ çš„ç½‘é¡µå¸ƒå±€èƒ½åŠ›ï¼Œè®©å¤æ‚çš„å¸ƒå±€å˜å¾—ç®€å•ç›´è§‚ã€‚\nç›¸å…³å·¥å…·ï¼š\nGrid Garden - Grid æ¸¸æˆåŒ–å­¦ä¹  CSS Grid Generator - å¯è§†åŒ– Grid ç”Ÿæˆå™¨ ","permalink":"/blog/articles/css-grid-layout-tutorial/","summary":"å…¨é¢å­¦ä¹  CSS Grid å¸ƒå±€ç³»ç»Ÿï¼ŒæŒæ¡ç°ä»£ç½‘é¡µå¸ƒå±€æŠ€æœ¯","title":"CSS Grid å¸ƒå±€å®Œå…¨æ•™ç¨‹"},{"content":"å‰è¨€ Git æ˜¯ç°ä»£è½¯ä»¶å¼€å‘ä¸å¯æˆ–ç¼ºçš„å·¥å…·ï¼Œä½†å¤§å¤šæ•°å¼€å‘è€…åªä½¿ç”¨äº†å…¶åŸºç¡€åŠŸèƒ½ã€‚æŒæ¡ Git çš„é«˜çº§æŠ€å·§å¯ä»¥æ˜¾è‘—æå‡å¼€å‘æ•ˆç‡å’Œä»£ç ç®¡ç†è´¨é‡ã€‚\nGit åŸºç¡€é…ç½®ä¼˜åŒ– 1. å…¨å±€é…ç½® 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 # è®¾ç½®ç”¨æˆ·ä¿¡æ¯ git config --global user.name \u0026#34;Your Name\u0026#34; git config --global user.email \u0026#34;your.email@example.com\u0026#34; # è®¾ç½®é»˜è®¤åˆ†æ”¯å git config --global init.defaultBranch main # è®¾ç½®ç¼–è¾‘å™¨ git config --global core.editor \u0026#34;code --wait\u0026#34; # è®¾ç½®åˆå¹¶ç­–ç•¥ git config --global pull.rebase false # è®¾ç½®å‡­è¯å­˜å‚¨ git config --global credential.helper store # è®¾ç½®è‡ªåŠ¨çº é”™ git config --global help.autocorrect 1 # è®¾ç½®ç€è‰² git config --global color.ui auto # è®¾ç½®åˆ«å git config --global alias.st status git config --global alias.co checkout git config --global alias.br branch git config --global alias.ci commit git config --global alias.unstage \u0026#39;reset HEAD --\u0026#39; git config --global alias.last \u0026#39;log -1 HEAD\u0026#39; git config --global alias.graph \u0026#39;log --oneline --graph --decorate --all\u0026#39; 2. é¡¹ç›®çº§é…ç½® 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 # åœ¨é¡¹ç›®æ ¹ç›®å½•åˆ›å»º .gitignore cat \u0026gt; .gitignore \u0026lt;\u0026lt; EOF # Dependencies node_modules/ npm-debug.log* # Build outputs dist/ build/ # IDE files .vscode/ .idea/ *.swp *.swo # Environment files .env .env.local # Logs logs/ *.log EOF # è®¾ç½®é¡¹ç›®ç‰¹å®šçš„é…ç½® git config core.fileMode false # å¿½ç•¥æ–‡ä»¶æƒé™å˜åŒ– git config core.autocrlf input # Windows æ¢è¡Œç¬¦å¤„ç† é«˜çº§åˆ†æ”¯ç®¡ç† 1. åŠŸèƒ½åˆ†æ”¯å·¥ä½œæµ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 # åˆ›å»ºåŠŸèƒ½åˆ†æ”¯ git checkout -b feature/user-authentication # å®šæœŸåŒæ­¥ä¸»åˆ†æ”¯ git fetch origin git rebase origin/main # å®ŒæˆåŠŸèƒ½ååˆå¹¶ git checkout main git merge feature/user-authentication --no-ff # åˆ é™¤å·²åˆå¹¶çš„åˆ†æ”¯ git branch -d feature/user-authentication git push origin --delete feature/user-authentication 2. åˆ†æ”¯ç­–ç•¥ 1 2 3 4 5 6 7 8 9 # æŸ¥çœ‹æ‰€æœ‰åˆ†æ”¯åŠå…¶æœ€åæäº¤æ—¶é—´ git for-each-ref --sort=\u0026#39;-authordate:iso8601\u0026#39; --format=\u0026#39; %(authordate:iso8601) %09 %(refname:short)\u0026#39; refs/heads/ # æŸ¥çœ‹å·²åˆå¹¶å’Œæœªåˆå¹¶çš„åˆ†æ”¯ git branch --merged git branch --no-merged # å®‰å…¨åˆ é™¤å·²åˆå¹¶çš„åˆ†æ”¯ git branch --merged | grep -v \u0026#34;\\*\u0026#34; | xargs -n 1 git branch -d 3. åˆ†æ”¯ä¿æŠ¤ 1 2 3 4 5 6 7 # ä¿æŠ¤ main åˆ†æ”¯ git config --global branch.main.pushRemote origin git config --global push.default current # æ‹’ç»å¼ºåˆ¶æ¨é€åˆ°å—ä¿æŠ¤åˆ†æ”¯ git config --global receive.denyDeleteCurrent true git config --global receive.denyNonFastForwards true é«˜çº§æäº¤æŠ€å·§ 1. äº¤äº’å¼ Rebase 1 2 3 4 5 6 7 8 9 10 11 12 13 # æœ€è¿‘3ä¸ªæäº¤çš„äº¤äº’å¼ rebase git rebase -i HEAD~3 # æˆ–æŒ‡å®šèŒƒå›´ git rebase -i start_commit_hash..end_commit_hash # Rebase å‘½ä»¤è¯´æ˜ï¼š # pick: ä½¿ç”¨è¯¥æäº¤ # reword: ä¿®æ”¹æäº¤ä¿¡æ¯ # edit: ç¼–è¾‘æäº¤ # squash: åˆå¹¶åˆ°ä¸Šä¸€ä¸ªæäº¤ # fixup: ç±»ä¼¼ squashï¼Œä½†ä¸¢å¼ƒæäº¤ä¿¡æ¯ # drop: åˆ é™¤æäº¤ 2. æäº¤ä¿¡æ¯ä¼˜åŒ– 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 # ä½¿ç”¨æ¨¡æ¿ç¼–è¾‘æäº¤ä¿¡æ¯ git commit -t commit_template.txt # æäº¤ä¿¡æ¯æ¨¡æ¿ç¤ºä¾‹ cat \u0026gt; commit_template.txt \u0026lt;\u0026lt; EOF # ç±»å‹(èŒƒå›´): ç®€çŸ­æè¿° # # è¯¦ç»†æè¿°ï¼ˆå¯é€‰ï¼‰ # # ç›¸å…³ Issue: #123 # # ç±»å‹è¯´æ˜ï¼š # feat: æ–°åŠŸèƒ½ # fix: ä¿®å¤ bug # docs: æ–‡æ¡£æ›´æ–° # style: ä»£ç æ ¼å¼è°ƒæ•´ # refactor: é‡æ„ä»£ç  # test: æµ‹è¯•ç›¸å…³ # chore: æ„å»ºå·¥å…·æˆ–è¾…åŠ©å·¥å…·çš„å˜åŠ¨ EOF # ä½¿ç”¨è¯¥æ¨¡æ¿ git config --global commit.template commit_template.txt 3. æäº¤å†å²æ¸…ç† 1 2 3 4 5 6 7 8 9 # ä¿®æ”¹æœ€åä¸€æ¬¡æäº¤ git commit --amend # ä¿®æ”¹æœ€åä¸€æ¬¡æäº¤ä¿¡æ¯ git commit --amend -m \u0026#34;æ–°çš„æäº¤ä¿¡æ¯\u0026#34; # æ·»åŠ æ–‡ä»¶åˆ°æœ€åä¸€æ¬¡æäº¤ git add . git commit --amend --no-edit é«˜çº§åˆå¹¶ç­–ç•¥ 1. åˆå¹¶å†²çªè§£å†³ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 # æŸ¥çœ‹å†²çªæ–‡ä»¶ git status # ä½¿ç”¨å·¥å…·è§£å†³å†²çª git mergetool # æ‰‹åŠ¨è§£å†³å†²çªæ ‡è®°ï¼š # \u0026lt;\u0026lt;\u0026lt;\u0026lt;\u0026lt;\u0026lt;\u0026lt; HEAD # å½“å‰åˆ†æ”¯çš„å†…å®¹ # ======= # åˆå¹¶åˆ†æ”¯çš„å†…å®¹ # \u0026gt;\u0026gt;\u0026gt;\u0026gt;\u0026gt;\u0026gt;\u0026gt; branch_name # æ ‡è®°å†²çªå·²è§£å†³ git add å†²çªæ–‡ä»¶å # ç»§ç»­åˆå¹¶ git merge --continue # å–æ¶ˆåˆå¹¶ git merge --abort 2. Cherry-pick 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 # é€‰æ‹©å•ä¸ªæäº¤åº”ç”¨åˆ°å½“å‰åˆ†æ”¯ git cherry-pick commit_hash # é€‰æ‹©å¤šä¸ªæäº¤ git cherry-pick start_hash..end_hash # ä¸åŒ…å«å¼€å§‹æäº¤ git cherry-pick start_hash^..end_hash # ä»…å¤åˆ¶æ›´æ”¹ï¼Œä¸åˆ›å»ºæäº¤ git cherry-pick --no-commit commit_hash # è§£å†³å†²çªåç»§ç»­ git cherry-pick --continue # æ”¾å¼ƒ cherry-pick git cherry-pick --abort 3. åˆå¹¶ç­–ç•¥é€‰æ‹© 1 2 3 4 5 6 7 8 9 10 11 12 13 # å¿«è¿›åˆå¹¶ï¼ˆé»˜è®¤ï¼‰ git merge feature-branch # éå¿«è¿›åˆå¹¶ï¼ˆä¿ç•™åˆ†æ”¯å†å²ï¼‰ git merge --no-ff feature-branch # Squash åˆå¹¶ï¼ˆå°†åˆ†æ”¯æäº¤åˆå¹¶ä¸ºä¸€ä¸ªï¼‰ git merge --squash feature-branch # ç­–ç•¥è¯´æ˜ï¼š # --ff: å¿«è¿›åˆå¹¶ï¼ˆé»˜è®¤ï¼‰ # --no-ff: éå¿«è¿›åˆå¹¶ï¼Œä¿ç•™åˆ†æ”¯å†å² # --squash: å°†æ‰€æœ‰æäº¤å‹ç¼©ä¸ºå•ä¸ªæäº¤ æš‚å­˜å’Œå‚¨è— 1. é«˜çº§ Stash 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 # åˆ›å»ºå¸¦ä¿¡æ¯çš„å‚¨è— git stash save \u0026#34;å®ç°ç”¨æˆ·ç™»å½•åŠŸèƒ½\u0026#34; # æš‚å­˜æœªè·Ÿè¸ªçš„æ–‡ä»¶ git stash -u # æš‚å­˜åŒ…æ‹¬å¿½ç•¥çš„æ–‡ä»¶ git stash -a # æŸ¥çœ‹å‚¨è—åˆ—è¡¨ git stash list # åº”ç”¨å‚¨è— git stash apply stash@{0} # åº”ç”¨å¹¶åˆ é™¤å‚¨è— git stash pop # åº”ç”¨ç‰¹å®šå‚¨è— git stash apply 2 # åˆ›å»ºåˆ†æ”¯ä»å‚¨è— git stash branch feature-branch stash@{1} # æŸ¥çœ‹å‚¨è—å†…å®¹ git stash show -p stash@{0} # åˆ é™¤å‚¨è— git stash drop stash@{0} # æ¸…ç©ºæ‰€æœ‰å‚¨è— git stash clear 2. æš‚å­˜éƒ¨åˆ†æ–‡ä»¶ 1 2 3 4 5 6 7 8 9 10 11 # äº¤äº’å¼æš‚å­˜ git add -i # æš‚å­˜æ–‡ä»¶çš„éƒ¨åˆ†å†…å®¹ git add -p filename # æš‚å­˜å¤šä¸ªæ–‡ä»¶çš„éƒ¨åˆ†å†…å®¹ git add -p # æš‚å­˜ç¼–è¾‘å™¨æ¨¡å¼ git add -e å†å²æŸ¥è¯¢å’Œåˆ†æ 1. é«˜çº§ Log æŸ¥çœ‹ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 # å›¾å½¢åŒ–æŸ¥çœ‹å†å² git log --oneline --graph --all --decorate # æŸ¥çœ‹æ¯ä¸ªæ–‡ä»¶çš„ä¿®æ”¹å†å² git log -- filename # æŸ¥çœ‹æäº¤çš„æ–‡ä»¶å˜æ›´ git log --stat # æŸ¥çœ‹æäº¤çš„è¯¦ç»†å·®å¼‚ git log -p # æŸ¥æ‰¾ç‰¹å®šä½œè€…çš„æäº¤ git log --author=\u0026#34;ä½œè€…å\u0026#34; # æŒ‰æ—¶é—´èŒƒå›´æŸ¥çœ‹ git log --since=\u0026#34;2024-01-01\u0026#34; --until=\u0026#34;2024-12-31\u0026#34; # æŸ¥æ‰¾åŒ…å«ç‰¹å®šå†…å®¹çš„æäº¤ git log -S \u0026#34;æœç´¢å†…å®¹\u0026#34; # æŸ¥æ‰¾ä¿®æ”¹ç‰¹å®šæ–‡ä»¶çš„æäº¤ git log --follow filename # çŸ­æ ¼å¼æŸ¥çœ‹ git log --pretty=format:\u0026#34;%h - %an, %ar : %s\u0026#34; 2. æ–‡ä»¶å†å²è¿½è¸ª 1 2 3 4 5 6 7 8 9 10 11 # æŸ¥çœ‹æ–‡ä»¶çš„ä¿®æ”¹è€…å’Œä¿®æ”¹æ—¶é—´ git blame filename # å¿½ç•¥ç©ºç™½å­—ç¬¦çš„ blame git blame -w filename # æ˜¾ç¤ºåŸå§‹è¡Œå· git blame -L 1,10 filename # æŸ¥çœ‹æ–‡ä»¶æ¯ä¸€è¡Œçš„æœ€åä¿®æ”¹ git log -p -- filename 3. æäº¤ç»Ÿè®¡ 1 2 3 4 5 6 7 8 # æŸ¥çœ‹å¼€å‘è€…è´¡çŒ®ç»Ÿè®¡ git shortlog -sn # æŸ¥çœ‹æ–‡ä»¶ä¿®æ”¹æ¬¡æ•° git log --name-only | sort | uniq -c | sort -rg # æŸ¥çœ‹é¡¹ç›®ç»Ÿè®¡ git diff --stat HEAD~5 HEAD é«˜çº§é‡ç½®æ“ä½œ 1. Reset å‘½ä»¤è¯¦è§£ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 # è½¯é‡ç½®ï¼ˆä¿ç•™å·¥ä½œåŒºå’Œæš‚å­˜åŒºï¼‰ git reset --soft HEAD~1 # æ··åˆé‡ç½®ï¼ˆä¿ç•™å·¥ä½œåŒºï¼Œæ¸…ç©ºæš‚å­˜åŒºï¼‰ git reset HEAD~1 # ç¡¬é‡ç½®ï¼ˆæ¸…ç©ºå·¥ä½œåŒºå’Œæš‚å­˜åŒºï¼‰ git reset --hard HEAD~1 # é‡ç½®åˆ°æŒ‡å®šæäº¤ git reset --hard commit_hash # é‡ç½®æ–‡ä»¶åˆ°ç‰¹å®šæäº¤ git reset commit_hash -- filename 2. Revert æ“ä½œ 1 2 3 4 5 6 7 8 9 10 11 # æ’¤é”€å•ä¸ªæäº¤ git revert commit_hash # æ’¤é”€å¤šä¸ªæäº¤ git revert start_hash..end_hash # ä¸åˆ›å»ºæ–°æäº¤ï¼Œç›´æ¥ä¿®æ”¹å·¥ä½œåŒº git revert --no-commit commit_hash # ç¼–è¾‘ revert ä¿¡æ¯ git revert --edit commit_hash è¿œç¨‹ä»“åº“ç®¡ç† 1. å¤šè¿œç¨‹ä»“åº“ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 # æŸ¥çœ‹æ‰€æœ‰è¿œç¨‹ä»“åº“ git remote -v # æ·»åŠ è¿œç¨‹ä»“åº“ git remote add upstream https://github.com/original/repo.git # é‡å‘½åè¿œç¨‹ä»“åº“ git remote rename origin old-origin # åˆ é™¤è¿œç¨‹ä»“åº“ git remote remove upstream # è·å–ç‰¹å®šè¿œç¨‹åˆ†æ”¯ git fetch origin main:main # æ¨é€æ‰€æœ‰åˆ†æ”¯ git push --all origin # åˆ é™¤è¿œç¨‹åˆ†æ”¯ git push origin --delete feature-branch 2. åŒæ­¥ Fork 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 # æ·»åŠ ä¸Šæ¸¸ä»“åº“ git remote add upstream https://github.com/original/repo.git # è·å–ä¸Šæ¸¸æ›´æ–° git fetch upstream # åˆå¹¶ä¸Šæ¸¸æ›´æ–° git checkout main git merge upstream/main # æˆ–ä½¿ç”¨ rebase git rebase upstream/main # æ¨é€åˆ°è‡ªå·±çš„ä»“åº“ git push origin main æ€§èƒ½ä¼˜åŒ– 1. ä»“åº“ä¼˜åŒ– 1 2 3 4 5 6 7 8 9 10 11 12 13 14 # åƒåœ¾å›æ”¶ git gc # æ¿€è¿›çš„åƒåœ¾å›æ”¶ git gc --aggressive --prune=now # æ¸…ç†æ— ç”¨æ–‡ä»¶ git clean -fd # æ£€æŸ¥ä»“åº“å®Œæ•´æ€§ git fsck # é‡æ–°æ‰“åŒ…æ•°æ®åº“ git repack -a -d --depth=250 --window=250 2. å¤§æ–‡ä»¶å¤„ç† 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 # ä½¿ç”¨ Git LFSï¼ˆLarge File Storageï¼‰ git lfs install # è·Ÿè¸ªå¤§æ–‡ä»¶ç±»å‹ git lfs track \u0026#34;*.psd\u0026#34; git lfs track \u0026#34;*.zip\u0026#34; # æŸ¥çœ‹è·Ÿè¸ªçš„æ–‡ä»¶ç±»å‹ git lfs track # æ·»åŠ  .gitattributes git add .gitattributes # æ¨é€ LFS æ–‡ä»¶ git push origin main --push-option=ssh://git@github.com/user/repo.git è‡ªåŠ¨åŒ–å’Œè„šæœ¬ 1. Git Hooks 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 # å®‰è£…ç¤ºä¾‹ hooks cp /usr/share/git-core/templates/hooks/* .git/hooks/ # Pre-commit hook ç¤ºä¾‹ cat \u0026gt; .git/hooks/pre-commit \u0026lt;\u0026lt; \u0026#39;EOF\u0026#39; #!/bin/sh # è¿è¡Œä»£ç æ£€æŸ¥ npm run lint # è¿è¡Œæµ‹è¯• npm test EOF chmod +x .git/hooks/pre-commit # Post-commit hook ç¤ºä¾‹ cat \u0026gt; .git/hooks/post-commit \u0026lt;\u0026lt; \u0026#39;EOF\u0026#39; #!/bin/sh # æäº¤åæ‰§è¡Œ echo \u0026#34;æäº¤å®Œæˆï¼Œè¯·æ¨é€åˆ°è¿œç¨‹ä»“åº“\u0026#34; EOF chmod +x .git/hooks/post-commit 2. å®ç”¨è„šæœ¬ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 # å¿«é€Ÿæäº¤è„šæœ¬ cat \u0026gt; quick-commit.sh \u0026lt;\u0026lt; \u0026#39;EOF\u0026#39; #!/bin/bash if [ $# -eq 0 ]; then echo \u0026#34;è¯·æä¾›æäº¤ä¿¡æ¯\u0026#34; exit 1 fi git add . git commit -m \u0026#34;$1\u0026#34; git push EOF chmod +x quick-commit.sh # åˆ†æ”¯æ¸…ç†è„šæœ¬ cat \u0026gt; cleanup-branches.sh \u0026lt;\u0026lt; \u0026#39;EOF\u0026#39; #!/bin/bash git branch --merged | grep -v \u0026#34;\\*\u0026#34; | grep -v \u0026#34;main\u0026#34; | xargs -n 1 git branch -d echo \u0026#34;å·²æ¸…ç†å·²åˆå¹¶çš„åˆ†æ”¯\u0026#34; EOF chmod +x cleanup-branches.sh æ•…éšœæ’é™¤ 1. å¸¸è§é—®é¢˜è§£å†³ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 # æ’¤é”€å·²æ¨é€çš„æäº¤ git revert HEAD git push origin main # å¼ºåˆ¶æ¨é€ï¼ˆè°¨æ…ä½¿ç”¨ï¼‰ git push --force-with-lease origin feature-branch # æ‰¾å›ä¸¢å¤±çš„æäº¤ git reflog git checkout commit_hash # è§£å†³ detached HEAD çŠ¶æ€ git checkout main git merge lost_commit # é‡ç½®åˆ°è¿œç¨‹çŠ¶æ€ git fetch origin git reset --hard origin/main 2. æ¢å¤æ“ä½œ 1 2 3 4 5 6 7 8 9 10 11 12 # æ¢å¤åˆ é™¤çš„æ–‡ä»¶ git checkout HEAD -- filename # æ¢å¤åˆ é™¤çš„åˆ†æ”¯ git reflog git checkout -b branch_name commit_hash # æŸ¥çœ‹æ‰€æœ‰å¼•ç”¨ git show-ref # æŸ¥æ‰¾åŒ…å«ç‰¹å®šæäº¤çš„åˆ†æ”¯ git branch --contains commit_hash æ€»ç»“ Git é«˜çº§æŠ€å·§èƒ½å¤Ÿæ˜¾è‘—æå‡å¼€å‘æ•ˆç‡ï¼š\né…ç½®ä¼˜åŒ–ï¼šåˆç†è®¾ç½®å…¨å±€å’Œé¡¹ç›®é…ç½® åˆ†æ”¯ç®¡ç†ï¼šé‡‡ç”¨æ¸…æ™°çš„åˆ†æ”¯ç­–ç•¥ æäº¤è´¨é‡ï¼šä½¿ç”¨äº¤äº’å¼ rebase ä¼˜åŒ–æäº¤å†å² å†²çªå¤„ç†ï¼šæŒæ¡å„ç§åˆå¹¶ç­–ç•¥å’Œå†²çªè§£å†³æŠ€å·§ å†å²ç®¡ç†ï¼šé«˜æ•ˆæŸ¥è¯¢å’Œåˆ†æä»£ç å†å² æ€§èƒ½ä¼˜åŒ–ï¼šå®šæœŸç»´æŠ¤å’Œä¼˜åŒ–ä»“åº“æ€§èƒ½ è‡ªåŠ¨åŒ–ï¼šåˆ©ç”¨ hooks å’Œè„šæœ¬æé«˜æ•ˆç‡ æŒæ¡è¿™äº›æŠ€å·§å°†å¸®åŠ©ä½ æ›´ä¸“ä¸šåœ°ä½¿ç”¨ Gitï¼Œæå‡å›¢é˜Ÿåä½œæ•ˆç‡ã€‚\n","permalink":"/blog/articles/git-advanced-techniques/","summary":"åˆ†äº« Git çš„é«˜çº§ä½¿ç”¨æŠ€å·§ï¼Œå¸®åŠ©å¼€å‘è€…æ›´é«˜æ•ˆåœ°ç®¡ç†ä»£ç å’Œåä½œ","title":"Git é«˜çº§æŠ€å·§ï¼šæå‡å¼€å‘æ•ˆç‡çš„å®ç”¨æŒ‡å—"},{"content":"å‰è¨€ Web å®‰å…¨æ˜¯æ¯ä¸ªå¼€å‘è€…éƒ½å¿…é¡»é‡è§†çš„é—®é¢˜ã€‚éšç€ç½‘ç»œæ”»å‡»æ‰‹æ®µçš„ä¸æ–­æ¼”è¿›ï¼Œäº†è§£å¹¶å®æ–½å®‰å…¨æœ€ä½³å®è·µå¯¹äºä¿æŠ¤ç”¨æˆ·æ•°æ®å’Œç³»ç»Ÿå®‰å…¨è‡³å…³é‡è¦ã€‚\nOWASP Top 10 é˜²èŒƒ 1. æ³¨å…¥æ”»å‡»é˜²æŠ¤ SQL æ³¨å…¥é˜²æŠ¤ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 // âŒ å±é™©ï¼šå­—ç¬¦ä¸²æ‹¼æ¥ const query = `SELECT * FROM users WHERE id = ${userId}`; // âœ… å®‰å…¨ï¼šå‚æ•°åŒ–æŸ¥è¯¢ const query = \u0026#39;SELECT * FROM users WHERE id = ?\u0026#39;; const result = db.query(query, [userId]); // ä½¿ç”¨ ORMï¼ˆå¦‚ Sequelizeï¼‰ const user = await User.findOne({ where: { id: userId } }); // æˆ–ä½¿ç”¨æ¨¡æ¿æ ‡ç­¾ï¼ˆå¦‚ pg åº“çš„ tagged template literalsï¼‰ const query = sql`SELECT * FROM users WHERE id = ${userId}`; NoSQL æ³¨å…¥é˜²æŠ¤ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 // âŒ å±é™©ï¼šç›´æ¥ä½¿ç”¨ç”¨æˆ·è¾“å…¥ const users = db.users.find({ username: req.body.username, password: req.body.password }); // âœ… å®‰å…¨ï¼šä½¿ç”¨ç™½åå•éªŒè¯ const { username, password } = req.body; // éªŒè¯è¾“å…¥æ ¼å¼ if (!/^[a-zA-Z0-9_]{3,20}$/.test(username)) { return res.status(400).json({ error: \u0026#39;Invalid username\u0026#39; }); } const users = db.users.find({ username: username, password: hashPassword(password) }); 2. èº«ä»½éªŒè¯å’Œæˆæƒ å¯†ç å®‰å…¨ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 const bcrypt = require(\u0026#39;bcryptjs\u0026#39;); const crypto = require(\u0026#39;crypto\u0026#39;); // å¯†ç å“ˆå¸Œ const hashPassword = async (password) =\u0026gt; { const saltRounds = 12; return await bcrypt.hash(password, saltRounds); }; // å¯†ç éªŒè¯ const verifyPassword = async (password, hashedPassword) =\u0026gt; { return await bcrypt.compare(password, hashedPassword); }; // ç”Ÿæˆéšæœºå¯†ç  const generateRandomPassword = (length = 12) =\u0026gt; { return crypto.randomBytes(length).toString(\u0026#39;hex\u0026#39;); }; // å¯†ç å¼ºåº¦éªŒè¯ const validatePasswordStrength = (password) =\u0026gt; { const minLength = 8; const hasUpperCase = /[A-Z]/.test(password); const hasLowerCase = /[a-z]/.test(password); const hasNumbers = /\\d/.test(password); const hasSpecialChar = /[!@#$%^\u0026amp;*(),.?\u0026#34;:{}|\u0026lt;\u0026gt;]/.test(password); return { isValid: password.length \u0026gt;= minLength \u0026amp;\u0026amp; hasUpperCase \u0026amp;\u0026amp; hasLowerCase \u0026amp;\u0026amp; hasNumbers \u0026amp;\u0026amp; hasSpecialChar, errors: [ password.length \u0026lt; minLength ? \u0026#39;Password must be at least 8 characters\u0026#39; : null, !hasUpperCase ? \u0026#39;Password must contain uppercase letter\u0026#39; : null, !hasLowerCase ? \u0026#39;Password must contain lowercase letter\u0026#39; : null, !hasNumbers ? \u0026#39;Password must contain a number\u0026#39; : null, !hasSpecialChar ? \u0026#39;Password must contain a special character\u0026#39; : null ].filter(Boolean) }; }; JWT å®ç°ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 const jwt = require(\u0026#39;jsonwebtoken\u0026#39;); const tokenService = { // ç”Ÿæˆ token generateToken(payload, expiresIn = \u0026#39;24h\u0026#39;) { return jwt.sign(payload, process.env.JWT_SECRET, { expiresIn }); }, // éªŒè¯ token verifyToken(token) { try { return jwt.verify(token, process.env.JWT_SECRET); } catch (error) { throw new Error(\u0026#39;Invalid token\u0026#39;); } }, // åˆ·æ–° token refreshToken(oldToken) { try { const decoded = jwt.verify(oldToken, process.env.JWT_SECRET, { ignoreExpiration: true }); // æ£€æŸ¥ token æ˜¯å¦åœ¨åˆ·æ–°æœŸå†… if (Date.now() - decoded.iat * 1000 \u0026gt; 7 * 24 * 60 * 60 * 1000) { throw new Error(\u0026#39;Token too old to refresh\u0026#39;); } return this.generateToken({ userId: decoded.userId, role: decoded.role }, \u0026#39;24h\u0026#39;); } catch (error) { throw new Error(\u0026#39;Cannot refresh token\u0026#39;); } } }; 3. æ•°æ®éªŒè¯å’Œæ¸…ç† è¾“å…¥éªŒè¯ä¸­é—´ä»¶ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 const { body, param, query, validationResult } = require(\u0026#39;express-validator\u0026#39;); const xss = require(\u0026#39;xss\u0026#39;); const validator = require(\u0026#39;validator\u0026#39;); // æ¸…ç† HTML è¾“å…¥ const sanitizeHtml = (input) =\u0026gt; { return xss(input, { whiteList: { a: [\u0026#39;href\u0026#39;, \u0026#39;title\u0026#39;, \u0026#39;target\u0026#39;], b: [], i: [], em: [], strong: [] }, stripIgnoreTag: true, stripIgnoreTagBody: [\u0026#39;script\u0026#39;] }); }; // é€šç”¨éªŒè¯ä¸­é—´ä»¶ const validateRequest = (validations) =\u0026gt; { return async (req, res, next) =\u0026gt; { await Promise.all(validations.map(validation =\u0026gt; validation.run(req))); const errors = validationResult(req); if (!errors.isEmpty()) { return res.status(400).json({ success: false, errors: errors.array() }); } // æ¸…ç†è¾“å…¥æ•°æ® const sanitizeObject = (obj) =\u0026gt; { if (typeof obj === \u0026#39;string\u0026#39;) { return sanitizeHtml(validator.escape(obj)); } if (Array.isArray(obj)) { return obj.map(sanitizeObject); } if (obj \u0026amp;\u0026amp; typeof obj === \u0026#39;object\u0026#39;) { const sanitized = {}; for (const [key, value] of Object.entries(obj)) { sanitized[key] = sanitizeObject(value); } return sanitized; } return obj; }; req.body = sanitizeObject(req.body); req.params = sanitizeObject(req.params); req.query = sanitizeObject(req.query); next(); }; }; // ä½¿ç”¨ç¤ºä¾‹ const userValidation = [ body(\u0026#39;email\u0026#39;) .isEmail() .normalizeEmail(), body(\u0026#39;name\u0026#39;) .trim() .isLength({ min: 2, max: 50 }) .escape(), body(\u0026#39;age\u0026#39;) .optional() .isInt({ min: 0, max: 120 }) ]; app.post(\u0026#39;/api/users\u0026#39;, validateRequest(userValidation), (req, res) =\u0026gt; { // å¤„ç†é€»è¾‘ }); å‰ç«¯å®‰å…¨ 1. XSS é˜²æŠ¤ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 // Content Security Policy è®¾ç½® const csp = { directives: { defaultSrc: [\u0026#34;\u0026#39;self\u0026#39;\u0026#34;], scriptSrc: [ \u0026#34;\u0026#39;self\u0026#39;\u0026#34;, \u0026#34;\u0026#39;unsafe-inline\u0026#39;\u0026#34;, // å¼€å‘ç¯å¢ƒä½¿ç”¨ \u0026#39;https://trusted-cdn.com\u0026#39; ], styleSrc: [ \u0026#34;\u0026#39;self\u0026#39;\u0026#34;, \u0026#34;\u0026#39;unsafe-inline\u0026#39;\u0026#34;, \u0026#39;https://fonts.googleapis.com\u0026#39; ], fontSrc: [ \u0026#34;\u0026#39;self\u0026#39;\u0026#34;, \u0026#39;https://fonts.gstatic.com\u0026#39; ], imgSrc: [ \u0026#34;\u0026#39;self\u0026#39;\u0026#34;, \u0026#39;data:\u0026#39;, \u0026#39;https:\u0026#39; ], connectSrc: [\u0026#34;\u0026#39;self\u0026#39;\u0026#34;], frameSrc: [\u0026#34;\u0026#39;none\u0026#39;\u0026#34;], objectSrc: [\u0026#34;\u0026#39;none\u0026#39;\u0026#34;] } }; // React ä¸­çš„å®‰å…¨å®è·µ const SafeComponent = ({ content }) =\u0026gt; { // âŒ å±é™©ï¼šç›´æ¥æ¸²æŸ“ HTML // return \u0026lt;div dangerouslySetInnerHTML={{ __html: content }} /\u0026gt;; // âœ… å®‰å…¨ï¼šä½¿ç”¨ä¸“é—¨çš„åº“ const DOMPurify = require(\u0026#39;dompurify\u0026#39;); const cleanContent = DOMPurify.sanitize(content); return ( \u0026lt;div\u0026gt; \u0026lt;span\u0026gt;Safe content:\u0026lt;/span\u0026gt; \u0026lt;div dangerouslySetInnerHTML={{ __html: cleanContent }} /\u0026gt; \u0026lt;/div\u0026gt; ); }; // å®‰å…¨çš„ URL å¤„ç† const SafeLink = ({ url, children }) =\u0026gt; { // éªŒè¯ URL const isValidUrl = (url) =\u0026gt; { try { const parsed = new URL(url); return [\u0026#39;http:\u0026#39;, \u0026#39;https:\u0026#39;].includes(parsed.protocol); } catch { return false; } }; if (!isValidUrl(url)) { console.warn(\u0026#39;Invalid URL detected:\u0026#39;, url); return \u0026lt;span\u0026gt;{children}\u0026lt;/span\u0026gt;; } return ( \u0026lt;a href={url} target=\u0026#34;_blank\u0026#34; rel=\u0026#34;noopener noreferrer\u0026#34;\u0026gt; {children} \u0026lt;/a\u0026gt; ); }; 2. CSRF é˜²æŠ¤ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 // CSRF Token ç”Ÿæˆå’ŒéªŒè¯ const csrf = require(\u0026#39;csurf\u0026#39;); const cookieParser = require(\u0026#39;cookie-parser\u0026#39;); app.use(cookieParser()); const csrfProtection = csrf({ cookie: { httpOnly: true, secure: process.env.NODE_ENV === \u0026#39;production\u0026#39;, sameSite: \u0026#39;strict\u0026#39; } }); // æä¾› CSRF token app.get(\u0026#39;/api/csrf-token\u0026#39;, csrfProtection, (req, res) =\u0026gt; { res.json({ csrfToken: req.csrfToken() }); }); // å—ä¿æŠ¤çš„è·¯ç”± app.post(\u0026#39;/api/protected\u0026#39;, csrfProtection, (req, res) =\u0026gt; { // å¤„ç†è¯·æ±‚ }); // å‰ç«¯ä½¿ç”¨ const postWithCSRF = async (url, data) =\u0026gt; { // è·å– CSRF token const { csrfToken } = await fetch(\u0026#39;/api/csrf-token\u0026#39;).then(r =\u0026gt; r.json()); return fetch(url, { method: \u0026#39;POST\u0026#39;, headers: { \u0026#39;Content-Type\u0026#39;: \u0026#39;application/json\u0026#39;, \u0026#39;X-CSRF-Token\u0026#39;: csrfToken }, body: JSON.stringify(data) }); }; åç«¯å®‰å…¨ 1. å®‰å…¨å¤´è®¾ç½® 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 const helmet = require(\u0026#39;helmet\u0026#39;); app.use(helmet({ contentSecurityPolicy: { directives: { defaultSrc: [\u0026#34;\u0026#39;self\u0026#39;\u0026#34;], styleSrc: [\u0026#34;\u0026#39;self\u0026#39;\u0026#34;, \u0026#34;\u0026#39;unsafe-inline\u0026#39;\u0026#34;], scriptSrc: [\u0026#34;\u0026#39;self\u0026#39;\u0026#34;], imgSrc: [\u0026#34;\u0026#39;self\u0026#39;\u0026#34;, \u0026#34;data:\u0026#34;, \u0026#34;https:\u0026#34;] } }, hsts: { maxAge: 31536000, includeSubDomains: true, preload: true } })); // è‡ªå®šä¹‰å®‰å…¨å¤´ app.use((req, res, next) =\u0026gt; { // é˜²æ­¢ç‚¹å‡»åŠ«æŒ res.setHeader(\u0026#39;X-Frame-Options\u0026#39;, \u0026#39;DENY\u0026#39;); // é˜²æ­¢ MIME ç±»å‹å—…æ¢ res.setHeader(\u0026#39;X-Content-Type-Options\u0026#39;, \u0026#39;nosniff\u0026#39;); // XSS ä¿æŠ¤ res.setHeader(\u0026#39;X-XSS-Protection\u0026#39;, \u0026#39;1; mode=block\u0026#39;); // å¼•ç”¨ç­–ç•¥ res.setHeader(\u0026#39;Referrer-Policy\u0026#39;, \u0026#39;strict-origin-when-cross-origin\u0026#39;); // æƒé™ç­–ç•¥ï¼ˆæ›¿ä»£ Feature-Policyï¼‰ res.setHeader(\u0026#39;Permissions-Policy\u0026#39;, \u0026#39;geolocation=(), microphone=(), camera=()\u0026#39; ); next(); }); 2. é€Ÿç‡é™åˆ¶ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 const rateLimit = require(\u0026#39;express-rate-limit\u0026#39;); const slowDown = require(\u0026#39;express-slow-down\u0026#39;); // é€šç”¨é€Ÿç‡é™åˆ¶ const generalLimiter = rateLimit({ windowMs: 15 * 60 * 1000, // 15åˆ†é’Ÿ max: 100, // é™åˆ¶æ¯ä¸ªIP 15åˆ†é’Ÿå†…æœ€å¤š100ä¸ªè¯·æ±‚ message: { error: \u0026#39;Too many requests, please try again later\u0026#39; }, standardHeaders: true, legacyHeaders: false }); // ç™»å½•é€Ÿç‡é™åˆ¶ const loginLimiter = rateLimit({ windowMs: 15 * 60 * 1000, max: 5, // æœ€å¤š5æ¬¡å°è¯• skipSuccessfulRequests: true }); // API é€Ÿç‡é™åˆ¶ const apiLimiter = rateLimit({ windowMs: 1 * 60 * 1000, // 1åˆ†é’Ÿ max: 60, // æ¯åˆ†é’Ÿ60ä¸ªè¯·æ±‚ keyGenerator: (req) =\u0026gt; { return req.user ? req.user.id : req.ip; } }); // å‡æ…¢å“åº”é€Ÿåº¦ const speedLimiter = slowDown({ windowMs: 15 * 60 * 1000, delayAfter: 50, // 50ä¸ªè¯·æ±‚åå¼€å§‹å»¶è¿Ÿ delayMs: 500, // æ¯ä¸ªè¯·æ±‚å»¶è¿Ÿ500ms maxDelayMs: 20000 // æœ€å¤§å»¶è¿Ÿ20ç§’ }); app.use(generalLimiter); app.use(\u0026#39;/api/login\u0026#39;, loginLimiter); app.use(\u0026#39;/api/\u0026#39;, apiLimiter); app.use(\u0026#39;/api/\u0026#39;, speedLimiter); æ•°æ®å®‰å…¨ 1. åŠ å¯†å­˜å‚¨ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 const crypto = require(\u0026#39;crypto\u0026#39;); const algorithm = \u0026#39;aes-256-gcm\u0026#39;; const secretKey = crypto.scryptSync(process.env.ENCRYPTION_KEY, \u0026#39;salt\u0026#39;, 32); const encryption = { // åŠ å¯† encrypt(text) { const iv = crypto.randomBytes(16); const cipher = crypto.createCipher(algorithm, secretKey, iv); let encrypted = cipher.update(text, \u0026#39;utf8\u0026#39;, \u0026#39;hex\u0026#39;); encrypted += cipher.final(\u0026#39;hex\u0026#39;); const authTag = cipher.getAuthTag(); return { encrypted, iv: iv.toString(\u0026#39;hex\u0026#39;), authTag: authTag.toString(\u0026#39;hex\u0026#39;) }; }, // è§£å¯† decrypt(encryptedData) { const decipher = crypto.createDecipher( algorithm, secretKey, Buffer.from(encryptedData.iv, \u0026#39;hex\u0026#39;) ); decipher.setAuthTag(Buffer.from(encryptedData.authTag, \u0026#39;hex\u0026#39;)); let decrypted = decipher.update(encryptedData.encrypted, \u0026#39;hex\u0026#39;, \u0026#39;utf8\u0026#39;); decrypted += decipher.final(\u0026#39;utf8\u0026#39;); return decrypted; } }; // ä½¿ç”¨ç¤ºä¾‹ const sensitiveData = \u0026#34;user\u0026#39;s credit card number\u0026#34;; const encrypted = encryption.encrypt(sensitiveData); const decrypted = encryption.decrypt(encrypted); 2. å®‰å…¨é…ç½® 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 // ç¯å¢ƒå˜é‡éªŒè¯ const requiredEnvVars = [ \u0026#39;JWT_SECRET\u0026#39;, \u0026#39;ENCRYPTION_KEY\u0026#39;, \u0026#39;DATABASE_URL\u0026#39; ]; const validateEnv = () =\u0026gt; { const missing = requiredEnvVars.filter(key =\u0026gt; !process.env[key]); if (missing.length \u0026gt; 0) { throw new Error(`Missing required environment variables: ${missing.join(\u0026#39;, \u0026#39;)}`); } }; // å®‰å…¨éšæœºæ•°ç”Ÿæˆ const generateSecureToken = (length = 32) =\u0026gt; { return crypto.randomBytes(length).toString(\u0026#39;hex\u0026#39;); }; // å¯†é’¥è½®æ¢ const keyRotation = { currentKey: process.env.ENCRYPTION_KEY, previousKeys: [], encryptWithCurrentKey(data) { return this.encrypt(data, this.currentKey); }, decryptWithAnyKey(encryptedData) { // å°è¯•ç”¨å½“å‰å¯†é’¥è§£å¯† try { return this.decrypt(encryptedData, this.currentKey); } catch (e) { // å°è¯•ç”¨ä»¥å‰çš„å¯†é’¥è§£å¯† for (const key of this.previousKeys) { try { return this.decrypt(encryptedData, key); } catch (e) { continue; } } throw new Error(\u0026#39;Unable to decrypt data with any available key\u0026#39;); } }, rotateKey(newKey) { this.previousKeys.push(this.currentKey); this.currentKey = newKey; // ä¿ç•™æœ€è¿‘3ä¸ªå¯†é’¥ if (this.previousKeys.length \u0026gt; 3) { this.previousKeys.shift(); } } }; å®‰å…¨æ—¥å¿—å’Œç›‘æ§ 1. å®‰å…¨äº‹ä»¶æ—¥å¿— 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 const winston = require(\u0026#39;winston\u0026#39;); const securityLogger = winston.createLogger({ level: \u0026#39;info\u0026#39;, format: winston.format.combine( winston.format.timestamp(), winston.format.json() ), transports: [ new winston.transports.File({ filename: \u0026#39;logs/security.log\u0026#39; }) ] }); const securityEvents = { logFailedLogin(ip, email, reason) { securityLogger.warn(\u0026#39;Failed login attempt\u0026#39;, { event: \u0026#39;FAILED_LOGIN\u0026#39;, ip, email, reason, timestamp: new Date().toISOString() }); }, logSuspiciousActivity(ip, userId, activity) { securityLogger.error(\u0026#39;Suspicious activity detected\u0026#39;, { event: \u0026#39;SUSPICIOUS_ACTIVITY\u0026#39;, ip, userId, activity, timestamp: new Date().toISOString() }); }, logPrivilegedAction(userId, action, resource) { securityLogger.info(\u0026#39;Privileged action performed\u0026#39;, { event: \u0026#39;PRIVILEGED_ACTION\u0026#39;, userId, action, resource, timestamp: new Date().toISOString() }); } }; 2. å¼‚å¸¸æ£€æµ‹ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 class SecurityMonitor { constructor() { this.failedLogins = new Map(); this.suspiciousIPs = new Set(); } recordFailedLogin(ip) { const count = this.failedLogins.get(ip) || 0; this.failedLogins.set(ip, count + 1); // 5æ¬¡å¤±è´¥ç™»å½•åæ ‡è®°ä¸ºå¯ç–‘ if (count \u0026gt;= 5) { this.suspiciousIPs.add(ip); securityEvents.logSuspiciousActivity(ip, null, \u0026#39;Multiple failed logins\u0026#39;); } // 24å°æ—¶åé‡ç½®è®¡æ•° setTimeout(() =\u0026gt; { this.failedLogins.delete(ip); }, 24 * 60 * 60 * 1000); } isIPSuspicious(ip) { return this.suspiciousIPs.has(ip); } detectAnomalousPattern(userId, action) { // å®ç°å¼‚å¸¸æ¨¡å¼æ£€æµ‹é€»è¾‘ // ä¾‹å¦‚ï¼šçŸ­æ—¶é—´å†…å¤§é‡æ“ä½œã€å¼‚å¸¸æ—¶é—´è®¿é—®ç­‰ } } const securityMonitor = new SecurityMonitor(); å®‰å…¨æµ‹è¯• 1. ä¾èµ–å®‰å…¨æ‰«æ 1 2 3 4 5 6 7 8 9 // package.json scripts { \u0026#34;scripts\u0026#34;: { \u0026#34;audit\u0026#34;: \u0026#34;npm audit --audit-level=moderate\u0026#34;, \u0026#34;audit:fix\u0026#34;: \u0026#34;npm audit fix\u0026#34;, \u0026#34;snyk\u0026#34;: \u0026#34;snyk test\u0026#34;, \u0026#34;snyk:monitor\u0026#34;: \u0026#34;snyk monitor\u0026#34; } } 2. å®‰å…¨æµ‹è¯• 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 // å®‰å…¨æµ‹è¯•ç¤ºä¾‹ const request = require(\u0026#39;supertest\u0026#39;); const app = require(\u0026#39;../app\u0026#39;); describe(\u0026#39;Security Tests\u0026#39;, () =\u0026gt; { test(\u0026#39;should prevent SQL injection\u0026#39;, async () =\u0026gt; { const maliciousInput = \u0026#34;\u0026#39;; DROP TABLE users; --\u0026#34;; const response = await request(app) .get(`/api/users/${maliciousInput}`) .expect(400); expect(response.body.error).toContain(\u0026#39;Invalid input\u0026#39;); }); test(\u0026#39;should prevent XSS in user input\u0026#39;, async () =\u0026gt; { const xssPayload = \u0026#39;\u0026lt;script\u0026gt;alert(\u0026#34;xss\u0026#34;)\u0026lt;/script\u0026gt;\u0026#39;; const response = await request(app) .post(\u0026#39;/api/users\u0026#39;) .send({ name: xssPayload }) .expect(400); expect(response.body.error).toContain(\u0026#39;Invalid input\u0026#39;); }); test(\u0026#39;should have proper security headers\u0026#39;, async () =\u0026gt; { const response = await request(app) .get(\u0026#39;/\u0026#39;) .expect(200); expect(response.headers[\u0026#39;x-frame-options\u0026#39;]).toBe(\u0026#39;DENY\u0026#39;); expect(response.headers[\u0026#39;x-content-type-options\u0026#39;]).toBe(\u0026#39;nosniff\u0026#39;); expect(response.headers[\u0026#39;x-xss-protection\u0026#39;]).toBe(\u0026#39;1; mode=block\u0026#39;); }); }); æ€»ç»“ Web å®‰å…¨æ˜¯ä¸€ä¸ªæŒç»­çš„è¿‡ç¨‹ï¼Œéœ€è¦å¤šå±‚æ¬¡çš„ä¿æŠ¤ï¼š\nè¾“å…¥éªŒè¯ï¼šä¸¥æ ¼éªŒè¯æ‰€æœ‰ç”¨æˆ·è¾“å…¥ èº«ä»½è®¤è¯ï¼šä½¿ç”¨å¼ºå¯†ç ç­–ç•¥å’Œå¤šå› ç´ è®¤è¯ æˆæƒæ§åˆ¶ï¼šå®æ–½æœ€å°æƒé™åŸåˆ™ æ•°æ®ä¿æŠ¤ï¼šåŠ å¯†æ•æ„Ÿæ•°æ® å®‰å…¨å¤´ï¼šè®¾ç½®é€‚å½“çš„å®‰å…¨å“åº”å¤´ ç›‘æ§æ—¥å¿—ï¼šè®°å½•å’Œç›‘æ§å®‰å…¨äº‹ä»¶ å®šæœŸæ›´æ–°ï¼šä¿æŒä¾èµ–å’Œç³»ç»Ÿæ›´æ–° è®°ä½ï¼Œå®‰å…¨ä¸æ˜¯ä¸€æ¬¡æ€§çš„ä»»åŠ¡ï¼Œè€Œæ˜¯éœ€è¦æŒç»­å…³æ³¨å’Œæ”¹è¿›çš„è¿‡ç¨‹ã€‚\nç›¸å…³å·¥å…·ï¼š\nOWASP ZAP - å®‰å…¨æµ‹è¯•å·¥å…· å¯†ç ç”Ÿæˆå™¨ åŠ å¯†å·¥å…· ","permalink":"/blog/articles/web-security-best-practices/","summary":"å…¨é¢ä»‹ç» Web åº”ç”¨å®‰å…¨å¼€å‘çš„æœ€ä½³å®è·µï¼Œé˜²èŒƒå¸¸è§çš„å®‰å…¨å¨èƒ","title":"Web å®‰å…¨æœ€ä½³å®è·µï¼šä¿æŠ¤ä½ çš„åº”ç”¨å…å—æ”»å‡»"},{"content":"å‰è¨€ Docker å·²ç»æˆä¸ºç°ä»£è½¯ä»¶å¼€å‘å’Œéƒ¨ç½²çš„æ ‡å‡†å·¥å…·ã€‚é€šè¿‡å®¹å™¨åŒ–ï¼Œæˆ‘ä»¬å¯ä»¥å®ç°ç¯å¢ƒä¸€è‡´æ€§ã€ç®€åŒ–éƒ¨ç½²æµç¨‹ã€æé«˜èµ„æºåˆ©ç”¨ç‡ã€‚æœ¬æŒ‡å—å°†å¸¦ä½ ä»åŸºç¡€åˆ°è¿›é˜¶ï¼Œå…¨é¢æŒæ¡ Docker çš„ä½¿ç”¨ã€‚\nDocker åŸºç¡€æ¦‚å¿µ 1. æ ¸å¿ƒç»„ä»¶ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 # Docker å¼•æ“ï¼šè¿è¡Œå’Œç®¡ç†å®¹å™¨çš„æ ¸å¿ƒ docker version # æŸ¥çœ‹ Docker ç‰ˆæœ¬ä¿¡æ¯ docker info # æŸ¥çœ‹ç³»ç»Ÿä¿¡æ¯å’Œèµ„æºä½¿ç”¨ # é•œåƒï¼ˆImageï¼‰ï¼šåº”ç”¨ç¨‹åºçš„é™æ€æ¨¡æ¿ docker images # æŸ¥çœ‹æœ¬åœ°é•œåƒ docker pull ubuntu:20.04 # æ‹‰å–é•œåƒ docker search nginx # æœç´¢é•œåƒ # å®¹å™¨ï¼ˆContainerï¼‰ï¼šé•œåƒçš„è¿è¡Œå®ä¾‹ docker ps # æŸ¥çœ‹è¿è¡Œçš„å®¹å™¨ docker ps -a # æŸ¥çœ‹æ‰€æœ‰å®¹å™¨ docker run nginx # è¿è¡Œå®¹å™¨ # ä»“åº“ï¼ˆRepositoryï¼‰ï¼šå­˜å‚¨å’Œåˆ†å‘é•œåƒçš„æœåŠ¡ docker login # ç™»å½•é•œåƒä»“åº“ docker push myapp:1.0 # æ¨é€é•œåƒ 2. Dockerfile åŸºç¡€ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 # åŸºç¡€é•œåƒ FROM node:16-alpine # ç»´æŠ¤è€…ä¿¡æ¯ LABEL maintainer=\u0026#34;your-email@example.com\u0026#34; # è®¾ç½®å·¥ä½œç›®å½• WORKDIR /app # å¤åˆ¶ package æ–‡ä»¶ COPY package*.json ./ # å®‰è£…ä¾èµ– RUN npm ci --only=production # å¤åˆ¶æºä»£ç  COPY . . # æš´éœ²ç«¯å£ EXPOSE 3000 # ç¯å¢ƒå˜é‡ ENV NODE_ENV=production # åˆ›å»ºé root ç”¨æˆ· RUN addgroup -g 1001 -S nodejs \u0026amp;\u0026amp; \\ adduser -S nodejs -u 1001 # æ›´æ”¹æ–‡ä»¶æ‰€æœ‰æƒ RUN chown -R nodejs:nodejs /app USER nodejs # å¯åŠ¨å‘½ä»¤ CMD [\u0026#34;node\u0026#34;, \u0026#34;app.js\u0026#34;] # å¥åº·æ£€æŸ¥ HEALTHCHECK --interval=30s --timeout=3s \\ CMD curl -f http://localhost:3000/health || exit 1 æ„å»ºä¼˜åŒ– 1. å¤šé˜¶æ®µæ„å»º 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 # æ„å»ºé˜¶æ®µ FROM node:16-alpine AS builder WORKDIR /app # å¤åˆ¶ä¾èµ–æ–‡ä»¶ COPY package*.json ./ # å®‰è£…æ‰€æœ‰ä¾èµ–ï¼ˆåŒ…æ‹¬å¼€å‘ä¾èµ–ï¼‰ RUN npm ci # å¤åˆ¶æºä»£ç  COPY . . # æ„å»ºåº”ç”¨ RUN npm run build # ç”Ÿäº§é˜¶æ®µ FROM node:16-alpine AS production WORKDIR /app # åªå¤åˆ¶ç”Ÿäº§ä¾èµ– COPY package*.json ./ RUN npm ci --only=production \u0026amp;\u0026amp; npm cache clean --force # ä»æ„å»ºé˜¶æ®µå¤åˆ¶æ„å»ºäº§ç‰© COPY --from=builder /app/dist ./dist # åˆ›å»ºé root ç”¨æˆ· RUN addgroup -g 1001 -S nodejs \u0026amp;\u0026amp; \\ adduser -S nodejs -u 1001 USER nodejs EXPOSE 3000 CMD [\u0026#34;node\u0026#34;, \u0026#34;dist/app.js\u0026#34;] 2. å±‚ç¼“å­˜ä¼˜åŒ– 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 # Dockerfile FROM node:16-alpine WORKDIR /app # å…ˆå¤åˆ¶ä¾èµ–æ–‡ä»¶ï¼Œåˆ©ç”¨ç¼“å­˜ COPY package.json package-lock.json ./ # å®‰è£…ä¾èµ–ï¼ˆè¿™ä¸€å±‚å˜åŒ–é¢‘ç‡ä½ï¼‰ RUN npm ci --only=production # å†å¤åˆ¶æºä»£ç ï¼ˆå˜åŒ–é¢‘ç‡é«˜ï¼‰ COPY . . # æ„å»ºæˆ–å¯åŠ¨åº”ç”¨ RUN npm run build CMD [\u0026#34;npm\u0026#34;, \u0026#34;start\u0026#34;] 3. .dockerignore æ–‡ä»¶ # æ’é™¤ä¸éœ€è¦çš„æ–‡ä»¶å’Œç›®å½• node_modules npm-debug.log .git .gitignore README.md .env .nyc_output coverage .coverage dist build *.log .DS_Store .vscode .idea Docker Compose 1. åŸºç¡€é…ç½® 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 # docker-compose.yml version: \u0026#39;3.8\u0026#39; services: # åº”ç”¨æœåŠ¡ app: build: context: . dockerfile: Dockerfile container_name: myapp restart: unless-stopped ports: - \u0026#34;3000:3000\u0026#34; environment: - NODE_ENV=production - DATABASE_URL=postgresql://user:password@db:5432/myapp depends_on: - db - redis volumes: - ./logs:/app/logs networks: - app-network # æ•°æ®åº“æœåŠ¡ db: image: postgres:13-alpine container_name: myapp-db restart: unless-stopped environment: - POSTGRES_DB=myapp - POSTGRES_USER=user - POSTGRES_PASSWORD=password volumes: - postgres_data:/var/lib/postgresql/data - ./init.sql:/docker-entrypoint-initdb.d/init.sql networks: - app-network # Redis æœåŠ¡ redis: image: redis:6-alpine container_name: myapp-redis restart: unless-stopped command: redis-server --appendonly yes volumes: - redis_data:/data networks: - app-network # Nginx åå‘ä»£ç† nginx: image: nginx:alpine container_name: myapp-nginx restart: unless-stopped ports: - \u0026#34;80:80\u0026#34; - \u0026#34;443:443\u0026#34; volumes: - ./nginx.conf:/etc/nginx/nginx.conf - ./ssl:/etc/nginx/ssl depends_on: - app networks: - app-network volumes: postgres_data: redis_data: networks: app-network: driver: bridge 2. ç¯å¢ƒå˜é‡é…ç½® 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 # docker-compose.prod.yml version: \u0026#39;3.8\u0026#39; services: app: environment: - NODE_ENV=production - PORT=3000 - DATABASE_URL=${DATABASE_URL} - REDIS_URL=${REDIS_URL} - JWT_SECRET=${JWT_SECRET} env_file: - .env.production # docker-compose.dev.yml version: \u0026#39;3.8\u0026#39; services: app: environment: - NODE_ENV=development - PORT=3000 volumes: - .:/app # å¼€å‘æ—¶æŒ‚è½½æºä»£ç  command: npm run dev ç”Ÿäº§éƒ¨ç½² 1. ç”Ÿäº§ç¯å¢ƒ Dockerfile 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 # Dockerfile.prod FROM node:16-alpine AS deps WORKDIR /app # å¤åˆ¶ä¾èµ–æ–‡ä»¶ COPY package.json package-lock.json ./ # å®‰è£…ä¾èµ– RUN npm ci --only=production # ç”Ÿäº§é•œåƒ FROM node:16-alpine RUN apk add --no-cache dumb-init WORKDIR /app # å¤åˆ¶ä¾èµ– COPY --from=deps /app/node_modules ./node_modules # å¤åˆ¶åº”ç”¨ä»£ç  COPY . . # åˆ›å»ºé root ç”¨æˆ· RUN addgroup -g 1001 -S nodejs \u0026amp;\u0026amp; \\ adduser -S nodejs -u 1001 \u0026amp;\u0026amp; \\ chown -R nodejs:nodejs /app USER nodejs # ä½¿ç”¨ dumb-init ENTRYPOINT [\u0026#34;dumb-init\u0026#34;, \u0026#34;--\u0026#34;] # å¥åº·æ£€æŸ¥ HEALTHCHECK --interval=30s --timeout=3s \\ CMD node healthcheck.js CMD [\u0026#34;node\u0026#34;, \u0026#34;app.js\u0026#34;] 2. å®‰å…¨é…ç½® 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 # å®‰å…¨æœ€ä½³å®è·µ FROM node:16-alpine # æ›´æ–°ç³»ç»ŸåŒ… RUN apk update \u0026amp;\u0026amp; \\ apk upgrade \u0026amp;\u0026amp; \\ apk add --no-cache \\ dumb-init \\ \u0026amp;\u0026amp; rm -rf /var/cache/apk/* # åˆ›å»ºç”¨æˆ· RUN addgroup -g 1001 -S appuser \u0026amp;\u0026amp; \\ adduser -S appuser -u 1001 WORKDIR /app # å¤åˆ¶å¹¶è®¾ç½®æƒé™ COPY --chown=appuser:appuser . . USER appuser # ä½¿ç”¨æœ€å°æƒé™è¿è¡Œ USER 1001:1001 # ä½¿ç”¨ tini åˆå§‹åŒ–ç³»ç»Ÿ ENTRYPOINT [\u0026#34;tini\u0026#34;, \u0026#34;--\u0026#34;] # CMD æ‰§è¡Œ CMD [\u0026#34;node\u0026#34;, \u0026#34;app.js\u0026#34;] ç½‘ç»œé…ç½® 1. è‡ªå®šä¹‰ç½‘ç»œ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 # docker-compose.networks.yml version: \u0026#39;3.8\u0026#39; services: web: image: nginx networks: - frontend - backend db: image: postgres networks: - backend networks: frontend: driver: bridge backend: driver: bridge internal: true # å†…éƒ¨ç½‘ç»œï¼Œä¸èƒ½è®¿é—®å¤–éƒ¨ 2. ç½‘ç»œéš”ç¦» 1 2 3 4 5 6 7 8 9 10 # åˆ›å»ºè‡ªå®šä¹‰ç½‘ç»œ docker network create --driver bridge myapp-network docker network create --driver bridge db-network --internal # è¿è¡Œå®¹å™¨å¹¶è¿æ¥åˆ°ç½‘ç»œ docker run -d --name web --network myapp-network nginx docker run -d --name db --network db-network postgres # è¿æ¥å®¹å™¨åˆ°å¤šä¸ªç½‘ç»œ docker network connect myapp-network db æ•°æ®æŒä¹…åŒ– 1. æ•°æ®å· 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 # docker-compose.volumes.yml version: \u0026#39;3.8\u0026#39; services: db: image: postgres:13 volumes: - postgres_data:/var/lib/postgresql/data - ./backups:/backups app: image: myapp volumes: - ./logs:/app/logs - uploads:/app/uploads volumes: postgres_data: driver: local uploads: driver: local 2. å¤‡ä»½å’Œæ¢å¤ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 # æ•°æ®åº“å¤‡ä»½è„šæœ¬ #!/bin/bash # backup.sh BACKUP_DIR=\u0026#34;/backups\u0026#34; DATE=$(date +%Y%m%d_%H%M%S) BACKUP_FILE=\u0026#34;$BACKUP_DIR/backup_$DATE.sql\u0026#34; # åˆ›å»ºå¤‡ä»½ docker exec postgres_container pg_dump -U postgres myapp \u0026gt; $BACKUP_FILE # å‹ç¼©å¤‡ä»½ gzip $BACKUP_FILE # åˆ é™¤7å¤©å‰çš„å¤‡ä»½ find $BACKUP_DIR -name \u0026#34;backup_*.sql.gz\u0026#34; -mtime +7 -delete echo \u0026#34;Backup completed: $BACKUP_FILE.gz\u0026#34; # æ•°æ®åº“æ¢å¤è„šæœ¬ #!/bin/bash # restore.sh BACKUP_FILE=$1 if [ -z \u0026#34;$BACKUP_FILE\u0026#34; ]; then echo \u0026#34;Usage: $0 \u0026lt;backup_file\u0026gt;\u0026#34; exit 1 fi # è§£å‹å¤‡ä»½ gunzip -c $BACKUP_FILE | docker exec -i postgres_container psql -U postgres -d myapp echo \u0026#34;Database restored from $BACKUP_FILE\u0026#34; ç›‘æ§å’Œæ—¥å¿— 1. æ—¥å¿—é…ç½® 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 # docker-compose.logging.yml version: \u0026#39;3.8\u0026#39; services: app: image: myapp logging: driver: \u0026#34;json-file\u0026#34; options: max-size: \u0026#34;10m\u0026#34; max-file: \u0026#34;3\u0026#34; labels: - \u0026#34;logging=enabled\u0026#34; # æ—¥å¿—æ”¶é›†æœåŠ¡ fluentd: image: fluent/fluentd:v1.14-debian volumes: - ./fluentd.conf:/fluentd/etc/fluent.conf - /var/lib/docker/containers:/var/lib/docker/containers 2. ç›‘æ§é›†æˆ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 # docker-compose.monitoring.yml version: \u0026#39;3.8\u0026#39; services: # Prometheus prometheus: image: prom/prometheus ports: - \u0026#34;9090:9090\u0026#34; volumes: - ./prometheus.yml:/etc/prometheus/prometheus.yml # Grafana grafana: image: grafana/grafana ports: - \u0026#34;3001:3000\u0026#34; environment: - GF_SECURITY_ADMIN_PASSWORD=admin volumes: - grafana_data:/var/lib/grafana # cAdvisor cadvisor: image: gcr.io/cadvisor/cadvisor ports: - \u0026#34;8080:8080\u0026#34; volumes: - /:/rootfs:ro - /var/run:/var/run:ro - /sys:/sys:ro - /var/lib/docker/:/var/lib/docker:ro volumes: grafana_data: CI/CD é›†æˆ 1. GitHub Actions 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 # .github/workflows/docker.yml name: Build and Deploy on: push: branches: [main] pull_request: branches: [main] jobs: build: runs-on: ubuntu-latest steps: - name: Checkout code uses: actions/checkout@v2 - name: Set up Docker Buildx uses: docker/setup-buildx-action@v1 - name: Login to DockerHub if: github.event_name == \u0026#39;push\u0026#39; uses: docker/login-action@v1 with: username: ${{ secrets.DOCKERHUB_USERNAME }} password: ${{ secrets.DOCKERHUB_TOKEN }} - name: Build and push uses: docker/build-push-action@v2 with: context: . file: ./Dockerfile.prod push: ${{ github.event_name == \u0026#39;push\u0026#39; }} tags: | yourusername/myapp:latest yourusername/myapp:${{ github.sha }} cache-from: type=gha cache-to: type=gha,mode=max deploy: needs: build runs-on: ubuntu-latest if: github.event_name == \u0026#39;push\u0026#39; steps: - name: Deploy to production uses: appleboy/ssh-action@v0.1.5 with: host: ${{ secrets.HOST }} username: ${{ secrets.USERNAME }} key: ${{ secrets.SSH_KEY }} script: | cd /path/to/your/app docker-compose pull docker-compose up -d docker system prune -f 2. è‡ªåŠ¨åŒ–è„šæœ¬ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 #!/bin/bash # deploy.sh set -e echo \u0026#34;Starting deployment...\u0026#34; # æ‹‰å–æœ€æ–°é•œåƒ docker-compose pull # åœæ­¢æ—§å®¹å™¨ docker-compose down # å¯åŠ¨æ–°å®¹å™¨ docker-compose up -d # ç­‰å¾…æœåŠ¡å¯åŠ¨ sleep 30 # å¥åº·æ£€æŸ¥ if curl -f http://localhost:3000/health; then echo \u0026#34;Deployment successful!\u0026#34; else echo \u0026#34;Deployment failed, rolling back...\u0026#34; docker-compose down docker-compose up -d --scale app=0 exit 1 fi # æ¸…ç†æœªä½¿ç”¨çš„é•œåƒ docker image prune -f echo \u0026#34;Deployment completed successfully!\u0026#34; æ€§èƒ½ä¼˜åŒ– 1. é•œåƒå¤§å°ä¼˜åŒ– 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 # ä½¿ç”¨ Alpine åŸºç¡€é•œåƒ FROM node:16-alpine # å¤šé˜¶æ®µæ„å»ºå‡å°‘æœ€ç»ˆé•œåƒå¤§å° FROM node:16-alpine AS builder # ... æ„å»ºè¿‡ç¨‹ ... FROM node:16-alpine AS runtime COPY --from=builder /app/dist ./dist # æ¸…ç†ä¸å¿…è¦çš„åŒ… RUN apk del .build-deps \u0026amp;\u0026amp; \\ rm -rf /var/cache/apk/* \u0026amp;\u0026amp; \\ npm cache clean --force # ä½¿ç”¨ .dockerignore æ’é™¤ä¸å¿…è¦æ–‡ä»¶ # åˆç†ä½¿ç”¨å¤šé˜¶æ®µæ„å»ºå’Œå±‚ç¼“å­˜ 2. èµ„æºé™åˆ¶ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 # docker-compose.prod.yml version: \u0026#39;3.8\u0026#39; services: app: image: myapp deploy: resources: limits: cpus: \u0026#39;0.5\u0026#39; memory: 512M reservations: cpus: \u0026#39;0.25\u0026#39; memory: 256M restart: unless-stopped ulimits: nofile: soft: 65536 hard: 65536 æ•…éšœæ’é™¤ 1. å¸¸ç”¨è°ƒè¯•å‘½ä»¤ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 # æŸ¥çœ‹å®¹å™¨æ—¥å¿— docker logs -f container_name docker logs --tail=100 container_name # è¿›å…¥å®¹å™¨è°ƒè¯• docker exec -it container_name /bin/sh # æŸ¥çœ‹å®¹å™¨èµ„æºä½¿ç”¨ docker stats # æŸ¥çœ‹å®¹å™¨è¯¦ç»†ä¿¡æ¯ docker inspect container_name # æŸ¥çœ‹é•œåƒå†å² docker history image_name # æ¸…ç† Docker èµ„æº docker system prune -a docker volume prune 2. å¥åº·æ£€æŸ¥ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 # åº”ç”¨å¥åº·æ£€æŸ¥è„šæœ¬ # healthcheck.js const http = require(\u0026#39;http\u0026#39;); const options = { hostname: \u0026#39;localhost\u0026#39;, port: 3000, path: \u0026#39;/health\u0026#39;, method: \u0026#39;GET\u0026#39;, timeout: 2000 }; const req = http.request(options, (res) =\u0026gt; { if (res.statusCode === 200) { process.exit(0); } else { process.exit(1); } }); req.on(\u0026#39;error\u0026#39;, () =\u0026gt; { process.exit(1); }); req.on(\u0026#39;timeout\u0026#39;, () =\u0026gt; { req.destroy(); process.exit(1); }); req.end(); æ€»ç»“ Docker å®¹å™¨åŒ–çš„æœ€ä½³å®è·µï¼š\né•œåƒä¼˜åŒ–ï¼šä½¿ç”¨å¤šé˜¶æ®µæ„å»ºã€å±‚ç¼“å­˜ã€Alpine é•œåƒ å®‰å…¨é…ç½®ï¼šé root ç”¨æˆ·ã€æœ€å°æƒé™ã€å®šæœŸæ›´æ–° èµ„æºç®¡ç†ï¼šåˆç†è®¾ç½®èµ„æºé™åˆ¶ã€ç›‘æ§ä½¿ç”¨æƒ…å†µ æ•°æ®æŒä¹…åŒ–ï¼šä½¿ç”¨æ•°æ®å·ã€å®šæœŸå¤‡ä»½ ç½‘ç»œé…ç½®ï¼šè‡ªå®šä¹‰ç½‘ç»œã€ç½‘ç»œéš”ç¦» CI/CD é›†æˆï¼šè‡ªåŠ¨åŒ–æ„å»ºå’Œéƒ¨ç½² ç›‘æ§æ—¥å¿—ï¼šå®Œå–„çš„ç›‘æ§å’Œæ—¥å¿—ç³»ç»Ÿ é€šè¿‡éµå¾ªè¿™äº›æœ€ä½³å®è·µï¼Œä½ å¯ä»¥æ„å»ºå‡ºé«˜æ•ˆã€å®‰å…¨ã€å¯ç»´æŠ¤çš„å®¹å™¨åŒ–åº”ç”¨ã€‚\nç›¸å…³èµ„æºï¼š\nDocker å®˜æ–¹æ–‡æ¡£ ","permalink":"/blog/articles/docker-containerization-guide/","summary":"å…¨é¢ä»‹ç» Docker å®¹å™¨åŒ–çš„æœ€ä½³å®è·µï¼Œä»åŸºç¡€æ¦‚å¿µåˆ°ç”Ÿäº§éƒ¨ç½²","title":"Docker å®¹å™¨åŒ–éƒ¨ç½²å®Œå…¨æŒ‡å—"},{"content":"å‰è¨€ è‰¯å¥½çš„ API è®¾è®¡æ˜¯æ„å»ºæˆåŠŸåº”ç”¨çš„å…³é”®ã€‚ä¸€ä¸ªè®¾è®¡è‰¯å¥½çš„ API åº”è¯¥ç›´è§‚ã€ä¸€è‡´ã€å¯é¢„æµ‹ï¼Œå¹¶ä¸”æ˜“äºå¼€å‘è€…ä½¿ç”¨å’Œç»´æŠ¤ã€‚æœ¬æ–‡å°†åˆ†äº« RESTful API è®¾è®¡çš„æœ€ä½³å®è·µã€‚\nRESTful åŸºç¡€åŸåˆ™ 1. èµ„æºå¯¼å‘è®¾è®¡ 1 2 3 4 5 6 7 8 9 10 11 12 13 // âŒ ä¸å¥½çš„è®¾è®¡ - åŠ¨ä½œå¯¼å‘ POST /getUser POST /createUser POST /updateUser POST /deleteUser // âœ… å¥½çš„è®¾è®¡ - èµ„æºå¯¼å‘ GET /users // è·å–ç”¨æˆ·åˆ—è¡¨ POST /users // åˆ›å»ºæ–°ç”¨æˆ· GET /users/{id} // è·å–ç‰¹å®šç”¨æˆ· PUT /users/{id} // å®Œæ•´æ›´æ–°ç”¨æˆ· PATCH /users/{id} // éƒ¨åˆ†æ›´æ–°ç”¨æˆ· DELETE /users/{id} // åˆ é™¤ç”¨æˆ· 2. HTTP æ–¹æ³•æ­£ç¡®ä½¿ç”¨ 1 2 3 4 5 6 7 8 9 10 11 12 13 // HTTP æ–¹æ³•è¯­ä¹‰ const httpMethods = { GET: \u0026#39;è·å–èµ„æºï¼Œå¹‚ç­‰ï¼Œå®‰å…¨\u0026#39;, POST: \u0026#39;åˆ›å»ºèµ„æºï¼Œéå¹‚ç­‰ï¼Œä¸å®‰å…¨\u0026#39;, PUT: \u0026#39;å®Œæ•´æ›´æ–°èµ„æºï¼Œå¹‚ç­‰ï¼Œä¸å®‰å…¨\u0026#39;, PATCH: \u0026#39;éƒ¨åˆ†æ›´æ–°èµ„æºï¼Œå¹‚ç­‰ï¼Œä¸å®‰å…¨\u0026#39;, DELETE: \u0026#39;åˆ é™¤èµ„æºï¼Œå¹‚ç­‰ï¼Œä¸å®‰å…¨\u0026#39; }; // èµ„æºåµŒå¥— GET /users/{userId}/orders // è·å–ç”¨æˆ·çš„è®¢å•åˆ—è¡¨ POST /users/{userId}/orders // ä¸ºç”¨æˆ·åˆ›å»ºæ–°è®¢å• GET /users/{userId}/orders/{orderId} // è·å–ç‰¹å®šè®¢å• URL è®¾è®¡è§„èŒƒ 1. å‘½åè§„èŒƒ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 // âœ… ä½¿ç”¨å¤æ•°å½¢å¼è¡¨ç¤ºèµ„æºé›†åˆ GET /users GET /products GET /orders // âœ… ä½¿ç”¨å°å†™å­—æ¯å’Œè¿å­—ç¬¦ GET /user-profiles/{id} GET /order-items/{id} // âœ… é¿å…æ·±å±‚åµŒå¥—ï¼ˆæœ€å¤š2-3å±‚ï¼‰ GET /users/{userId}/orders/{orderId}/items // æˆ–ä½¿ç”¨æŸ¥è¯¢å‚æ•° GET /items?userId={userId}\u0026amp;orderId={orderId} // âŒ é¿å…çš„åšæ³• GET /User GET /getUsers GET /api/v1/getAllUsers GET /users/{userId}/order/{orderId}/item/{itemId}/details/{detailId} 2. ç‰ˆæœ¬æ§åˆ¶ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 // URL ç‰ˆæœ¬æ§åˆ¶ GET /api/v1/users GET /api/v2/users // Header ç‰ˆæœ¬æ§åˆ¶ Accept: application/vnd.api+json;version=1 Accept: application/vnd.myapi.v2+json // è‡ªå®šä¹‰ Header ç‰ˆæœ¬æ§åˆ¶ API-Version: v1 // ç‰ˆæœ¬å‡çº§ç­–ç•¥ // v1 - ç¨³å®šç‰ˆæœ¬ï¼Œå‘åå…¼å®¹ // v2 - æ–°ç‰ˆæœ¬ï¼Œå¯èƒ½ä¸å…¼å®¹ // v1.1 - å°ç‰ˆæœ¬æ›´æ–°ï¼Œå‘åå…¼å®¹ è¯·æ±‚å’Œå“åº”è®¾è®¡ 1. è¯·æ±‚ä½“ç»“æ„ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 // åˆ›å»ºèµ„æºè¯·æ±‚ POST /api/v1/users Content-Type: application/json { \u0026#34;user\u0026#34;: { \u0026#34;name\u0026#34;: \u0026#34;John Doe\u0026#34;, \u0026#34;email\u0026#34;: \u0026#34;john@example.com\u0026#34;, \u0026#34;age\u0026#34;: 30, \u0026#34;preferences\u0026#34;: { \u0026#34;language\u0026#34;: \u0026#34;en\u0026#34;, \u0026#34;timezone\u0026#34;: \u0026#34;UTC\u0026#34; } } } // æ‰¹é‡æ“ä½œè¯·æ±‚ POST /api/v1/users/batch Content-Type: application/json { \u0026#34;users\u0026#34;: [ { \u0026#34;name\u0026#34;: \u0026#34;User 1\u0026#34;, \u0026#34;email\u0026#34;: \u0026#34;user1@example.com\u0026#34; }, { \u0026#34;name\u0026#34;: \u0026#34;User 2\u0026#34;, \u0026#34;email\u0026#34;: \u0026#34;user2@example.com\u0026#34; } ] } 2. å“åº”ä½“ç»“æ„ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 // æˆåŠŸå“åº” { \u0026#34;success\u0026#34;: true, \u0026#34;data\u0026#34;: { \u0026#34;id\u0026#34;: \u0026#34;123\u0026#34;, \u0026#34;name\u0026#34;: \u0026#34;John Doe\u0026#34;, \u0026#34;email\u0026#34;: \u0026#34;john@example.com\u0026#34;, \u0026#34;createdAt\u0026#34;: \u0026#34;2025-12-06T15:30:00Z\u0026#34;, \u0026#34;updatedAt\u0026#34;: \u0026#34;2025-12-06T15:30:00Z\u0026#34; }, \u0026#34;meta\u0026#34;: { \u0026#34;timestamp\u0026#34;: \u0026#34;2025-12-06T15:30:00Z\u0026#34;, \u0026#34;version\u0026#34;: \u0026#34;v1\u0026#34; } } // åˆ—è¡¨å“åº” { \u0026#34;success\u0026#34;: true, \u0026#34;data\u0026#34;: [ { \u0026#34;id\u0026#34;: \u0026#34;123\u0026#34;, \u0026#34;name\u0026#34;: \u0026#34;John Doe\u0026#34; }, { \u0026#34;id\u0026#34;: \u0026#34;124\u0026#34;, \u0026#34;name\u0026#34;: \u0026#34;Jane Smith\u0026#34; } ], \u0026#34;pagination\u0026#34;: { \u0026#34;page\u0026#34;: 1, \u0026#34;limit\u0026#34;: 20, \u0026#34;total\u0026#34;: 100, \u0026#34;totalPages\u0026#34;: 5, \u0026#34;hasNext\u0026#34;: true, \u0026#34;hasPrev\u0026#34;: false } } // é”™è¯¯å“åº” { \u0026#34;success\u0026#34;: false, \u0026#34;error\u0026#34;: { \u0026#34;code\u0026#34;: \u0026#34;VALIDATION_ERROR\u0026#34;, \u0026#34;message\u0026#34;: \u0026#34;Invalid input data\u0026#34;, \u0026#34;details\u0026#34;: [ { \u0026#34;field\u0026#34;: \u0026#34;email\u0026#34;, \u0026#34;message\u0026#34;: \u0026#34;Email is required\u0026#34; }, { \u0026#34;field\u0026#34;: \u0026#34;age\u0026#34;, \u0026#34;message\u0026#34;: \u0026#34;Age must be between 0 and 120\u0026#34; } ] }, \u0026#34;meta\u0026#34;: { \u0026#34;timestamp\u0026#34;: \u0026#34;2025-12-06T15:30:00Z\u0026#34;, \u0026#34;requestId\u0026#34;: \u0026#34;req-123456\u0026#34; } } çŠ¶æ€ç ä½¿ç”¨æŒ‡å— 1. æˆåŠŸçŠ¶æ€ç  1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 // 200 OK - æˆåŠŸè·å–æˆ–æ›´æ–°èµ„æº GET /api/v1/users/123 -\u0026gt; 200 PUT /api/v1/users/123 -\u0026gt; 200 // 201 Created - æˆåŠŸåˆ›å»ºèµ„æº POST /api/v1/users -\u0026gt; 201 // 202 Accepted - è¯·æ±‚å·²æ¥å—ï¼Œæ­£åœ¨å¤„ç† POST /api/v1/users/export -\u0026gt; 202 // 204 No Content - æˆåŠŸåˆ é™¤èµ„æº DELETE /api/v1/users/123 -\u0026gt; 204 // 206 Partial Content - éƒ¨åˆ†å†…å®¹ï¼ˆåˆ†é¡µï¼‰ GET /api/v1/users?page=1\u0026amp;limit=10 -\u0026gt; 206 2. é”™è¯¯çŠ¶æ€ç  1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 // 400 Bad Request - å®¢æˆ·ç«¯é”™è¯¯ POST /api/v1/users -\u0026gt; 400 (éªŒè¯å¤±è´¥) // 401 Unauthorized - æœªè®¤è¯ GET /api/v1/users -\u0026gt; 401 (éœ€è¦ç™»å½•) // 403 Forbidden - æ— æƒé™ GET /api/v1/admin/users -\u0026gt; 403 (éœ€è¦ç®¡ç†å‘˜æƒé™) // 404 Not Found - èµ„æºä¸å­˜åœ¨ GET /api/v1/users/999 -\u0026gt; 404 // 409 Conflict - èµ„æºå†²çª POST /api/v1/users -\u0026gt; 409 (é‚®ç®±å·²å­˜åœ¨) // 422 Unprocessable Entity - è¯·æ±‚æ ¼å¼æ­£ç¡®ä½†è¯­ä¹‰é”™è¯¯ POST /api/v1/users -\u0026gt; 422 (ä¸šåŠ¡é€»è¾‘é”™è¯¯) // 429 Too Many Requests - è¯·æ±‚é¢‘ç‡é™åˆ¶ GET /api/v1/users -\u0026gt; 429 (è¶…å‡ºé™åˆ¶) æ•°æ®éªŒè¯å’Œè¿‡æ»¤ 1. è¾“å…¥éªŒè¯ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 // ä½¿ç”¨ Joi è¿›è¡ŒéªŒè¯ const Joi = require(\u0026#39;joi\u0026#39;); const userSchema = Joi.object({ name: Joi.string().min(2).max(50).required(), email: Joi.string().email().required(), age: Joi.number().integer().min(0).max(120), preferences: Joi.object({ language: Joi.string().valid(\u0026#39;en\u0026#39;, \u0026#39;zh\u0026#39;, \u0026#39;es\u0026#39;), timezone: Joi.string() }) }); // éªŒè¯ä¸­é—´ä»¶ const validateRequest = (schema) =\u0026gt; { return (req, res, next) =\u0026gt; { const { error } = schema.validate(req.body); if (error) { return res.status(400).json({ success: false, error: { code: \u0026#39;VALIDATION_ERROR\u0026#39;, message: \u0026#39;Invalid input data\u0026#39;, details: error.details.map(d =\u0026gt; ({ field: d.path.join(\u0026#39;.\u0026#39;), message: d.message })) } }); } next(); }; }; // ä½¿ç”¨ app.post(\u0026#39;/api/v1/users\u0026#39;, validateRequest(userSchema), (req, res) =\u0026gt; { // å¤„ç†é€»è¾‘ }); 2. å“åº”è¿‡æ»¤ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 // å­—æ®µé€‰æ‹© GET /api/v1/users?fields=id,name,email // å®ç°ç¤ºä¾‹ app.get(\u0026#39;/api/v1/users\u0026#39;, (req, res) =\u0026gt; { const { fields } = req.query; let users = await User.find(); if (fields) { const selectedFields = fields.split(\u0026#39;,\u0026#39;); users = users.map(user =\u0026gt; _.pick(user, selectedFields)); } res.json({ success: true, data: users }); }); // æ•°æ®è½¬æ¢ const userSerializer = (user) =\u0026gt; { return { id: user._id, name: user.name, email: user.email, avatar: user.profile.avatar, joinedAt: user.createdAt.toISOString(), // ä¸è¿”å›æ•æ„Ÿä¿¡æ¯ // password: user.password }; }; // åµŒå…¥å…³è”æ•°æ® GET /api/v1/users?include=profile,orders app.get(\u0026#39;/api/v1/users\u0026#39;, async (req, res) =\u0026gt; { const { include } = req.query; const includes = include ? include.split(\u0026#39;,\u0026#39;) : []; let users = await User.find(); if (includes.includes(\u0026#39;profile\u0026#39;)) { users = await User.populate(users, \u0026#39;profile\u0026#39;); } if (includes.includes(\u0026#39;orders\u0026#39;)) { users = await User.populate(users, \u0026#39;orders\u0026#39;); } res.json({ success: true, data: users }); }); åˆ†é¡µã€æ’åºå’Œè¿‡æ»¤ 1. åˆ†é¡µå®ç° 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 // æŸ¥è¯¢å‚æ•° GET /api/v1/users?page=1\u0026amp;limit=20 // å“åº”ç»“æ„ { \u0026#34;success\u0026#34;: true, \u0026#34;data\u0026#34;: [...], \u0026#34;pagination\u0026#34;: { \u0026#34;page\u0026#34;: 1, \u0026#34;limit\u0026#34;: 20, \u0026#34;total\u0026#34;: 100, \u0026#34;totalPages\u0026#34;: 5, \u0026#34;hasNext\u0026#34;: true, \u0026#34;hasPrev\u0026#34;: false, \u0026#34;next\u0026#34;: \u0026#34;/api/v1/users?page=2\u0026amp;limit=20\u0026#34;, \u0026#34;prev\u0026#34;: null } } // å®ç°ç¤ºä¾‹ app.get(\u0026#39;/api/v1/users\u0026#39;, async (req, res) =\u0026gt; { const page = parseInt(req.query.page) || 1; const limit = parseInt(req.query.limit) || 20; const skip = (page - 1) * limit; const [users, total] = await Promise.all([ User.find().skip(skip).limit(limit), User.countDocuments() ]); const totalPages = Math.ceil(total / limit); res.json({ success: true, data: users, pagination: { page, limit, total, totalPages, hasNext: page \u0026lt; totalPages, hasPrev: page \u0026gt; 1, next: page \u0026lt; totalPages ? `/api/v1/users?page=${page + 1}\u0026amp;limit=${limit}` : null, prev: page \u0026gt; 1 ? `/api/v1/users?page=${page - 1}\u0026amp;limit=${limit}` : null } }); }); 2. æ’åºå®ç° 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 // æŸ¥è¯¢å‚æ•° GET /api/v1/users?sort=createdAt\u0026amp;order=desc GET /api/v1/users?sort=name,age\u0026amp;order=asc,desc // å®ç°ç¤ºä¾‹ app.get(\u0026#39;/api/v1/users\u0026#39;, async (req, res) =\u0026gt; { const { sort = \u0026#39;createdAt\u0026#39;, order = \u0026#39;desc\u0026#39; } = req.query; const sortFields = sort.split(\u0026#39;,\u0026#39;); const sortOrders = order.split(\u0026#39;,\u0026#39;); const sortObj = {}; sortFields.forEach((field, index) =\u0026gt; { sortObj[field] = sortOrders[index] === \u0026#39;desc\u0026#39; ? -1 : 1; }); const users = await User.find().sort(sortObj); res.json({ success: true, data: users }); }); 3. è¿‡æ»¤å®ç° 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 // æŸ¥è¯¢å‚æ•° GET /api/v1/users?age=30 GET /api/v1/users?age_min=18\u0026amp;age_max=65 GET /api/v1/users?name=john\u0026amp;email=@example.com GET /api/v1/users?tags=admin,active // å®ç°ç¤ºä¾‹ app.get(\u0026#39;/api/v1/users\u0026#39;, async (req, res) =\u0026gt; { const filters = {}; // ç²¾ç¡®åŒ¹é… if (req.query.age) { filters.age = parseInt(req.query.age); } // èŒƒå›´æŸ¥è¯¢ if (req.query.age_min || req.query.age_max) { filters.age = {}; if (req.query.age_min) { filters.age.$gte = parseInt(req.query.age_min); } if (req.query.age_max) { filters.age.$lte = parseInt(req.query.age_max); } } // æ¨¡ç³ŠæŸ¥è¯¢ if (req.query.name) { filters.name = { $regex: req.query.name, $options: \u0026#39;i\u0026#39; }; } // å¤šå€¼æŸ¥è¯¢ if (req.query.tags) { const tags = req.query.tags.split(\u0026#39;,\u0026#39;); filters.tags = { $in: tags }; } const users = await User.find(filters); res.json({ success: true, data: users }); }); è®¤è¯å’Œæˆæƒ 1. JWT è®¤è¯ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 // ç”Ÿæˆ token const generateToken = (user) =\u0026gt; { return jwt.sign( { userId: user.id, email: user.email, role: user.role }, process.env.JWT_SECRET, { expiresIn: \u0026#39;24h\u0026#39; } ); }; // è®¤è¯ä¸­é—´ä»¶ const authenticateToken = (req, res, next) =\u0026gt; { const authHeader = req.headers[\u0026#39;authorization\u0026#39;]; const token = authHeader \u0026amp;\u0026amp; authHeader.split(\u0026#39; \u0026#39;)[1]; if (!token) { return res.status(401).json({ success: false, error: { code: \u0026#39;TOKEN_MISSING\u0026#39;, message: \u0026#39;Access token is required\u0026#39; } }); } jwt.verify(token, process.env.JWT_SECRET, (err, user) =\u0026gt; { if (err) { return res.status(401).json({ success: false, error: { code: \u0026#39;TOKEN_INVALID\u0026#39;, message: \u0026#39;Invalid or expired token\u0026#39; } }); } req.user = user; next(); }); }; 2. æˆæƒä¸­é—´ä»¶ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 // è§’è‰²æˆæƒ const authorize = (...roles) =\u0026gt; { return (req, res, next) =\u0026gt; { if (!roles.includes(req.user.role)) { return res.status(403).json({ success: false, error: { code: \u0026#39;INSUFFICIENT_PERMISSIONS\u0026#39;, message: \u0026#39;You do not have permission to perform this action\u0026#39; } }); } next(); }; }; // èµ„æºæ‰€æœ‰æƒæ£€æŸ¥ const checkOwnership = (resourceModel) =\u0026gt; { return async (req, res, next) =\u0026gt; { try { const resource = await resourceModel.findById(req.params.id); if (!resource) { return res.status(404).json({ success: false, error: { code: \u0026#39;RESOURCE_NOT_FOUND\u0026#39;, message: \u0026#39;Resource not found\u0026#39; } }); } if (resource.userId.toString() !== req.user.userId \u0026amp;\u0026amp; req.user.role !== \u0026#39;admin\u0026#39;) { return res.status(403).json({ success: false, error: { code: \u0026#39;ACCESS_DENIED\u0026#39;, message: \u0026#39;You can only access your own resources\u0026#39; } }); } req.resource = resource; next(); } catch (error) { next(error); } }; }; // ä½¿ç”¨ç¤ºä¾‹ app.delete( \u0026#39;/api/v1/users/:id\u0026#39;, authenticateToken, checkOwnership(User), (req, res) =\u0026gt; { // åˆ é™¤é€»è¾‘ } ); ç¼“å­˜ç­–ç•¥ 1. HTTP ç¼“å­˜å¤´ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 // è®¾ç½®ç¼“å­˜å¤´ const setCacheHeaders = (req, res, next) =\u0026gt; { // å…¬å…±ç¼“å­˜ï¼Œ1å°æ—¶ if (req.path.startsWith(\u0026#39;/api/v1/public/\u0026#39;)) { res.set(\u0026#39;Cache-Control\u0026#39;, \u0026#39;public, max-age=3600\u0026#39;); } // ç§æœ‰ç¼“å­˜ï¼Œ5åˆ†é’Ÿ else if (req.path.startsWith(\u0026#39;/api/v1/users/profile\u0026#39;)) { res.set(\u0026#39;Cache-Control\u0026#39;, \u0026#39;private, max-age=300\u0026#39;); } // ä¸ç¼“å­˜ else { res.set(\u0026#39;Cache-Control\u0026#39;, \u0026#39;no-cache, no-store, must-revalidate\u0026#39;); } // ETag if (req.method === \u0026#39;GET\u0026#39;) { const data = JSON.stringify(res.locals.data); const etag = require(\u0026#39;crypto\u0026#39;).createHash(\u0026#39;md5\u0026#39;).update(data).digest(\u0026#39;hex\u0026#39;); res.set(\u0026#39;ETag\u0026#39;, etag); if (req.headers[\u0026#39;if-none-match\u0026#39;] === etag) { return res.status(304).end(); } } next(); }; 2. Redis ç¼“å­˜ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 const redis = require(\u0026#39;redis\u0026#39;); const client = redis.createClient(); const cache = { get: async (key) =\u0026gt; { try { const data = await client.get(key); return data ? JSON.parse(data) : null; } catch (error) { return null; } }, set: async (key, data, ttl = 3600) =\u0026gt; { try { await client.setex(key, ttl, JSON.stringify(data)); } catch (error) { console.error(\u0026#39;Cache set error:\u0026#39;, error); } }, del: async (key) =\u0026gt; { try { await client.del(key); } catch (error) { console.error(\u0026#39;Cache delete error:\u0026#39;, error); } } }; // ç¼“å­˜ä¸­é—´ä»¶ const cacheMiddleware = (ttl = 3600) =\u0026gt; { return async (req, res, next) =\u0026gt; { const key = `cache:${req.originalUrl}`; // å°è¯•ä»ç¼“å­˜è·å– const cachedData = await cache.get(key); if (cachedData) { return res.json({ ...cachedData, cached: true }); } // é‡å†™ res.json ä»¥ç¼“å­˜å“åº” const originalJson = res.json; res.json = function(data) { cache.set(key, data, ttl); return originalJson.call(this, data); }; next(); }; }; // ä½¿ç”¨ç¤ºä¾‹ app.get(\u0026#39;/api/v1/users\u0026#39;, cacheMiddleware(300), async (req, res) =\u0026gt; { const users = await User.find(); res.json({ success: true, data: users }); }); API æ–‡æ¡£ 1. Swagger/OpenAPI é…ç½® 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 # swagger.yaml openapi: 3.0.0 info: title: User API version: 1.0.0 description: ç”¨æˆ·ç®¡ç† API paths: /api/v1/users: get: summary: è·å–ç”¨æˆ·åˆ—è¡¨ tags: - Users parameters: - name: page in: query schema: type: integer minimum: 1 default: 1 - name: limit in: query schema: type: integer minimum: 1 maximum: 100 default: 20 responses: \u0026#39;200\u0026#39;: description: æˆåŠŸè¿”å›ç”¨æˆ·åˆ—è¡¨ content: application/json: schema: type: object properties: success: type: boolean data: type: array items: $ref: \u0026#39;#/components/schemas/User\u0026#39; pagination: $ref: \u0026#39;#/components/schemas/Pagination\u0026#39; post: summary: åˆ›å»ºæ–°ç”¨æˆ· tags: - Users requestBody: required: true content: application/json: schema: $ref: \u0026#39;#/components/schemas/CreateUserRequest\u0026#39; responses: \u0026#39;201\u0026#39;: description: ç”¨æˆ·åˆ›å»ºæˆåŠŸ \u0026#39;400\u0026#39;: description: è¯·æ±‚å‚æ•°é”™è¯¯ \u0026#39;409\u0026#39;: description: ç”¨æˆ·å·²å­˜åœ¨ components: schemas: User: type: object properties: id: type: string name: type: string email: type: string format: email createdAt: type: string format: date-time CreateUserRequest: type: object required: - name - email properties: name: type: string minLength: 2 maxLength: 50 email: type: string format: email age: type: integer minimum: 0 maximum: 120 æ€»ç»“ RESTful API è®¾è®¡çš„æœ€ä½³å®è·µï¼š\nèµ„æºå¯¼å‘ï¼šä½¿ç”¨åè¯è€ŒéåŠ¨è¯ï¼Œéµå¾ª REST åŸåˆ™ URL è®¾è®¡ï¼šæ¸…æ™°ã€ä¸€è‡´ã€å¯é¢„æµ‹çš„ URL ç»“æ„ HTTP æ–¹æ³•ï¼šæ­£ç¡®ä½¿ç”¨ HTTP åŠ¨è¯å’ŒçŠ¶æ€ç  æ•°æ®æ ¼å¼ï¼šç»Ÿä¸€çš„è¯·æ±‚å’Œå“åº”æ ¼å¼ éªŒè¯è¿‡æ»¤ï¼šä¸¥æ ¼çš„è¾“å…¥éªŒè¯å’Œçµæ´»çš„æ•°æ®è¿‡æ»¤ è®¤è¯æˆæƒï¼šå®‰å…¨çš„èº«ä»½éªŒè¯å’Œç»†ç²’åº¦çš„æƒé™æ§åˆ¶ æ€§èƒ½ä¼˜åŒ–ï¼šåˆç†çš„ç¼“å­˜ç­–ç•¥å’Œåˆ†é¡µæœºåˆ¶ æ–‡æ¡£å®Œå–„ï¼šæ¸…æ™°ã€è¯¦ç»†çš„ API æ–‡æ¡£ éµå¾ªè¿™äº›å®è·µï¼Œå¯ä»¥æ„å»ºå‡ºæ˜“äºç†è§£ã€ä½¿ç”¨å’Œç»´æŠ¤çš„ API æ¥å£ã€‚\nç›¸å…³å·¥å…·ï¼š\nPostman API æµ‹è¯• Swagger Editor API æ–‡æ¡£ç”Ÿæˆå™¨ ","permalink":"/blog/articles/api-design-best-practices/","summary":"å…¨é¢ä»‹ç» RESTful API çš„è®¾è®¡åŸåˆ™å’Œæœ€ä½³å®è·µï¼Œæ„å»ºä¼˜é›…ã€æ˜“ç”¨çš„ API","title":"RESTful API è®¾è®¡æœ€ä½³å®è·µ"}]