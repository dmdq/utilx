<template>
  <div class="max-w-8xl mx-auto">
    <!-- 工具标题 -->
    <div class="mt-4 mb-8">
      <h1 class="text-3xl font-bold mb-3">企业财务分析器</h1>
      <p class="text-muted-foreground">分析企业财务指标，包括流动比率、负债率、利润率等关键财务指标，提供全面的财务健康度评估</p>
    </div>

    <!-- 主要功能区域 -->
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
      <!-- 左侧：数据输入 -->
      <div class="lg:col-span-1 space-y-4">
        <!-- 资产负债表数据 -->
        <div class="bg-card rounded-lg p-6">
          <h2 class="text-lg font-semibold mb-4">资产负债表（万元）</h2>

          <div class="space-y-4">
            <!-- 资产部分 -->
            <div>
              <h3 class="font-medium mb-2 text-blue-700">资产</h3>
              <div class="space-y-2">
                <div>
                  <label class="block text-sm font-medium mb-1">流动资产</label>
                  <input
                    v-model.number="balanceSheet.currentAssets"
                    @input="performAnalysis"
                    type="number"
                    min="0"
                    placeholder="5000"
                    class="w-full px-3 py-2 border rounded-md"
                  >
                </div>
                <div class="pl-4 space-y-1">
                  <div>
                    <label class="block text-xs font-medium mb-1">货币资金</label>
                    <input
                      v-model.number="balanceSheet.cash"
                      @input="performAnalysis"
                      type="number"
                      min="0"
                      placeholder="1000"
                      class="w-full px-3 py-2 border rounded-md"
                    >
                  </div>
                  <div>
                    <label class="block text-xs font-medium mb-1">应收账款</label>
                    <input
                      v-model.number="balanceSheet.receivables"
                      @input="performAnalysis"
                      type="number"
                      min="0"
                      placeholder="2000"
                      class="w-full px-3 py-2 border rounded-md"
                    >
                  </div>
                  <div>
                    <label class="block text-xs font-medium mb-1">存货</label>
                    <input
                      v-model.number="balanceSheet.inventory"
                      @input="performAnalysis"
                      type="number"
                      min="0"
                      placeholder="1500"
                      class="w-full px-3 py-2 border rounded-md"
                    >
                  </div>
                </div>
              </div>
              <div>
                <label class="block text-sm font-medium mb-1">非流动资产</label>
                <input
                  v-model.number="balanceSheet.fixedAssets"
                  @input="performAnalysis"
                  type="number"
                  min="0"
                  placeholder="8000"
                  class="w-full px-3 py-2 border rounded-md"
                >
              </div>
              <div>
                <label class="block text-sm font-medium mb-1">资产总计</label>
                <input
                  v-model.number="balanceSheet.totalAssets"
                  @input="performAnalysis"
                  type="number"
                  min="0"
                  placeholder="13000"
                  class="w-full px-3 py-2 border rounded-md"
                >
              </div>
            </div>

            <!-- 负债和权益部分 -->
            <div>
              <h3 class="font-medium mb-2 text-red-700">负债和所有者权益</h3>
              <div class="space-y-2">
                <div>
                  <label class="block text-sm font-medium mb-1">流动负债</label>
                  <input
                    v-model.number="balanceSheet.currentLiabilities"
                    @input="performAnalysis"
                    type="number"
                    min="0"
                    placeholder="3000"
                    class="w-full px-3 py-2 border rounded-md"
                  >
                </div>
                <div class="pl-4 space-y-1">
                  <div>
                    <label class="block text-xs font-medium mb-1">短期借款</label>
                    <input
                      v-model.number="balanceSheet.shortTermBorrowing"
                      @input="performAnalysis"
                      type="number"
                      min="0"
                      placeholder="1500"
                      class="w-full px-3 py-2 border rounded-md"
                    >
                  </div>
                  <div>
                    <label class="block text-xs font-medium mb-1">应付账款</label>
                    <input
                      v-model.number="balanceSheet.payables"
                      @input="performAnalysis"
                      type="number"
                      min="0"
                      placeholder="1200"
                      class="w-full px-3 py-2 border rounded-md"
                    >
                  </div>
                </div>
              </div>
              <div>
                <label class="block text-sm font-medium mb-1">非流动负债</label>
                <input
                  v-model.number="balanceSheet.longTermLiabilities"
                  @input="performAnalysis"
                  type="number"
                  min="0"
                  placeholder="4000"
                  class="w-full px-3 py-2 border rounded-md"
                >
              </div>
              <div>
                <label class="block text-sm font-medium mb-1">所有者权益</label>
                <input
                  v-model.number="balanceSheet.ownerEquity"
                  @input="performAnalysis"
                  type="number"
                  min="0"
                  placeholder="6000"
                  class="w-full px-3 py-2 border rounded-md"
                >
              </div>
              <div>
                <label class="block text-sm font-medium mb-1">负债和权益总计</label>
                <input
                  v-model.number="balanceSheet.totalLiabilities"
                  @input="performAnalysis"
                  type="number"
                  min="0"
                  placeholder="13000"
                  class="w-full px-3 py-2 border rounded-md"
                >
              </div>
            </div>
          </div>
        </div>

        <!-- 利润表数据 -->
        <div class="bg-card rounded-lg p-6">
          <h2 class="text-lg font-semibold mb-4">利润表（万元）</h2>

          <div class="space-y-4">
            <div>
              <label class="block text-sm font-medium mb-1">营业收入</label>
              <input
                v-model.number="incomeStatement.revenue"
                @input="performAnalysis"
                type="number"
                min="0"
                placeholder="20000"
                class="w-full px-3 py-2 border rounded-md"
              >
            </div>
            <div>
              <label class="block text-sm font-medium mb-1">营业成本</label>
              <input
                v-model.number="incomeStatement.costOfSales"
                @input="performAnalysis"
                type="number"
                min="0"
                placeholder="12000"
                class="w-full px-3 py-2 border rounded-md"
              >
              </div>
            <div>
              <label class="block text-sm font-medium mb-1">营业费用</label>
              <input
                v-model.number="incomeStatement.operatingExpenses"
                @input="performAnalysis"
                type="number"
                min="0"
                placeholder="3000"
                class="w-full px-3 py-2 border rounded-md"
              >
            </div>
            <div>
              <label class="block text-sm font-medium mb-1">净利润</label>
              <input
                v-model.number="incomeStatement.netProfit"
                @input="performAnalysis"
                type="number"
                min="0"
                placeholder="3500"
                class="w-full px-3 py-2 border rounded-md"
              >
            </div>
            <div>
              <label class="block text-sm font-medium mb-1">息税前利润</label>
              <input
                v-model.number="incomeStatement.ebit"
                @input="performAnalysis"
                type="number"
                min="0"
                placeholder="4500"
                class="w-full px-3 py-2 border rounded-md"
              >
            </div>
          </div>
        </div>

        <!-- 现金流量表数据 -->
        <div class="bg-card rounded-lg p-6">
          <h2 class="text-lg font-semibold mb-4">现金流量表（万元）</h2>

          <div class="grid grid-cols-1 gap-4">
            <div>
              <label class="block text-sm font-medium mb-1">经营活动现金流</label>
              <input
                v-model.number="cashFlow.operatingCashFlow"
                @input="performAnalysis"
                type="number"
                placeholder="4000"
                class="w-full px-3 py-2 border rounded-md"
              >
            </div>
            <div>
              <label class="block text-sm font-medium mb-1">投资活动现金流</label>
              <input
                v-model.number="cashFlow.investingCashFlow"
                @input="performAnalysis"
                type="number"
                placeholder="-2000"
                class="w-full px-3 py-2 border rounded-md"
              >
            </div>
            <div>
              <label class="block text-sm font-medium mb-1">筹资活动现金流</label>
              <input
                v-model.number="cashFlow.financingCashFlow"
                @input="performAnalysis"
                type="number"
                placeholder="-500"
                class="w-full px-3 py-2 border rounded-md"
              >
            </div>
          </div>
        </div>

        <!-- 行业对比设置 -->
        <div class="bg-card rounded-lg p-6">
          <h2 class="text-lg font-semibold mb-4">行业对比设置</h2>

          <div class="grid grid-cols-1 gap-4">
            <div>
              <label class="block text-sm font-medium mb-1">行业类型</label>
              <select v-model="analysisData.industry" @change="performAnalysis" class="w-full px-3 py-2 border rounded-md">
                <option value="manufacturing">制造业</option>
                <option value="technology">科技行业</option>
                <option value="retail">零售业</option>
                <option value="realestate">房地产业</option>
                <option value="finance">金融业</option>
                <option value="healthcare">医疗保健</option>
                <option value="energy">能源行业</option>
                <option value="consumer">消费品</option>
              </select>
            </div>
            <div>
              <label class="block text-sm font-medium mb-1">企业规模</label>
              <select v-model="analysisData.companySize" @change="performAnalysis" class="w-full px-3 py-2 border rounded-md">
                <option value="small">小型企业</option>
                <option value="medium">中型企业</option>
                <option value="large">大型企业</option>
              </select>
            </div>
            <div>
              <label class="block text-sm font-medium mb-1">员工人数</label>
              <input
                v-model.number="analysisData.employeeCount"
                type="number"
                min="1"
                placeholder="500"
                class="w-full px-3 py-2 border rounded-md"
              >
            </div>
          </div>
        </div>

        <!-- 分析按钮 -->
        <button
          @click="performAnalysis"
          class="w-full bg-primary text-primary-foreground py-3 px-6 rounded-md hover:bg-primary/90 transition-colors flex items-center justify-center gap-2"
        >
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" />
          </svg>
          重新分析
        </button>
      </div>

      <!-- 右侧：结果显示 -->
      <div class="lg:col-span-2 space-y-6">
        <!-- 健康度评分 -->
        <div v-if="results" class="bg-card rounded-lg p-6">
          <h2 class="text-lg font-semibold mb-4">分析结果</h2>

          <div class="text-center mb-6">
            <div class="text-5xl font-bold mb-2" :class="getHealthScoreClass(results.healthScore)">
              {{ results.healthScore }}
            </div>
            <div class="text-sm text-muted-foreground">财务健康度评分</div>
            <div class="inline-flex items-center px-4 py-2 rounded-full text-sm font-medium mt-2" :class="getHealthScoreClass(results.healthScore)">
              {{ getHealthScoreText(results.healthScore) }}
            </div>
          </div>

          <!-- 关键指标 -->
          <div class="grid grid-cols-2 md:grid-cols-3 gap-4">
            <div>
              <h3 class="font-medium mb-2">关键比率</h3>
              <div class="space-y-2 text-sm">
                <div class="flex justify-between">
                  <span>流动比率：</span>
                  <span :class="getRatioClass(results.ratios.currentRatio, 2, 1.5)">
                    {{ results.ratios.currentRatio.toFixed(2) }}
                  </span>
                </div>
                <div class="flex justify-between">
                  <span>速动比率：</span>
                  <span :class="getRatioClass(results.ratios.quickRatio, 1, 0.8)">
                    {{ results.ratios.quickRatio.toFixed(2) }}
                  </span>
                </div>
                <div class="flex justify-between">
                  <span>资产负债率：</span>
                  <span :class="getRatioClass(100 - results.ratios.debtToAssetRatio * 100, 60, 40)">
                    {{ (results.ratios.debtToAssetRatio * 100).toFixed(1) }}%
                  </span>
                </div>
              </div>
            </div>
            <div>
              <h3 class="font-medium mb-2">盈利能力</h3>
              <div class="space-y-2 text-sm">
                <div class="flex justify-between">
                  <span>毛利率：</span>
                  <span :class="getRatioClass(results.ratios.grossMargin * 100, 30, 20)">
                    {{ (results.ratios.grossMargin * 100).toFixed(1) }}%
                  </span>
                </div>
                <div class="flex justify-between">
                  <span>净利率：</span>
                  <span :class="getRatioClass(results.ratios.netMargin * 100, 10, 5)">
                    {{ (results.ratios.netMargin * 100).toFixed(1) }}%
                  </span>
                </div>
                <div class="flex justify-between">
                  <span>ROE：</span>
                  <span :class="getRatioClass(results.ratios.roe * 100, 15, 8)">
                    {{ (results.ratios.roe * 100).toFixed(1) }}%
                  </span>
                </div>
              </div>
            </div>
            <div>
              <h3 class="font-medium mb-2">运营效率</h3>
              <div class="space-y-2 text-sm">
                <div class="flex justify-between">
                  <span>资产周转率：</span>
                  <span>{{ results.ratios.assetTurnover.toFixed(2) }} 次/年</span>
                </div>
                <div class="flex justify-between">
                  <span>应收周转率：</span>
                  <span>{{ results.ratios.receivablesTurnover.toFixed(2) }} 次/年</span>
                </div>
                <div class="flex justify-between">
                  <span>存货周转率：</span>
                  <span>{{ results.ratios.inventoryTurnover.toFixed(2) }} 次/年</span>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- 详细分析报告 -->
        <div v-if="results" class="bg-card rounded-lg p-6">
          <h2 class="text-lg font-semibold mb-4">详细分析报告</h2>

          <div class="space-y-6">
            <!-- 偿债能力分析 -->
            <div>
              <h3 class="font-medium mb-3">偿债能力分析</h3>
              <div class="text-sm text-muted-foreground space-y-2">
                <p>流动比率 {{ results.ratios.currentRatio.toFixed(2) }}，{{ results.ratios.currentRatio >= 2 ? '偿债能力较强' : results.ratios.currentRatio >= 1.5 ? '偿债能力适中' : '偿债能力较弱' }}</p>
                <p>速动比率 {{ results.ratios.quickRatio.toFixed(2) }}，{{ results.ratios.quickRatio >= 1 ? '短期偿债能力良好' : '短期偿债能力需要改善' }}</p>
                <p>资产负债率 {{ (results.ratios.debtToAssetRatio * 100).toFixed(1) }}%，{{ results.ratios.debtToAssetRatio <= 0.6 ? '财务结构稳健' : '财务风险较高' }}</p>
              </div>
            </div>

            <!-- 盈利能力分析 -->
            <div>
              <h3 class="font-medium mb-3">盈利能力分析</h3>
              <div class="text-sm text-muted-foreground space-y-2">
                <p>毛利率 {{ (results.ratios.grossMargin * 100).toFixed(1) }}%，{{ results.ratios.grossMargin >= 0.3 ? '盈利能力较强' : '盈利能力有待提升' }}</p>
                <p>净利率 {{ (results.ratios.netMargin * 100).toFixed(1) }}%，{{ results.ratios.netMargin >= 0.1 ? '经营效率良好' : '需要提高经营效率' }}</p>
                <p>ROE {{ (results.ratios.roe * 100).toFixed(1) }}%，{{ results.ratios.roe >= 0.15 ? '股东回报率高' : '股东回报率偏低' }}</p>
              </div>
            </div>

            <!-- 运营效率分析 -->
            <div>
              <h3 class="font-medium mb-3">运营效率分析</h3>
              <div class="text-sm text-muted-foreground space-y-2">
                <p>总资产周转率 {{ results.ratios.assetTurnover.toFixed(2) }} 次/年</p>
                <p>应收账款周转率 {{ results.ratios.receivablesTurnover.toFixed(2) }} 次/年</p>
                <p>存货周转率 {{ results.ratios.inventoryTurnover.toFixed(2) }} 次/年</p>
              </div>
            </div>

            <!-- 行业对比 -->
            <div>
              <h3 class="font-medium mb-3">行业对比分析</h3>
              <div class="text-sm text-muted-foreground space-y-2">
                <p v-for="(comparison, index) in results.industryComparison" :key="index">
                  {{ comparison.metric }}：企业 {{ comparison.company.toFixed(1) }}%，行业平均 {{ comparison.industry.toFixed(1) }}%，
                  <span :class="comparison.company >= comparison.industry ? 'text-green-600' : 'text-red-600'">
                    {{ comparison.company >= comparison.industry ? '高于' : '低于' }}行业平均水平
                  </span>
                </p>
              </div>
            </div>
          </div>
        </div>

        <!-- 改进建议 -->
        <div v-if="results" class="bg-card rounded-lg p-6">
          <h2 class="text-lg font-semibold mb-4">改进建议</h2>

          <div class="text-sm text-muted-foreground space-y-2">
            <p v-for="(suggestion, index) in results.suggestions" :key="index">
              • {{ suggestion }}
            </p>
          </div>
        </div>

        <!-- 相关工具 -->
        <div class="bg-card rounded-lg p-6">
          <h2 class="text-lg font-semibold mb-4">相关工具推荐</h2>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div
              v-for="tool in relatedTools"
              :key="tool.id"
              @click="navigateTo(`/tools/${tool.id}/`)"
              class="border rounded-lg p-4 hover:bg-accent cursor-pointer transition-colors"
            >
              <div class="font-medium">{{ tool.name }}</div>
              <div class="text-sm text-muted-foreground mt-1">{{ tool.description }}</div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</template>

<script setup>
import { ref, computed } from 'vue'

definePageMeta({
  layout: 'default'
})

const balanceSheet = ref({
  currentAssets: 5000,
  cash: 1000,
  receivables: 2000,
  inventory: 1500,
  fixedAssets: 8000,
  totalAssets: 13000,
  currentLiabilities: 3000,
  shortTermBorrowing: 1500,
  payables: 1200,
  longTermLiabilities: 4000,
  ownerEquity: 6000,
  totalLiabilities: 13000
})

const incomeStatement = ref({
  revenue: 20000,
  costOfSales: 12000,
  operatingExpenses: 3000,
  netProfit: 3500,
  ebit: 4500
})

const cashFlow = ref({
  operatingCashFlow: 4000,
  investingCashFlow: -2000,
  financingCashFlow: -500
})

const analysisData = ref({
  industry: 'manufacturing',
  companySize: 'medium',
  employeeCount: 500
})

const results = ref(null)

// 相关工具推荐
const relatedTools = computed(() => {
  const financeTools = [
    { id: 'loan-calculator', name: '贷款计算器', description: '计算房贷、车贷等月供金额、总利息和还款计划' },
    { id: 'tax-calculator', name: '税务计算器', description: '计算个人所得税、增值税、企业所得税等税费' },
    { id: 'retirement-planner', name: '退休储蓄规划器', description: '专业的退休储蓄计算工具，制定退休计划' },
    { id: 'investment-calculator', name: '理财收益计算器', description: '计算各类理财产品收益，支持多种投资方式' }
  ]
  return financeTools
})

// 行业基准数据
const industryBenchmarks = {
  manufacturing: {
    currentRatio: 1.8,
    quickRatio: 1.2,
    debtToAssetRatio: 0.55,
    grossMargin: 0.25,
    netMargin: 0.08,
    roe: 0.12
  },
  technology: {
    currentRatio: 2.5,
    quickRatio: 2.0,
    debtToAssetRatio: 0.35,
    grossMargin: 0.45,
    netMargin: 0.15,
    roe: 0.18
  },
  retail: {
    currentRatio: 1.5,
    quickRatio: 0.8,
    debtToAssetRatio: 0.65,
    grossMargin: 0.30,
    netMargin: 0.05,
    roe: 0.10
  }
}

// 获取健康度评分等级
const getHealthScoreClass = (score) => {
  if (score >= 80) return 'bg-green-100 text-green-800'
  if (score >= 60) return 'bg-yellow-100 text-yellow-800'
  return 'bg-red-100 text-red-800'
}

const getHealthScoreText = (score) => {
  if (score >= 80) return '优秀'
  if (score >= 60) return '良好'
  if (score >= 40) return '一般'
  return '需要改善'
}

// 获取比率等级样式
const getRatioClass = (value, goodThreshold, fairThreshold) => {
  if (value >= goodThreshold) return 'text-green-600 font-semibold'
  if (value >= fairThreshold) return 'text-yellow-600'
  return 'text-red-600'
}

// 进行财务分析
const performAnalysis = () => {
  // 计算关键财务比率
  const currentRatio = balanceSheet.value.currentAssets / balanceSheet.value.currentLiabilities
  const quickRatio = (balanceSheet.value.currentAssets - balanceSheet.value.inventory) / balanceSheet.value.currentLiabilities
  const debtToAssetRatio = (balanceSheet.value.currentLiabilities + balanceSheet.value.longTermLiabilities) / balanceSheet.value.totalAssets
  const grossMargin = incomeStatement.value.grossProfit / incomeStatement.value.revenue
  const netMargin = incomeStatement.value.netProfit / incomeStatement.value.revenue
  const roe = incomeStatement.value.netProfit / balanceSheet.value.ownerEquity
  const assetTurnover = incomeStatement.value.revenue / balanceSheet.value.totalAssets
  const receivablesTurnover = incomeStatement.value.revenue / balanceSheet.value.receivables
  const inventoryTurnover = incomeStatement.value.costOfSales / balanceSheet.value.inventory

  // 获取行业基准
  const benchmark = industryBenchmarks[analysisData.value.industry] || industryBenchmarks.manufacturing

  // 计算健康度评分
  let healthScore = 0
  const scoreWeights = {
    currentRatio: 15,
    quickRatio: 10,
    debtToAssetRatio: 20,
    grossMargin: 15,
    netMargin: 20,
    roe: 20
  }

  // 流动比率评分
  if (currentRatio >= 2) healthScore += scoreWeights.currentRatio
  else if (currentRatio >= 1.5) healthScore += scoreWeights.currentRatio * 0.8
  else if (currentRatio >= 1) healthScore += scoreWeights.currentRatio * 0.6
  else healthScore += scoreWeights.currentRatio * 0.3

  // 速动比率评分
  if (quickRatio >= 1.5) healthScore += scoreWeights.quickRatio
  else if (quickRatio >= 1) healthScore += scoreWeights.quickRatio * 0.8
  else if (quickRatio >= 0.8) healthScore += scoreWeights.quickRatio * 0.6
  else healthScore += scoreWeights.quickRatio * 0.3

  // 资产负债率评分（越低越好）
  if (debtToAssetRatio <= 0.4) healthScore += scoreWeights.debtToAssetRatio
  else if (debtToAssetRatio <= 0.6) healthScore += scoreWeights.debtToAssetRatio * 0.8
  else if (debtToAssetRatio <= 0.8) healthScore += scoreWeights.debtToAssetRatio * 0.5
  else healthScore += scoreWeights.debtToAssetRatio * 0.2

  // 毛利率评分
  if (grossMargin >= 0.4) healthScore += scoreWeights.grossMargin
  else if (grossMargin >= 0.3) healthScore += scoreWeights.grossMargin * 0.8
  else if (grossMargin >= 0.2) healthScore += scoreWeights.grossMargin * 0.6
  else healthScore += scoreWeights.grossMargin * 0.3

  // 净利率评分
  if (netMargin >= 0.15) healthScore += scoreWeights.netMargin
  else if (netMargin >= 0.1) healthScore += scoreWeights.netMargin * 0.8
  else if (netMargin >= 0.05) healthScore += scoreWeights.netMargin * 0.6
  else healthScore += scoreWeights.netMargin * 0.3

  // ROE评分
  if (roe >= 0.2) healthScore += scoreWeights.roe
  else if (roe >= 0.15) healthScore += scoreWeights.roe * 0.8
  else if (roe >= 0.1) healthScore += scoreWeights.roe * 0.6
  else healthScore += scoreWeights.roe * 0.3

  // 行业对比
  const industryComparison = [
    { metric: '流动比率', company: currentRatio, industry: benchmark.currentRatio },
    { metric: '速动比率', company: quickRatio, industry: benchmark.quickRatio },
    { metric: '资产负债率', company: debtToAssetRatio, industry: benchmark.debtToAssetRatio },
    { metric: '毛利率', company: grossMargin, industry: benchmark.grossMargin },
    { metric: '净利率', company: netMargin, industry: benchmark.netMargin },
    { metric: 'ROE', company: roe, industry: benchmark.roe }
  ]

  // 生成改进建议
  const suggestions = []
  if (currentRatio < 1.5) suggestions.push('建议增加流动资产或减少流动负债以提高短期偿债能力')
  if (debtToAssetRatio > 0.7) suggestions.push('资产负债率偏高，建议适当降低负债水平')
  if (grossMargin < 0.2) suggestions.push('毛利率偏低，建议提高产品定价或降低成本')
  if (netMargin < 0.05) suggestions.push('净利率偏低，建议优化费用结构，提高经营效率')
  if (roe < 0.08) suggestions.push('ROE偏低，建议提高盈利能力或优化资本结构')
  if (receivablesTurnover < 6) suggestions.push('应收账款周转率偏低，建议加强应收账款管理')
  if (inventoryTurnover < 4) suggestions.push('存货周转率偏低，建议优化库存管理')

  if (suggestions.length === 0) {
    suggestions.push('财务指标整体良好，建议继续保持当前经营策略')
    suggestions.push('关注行业发展趋势，适时调整业务结构')
    suggestions.push('加强现金流管理，确保企业稳健发展')
  }

  results.value = {
    healthScore: Math.round(healthScore),
    ratios: {
      currentRatio,
      quickRatio,
      debtToAssetRatio,
      grossMargin,
      netMargin,
      roe,
      assetTurnover,
      receivablesTurnover,
      inventoryTurnover
    },
    industryComparison,
    suggestions
  }
}


// 初始化分析
performAnalysis()
</script>